<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Dockerâ… -å…¥é—¨</title>
      <link href="/2024/02/27/docker01/"/>
      <url>/2024/02/27/docker01/</url>
      
        <content type="html"><![CDATA[<h1>Dockerå…¥é—¨</h1><p><a href="http://www.docker.com">Docker å®˜ç½‘</a></p><p><a href="https://hub.docker.com/">Docker Hub å®˜ç½‘</a></p><h2 id="Dockeræ¦‚è¿°">Dockeræ¦‚è¿°</h2><p><strong>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯</strong></p><p>è™šæ‹Ÿæœºï¼ˆvirtual machineï¼‰å°±æ˜¯å¸¦ç¯å¢ƒå®‰è£…çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p><p>å®ƒå¯ä»¥åœ¨ä¸€ç§æ“ä½œç³»ç»Ÿé‡Œé¢è¿è¡Œå¦ä¸€ç§æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨Windows10ç³»ç»Ÿé‡Œé¢è¿è¡ŒLinuxç³»ç»ŸCentOS7ã€‚åº”ç”¨ç¨‹åºå¯¹æ­¤æ¯«æ— æ„ŸçŸ¥ï¼Œå› ä¸ºè™šæ‹Ÿæœºçœ‹ä¸Šå»è·ŸçœŸå®ç³»ç»Ÿä¸€æ¨¡ä¸€æ ·ï¼Œè€Œå¯¹äºåº•å±‚ç³»ç»Ÿæ¥è¯´ï¼Œè™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œä¸éœ€è¦äº†å°±åˆ æ‰ï¼Œå¯¹å…¶ä»–éƒ¨åˆ†æ¯«æ— å½±å“ã€‚è¿™ç±»è™šæ‹Ÿæœºå®Œç¾çš„è¿è¡Œäº†å¦ä¸€å¥—ç³»ç»Ÿï¼Œèƒ½å¤Ÿä½¿åº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ä¸‰è€…ä¹‹é—´çš„é€»è¾‘ä¸å˜ã€‚</p><table><thead><tr><th>Win 10</th><th>WMWare</th><th>Centos7</th><th>å„ç§cupã€å†…å­˜ç½‘ç»œé¢é…ç½®+å„ç§è½¯ä»¶</th><th>è™šæ‹Ÿæœºå®ä¾‹</th></tr></thead></table><p>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯åŸºäºå®‰è£…åœ¨ä¸»æ“ä½œç³»ç»Ÿä¸Šçš„è™šæ‹Ÿæœºç®¡ç†ç³»ç»Ÿï¼ˆå¦‚ï¼šVirtualBox å’Œ VMWare ç­‰)ï¼Œåˆ›å»ºè™šæ‹Ÿæœºï¼ˆè™šæ‹Ÿå‡ºå„ç§ç¡¬ä»¶ï¼‰ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…ä»æ“ä½œç³»ç»Ÿï¼Œåœ¨ä»æ“ä½œç³»ç»Ÿä¸­å®‰è£…éƒ¨ç½²å„ç§åº”ç”¨ã€‚</p><p><img src="./../docker01/image-20240227230505748.png" alt=""></p><p><strong>è™šæ‹Ÿæœºçš„ç¼ºç‚¹ï¼š</strong></p><ol><li>èµ„æºå ç”¨å¤š</li><li>å†—ä½™æ­¥éª¤å¤š</li><li>å¯åŠ¨æ…¢</li></ol><p><strong>å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯</strong></p><p>ç”±äºå‰é¢è™šæ‹Ÿæœºå­˜åœ¨æŸäº›ç¼ºç‚¹ï¼ŒLinux å‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼š</p><p><font color="#3498db">Linux å®¹å™¨(Linux Containersï¼Œç¼©å†™ä¸º LXC)</font></p><p>Linux å®¹å™¨æ˜¯ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†éš”ç¦»å¼€çš„ä¸€ç³»åˆ—è¿›ç¨‹ï¼Œä»å¦ä¸€ä¸ªé•œåƒè¿è¡Œï¼Œå¹¶ç”±è¯¥é•œåƒæä¾›æ”¯æŒè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨æ–‡ä»¶ã€‚å®¹å™¨æä¾›çš„é•œåƒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå› è€Œåœ¨ä»å¼€å‘åˆ°æµ‹è¯•å†åˆ°ç”Ÿäº§çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½å…·æœ‰å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚</p><p><font color="#e74c3c">Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ</font>è€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚æœ‰äº†å®¹å™¨ï¼Œå°±å¯ä»¥å°†è½¯ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ä¸­ã€‚<font color="#3498db">å®¹å™¨ä¸è™šæ‹Ÿæœºä¸åŒï¼Œä¸éœ€è¦æ†ç»‘ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿ</font>ï¼Œåªéœ€è¦è½¯ä»¶å·¥ä½œæ‰€éœ€çš„åº“èµ„æºå’Œè®¾ç½®ã€‚ç³»ç»Ÿå› æ­¤è€Œå˜å¾—é«˜æ•ˆè½»é‡å¹¶ä¿è¯éƒ¨ç½²åœ¨ä»»ä½•ç¯å¢ƒä¸­çš„è½¯ä»¶éƒ½èƒ½å§‹ç»ˆå¦‚ä¸€åœ°è¿è¡Œã€‚</p><p><img src="./../docker01/image-20240227231020472.png" alt=""></p><p>Docker å®¹å™¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šå®ç°è™šæ‹ŸåŒ–ï¼Œç›´æ¥å¤ç”¨æœ¬åœ°ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¼ ç»Ÿ<br>è™šæ‹Ÿæœºåˆ™æ˜¯åœ¨ç¡¬ä»¶å±‚é¢å®ç°è™šæ‹ŸåŒ–ã€‚ä¸ä¼ ç»Ÿçš„è™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDocker ä¼˜åŠ¿ä½“ç°ä¸ºå¯åŠ¨é€Ÿ<br>åº¦å¿«ã€å ç”¨ä½“ç§¯å°ã€‚</p><p><strong>å¯¹æ¯”</strong></p><p><img src="./../docker01/image-20240227231135642.png" alt=""></p><p>æ¯”è¾ƒäº† Docker å’Œä¼ ç»Ÿè™šæ‹ŸåŒ–æ–¹å¼çš„ä¸åŒä¹‹å¤„ï¼š</p><ul><li>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ï¼›</li><li>å®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸<font color="#e74c3c">ä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿ</font>ã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚</li><li>æ¯ä¸ªå®¹å™¨ä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œæ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿ ï¼Œå®¹å™¨ä¹‹é—´è¿›ç¨‹ä¸ä¼šç›¸äº’å½±å“ï¼Œèƒ½åŒºåˆ†è®¡ç®—èµ„æºã€‚</li></ul><h2 id="Dockerå·¥ä½œåŸç†">Dockerå·¥ä½œåŸç†</h2><p>Docker æ˜¯ä¸€ä¸ª C/S æ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œä¼—å¤šæ¨¡å—å„å¸å…¶èŒã€‚</p><p>Docker è¿è¡Œçš„åŸºæœ¬æµç¨‹ä¸ºï¼š</p><ol><li>ç”¨æˆ·æ˜¯ä½¿ç”¨ Docker Client ä¸ Docker Daemon å»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚</li><li>Docker Daemon ä½œä¸º Docker æ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾› Docker Server çš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥å— Docker Client çš„è¯·æ±‚ã€‚</li><li>Docker Engine æ‰§è¡Œ Docker å†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ª Job çš„å¼çš„å­˜åœ¨ã€‚</li><li>Job çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ—¶ï¼Œåˆ™ä» Docker Registry ä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨ Graph driver å°†ä¸‹è½½é•œåƒä»¥ Graphçš„å½¢å¼å­˜å‚¨ã€‚</li><li>å½“éœ€è¦ä¸º Docker åˆ›å»ºç½‘æ ¼ç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘æ ¼ç®¡ç†é©±åŠ¨ Network driver åˆ›å»ºå¹¶é…ç›´ Docker å®¹å™¨ç½‘é“¬ç¯å¢ƒã€‚</li><li>å½“éœ€è¦é™åˆ¶ Docker å®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡ Exec driver æ¥å®Œæˆã€‚</li><li>Libcontainer æ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼ŒNetwork driver ä»¥åŠ Exec driver éƒ½æ˜¯é€šè¿‡ Libcontainer æ¥å®ç°å…·ä½“å¯¹å®¹å™¨è¿›è¡Œçš„æ“ä½œã€‚</li></ol><p><img src="./../docker01/image-20240228204606719.png" alt=""></p><h3 id="åº•å±‚åŸç†">åº•å±‚åŸç†</h3><p>ä¸ºä»€ä¹ˆ Docker ä¼šæ¯” VM è™šæ‹Ÿæœºå¿«</p><ol><li><p><strong>Docker æœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚</strong></p><p>ç”±äº Docker ä¸éœ€è¦ Hypervisor(è™šæ‹Ÿæœº)å®ç°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–,è¿è¡Œåœ¨ Docker å®¹å™¨ä¸Šçš„ç¨‹åºç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯å®é™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æºã€‚å› æ­¤åœ¨ CPUã€å†…å­˜åˆ©ç”¨ç‡ä¸Š Docker å°†ä¼šåœ¨æ•ˆç‡ä¸Šæœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚</p></li><li><p><strong>Docker åˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸,è€Œä¸éœ€è¦åŠ è½½æ“ä½œç³»ç»Ÿ OS å†…æ ¸</strong></p><p>å½“æ–°å»ºä¸€ä¸ªå®¹å™¨æ—¶, Docker ä¸éœ€è¦å’Œè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ã€‚è¿›è€Œé¿å…å¼•å¯»ã€åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸è¿”å›ç­‰æ¯”è¾ƒè´¹æ—¶è´¹èµ„æºçš„è¿‡ç¨‹,å½“æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶,è™šæ‹Ÿæœºè½¯ä»¶éœ€è¦åŠ è½½ OS,è¿”å›æ–°å»ºè¿‡ç¨‹æ˜¯åˆ†é’Ÿçº§åˆ«çš„ã€‚è€Œ Docker ç”±äºç›´æ¥åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿ,åˆ™çœç•¥äº†è¿”å›è¿‡ç¨‹,å› æ­¤æ–°å»ºä¸€ä¸ª Docker å®¹å™¨åªéœ€è¦å‡ ç§’é’Ÿã€‚</p></li></ol><p><img src="./../docker01/image-20240228220639407.png" alt=""></p><table><thead><tr><th></th><th>Docker å®¹å™¨</th><th>è™šæ‹Ÿæœº (VM)</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿ</td><td>ä¸å®¿ä¸»æœºå…±äº« OS</td><td>å®¿ä¸»æœº OS ä¸Šè¿è¡Œè™šæ‹Ÿæœº OS</td></tr><tr><td>å­˜å‚¨å¤§å°</td><td>é•œåƒå°ï¼Œä¾¿äºå­˜å‚¨ä¸ä¼ è¾“</td><td>é•œåƒåºå¤§ï¼ˆvmdkã€vdi ç­‰ï¼‰</td></tr><tr><td>è¿è¡Œæ€§èƒ½</td><td>å‡ ä¹æ— é¢å¤–æ€§èƒ½æŸå¤±</td><td>æ“ä½œç³»ç»Ÿé¢å¤–çš„ CPUã€å†…å­˜æ¶ˆè€—</td></tr><tr><td>ç§»æ¤æ€§</td><td>è½»ä¾¿ã€çµæ´»ï¼Œé€‚åº”äº Linux</td><td>ç¬¨é‡ï¼Œä¸è™šæ‹ŸåŒ–æŠ€æœ¯è€¦åˆåº¦é«˜</td></tr><tr><td>ç¡¬ä»¶äº²å’Œæ€§</td><td>é¢å‘è½¯ä»¶å¼€å‘è€…</td><td>é¢å‘ç¡¬ä»¶è¿ç»´è€…</td></tr><tr><td>éƒ¨ç½²é€Ÿåº¦</td><td>å¿«é€Ÿã€ç§’çº§</td><td>è¾ƒæ…¢ï¼Œ10s ä»¥ä¸Š</td></tr></tbody></table><h2 id="Dockerå®‰è£…">Dockerå®‰è£…</h2><p><a href="https://docs.docker.com/engine/install/ubuntu/">Ubuntu å®‰è£… Docker å®˜ç½‘</a></p><h3 id="å®‰è£…æ­¥éª¤">å®‰è£…æ­¥éª¤</h3><h4 id="Ubuntu">Ubuntu</h4><ol><li>å¸è½½åŸæœ‰çš„</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">pkg</span> <span class="token keyword">in</span> docker.io docker-doc <span class="token function">docker-compose</span> docker-compose-v2 podman-docker containerd runc<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> remove <span class="token variable">$pkg</span><span class="token punctuation">;</span> <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>è®¾ç½®é•œåƒæºï¼ˆä¸å®˜ç½‘æœ‰å¼‚ï¼‰</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Add Docker's official GPG key:</span><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ca-certificates <span class="token function">curl</span><span class="token function">sudo</span> <span class="token function">install</span> <span class="token parameter variable">-m</span> 0755 <span class="token parameter variable">-d</span> /etc/apt/keyrings<span class="token comment">## ä¸è¦ä½¿ç”¨å®˜æ–¹çš„é•œåƒåœ°å€</span><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="token parameter variable">-o</span> /etc/apt/keyrings/docker.asc<span class="token function">sudo</span> <span class="token function">chmod</span> a+r /etc/apt/keyrings/docker.asc<span class="token comment"># Add the repository to Apt sources: !!ç”¨é˜¿é‡Œäº‘åœ°å€</span><span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>  <span class="token string">"deb [arch=<span class="token variable"><span class="token variable">$(</span>dpkg --print-architecture<span class="token variable">)</span></span> signed-by=/etc/apt/keyrings/docker.asc] http://mirrors.aliyun.com/docker-ce/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">.</span> /etc/os-release <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$VERSION_CODENAME</span>"</span><span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>  <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null<span class="token function">sudo</span> <span class="token function">apt-get</span> update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å®‰è£…å¼•æ“</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>ç‰ˆæœ¬åŠæ ¡éªŒ</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> version<span class="token function">sudo</span> <span class="token function">docker</span> run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¸è½½</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl stop <span class="token function">docker</span><span class="token function">sudo</span> <span class="token function">apt-get</span> purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras <span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/docker <span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/containerd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="CentOS7">CentOS7</h4><ol><li>å¸è½½åŸæœ‰çš„</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum remove <span class="token function">docker</span> <span class="token punctuation">\</span>                  docker-client <span class="token punctuation">\</span>                  docker-client-latest <span class="token punctuation">\</span>                  docker-common <span class="token punctuation">\</span>                  docker-latest <span class="token punctuation">\</span>                  docker-latest-logrotate <span class="token punctuation">\</span>                  docker-logrotate <span class="token punctuation">\</span>                  docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>è®¾ç½®é•œåƒæº(ä½¿ç”¨é˜¿é‡Œäº‘)</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils<span class="token function">sudo</span> yum-config-manager --add-repo  http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å®‰è£…å¼•æ“</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4"><li>å¯åŠ¨</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5"><li>ç‰ˆæœ¬ä¸æ ¡éªŒ</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token parameter variable">--version</span><span class="token function">docker</span> run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¸è½½</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras<span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/docker<span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/containerd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ">é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</h2><p><img src="./../docker01/image-20240228215513948.png" alt=""></p><h2 id="Dockerå¸¸ç”¨å‘½ä»¤">Dockerå¸¸ç”¨å‘½ä»¤</h2><h3 id="å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤">å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start <span class="token function">docker</span> <span class="token comment">#å¯åŠ¨</span><span class="token function">sudo</span> systemctl stop <span class="token function">docker</span> <span class="token comment">#åœæ­¢</span><span class="token function">sudo</span> systemctl restart <span class="token function">docker</span> <span class="token comment">#é‡å¯</span><span class="token function">sudo</span> systemctl status <span class="token function">docker</span> <span class="token comment">#çŠ¶æ€</span><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> <span class="token comment">#å¼€æœºè‡ªå¯</span><span class="token function">sudo</span> systemctl <span class="token function">docker</span> info <span class="token comment">#æŸ¥çœ‹dockeræ¦‚è¦ä¿¡æ¯</span><span class="token function">sudo</span> systemctl <span class="token function">docker</span> <span class="token parameter variable">--help</span> <span class="token comment">#æ€»ä½“å¸®åŠ©</span><span class="token function">sudo</span> systemctl å…·ä½“å‘½ä»¤ <span class="token parameter variable">--htlp</span> <span class="token comment">#å…·ä½“å‘½ä»¤å¸®åŠ©</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é•œåƒå‘½ä»¤">é•œåƒå‘½ä»¤</h3><p><strong>docker images</strong></p><pre class="line-numbers language-none"><code class="language-none">REPOSITORY    TAG       IMAGE ID       CREATED         SIZEhello-world   latest    ee301c921b8a   10 months ago   9.14kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>REPOSITORY</td><td>è¡¨ç¤ºé•œåƒçš„ä»“åº“æº</td></tr><tr><td>TAG</td><td>é•œåƒçš„æ ‡ç­¾ç‰ˆæœ¬å·</td></tr><tr><td>IMAGE ID</td><td>é•œåƒID</td></tr><tr><td>CREATED</td><td>é•œåƒåˆ›å»ºæ—¶é—´</td></tr><tr><td>SIZE</td><td>é•œåƒå¤§å°</td></tr></tbody></table><blockquote><p>åŒä¸€ä»“åº“æºå¯ä»¥æœ‰å¤šä¸ª TAGç‰ˆæœ¬ï¼Œä»£è¡¨è¿™ä¸ªä»“åº“æºçš„ä¸åŒä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨ REPOSITORY:TAG æ¥å®šä¹‰ä¸åŒçš„é•œåƒã€‚<br>å¦‚æœä½ ä¸æŒ‡å®šä¸€ä¸ªé•œåƒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œä¾‹å¦‚ä½ åªä½¿ç”¨ ubuntuï¼Œdocker å°†é»˜è®¤ä½¿ç”¨ ubuntu:latest é•œåƒ</p><p>OPTIONSè¯´æ˜ï¼š</p><p>-a :åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼ˆå«å†å²æ˜ åƒå±‚ï¼‰<br>-q :åªæ˜¾ç¤ºé•œåƒIDã€‚</p></blockquote><p><strong>docker search æŸä¸ªXXXé•œåƒåå­—</strong></p><pre class="line-numbers language-none"><code class="language-none">NAME                                DESCRIPTION                                     STARS     OFFICIALredis                               Redis is an open source key-value store thatâ€¦   12678     [OK]redislabs&#x2F;redisinsight              RedisInsight - The GUI for Redis                97        redislabs&#x2F;redisearch                Redis With the RedisSearch module pre-loadedâ€¦   62        redis&#x2F;redis-stack-server            redis-stack-server installs a Redis server wâ€¦   68        redis&#x2F;redis-stack                   redis-stack installs a Redis server with addâ€¦   99        .......<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NAME</td><td>é•œåƒåç§°</td></tr><tr><td>DESCRIPTION</td><td>é•œåƒè¯´æ˜</td></tr><tr><td>STARS</td><td>ç‚¹èµæ•°é‡</td></tr><tr><td>OFFICIAL</td><td>æ˜¯å¦æ˜¯å®˜æ–¹çš„</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ä¸¾ä¾‹</span><span class="token function">docker</span> search <span class="token parameter variable">--limit</span> <span class="token number">5</span> redis <span class="token comment">#ç½—åˆ—5æ¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>docker pull æŸä¸ªXXXé•œåƒåå­—</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull é•œåƒåå­—<span class="token punctuation">[</span>:TAG<span class="token punctuation">]</span><span class="token comment"># æ²¡æœ‰TAGå°±æ˜¯æœ€æ–°, ç­‰ä»·äº docker pull é•œåƒåå­—:latest</span><span class="token comment">#ä¸¾ä¾‹</span><span class="token function">docker</span> pull ubuntu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>docker system df</strong></p><p>æŸ¥çœ‹é•œåƒ/å®¹å™¨/æ•°æ®å·æ‰€å çš„ç©ºé—´</p><pre class="line-numbers language-none"><code class="language-none">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLEImages          2         1         65.6MB    65.59MB (99%)Containers      2         0         0B        0BLocal Volumes   0         0         0B        0BBuild Cache     0         0         0B        0B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>docker rmi æŸä¸ªXXXé•œåƒåå­—/ID</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ä¸¾ä¾‹</span><span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> ee301c921b8a<span class="token comment">#åˆ é™¤å¤šä¸ª</span><span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> ee301c921b8a ee301c921b8a<span class="token comment">#åˆ é™¤å…¨éƒ¨</span><span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images <span class="token parameter variable">-qa</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¢è¯•é¢˜ï¼šè°ˆè°ˆ docker è™šæ‚¬é•œåƒæ˜¯ä»€ä¹ˆ?</p><p><font color="#e74c3c">æ˜¯ä»€ä¹ˆ?</font></p><p>ä»“åº“åã€æ ‡ç­¾éƒ½æ˜¯ &lt;none&gt; çš„é•œåƒï¼Œä¿—ç§°è™šæ‚¬é•œåƒdangling image</p><p><font color="#e74c3c">é•¿ä»€ä¹ˆæ ·?</font></p><p><img src="./../docker01/image-20240228224541838.png" alt=""></p><h3 id="å®¹å™¨å‘½ä»¤">å®¹å™¨å‘½ä»¤</h3><p><strong>æ–°å»º+å¯åŠ¨å®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGES <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>OPTIONSè¯´æ˜</p><table><thead><tr><th>OPTIONS</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>â€“name=â€œæ–°å®¹å™¨åå­—â€</td><td>ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåå­—</td></tr><tr><td>-d</td><td>åå°è¿è¡Œå®¹å™¨å¹¶è¿”å›å®¹å™¨ IDï¼Œä¹Ÿå³å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨(åå°è¿è¡Œ)</td></tr><tr><td>-i</td><td>ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨</td></tr><tr><td>-t</td><td>ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨; ä¹Ÿå³å¯åŠ¨äº¤äº’å¼å®¹å™¨(å‰å°æœ‰ä¼ªç»ˆç«¯ï¼Œç­‰å¾…äº¤äº’)</td></tr><tr><td>-P</td><td>éšæœºç«¯å£æ˜ å°„ï¼Œå¤§å†™ P</td></tr><tr><td>-p</td><td>æŒ‡å®šç«¯å£æ˜ å°„ï¼Œå°å†™ p</td></tr></tbody></table><table><thead><tr><th>ä¸¾ä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-p hostPort:containerPort</td><td>ç«¯å£æ˜ å°„ -p</td></tr><tr><td>-p ip:hostPort:containerPort</td><td>é…ç½®ç›‘å¬åœ°å€ -p 10.0.0.100:8080:80</td></tr><tr><td>-p ip::containerPort</td><td>éšæœºåˆ†é…ç«¯å£ -p 10.0.0.100::80</td></tr><tr><td>-p hostPort:containerPort:udp</td><td>æŒ‡å®šåè®® -p 8080:80:tcp</td></tr><tr><td>-p 81:80 -p 443:443</td><td>æŒ‡å®šå¤šä¸ª</td></tr></tbody></table><p>å¯åŠ¨äº¤äº’å¼å®¹å™¨(å‰å°å‘½ä»¤è¡Œ)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> ubuntu /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="./../docker01/image-20240229154005495.png" alt=""></p><p>å‚æ•°è¯´æ˜</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-i</td><td>äº¤äº’å¼æ“ä½œ</td></tr><tr><td>-t</td><td>ç»ˆç«¯</td></tr><tr><td>centos</td><td>centos</td></tr><tr><td>/bin/bash</td><td>æ”¾åœ¨é•œåƒååé¢çš„æ˜¯å‘½ä»¤, è¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shell, å› æ­¤ä½¿ç”¨çš„æ˜¯ /bin/bash; è¦é€€å‡ºç»ˆç«¯, ç›´æ¥è¾“å…¥ exit</td></tr></tbody></table><p><strong>åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>OPTIONS è¯´æ˜</p><table><thead><tr><th>OPTIONS</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-a</td><td>åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ + å†å²ä¸Šè¿è¡Œè¿‡çš„</td></tr><tr><td>-l</td><td>æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨</td></tr><tr><td>-n</td><td>æ˜¾ç¤ºæœ€è¿‘ n ä¸ªåˆ›å»ºçš„å®¹å™¨</td></tr><tr><td>-q</td><td>é™é»˜æ¨¡å¼, åªæ˜¾ç¤ºå®¹å™¨ç¼–å·</td></tr></tbody></table><p><strong>é€€å‡ºå®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span> <span class="token comment">#runè¿›å»å®¹å™¨, exité€€å‡º, å®¹å™¨åœæ­¢</span>ctrl + p + q <span class="token comment">#runè¿›å»å®¹å™¨, ctrl+p+qé€€å‡º, å®¹å™¨ä¸åœæ­¢</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>å¯åŠ¨å·²åœæ­¢è¿è¡Œçš„å®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> start å®¹å™¨IDæˆ–è€…å®¹å™¨å<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>é‡å¯å®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> restart å®¹å™¨IDæˆ–è€…å®¹å™¨å<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>åœæ­¢å®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> stop å®¹å™¨IDæˆ–è€…å®¹å™¨å<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å¼ºåˆ¶åœæ­¢å®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">kill</span> å®¹å™¨IDæˆ–å®¹å™¨å<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>åˆ é™¤å·²åœæ­¢çš„å®¹å™¨</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">rm</span> å®¹å™¨ID<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªå®¹å™¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> -q<span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">docker</span> <span class="token function">rm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="é‡è¦ğŸ‘">é‡è¦ğŸ‘</h3><ol><li><p>æœ‰é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œè¿™æ˜¯æ ¹æœ¬å‰æ(ä¸‹è½½ä¸€ä¸ªRedis6.0.8é•œåƒæ¼”ç¤º)</p></li><li><p>å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨(åå°æœåŠ¡å™¨)</p><p>åœ¨å¤§éƒ¨åˆ†çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ› docker çš„æœåŠ¡æ˜¯åœ¨åå°è¿è¡Œçš„ï¼Œ æˆ‘ä»¬å¯ä»¥è¿‡ -d æŒ‡å®šå®¹å™¨çš„åå°è¿è¡Œæ¨¡å¼ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> å®¹å™¨å<span class="token comment">#ä½¿ç”¨é•œåƒcentos:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> redis:6.0.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> logs å®¹å™¨ID<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">top</span> å®¹å™¨ID<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> inspect å®¹å™¨ID<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’ğŸ‘</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> å®¹å™¨ID bashShell<span class="token comment">#ä¸¾ä¾‹</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 30c6aa783b4b /bin/bash<span class="token function">docker</span> attach å®¹å™¨ID <span class="token comment">#ç”Ÿäº§ä¸­ä¸è¦ä½¿ç”¨</span><span class="token comment">#ä¸¾ä¾‹</span><span class="token function">docker</span> attach 30c6aa783b4b<span class="token comment">#åŒºåˆ«: ä½¿ç”¨attachåå†ç”¨exité€€å‡ºä¼šå…³é—­å®¹å™¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">cp</span> å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„<span class="token comment">#ä¸¾ä¾‹</span><span class="token function">docker</span> <span class="token function">cp</span> ff4b9748d952:/data/1.txt ./<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨ğŸ‘</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> å¯¼å‡ºå®¹å™¨çš„å†…å®¹ç•™ä½œä¸ºä¸€ä¸ªtarå½’æ¡£æ–‡ä»¶<span class="token punctuation">[</span>å¯¹åº”importå‘½ä»¤<span class="token punctuation">]</span><span class="token function">import</span> ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿå†å¯¼å…¥ä¸ºé•œåƒ<span class="token punctuation">[</span>å¯¹åº”export<span class="token punctuation">]</span><span class="token comment">#ä¸¾ä¾‹</span><span class="token function">docker</span> <span class="token builtin class-name">export</span> 30c6aa783b4b <span class="token operator">></span> abcd.tar<span class="token function">cat</span> abcd.tar <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - dee/ubuntu:3.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="å°æ€»ç»“">å°æ€»ç»“</h3><p><img src="./../docker01/image-20240229214920722.png" alt=""></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">attach    Attach to a running container                 <span class="token comment"># å½“å‰ shell ä¸‹ attach è¿æ¥æŒ‡å®šè¿è¡Œé•œåƒ</span>build     Build an image from a Dockerfile              <span class="token comment"># é€šè¿‡ Dockerfile å®šåˆ¶é•œåƒ</span>commit    Create a new image from a container changes   <span class="token comment"># æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ</span><span class="token function">cp</span>        Copy files/folders from the containers filesystem to the <span class="token function">host</span> path   <span class="token comment">#ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¿ä¸»æœºä¸­</span>create    Create a new container                        <span class="token comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒ runï¼Œä½†ä¸å¯åŠ¨å®¹å™¨</span><span class="token function">diff</span>      Inspect changes on a container's filesystem   <span class="token comment"># æŸ¥çœ‹ docker å®¹å™¨å˜åŒ–</span>events    Get real <span class="token function">time</span> events from the server          <span class="token comment"># ä» docker æœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶</span><span class="token builtin class-name">exec</span>      Run a <span class="token builtin class-name">command</span> <span class="token keyword">in</span> an existing container        <span class="token comment"># åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸Šè¿è¡Œå‘½ä»¤</span><span class="token builtin class-name">export</span>    Stream the contents of a container as a <span class="token function">tar</span> archive   <span class="token comment"># å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶[å¯¹åº” import ]</span><span class="token function">history</span>   Show the <span class="token function">history</span> of an image                  <span class="token comment"># å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å²</span>images    List images                                   <span class="token comment"># åˆ—å‡ºç³»ç»Ÿå½“å‰é•œåƒ</span><span class="token function">import</span>    Create a new filesystem image from the contents of a tarball <span class="token comment"># ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿæ˜ åƒ[å¯¹åº”export]</span>info      Display system-wide information               <span class="token comment"># æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯</span>inspect   Return low-level information on a container   <span class="token comment"># æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</span><span class="token function">kill</span>      Kill a running container                      <span class="token comment"># kill æŒ‡å®š docker å®¹å™¨</span>load      Load an image from a <span class="token function">tar</span> archive              <span class="token comment"># ä»ä¸€ä¸ª tar åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº” save]</span>login     Register or Login to the <span class="token function">docker</span> registry server    <span class="token comment"># æ³¨å†Œæˆ–è€…ç™»é™†ä¸€ä¸ª docker æºæœåŠ¡å™¨</span><span class="token builtin class-name">logout</span>    Log out from a Docker registry server          <span class="token comment"># ä»å½“å‰ Docker registry é€€å‡º</span>logs      Fetch the logs of a container                 <span class="token comment"># è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯</span>port      Lookup the public-facing port <span class="token function">which</span> is NAT-ed to PRIVATE_PORT    <span class="token comment"># æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”çš„å®¹å™¨å†…éƒ¨æºç«¯å£</span>pause     Pause all processes within a container        <span class="token comment"># æš‚åœå®¹å™¨</span><span class="token function">ps</span>        List containers                               <span class="token comment"># åˆ—å‡ºå®¹å™¨åˆ—è¡¨</span>pull      Pull an image or a repository from the <span class="token function">docker</span> registry server   <span class="token comment"># ä»dockeré•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒ</span>push      Push an image or a repository to the <span class="token function">docker</span> registry server    <span class="token comment"># æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³dockeræºæœåŠ¡å™¨</span>restart   Restart a running container                   <span class="token comment"># é‡å¯è¿è¡Œçš„å®¹å™¨</span><span class="token function">rm</span>        Remove one or <span class="token function">more</span> containers                 <span class="token comment"># ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</span>rmi       Remove one or <span class="token function">more</span> images       <span class="token comment"># ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ– -f å¼ºåˆ¶åˆ é™¤]</span>run       Run a <span class="token builtin class-name">command</span> <span class="token keyword">in</span> a new container              <span class="token comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤</span>save      Save an image to a <span class="token function">tar</span> archive                <span class="token comment"># ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ª tar åŒ…[å¯¹åº” load]</span>search    Search <span class="token keyword">for</span> an image on the Docker Hub         <span class="token comment"># åœ¨ docker hub ä¸­æœç´¢é•œåƒ</span>start     Start a stopped containers                    <span class="token comment"># å¯åŠ¨å®¹å™¨</span>stop      Stop a running containers                     <span class="token comment"># åœæ­¢å®¹å™¨</span>tag       Tag an image into a repository                <span class="token comment"># ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾</span><span class="token function">top</span>       Lookup the running processes of a container   <span class="token comment"># æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯</span>unpause   Unpause a paused container                    <span class="token comment"># å–æ¶ˆæš‚åœå®¹å™¨</span>version   Show the <span class="token function">docker</span> version information           <span class="token comment"># æŸ¥çœ‹ docker ç‰ˆæœ¬å·</span><span class="token function">wait</span>      Block <span class="token keyword">until</span> a container stops, <span class="token keyword">then</span> print its <span class="token builtin class-name">exit</span> code   <span class="token comment"># æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Dockeré•œåƒ">Dockeré•œåƒ</h2><h3 id="æ¦‚å¿µ">æ¦‚å¿µ</h3><p><strong>æ¦‚è¿°</strong></p><p>Docker é•œåƒæ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½å½¢æˆä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒ(åŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶éœ€è¦çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ç­‰)ï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯ image é•œåƒæ–‡ä»¶ã€‚</p><p>åªæœ‰é€šè¿‡è¿™ä¸ªé•œåƒæ–‡ä»¶æ‰èƒ½ç”Ÿæˆ Docker å®¹å™¨å®ä¾‹ï¼ˆç±»ä¼¼ Java ä¸­ new å‡ºæ¥ä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚</p><p><strong>UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰</strong></p><p>UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒ<font color=red>å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ </font>ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚<font color="#3498db">é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿</font>ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚</p><p>ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•</p><p><strong>Dockeré•œåƒåŠ è½½åŸç†</strong></p><p>dockerçš„é•œåƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»ŸUnionFSã€‚</p><p>bootfs(boot file system) ä¸»è¦åŒ…å« bootloader å’Œ kernel, bootloader ä¸»è¦æ˜¯å¼•å¯¼åŠ è½½ kernel, Linux åˆšå¯åŠ¨æ—¶ä¼šåŠ è½½ bootfs æ–‡ä»¶ç³»ç»Ÿï¼Œ<font color=red>åœ¨ Docker é•œåƒçš„æœ€åº•å±‚æ˜¯å¼•å¯¼æ–‡ä»¶ç³»ç»Ÿ bootfs</font>ã€‚è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„ Linux/Unix ç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å« boot åŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“ boot åŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”± bootfs è½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½ bootfsã€‚</p><p>rootfs (root file system) ï¼Œåœ¨ bootfs ä¹‹ä¸Šã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹ Linux ç³»ç»Ÿä¸­çš„ /dev, /proc, /bin, /etc ç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚rootfs å°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚ Ubuntuï¼ŒCentOS ç­‰ç­‰ã€‚</p><p><img src="./../docker01/image-20240229161700627.png" alt=""></p><p><font color="#3498db">å¹³æ—¶æˆ‘ä»¬å®‰è£…è¿›è™šæ‹Ÿæœºçš„CentOSéƒ½æ˜¯å¥½å‡ ä¸ªGï¼Œä¸ºä»€ä¹ˆdockerè¿™é‡Œæ‰200Mï¼Ÿï¼Ÿ</font></p><p>å¯¹äºä¸€ä¸ªç²¾ç®€çš„ OSï¼Œrootfs å¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨ Host çš„ kernelï¼Œè‡ªå·±åªéœ€è¦æä¾› rootfs å°±è¡Œäº†ã€‚ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„ linux å‘è¡Œç‰ˆ, bootfs åŸºæœ¬æ˜¯ä¸€è‡´çš„, rootfs ä¼šæœ‰å·®åˆ«, å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…¬ç”¨ bootfsã€‚</p><p><font color="#3498db">ä¸ºä»€ä¹ˆ Docker é•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢</font></p><p>é•œåƒåˆ†å±‚æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å…±äº«èµ„æºï¼Œæ–¹ä¾¿å¤åˆ¶è¿ç§»ï¼Œå°±æ˜¯ä¸ºäº†å¤ç”¨ã€‚</p><p>æ¯”å¦‚è¯´æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„ base é•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆ Docker Host åªéœ€åœ¨ç£ç›˜ä¸Šä¿å­˜ä¸€ä»½ base é•œåƒï¼›</p><p>åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€åŠ è½½ä¸€ä»½ base é•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ã€‚è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚</p><p><strong>é‡ç‚¹ç†è§£</strong></p><p><font color=red>Dockeré•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œå®¹å™¨å±‚æ˜¯å¯å†™çš„ã€‚</font>å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ã€‚ è¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä½œâ€œå®¹å™¨å±‚â€ï¼Œâ€œå®¹å™¨å±‚â€ä¹‹ä¸‹çš„éƒ½å«â€œé•œåƒå±‚â€ã€‚</p><p>æ‰€æœ‰å¯¹å®¹å™¨çš„æ”¹åŠ¨ - æ— è®ºæ·»åŠ ã€åˆ é™¤ã€è¿˜æ˜¯ä¿®æ”¹æ–‡ä»¶éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­ã€‚åªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå®¹å™¨å±‚ä¸‹é¢çš„æ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ã€‚</p><p><img src="./../docker01/image-20240229161843370.png" alt=""></p><h3 id="Dockeré•œåƒcommit">Dockeré•œåƒcommit</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#docker commit æäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒ</span><span class="token function">docker</span> commit <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> å®¹å™¨ID <span class="token punctuation">[</span>REPOSITORY<span class="token punctuation">[</span>:TAG<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token function">docker</span> commit <span class="token parameter variable">-m</span><span class="token operator">=</span><span class="token string">"æäº¤çš„æè¿°ä¿¡æ¯"</span> <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">"ä½œè€…"</span> å®¹å™¨ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå:<span class="token punctuation">[</span>æ ‡ç­¾å<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>OPTIONS</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-a</td><td>æäº¤çš„é•œåƒä½œè€…</td></tr><tr><td>-m</td><td>æäº¤æ—¶çš„è¯´æ˜æ–‡å­—</td></tr></tbody></table><p><strong>ä¸¾ä¾‹</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1.ä»Hubä¸Šä¸‹è½½Ubuntué•œåƒåˆ°æœ¬åœ°å¹¶æˆåŠŸè¿è¡Œ</span><span class="token comment"># 2.å¤–ç½‘è¿é€šçš„æƒ…å†µä¸‹, å®‰è£…</span><span class="token function">apt</span> update<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">vim</span><span class="token comment"># 3.å®‰è£…å®Œæˆå, commit æ–°çš„é•œåƒ</span><span class="token function">docker</span> commit <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">"dee"</span> <span class="token parameter variable">-m</span><span class="token operator">=</span><span class="token string">"add vim"</span> 6fb85ed2da66 dee/dubuntu:1.1<span class="token comment"># 4.æŸ¥çœ‹åˆšæ‰åˆ¶ä½œçš„é•œåƒ</span><span class="token function">docker</span> images<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ€»ç»“</strong></p><p>Docker ä¸­çš„é•œåƒåˆ†å±‚ï¼Œæ”¯æŒé€šè¿‡æ‰©å±•ç°æœ‰é•œåƒï¼Œåˆ›å»ºæ–°çš„é•œåƒã€‚ç±»ä¼¼ Java ç»§æ‰¿äºä¸€ä¸ª Base åŸºç¡€ç±»ï¼Œè‡ªå·±å†æŒ‰éœ€æ‰©å±•ã€‚</p><p>æ–°é•œåƒæ˜¯ä» base é•œåƒä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ç°æœ‰é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€å±‚</p><p><img src="./../docker01/image-20240229230415092.png" alt=""></p><h2 id="æœ¬åœ°é•œåƒå‘å¸ƒåˆ°é˜¿é‡Œäº‘">æœ¬åœ°é•œåƒå‘å¸ƒåˆ°é˜¿é‡Œäº‘</h2><p><img src="./../docker01/image-20240229230900054.png" alt="æµç¨‹å›¾"></p><p><strong>æ¨é€æµç¨‹</strong></p><p><img src="./../docker01/image-20240229231700385.png" alt="å‘½åç©ºé—´"></p><p><img src="./../docker01/image-20240229231831669.png" alt="é•œåƒä»“åº“"></p><p>è¿›å…¥ç®¡ç†ç•Œé¢è·å¾—è„šæœ¬</p><p><img src="./../docker01/image-20240229232046098.png" alt=""></p><p><strong>å°†é•œåƒæ¨é€åˆ°Registry</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ç¤ºä¾‹</span><span class="token function">docker</span> tag f41bfd155605 registry.cn-hangzhou.aliyuncs.com/saddyfire/deeubuntu:1.1<span class="token function">docker</span> push registry.cn-hangzhou.aliyuncs.com/saddyfire/deeubuntu:1.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>ä»Registryä¸­æ‹‰å–é•œåƒ</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull registry.cn-hangzhou.aliyuncs.com/saddyfire/deeubuntu:1.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æœ¬åœ°é•œåƒå‘å¸ƒåˆ°ç§æœ‰åº“">æœ¬åœ°é•œåƒå‘å¸ƒåˆ°ç§æœ‰åº“</h2><ol><li><p>ä¸‹è½½é•œåƒDocker Registry</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è¿è¡Œç§æœ‰åº“Registryï¼Œç›¸å½“äºæœ¬åœ°æœ‰ä¸ªç§æœ‰Docker hub</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000  <span class="token parameter variable">-v</span> /ddocker/myregistry/:/tmp/registry <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><strong>ç¤ºä¾‹</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1.è¿è¡Œä¸€ä¸ªUbuntuå®¹å™¨, ä¸‹è½½ifconfig</span><span class="token function">apt</span> update<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> net-tools<span class="token comment"># 2.commitæ–°é•œåƒ</span><span class="token function">docker</span> commit <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">"dee"</span> <span class="token parameter variable">-m</span><span class="token operator">=</span><span class="token string">"add ifconfig"</span> 6fb85ed2da66 dee/dubuntu:1.5<span class="token comment"># 3.curléªŒè¯ç§æœåº“ä¸Šæœ‰ä»€ä¹ˆé•œåƒ</span><span class="token function">curl</span> <span class="token parameter variable">-XGET</span> <span class="token number">192.168</span>.1.111:5000/v2/_catalog<span class="token comment"># 4.å°†æ–°é•œåƒdee/dubuntu:1.5ä¿®æ”¹æˆç¬¦åˆç§æœè§„èŒƒçš„Tag</span><span class="token function">docker</span> tag dee/dubuntu:1.5 <span class="token number">192.168</span>.1.111:5000/dubuntu:1.5<span class="token comment"># 5.ä¿®æ”¹é…ç½®æ–‡ä»¶æ”¯æŒhttp</span><span class="token function">cat</span> /etc/docker/daemon.json<span class="token comment">####è¿½åŠ </span><span class="token punctuation">&#123;</span>  <span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"https://jcgnocdi.mirror.aliyuncs.com"</span><span class="token punctuation">]</span>,  <span class="token string">"insecure-registries"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"192.168.1.111:5000"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token comment">####ç„¶åé‡å¯</span><span class="token comment"># 6.pushè‡³ç§æœ</span><span class="token function">docker</span> push <span class="token number">192.168</span>.1.111:5000/dubuntu:1.5<span class="token comment"># 7.curléªŒè¯ç§æœ</span><span class="token function">curl</span> <span class="token parameter variable">-XGET</span> <span class="token number">192.168</span>.1.111:5000/v2/_catalog<span class="token comment"># 8.pullåˆ°æœ¬åœ°è¿è¡Œ</span><span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> <span class="token number">192.168</span>.1.111:5000/dubuntu:1.5 <span class="token comment">#å…ˆåˆ æœ¬åœ°</span><span class="token function">docker</span> pull <span class="token number">192.168</span>.1.111:5000/dubuntu:1.5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Dockerå®¹å™¨æ•°æ®å·">Dockerå®¹å™¨æ•°æ®å·</h2><h2 id="Dockerå¸¸è§„å®‰è£…ç®€ä»‹">Dockerå¸¸è§„å®‰è£…ç®€ä»‹</h2>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-08-è¡Œä¸ºå‹æ¨¡å¼ â…¡</title>
      <link href="/2024/02/25/design-pattern-behavioral2/"/>
      <url>/2024/02/25/design-pattern-behavioral2/</url>
      
        <content type="html"><![CDATA[<h1>è¡Œä¸ºå‹æ¨¡å¼ â…¡</h1><h2 id="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p><strong>å®šä¹‰ï¼š</strong></p><p>åˆè¢«ç§°ä¸ºå‘å¸ƒ-è®¢é˜…ï¼ˆPublish/Subscribeï¼‰æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚</p><h3 id="ç»“æ„">ç»“æ„</h3><p>åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­æœ‰å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li>Subjectï¼šæŠ½è±¡ä¸»é¢˜ï¼ˆæŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼‰ï¼ŒæŠ½è±¡ä¸»é¢˜è§’è‰²æŠŠæ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…ï¼ŒæŠ½è±¡ä¸»é¢˜æä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ã€‚</li><li>ConcreteSubjectï¼šå…·ä½“ä¸»é¢˜ï¼ˆå…·ä½“è¢«è§‚å¯Ÿè€…ï¼‰ï¼Œè¯¥è§’è‰²å°†æœ‰å…³çŠ¶æ€å­˜å…¥å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼Œåœ¨å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å‘é€é€šçŸ¥ã€‚</li><li>Observerï¼šæŠ½è±¡è§‚å¯Ÿè€…ï¼Œæ˜¯è§‚å¯Ÿè€…çš„æŠ½è±¡ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ›´æ–°æ¥å£ï¼Œä½¿å¾—åœ¨å¾—åˆ°ä¸»é¢˜æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±ã€‚</li><li>ConcrereObserverï¼šå…·ä½“è§‚å¯Ÿè€…ï¼Œå®ç°æŠ½è±¡è§‚å¯Ÿè€…å®šä¹‰çš„æ›´æ–°æ¥å£ï¼Œä»¥ä¾¿åœ¨å¾—åˆ°ä¸»é¢˜æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªèº«çš„çŠ¶æ€ã€‚</li></ul><h3 id="æ¡ˆä¾‹å®ç°">æ¡ˆä¾‹å®ç°</h3><p>ã€ä¾‹ã€‘å¾®ä¿¡å…¬ä¼—å·</p><p>åœ¨ä½¿ç”¨å¾®ä¿¡å…¬ä¼—å·æ—¶ï¼Œå¤§å®¶éƒ½ä¼šæœ‰è¿™æ ·çš„ä½“éªŒï¼Œå½“ä½ å…³æ³¨çš„å…¬ä¼—å·ä¸­æœ‰æ–°å†…å®¹æ›´æ–°çš„è¯ï¼Œå®ƒå°±ä¼šæ¨é€ç»™å…³æ³¨å…¬ä¼—å·çš„å¾®ä¿¡ç”¨æˆ·ç«¯ã€‚æˆ‘ä»¬ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥æ¨¡æ‹Ÿè¿™æ ·çš„åœºæ™¯ï¼Œå¾®ä¿¡ç”¨æˆ·å°±æ˜¯è§‚å¯Ÿè€…ï¼Œå¾®ä¿¡å…¬ä¼—å·æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œæœ‰å¤šä¸ªçš„å¾®ä¿¡ç”¨æˆ·å…³æ³¨äº†ç¨‹åºçŒ¿è¿™ä¸ªå…¬ä¼—å·ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Subject {<< interface >>+ attach(Observer observer) void+ detach(Observer observer) void+ notify(String message) void}class SubscriptionSubject {- weixinUserlist : List~Observer~+ attach(Observer observer) void+ detach(Observer observer) void+ notify(String message) void}class Observer {<< interface >>+ update(String message) void}class WeixinUser {- name : String+ WeixinUser(String name)+ update(String message) void}Subject <|.. SubscriptionSubjectObserver --o SubscriptionSubjectObserver <|.. WeixinUser</pre><p><strong>æŠ½è±¡è§‚å¯Ÿè€…ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æŠ½è±¡ä¸»é¢˜è§’è‰²ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ·»åŠ è®¢é˜…è€…(æ·»åŠ è§‚å¯Ÿè€…å¯¹è±¡)</span>    <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ é™¤è®¢é˜…è€…</span>    <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//é€šçŸ¥è®¢é˜…è€…æ›´æ–°æ¶ˆæ¯</span>    <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“ä¸»é¢˜è§’è‰²ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubscriptionSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span><span class="token punctuation">&#123;</span>    <span class="token comment">//å®šä¹‰ä¸€ä¸ªé›†åˆ, ç”¨æ¥å­˜å‚¨å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">></span></span> weixinUserList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        weixinUserList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        weixinUserList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//éå†é›†åˆ</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Observer</span> observer <span class="token operator">:</span> weixinUserList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//è°ƒç”¨è§‚å¯Ÿè€…å¯¹è±¡ä¸­çš„updateæ–¹æ³•</span>            observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“è§‚å¯Ÿè€…è§’è‰²ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeiXinUser</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span><span class="token punctuation">&#123;</span>    <span class="token comment">//å¾®ä¿¡å</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">WeiXinUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.åˆ›å»ºå…¬ä¼—å·å¯¹è±¡</span>        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubscriptionSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.è®¢é˜…å…¬ä¼—å·</span>        subject<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WeiXinUser</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        subject<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WeiXinUser</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        subject<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WeiXinUser</span><span class="token punctuation">(</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.å…¬ä¼—å·æ›´æ–°, å‘å‡ºæ¶ˆæ¯ç»™è®¢é˜…è€…(è§‚å¯Ÿè€…å¯¹è±¡)</span>        subject<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token string">"æµ‹è¯•æ¶ˆæ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">å¼ ä¸‰-æµ‹è¯•æ¶ˆæ¯æå››-æµ‹è¯•æ¶ˆæ¯ç‹äº”-æµ‹è¯•æ¶ˆæ¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li>é™ä½äº†ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸¤è€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆå…³ç³»ã€‚</li><li>è¢«è§‚å¯Ÿè€…å‘é€é€šçŸ¥ï¼Œæ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°ä¿¡æ¯ã€å¯ä»¥å®ç°å¹¿æ’­æœºåˆ¶ã€‘</li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li>å¦‚æœè§‚å¯Ÿè€…éå¸¸å¤šçš„è¯ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è§‚å¯Ÿè€…æ”¶åˆ°è¢«è§‚å¯Ÿè€…å‘é€çš„é€šçŸ¥ä¼šè€—æ—¶</li><li>å¦‚æœè¢«è§‚å¯Ÿè€…æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œé‚£ä¹ˆè¢«è§‚å¯Ÿè€…å‘é€é€šçŸ¥ä¼šä½¿è§‚å¯Ÿè€…å¾ªç¯è°ƒç”¨ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ</li></ul><h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><ul><li>å¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ä¼šå½±å“å…¶ä»–å¯¹è±¡ã€‚</li><li>å½“ä¸€ä¸ªæŠ½è±¡æ¨¡å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–äºå¦ä¸€æ–¹é¢æ—¶ã€‚</li></ul><h3 id="JDK-ä¸­æä¾›çš„å®ç°">JDK ä¸­æä¾›çš„å®ç°</h3><p>åœ¨ Java ä¸­ï¼Œé€šè¿‡ java.util.Observable ç±»å’Œ java.util.Observer æ¥å£å®šä¹‰äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œåªè¦å®ç°å®ƒä»¬çš„å­ç±»å°±å¯ä»¥ç¼–å†™è§‚å¯Ÿè€…æ¨¡å¼å®ä¾‹ã€‚</p><p><strong>1ï¼ŒObservableç±»</strong></p><p>Observable ç±»æ˜¯æŠ½è±¡ç›®æ ‡ç±»ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ï¼Œå®ƒæœ‰ä¸€ä¸ª Vector é›†åˆæˆå‘˜å˜é‡ï¼Œç”¨äºä¿å­˜æ‰€æœ‰è¦é€šçŸ¥çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä¸‹é¢æ¥ä»‹ç»å®ƒæœ€é‡è¦çš„ 3 ä¸ªæ–¹æ³•ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Observable</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">private</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">></span></span> obs<span class="token punctuation">;</span>    <span class="token comment">/** Construct an Observable with zero Observers. */</span>    <span class="token keyword">public</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        obs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>void addObserver(Observer o) æ–¹æ³•ï¼šç”¨äºå°†æ–°çš„è§‚å¯Ÿè€…å¯¹è±¡æ·»åŠ åˆ°é›†åˆä¸­ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obs<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        obs<span class="token punctuation">.</span><span class="token function">addElement</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>void notifyObservers(Object arg) æ–¹æ³•ï¼šè°ƒç”¨é›†åˆä¸­çš„æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡çš„ updateæ–¹æ³•ï¼Œé€šçŸ¥å®ƒä»¬æ•°æ®å‘ç”Ÿæ”¹å˜ã€‚é€šå¸¸è¶Šæ™šåŠ å…¥é›†åˆçš„è§‚å¯Ÿè€…è¶Šå…ˆå¾—åˆ°é€šçŸ¥ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/*         * a temporary array buffer, used as a snapshot of the state of         * current Observers.         */</span>    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrLocal<span class="token punctuation">;</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>changed<span class="token punctuation">)</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>        arrLocal <span class="token operator">=</span> obs<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">clearChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ ‡è¯†æ”¹ä¸ºfalse</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> arrLocal<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Observer</span><span class="token punctuation">)</span>arrLocal<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">protected</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    changed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ï¼ŒObserver æ¥å£</strong></p><p>Observer æ¥å£æ˜¯æŠ½è±¡è§‚å¯Ÿè€…ï¼Œå®ƒç›‘è§†ç›®æ ‡å¯¹è±¡çš„å˜åŒ–ï¼Œå½“ç›®æ ‡å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§‚å¯Ÿè€…å¾—åˆ°é€šçŸ¥ï¼Œå¹¶è°ƒç”¨ update æ–¹æ³•ï¼Œè¿›è¡Œç›¸åº”çš„å·¥ä½œã€‚</p><ul><li>void setChange() æ–¹æ³•ï¼šç”¨æ¥è®¾ç½®ä¸€ä¸ª boolean ç±»å‹çš„å†…éƒ¨æ ‡å¿—ï¼Œæ³¨æ˜ç›®æ ‡å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ã€‚å½“å®ƒä¸º true æ—¶ï¼ŒnotifyObservers() æ‰ä¼šé€šçŸ¥è§‚å¯Ÿè€…ã€‚</li></ul><p>ã€ä¾‹ã€‘è­¦å¯ŸæŠ“å°å·</p><p>è­¦å¯ŸæŠ“å°å·ä¹Ÿå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°ï¼Œè­¦å¯Ÿæ˜¯è§‚å¯Ÿè€…ï¼Œå°å·æ˜¯è¢«è§‚å¯Ÿè€…ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><p>å°å·æ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿè€…ï¼Œæ‰€ä»¥éœ€è¦ç»§æ‰¿ Observable ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thief</span> <span class="token keyword">extends</span> <span class="token class-name">Observable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Thief</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">steal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å°å·ï¼šæˆ‘å·ä¸œè¥¿äº†ï¼Œæœ‰æ²¡æœ‰äººæ¥æŠ“æˆ‘ï¼ï¼ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//changed  = true</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è­¦å¯Ÿæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œæ‰€ä»¥éœ€è¦è®©å…¶å®ç° Observer æ¥å£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Policemen</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Policemen</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Observable</span> o<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è­¦å¯Ÿï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Thief</span><span class="token punctuation">)</span> o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ï¼Œæˆ‘å·²ç»ç›¯ä½ å¾ˆä¹…äº†ï¼Œä½ å¯ä»¥ä¿æŒæ²‰é»˜ï¼Œä½†ä½ æ‰€è¯´çš„å°†æˆä¸ºå‘ˆå ‚è¯ä¾›ï¼ï¼ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºå°å·å¯¹è±¡</span>        <span class="token class-name">Thief</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thief</span><span class="token punctuation">(</span><span class="token string">"éš”å£è€ç‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºè­¦å¯Ÿå¯¹è±¡</span>        <span class="token class-name">Policemen</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Policemen</span><span class="token punctuation">(</span><span class="token string">"å°æ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®©è­¦å¯Ÿç›¯ç€å°å·</span>        t<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°å·å·ä¸œè¥¿</span>        t<span class="token punctuation">.</span><span class="token function">steal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸­ä»‹è€…æ¨¡å¼">ä¸­ä»‹è€…æ¨¡å¼</h2><h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3><p>ä¸€èˆ¬æ¥è¯´ï¼ŒåŒäº‹ç±»ä¹‹é—´çš„å…³ç³»æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¤šä¸ªåŒäº‹ç±»ä¹‹é—´äº’ç›¸å…³è”æ—¶ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»ä¼šå‘ˆç°ä¸ºå¤æ‚çš„ç½‘çŠ¶ç»“æ„ï¼Œè¿™æ˜¯ä¸€ç§è¿‡åº¦è€¦åˆçš„æ¶æ„ï¼Œå³ä¸åˆ©äºç±»çš„å¤ç”¨ï¼Œä¹Ÿä¸ç¨³å®šã€‚ä¾‹å¦‚åœ¨ä¸‹å·¦å›¾ä¸­ï¼Œæœ‰å…­ä¸ªåŒäº‹ç±»å¯¹è±¡ï¼Œå‡å¦‚å¯¹è±¡ 1 å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šæœ‰ 4 ä¸ªå¯¹è±¡å—åˆ°å½±å“ã€‚å¦‚æœå¯¹è±¡ 2 å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå°†ä¼šæœ‰ 5 ä¸ªå¯¹è±¡å—åˆ°å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒäº‹ç±»ä¹‹é—´ç›´æ¥å…³è”çš„è®¾è®¡æ˜¯ä¸å¥½çš„ã€‚</p><p>å¦‚æœå¼•å…¥ä¸­ä»‹è€…æ¨¡å¼ï¼Œé‚£ä¹ˆåŒäº‹ç±»ä¹‹é—´çš„å…³ç³»å°†å˜ä¸ºæ˜Ÿå‹ç»“æ„ï¼Œä»ä¸‹å³å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä»»ä½•ä¸€ä¸ªç±»çš„å˜åŠ¨ï¼Œåªä¼šå½±å“çš„ç±»æœ¬èº«ï¼Œä»¥åŠä¸­ä»‹è€…ï¼Œè¿™æ ·å°±å‡å°äº†ç³»ç»Ÿçš„è€¦åˆã€‚ä¸€ä¸ªå¥½çš„è®¾è®¡ï¼Œå¿…å®šä¸ä¼šæŠŠæ‰€æœ‰çš„å¯¹è±¡å…³ç³»å¤„ç†é€»è¾‘å°è£…åœ¨æœ¬ç±»ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„ç±»æ¥ç®¡ç†é‚£äº›ä¸å±äºè‡ªå·±çš„è¡Œä¸ºã€‚</p><p><img src="./../design-pattern-behavioral2/image-20240225215729513.png" alt=""></p><p><strong>å®šä¹‰ï¼š</strong></p><p>åˆå«è°ƒåœæ¨¡å¼ï¼Œå®šä¹‰ä¸€ä¸ªä¸­ä»‹è§’è‰²æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿åŸæœ‰å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ¾æ•£ï¼Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚</p><h3 id="ç»“æ„-2">ç»“æ„</h3><p>ä¸­ä»‹è€…æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ul><li><p>æŠ½è±¡ä¸­ä»‹è€…ï¼ˆMediatorï¼‰è§’è‰²ï¼šå®ƒæ˜¯ä¸­ä»‹è€…çš„æ¥å£ï¼Œæä¾›äº†åŒäº‹å¯¹è±¡æ³¨å†Œä¸è½¬å‘åŒäº‹å¯¹è±¡ä¿¡æ¯çš„æŠ½è±¡æ–¹æ³•ã€‚</p></li><li><p>å…·ä½“ä¸­ä»‹è€…ï¼ˆConcreteMediatorï¼‰è§’è‰²ï¼šå®ç°ä¸­ä»‹è€…æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ª List æ¥ç®¡ç†åŒäº‹å¯¹è±¡ï¼Œåè°ƒå„ä¸ªåŒäº‹è§’è‰²ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œå› æ­¤å®ƒä¾èµ–äºåŒäº‹è§’è‰²ã€‚</p></li><li><p>æŠ½è±¡åŒäº‹ç±»ï¼ˆColleagueï¼‰è§’è‰²ï¼šå®šä¹‰åŒäº‹ç±»çš„æ¥å£ï¼Œä¿å­˜ä¸­ä»‹è€…å¯¹è±¡ï¼Œæä¾›åŒäº‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ‰€æœ‰ç›¸äº’å½±å“çš„åŒäº‹ç±»çš„å…¬å…±åŠŸèƒ½ã€‚</p></li><li><p>å…·ä½“åŒäº‹ç±»ï¼ˆConcrete Colleagueï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡åŒäº‹ç±»çš„å®ç°è€…ï¼Œå½“éœ€è¦ä¸å…¶ä»–åŒäº‹å¯¹è±¡äº¤äº’æ—¶ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡è´Ÿè´£åç»­çš„äº¤äº’ã€‚</p></li></ul><h3 id="æ¡ˆä¾‹å®ç°-2">æ¡ˆä¾‹å®ç°</h3><p>ã€ä¾‹ã€‘ç§Ÿæˆ¿</p><p>ç°åœ¨ç§Ÿæˆ¿åŸºæœ¬éƒ½æ˜¯é€šè¿‡æˆ¿å±‹ä¸­ä»‹ï¼Œæˆ¿ä¸»å°†æˆ¿å±‹æ‰˜ç®¡ç»™æˆ¿å±‹ä¸­ä»‹ï¼Œè€Œç§Ÿæˆ¿è€…ä»æˆ¿å±‹ä¸­ä»‹è·å–æˆ¿å±‹ä¿¡æ¯ã€‚æˆ¿å±‹ä¸­ä»‹å……å½“ç§Ÿæˆ¿è€…ä¸æˆ¿å±‹æ‰€æœ‰è€…ä¹‹é—´çš„ä¸­ä»‹è€…ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Person {# name : String# mediator : Mediator+ Person(String name, Mediator mediator)}class Mediator {+ constact(String message, Person person) void}class Tenant {+ Tenane(String name, Mediator mediator)+ constact(String message) void+ getMessage(String message) void}class HouseOwner {+ HouseOwner(String name, Mediator mediator)+ constact(String message) void+ getMessage(String message) void}class MediatorStructure {- hoseOwner : HouseOwner- tenant : Tenant+ setHouseOwner(HouseOwner houseOwner) void+ setTenant(Tenant tenant) void+ getHouseOwner() HouseOwner+ getTenane() Tenant+ constact(String message, Person person) void}Person o-- MediatorPerson <|-- TenantPerson <|-- HouseOwnerMediator <|-- MediatorStructureTenant --o MediatorStructureHouseOwner --o MediatorStructure</pre><p><strong>æŠ½è±¡ä¸­ä»‹è€…ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Mediator</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">constact</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Person</span> person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æŠ½è±¡åŒäº‹ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç§Ÿæˆ¿è€…å§“å</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token comment">//ä¸­ä»‹</span>    <span class="token keyword">protected</span> <span class="token class-name">Mediator</span> mediator<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Mediator</span> mediator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>mediator <span class="token operator">=</span> mediator<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“åŒäº‹ç±»è§’è‰²</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç§Ÿæˆ¿è€…</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tenant</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Tenant</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Mediator</span> mediator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å’Œä¸­ä»‹è”ç³»(æ²Ÿé€š)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">constact</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        mediator<span class="token punctuation">.</span><span class="token function">constact</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–ä¿¡æ¯</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç§Ÿæˆ¿è€…"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"è·å–åˆ°çš„ä¿¡æ¯æ˜¯: "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“çš„åŒäº‹è§’è‰²ç±»è§’è‰²</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æˆ¿ä¸»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HouseOwner</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">HouseOwner</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Mediator</span> mediator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å’Œä¸­ä»‹è”ç³»(æ²Ÿé€š)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">constact</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        mediator<span class="token punctuation">.</span><span class="token function">constact</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–ä¿¡æ¯</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ¿ä¸»"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"è·å–åˆ°çš„ä¿¡æ¯æ˜¯: "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“ä¸­ä»‹è€…è§’è‰²ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediatorStructure</span> <span class="token keyword">extends</span> <span class="token class-name">Mediator</span><span class="token punctuation">&#123;</span>    <span class="token comment">//èšåˆæˆ¿ä¸»å’Œç§Ÿæˆ¿è€…å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">HouseOwner</span> houseOwner<span class="token punctuation">;</span> <span class="token comment">//æˆ¿ä¸»</span>    <span class="token keyword">private</span> <span class="token class-name">Tenant</span> tenant<span class="token punctuation">;</span> <span class="token comment">//ç§Ÿå®¢</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">constact</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>person <span class="token operator">==</span> houseOwner<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            tenant<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            houseOwner<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">HouseOwner</span> <span class="token function">getHouseOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> houseOwner<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHouseOwner</span><span class="token punctuation">(</span><span class="token class-name">HouseOwner</span> houseOwner<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>houseOwner <span class="token operator">=</span> houseOwner<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Tenant</span> <span class="token function">getTenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> tenant<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTenant</span><span class="token punctuation">(</span><span class="token class-name">Tenant</span> tenant<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>tenant <span class="token operator">=</span> tenant<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºä¸­ä»‹è€…å¯¹è±¡</span>        <span class="token class-name">MediatorStructure</span> mediator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediatorStructure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºç§Ÿæˆ¿è€…å¯¹è±¡</span>        <span class="token class-name">Tenant</span> tenant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tenant</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">,</span> mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºæˆ¿ä¸»å¯¹è±¡</span>        <span class="token class-name">HouseOwner</span> houseOwner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HouseOwner</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span> mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä¸­ä»‹è€…è¦çŸ¥é“å…·ä½“çš„æˆ¿ä¸»å’Œç§Ÿæˆ¿è€…</span>        mediator<span class="token punctuation">.</span><span class="token function">setTenant</span><span class="token punctuation">(</span>tenant<span class="token punctuation">)</span><span class="token punctuation">;</span>        mediator<span class="token punctuation">.</span><span class="token function">setHouseOwner</span><span class="token punctuation">(</span>houseOwner<span class="token punctuation">)</span><span class="token punctuation">;</span>        tenant<span class="token punctuation">.</span><span class="token function">constact</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦ç§Ÿä¸‰å®¤çš„æˆ¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        houseOwner<span class="token punctuation">.</span><span class="token function">constact</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¿™é‡Œæœ‰ä¸‰å®¤çš„æˆ¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">æˆ¿ä¸»å¼ ä¸‰è·å–åˆ°çš„ä¿¡æ¯æ˜¯: æˆ‘è¦ç§Ÿä¸‰å®¤çš„æˆ¿å­ç§Ÿæˆ¿è€…æå››è·å–åˆ°çš„ä¿¡æ¯æ˜¯: æˆ‘è¿™é‡Œæœ‰ä¸‰å®¤çš„æˆ¿å­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-2">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li><p>æ¾æ•£è€¦åˆ</p><p>ä¸­ä»‹è€…æ¨¡å¼é€šè¿‡æŠŠå¤šä¸ªåŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢ï¼Œä»è€Œä½¿å¾—åŒäº‹å¯¹è±¡ä¹‹é—´æ¾æ•£è€¦åˆï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åšåˆ°äº’è¡¥ä¾èµ–ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŒäº‹å¯¹è±¡å°±å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–å’Œå¤ç”¨ï¼Œè€Œä¸å†åƒä»¥å‰é‚£æ ·â€œç‰µä¸€å¤„è€ŒåŠ¨å…¨èº«â€äº†ã€‚</p></li><li><p>é›†ä¸­æ§åˆ¶äº¤äº’</p><p>å¤šä¸ªåŒäº‹å¯¹è±¡çš„äº¤äº’ï¼Œè¢«å°è£…åœ¨ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢é›†ä¸­ç®¡ç†ï¼Œä½¿å¾—è¿™äº›äº¤äº’è¡Œä¸ºå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹ä¸­ä»‹è€…å¯¹è±¡å°±å¯ä»¥äº†ï¼Œå½“ç„¶å¦‚æœæ˜¯å·²ç»åšå¥½çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆå°±æ‰©å±•ä¸­ä»‹è€…å¯¹è±¡ï¼Œè€Œå„ä¸ªåŒäº‹ç±»ä¸éœ€è¦åšä¿®æ”¹ã€‚</p></li><li><p>ä¸€å¯¹å¤šå…³è”è½¬å˜ä¸ºä¸€å¯¹ä¸€çš„å…³è”</p><p>æ²¡æœ‰ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼çš„æ—¶å€™ï¼ŒåŒäº‹å¯¹è±¡ä¹‹é—´çš„å…³ç³»é€šå¸¸æ˜¯ä¸€å¯¹å¤šçš„ï¼Œå¼•å…¥ä¸­ä»‹è€…å¯¹è±¡ä»¥åï¼Œä¸­ä»‹è€…å¯¹è±¡å’ŒåŒäº‹å¯¹è±¡çš„å…³ç³»é€šå¸¸å˜æˆåŒå‘çš„ä¸€å¯¹ä¸€ï¼Œè¿™ä¼šè®©å¯¹è±¡çš„å…³ç³»æ›´å®¹æ˜“ç†è§£å’Œå®ç°ã€‚</p></li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><p>å½“åŒäº‹ç±»å¤ªå¤šæ—¶ï¼Œä¸­ä»‹è€…çš„èŒè´£å°†å¾ˆå¤§ï¼Œå®ƒä¼šå˜å¾—å¤æ‚è€Œåºå¤§ï¼Œä»¥è‡³äºç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</h3><ul><li>ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„å¼•ç”¨å…³ç³»ï¼Œç³»ç»Ÿç»“æ„æ··ä¹±ä¸”éš¾ä»¥ç†è§£ã€‚</li><li>å½“æƒ³åˆ›å»ºä¸€ä¸ªè¿è¡Œäºå¤šä¸ªç±»ä¹‹é—´çš„å¯¹è±¡ï¼Œåˆä¸æƒ³ç”Ÿæˆæ–°çš„å­ç±»æ—¶ã€‚</li></ul><h2 id="è¿­ä»£å™¨æ¨¡å¼">è¿­ä»£å™¨æ¨¡å¼</h2><h3 id="æ¦‚è¿°-3">æ¦‚è¿°</h3><p><strong>å®šä¹‰ï¼š</strong></p><p>æä¾›ä¸€ä¸ªå¯¹è±¡æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p><h3 id="ç»“æ„-3">ç»“æ„</h3><p>è¿­ä»£å™¨æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li><p>æŠ½è±¡èšåˆï¼ˆAggregateï¼‰è§’è‰²ï¼šå®šä¹‰å­˜å‚¨ã€æ·»åŠ ã€åˆ é™¤èšåˆå…ƒç´ ä»¥åŠåˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚</p></li><li><p>å…·ä½“èšåˆï¼ˆConcreteAggregateï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡èšåˆç±»ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“è¿­ä»£å™¨çš„å®ä¾‹ã€‚</p></li><li><p>æŠ½è±¡è¿­ä»£å™¨ï¼ˆIteratorï¼‰è§’è‰²ï¼šå®šä¹‰è®¿é—®å’Œéå†èšåˆå…ƒç´ çš„æ¥å£ï¼Œé€šå¸¸åŒ…å« hasNext()ã€next() ç­‰æ–¹æ³•ã€‚</p></li><li><p>å…·ä½“è¿­ä»£å™¨ï¼ˆConcretelteratorï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡è¿­ä»£å™¨æ¥å£ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆå¯¹èšåˆå¯¹è±¡çš„éå†ï¼Œè®°å½•éå†çš„å½“å‰ä½ç½®ã€‚</p></li></ul><h3 id="æ¡ˆä¾‹å®ç°-3">æ¡ˆä¾‹å®ç°</h3><p>ã€ä¾‹ã€‘å®šä¹‰ä¸€ä¸ªå¯ä»¥å­˜å‚¨å­¦ç”Ÿå¯¹è±¡çš„å®¹å™¨å¯¹è±¡ï¼Œå°†éå†è¯¥å®¹å™¨çš„åŠŸèƒ½äº¤ç”±è¿­ä»£å™¨å®ç°ï¼Œæ¶‰åŠåˆ°çš„ç±»å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass StudentIterator {<< interface >>+ hasNext() boolean+ next() Student}class StudentIteratorImpl {- list : List~Student~- position : int+ StudentIteratorImpl(List~Student~ list)+ hasNext() boolean+ next() Student}class StudentAggregate {<< interface >>+ addStudent(Student student) void+ removeStudent(Student student) void+ getStudentIterator() StudentIterator}class StudentAggregateImpl {- list : List~Student~+ addStudent(Student student) void+ removeStudent(Student student) void+ getStudentIterator() StudentIterator}class Student {- name : String- number : String+ setName(String name) void+ setNumber(String number) void+ getName() String+ getNumber() String+ toString() String}StudentIterator <|.. StudentIteratorImplStudentIterator <.. StudentAggregateStudentIterator <.. StudentAggregateImplStudentAggregate <|.. StudentAggregateImplStudentIteratorImpl o-- StudentStudentAggregateImpl o-- Student</pre><p><strong>å­¦ç”Ÿç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> number<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token class-name">String</span> number<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> number<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> number<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> number<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Student&#123;"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", number='"</span> <span class="token operator">+</span> number <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æŠ½è±¡è¿­ä»£å™¨</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentIterator</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å…ƒç´ </span>    <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è·å–ä¸‹ä¸€ä¸ªå…ƒç´ </span>    <span class="token class-name">Student</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“è¿­ä»£å™¨</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentIteratorImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StudentIterator</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//é›†åˆ</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> list<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> posittion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//ç”¨æ¥è®°å½•éå†æ—¶çš„ä½ç½®</span>    <span class="token keyword">public</span> <span class="token class-name">StudentIteratorImpl</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> posittion <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Student</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»é›†åˆä¸­è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ </span>        <span class="token class-name">Student</span> currentStudent <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>posittion<span class="token punctuation">)</span><span class="token punctuation">;</span>        posittion<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> currentStudent<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æŠ½è±¡å®¹å™¨ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentAggregate</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ·»åŠ å­¦ç”ŸåŠŸèƒ½</span>    <span class="token keyword">void</span> <span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ é™¤å­¦ç”ŸåŠŸèƒ½</span>    <span class="token keyword">void</span> <span class="token function">removeStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è·å–è¿­ä»£å™¨å¯¹è±¡åŠŸèƒ½</span>    <span class="token class-name">StudentIterator</span> <span class="token function">getStudentIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“å®¹å™¨ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentAggregateImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StudentAggregate</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeStudent</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–è¿­ä»£å™¨å¯¹è±¡</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">StudentIterator</span> <span class="token function">getStudentIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StudentIteratorImpl</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºèšåˆå¯¹è±¡</span>        <span class="token class-name">StudentAggregateImpl</span> aggregate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StudentAggregateImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ·»åŠ å…ƒç´ </span>        aggregate<span class="token punctuation">.</span><span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span> <span class="token string">"180001"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        aggregate<span class="token punctuation">.</span><span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token string">"180002"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        aggregate<span class="token punctuation">.</span><span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">,</span> <span class="token string">"180003"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        aggregate<span class="token punctuation">.</span><span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"èµµå…­"</span><span class="token punctuation">,</span> <span class="token string">"180004"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//éå†èšåˆå¯¹è±¡</span>        <span class="token comment">//1.è·å–è¿­ä»£å™¨å¯¹è±¡</span>        <span class="token class-name">StudentIterator</span> iterator <span class="token operator">=</span> aggregate<span class="token punctuation">.</span><span class="token function">getStudentIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.éå†</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//3.è·å–å…ƒç´ </span>            <span class="token class-name">Student</span> student <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">Student&#123;name&#x3D;&#39;å¼ ä¸‰&#39;, number&#x3D;&#39;180001&#39;&#125;Student&#123;name&#x3D;&#39;æå››&#39;, number&#x3D;&#39;180002&#39;&#125;Student&#123;name&#x3D;&#39;ç‹äº”&#39;, number&#x3D;&#39;180003&#39;&#125;Student&#123;name&#x3D;&#39;èµµå…­&#39;, number&#x3D;&#39;180004&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-3">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li>å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡ï¼Œåœ¨åŒä¸€ä¸ªèšåˆå¯¹è±¡ä¸Šå¯ä»¥å®šä¹‰å¤šç§éå†æ–¹å¼ã€‚åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­åªéœ€è¦ç”¨ä¸€ä¸ªä¸åŒçš„è¿­ä»£å™¨æ¥æ›¿æ¢åŸæœ‰è¿­ä»£å™¨å³å¯æ”¹å˜éå†ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰è¿­ä»£å™¨çš„å­ç±»ä»¥æ”¯æŒæ–°çš„éå†æ–¹å¼ã€‚</li><li>è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»ã€‚ç”±äºå¼•å…¥äº†è¿­ä»£å™¨ï¼Œåœ¨åŸæœ‰çš„èšåˆå¯¹è±¡ä¸­ä¸éœ€è¦å†è‡ªè¡Œæä¾›æ•°æ®éå†ç­‰æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–èšåˆç±»çš„è®¾è®¡ã€‚</li><li>åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ï¼Œç”±äºå¼•å…¥äº†æŠ½è±¡å±‚ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œæ»¡è¶³ â€œå¼€é—­åŸåˆ™â€ çš„è¦æ±‚ã€‚</li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><p>å¢åŠ äº†ç±»çš„ä¸ªæ•°ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯</h3><ul><li>å½“éœ€è¦ä¸ºèšåˆå¯¹è±¡æä¾›å¤šç§éå†æ–¹å¼æ—¶ã€‚</li><li>å½“éœ€è¦ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ—¶ã€‚</li><li>å½“è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å…¶å†…éƒ¨ç»†èŠ‚çš„è¡¨ç¤ºæ—¶ã€‚</li></ul><h3 id="JDKæºç è§£æ">JDKæºç è§£æ</h3><p>è¿­ä»£å™¨æ¨¡å¼åœ¨ Java çš„å¾ˆå¤šé›†åˆç±»ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ Java æºç ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼çš„ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> iterator <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//list.iterator()æ–¹æ³•è¿”å›çš„è‚¯å®šæ˜¯Iteratoræ¥å£çš„å­å®ç°ç±»å¯¹è±¡</span><span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹å®Œè¿™æ®µä»£ç æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¸æˆ‘ä»¬ä¸Šé¢ä»£ç åŸºæœ¬ç±»ä¼¼ã€‚å•åˆ—é›†åˆéƒ½ä½¿ç”¨åˆ°äº†è¿­ä»£å™¨ï¼Œæˆ‘ä»¬ä»¥ ArrayList ä¸¾ä¾‹æ¥è¯´æ˜</p><ul><li>Listï¼šæŠ½è±¡èšåˆç±»</li><li>ArrayListï¼šå…·ä½“çš„èšåˆç±»</li><li>Iteratorï¼šæŠ½è±¡è¿­ä»£å™¨</li><li>list.iterator()ï¼šè¿”å›çš„æ˜¯å®ç°äº† <code>Iterator</code> æ¥å£çš„å…·ä½“è¿­ä»£å™¨å¯¹è±¡</li></ul><p>å…·ä½“çš„æ¥çœ‹çœ‹ ArrayList çš„ä»£ç å®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>        <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Itr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ç§æœ‰å†…éƒ¨ç±», è¿­ä»£å™¨ç±»</span>    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">Itr</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> cursor<span class="token punctuation">;</span>       <span class="token comment">// ä¸‹ä¸€ä¸ªè¦è¿”å›å…ƒç´ çš„ç´¢å¼•</span>        <span class="token keyword">int</span> lastRet <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// ä¸Šä¸€ä¸ªè¿”å›å…ƒç´ çš„ç´¢å¼•</span>        <span class="token keyword">int</span> expectedModCount <span class="token operator">=</span> modCount<span class="token punctuation">;</span>        <span class="token class-name">Itr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token comment">//åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å…ƒç´ </span>        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> cursor <span class="token operator">!=</span> size<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//è·å–ä¸‹ä¸€ä¸ªå…ƒç´ </span>        <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> i <span class="token operator">=</span> cursor<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> size<span class="token punctuation">)</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData <span class="token operator">=</span> <span class="token class-name">ArrayList</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>elementData<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">)</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cursor <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> elementData<span class="token punctuation">[</span>lastRet <span class="token operator">=</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™éƒ¨åˆ†ä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå¤§è‡´å°±æ˜¯åœ¨ <code>iterator</code> æ–¹æ³•ä¸­è¿”å›äº†ä¸€ä¸ªå®ä¾‹åŒ–çš„ <code>Iterator</code> å¯¹è±¡ã€‚Itræ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ƒå®ç°äº† <code>Iterator</code> æ¥å£å¹¶é‡å†™äº†å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚</p><blockquote><p>æ³¨æ„ï¼š</p><p>â€‹å½“æˆ‘ä»¬åœ¨ä½¿ç”¨ Java å¼€å‘çš„æ—¶å€™ï¼Œæƒ³ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼çš„è¯ï¼Œåªè¦è®©æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å®¹å™¨ç±»å®ç°<code>java.util.Iterable</code>å¹¶å®ç°å…¶ä¸­çš„ iterator() æ–¹æ³•ä½¿å…¶è¿”å›ä¸€ä¸ª <code>java.util.Iterator</code> çš„å®ç°ç±»å°±å¯ä»¥äº†ã€‚</p></blockquote><h2 id="è®¿é—®è€…æ¨¡å¼">è®¿é—®è€…æ¨¡å¼</h2><h3 id="æ¦‚è¿°-4">æ¦‚è¿°</h3><p><strong>å®šä¹‰ï¼š</strong></p><p>å°è£…ä¸€äº›ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜è¿™ä¸ªæ•°æ®ç»“æ„çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œã€‚</p><h3 id="ç»“æ„-4">ç»“æ„</h3><p>è®¿é—®è€…æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²:</p><ul><li>æŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰è§’è‰²ï¼šå®šä¹‰äº†å¯¹æ¯ä¸€ä¸ªå…ƒç´  <code>ï¼ˆElementï¼‰</code> è®¿é—®çš„è¡Œä¸ºï¼Œå®ƒçš„å‚æ•°å°±æ˜¯å¯ä»¥è®¿é—®çš„å…ƒç´ ï¼Œå®ƒçš„æ–¹æ³•ä¸ªæ•°ç†è®ºä¸Šæ¥è®²ä¸å…ƒç´ ç±»ä¸ªæ•°ï¼ˆElement çš„å®ç°ç±»ä¸ªæ•°ï¼‰æ˜¯ä¸€æ ·çš„ï¼Œä»è¿™ç‚¹ä¸éš¾çœ‹å‡ºï¼Œè®¿é—®è€…æ¨¡å¼è¦æ±‚å…ƒç´ ç±»çš„ä¸ªæ•°ä¸èƒ½æ”¹å˜ã€‚</li><li>å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰è§’è‰²ï¼šç»™å‡ºå¯¹æ¯ä¸€ä¸ªå…ƒç´ ç±»è®¿é—®æ—¶æ‰€äº§ç”Ÿçš„å…·ä½“è¡Œä¸ºã€‚</li><li>æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰è§’è‰²ï¼šå®šä¹‰äº†ä¸€ä¸ªæ¥å—è®¿é—®è€…çš„æ–¹æ³•ï¼ˆ<code>accept</code>ï¼‰ï¼Œå…¶æ„ä¹‰æ˜¯æŒ‡ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½è¦å¯ä»¥è¢«è®¿é—®è€…è®¿é—®ã€‚</li><li>å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰è§’è‰²ï¼š æä¾›æ¥å—è®¿é—®æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè€Œè¿™ä¸ªå…·ä½“çš„å®ç°ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä½¿ç”¨è®¿é—®è€…æä¾›çš„è®¿é—®è¯¥å…ƒç´ ç±»çš„æ–¹æ³•ã€‚</li><li>å¯¹è±¡ç»“æ„ï¼ˆObject Structureï¼‰è§’è‰²ï¼šå®šä¹‰å½“ä¸­æ‰€æåˆ°çš„å¯¹è±¡ç»“æ„ï¼Œå¯¹è±¡ç»“æ„æ˜¯ä¸€ä¸ªæŠ½è±¡è¡¨è¿°ï¼Œå…·ä½“ç‚¹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå…·æœ‰å®¹å™¨æ€§è´¨æˆ–è€…å¤åˆå¯¹è±¡ç‰¹æ€§çš„ç±»ï¼Œå®ƒä¼šå«æœ‰ä¸€ç»„å…ƒç´ ï¼ˆ<code>Element</code>ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥è¿­ä»£è¿™äº›å…ƒç´ ï¼Œä¾›è®¿é—®è€…è®¿é—®ã€‚</li></ul><h3 id="æ¡ˆä¾‹å®ç°-4">æ¡ˆä¾‹å®ç°</h3><p>ã€ä¾‹ã€‘ç»™å® ç‰©å–‚é£Ÿ</p><p>ç°åœ¨å…»å® ç‰©çš„äººç‰¹åˆ«å¤šï¼Œæˆ‘ä»¬å°±ä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œå½“ç„¶å® ç‰©è¿˜åˆ†ä¸ºç‹—ï¼ŒçŒ«ç­‰ï¼Œè¦ç»™å® ç‰©å–‚é£Ÿçš„è¯ï¼Œä¸»äººå¯ä»¥å–‚ï¼Œå…¶ä»–äººä¹Ÿå¯ä»¥å–‚é£Ÿã€‚</p><ul><li>è®¿é—®è€…è§’è‰²ï¼šç»™å® ç‰©å–‚é£Ÿçš„äºº</li><li>å…·ä½“è®¿é—®è€…è§’è‰²ï¼šä¸»äººã€å…¶ä»–äºº</li><li>æŠ½è±¡å…ƒç´ è§’è‰²ï¼šåŠ¨ç‰©æŠ½è±¡ç±»</li><li>å…·ä½“å…ƒç´ è§’è‰²ï¼šå® ç‰©ç‹—ã€å® ç‰©çŒ«</li><li>ç»“æ„å¯¹è±¡è§’è‰²ï¼šä¸»äººå®¶</li></ul><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Animal {<< interface >>+ accept(Person person) void}class Home {- nodeList : List~Animal~}class Person {<< interface >>+ feed(Cat cat) void+ feed(Dog dog) void}class Dog {+ accept(Person person) void}class Cat {+ accept(Person person) void}class Owner {+ feed(Cat cat) void+ feed(Dog dog) void}class Someone {+ feed(Cat cat) void+ feed(Dog dog) void}Home o-- AnimalAnimal <|.. DogAnimal <|.. CatPerson <|.. OwnerPerson <|.. Someone</pre><p><strong>æŠ½è±¡è®¿é—®è€…æ¥å£</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">feed</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> cat<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">feed</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> dog<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“è®¿é—®è€…è§’è‰²(ä¸»äººå’Œå…¶ä»–äºº), éƒ½éœ€è¦å®ç° Person æ¥å£</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Owner</span> <span class="token keyword">implements</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">feed</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> cat<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸»äººå–‚é£ŸçŒ«"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">feed</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> dog<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸»äººå–‚é£Ÿç‹—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Someone</span> <span class="token keyword">implements</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">feed</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> cat<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…¶ä»–äººå–‚é£ŸçŒ«"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">feed</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> dog<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…¶ä»–äººå–‚é£Ÿç‹—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æŠ½è±¡èŠ‚ç‚¹ â€“ å® ç‰©</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“èŠ‚ç‚¹(å…ƒç´ )</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">implements</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        person<span class="token punctuation">.</span><span class="token function">feed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¥½å¥½åƒï¼Œæ±ªæ±ªæ±ªï¼ï¼ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">implements</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        person<span class="token punctuation">.</span><span class="token function">feed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¥½å¥½åƒï¼Œå–µå–µå–µï¼ï¼ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¯¹è±¡ç»“æ„(ä¸»äººå®¶)</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Animal</span><span class="token punctuation">></span></span> nodeList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Animal</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Animal</span> node <span class="token operator">:</span> nodeList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            node<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ·»åŠ æ“ä½œ</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Animal</span> animal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        nodeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Home</span> home <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        home<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        home<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Owner</span> owner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Owner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        home<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span>owner<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Someone</span> someone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Someone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        home<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-4">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li><p>æ‰©å±•æ€§å¥½</p><p>åœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</p></li><li><p>å¤ç”¨æ€§å¥½</p><p>é€šè¿‡è®¿é—®è€…æ¥å®šä¹‰æ•´ä¸ªå¯¹è±¡ç»“æ„é€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜å¤ç”¨ç¨‹åº¦ã€‚</p></li><li><p>åˆ†ç¦»æ— å…³è¡Œä¸º</p><p>é€šè¿‡è®¿é—®è€…æ¥åˆ†ç¦»æ— å…³çš„è¡Œä¸ºï¼ŒæŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªè®¿é—®è€…ï¼Œè¿™æ ·æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚</p></li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li><p>å¯¹è±¡ç»“æ„å˜åŒ–å¾ˆå›°éš¾</p><p>åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ç±»ï¼Œéƒ½è¦åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œï¼Œè¿™è¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚</p></li><li><p>è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™</p><p>è®¿é—®è€…æ¨¡å¼ä¾èµ–äº†å…·ä½“ç±»ï¼Œè€Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ç±»ã€‚</p></li></ul><h3 id="ä½¿ç”¨åœºæ™¯-4">ä½¿ç”¨åœºæ™¯</h3><ul><li><p>å¯¹è±¡ç»“æ„ç›¸å¯¹ç¨³å®šï¼Œä½†å…¶æ“ä½œç®—æ³•ç»å¸¸å˜åŒ–çš„ç¨‹åºã€‚</p></li><li><p>å¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡éœ€è¦æä¾›å¤šç§ä¸åŒä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œä¸”è¦é¿å…è®©è¿™äº›æ“ä½œçš„å˜åŒ–å½±å“å¯¹è±¡çš„ç»“æ„ã€‚</p></li></ul><h3 id="æ‹“å±•">æ‹“å±•</h3><p>è®¿é—®è€…æ¨¡å¼ç”¨åˆ°äº†ä¸€ç§åŒåˆ†æ´¾çš„æŠ€æœ¯ã€‚</p><p><strong>1ï¼Œåˆ†æ´¾ï¼š</strong></p><p>å˜é‡è¢«å£°æ˜æ—¶çš„ç±»å‹å«åšå˜é‡çš„é™æ€ç±»å‹ï¼Œæœ‰äº›äººåˆæŠŠé™æ€ç±»å‹å«åšæ˜æ˜¾ç±»å‹ï¼›è€Œå˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡çš„çœŸå®ç±»å‹åˆå«åšå˜é‡çš„å®é™…ç±»å‹ã€‚æ¯”å¦‚ <code>Map map = new HashMap()</code> ï¼Œmap å˜é‡çš„é™æ€ç±»å‹æ˜¯ <code>Map</code> ï¼Œå®é™…ç±»å‹æ˜¯ <code>HashMap</code> ã€‚æ ¹æ®å¯¹è±¡çš„ç±»å‹è€Œå¯¹æ–¹æ³•è¿›è¡Œçš„é€‰æ‹©ï¼Œå°±æ˜¯åˆ†æ´¾(Dispatch)ï¼Œåˆ†æ´¾(Dispatch)åˆåˆ†ä¸ºä¸¤ç§ï¼Œå³é™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾ã€‚</p><p><strong>é™æ€åˆ†æ´¾(Static Dispatch)</strong> å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶æœŸï¼Œåˆ†æ´¾æ ¹æ®é™æ€ç±»å‹ä¿¡æ¯å‘ç”Ÿã€‚é™æ€åˆ†æ´¾å¯¹äºæˆ‘ä»¬æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œæ–¹æ³•é‡è½½å°±æ˜¯é™æ€åˆ†æ´¾ã€‚</p><p><strong>åŠ¨æ€åˆ†æ´¾(Dynamic Dispatch)</strong> å‘ç”Ÿåœ¨è¿è¡Œæ—¶æœŸï¼ŒåŠ¨æ€åˆ†æ´¾åŠ¨æ€åœ°ç½®æ¢æ‰æŸä¸ªæ–¹æ³•ã€‚Java é€šè¿‡æ–¹æ³•çš„é‡å†™æ”¯æŒåŠ¨æ€åˆ†æ´¾ã€‚</p><p><strong>2ï¼ŒåŠ¨æ€åˆ†æ´¾ï¼š</strong></p><p>é€šè¿‡æ–¹æ³•çš„é‡å†™æ”¯æŒåŠ¨æ€åˆ†æ´¾ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Animal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>     <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"cat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Animal</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Animal</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a1<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ä»£ç çš„ç»“æœå¤§å®¶åº”è¯¥ç›´æ¥å¯ä»¥è¯´å‡ºæ¥ï¼Œè¿™ä¸å°±æ˜¯å¤šæ€å—ï¼è¿è¡Œæ‰§è¡Œçš„æ˜¯å­ç±»ä¸­çš„æ–¹æ³•ã€‚</p><p>Java ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æœŸå¹¶ä¸æ€»æ˜¯çŸ¥é“å“ªäº›ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºç¼–è¯‘å™¨ä»…ä»…çŸ¥é“å¯¹è±¡çš„é™æ€ç±»å‹ï¼Œè€Œä¸çŸ¥é“å¯¹è±¡çš„çœŸå®ç±»å‹ï¼›è€Œæ–¹æ³•çš„è°ƒç”¨åˆ™æ˜¯æ ¹æ®å¯¹è±¡çš„çœŸå®ç±»å‹ï¼Œè€Œä¸æ˜¯é™æ€ç±»å‹ã€‚</p><p><strong>3ï¼Œé™æ€åˆ†æ´¾ï¼š</strong></p><p>é€šè¿‡æ–¹æ³•é‡è½½æ”¯æŒé™æ€åˆ†æ´¾ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Execute</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Animal</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Animal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"cat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Animal</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Animal</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Animal</span> a2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Execute</span> exe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        exe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>        exe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>        exe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œç»“æœï¼š</p><pre class="line-numbers language-none"><code class="language-none">animalanimalanimal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªç»“æœå¯èƒ½å‡ºä¹ä¸€äº›äººçš„æ„æ–™äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><strong>é‡è½½æ–¹æ³•çš„åˆ†æ´¾æ˜¯æ ¹æ®é™æ€ç±»å‹è¿›è¡Œçš„ï¼Œè¿™ä¸ªåˆ†æ´¾è¿‡ç¨‹åœ¨ç¼–è¯‘æ—¶æœŸå°±å®Œæˆäº†ã€‚</strong></p><p><strong>4ï¼ŒåŒåˆ†æ´¾ï¼š</strong></p><p>æ‰€è°“åŒåˆ†æ´¾æŠ€æœ¯å°±æ˜¯åœ¨é€‰æ‹©ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¸ä»…ä»…è¦æ ¹æ®æ¶ˆæ¯æ¥æ”¶è€…ï¼ˆreceiverï¼‰çš„è¿è¡Œæ—¶åŒºåˆ«ï¼Œè¿˜è¦æ ¹æ®å‚æ•°çš„è¿è¡Œæ—¶åŒºåˆ«ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Execute</span> exe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        exe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Execute</span> exe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        exe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Execute</span> exe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        exe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Execute</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Animal</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"animal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"cat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Animal</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Animal</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Animal</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Execute</span> exe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>exe<span class="token punctuation">)</span><span class="token punctuation">;</span>        d<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>exe<span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>exe<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯å°† Execute å¯¹è±¡åšä¸ºå‚æ•°ä¼ é€’ç»™ Animal ç±»å‹çš„å˜é‡è°ƒç”¨çš„æ–¹æ³•ï¼Œè¿™é‡Œå®Œæˆç¬¬ä¸€æ¬¡åˆ†æ´¾ï¼Œè¿™é‡Œæ˜¯æ–¹æ³•é‡å†™ï¼Œæ‰€ä»¥æ˜¯åŠ¨æ€åˆ†æ´¾ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œå®é™…ç±»å‹ä¸­çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿ <code>å°†è‡ªå·± this ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œè¿™é‡Œå°±å®Œæˆäº†ç¬¬äºŒæ¬¡åˆ†æ´¾</code>ï¼Œè¿™é‡Œçš„ Execute ç±»ä¸­æœ‰å¤šä¸ªé‡è½½çš„æ–¹æ³•ï¼Œè€Œä¼ é€’è¿›è¡Œçš„æ˜¯ thisï¼Œå°±æ˜¯å…·ä½“çš„å®é™…ç±»å‹çš„å¯¹è±¡ã€‚</p><p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æ˜ç™½åŒåˆ†æ´¾æ˜¯æ€ä¹ˆå›äº‹äº†ï¼Œä½†æ˜¯å®ƒæœ‰ä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿå°±æ˜¯å¯ä»¥å®ç°æ–¹æ³•çš„åŠ¨æ€ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸Šé¢çš„ç¨‹åºè¿›è¡Œä¿®æ”¹ã€‚</p><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">animaldogcat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>åŒåˆ†æ´¾å®ç°åŠ¨æ€ç»‘å®šçš„æœ¬è´¨ï¼Œå°±æ˜¯åœ¨é‡è½½æ–¹æ³•å§”æ´¾çš„å‰é¢åŠ ä¸Šäº†ç»§æ‰¿ä½“ç³»ä¸­è¦†ç›–çš„ç¯èŠ‚ï¼Œç”±äºè¦†ç›–æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥é‡è½½å°±æ˜¯åŠ¨æ€çš„äº†ã€‚</strong></p><h2 id="å¤‡å¿˜å½•æ¨¡å¼">å¤‡å¿˜å½•æ¨¡å¼</h2><h3 id="æ¦‚è¿°-5">æ¦‚è¿°</h3><p>å¤‡å¿˜å½•æ¨¡å¼æä¾›äº†ä¸€ç§çŠ¶æ€æ¢å¤çš„å®ç°æœºåˆ¶ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°å›åˆ°ä¸€ä¸ªç‰¹å®šçš„å†å²æ­¥éª¤ï¼Œå½“æ–°çš„çŠ¶æ€æ— æ•ˆæˆ–è€…å­˜åœ¨é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æš‚æ—¶å­˜å‚¨èµ·æ¥çš„å¤‡å¿˜å½•å°†çŠ¶æ€å¤åŸï¼Œå¾ˆå¤šè½¯ä»¶éƒ½æä¾›äº†æ’¤é”€ï¼ˆUndoï¼‰æ“ä½œï¼Œå¦‚ Wordã€è®°äº‹æœ¬ã€Photoshopã€IDEA ç­‰è½¯ä»¶åœ¨ç¼–è¾‘æ—¶æŒ‰ Ctrl+Z ç»„åˆé”®æ—¶èƒ½æ’¤é”€å½“å‰æ“ä½œï¼Œä½¿æ–‡æ¡£æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼›è¿˜æœ‰åœ¨ æµè§ˆå™¨ ä¸­çš„åé€€é”®ã€æ•°æ®åº“äº‹åŠ¡ç®¡ç†ä¸­çš„å›æ»šæ“ä½œã€ç©æ¸¸æˆæ—¶çš„ä¸­é—´ç»“æœå­˜æ¡£åŠŸèƒ½ã€æ•°æ®åº“ä¸æ“ä½œç³»ç»Ÿçš„å¤‡ä»½æ“ä½œã€æ£‹ç±»æ¸¸æˆä¸­çš„æ‚”æ£‹åŠŸèƒ½ç­‰éƒ½å±äºè¿™ç±»ã€‚</p><p><strong>å®šä¹‰ï¼š</strong></p><p>åˆå«å¿«ç…§æ¨¡å¼ï¼Œåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åå½“éœ€è¦æ—¶èƒ½å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚</p><h3 id="ç»“æ„-5">ç»“æ„</h3><p>å¤‡å¿˜å½•æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ul><li>å‘èµ·äººï¼ˆOriginatorï¼‰è§’è‰²ï¼šè®°å½•å½“å‰æ—¶åˆ»çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œæä¾›åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤å¤‡å¿˜å½•æ•°æ®çš„åŠŸèƒ½ï¼Œå®ç°å…¶ä»–ä¸šåŠ¡åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®¿é—®å¤‡å¿˜å½•é‡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚</li><li>å¤‡å¿˜å½•ï¼ˆMementoï¼‰è§’è‰²ï¼šè´Ÿè´£å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æä¾›è¿™äº›å†…éƒ¨çŠ¶æ€ç»™å‘èµ·äººã€‚</li><li>ç®¡ç†è€…ï¼ˆCaretakerï¼‰è§’è‰²ï¼šå¯¹å¤‡å¿˜å½•è¿›è¡Œç®¡ç†ï¼Œæä¾›ä¿å­˜ä¸è·å–å¤‡å¿˜å½•çš„åŠŸèƒ½ï¼Œä½†å…¶ä¸èƒ½å¯¹å¤‡å¿˜å½•çš„å†…å®¹è¿›è¡Œè®¿é—®ä¸ä¿®æ”¹ã€‚</li></ul><blockquote><p>å¤‡å¿˜å½•æœ‰ä¸¤ä¸ªç­‰æ•ˆçš„æ¥å£ï¼š</p><ul><li><strong>çª„æ¥å£</strong>ï¼šç®¡ç†è€…(Caretaker)å¯¹è±¡ï¼ˆå’Œå…¶ä»–å‘èµ·äººå¯¹è±¡ä¹‹å¤–çš„ä»»ä½•å¯¹è±¡ï¼‰çœ‹åˆ°çš„æ˜¯å¤‡å¿˜å½•çš„çª„æ¥å£(narror Interface)ï¼Œè¿™ä¸ªçª„æ¥å£åªå…è®¸ä»–æŠŠå¤‡å¿˜å½•å¯¹è±¡ä¼ ç»™å…¶ä»–çš„å¯¹è±¡ã€‚</li><li><strong>å®½æ¥å£</strong>ï¼šä¸ç®¡ç†è€…çœ‹åˆ°çš„çª„æ¥å£ç›¸åï¼Œå‘èµ·äººå¯¹è±¡å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå®½æ¥å£(wide Interface)ï¼Œè¿™ä¸ªå®½æ¥å£å…è®¸å®ƒè¯»å–æ‰€æœ‰çš„æ•°æ®ï¼Œä»¥ä¾¿æ ¹æ®è¿™äº›æ•°æ®æ¢å¤è¿™ä¸ªå‘èµ·äººå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚</li></ul></blockquote><h3 id="æ¡ˆä¾‹å®ç°-5">æ¡ˆä¾‹å®ç°</h3><p>ã€ä¾‹ã€‘æ¸¸æˆæŒ‘æˆ˜ BOSS</p><p>æ¸¸æˆä¸­çš„æŸä¸ªåœºæ™¯ï¼Œä¸€æ¸¸æˆè§’è‰²æœ‰ç”Ÿå‘½åŠ›ã€æ”»å‡»åŠ›ã€é˜²å¾¡åŠ›ç­‰æ•°æ®ï¼Œåœ¨æ‰“Boss å‰å’Œåä¸€å®šä¼šä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å…è®¸ç©å®¶å¦‚æœæ„Ÿè§‰ä¸ Boss å†³æ–—çš„æ•ˆæœä¸ç†æƒ³å¯ä»¥è®©æ¸¸æˆæ¢å¤åˆ°å†³æ–—ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>è¦å®ç°ä¸Šè¿°æ¡ˆä¾‹ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>â€œç™½ç®±â€å¤‡å¿˜å½•æ¨¡å¼</li><li>â€œé»‘ç®±â€å¤‡å¿˜å½•æ¨¡å¼</li></ul><h4 id="â€œç™½ç®±â€å¤‡å¿˜å½•æ¨¡å¼">â€œç™½ç®±â€å¤‡å¿˜å½•æ¨¡å¼</h4><p>å¤‡å¿˜å½•è§’è‰²å¯¹ä»»ä½•å¯¹è±¡éƒ½æä¾›ä¸€ä¸ªæ¥å£ï¼Œå³å®½æ¥å£ï¼Œå¤‡å¿˜å½•è§’è‰²çš„å†…éƒ¨æ‰€å­˜å‚¨çš„çŠ¶æ€å°±å¯¹æ‰€æœ‰å¯¹è±¡å…¬å¼€ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass RoleStateMemento {- vit : int- atk : int- def : int+ RoleStateMemento(int vit, int atk, int def)}class GameRole {- vit : int- atk : int- def : int+ initState() void+ fight() void+ saveState() RoleStateMemento+ recoverState(RoleStateMemento roleStateMemento) void}class RoleStateCaretaker {- roleStateMemento RoleStateMemento+ getRoleStateMemento() RoleStateMemento+ setRoleStateMemento(RoleStateMemento roleStateMemento) void}RoleStateMemento <.. GameRoleRoleStateMemento --o RoleStateCaretaker</pre><p><strong>å‘èµ·äººè§’è‰²</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ¸¸æˆè§’è‰²ç±»(å±äºå‘èµ·äººè§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameRole</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> vit<span class="token punctuation">;</span> <span class="token comment">//ç”Ÿå‘½åŠ›</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> atk<span class="token punctuation">;</span> <span class="token comment">//æ”»å‡»åŠ›</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> def<span class="token punctuation">;</span> <span class="token comment">//é˜²å¾¡åŠ›</span>    <span class="token comment">//åˆå§‹åŒ–å†…éƒ¨çŠ¶æ€çš„åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æˆ˜æ–—</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ä¿å­˜è§’è‰²çŠ¶æ€åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token class-name">RoleStateMemento</span> <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RoleStateMemento</span><span class="token punctuation">(</span>vit<span class="token punctuation">,</span> atk<span class="token punctuation">,</span> def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ¢å¤è§’è‰²çŠ¶æ€</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recoverState</span><span class="token punctuation">(</span><span class="token class-name">RoleStateMemento</span> roleStateMemento<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å°†å¤‡å¿˜å½•å¯¹è±¡ä¸­å­˜å‚¨çš„çŠ¶æ€èµ‹å€¼ç»™å½“å‰å¯¹è±¡çš„æˆå‘˜</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å±•ç¤ºçŠ¶æ€åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²ç”Ÿå‘½åŠ›: "</span> <span class="token operator">+</span> vit<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²æ”»å‡»åŠ›: "</span> <span class="token operator">+</span> atk<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²é˜²å¾¡åŠ›: "</span> <span class="token operator">+</span> def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> vit<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVit</span><span class="token punctuation">(</span><span class="token keyword">int</span> vit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> vit<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> atk<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAtk</span><span class="token punctuation">(</span><span class="token keyword">int</span> atk<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> atk<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> def<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDef</span><span class="token punctuation">(</span><span class="token keyword">int</span> def<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> def<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¤‡å¿˜å½•è§’è‰²ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleStateMemento</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> vit<span class="token punctuation">;</span> <span class="token comment">//ç”Ÿå‘½åŠ›</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> atk<span class="token punctuation">;</span> <span class="token comment">//æ”»å‡»åŠ›</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> def<span class="token punctuation">;</span> <span class="token comment">//é˜²å¾¡åŠ›</span>    <span class="token keyword">public</span> <span class="token class-name">RoleStateMemento</span><span class="token punctuation">(</span><span class="token keyword">int</span> vit<span class="token punctuation">,</span> <span class="token keyword">int</span> atk<span class="token punctuation">,</span> <span class="token keyword">int</span> def<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> vit<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> atk<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> def<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">RoleStateMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> vit<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVit</span><span class="token punctuation">(</span><span class="token keyword">int</span> vit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> vit<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> atk<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAtk</span><span class="token punctuation">(</span><span class="token keyword">int</span> atk<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> atk<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> def<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDef</span><span class="token punctuation">(</span><span class="token keyword">int</span> def<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> def<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¤‡å¿˜å½•å¯¹è±¡ç®¡ç†ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleStateCaretaker</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å£°æ˜ RoleStateMemento ç±»å‹çš„å˜é‡</span>    <span class="token keyword">private</span> <span class="token class-name">RoleStateMemento</span> roleStateMemento<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">RoleStateMemento</span> <span class="token function">getRoleStateMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> roleStateMemento<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRoleStateMemento</span><span class="token punctuation">(</span><span class="token class-name">RoleStateMemento</span> roleStateMemento<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>roleStateMemento <span class="token operator">=</span> roleStateMemento<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----å¤§æˆ˜bosså‰----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">GameRole</span> gameRole <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åˆå§‹çŠ¶æ€æ“ä½œ</span>        gameRole<span class="token punctuation">.</span><span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å°†è¯¥æ¸¸æˆè§’è‰²å†…éƒ¨çŠ¶æ€è¿›è¡Œå¤‡ä»½</span>        <span class="token comment">//åˆ›å»ºç®¡ç†è€…å¯¹è±¡</span>        <span class="token class-name">RoleStateCaretaker</span> roleStateCaretaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleStateCaretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        roleStateCaretaker<span class="token punctuation">.</span><span class="token function">setRoleStateMemento</span><span class="token punctuation">(</span>gameRole<span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----å¤§æˆ˜bosså----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----æ¢å¤ä¹‹å‰çŠ¶æ€----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">recoverState</span><span class="token punctuation">(</span>roleStateCaretaker<span class="token punctuation">.</span><span class="token function">getRoleStateMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">----å¤§æˆ˜bosså‰----è§’è‰²ç”Ÿå‘½åŠ›: 100è§’è‰²æ”»å‡»åŠ›: 100è§’è‰²é˜²å¾¡åŠ›: 100----å¤§æˆ˜bosså----è§’è‰²ç”Ÿå‘½åŠ›: 0è§’è‰²æ”»å‡»åŠ›: 0è§’è‰²é˜²å¾¡åŠ›: 0----æ¢å¤ä¹‹å‰çŠ¶æ€----è§’è‰²ç”Ÿå‘½åŠ›: 100è§’è‰²æ”»å‡»åŠ›: 100è§’è‰²é˜²å¾¡åŠ›: 100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åˆ†æï¼šç™½ç®±å¤‡å¿˜å½•æ¨¡å¼æ˜¯ç ´åå°è£…æ€§çš„ã€‚ä½†æ˜¯é€šè¿‡ç¨‹åºå‘˜è‡ªå¾‹ï¼ŒåŒæ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°æ¨¡å¼çš„å¤§éƒ¨åˆ†ç”¨æ„ã€‚</p></blockquote><h4 id="â€œé»‘ç®±â€å¤‡å¿˜å½•æ¨¡å¼">â€œé»‘ç®±â€å¤‡å¿˜å½•æ¨¡å¼</h4><p>å¤‡å¿˜å½•è§’è‰²å¯¹å‘èµ·äººå¯¹è±¡æä¾›ä¸€ä¸ªå®½æ¥å£ï¼Œè€Œä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªçª„æ¥å£ã€‚åœ¨ Java è¯­è¨€ä¸­ï¼Œå®ç°åŒé‡æ¥å£çš„åŠæ³•å°±æ˜¯å°†<strong>å¤‡å¿˜å½•ç±»</strong>è®¾è®¡æˆ<strong>å‘èµ·äººç±»</strong>çš„å†…éƒ¨æˆå‘˜ç±»ã€‚</p><p>å°† <code>RoleStateMemento</code> è®¾ä¸º <code>GameRole</code> çš„å†…éƒ¨ç±»ï¼Œä»è€Œå°† <code>RoleStateMemento</code> å¯¹è±¡å°è£…åœ¨ <code>GameRole</code> é‡Œé¢ï¼›åœ¨å¤–é¢æä¾›ä¸€ä¸ªæ ‡è¯†æ¥å£ <code>Memento</code> ç»™ <code>RoleStateCaretaker</code> åŠå…¶ä»–å¯¹è±¡ä½¿ç”¨ã€‚è¿™æ · <code>GameRole</code> ç±»çœ‹åˆ°çš„æ˜¯ <code>RoleStateMemento</code> æ‰€æœ‰çš„æ¥å£ï¼Œè€Œ <code>RoleStateCaretaker</code>  åŠå…¶ä»–å¯¹è±¡çœ‹åˆ°çš„ä»…ä»…æ˜¯æ ‡è¯†æ¥å£ <code>Memento</code> æ‰€æš´éœ²å‡ºæ¥çš„æ¥å£ï¼Œä»è€Œç»´æŠ¤äº†å°è£…å‹ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass GameRole {- vit : int- atk : int- def : int+ initState() void+ fight() void+ saveState() Memento+ recoverState(Memento memento) void}class RoleStateCaretaker {- memento Memento+ getMemento() Memento+ setMemento(Memento memento) void}class Memento {<< interafce >>}class GameRoel_RoleStateMemento {- vit : int- atk : int- def : int+ RoleStateMemento(int vit, int atk, int def)}GameRole <.. MementoRoleStateCaretaker o-- MementoMemento <|.. RoleStateMemento</pre><p>ä»£ç å¦‚ä¸‹ï¼š</p><p>çª„æ¥å£ <code>Memento</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡è¯†æ¥å£ï¼Œå› æ­¤æ²¡æœ‰å®šä¹‰å‡ºä»»ä½•çš„æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Memento</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å®šä¹‰å‘èµ·äººç±» <code>GameRole</code>ï¼Œå¹¶åœ¨å†…éƒ¨å®šä¹‰å¤‡å¿˜å½•å†…éƒ¨ç±» <code>RoleStateMemento</code>ï¼ˆè¯¥å†…éƒ¨ç±»è®¾ç½®ä¸ºç§æœ‰çš„ï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>æ¸¸æˆè§’è‰²ç±»<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameRole</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> vit<span class="token punctuation">;</span> <span class="token comment">//ç”Ÿå‘½åŠ›</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> atk<span class="token punctuation">;</span> <span class="token comment">//æ”»å‡»åŠ›</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> def<span class="token punctuation">;</span> <span class="token comment">//é˜²å¾¡åŠ›</span>    <span class="token comment">//åˆå§‹åŒ–çŠ¶æ€</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æˆ˜æ–—</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ä¿å­˜è§’è‰²çŠ¶æ€</span>    <span class="token keyword">public</span> <span class="token class-name">Memento</span> <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RoleStateMemento</span><span class="token punctuation">(</span>vit<span class="token punctuation">,</span> atk<span class="token punctuation">,</span> def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å›å¤è§’è‰²çŠ¶æ€</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recoverState</span><span class="token punctuation">(</span><span class="token class-name">Memento</span> memento<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">RoleStateMemento</span> roleStateMemento <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RoleStateMemento</span><span class="token punctuation">)</span> memento<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> roleStateMemento<span class="token punctuation">.</span><span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²ç”Ÿå‘½åŠ›ï¼š"</span> <span class="token operator">+</span> vit<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²æ”»å‡»åŠ›ï¼š"</span> <span class="token operator">+</span> atk<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²é˜²å¾¡åŠ›ï¼š"</span> <span class="token operator">+</span> def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> vit<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVit</span><span class="token punctuation">(</span><span class="token keyword">int</span> vit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> vit<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> atk<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAtk</span><span class="token punctuation">(</span><span class="token keyword">int</span> atk<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> atk<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> def<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDef</span><span class="token punctuation">(</span><span class="token keyword">int</span> def<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> def<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">RoleStateMemento</span> <span class="token keyword">implements</span> <span class="token class-name">Memento</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> vit<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> atk<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">int</span> def<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">RoleStateMemento</span><span class="token punctuation">(</span><span class="token keyword">int</span> vit<span class="token punctuation">,</span> <span class="token keyword">int</span> atk<span class="token punctuation">,</span> <span class="token keyword">int</span> def<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> vit<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> atk<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> def<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getVit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> vit<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVit</span><span class="token punctuation">(</span><span class="token keyword">int</span> vit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> vit<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAtk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> atk<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAtk</span><span class="token punctuation">(</span><span class="token keyword">int</span> atk<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> atk<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> def<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDef</span><span class="token punctuation">(</span><span class="token keyword">int</span> def<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> def<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è´Ÿè´£äººè§’è‰²ç±» <code>RoleStateCaretaker</code> èƒ½å¤Ÿå¾—åˆ°çš„å¤‡å¿˜å½•å¯¹è±¡æ˜¯ä»¥ <code>Memento</code> ä¸ºæ¥å£çš„ï¼Œç”±äºè¿™ä¸ªæ¥å£ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è¯†æ¥å£ï¼Œå› æ­¤è´Ÿè´£äººè§’è‰²ä¸å¯èƒ½æ”¹å˜è¿™ä¸ªå¤‡å¿˜å½•å¯¹è±¡çš„å†…å®¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è§’è‰²çŠ¶æ€ç®¡ç†è€…ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleStateCaretaker</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Memento</span> memento<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Memento</span> <span class="token function">getMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> memento<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMemento</span><span class="token punctuation">(</span><span class="token class-name">Memento</span> memento<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>memento <span class="token operator">=</span> memento<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯æµ‹è¯•ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------å¤§æˆ˜Bosså‰------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å¤§æˆ˜Bosså‰</span>        <span class="token class-name">GameRole</span> gameRole <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä¿å­˜è¿›åº¦</span>        <span class="token class-name">RoleStateCaretaker</span> roleStateCaretaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoleStateCaretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        roleStateCaretaker<span class="token punctuation">.</span><span class="token function">setMemento</span><span class="token punctuation">(</span>gameRole<span class="token punctuation">.</span><span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------å¤§æˆ˜Bosså------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å¤§æˆ˜Bossæ—¶ï¼ŒæŸè€—ä¸¥é‡</span>        gameRole<span class="token punctuation">.</span><span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------æ¢å¤ä¹‹å‰çŠ¶æ€------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¢å¤ä¹‹å‰çŠ¶æ€</span>        gameRole<span class="token punctuation">.</span><span class="token function">recoverState</span><span class="token punctuation">(</span>roleStateCaretaker<span class="token punctuation">.</span><span class="token function">getMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gameRole<span class="token punctuation">.</span><span class="token function">stateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-5">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li>æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ã€‚å½“ç”¨æˆ·éœ€è¦æ—¶èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å°†æ•°æ®æ¢å¤åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ã€‚</li><li>å®ç°äº†å†…éƒ¨çŠ¶æ€çš„å°è£…ã€‚é™¤äº†åˆ›å»ºå®ƒçš„å‘èµ·äººä¹‹å¤–ï¼Œå…¶ä»–å¯¹è±¡éƒ½ä¸èƒ½å¤Ÿè®¿é—®è¿™äº›çŠ¶æ€ä¿¡æ¯ã€‚</li><li>ç®€åŒ–äº†å‘èµ·äººç±»ã€‚å‘èµ·äººä¸éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„å„ä¸ªå¤‡ä»½ï¼Œæ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¤‡å¿˜å½•ä¸­ï¼Œå¹¶ç”±ç®¡ç†è€…è¿›è¡Œç®¡ç†ï¼Œè¿™ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚</li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li>èµ„æºæ¶ˆè€—å¤§ã€‚å¦‚æœè¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯è¿‡å¤šæˆ–è€…ç‰¹åˆ«é¢‘ç¹ï¼Œå°†ä¼šå ç”¨æ¯”è¾ƒå¤§çš„å†…å­˜èµ„æºã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-5">ä½¿ç”¨åœºæ™¯</h3><ul><li><p>éœ€è¦ä¿å­˜ä¸æ¢å¤æ•°æ®çš„åœºæ™¯ï¼Œå¦‚ç©æ¸¸æˆæ—¶çš„ä¸­é—´ç»“æœçš„å­˜æ¡£åŠŸèƒ½ã€‚</p></li><li><p>éœ€è¦æä¾›ä¸€ä¸ªå¯å›æ»šæ“ä½œçš„åœºæ™¯ï¼Œå¦‚ Wordã€è®°äº‹æœ¬ã€Photoshopï¼Œideaç­‰è½¯ä»¶åœ¨ç¼–è¾‘æ—¶æŒ‰ Ctrl+Z ç»„åˆé”®ï¼Œè¿˜æœ‰æ•°æ®åº“ä¸­äº‹åŠ¡æ“ä½œã€‚</p></li></ul><h2 id="è§£é‡Šå™¨æ¨¡å¼">è§£é‡Šå™¨æ¨¡å¼</h2><h3 id="æ¦‚è¿°-6">æ¦‚è¿°</h3><pre class="line-numbers language-none"><code class="language-none">1 + 2 + 3 + 4 - 5 &#x3D; ?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾è®¡ä¸€ä¸ªè½¯ä»¶ç”¨æ¥è¿›è¡ŒåŠ å‡è®¡ç®—ã€‚æˆ‘ä»¬ç¬¬ä¸€æƒ³æ³•å°±æ˜¯ä½¿ç”¨å·¥å…·ç±»ï¼Œæä¾›å¯¹åº”çš„åŠ æ³•å’Œå‡æ³•çš„å·¥å…·æ–¹æ³•ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç”¨äºä¸¤ä¸ªæ•´æ•°ç›¸åŠ </span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”¨äºä¸¤ä¸ªæ•´æ•°ç›¸åŠ </span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">,</span><span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”¨äºnä¸ªæ•´æ•°ç›¸åŠ </span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> i <span class="token operator">:</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> sum<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„å½¢å¼æ¯”è¾ƒå•ä¸€ã€æœ‰é™ï¼Œå¦‚æœå½¢å¼å˜åŒ–éå¸¸å¤šï¼Œè¿™å°±ä¸ç¬¦åˆè¦æ±‚ï¼Œå› ä¸ºåŠ æ³•å’Œå‡æ³•è¿ç®—ï¼Œä¸¤ä¸ªè¿ç®—ç¬¦ä¸æ•°å€¼å¯ä»¥æœ‰æ— é™ç§ç»„åˆæ–¹å¼ã€‚æ¯”å¦‚ 1+2+3+4+5ã€1+2+3-4 ç­‰ç­‰ã€‚</p><p>æ˜¾ç„¶ï¼Œç°åœ¨éœ€è¦ä¸€ç§ç¿»è¯‘è¯†åˆ«æœºå™¨ï¼Œèƒ½å¤Ÿè§£æç”±æ•°å­—ä»¥åŠ + - ç¬¦å·æ„æˆçš„åˆæ³•çš„è¿ç®—åºåˆ—ã€‚å¦‚æœæŠŠè¿ç®—ç¬¦å’Œæ•°å­—éƒ½çœ‹ä½œèŠ‚ç‚¹çš„è¯ï¼Œèƒ½å¤Ÿé€ä¸ªèŠ‚ç‚¹çš„è¿›è¡Œè¯»å–è§£æè¿ç®—ï¼Œè¿™å°±æ˜¯è§£é‡Šå™¨æ¨¡å¼çš„æ€ç»´ã€‚</p><p><strong>å®šä¹‰ï¼š</strong></p><blockquote><p>ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥æ ‡è¯†æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚</p></blockquote><p>åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†å¾…è§£å†³çš„é—®é¢˜ï¼Œæå–å‡ºè§„åˆ™ï¼ŒæŠ½è±¡ä¸ºä¸€ç§â€œè¯­è¨€â€ã€‚æ¯”å¦‚åŠ å‡æ³•è¿ç®—ï¼Œè§„åˆ™ä¸ºï¼šç”±æ•°å€¼å’ŒÂ±ç¬¦å·ç»„æˆçš„åˆæ³•åºåˆ—ï¼Œâ€œ1+3-2â€ å°±æ˜¯è¿™ç§è¯­è¨€çš„å¥å­ã€‚</p><p>è§£é‡Šå™¨å°±æ˜¯è¦è§£æå‡ºæ¥è¯­å¥çš„å«ä¹‰ã€‚ä½†æ˜¯å¦‚ä½•æè¿°è§„åˆ™å‘¢ï¼Ÿ</p><p><strong>æ–‡æ³•ï¼ˆè¯­æ³•ï¼‰è§„åˆ™ï¼š</strong></p><p>æ–‡æ³•æ˜¯ç”¨äºæè¿°è¯­è¨€çš„è¯­æ³•ç»“æ„çš„å½¢å¼è§„åˆ™ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">expression <span class="token operator">::</span><span class="token operator">=</span> value <span class="token operator">|</span> plus <span class="token operator">|</span> minusplus <span class="token operator">::</span><span class="token operator">=</span> expression â€˜<span class="token operator">+</span>â€™ expression   minus <span class="token operator">::</span><span class="token operator">=</span> expression â€˜<span class="token operator">-</span>â€™ expression  value <span class="token operator">::</span><span class="token operator">=</span> integer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„ï¼š è¿™é‡Œçš„ç¬¦å· â€œ::=â€ è¡¨ç¤º â€œå®šä¹‰ä¸ºâ€ çš„æ„æ€ï¼Œç«–çº¿ | è¡¨ç¤ºæˆ–ï¼Œå·¦å³çš„å…¶ä¸­ä¸€ä¸ªï¼Œå¼•å·å†…ä¸ºå­—ç¬¦æœ¬èº«ï¼Œå¼•å·å¤–ä¸ºè¯­æ³•ã€‚</p></blockquote><p>ä¸Šé¢è§„åˆ™æè¿°ä¸º ï¼š</p><p>è¡¨è¾¾å¼å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ plus æˆ–è€… minus è¿ç®—ï¼Œè€Œ plus å’Œ minus åˆæ˜¯ç”±è¡¨è¾¾å¼ç»“åˆè¿ç®—ç¬¦æ„æˆï¼Œå€¼çš„ç±»å‹ä¸ºæ•´å‹æ•°ã€‚</p><p><strong>æŠ½è±¡è¯­æ³•æ ‘ï¼š</strong></p><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstractSyntaxTreeï¼ŒASTï¼‰ï¼Œæˆ–ç®€ç§°è¯­æ³•æ ‘ï¼ˆSyntax treeï¼‰ï¼Œæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚</p><p>ç”¨æ ‘å½¢æ¥è¡¨ç¤ºç¬¦åˆæ–‡æ³•è§„åˆ™çš„å¥å­ã€‚</p><p><img src="./../design-pattern-behavioral2/image-20240227221540052.png" alt=""></p><h3 id="ç»“æ„-6">ç»“æ„</h3><p>è§£é‡Šå™¨æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p><ul><li><p>æŠ½è±¡è¡¨è¾¾å¼ï¼ˆAbstract Expressionï¼‰è§’è‰²ï¼šå®šä¹‰è§£é‡Šå™¨çš„æ¥å£ï¼Œçº¦å®šè§£é‡Šå™¨çš„è§£é‡Šæ“ä½œï¼Œä¸»è¦åŒ…å«è§£é‡Šæ–¹æ³• interpret()ã€‚</p></li><li><p>ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆTerminal  Expressionï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸ç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯ä¸€ä¸ªç»ˆç»“ç¬¦éƒ½æœ‰ä¸€ä¸ªå…·ä½“ç»ˆç»“è¡¨è¾¾å¼ä¸ä¹‹ç›¸å¯¹åº”ã€‚</p></li><li><p>éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆNonterminal Expressionï¼‰è§’è‰²ï¼šä¹Ÿæ˜¯æŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸éç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯æ¡è§„åˆ™éƒ½å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚</p></li><li><p>ç¯å¢ƒï¼ˆContextï¼‰è§’è‰²ï¼šé€šå¸¸åŒ…å«å„ä¸ªè§£é‡Šå™¨éœ€è¦çš„æ•°æ®æˆ–æ˜¯å…¬å…±çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ é€’è¢«æ‰€æœ‰è§£é‡Šå™¨å…±äº«çš„æ•°æ®ï¼Œåé¢çš„è§£é‡Šå™¨å¯ä»¥ä»è¿™é‡Œè·å–è¿™äº›å€¼ã€‚</p></li><li><p>å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼šä¸»è¦ä»»åŠ¡æ˜¯å°†éœ€è¦åˆ†æçš„å¥å­æˆ–è¡¨è¾¾å¼è½¬æ¢æˆä½¿ç”¨è§£é‡Šå™¨å¯¹è±¡æè¿°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åè°ƒç”¨è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒè§’è‰²é—´æ¥è®¿é—®è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ã€‚</p></li></ul><h3 id="æ¡ˆä¾‹å®ç°-6">æ¡ˆä¾‹å®ç°</h3><pre class="mermaid">classDiagramclass Context {- map : Map~Varlable, Integer~+ assign(Variable var, Integer value) void+ getValue(Variable var) int}class Variable {- name : String+ Variable(String name)+ interpret(Context context) void+ toString() String}class AbstractExpression {+ interpret(Context context) void}class Value {- value : int+ Value(int value)+ interpret(Context context) void+ toString() String}class Plus {- left : AbstractExpression- rigth : AbstractExpression+ Plus(AbstractExpression left, AbstractExpression right)+ interpret(Context context) void+ toString() String}class Minus {- left : AbstractExpression- rigth : AbstractExpression+ Minus(AbstractExpression left, AbstractExpression right)+ interpret(Context context) void+ toString() String}Context o-- VariableContext <.. VariableAbstractExpression <|-- VariableAbstractExpression <|--  PlusAbstractExpression --o PlusAbstractExpression <|--  MinusAbstractExpression --o  MinusAbstractExpression <|-- Value</pre><h3 id="ä¼˜ç¼ºç‚¹-6">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li><p>æ˜“äºæ”¹å˜å’Œæ‰©å±•æ–‡æ³•ã€‚</p><p>ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨ç±»æ¥è¡¨ç¤ºè¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç»§æ‰¿ç­‰æœºåˆ¶æ¥æ”¹å˜æˆ–æ‰©å±•æ–‡æ³•ã€‚æ¯ä¸€æ¡æ–‡æ³•è§„åˆ™éƒ½å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªç±»ï¼Œå› æ­¤å¯ä»¥æ–¹ä¾¿åœ°å®ç°ä¸€ä¸ªç®€å•çš„è¯­è¨€ã€‚</p></li><li><p>å®ç°æ–‡æ³•è¾ƒä¸ºå®¹æ˜“ã€‚</p><p>åœ¨æŠ½è±¡è¯­æ³•æ ‘ä¸­æ¯ä¸€ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ç±»çš„å®ç°æ–¹å¼éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œè¿™äº›ç±»çš„ä»£ç ç¼–å†™éƒ½ä¸ä¼šç‰¹åˆ«å¤æ‚ã€‚</p></li><li><p>å¢åŠ æ–°çš„è§£é‡Šè¡¨è¾¾å¼è¾ƒä¸ºæ–¹ä¾¿ã€‚</p><p>å¦‚æœç”¨æˆ·éœ€è¦å¢åŠ æ–°çš„è§£é‡Šè¡¨è¾¾å¼åªéœ€è¦å¯¹åº”å¢åŠ ä¸€ä¸ªæ–°çš„ç»ˆç»“ç¬¦è¡¨è¾¾å¼æˆ–éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»ï¼ŒåŸæœ‰è¡¨è¾¾å¼ç±»ä»£ç æ— é¡»ä¿®æ”¹ï¼Œç¬¦åˆ â€œå¼€é—­åŸåˆ™â€ã€‚</p></li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li><p>å¯¹äºå¤æ‚æ–‡æ³•éš¾ä»¥ç»´æŠ¤ã€‚</p><p>åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œæ¯ä¸€æ¡è§„åˆ™è‡³å°‘éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå› æ­¤å¦‚æœä¸€ä¸ªè¯­è¨€åŒ…å«å¤ªå¤šæ–‡æ³•è§„åˆ™ï¼Œç±»çš„ä¸ªæ•°å°†ä¼šæ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç®¡ç†å’Œç»´æŠ¤ã€‚</p></li></ul><ul><li><p>æ‰§è¡Œæ•ˆç‡è¾ƒä½ã€‚</p><p>ç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨äº†å¤§é‡çš„å¾ªç¯å’Œé€’å½’è°ƒç”¨ï¼Œå› æ­¤åœ¨è§£é‡Šè¾ƒä¸ºå¤æ‚çš„å¥å­æ—¶å…¶é€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”ä»£ç çš„è°ƒè¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚</p></li></ul><h3 id="ä½¿ç”¨åœºæ™¯-6">ä½¿ç”¨åœºæ™¯</h3><ul><li><p>å½“è¯­è¨€çš„æ–‡æ³•è¾ƒä¸ºç®€å•ï¼Œä¸”æ‰§è¡Œæ•ˆç‡ä¸æ˜¯å…³é”®é—®é¢˜æ—¶ã€‚</p></li><li><p>å½“é—®é¢˜é‡å¤å‡ºç°ï¼Œä¸”å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„è¯­è¨€æ¥è¿›è¡Œè¡¨è¾¾æ—¶ã€‚</p></li><li><p>å½“ä¸€ä¸ªè¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”è¯­è¨€ä¸­çš„å¥å­å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘çš„æ—¶å€™ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-07-è¡Œä¸ºå‹æ¨¡å¼ â… </title>
      <link href="/2024/02/05/design-pattern-behavioral/"/>
      <url>/2024/02/05/design-pattern-behavioral/</url>
      
        <content type="html"><![CDATA[<h1>è¡Œä¸ºå‹æ¨¡å¼ â… </h1><p>è¡Œä¸ºå‹æ¨¡å¼ç”¨äºæè¿°ç¨‹åºåœ¨è¿è¡Œæ—¶å¤æ‚çš„æµç¨‹æ§åˆ¶ï¼Œå³æè¿°å¤šä¸ªç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡éƒ½æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œå®ƒæ¶‰åŠç®—æ³•ä¸å¯¹è±¡é—´èŒè´£çš„åˆ†é…ã€‚</p><p>è¡Œä¸ºå‹æ¨¡å¼åˆ†ä¸º<strong>ç±»è¡Œä¸ºæ¨¡å¼</strong>å’Œ<strong>å¯¹è±¡è¡Œä¸ºæ¨¡å¼</strong>ï¼Œå‰è€…é‡‡ç”¨ç»§æ‰¿æœºåˆ¶æ¥åœ¨ç±»é—´åˆ†æ´¾è¡Œä¸ºï¼Œåè€…é‡‡ç”¨ç»„åˆæˆ–èšåˆåœ¨å¯¹è±¡é—´åˆ†é…è¡Œä¸ºã€‚ç”±äºç»„åˆå…³ç³»æˆ–èšåˆå…³ç³»æ¯”ç»§æ‰¿å…³ç³»è€¦åˆåº¦ä½ï¼Œæ»¡è¶³â€œåˆæˆå¤ç”¨åŸåˆ™â€ï¼Œæ‰€ä»¥å¯¹è±¡è¡Œä¸ºæ¨¡å¼æ¯”ç±»è¡Œä¸ºæ¨¡å¼å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚</p><p>è¡Œä¸ºå‹æ¨¡å¼åˆ†ä¸ºï¼š</p><ul><li>ç±»è¡Œä¸ºæ¨¡å¼<ul><li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</li><li>ç­–ç•¥æ¨¡å¼</li></ul></li><li>å¯¹è±¡è¡Œä¸ºæ¨¡å¼<ul><li>å‘½ä»¤æ¨¡å¼</li><li>èŒè´£é“¾æ¨¡å¼</li><li>çŠ¶æ€æ¨¡å¼</li><li>è§‚å¯Ÿè€…æ¨¡å¼</li><li>ä¸­ä»‹è€…æ¨¡å¼</li><li>è¿­ä»£å™¨æ¨¡å¼</li><li>è®¿é—®è€…æ¨¡å¼</li><li>å¤‡å¿˜å½•æ¨¡å¼</li><li>è§£é‡Šå™¨æ¨¡å¼</li></ul></li></ul><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p>åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå‘˜å¸¸å¸¸ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼šè®¾è®¡ä¸€ä¸ªç³»ç»Ÿæ—¶çŸ¥é“äº†ç®—æ³•æ‰€éœ€çš„å…³é”®æ­¥éª¤ï¼Œè€Œä¸”ç¡®å®šäº†è¿™äº›æ­¥éª¤çš„æ‰§è¡Œé¡ºåºï¼Œä½†æŸäº›æ­¥éª¤çš„å…·ä½“å®ç°è¿˜æœªçŸ¥ï¼Œæˆ–è€…è¯´æŸäº›æ­¥éª¤çš„å®ç°ä¸å…·ä½“çš„ç¯å¢ƒç›¸å…³ã€‚</p><p>ä¾‹å¦‚ï¼Œå»é“¶è¡ŒåŠç†ä¸šåŠ¡ä¸€èˆ¬è¦ç»è¿‡ä»¥ä¸‹4ä¸ªæµç¨‹ï¼šå–å·ã€æ’é˜Ÿã€åŠç†å…·ä½“ä¸šåŠ¡ã€å¯¹é“¶è¡Œå·¥ä½œäººå‘˜è¿›è¡Œè¯„åˆ†ç­‰ï¼Œå…¶ä¸­å–å·ã€æ’é˜Ÿå’Œå¯¹é“¶è¡Œå·¥ä½œäººå‘˜è¿›è¡Œè¯„åˆ†çš„ä¸šåŠ¡å¯¹æ¯ä¸ªå®¢æˆ·æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥åœ¨çˆ¶ç±»ä¸­å®ç°ï¼Œä½†æ˜¯åŠç†å…·ä½“ä¸šåŠ¡å´å› äººè€Œå¼‚ï¼Œå®ƒå¯èƒ½æ˜¯å­˜æ¬¾ã€å–æ¬¾æˆ–è€…è½¬è´¦ç­‰ï¼Œå¯ä»¥å»¶è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚</p><h3 id="ç»“æ„">ç»“æ„</h3><p>æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ul><li><p>æŠ½è±¡ç±»ï¼ˆAbstract Classï¼‰ï¼šè´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ã€‚å®ƒç”±ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å’Œè‹¥å¹²ä¸ªåŸºæœ¬æ–¹æ³•æ„æˆã€‚</p><ul><li><p>æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼ŒæŒ‰æŸç§é¡ºåºè°ƒç”¨å…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•ã€‚</p></li><li><p>åŸºæœ¬æ–¹æ³•ï¼šæ˜¯å®ç°ç®—æ³•å„ä¸ªæ­¥éª¤çš„æ–¹æ³•ï¼Œæ˜¯æ¨¡æ¿æ–¹æ³•çš„ç»„æˆéƒ¨åˆ†ã€‚åŸºæœ¬æ–¹æ³•åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š</p><ul><li><p>æŠ½è±¡æ–¹æ³•(Abstract Method) ï¼šä¸€ä¸ªæŠ½è±¡æ–¹æ³•ç”±æŠ½è±¡ç±»å£°æ˜ã€ç”±å…¶å…·ä½“å­ç±»å®ç°ã€‚</p></li><li><p>å…·ä½“æ–¹æ³•(Concrete Method) ï¼šä¸€ä¸ªå…·ä½“æ–¹æ³•ç”±ä¸€ä¸ªæŠ½è±¡ç±»æˆ–å…·ä½“ç±»å£°æ˜å¹¶å®ç°ï¼Œå…¶å­ç±»å¯ä»¥è¿›è¡Œè¦†ç›–ä¹Ÿå¯ä»¥ç›´æ¥ç»§æ‰¿ã€‚</p></li><li><p>é’©å­æ–¹æ³•(Hook Method) ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼ŒåŒ…æ‹¬ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•å’Œéœ€è¦å­ç±»é‡å†™çš„ç©ºæ–¹æ³•ä¸¤ç§ã€‚</p><p>ä¸€èˆ¬é’©å­æ–¹æ³•æ˜¯ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•ï¼Œè¿™ç±»æ–¹æ³•åä¸€èˆ¬ä¸º isXxxï¼Œè¿”å›å€¼ç±»å‹ä¸º boolean ç±»å‹ã€‚</p></li></ul></li></ul></li><li><p>å…·ä½“å­ç±»ï¼ˆConcrete Classï¼‰ï¼šå®ç°æŠ½è±¡ç±»ä¸­æ‰€å®šä¹‰çš„æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ç»„æˆæ­¥éª¤ã€‚</p></li></ul><h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3><p>ã€ä¾‹ã€‘ç‚’èœ</p><p>ç‚’èœçš„æ­¥éª¤æ˜¯å›ºå®šçš„ï¼Œåˆ†ä¸ºå€’æ²¹ã€çƒ­æ²¹ã€å€’è”¬èœã€å€’è°ƒæ–™å“ã€ç¿»ç‚’ç­‰æ­¥éª¤ã€‚ç°é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥ç”¨ä»£ç æ¨¡æ‹Ÿã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass AbstractClass {+ cookProcess() void+ pourOil() void+ heatOil() void+ pourVegetable() void+ fry() void}class ConcreteClass_BaoCai {+ pourVegetable() void+ pourSauce() void}class ConcreteClass_CaiXin {+ pourVegetable() void+ pourSauce() void}AbstractClass <|-- ConcreteClass_BaoCaiAbstractClass <|-- ConcreteClass_CaiXin</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æŠ½è±¡ç±»</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractClass</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ¨¡æ¿æ–¹æ³•å®šä¹‰</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">cookProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ç¬¬ä¸€æ­¥ï¼šå€’æ²¹</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pourOil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç¬¬äºŒæ­¥ï¼šçƒ­æ²¹</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">heatOil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç¬¬ä¸‰æ­¥ï¼šå€’è”¬èœ</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pourVegetable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç¬¬å››æ­¥ï¼šå€’è°ƒå‘³æ–™</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pourSauce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç¬¬äº”æ­¥ï¼šç¿»ç‚’</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pourOil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å€’æ²¹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ç¬¬äºŒæ­¥ï¼šçƒ­æ²¹æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥å®ç°</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">heatOil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çƒ­æ²¹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ç¬¬ä¸‰æ­¥ï¼šå€’è”¬èœæ˜¯ä¸ä¸€æ ·çš„ï¼ˆä¸€ä¸ªä¸‹åŒ…èœï¼Œä¸€ä¸ªæ˜¯ä¸‹èœå¿ƒï¼‰</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">pourVegetable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç¬¬å››æ­¥ï¼šå€’è°ƒå‘³æ–™æ˜¯ä¸ä¸€æ ·</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">pourSauce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç¬¬äº”æ­¥ï¼šç¿»ç‚’æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥å®ç°</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç‚’å•Šç‚’å•Šç‚’åˆ°ç†Ÿå•Š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç‚’åŒ…èœç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteClass_BaoCai</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractClass</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pourVegetable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸‹é”…çš„è”¬èœæ˜¯åŒ…èœ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pourSauce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸‹é”…çš„é…±æ–™æ˜¯è¾£æ¤’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//èœå¿ƒç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteClass_CaiXin</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractClass</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pourVegetable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸‹é”…çš„è”¬èœæ˜¯èœå¿ƒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pourSauce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸‹é”…çš„é…±æ–™æ˜¯è’œè“‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ç‚’åŒ…èœ</span>        <span class="token comment">//åˆ›å»ºå¯¹è±¡</span>        <span class="token class-name">ConcreteClass_BaoCai</span> baoCai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteClass_BaoCai</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨ç‚’èœçš„åŠŸèƒ½</span>        baoCai<span class="token punctuation">.</span><span class="token function">cookProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„ï¼šä¸ºé˜²æ­¢æ¶æ„æ“ä½œï¼Œä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®è¯ã€‚</p></blockquote><h3 id="ä¼˜ç¼ºç‚¹-é€‚ç”¨åœºæ™¯">ä¼˜ç¼ºç‚¹&amp;é€‚ç”¨åœºæ™¯</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><p>æé«˜ä»£ç å¤ç”¨æ€§</p><p>å°†ç›¸åŒéƒ¨åˆ†çš„ä»£ç æ”¾åœ¨æŠ½è±¡çš„çˆ¶ç±»ä¸­ï¼Œè€Œå°†ä¸åŒçš„ä»£ç æ”¾å…¥ä¸åŒçš„å­ç±»ä¸­ã€‚</p></li><li><p>å®ç°äº†åå‘æ§åˆ¶</p><p>é€šè¿‡ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å…¶å­ç±»çš„æ“ä½œï¼Œé€šè¿‡å¯¹å­ç±»çš„å…·ä½“å®ç°æ‰©å±•ä¸åŒçš„è¡Œä¸ºï¼Œå®ç°äº†åå‘æ§åˆ¶ ï¼Œå¹¶ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚</p></li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å¯¹æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œè®¾è®¡ä¹Ÿæ›´åŠ æŠ½è±¡ã€‚</li><li>çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ç”±å­ç±»å®ç°ï¼Œå­ç±»æ‰§è¡Œçš„ç»“æœä¼šå½±å“çˆ¶ç±»çš„ç»“æœï¼Œè¿™å¯¼è‡´ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒæé«˜äº†ä»£ç é˜…è¯»çš„éš¾åº¦ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>ç®—æ³•çš„æ•´ä½“æ­¥éª¤å¾ˆå›ºå®šï¼Œä½†å…¶ä¸­ä¸ªåˆ«éƒ¨åˆ†æ˜“å˜æ—¶ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå°†å®¹æ˜“å˜çš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ï¼Œä¾›å­ç±»å®ç°ã€‚</li><li>éœ€è¦é€šè¿‡å­ç±»æ¥å†³å®šçˆ¶ç±»ç®—æ³•ä¸­æŸä¸ªæ­¥éª¤æ˜¯å¦æ‰§è¡Œï¼Œå®ç°å­ç±»å¯¹çˆ¶ç±»çš„åå‘æ§åˆ¶ã€‚</li></ul><h3 id="JDKæºç è§£æ">JDKæºç è§£æ</h3><p>InputStream ç±»å°±ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚åœ¨ InputStream ç±»ä¸­å®šä¹‰äº†å¤šä¸ª <code>read()</code> æ–¹æ³•ï¼Œæˆªå–éƒ¨åˆ†å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">InputStream</span> <span class="token keyword">implements</span> <span class="token class-name">Closeable</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æŠ½è±¡æ–¹æ³•, è¦æ±‚å­ç±»å¿…é¡»é‡å†™</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">byte</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">//æ¨¡æ¿æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">byte</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> off<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>off <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> len <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> len <span class="token operator">></span> b<span class="token punctuation">.</span>length <span class="token operator">-</span> off<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">//åå‘æ§åˆ¶</span>        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨äº†æ— å‚çš„ read æ–¹æ³•, è€Œæ— å‚readæ˜¯æŠ½è±¡æ–¹æ³•, å› æ­¤ç”±å­ç±»å»é‡å†™. è¯¥æ–¹æ³•æ—¶æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ®</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        b<span class="token punctuation">[</span>off<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>c<span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//è¯»å–lenæ¬¡</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                c <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                b<span class="token punctuation">[</span>off <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>c<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ee<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> i<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç­–ç•¥æ¨¡å¼">ç­–ç•¥æ¨¡å¼</h2><h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3><p>å…ˆçœ‹ä¸‹é¢çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å»æ—…æ¸¸é€‰æ‹©å‡ºè¡Œæ¨¡å¼æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥éª‘è‡ªè¡Œè½¦ã€å¯ä»¥åæ±½è½¦ã€å¯ä»¥åç«è½¦ã€å¯ä»¥åé£æœºã€‚</p><p><img src="./../design-pattern-behavioral/image-20240205171810691.png" alt=""></p><p>ä½œä¸ºä¸€ä¸ªç¨‹åºçŒ¿ï¼Œå¼€å‘éœ€è¦é€‰æ‹©ä¸€æ¬¾å¼€å‘å·¥å…·ï¼Œå½“ç„¶å¯ä»¥è¿›è¡Œä»£ç å¼€å‘çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œå¯ä»¥é€‰æ‹© Idea è¿›è¡Œå¼€å‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ eclipse è¿›è¡Œå¼€å‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„ä¸€äº›å¼€å‘å·¥å…·ã€‚</p><p><img src="./../design-pattern-behavioral/image-20240205171826809.png" alt=""></p><p><strong>å®šä¹‰ï¼š</strong></p><p>â€‹è¯¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚ç­–ç•¥æ¨¡å¼å±äºå¯¹è±¡è¡Œä¸ºæ¨¡å¼ï¼Œå®ƒé€šè¿‡å¯¹ç®—æ³•è¿›è¡Œå°è£…ï¼ŒæŠŠä½¿ç”¨ç®—æ³•çš„è´£ä»»å’Œç®—æ³•çš„å®ç°åˆ†å‰²å¼€æ¥ï¼Œå¹¶å§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡å¯¹è¿™äº›ç®—æ³•è¿›è¡Œç®¡ç†ã€‚</p><h3 id="ç»“æ„-2">ç»“æ„</h3><p>ç­–ç•¥æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ul><li>æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰ç±»ï¼šè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡è§’è‰²ï¼Œé€šå¸¸ç”±ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»å®ç°ã€‚æ­¤è§’è‰²ç»™å‡ºæ‰€æœ‰çš„å…·ä½“ç­–ç•¥ç±»æ‰€éœ€çš„æ¥å£ã€‚</li><li>å…·ä½“ç­–ç•¥ï¼ˆConcrete Strategyï¼‰ç±»ï¼šå®ç°äº†æŠ½è±¡ç­–ç•¥å®šä¹‰çš„æ¥å£ï¼Œæä¾›å…·ä½“çš„ç®—æ³•å®ç°æˆ–è¡Œä¸ºã€‚</li><li>ç¯å¢ƒï¼ˆContextï¼‰ç±»ï¼šæŒæœ‰ä¸€ä¸ªç­–ç•¥ç±»çš„å¼•ç”¨ï¼Œæœ€ç»ˆç»™å®¢æˆ·ç«¯è°ƒç”¨ã€‚</li></ul><h3 id="æ¡ˆä¾‹-2">æ¡ˆä¾‹</h3><p>ã€ä¾‹ã€‘ä¿ƒé”€æ´»åŠ¨</p><p>ä¸€å®¶ç™¾è´§å…¬å¸åœ¨å®šå¹´åº¦çš„ä¿ƒé”€æ´»åŠ¨ã€‚é’ˆå¯¹ä¸åŒçš„èŠ‚æ—¥ï¼ˆæ˜¥èŠ‚ã€ä¸­ç§‹èŠ‚ã€åœ£è¯èŠ‚ï¼‰æ¨å‡ºä¸åŒçš„ä¿ƒé”€æ´»åŠ¨ï¼Œç”±ä¿ƒé”€å‘˜å°†ä¿ƒé”€æ´»åŠ¨å±•ç¤ºç»™å®¢æˆ·ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass SalesMan {- strategy : Strategy+ SalesMan(Strategy strategy)+ salesManSHow() void}class Strategy {+ show() void}class StrategyA {+ show() void}class StrategyB {+ show() void}class StrategyC {+ show() void}Strategy <|.. StrategyAStrategy <|.. StrategyBStrategy <|.. StrategyCSalesMan o-- Strategy</pre><p><strong>Code:</strong></p><p>å®šä¹‰ç™¾è´§å…¬å¸æ‰€æœ‰ä¿ƒé”€æ´»åŠ¨çš„å…±åŒæ¥å£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æŠ½è±¡ç­–ç•¥ç±»</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Strategy</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼ˆConcrete Strategyï¼‰ï¼šæ¯ä¸ªèŠ‚æ—¥å…·ä½“çš„ä¿ƒé”€æ´»åŠ¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç­–ç•¥A</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StrategyA</span> <span class="token keyword">implements</span> <span class="token class-name">Strategy</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¹°ä¸€é€ä¸€"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç­–ç•¥B</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StrategyB</span> <span class="token keyword">implements</span> <span class="token class-name">Strategy</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ»¡200å…ƒå‡50å…ƒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç­–ç•¥C</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StrategyC</span> <span class="token keyword">implements</span> <span class="token class-name">Strategy</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ»¡1000å…ƒåŠ ä¸€å…ƒæ¢è´­ä»»æ„200å…ƒä»¥ä¸‹å•†å“"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®šä¹‰ç¯å¢ƒè§’è‰²ï¼ˆContextï¼‰ï¼šç”¨äºè¿æ¥ä¸Šä¸‹æ–‡ï¼Œå³æŠŠä¿ƒé”€æ´»åŠ¨æ¨é”€ç»™å®¢æˆ·ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºé”€å”®å‘˜</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SalesMan</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Strategy</span> strategy<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">SalesMan</span><span class="token punctuation">(</span><span class="token class-name">Strategy</span> strategy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Strategy</span> <span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> strategy<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token class-name">Strategy</span> strategy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å‘å®¢æˆ·å±•ç¤ºä¿ƒé”€æ´»åŠ¨</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">salesManShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        strategy<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SalesMan</span> salesMan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SalesMan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StrategyA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        salesMan<span class="token punctuation">.</span><span class="token function">salesManShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        salesMan<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StrategyB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        salesMan<span class="token punctuation">.</span><span class="token function">salesManShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        salesMan<span class="token punctuation">.</span><span class="token function">setStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StrategyC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        salesMan<span class="token punctuation">.</span><span class="token function">salesManShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li><p>ç­–ç•¥ç±»ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢</p><p>ç”±äºç­–ç•¥ç±»éƒ½å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä½¿å®ƒä»¬ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚</p></li><li><p>æ˜“äºæ‰©å±•</p><p>å¢åŠ ä¸€ä¸ªæ–°çš„ç­–ç•¥åªéœ€è¦æ·»åŠ ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥ç±»å³å¯ï¼ŒåŸºæœ¬ä¸éœ€è¦æ”¹å˜åŸæœ‰çš„ä»£ç ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€œ</p></li><li><p>é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥ï¼ˆif elseï¼‰ï¼Œå……åˆ†ä½“ç°é¢å‘å¯¹è±¡è®¾è®¡æ€æƒ³ã€‚</p></li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li>å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚</li><li>ç­–ç•¥æ¨¡å¼å°†é€ æˆäº§ç”Ÿå¾ˆå¤šç­–ç•¥ç±»ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨äº«å…ƒæ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¯¹è±¡çš„æ•°é‡ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><ul><li>ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§æ—¶ï¼Œå¯å°†æ¯ä¸ªç®—æ³•å°è£…åˆ°ç­–ç•¥ç±»ä¸­ã€‚</li><li>ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§è¡Œä¸ºï¼Œå¹¶ä¸”è¿™äº›è¡Œä¸ºåœ¨è¿™ä¸ªç±»çš„æ“ä½œä¸­ä»¥å¤šä¸ªæ¡ä»¶è¯­å¥çš„å½¢å¼å‡ºç°ï¼Œå¯å°†æ¯ä¸ªæ¡ä»¶åˆ†æ”¯ç§»å…¥å®ƒä»¬å„è‡ªçš„ç­–ç•¥ç±»ä¸­ä»¥ä»£æ›¿è¿™äº›æ¡ä»¶è¯­å¥ã€‚</li><li>ç³»ç»Ÿä¸­å„ç®—æ³•å½¼æ­¤å®Œå…¨ç‹¬ç«‹ï¼Œä¸”è¦æ±‚å¯¹å®¢æˆ·éšè—å…·ä½“ç®—æ³•çš„å®ç°ç»†èŠ‚æ—¶ã€‚</li><li>ç³»ç»Ÿè¦æ±‚ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ä¸åº”è¯¥çŸ¥é“å…¶æ“ä½œçš„æ•°æ®æ—¶ï¼Œå¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥éšè—ä¸ç®—æ³•ç›¸å…³çš„æ•°æ®ç»“æ„ã€‚</li><li>å¤šä¸ªç±»åªåŒºåˆ«åœ¨è¡¨ç°è¡Œä¸ºä¸åŒï¼Œå¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©å…·ä½“è¦æ‰§è¡Œçš„è¡Œä¸ºã€‚</li></ul><h3 id="JDKæºç è§£æ-2">JDKæºç è§£æ</h3><p><code>Comparator</code> ä¸­çš„ç­–ç•¥æ¨¡å¼ã€‚åœ¨ Arrays ç±»ä¸­æœ‰ä¸€ä¸ª <code>sort()</code> æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LegacyMergeSort</span><span class="token punctuation">.</span>userRequested<span class="token punctuation">)</span>            <span class="token function">legacyMergeSort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token class-name">TimSort</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>length<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Arrays å°±æ˜¯ä¸€ä¸ªç¯å¢ƒè§’è‰²ç±»ï¼Œè¿™ä¸ª sort æ–¹æ³•å¯ä»¥ä¼ ä¸€ä¸ªæ–°ç­–ç•¥è®© Arrays æ ¹æ®è¿™ä¸ªç­–ç•¥æ¥è¿›è¡Œæ’åºã€‚å°±æ¯”å¦‚ä¸‹é¢çš„æµ‹è¯•ç±»ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> o1<span class="token punctuation">,</span> <span class="token class-name">Integer</span> o2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> o2 <span class="token operator">-</span> o1<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬åœ¨è°ƒç”¨ Arrays çš„ sort æ–¹æ³•æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„æ˜¯ Comparator æ¥å£çš„å­å®ç°ç±»å¯¹è±¡ã€‚æ‰€ä»¥ Comparator å……å½“çš„æ˜¯æŠ½è±¡ç­–ç•¥è§’è‰²ï¼Œè€Œå…·ä½“çš„å­å®ç°ç±»å……å½“çš„æ˜¯å…·ä½“ç­–ç•¥è§’è‰²ã€‚ç¯å¢ƒè§’è‰²ç±»ï¼ˆArraysï¼‰åº”è¯¥æŒæœ‰æŠ½è±¡ç­–ç•¥çš„å¼•ç”¨æ¥è°ƒç”¨ã€‚é‚£ä¹ˆï¼ŒArrays ç±»çš„ sort æ–¹æ³•åˆ°åº•æœ‰æ²¡æœ‰ä½¿ç”¨ Comparator å­å®ç°ç±»ä¸­çš„ <code>compare()</code> æ–¹æ³•å—ï¼Ÿè®©æˆ‘ä»¬ç»§ç»­æŸ¥çœ‹ TimSort ç±»çš„ <code>sort()</code> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">TimSort</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> lo<span class="token punctuation">,</span> <span class="token keyword">int</span> hi<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> c<span class="token punctuation">,</span>                         <span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> work<span class="token punctuation">,</span> <span class="token keyword">int</span> workBase<span class="token punctuation">,</span> <span class="token keyword">int</span> workLen<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">assert</span> c <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> lo <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> lo <span class="token operator">&lt;=</span> hi <span class="token operator">&amp;&amp;</span> hi <span class="token operator">&lt;=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token keyword">int</span> nRemaining  <span class="token operator">=</span> hi <span class="token operator">-</span> lo<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>nRemaining <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">// Arrays of size 0 and 1 are always sorted</span>        <span class="token comment">// If array is small, do a "mini-TimSort" with no merges</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>nRemaining <span class="token operator">&lt;</span> <span class="token constant">MIN_MERGE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> initRunLen <span class="token operator">=</span> <span class="token function">countRunAndMakeAscending</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> lo<span class="token punctuation">,</span> hi<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">binarySort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> lo<span class="token punctuation">,</span> hi<span class="token punctuation">,</span> lo <span class="token operator">+</span> initRunLen<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">&#125;</span>               <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">int</span> <span class="token function">countRunAndMakeAscending</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> lo<span class="token punctuation">,</span> <span class="token keyword">int</span> hi<span class="token punctuation">,</span><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">assert</span> lo <span class="token operator">&lt;</span> hi<span class="token punctuation">;</span>        <span class="token keyword">int</span> runHi <span class="token operator">=</span> lo <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>runHi <span class="token operator">==</span> hi<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">// Find end of run, and reverse range if descending</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>runHi<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// Descending</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>runHi <span class="token operator">&lt;</span> hi <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>runHi<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>runHi <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                runHi<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token function">reverseRange</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> lo<span class="token punctuation">,</span> runHi<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                              <span class="token comment">// Ascending</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>runHi <span class="token operator">&lt;</span> hi <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>runHi<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>runHi <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span>                runHi<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> runHi <span class="token operator">-</span> lo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­æœ€ç»ˆä¼šè·‘åˆ° <code>countRunAndMakeAscending()</code> è¿™ä¸ªæ–¹æ³•ä¸­ã€‚æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œåªç”¨äº† compare æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨ Arrays.sort æ–¹æ³•åªä¼ å…·ä½“ compare é‡å†™æ–¹æ³•çš„ç±»å¯¹è±¡å°±è¡Œï¼Œè¿™ä¹Ÿæ˜¯ Comparator æ¥å£ä¸­å¿…é¡»è¦å­ç±»å®ç°çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><h2 id="å‘½ä»¤æ¨¡å¼">å‘½ä»¤æ¨¡å¼</h2><h3 id="æ¦‚è¿°-3">æ¦‚è¿°</h3><p>æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å‡ºå»åƒé¥­éƒ½ä¼šé‡åˆ°ä¸‹é¢çš„åœºæ™¯ã€‚</p><p><img src="./../design-pattern-behavioral/image-20240215094950959.png" alt=""></p><p><strong>å®šä¹‰:</strong></p><p>å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚è¿™æ ·ä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šï¼Œè¿™æ ·æ–¹ä¾¿å°†å‘½ä»¤å¯¹è±¡è¿›è¡Œå­˜å‚¨ã€ä¼ é€’ã€è°ƒç”¨ã€å¢åŠ ä¸ç®¡ç†ã€‚</p><h3 id="ç»“æ„-3">ç»“æ„</h3><p>å‘½ä»¤æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ul><li>æŠ½è±¡å‘½ä»¤ç±»ï¼ˆCommandï¼‰è§’è‰²ï¼š å®šä¹‰å‘½ä»¤çš„æ¥å£ï¼Œå£°æ˜æ‰§è¡Œçš„æ–¹æ³•ã€‚</li><li>å…·ä½“å‘½ä»¤ï¼ˆConcrete  Commandï¼‰è§’è‰²ï¼šå…·ä½“çš„å‘½ä»¤ï¼Œå®ç°å‘½ä»¤æ¥å£ï¼›é€šå¸¸ä¼šæŒæœ‰æ¥æ”¶è€…ï¼Œå¹¶è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚</li><li>å®ç°è€…/æ¥æ”¶è€…ï¼ˆReceiverï¼‰è§’è‰²ï¼š æ¥æ”¶è€…ï¼ŒçœŸæ­£æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ã€‚ä»»ä½•ç±»éƒ½å¯èƒ½æˆä¸ºä¸€ä¸ªæ¥æ”¶è€…ï¼Œåªè¦å®ƒèƒ½å¤Ÿå®ç°å‘½ä»¤è¦æ±‚å®ç°çš„ç›¸åº”åŠŸèƒ½ã€‚</li><li>è°ƒç”¨è€…/è¯·æ±‚è€…ï¼ˆInvokerï¼‰è§’è‰²ï¼š è¦æ±‚å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œé€šå¸¸ä¼šæŒæœ‰å‘½ä»¤å¯¹è±¡ï¼Œå¯ä»¥æŒæœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ã€‚è¿™ä¸ªæ˜¯å®¢æˆ·ç«¯çœŸæ­£è§¦å‘å‘½ä»¤å¹¶è¦æ±‚å‘½ä»¤æ‰§è¡Œç›¸åº”æ“ä½œçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´ç›¸å½“äºä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å…¥å£ã€‚</li></ul><h3 id="æ¡ˆä¾‹å®ç°">æ¡ˆä¾‹å®ç°</h3><p>å°†ä¸Šé¢çš„æ¡ˆä¾‹ç”¨ä»£ç å®ç°ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦åˆ†æå‘½ä»¤æ¨¡å¼çš„è§’è‰²åœ¨è¯¥æ¡ˆä¾‹ä¸­ç”±è°æ¥å……å½“ã€‚</p><p>æœåŠ¡å‘˜ï¼š å°±æ˜¯è°ƒç”¨è€…è§’è‰²ï¼Œç”±å¥¹æ¥å‘èµ·å‘½ä»¤ã€‚</p><p>èµ„æ·±å¤§å¨ï¼š å°±æ˜¯æ¥æ”¶è€…è§’è‰²ï¼ŒçœŸæ­£å‘½ä»¤æ‰§è¡Œçš„å¯¹è±¡ã€‚</p><p>è®¢å•ï¼š å‘½ä»¤ä¸­åŒ…å«è®¢å•ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Command {+ execute() void}class OrderCommand {- receiver : SeniorChef- order : Order+ OrderCommand(SeniorChef, Order order)+ execute() void}class Waitor {+ commands : ArrayList~Command~+ setCommand(Command cmd) void+ orderUp() void}class Order {- diningTable : int- foodDir : Map~String, Integer~+ getDiningTable() int+ setDiningTable(int diningTable) void+ getFoodDir() Map~String, Integer~+ setFoodDir(String name, int num) void}class SeniorChef {+ makeFood(int num, String foodName) void}Waitor o-- Command : èšåˆCommand <|.. OrderCommand : å®ç°OrderCommand o-- Order : èšåˆOrderCommand o-- SeniorChef : èšåˆ</pre><p><strong>å‘½ä»¤æŠ½è±¡ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“å‘½ä»¤ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æŒæœ‰æ¥æ”¶è€…å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">SeniorChef</span> receiver<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Order</span> order<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">OrderCommand</span><span class="token punctuation">(</span><span class="token class-name">SeniorChef</span> receiver<span class="token punctuation">,</span> <span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>order <span class="token operator">=</span> order<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * æ‰§è¡Œå‘½ä»¤     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getDiningTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ¡Œçš„è®¢å•ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        order<span class="token punctuation">.</span><span class="token function">getFoodDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-></span> receiver<span class="token punctuation">.</span><span class="token function">makeFood</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getDiningTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ¡Œçš„è®¢å•å·²å®Œæˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è®¢å•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> diningTable<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> foodDir<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDiningTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> diningTable<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDiningTable</span><span class="token punctuation">(</span><span class="token keyword">int</span> diningTable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>diningTable <span class="token operator">=</span> diningTable<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token function">getFoodDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> foodDir<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFoodDir</span><span class="token punctuation">(</span><span class="token class-name">String</span> foodName<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        foodDir<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>foodName<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ¥æ”¶è€…</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¨å¸ˆç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeniorChef</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeFood</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token class-name">String</span> foodName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token string">"ä»½"</span> <span class="token operator">+</span> foodName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¯·æ±‚è€…</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Waitor</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æŒæœ‰å¤šä¸ªå‘½ä»¤å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Command</span><span class="token punctuation">></span></span> commands <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCommand</span><span class="token punctuation">(</span><span class="token class-name">Command</span> command<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å°†cmdå¯¹è±¡å­˜å‚¨åˆ°listé›†åˆä¸­</span>        commands<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å‘èµ·å‘½ä»¤åŠŸèƒ½, å–Šè®¢å•æ¥äº†</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">orderUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¾å¥³æœåŠ¡å‘˜ï¼šå®å’šï¼Œå¤§å¨ï¼Œæ–°è®¢å•æ¥äº†......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//éå†listé›†åˆ</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Command</span> command <span class="token operator">:</span> commands<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºç¬¬ä¸€ä¸ªè®¢å•å¯¹è±¡</span>        <span class="token class-name">Order</span> order1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        order1<span class="token punctuation">.</span><span class="token function">setDiningTable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        order1<span class="token punctuation">.</span><span class="token function">setFoodDir</span><span class="token punctuation">(</span><span class="token string">"è¥¿çº¢æŸ¿é¸¡è›‹é¢"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        order1<span class="token punctuation">.</span><span class="token function">setFoodDir</span><span class="token punctuation">(</span><span class="token string">"å°æ¯å¯ä¹"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºç¬¬äºŒä¸ªè®¢å•å¯¹è±¡</span>        <span class="token class-name">Order</span> order2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        order2<span class="token punctuation">.</span><span class="token function">setDiningTable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        order2<span class="token punctuation">.</span><span class="token function">setFoodDir</span><span class="token punctuation">(</span><span class="token string">"æ±¤è¾¾äºº"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        order2<span class="token punctuation">.</span><span class="token function">setFoodDir</span><span class="token punctuation">(</span><span class="token string">"å°è´é›ªç¢§"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºå¨å¸ˆå¯¹è±¡</span>        <span class="token class-name">SeniorChef</span> receiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeniorChef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºå‘½ä»¤å¯¹è±¡</span>        <span class="token class-name">Command</span> cmd1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderCommand</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> order1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Command</span> cmd2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderCommand</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> order2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºè°ƒç”¨è€…(æœåŠ¡å‘˜å¯¹è±¡)</span>        <span class="token class-name">Waitor</span> invoke <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Waitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        invoke<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>cmd1<span class="token punctuation">)</span><span class="token punctuation">;</span>        invoke<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>cmd2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®©æœåŠ¡å‘˜å‘èµ·å‘½ä»¤</span>        invoke<span class="token punctuation">.</span><span class="token function">orderUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-2">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li>é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚å‘½ä»¤æ¨¡å¼èƒ½å°†è°ƒç”¨æ“ä½œçš„å¯¹è±¡ä¸å®ç°è¯¥æ“ä½œçš„å¯¹è±¡è§£è€¦ã€‚</li><li>å¢åŠ æˆ–åˆ é™¤å‘½ä»¤éå¸¸æ–¹ä¾¿ã€‚é‡‡ç”¨å‘½ä»¤æ¨¡å¼å¢åŠ ä¸åˆ é™¤å‘½ä»¤ä¸ä¼šå½±å“å…¶ä»–ç±»ï¼Œå®ƒæ»¡è¶³â€œå¼€é—­åŸåˆ™â€ï¼Œå¯¹æ‰©å±•æ¯”è¾ƒçµæ´»ã€‚</li><li>å¯ä»¥å®ç°å®å‘½ä»¤ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸ç»„åˆæ¨¡å¼ç»“åˆï¼Œå°†å¤šä¸ªå‘½ä»¤è£…é…æˆä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤ã€‚</li><li>æ–¹ä¾¿å®ç° Undo å’Œ Redo æ“ä½œã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸åé¢ä»‹ç»çš„å¤‡å¿˜å½•æ¨¡å¼ç»“åˆï¼Œå®ç°å‘½ä»¤çš„æ’¤é”€ä¸æ¢å¤ã€‚</li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li>ä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚</li><li>ç³»ç»Ÿç»“æ„æ›´åŠ å¤æ‚ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</h3><ul><li>ç³»ç»Ÿéœ€è¦å°†è¯·æ±‚è°ƒç”¨è€…å’Œè¯·æ±‚æ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’ã€‚</li><li>ç³»ç»Ÿéœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æŒ‡å®šè¯·æ±‚ã€å°†è¯·æ±‚æ’é˜Ÿå’Œæ‰§è¡Œè¯·æ±‚ã€‚</li><li>ç³»ç»Ÿéœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€(Undo)æ“ä½œå’Œæ¢å¤(Redo)æ“ä½œã€‚</li></ul><h3 id="JDKæºç è§£æ-3">JDKæºç è§£æ</h3><p>Runable æ˜¯ä¸€ä¸ªå…¸å‹å‘½ä»¤æ¨¡å¼ï¼ŒRunnable æ‹…å½“å‘½ä»¤çš„è§’è‰²ï¼ŒThread å……å½“çš„æ˜¯è°ƒç”¨è€…ï¼Œstart æ–¹æ³•å°±æ˜¯å…¶æ‰§è¡Œæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å‘½ä»¤æ¥å£(æŠ½è±¡å‘½ä»¤è§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//è°ƒç”¨è€…</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Runnable</span> target<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>threadStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> started <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//â€»â€»â€»â€»â€»â€»â€»</span>            started <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    group<span class="token punctuation">.</span><span class="token function">threadStartFailed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">/* do nothing. If start0 threw a Throwable then                  it will be passed up the call stack */</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼šè°ƒç”¨ä¸€ä¸ª native æ–¹æ³• start0(), è°ƒç”¨ç³»ç»Ÿæ–¹æ³•ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ã€‚è€Œæ¥æ”¶è€…æ˜¯å¯¹ç¨‹åºå‘˜å¼€æ”¾çš„ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰æ¥æ”¶è€…ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * jdk Runnable å‘½ä»¤æ¨¡å¼ *TurnOffThread ï¼š å±äºå…·ä½“å‘½ä»¤è§’è‰² */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TurnOffThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">&#123;</span>     <span class="token keyword">private</span> <span class="token class-name">Receiver</span> receiver<span class="token punctuation">;</span>         <span class="token keyword">public</span> <span class="token class-name">TurnOffThread</span><span class="token punctuation">(</span><span class="token class-name">Receiver</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">this</span><span class="token punctuation">.</span>receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     receiver<span class="token punctuation">.</span><span class="token function">turnOFF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ¥æ”¶è€…</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Receiver</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">turnON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Receiver: å¼€ç¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">turnOFF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Receiver: å…³ç¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å®šä¹‰æ¥æ”¶è€…</span>        <span class="token class-name">Receiver</span> receiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Receiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//Runnableå……å½“å‘½ä»¤è§’è‰²</span>        <span class="token class-name">TurnOffThread</span> turnOffThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TurnOffThread</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//Threadå……å½“è°ƒç”¨è€…</span>        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>turnOffThread<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//startæ˜¯å…¶æ–¹æ³•</span>        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è´£ä»»é“¾æ¨¡å¼">è´£ä»»é“¾æ¨¡å¼</h2><h3 id="æ¦‚è¿°-4">æ¦‚è¿°</h3><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¸¸å¸¸ä¼šå‡ºç°è¿™æ ·çš„äº‹ä¾‹ï¼šä¸€ä¸ªè¯·æ±‚æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†ï¼Œä½†æ¯ä¸ªå¯¹è±¡çš„å¤„ç†æ¡ä»¶æˆ–æƒé™ä¸åŒã€‚ä¾‹å¦‚ï¼Œå…¬å¸å‘˜å·¥è¯·å‡ï¼Œå¯æ‰¹å‡çš„é¢†å¯¼æœ‰éƒ¨é—¨è´Ÿè´£äººã€å‰¯æ€»ç»ç†ã€æ€»ç»ç†ç­‰ï¼Œä½†æ¯ä¸ªé¢†å¯¼èƒ½æ‰¹å‡†çš„å¤©æ•°ä¸åŒï¼Œå‘˜å·¥å¿…é¡»æ ¹æ®è‡ªå·±è¦è¯·å‡çš„å¤©æ•°å»æ‰¾ä¸åŒçš„é¢†å¯¼ç­¾åï¼Œä¹Ÿå°±æ˜¯è¯´å‘˜å·¥å¿…é¡»è®°ä½æ¯ä¸ªé¢†å¯¼çš„å§“åã€ç”µè¯å’Œåœ°å€ç­‰ä¿¡æ¯ï¼Œè¿™å¢åŠ äº†éš¾åº¦ã€‚è¿™æ ·çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šï¼Œå¦‚æ‰¾é¢†å¯¼å‡ºå·®æŠ¥é”€ã€ç”Ÿæ´»ä¸­çš„ â€œå‡»é¼“ä¼ èŠ±â€ æ¸¸æˆç­‰ã€‚</p><p><strong>å®šä¹‰ï¼š</strong></p><p>åˆåèŒè´£é“¾æ¨¡å¼ï¼Œä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œå°†æ‰€æœ‰è¯·æ±‚çš„å¤„ç†è€…é€šè¿‡å‰ä¸€å¯¹è±¡è®°ä½å…¶ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è€Œè¿æˆä¸€æ¡é“¾ï¼›å½“æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå¯å°†è¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><h3 id="ç»“æ„-4">ç»“æ„</h3><p>èŒè´£é“¾æ¨¡å¼ä¸»è¦åŒ…å«ä»¥ä¸‹è§’è‰²:</p><ul><li>æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŠ½è±¡å¤„ç†æ–¹æ³•å’Œä¸€ä¸ªåç»§è¿æ¥ã€‚</li><li>å…·ä½“å¤„ç†è€…ï¼ˆConcrete Handlerï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡å¤„ç†è€…çš„å¤„ç†æ–¹æ³•ï¼Œåˆ¤æ–­èƒ½å¦å¤„ç†æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚åˆ™å¤„ç†ï¼Œå¦åˆ™å°†è¯¥è¯·æ±‚è½¬ç»™å®ƒçš„åç»§è€…ã€‚</li><li>å®¢æˆ·ç±»ï¼ˆClientï¼‰è§’è‰²ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚ï¼Œå®ƒä¸å…³å¿ƒå¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ã€‚</li></ul><h3 id="æ¡ˆä¾‹å®ç°-2">æ¡ˆä¾‹å®ç°</h3><p>ç°éœ€è¦å¼€å‘ä¸€ä¸ªè¯·å‡æµç¨‹æ§åˆ¶ç³»ç»Ÿã€‚è¯·å‡ä¸€å¤©ä»¥ä¸‹çš„å‡åªéœ€è¦å°ç»„é•¿åŒæ„å³å¯ï¼›è¯·å‡ 1 å¤©åˆ° 3 å¤©çš„å‡è¿˜éœ€è¦éƒ¨é—¨ç»ç†åŒæ„ï¼›è¯·æ±‚ 3 å¤©åˆ° 7 å¤©è¿˜éœ€è¦æ€»ç»ç†åŒæ„æ‰è¡Œã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Handler {# NUM_ONE = 1 : int# NUM_THREE = 3 : int# NUM_SEVEN = 7 : int- numStart : int- numEnd : int- nextHandler : Handler+ Handler(int numStart)+ Handler(int numStart, int numEnd)+ setNextHandler(Handler nextHandler) void+ submit(LeaveRequest leve) void+ handleLeavel(LeaveRequest leve) void}class GroupLeader {+ GroupLeader()+ handleLeave(LeaveRequest leve) void}class Manager {+ Manager()+ handleLeave(LeaveRequest leave) void}class GeneralManager {+ GeneralManager()+ handleLeave(LeaveRequest leave) void}class LeaveRequest {- name : String- num : int- content : String+ LeaveRequest(String name, int num, String content)+ getName() String+ getNum() int+ getContent() String}Handler <|-- GroupLeaderHandler <|-- ManagerHandler <|-- GeneralManagerHandler ..> LeaveRequest Handler <|-- Handler</pre><p><strong>è¯·å‡æ¡(æ­¤å¤„æŒ‡å…·ä½“çš„æ–¹å¼)</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeaveRequest</span><span class="token punctuation">&#123;</span>    <span class="token comment">//å§“å</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token comment">//è¯·å‡å¤©æ•°</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> days<span class="token punctuation">;</span>    <span class="token comment">//è¯·å‡å†…å®¹</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">LeaveRequest</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> days<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>days <span class="token operator">=</span> days<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>get<span class="token punctuation">,</span> set<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æŠ½è±¡å¤„ç†è€…ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">NUM_ONE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">NUM_THREE</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">NUM_SEVEN</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token comment">//è¯¥é¢†å¯¼å¤„ç†çš„è¯·æ±‚å¤©æ•°åŒºé—´</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> numStart<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> numEnd<span class="token punctuation">;</span>    <span class="token comment">//å£°æ˜åç»§è€…(ä¸Šçº§é¢†å¯¼)</span>    <span class="token keyword">private</span> <span class="token class-name">Handler</span> nextHandler<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> numStart<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>numStart <span class="token operator">=</span> numStart<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> numStart<span class="token punctuation">,</span> <span class="token keyword">int</span> numEnd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>numStart <span class="token operator">=</span> numStart<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>numEnd <span class="token operator">=</span> numEnd<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è›‡è€…ä¸Šçº§é¢†å¯¼å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNextHandler</span><span class="token punctuation">(</span><span class="token class-name">Handler</span> nextHandler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>nextHandler <span class="token operator">=</span> nextHandler<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å„çº§é¢†å¯¼å¤„ç†è¯·å‡æ¡çš„æ–¹æ³•</span>    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">handleLeave</span><span class="token punctuation">(</span><span class="token class-name">LeaveRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æäº¤è¯·å‡æ¡</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">LeaveRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¯¥é¢†å¯¼è¿›è¡Œå®¡æ‰¹</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleLeave</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å¦‚æœè¯¥é¢†å¯¼å¤„ç†ä¸äº†ï¼Œå°±äº¤ç»™ä¸Šçº§é¢†å¯¼å¤„ç†</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nextHandler <span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span>numEnd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nextHandler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>nextHandler<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµç¨‹ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å…·ä½“å¤„ç†è€…</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å°ç»„é•¿ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupLeader</span> <span class="token keyword">extends</span> <span class="token class-name">Handler</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">GroupLeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Handler</span><span class="token punctuation">.</span><span class="token constant">NUM_ONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">handleLeave</span><span class="token punctuation">(</span><span class="token class-name">LeaveRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è¯·å‡"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å¤©,"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å°ç»„é•¿å®¡æ‰¹: åŒæ„"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//éƒ¨é—¨ç»ç†ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">Handler</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Handler</span><span class="token punctuation">.</span><span class="token constant">NUM_ONE</span><span class="token punctuation">,</span> <span class="token class-name">Handler</span><span class="token punctuation">.</span><span class="token constant">NUM_THREE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">handleLeave</span><span class="token punctuation">(</span><span class="token class-name">LeaveRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è¯·å‡"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å¤©,"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"éƒ¨é—¨ç»ç†å®¡æ‰¹: åŒæ„"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ€»ç»ç†</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeneralManager</span> <span class="token keyword">extends</span> <span class="token class-name">Handler</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">GeneralManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Handler</span><span class="token punctuation">.</span><span class="token constant">NUM_THREE</span><span class="token punctuation">,</span> <span class="token class-name">Handler</span><span class="token punctuation">.</span><span class="token constant">NUM_SEVEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">handleLeave</span><span class="token punctuation">(</span><span class="token class-name">LeaveRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è¯·å‡"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å¤©,"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ€»ç»ç†å®¡æ‰¹: åŒæ„"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºè¯·å‡æ¡å¯¹è±¡</span>        <span class="token class-name">LeaveRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LeaveRequest</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"èº«ä½“ä¸é€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºå„çº§é¢†å¯¼å¯¹è±¡</span>        <span class="token class-name">GroupLeader</span> groupLeader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroupLeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Manager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">GeneralManager</span> generalManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneralManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®å¤„ç†è€…é“¾</span>        groupLeader<span class="token punctuation">.</span><span class="token function">setNextHandler</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">;</span>        manager<span class="token punctuation">.</span><span class="token function">setNextHandler</span><span class="token punctuation">(</span>generalManager<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å¼ ä¸‰æäº¤è¯·å‡ç”³è¯·</span>        groupLeader<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å“åº”ç»“æœ</strong></p><pre class="line-numbers language-none"><code class="language-none">å¼ ä¸‰è¯·å‡3å¤©,èº«ä½“ä¸é€‚å°ç»„é•¿å®¡æ‰¹: åŒæ„å¼ ä¸‰è¯·å‡3å¤©,èº«ä½“ä¸é€‚éƒ¨é—¨ç»ç†å®¡æ‰¹: åŒæ„æµç¨‹ç»“æŸ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-3">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li><p>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦</p><p>è¯¥æ¨¡å¼é™ä½äº†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…çš„è€¦åˆåº¦ã€‚</p></li><li><p>å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§</p><p>å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</p></li><li><p>å¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§</p><p>å½“å·¥ä½œæµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…ä¿®æ”¹å®ƒä»¬çš„æ¬¡åºï¼Œä¹Ÿå¯åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚</p></li><li><p>è´£ä»»é“¾ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„è¿æ¥</p><p>ä¸€ä¸ªå¯¹è±¡åªéœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œä¸éœ€ä¿æŒå…¶ä»–æ‰€æœ‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œè¿™é¿å…äº†ä½¿ç”¨ä¼—å¤šçš„ if æˆ–è€… ifÂ·Â·Â·else è¯­å¥ã€‚</p></li><li><p>è´£ä»»åˆ†æ‹…</p><p>æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼Œä¸èƒ½å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„å•ä¸€èŒè´£åŸåˆ™ã€‚</p></li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li>ä¸èƒ½ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸€å®šè¢«å¤„ç†ã€‚ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´ä¼ åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ã€‚</li><li>å¯¹æ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠå¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ã€‚</li><li>èŒè´£é“¾å»ºç«‹çš„åˆç†æ€§è¦é å®¢æˆ·ç«¯æ¥ä¿è¯ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šç”±äºèŒè´£é“¾çš„é”™è¯¯è®¾ç½®è€Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ï¼Œå¦‚å¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚</li></ul><h3 id="æºç è§£æ">æºç è§£æ</h3><p>åœ¨ JavaWeb åº”ç”¨å¼€å‘ä¸­ï¼ŒFilterChain æ˜¯èŒè´£é“¾ï¼ˆè¿‡æ»¤å™¨ï¼‰æ¨¡å¼çš„å…¸å‹åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯ Filter çš„æ¨¡æ‹Ÿå®ç°åˆ†æ:</p><ul><li>æ¨¡æ‹Ÿ web è¯·æ±‚ Request ä»¥åŠ web å“åº” Response</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Request</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Response</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ¨¡æ‹Ÿ web è¿‡æ»¤å™¨ Filter</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">Request</span> req<span class="token punctuation">,</span><span class="token class-name">Response</span> res<span class="token punctuation">,</span><span class="token class-name">FilterChain</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ¨¡æ‹Ÿå®ç°å…·ä½“è¿‡æ»¤å™¨</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FirstFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">,</span> <span class="token class-name">Response</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿‡æ»¤å™¨1 å‰ç½®å¤„ç†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å…ˆæ‰§è¡Œæ‰€æœ‰requestå†å€’åºæ‰§è¡Œæ‰€æœ‰response</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿‡æ»¤å™¨1 åç½®å¤„ç†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecondFilter</span>  <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">,</span> <span class="token class-name">Response</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿‡æ»¤å™¨2 å‰ç½®å¤„ç†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å…ˆæ‰§è¡Œæ‰€æœ‰requestå†å€’åºæ‰§è¡Œæ‰€æœ‰response</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿‡æ»¤å™¨2 åç½®å¤„ç†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ¨¡æ‹Ÿå®ç°è¿‡æ»¤å™¨é“¾ FilterChain</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterChain</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Filter</span><span class="token punctuation">></span></span> filters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// é“¾å¼è°ƒç”¨</span>    <span class="token keyword">public</span> <span class="token class-name">FilterChain</span> <span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token class-name">Filter</span> filter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">,</span> <span class="token class-name">Response</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨äº†ï¼Œç›´æ¥è¿”å›</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> filters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">Filter</span> filter <span class="token operator">=</span> filters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>        index<span class="token operator">++</span><span class="token punctuation">;</span>        filter<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯•ç±»</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Request</span>  req <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">;</span>        <span class="token class-name">FilterChain</span> filterChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filterChain<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FirstFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecondFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è§£è¯»åˆ†æ:</p><p>é¦–å…ˆ FilterChain.index æ˜¯æ ‡è®°å­—æ®µ, è®°å½•å½“å‰å¤„åœ¨ç¬¬å‡ ä¸ªè¿‡æ»¤å™¨</p><p>æ—¶åºå›¾å¦‚ä¸‹</p></blockquote><pre class="mermaid">sequenceDiagramparticipant C as FilterChainparticipant FF as FirstFilterparticipant SF as SecondFilterNote over C: å…ˆæ‹¿åˆ°å½“å‰è¿‡æ»¤å™¨ >> FirstFilterC ->> C: index++ >> 1C ->> FF: filter.doFilter(request, response, this)FF -->> FF: å‰ç½®å¤„ç†FF -->> C: chain.doFilter(request, response);C ->> C: æ‹¿åˆ°å½“å‰è¿‡æ»¤å™¨ >> SecondFilterC ->> C: index++ >> 2C ->> SF: filter.doFilter(request, response, this)SF -->> SF: å‰ç½®å¤„ç†SF -->> C: chain.doFilter(request, response);Note over C: index == filters.size() ? yesC ->> FF: returnFF -->> FF: åç½®å¤„ç†FF --x SF: æ–¹æ³•å‡ºæ ˆSF -->> SF: åç½®å¤„ç†SF --x C: æ–¹æ³•å‡ºæ ˆ</pre><h2 id="çŠ¶æ€æ¨¡å¼">çŠ¶æ€æ¨¡å¼</h2><h3 id="æ¦‚è¿°-5">æ¦‚è¿°</h3><p>ã€ä¾‹ã€‘é€šè¿‡æŒ‰é’®æ¥æ§åˆ¶ä¸€ä¸ªç”µæ¢¯çš„çŠ¶æ€ï¼Œä¸€ä¸ªç”µæ¢¯æœ‰å¼€é—¨çŠ¶æ€ï¼Œå…³é—¨çŠ¶æ€ï¼Œåœæ­¢çŠ¶æ€ï¼Œè¿è¡ŒçŠ¶æ€ã€‚æ¯ä¸€ç§çŠ¶æ€æ”¹å˜ï¼Œéƒ½æœ‰å¯èƒ½è¦æ ¹æ®å…¶ä»–çŠ¶æ€æ¥æ›´æ–°å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”µæ¢¯é—¨ç°åœ¨å¤„äºè¿è¡Œæ—¶çŠ¶æ€ï¼Œå°±ä¸èƒ½è¿›è¡Œå¼€é—¨æ“ä½œï¼Œè€Œå¦‚æœç”µæ¢¯é—¨æ˜¯åœæ­¢çŠ¶æ€ï¼Œå°±å¯ä»¥æ‰§è¡Œå¼€é—¨æ“ä½œã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass ILift {<< interface >>+ OPENING_STATE = 1 : int+ CLOSING_STATE = 2 : int+ RUNNING_STATE = 3 : int+ STOPPING_STATE = 4 : int+ setState(int state) void+ open() void+ close() void+ stop() void+ run() void}class Lift {- state : int+ setState(int state) void+ open() void+ close() void+ stop() void+ run() void}ILift <|.. Lift</pre><p><strong>ä½¿ç”¨è®¾è®¡æ¨¡å¼å‰ä»£ç </strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç”µæ¢¯æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Ilift</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å®šä¹‰4ä¸ªç”µæ¢¯çŠ¶æ€å¸¸é‡</span>    <span class="token keyword">int</span> <span class="token constant">OPENING_STATE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token constant">CLOSING_STATE</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token constant">RUNNING_STATE</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token constant">STOPPING_STATE</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token comment">//è®¾ç½®ç”µæ¢¯çŠ¶æ€çš„åŠŸèƒ½</span>    <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç”µæ¢¯æ“ä½œåŠŸèƒ½</span>    <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç”µæ¢¯å®ç°ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lift</span> <span class="token keyword">implements</span> <span class="token class-name">Ilift</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å£°æ˜ä¸€ä¸ªè®°å½•å½“å‰ç”µæ¢¯çš„çŠ¶æ€</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> <span class="token constant">OPENING_STATE</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>é—¨å·²ç»å¼€äº†ï¼Œä¸èƒ½å†å¼€é—¨äº†                <span class="token comment">//do nothing</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">CLOSING_STATE</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>å…³é—¨çŠ¶æ€ï¼Œé—¨æ‰“å¼€<span class="token operator">:</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯é—¨æ‰“å¼€äº†ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">OPENING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">RUNNING_STATE</span><span class="token operator">:</span>                <span class="token comment">//do nothing è¿è¡Œæ—¶ç”µæ¢¯ä¸èƒ½å¼€é—¨</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">STOPPING_STATE</span><span class="token operator">:</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯é—¨å¼€äº†ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”µæ¢¯åœäº†ï¼Œå¯ä»¥å¼€é—¨äº†</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">OPENING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> <span class="token constant">OPENING_STATE</span><span class="token operator">:</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯å…³é—¨äº†ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åªæœ‰å¼€é—¨çŠ¶æ€å¯ä»¥å…³é—­ç”µæ¢¯é—¨ï¼Œå¯ä»¥å¯¹åº”ç”µæ¢¯çŠ¶æ€è¡¨æ¥çœ‹</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">CLOSING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…³é—¨ä¹‹åç”µæ¢¯å°±æ˜¯å…³é—­çŠ¶æ€äº†</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">CLOSING_STATE</span><span class="token operator">:</span>                <span class="token comment">//do nothing //å·²ç»æ˜¯å…³é—¨çŠ¶æ€ï¼Œä¸èƒ½å…³é—¨</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">RUNNING_STATE</span><span class="token operator">:</span>                <span class="token comment">//do nothing //è¿è¡Œæ—¶ç”µæ¢¯é—¨æ˜¯å…³ç€çš„ï¼Œä¸èƒ½å…³é—¨</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">STOPPING_STATE</span><span class="token operator">:</span>                <span class="token comment">//do nothing //åœæ­¢æ—¶ç”µæ¢¯ä¹Ÿæ˜¯å…³ç€çš„ï¼Œä¸èƒ½å…³é—¨</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> <span class="token constant">OPENING_STATE</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ç”µæ¢¯ä¸èƒ½å¼€ç€é—¨å°±èµ°                <span class="token comment">//do nothing</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">CLOSING_STATE</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>é—¨å…³äº†ï¼Œå¯ä»¥è¿è¡Œäº†                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯å¼€å§‹è¿è¡Œäº†ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">RUNNING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç°åœ¨æ˜¯è¿è¡ŒçŠ¶æ€</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">RUNNING_STATE</span><span class="token operator">:</span>                <span class="token comment">//do nothing å·²ç»æ˜¯è¿è¡ŒçŠ¶æ€äº†</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">STOPPING_STATE</span><span class="token operator">:</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯å¼€å§‹è¿è¡Œäº†ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">RUNNING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> <span class="token constant">OPENING_STATE</span><span class="token operator">:</span> <span class="token comment">//å¼€é—¨çš„ç”µæ¢¯å·²ç»æ˜¯æ˜¯åœæ­¢çš„äº†(æ­£å¸¸æƒ…å†µä¸‹)</span>                <span class="token comment">//do nothing</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">CLOSING_STATE</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>å…³é—¨æ—¶æ‰å¯ä»¥åœæ­¢                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯åœæ­¢äº†ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">STOPPING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">RUNNING_STATE</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>è¿è¡Œæ—¶å½“ç„¶å¯ä»¥åœæ­¢äº†                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯åœæ­¢äº†ã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">STOPPING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token constant">STOPPING_STATE</span><span class="token operator">:</span>                <span class="token comment">//do nothing</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºç”µæ¢¯å¯¹è±¡</span>        <span class="token class-name">Lift</span> lift <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®å½“å‰ç”µæ¢¯çš„çŠ¶æ€</span>        lift<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">Ilift</span><span class="token punctuation">.</span><span class="token constant">OPENING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ‰“å¼€</span>        lift<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¸ä¼šæ‰§è¡Œ</span>        lift<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        lift<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        lift<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é—®é¢˜åˆ†æï¼š</p><ul><li>ä½¿ç”¨äº†å¤§é‡çš„ switchâ€¦case è¿™æ ·çš„åˆ¤æ–­ï¼ˆifâ€¦else ä¹Ÿæ˜¯ä¸€æ ·)ï¼Œä½¿ç¨‹åºçš„å¯é˜…è¯»æ€§å˜å·®ã€‚</li><li>æ‰©å±•æ€§å¾ˆå·®ã€‚å¦‚æœæ–°åŠ äº†æ–­ç”µçš„çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸Šé¢åˆ¤æ–­é€»è¾‘</li></ul><p><strong>å®šä¹‰ï¼š</strong></p><p>å¯¹æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼ŒæŠŠå¤æ‚çš„â€œåˆ¤æ–­é€»è¾‘â€æå–åˆ°ä¸åŒçš„çŠ¶æ€å¯¹è±¡ä¸­ï¼Œå…è®¸çŠ¶æ€å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚</p><h3 id="ç»“æ„-5">ç»“æ„</h3><p>çŠ¶æ€æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p><ul><li>ç¯å¢ƒï¼ˆContextï¼‰è§’è‰²ï¼šä¹Ÿç§°ä¸ºä¸Šä¸‹æ–‡ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·ç¨‹åºéœ€è¦çš„æ¥å£ï¼Œç»´æŠ¤ä¸€ä¸ªå½“å‰çŠ¶æ€ï¼Œå¹¶å°†ä¸çŠ¶æ€ç›¸å…³çš„æ“ä½œå§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡æ¥å¤„ç†ã€‚</li><li>æŠ½è±¡çŠ¶æ€ï¼ˆStateï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…ç¯å¢ƒå¯¹è±¡ä¸­çš„ç‰¹å®šçŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚</li><li>å…·ä½“çŠ¶æ€ï¼ˆConcrete  Stateï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚</li></ul><h3 id="æ¡ˆä¾‹å®ç°-3">æ¡ˆä¾‹å®ç°</h3><p>å¯¹ä¸Šè¿°ç”µæ¢¯çš„æ¡ˆä¾‹ä½¿ç”¨çŠ¶æ€æ¨¡å¼è¿›è¡Œæ”¹è¿›ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass LiftState {# context : Context+ setContext(Context) void+ open() void+ close() void+ stop() void+ run() void}class OpenningState {+ open() void+ close() void+ stop() void+ run() void}class ClosingState {+ open() void+ close() void+ stop() void+ run() void}class StoppingState {+ open() void+ close() void+ stop() void+ run() void}class RunningState {+ open() void+ close() void+ stop() void+ run() void}class Context {+ OPENNINGSTATE : OpenningState+ CLOSEINGSTATE : ClosingState+ RUNNINGSTATE : RunningState+ STOPPINGSTATE : StoppingState- liftState : LiftState+ getLiftState() LiftState+ setLiftState(LiftState liftState) void+ open() void+ close() void+ stop() void+ run() void}LiftState <|-- OpenningStateLiftState <|-- ClosingStateLiftState <|-- StoppingStateLiftState <|-- RunningStateOpenningState --o ContextClosingState --o ContextStoppingState --o ContextRunningState --o Context</pre><p><strong>ç¯å¢ƒè§’è‰²</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å®šä¹‰å¯¹åº”çŠ¶æ€å¯¹è±¡çš„å¸¸é‡</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">OpeningState</span> <span class="token constant">OPENING_STATE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpeningState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">ClosingState</span> <span class="token constant">CLOSING_STATE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClosingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">RunningState</span> <span class="token constant">RUNNING_STATE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RunningState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">StoppingState</span> <span class="token constant">STOPPING_STATE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StoppingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å®šä¹‰ä¸€ä¸ªå½“å‰ç”µæ¢¯çŠ¶æ€å˜é‡</span>    <span class="token keyword">private</span> <span class="token class-name">LiftState</span> liftState<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">LiftState</span> <span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> liftState<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è®¾ç½®å½“å‰çŠ¶æ€å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">LiftState</span> liftState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState <span class="token operator">=</span> liftState<span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®å½“å‰çŠ¶æ€å¯¹è±¡ä¸­çš„ Context å¯¹è±¡</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æŠ½è±¡çŠ¶æ€ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LiftState</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç¯å¢ƒè§’è‰²ç±»å˜é‡</span>    <span class="token keyword">protected</span> <span class="token class-name">Context</span> context<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContext</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ç”µæ¢¯å¼€å¯æ“ä½œ</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç”µæ¢¯å…³é—­æ“ä½œ</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç”µæ¢¯è¿è¡Œæ“ä½œ</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç”µæ¢¯åœæ­¢æ“ä½œ</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç”µæ¢¯å…·ä½“ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç”µæ¢¯å¼€å¯çŠ¶æ€ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OpeningState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span><span class="token punctuation">&#123;</span>    <span class="token comment">//å½“å‰çŠ¶æ€è¦æ‰§è¡Œçš„æ–¹æ³•</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯å¼€å¯..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä¿®æ”¹çŠ¶æ€</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">CLOSING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨å½“å‰çŠ¶æ€ä¸­çš„ context ä¸­çš„ close æ–¹æ³•</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»€ä¹ˆéƒ½ä¸åš</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»€ä¹ˆéƒ½ä¸åš</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”µæ¢¯å…³é—­çŠ¶æ€ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClosingState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ‰“å¼€</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">OPENING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯ä»¬å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">RUNNING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»€ä¹ˆéƒ½ä¸åš</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”µæ¢¯è¿è¡ŒçŠ¶æ€ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunningState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»€ä¹ˆéƒ½ä¸åš</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»€ä¹ˆéƒ½ä¸åš</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»€ä¹ˆéƒ½ä¸åš</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯æ­£åœ¨è¿è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">STOPPING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”µæ¢¯åœæ­¢çŠ¶æ€ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StoppingState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">OPENING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä»€ä¹ˆéƒ½ä¸åš</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">RUNNING_STATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”µæ¢¯åœæ­¢äº†..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºç¯å¢ƒè§’è‰²å¯¹è±¡</span>        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®å½“å‰ç”µæ¢¯çŠ¶æ€</span>        context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClosingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ¬èº«å¤„äºå…³é—­çŠ¶æ€</span>        context<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ‰“å¼€ç”µæ¢¯é—¨(å¯ä»¥)</span>        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å…³é—­ç”µæ¢¯é—¨(ç°åœ¨æ˜¯æ‰“å¼€çŠ¶æ€, å¯ä»¥å…³é—­)</span>        context<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//è¿è¡Œç”µæ¢¯(ç°åœ¨æ˜¯å…³é—­çŠ¶æ€, å¯ä»¥è¿è¡Œ)</span>        context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åœæ­¢ç”µæ¢¯(ç°åœ¨æ˜¯åœæ­¢çŠ¶æ€,å¯ä»¥åœæ­¢)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ç”µæ¢¯å¼€å¯...ç”µæ¢¯ä»¬å·²å…³é—­ç”µæ¢¯æ­£åœ¨è¿è¡Œç”µæ¢¯åœæ­¢äº†...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-4">ä¼˜ç¼ºç‚¹</h3><p><strong>1ï¼Œä¼˜ç‚¹ï¼š</strong></p><ul><li>å°†æ‰€æœ‰ä¸æŸä¸ªçŠ¶æ€æœ‰å…³çš„è¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°å¢åŠ æ–°çš„çŠ¶æ€ï¼Œåªéœ€è¦æ”¹å˜å¯¹è±¡çŠ¶æ€å³å¯æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚</li><li>å…è®¸çŠ¶æ€è½¬æ¢é€»è¾‘ä¸çŠ¶æ€å¯¹è±¡åˆæˆä¸€ä½“ï¼Œè€Œä¸æ˜¯æŸä¸€ä¸ªå·¨å¤§çš„æ¡ä»¶è¯­å¥å—ã€‚</li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><ul><li>çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚</li><li>çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚</li><li>çŠ¶æ€æ¨¡å¼å¯¹&quot;å¼€é—­åŸåˆ™&quot;çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯</h3><ul><li>å½“ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶æ ¹æ®çŠ¶æ€æ”¹å˜å®ƒçš„è¡Œä¸ºæ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨çŠ¶æ€æ¨¡å¼ã€‚</li><li>ä¸€ä¸ªæ“ä½œä¸­å«æœ‰åºå¤§çš„åˆ†æ”¯ç»“æ„ï¼Œå¹¶ä¸”è¿™äº›åˆ†æ”¯å†³å®šäºå¯¹è±¡çš„çŠ¶æ€æ—¶ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-06-ç»“æ„å‹æ¨¡å¼ â…¡</title>
      <link href="/2024/02/04/design-pattern-structural2/"/>
      <url>/2024/02/04/design-pattern-structural2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é“¾æ¥:</p><a href="/2024/01/23/design-pattern-structural/" title="è®¾è®¡æ¨¡å¼-05-ç»“æ„å‹æ¨¡å¼ â… ">ç»“æ„å‹æ¨¡å¼â… </a> </blockquote><h1>ç»“æ„å‹æ¨¡å¼ â…¡</h1><h2 id="5-å¤–è§‚æ¨¡å¼">5-å¤–è§‚æ¨¡å¼</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p>æœ‰äº›äººå¯èƒ½ç‚’è¿‡è‚¡ç¥¨ï¼Œä½†å…¶å®å¤§éƒ¨åˆ†äººéƒ½ä¸å¤ªæ‡‚ï¼Œè¿™ç§æ²¡æœ‰è¶³å¤Ÿäº†è§£è¯åˆ¸çŸ¥è¯†çš„æƒ…å†µä¸‹åšè‚¡ç¥¨æ˜¯å¾ˆå®¹æ˜“äºé’±çš„ï¼Œåˆšå¼€å§‹ç‚’è‚¡è‚¯å®šéƒ½ä¼šæƒ³ï¼Œå¦‚æœæœ‰ä¸ªæ‡‚è¡Œçš„å¸®å¸®æ‰‹å°±å¥½ï¼Œå…¶å®åŸºé‡‘å°±æ˜¯ä¸ªå¥½å¸®æ‰‹ï¼Œæ”¯ä»˜å®é‡Œå°±æœ‰è®¸å¤šçš„åŸºé‡‘ï¼Œå®ƒå°†æŠ•èµ„è€…åˆ†æ•£çš„èµ„é‡‘é›†ä¸­èµ·æ¥ï¼Œäº¤ç”±ä¸“ä¸šçš„ç»ç†äººè¿›è¡Œç®¡ç†ï¼ŒæŠ•èµ„äºè‚¡ç¥¨ã€å€ºåˆ¸ã€å¤–æ±‡ç­‰é¢†åŸŸï¼Œè€ŒåŸºé‡‘æŠ•èµ„çš„æ”¶ç›Šå½’æŒæœ‰è€…æ‰€æœ‰ï¼Œç®¡ç†æœºæ„æ”¶å–ä¸€å®šæ¯”ä¾‹çš„æ‰˜ç®¡ç®¡ç†è´¹ç”¨ã€‚</p><p><strong>å®šä¹‰ï¼š</strong></p><p>â€‹åˆåé—¨é¢æ¨¡å¼ï¼Œæ˜¯ä¸€ç§é€šè¿‡ä¸ºå¤šä¸ªå¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œè€Œä½¿è¿™äº›å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“è¢«è®¿é—®çš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼å¯¹å¤–æœ‰ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œå¤–éƒ¨åº”ç”¨ç¨‹åºä¸ç”¨å…³å¿ƒå†…éƒ¨å­ç³»ç»Ÿçš„å…·ä½“çš„ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦ï¼Œæé«˜äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚</p><p>â€‹å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼æ˜¯â€œè¿ªç±³ç‰¹æ³•åˆ™â€çš„å…¸å‹åº”ç”¨</p><p><img src="./../design-pattern-structural2/image-20240203233543993.png" alt=""></p><h3 id="ç»“æ„">ç»“æ„</h3><p>å¤–è§‚ï¼ˆFacadeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ul><li>å¤–è§‚ï¼ˆFacadeï¼‰è§’è‰²ï¼šä¸ºå¤šä¸ªå­ç³»ç»Ÿå¯¹å¤–æä¾›ä¸€ä¸ªå…±åŒçš„æ¥å£ã€‚</li><li>å­ç³»ç»Ÿï¼ˆSub Systemï¼‰è§’è‰²ï¼šå®ç°ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå®¢æˆ·å¯ä»¥é€šè¿‡å¤–è§‚è§’è‰²è®¿é—®å®ƒã€‚</li></ul><h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3><p>ã€ä¾‹ã€‘æ™ºèƒ½å®¶ç”µæ§åˆ¶</p><p>å°æ˜çš„çˆ·çˆ·å·²ç» 60 å²äº†ï¼Œä¸€ä¸ªäººåœ¨å®¶ç”Ÿæ´»ï¼šæ¯æ¬¡éƒ½éœ€è¦æ‰“å¼€ç¯ã€æ‰“å¼€ç”µè§†ã€æ‰“å¼€ç©ºè°ƒï¼›ç¡è§‰æ—¶å…³é—­ç¯ã€å…³é—­ç”µè§†ã€å…³é—­ç©ºè°ƒï¼›æ“ä½œèµ·æ¥éƒ½æ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥å°æ˜ç»™çˆ·çˆ·ä¹°äº†æ™ºèƒ½éŸ³ç®±ï¼Œå¯ä»¥é€šè¿‡è¯­éŸ³ç›´æ¥æ§åˆ¶è¿™äº›æ™ºèƒ½å®¶ç”µçš„å¼€å¯å’Œå…³é—­ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass SmartAppliancesFacade {- light : Light- tv : TV- airCondition : AirCondition+ SmartAppliancesFacade()+ say(String message) void- on() void- off() void} class Light {- on() void- off() void}class TV {- on() void- off() void}class AirCondition {- on() void- off() void}class Client {+ main() void}SmartAppliancesFacade o-- LightSmartAppliancesFacade o-- TVSmartAppliancesFacade o-- AirConditionSmartAppliancesFacade <.. Client</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç©ºè°ƒ</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AirCondition</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ‰“å¼€åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰“å¼€ç©ºè°ƒ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å…³é—­åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…³é—­ç©ºè°ƒ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”µç¯</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Light</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ‰“å¼€åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰“å¼€ç”µç¯..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å…³é—­åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…³é—­ç”µç¯..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”µè§†æœº</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TV</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ‰“å¼€åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰“å¼€ç”µè§†æœº..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å…³é—­åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…³é—­ç”µè§†æœº..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¤–è§‚ç±», ç”¨æˆ·ä¸»è¦å’Œè¯¥ç±»è¿›è¡Œäº¤äº’</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartAppliancesFacade</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//èšåˆç”µç¯,ç”µè§†æœº,ç©ºè°ƒ</span>    <span class="token keyword">private</span> <span class="token class-name">AirCondition</span> airCondition<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Light</span> light<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">TV</span> tv<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">SmartAppliancesFacade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        airCondition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AirCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//é€šè¿‡è¯­éŸ³æ§åˆ¶</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"æ‰“å¼€"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¿˜å¬ä¸æ‡‚ä½ è¯´çš„!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        light<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tv<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        airCondition<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        light<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tv<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        airCondition<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SmartAppliancesFacade</span> smartAppliancesFacade <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmartAppliancesFacade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        smartAppliancesFacade<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"æ‰“å¼€å®¶ç”µ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        smartAppliancesFacade<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"å…³é—­å®¶ç”µ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">æ‰“å¼€ç”µç¯...æ‰“å¼€ç”µè§†æœº...æ‰“å¼€ç©ºè°ƒ...&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å…³é—­ç”µç¯...å…³é—­ç”µè§†æœº...å…³é—­ç©ºè°ƒ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¥½å¤„ï¼š</strong></p><ul><li>é™ä½äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—å­ç³»ç»Ÿçš„å˜åŒ–ä¸ä¼šå½±å“è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»ã€‚</li><li>å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®ï¼Œå¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œä¿®æ”¹å¾ˆéº»çƒ¦</li></ul><h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><ul><li>å¯¹åˆ†å±‚ç»“æ„ç³»ç»Ÿæ„å»ºæ—¶ï¼Œä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰å­ç³»ç»Ÿä¸­æ¯å±‚çš„å…¥å£ç‚¹å¯ä»¥ç®€åŒ–å­ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li><li>å½“ä¸€ä¸ªå¤æ‚ç³»ç»Ÿçš„å­ç³»ç»Ÿå¾ˆå¤šæ—¶ï¼Œå¤–è§‚æ¨¡å¼å¯ä»¥ä¸ºç³»ç»Ÿè®¾è®¡ä¸€ä¸ªç®€å•çš„æ¥å£ä¾›å¤–ç•Œè®¿é—®ã€‚</li><li>å½“å®¢æˆ·ç«¯ä¸å¤šä¸ªå­ç³»ç»Ÿä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„è”ç³»æ—¶ï¼Œå¼•å…¥å¤–è§‚æ¨¡å¼å¯å°†å®ƒä»¬åˆ†ç¦»ï¼Œä»è€Œæé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§å’Œå¯ç§»æ¤æ€§ã€‚</li></ul><h3 id="æºç è§£æ">æºç è§£æ</h3><p>ä½¿ç”¨ tomcat ä½œä¸º web å®¹å™¨æ—¶ï¼Œæ¥æ”¶æµè§ˆå™¨å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œtomcat ä¼šå°†è¯·æ±‚ä¿¡æ¯å°è£…æˆ ServletRequest å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾â‘ å¤„å¯¹è±¡ã€‚ä½†æ˜¯å¤§å®¶æƒ³æƒ³ ServletRequest æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå­æ¥å£ HttpServletRequestï¼Œè€Œæˆ‘ä»¬çŸ¥é“è¯¥ request å¯¹è±¡è‚¯å®šæ˜¯ä¸€ä¸ª HttpServletRequest å¯¹è±¡çš„å­å®ç°ç±»å¯¹è±¡ï¼Œåˆ°åº•æ˜¯å“ªä¸ªç±»çš„å¯¹è±¡å‘¢ï¼Ÿå¯ä»¥é€šè¿‡è¾“å‡º request å¯¹è±¡ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°æ˜¯ä¸€ä¸ªåä¸º RequestFacade çš„ç±»çš„å¯¹è±¡ã€‚</p><p><img src="./../design-pattern-structural2/image-20240204102029943.png" alt=""></p><p>RequestFacade ç±»å°±ä½¿ç”¨äº†å¤–è§‚æ¨¡å¼ã€‚å…ˆçœ‹ç»“æ„å›¾ï¼š</p><pre class="mermaid">classDiagramclass ServletRequest { }class HttpServletRequest { }class RequestFacade {# request : Request}class Request { }ServletRequest <|-- HttpServletRequestHttpServletRequest <|.. RequestFacadeHttpServletRequest <|.. Request</pre><p><strong>ä¸ºä»€ä¹ˆåœ¨æ­¤å¤„ä½¿ç”¨å¤–è§‚æ¨¡å¼å‘¢ï¼Ÿ</strong></p><p>â€‹å®šä¹‰ RequestFacade ç±»ï¼Œåˆ†åˆ«å®ç° ServletRequest ï¼ŒåŒæ—¶å®šä¹‰ç§æœ‰æˆå‘˜å˜é‡ Request ï¼Œå¹¶ä¸”æ–¹æ³•çš„å®ç°è°ƒç”¨ Request  çš„å®ç°ã€‚ç„¶åï¼Œå°† RequestFacade ä¸Šè½¬ä¸º ServletRequest  ä¼ ç»™ servlet çš„ service æ–¹æ³•ï¼Œè¿™æ ·å³ä½¿åœ¨ servlet ä¸­è¢«ä¸‹è½¬ä¸º RequestFacade ï¼Œä¹Ÿä¸èƒ½è®¿é—®ç§æœ‰æˆå‘˜å˜é‡å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚æ—¢ç”¨äº† Request ï¼Œåˆèƒ½é˜²æ­¢å…¶ä¸­æ–¹æ³•è¢«ä¸åˆç†çš„è®¿é—®ã€‚</p><h2 id="6-ç»„åˆæ¨¡å¼">6-ç»„åˆæ¨¡å¼</h2><h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3><p><img src="./../design-pattern-structural2/image-20240204110542331.png" alt=""></p><p>â€‹å¯¹äºè¿™ä¸ªå›¾ç‰‡è‚¯å®šä¼šéå¸¸ç†Ÿæ‚‰ï¼Œä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹äºè¿™æ ·çš„ç»“æ„æˆ‘ä»¬ç§°ä¹‹ä¸ºæ ‘å½¢ç»“æ„ã€‚åœ¨æ ‘å½¢ç»“æ„ä¸­å¯ä»¥é€šè¿‡è°ƒç”¨æŸä¸ªæ–¹æ³•æ¥éå†æ•´ä¸ªæ ‘ï¼Œå½“æˆ‘ä»¬æ‰¾åˆ°æŸä¸ªå¶å­èŠ‚ç‚¹åï¼Œå°±å¯ä»¥å¯¹å¶å­èŠ‚ç‚¹è¿›è¡Œç›¸å…³çš„æ“ä½œã€‚å¯ä»¥å°†è¿™é¢—æ ‘ç†è§£æˆä¸€ä¸ªå¤§çš„å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢åŒ…å«å¾ˆå¤šçš„æˆå‘˜å¯¹è±¡ï¼Œè¿™äº›æˆå‘˜å¯¹è±¡å³å¯æ˜¯å®¹å™¨å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯å¶å­å¯¹è±¡ã€‚ä½†æ˜¯ç”±äºå®¹å™¨å¯¹è±¡å’Œå¶å­å¯¹è±¡åœ¨åŠŸèƒ½ä¸Šé¢çš„åŒºåˆ«ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¿…é¡»è¦åŒºåˆ†å®¹å™¨å¯¹è±¡å’Œå¶å­å¯¹è±¡ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šç»™å®¢æˆ·å¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä½œä¸ºå®¢æˆ·è€Œå·²ï¼Œå®ƒå§‹ç»ˆå¸Œæœ›èƒ½å¤Ÿä¸€è‡´çš„å¯¹å¾…å®¹å™¨å¯¹è±¡å’Œå¶å­å¯¹è±¡ã€‚</p><p><strong>å®šä¹‰ï¼š</strong></p><p>â€‹åˆåéƒ¨åˆ†æ•´ä½“æ¨¡å¼ï¼Œæ˜¯ç”¨äºæŠŠä¸€ç»„ç›¸ä¼¼çš„å¯¹è±¡å½“ä½œä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ã€‚ç»„åˆæ¨¡å¼ä¾æ®æ ‘å½¢ç»“æ„æ¥ç»„åˆå¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºéƒ¨åˆ†ä»¥åŠæ•´ä½“å±‚æ¬¡ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒåˆ›å»ºäº†å¯¹è±¡ç»„çš„æ ‘å½¢ç»“æ„ã€‚</p><h3 id="ç»“æ„-2">ç»“æ„</h3><p>ç»„åˆæ¨¡å¼ä¸»è¦åŒ…å«ä¸‰ç§è§’è‰²ï¼š</p><ul><li>æŠ½è±¡æ ¹èŠ‚ç‚¹ï¼ˆComponentï¼‰ï¼šå®šä¹‰ç³»ç»Ÿå„å±‚æ¬¡å¯¹è±¡çš„å…±æœ‰æ–¹æ³•å’Œå±æ€§ï¼Œå¯ä»¥é¢„å…ˆå®šä¹‰ä¸€äº›é»˜è®¤è¡Œä¸ºå’Œå±æ€§ã€‚</li><li>æ ‘æèŠ‚ç‚¹ï¼ˆCompositeï¼‰ï¼šå®šä¹‰æ ‘æèŠ‚ç‚¹çš„è¡Œä¸ºï¼Œå­˜å‚¨å­èŠ‚ç‚¹ï¼Œç»„åˆæ ‘æèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚</li><li>å¶å­èŠ‚ç‚¹ï¼ˆLeafï¼‰ï¼šå¶å­èŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶ä¸‹å†æ— åˆ†æ”¯ï¼Œæ˜¯ç³»ç»Ÿå±‚æ¬¡éå†çš„æœ€å°å•ä½ã€‚</li></ul><h3 id="å®ç°æ¡ˆä¾‹">å®ç°æ¡ˆä¾‹</h3><p>ã€ä¾‹ã€‘è½¯ä»¶èœå•</p><p>å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬åœ¨è®¿é—®åˆ«çš„ä¸€äº›ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œç»å¸¸å¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„èœå•ã€‚ä¸€ä¸ªèœå•å¯ä»¥åŒ…å«èœå•é¡¹ï¼ˆèœå•é¡¹æ˜¯æŒ‡ä¸å†åŒ…å«å…¶ä»–å†…å®¹çš„èœå•æ¡ç›®ï¼‰ï¼Œä¹Ÿå¯ä»¥åŒ…å«å¸¦æœ‰å…¶ä»–èœå•é¡¹çš„èœå•ï¼Œå› æ­¤ä½¿ç”¨ç»„åˆæ¨¡å¼æè¿°èœå•å°±å¾ˆæ°å½“ï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯é’ˆå¯¹ä¸€ä¸ªèœå•ï¼Œæ‰“å°å‡ºå…¶åŒ…å«çš„æ‰€æœ‰èœå•ä»¥åŠèœå•é¡¹çš„åç§°ã€‚</p><p><img src="./../design-pattern-structural2/image-20240204111024037.png" alt=""></p><p>ç±»å›¾:</p><pre class="mermaid">classDiagramclass MenuComponent {# name : String# level : int+ add(MenuComponent menuComponent) void+ remove(MenuComponenet menuComponent) void+ getChild(int i) MenuComponent+ getName() String+ print() void}class Menu {- menuComponentList : List~MenuComponent~+ Menu(String name, int level)+ add(MenuComponent menuComponent) void+ remove(MenuComponent menuComponent) void+ getChild(int i) MenuComponent+ print() void}class MenuItem {+ MenuItem(String name, int level)+ print() void}MenuComponent --o MenuMenuComponent <|-- MenuMenuComponent <|-- MenuItemclass Client {+ main(Stirng[] args) void+ createMenu() MenuComponent}link MenuComponent "#MenuComponent"link Menu "#Menu"link MenuItem "#MenuItem"link Client "#Clien1"</pre><h6 id="MenuComponent">MenuComponent</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//èœå•ç»„ä»¶(æŠ½è±¡æ ¹èŠ‚ç‚¹)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MenuComponent</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//èœå•ç»„ä»¶çš„åç§°</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token comment">//èœå•ç»„ä»¶çš„å±‚çº§</span>    <span class="token keyword">protected</span> <span class="token keyword">int</span> level<span class="token punctuation">;</span>    <span class="token comment">//æ·»åŠ å­èœå•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MenuComponent</span> menuComponent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ç§»å‡ºå­èœå•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">MenuComponent</span> menuComponent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–æŒ‡å®šçš„å­èœå•</span>    <span class="token keyword">public</span> <span class="token class-name">MenuComponent</span> <span class="token function">getChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–èœå•æˆ–è€…èœå•é¡¹çš„åç§°</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰“å°èœå•åç§°çš„æ–¹æ³•(åŒ…å«å­èœå•å’Œå­èœå•é¡¹)</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="Menu">Menu</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//èœå•ç±»(æ ‘æèŠ‚ç‚¹)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Menu</span> <span class="token keyword">extends</span> <span class="token class-name">MenuComponent</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//èœå•å¯ä»¥æœ‰å¤šä¸ªå­èœå•æˆ–è€…å­èœå•é¡¹</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MenuComponent</span><span class="token punctuation">></span></span> menuComponentList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ„é€ æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MenuComponent</span> menuComponent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        menuComponentList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menuComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">MenuComponent</span> menuComponent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        menuComponentList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>menuComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">MenuComponent</span> <span class="token function">getChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> menuComponentList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ‰“å°èœå•åç§°</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ‰“å°å­èœå•æˆ–è€…å­èœå•é¡¹åç§°</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MenuComponent</span> component <span class="token operator">:</span> menuComponentList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            component<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="MenuItem">MenuItem</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//èœå•é¡¹(å¶å­èŠ‚ç‚¹)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MenuItem</span> <span class="token keyword">extends</span> <span class="token class-name">MenuComponent</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MenuItem æ˜¯èœå•é¡¹ï¼Œä¸èƒ½å†æœ‰å­èœå•ï¼Œæ‰€ä»¥æ·»åŠ èœå•ï¼Œç§»é™¤èœå•å’Œè·å–å­èœå•çš„åŠŸèƒ½å¹¶ä¸èƒ½å®ç°ã€‚</p><h6 id="Clien1">Clien1</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºèœå•æ ‘</span>        <span class="token class-name">MenuComponent</span> menu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">"èœå•ç®¡ç†"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"é¡µé¢è®¿é—®"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"å±•å¼€èœå•"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"ç¼–è¾‘èœå•"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤èœå•"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"æ–°å¢èœå•"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MenuComponent</span> menu2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">"æƒé™ç®¡ç†"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"é¡µé¢è®¿é—®"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"æäº¤ä¿å­˜"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MenuComponent</span> menu3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">"è§’è‰²ç®¡ç†"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"é¡µé¢è®¿é—®"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"æ–°å¢è§’è‰²"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        menu3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MenuItem</span><span class="token punctuation">(</span><span class="token string">"ä¿®æ”¹è§’è‰²"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºä¸€çº§èœå•</span>        <span class="token class-name">MenuComponent</span> component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span><span class="token string">"ç³»ç»Ÿç®¡ç†"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        component<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menu1<span class="token punctuation">)</span><span class="token punctuation">;</span>        component<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menu2<span class="token punctuation">)</span><span class="token punctuation">;</span>        component<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>menu3<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ‰“å°èœå•åç§°(</span>        component<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-console" data-language="console"><code class="language-console">--ç³»ç»Ÿç®¡ç†----èœå•ç®¡ç†------é¡µé¢è®¿é—®------å±•å¼€èœå•------ç¼–è¾‘èœå•------åˆ é™¤èœå•------æ–°å¢èœå•----æƒé™ç®¡ç†----é¡µé¢è®¿é—®----æäº¤ä¿å­˜----è§’è‰²ç®¡ç†----é¡µé¢è®¿é—®----æ–°å¢è§’è‰²----ä¿®æ”¹è§’è‰²<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç»„åˆæ¨¡å¼çš„åˆ†ç±»">ç»„åˆæ¨¡å¼çš„åˆ†ç±»</h3><p>åœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼æ—¶ï¼Œæ ¹æ®æŠ½è±¡æ„ä»¶ç±»çš„å®šä¹‰å½¢å¼ï¼Œæˆ‘ä»¬å¯å°†ç»„åˆæ¨¡å¼åˆ†ä¸ºé€æ˜ç»„åˆæ¨¡å¼å’Œå®‰å…¨ç»„åˆæ¨¡å¼ä¸¤ç§å½¢å¼ã€‚</p><ul><li><p>é€æ˜ç»„åˆæ¨¡å¼</p><p>é€æ˜ç»„åˆæ¨¡å¼ä¸­ï¼ŒæŠ½è±¡æ ¹èŠ‚ç‚¹è§’è‰²ä¸­å£°æ˜äº†æ‰€æœ‰ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œæ¯”å¦‚åœ¨ç¤ºä¾‹ä¸­ <code>MenuComponent</code> å£°æ˜äº† <code>add</code>ã€<code>remove</code> ã€<code>getChild</code> æ–¹æ³•ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ç¡®ä¿æ‰€æœ‰çš„æ„ä»¶ç±»éƒ½æœ‰ç›¸åŒçš„æ¥å£ã€‚é€æ˜ç»„åˆæ¨¡å¼ä¹Ÿæ˜¯ç»„åˆæ¨¡å¼çš„æ ‡å‡†å½¢å¼ã€‚</p><p>é€æ˜ç»„åˆæ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä¸å¤Ÿå®‰å…¨ï¼Œå› ä¸ºå¶å­å¯¹è±¡å’Œå®¹å™¨å¯¹è±¡åœ¨æœ¬è´¨ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¶å­å¯¹è±¡ä¸å¯èƒ½æœ‰ä¸‹ä¸€ä¸ªå±‚æ¬¡çš„å¯¹è±¡ï¼Œå³ä¸å¯èƒ½åŒ…å«æˆå‘˜å¯¹è±¡ï¼Œå› æ­¤ä¸ºå…¶æä¾› add()ã€remove() ç­‰æ–¹æ³•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œè¿™åœ¨ç¼–è¯‘é˜¶æ®µä¸ä¼šå‡ºé”™ï¼Œä½†åœ¨è¿è¡Œé˜¶æ®µå¦‚æœè°ƒç”¨è¿™äº›æ–¹æ³•å¯èƒ½ä¼šå‡ºé”™ï¼ˆå¦‚æœæ²¡æœ‰æä¾›ç›¸åº”çš„é”™è¯¯å¤„ç†ä»£ç ï¼‰</p></li><li><p>å®‰å…¨ç»„åˆæ¨¡å¼</p><p>åœ¨å®‰å…¨ç»„åˆæ¨¡å¼ä¸­ï¼Œåœ¨æŠ½è±¡æ„ä»¶è§’è‰²ä¸­æ²¡æœ‰å£°æ˜ä»»ä½•ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨æ ‘æèŠ‚ç‚¹ <code>Menu</code> ç±»ä¸­å£°æ˜å¹¶å®ç°è¿™äº›æ–¹æ³•ã€‚å®‰å…¨ç»„åˆæ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä¸å¤Ÿé€æ˜ï¼Œå› ä¸ºå¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶å…·æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œä¸”å®¹å™¨æ„ä»¶ä¸­é‚£äº›ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•æ²¡æœ‰åœ¨æŠ½è±¡æ„ä»¶ç±»ä¸­å®šä¹‰ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸èƒ½å®Œå…¨é’ˆå¯¹æŠ½è±¡ç¼–ç¨‹ï¼Œå¿…é¡»æœ‰åŒºåˆ«åœ°å¯¹å¾…å¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶ã€‚</p></li></ul><pre class="mermaid">classDiagramclass MenuComponent {# name : String# level : int+ getName() String+ print() void}class Menu {- menuComponentList : List~MenuComponent~+ Menu(String name, int level)+ add(MenuComponent menuComponent) void+ remove(MenuComponent menuComponent) void+ getChild(int i) MenuComponent+ print() void}class MenuItem {+ MenuItem(String name, int level)+ print() void}MenuComponent --o MenuMenuComponent <|-- MenuMenuComponent <|-- MenuItemclass Client {+ main(Stirng[] args) void+ createMenu() MenuComponent}</pre><h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3><ul><li>ç»„åˆæ¨¡å¼å¯ä»¥æ¸…æ¥šåœ°å®šä¹‰åˆ†å±‚æ¬¡çš„å¤æ‚å¯¹è±¡ï¼Œè¡¨ç¤ºå¯¹è±¡çš„å…¨éƒ¨æˆ–éƒ¨åˆ†å±‚æ¬¡ï¼Œå®ƒè®©å®¢æˆ·ç«¯å¿½ç•¥äº†å±‚æ¬¡çš„å·®å¼‚ï¼Œæ–¹ä¾¿å¯¹æ•´ä¸ªå±‚æ¬¡ç»“æ„è¿›è¡Œæ§åˆ¶ã€‚</li><li>å®¢æˆ·ç«¯å¯ä»¥ä¸€è‡´åœ°ä½¿ç”¨ä¸€ä¸ªç»„åˆç»“æ„æˆ–å…¶ä¸­å•ä¸ªå¯¹è±¡ï¼Œä¸å¿…å…³å¿ƒå¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡è¿˜æ˜¯æ•´ä¸ªç»„åˆç»“æ„ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç ã€‚</li><li>åœ¨ç»„åˆæ¨¡å¼ä¸­å¢åŠ æ–°çš„æ ‘æèŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»å¯¹ç°æœ‰ç±»åº“è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚</li><li>ç»„åˆæ¨¡å¼ä¸ºæ ‘å½¢ç»“æ„çš„é¢å‘å¯¹è±¡å®ç°æä¾›äº†ä¸€ç§çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼Œ<strong>é€šè¿‡å¶å­èŠ‚ç‚¹å’Œæ ‘æèŠ‚ç‚¹çš„é€’å½’ç»„åˆï¼Œå¯ä»¥å½¢æˆå¤æ‚çš„æ ‘å½¢ç»“æ„ï¼Œä½†å¯¹æ ‘å½¢ç»“æ„çš„æ§åˆ¶å´éå¸¸ç®€å•</strong>ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</h3><p>ç»„åˆæ¨¡å¼æ­£æ˜¯åº”æ ‘å½¢ç»“æ„è€Œç”Ÿï¼Œæ‰€ä»¥ç»„åˆæ¨¡å¼çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯å‡ºç°æ ‘å½¢ç»“æ„çš„åœ°æ–¹ã€‚æ¯”å¦‚ï¼šæ–‡ä»¶ç›®å½•æ˜¾ç¤ºï¼Œå¤šçº§ç›®å½•å‘ˆç°ç­‰æ ‘å½¢ç»“æ„æ•°æ®çš„æ“ä½œã€‚</p><h2 id="7-äº«å…ƒæ¨¡å¼">7-äº«å…ƒæ¨¡å¼</h2><h3 id="æ¦‚è¿°-3">æ¦‚è¿°</h3><p><strong>å®šä¹‰ï¼š</strong></p><p>â€‹è¿ç”¨å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚å®ƒé€šè¿‡å…±äº«å·²ç»å­˜åœ¨çš„å¯¹è±¡æ¥å¤§å¹…åº¦å‡å°‘éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ•°é‡ã€é¿å…å¤§é‡ç›¸ä¼¼å¯¹è±¡çš„å¼€é”€ï¼Œä»è€Œæé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚</p><h3 id="ç»“æ„-3">ç»“æ„</h3><p>äº«å…ƒï¼ˆFlyweight ï¼‰æ¨¡å¼ä¸­å­˜åœ¨ä»¥ä¸‹ä¸¤ç§çŠ¶æ€ï¼š</p><ol><li>å†…éƒ¨çŠ¶æ€ï¼Œå³ä¸ä¼šéšç€ç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜çš„å¯å…±äº«éƒ¨åˆ†ã€‚</li><li>å¤–éƒ¨çŠ¶æ€ï¼ŒæŒ‡éšç¯å¢ƒæ”¹å˜è€Œæ”¹å˜çš„ä¸å¯ä»¥å…±äº«çš„éƒ¨åˆ†ã€‚äº«å…ƒæ¨¡å¼çš„å®ç°è¦é¢†å°±æ˜¯åŒºåˆ†åº”ç”¨ä¸­çš„è¿™ä¸¤ç§çŠ¶æ€ï¼Œå¹¶å°†å¤–éƒ¨çŠ¶æ€å¤–éƒ¨åŒ–ã€‚</li></ol><p>äº«å…ƒæ¨¡å¼çš„ä¸»è¦æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡äº«å…ƒè§’è‰²ï¼ˆFlyweightï¼‰ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»ï¼Œåœ¨æŠ½è±¡äº«å…ƒç±»ä¸­å£°æ˜äº†å…·ä½“äº«å…ƒç±»å…¬å…±çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥å‘å¤–ç•Œæä¾›äº«å…ƒå¯¹è±¡çš„å†…éƒ¨æ•°æ®ï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›æ–¹æ³•æ¥è®¾ç½®å¤–éƒ¨æ•°æ®ï¼ˆå¤–éƒ¨çŠ¶æ€ï¼‰ã€‚</li><li>å…·ä½“äº«å…ƒï¼ˆConcrete Flyweightï¼‰è§’è‰² ï¼šå®ƒå®ç°äº†æŠ½è±¡äº«å…ƒç±»ï¼Œç§°ä¸ºäº«å…ƒå¯¹è±¡ï¼›åœ¨å…·ä½“äº«å…ƒç±»ä¸­ä¸ºå†…éƒ¨çŠ¶æ€æä¾›äº†å­˜å‚¨ç©ºé—´ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥ç»“åˆå•ä¾‹æ¨¡å¼æ¥è®¾è®¡å…·ä½“äº«å…ƒç±»ï¼Œä¸ºæ¯ä¸€ä¸ªå…·ä½“äº«å…ƒç±»æä¾›å”¯ä¸€çš„äº«å…ƒå¯¹è±¡ã€‚</li><li>éäº«å…ƒï¼ˆUnsharable Flyweight)è§’è‰² ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŠ½è±¡äº«å…ƒç±»çš„å­ç±»éƒ½éœ€è¦è¢«å…±äº«ï¼Œä¸èƒ½è¢«å…±äº«çš„å­ç±»å¯è®¾è®¡ä¸ºéå…±äº«å…·ä½“äº«å…ƒç±»ï¼›å½“éœ€è¦ä¸€ä¸ªéå…±äº«å…·ä½“äº«å…ƒç±»çš„å¯¹è±¡æ—¶å¯ä»¥ç›´æ¥é€šè¿‡å®ä¾‹åŒ–åˆ›å»ºã€‚</li><li>äº«å…ƒå·¥å‚ï¼ˆFlyweight Factoryï¼‰è§’è‰² ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†äº«å…ƒè§’è‰²ã€‚å½“å®¢æˆ·å¯¹è±¡è¯·æ±‚ä¸€ä¸ªäº«å…ƒå¯¹è±¡æ—¶ï¼Œäº«å…ƒå·¥å‚æ£€æŸ»ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆè¦æ±‚çš„äº«å…ƒå¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨åˆ™æä¾›ç»™å®¢æˆ·ï¼›å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº«å…ƒå¯¹è±¡ã€‚</li></ul><h3 id="æ¡ˆä¾‹-2">æ¡ˆä¾‹</h3><p>ã€ä¾‹ã€‘ä¿„ç½—æ–¯æ–¹å—</p><p>ä¸‹é¢çš„å›¾ç‰‡æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ä¿„ç½—æ–¯æ–¹å—ä¸­çš„ä¸€ä¸ªä¸ªæ–¹å—ï¼Œå¦‚æœåœ¨ä¿„ç½—æ–¯æ–¹å—è¿™ä¸ªæ¸¸æˆä¸­ï¼Œæ¯ä¸ªä¸åŒçš„æ–¹å—éƒ½æ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°±è¦å ç”¨å¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œä¸‹é¢åˆ©ç”¨äº«å…ƒæ¨¡å¼è¿›è¡Œå®ç°ã€‚</p><p><img src="./../design-pattern-structural2/image-20240204143619241.png" alt=""></p><p><strong>ç±»å›¾</strong></p><pre class="mermaid">classDiagramclass AbstractBox {+ getShape() String+ display(String color) void}class BoxFactory {- map : HashMap~String, AbstractBox~- BoxFactory()+ getInstance() BoxFactory+ getBox(String key) AbstractBox}class IBox {+ getShape() String}class LBox {+ getShape() String}class OBox {+ getShape() String}AbstractBox <| -- IBoxAbstractBox <| -- LBoxAbstractBox <| -- OBoxBoxFactory o-- AbstractBox : èšåˆ</pre><p><strong>Code:</strong></p><p>ä¿„ç½—æ–¯æ–¹å—æœ‰ä¸åŒçš„å½¢çŠ¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›å½¢çŠ¶å‘ä¸ŠæŠ½å–å‡º AbstractBoxï¼Œç”¨æ¥å®šä¹‰å…±æ€§çš„å±æ€§å’Œè¡Œä¸ºã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æŠ½è±¡äº«å…ƒè§’è‰²</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbastractBox</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è·å–å›¾å½¢çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">getShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ˜¾ç¤ºå›¾å½¢åŠé¢œè‰²</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token class-name">String</span> color<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–¹å—å½¢çŠ¶: "</span> <span class="token operator">+</span> <span class="token function">getShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", é¢œè‰²: "</span> <span class="token operator">+</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯å®šä¹‰ä¸åŒçš„å½¢çŠ¶äº†ï¼ŒIBoxç±»ã€LBoxç±»ã€OBoxç±»ç­‰ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Iå›¾å½¢ç±»(å…·ä½“äº«å…ƒè§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IBox</span> <span class="token keyword">extends</span> <span class="token class-name">AbastractBox</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"I"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//Lå›¾å½¢ç±»(å…·ä½“äº«å…ƒè§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LBox</span> <span class="token keyword">extends</span> <span class="token class-name">AbastractBox</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"L"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//Oå›¾å½¢ç±»(å…·ä½“äº«å…ƒè§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OBox</span> <span class="token keyword">extends</span> <span class="token class-name">AbastractBox</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"O"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æä¾›ä¸€ä¸ªå·¥å‚ç±»ï¼ˆBoxFactoryï¼‰ï¼Œç”¨æ¥ç®¡ç†äº«å…ƒå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ AbstractBox å­ç±»å¯¹è±¡ï¼‰ï¼Œè¯¥å·¥å‚ç±»å¯¹è±¡åªéœ€è¦ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚å¹¶ç»™å·¥å‚ç±»æä¾›ä¸€ä¸ªè·å–å½¢çŠ¶çš„æ–¹æ³•ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å·¥å‚ç±», å°†è¯¥ç±»è®¾è®¡ä¸ºå•ä¾‹æ¨¡å¼</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoxFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">AbastractBox</span><span class="token punctuation">></span></span> map<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">BoxFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"O"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æä¾›æ–¹æ³•è·å–è¯¥å·¥å‚ç±»å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BoxFactory</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant">FACTORY</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">BoxFactory</span> <span class="token constant">FACTORY</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BoxFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ ¹æ®åç§°è·å–å›¾å½¢å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token class-name">AbastractBox</span> <span class="token function">getShape</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è·å–Iå›¾å½¢å¯¹è±¡</span>        <span class="token class-name">AbastractBox</span> box1 <span class="token operator">=</span> <span class="token class-name">BoxFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getShape</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        box1<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"ç°è‰²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–Lå›¾å½¢å¯¹è±¡</span>        <span class="token class-name">AbastractBox</span> box2 <span class="token operator">=</span> <span class="token class-name">BoxFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getShape</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        box2<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"ç»¿è‰²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–Oå›¾å½¢å¯¹è±¡</span>        <span class="token class-name">AbastractBox</span> box3 <span class="token operator">=</span> <span class="token class-name">BoxFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getShape</span><span class="token punctuation">(</span><span class="token string">"O"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        box3<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"ç´«è‰²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–Oå›¾å½¢å¯¹è±¡</span>        <span class="token class-name">AbastractBox</span> box4 <span class="token operator">=</span> <span class="token class-name">BoxFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getShape</span><span class="token punctuation">(</span><span class="token string">"O"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        box4<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"çº¢è‰²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸¤æ¬¡è·å–åˆ°çš„Oå›¾å½¢æ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>box3 <span class="token operator">==</span> box4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-console" data-language="console"><code class="language-console">æ–¹å—å½¢çŠ¶: I, é¢œè‰²: ç°è‰²æ–¹å—å½¢çŠ¶: L, é¢œè‰²: ç»¿è‰²æ–¹å—å½¢çŠ¶: O, é¢œè‰²: ç´«è‰²æ–¹å—å½¢çŠ¶: O, é¢œè‰²: çº¢è‰²ä¸¤æ¬¡è·å–åˆ°çš„Oå›¾å½¢æ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹å’Œä½¿ç”¨åœºæ™¯">ä¼˜ç¼ºç‚¹å’Œä½¿ç”¨åœºæ™¯</h3><p><strong>1ï¼Œä¼˜ç‚¹</strong></p><ul><li>æå¤§å‡å°‘å†…å­˜ä¸­ç›¸ä¼¼æˆ–ç›¸åŒå¯¹è±¡æ•°é‡ï¼ŒèŠ‚çº¦ç³»ç»Ÿèµ„æºï¼Œæä¾›ç³»ç»Ÿæ€§èƒ½</li><li>äº«å…ƒæ¨¡å¼ä¸­çš„å¤–éƒ¨çŠ¶æ€ç›¸å¯¹ç‹¬ç«‹ï¼Œä¸”ä¸å½±å“å†…éƒ¨çŠ¶æ€</li></ul><p><strong>2ï¼Œç¼ºç‚¹ï¼š</strong></p><p>ä¸ºäº†ä½¿å¯¹è±¡å¯ä»¥å…±äº«ï¼Œéœ€è¦å°†äº«å…ƒå¯¹è±¡çš„éƒ¨åˆ†çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œåˆ†ç¦»å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œä½¿ç¨‹åºé€»è¾‘å¤æ‚</p><p><strong>3ï¼Œä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li>ä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡ç›¸åŒæˆ–è€…ç›¸ä¼¼çš„å¯¹è±¡ï¼Œé€ æˆå†…å­˜çš„å¤§é‡è€—è´¹ã€‚</li><li>å¯¹è±¡çš„å¤§éƒ¨åˆ†çŠ¶æ€éƒ½å¯ä»¥å¤–éƒ¨åŒ–ï¼Œå¯ä»¥å°†è¿™äº›å¤–éƒ¨çŠ¶æ€ä¼ å…¥å¯¹è±¡ä¸­ã€‚</li><li>åœ¨ä½¿ç”¨äº«å…ƒæ¨¡å¼æ—¶éœ€è¦ç»´æŠ¤ä¸€ä¸ªå­˜å‚¨äº«å…ƒå¯¹è±¡çš„äº«å…ƒæ± ï¼Œè€Œè¿™éœ€è¦è€—è´¹ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤ï¼Œåº”å½“åœ¨éœ€è¦å¤šæ¬¡é‡å¤ä½¿ç”¨äº«å…ƒå¯¹è±¡æ—¶æ‰å€¼å¾—ä½¿ç”¨äº«å…ƒæ¨¡å¼ã€‚</li></ul><h3 id="JDKæºç è§£æ">JDKæºç è§£æ</h3><p>Integer ç±»ä½¿ç”¨äº†äº«å…ƒæ¨¡å¼ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i1 i2 æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> i3 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> i4 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i3 i4 æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i3 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œç»“æœ</p><pre class="line-numbers language-console" data-language="console"><code class="language-console">i1 i2 æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡: truei3 i4 æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªè¾“å‡ºè¯­å¥è¾“å‡ºçš„æ˜¯trueï¼Œç¬¬äºŒä¸ªè¾“å‡ºè¯­å¥è¾“å‡ºçš„æ˜¯ falseï¼Ÿé€šè¿‡åç¼–è¯‘è½¯ä»¶è¿›è¡Œåç¼–è¯‘ï¼Œå­—èŠ‚ç å¦‚ä¸‹ï¼š</p><p><img src="./../design-pattern-structural2/image-20240205152526798.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥ç»™ Integer ç±»å‹çš„å˜é‡èµ‹å€¼åŸºæœ¬æ•°æ®ç±»å‹æ•°æ®çš„æ“ä½œåº•å±‚ä½¿ç”¨çš„æ˜¯ <code>valueOf()</code> ï¼Œæ‰€ä»¥åªéœ€è¦çœ‹è¯¥æ–¹æ³•å³å¯</p><p>èŠ‚é€‰éƒ¨åˆ†ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Integer</span> <span class="token keyword">extends</span> <span class="token class-name">Number</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token comment">//æ‰¾åˆ°Interger.valueOf(int i)</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å¦‚æœåœ¨ç¼“å­˜èŒƒå›´å†…å°±ç›´æ¥ä»ç¼“å­˜ä¸­å–</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">//æŸ¥çœ‹ IntegerCache.low å’Œ IntegerCache.high</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IntegerCache</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">;</span>        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> high<span class="token punctuation">;</span>        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> cache<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// high value may be configured by property</span>            <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> integerCacheHighPropValue <span class="token operator">=</span>                sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span><span class="token constant">VM</span><span class="token punctuation">.</span><span class="token function">getSavedProperty</span><span class="token punctuation">(</span><span class="token string">"java.lang.Integer.IntegerCache.high"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//çœç•¥...</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ° <code>Integer</code> é»˜è®¤å…ˆåˆ›å»ºå¹¶ç¼“å­˜ <code>-128 ~ 127</code> ä¹‹é—´æ•°çš„ <code>Integer</code> å¯¹è±¡ï¼Œå½“è°ƒç”¨ <code>valueOf</code> æ—¶å¦‚æœå‚æ•°åœ¨ <code>-128 ~ 127</code> ä¹‹é—´åˆ™è®¡ç®—ä¸‹æ ‡å¹¶ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Integer</code> å¯¹è±¡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ä¸‹è½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ«</title>
      <link href="/2024/01/31/linux-ln/"/>
      <url>/2024/01/31/linux-ln/</url>
      
        <content type="html"><![CDATA[<h1>Linux ä¸‹è½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ«</h1><blockquote><p>å‚è€ƒè‡ª <a href="https://zhuanlan.zhihu.com/p/88891362">Linux ä¸‹è½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ« - çŸ¥ä¹ (zhihu.com)</a></p></blockquote><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ï¼Œç„¶è€Œä¸ºäº†åŒºåˆ†ä¸åŒç±»å‹çš„äº‹ç‰©ï¼Œæˆ‘ä»¬æœ‰äº†ï¼š</p><ul><li>æ™®é€šæ–‡ä»¶</li><li>ç›®å½•æ–‡ä»¶</li><li>é“¾æ¥æ–‡ä»¶</li><li>è®¾å¤‡æ–‡ä»¶</li></ul><h2 id="Linux-ä¸‹çš„é“¾æ¥">Linux ä¸‹çš„é“¾æ¥</h2><h2 id="å‰ç½®">å‰ç½®</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> <span class="token number">1</span>.txt<span class="token comment">#è¾“å…¥test</span><span class="token comment">#:wq</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Linux ç³»ç»Ÿä¸‹å¯ä»¥é€šè¿‡ ln å‘½ä»¤æ¥è¿›è¡Œæ–‡ä»¶é“¾æ¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> <span class="token number">1</span>.txt ll.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡ <code>ls -li</code> æŸ¥çœ‹å½“å‰ç›®å½•ï¼Œå¯ä»¥å‘ç°</p><pre class="line-numbers language-null" data-language="null"><code class="language-null">9700383 -rw-r--r-- 1 root root 5 Jan 31 11:52 1.txt9699855 lrwxrwxrwx 1 root root 5 Jan 31 11:55 ll.txt -&gt; 1.tx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å…¶ä¸­ ll.txt å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶é“¾æ¥</p><p><code>ln</code> æŒ‡ä»¤é»˜è®¤åˆ›å»ºçš„æ˜¯ç¡¬é“¾æ¥ï¼Œå¦‚æœåŠ å…¥äº†<code>-s</code>å‚æ•°ï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªè½¯é“¾æ¥ã€‚</p><h2 id="ç¡¬é“¾æ¥">ç¡¬é“¾æ¥</h2><p>å…ˆæ¥çœ‹çœ‹ ln é»˜è®¤åˆ›å»ºçš„ç¡¬é“¾æ¥ï¼Œç”±äº Linux ä¸‹çš„æ–‡ä»¶æ˜¯é€šè¿‡ç´¢å¼•èŠ‚ç‚¹ï¼ˆInodeï¼‰æ¥è¯†åˆ«æ–‡ä»¶ï¼Œåœ¨ Linux çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜åœ¨ç£ç›˜åˆ†åŒºä¸­çš„æ–‡ä»¶ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹éƒ½ç»™å®ƒåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹å· (Inode Number)ã€‚</p><p><img src="./../linux-ln/1706679082210.jpg" alt=""></p><p>åœ¨ Linux ä¸­ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹æ˜¯å­˜åœ¨çš„ï¼Œæ‰€ä»¥ç¡¬è¿æ¥æŒ‡é€šè¿‡ç´¢å¼•èŠ‚ç‚¹æ¥è¿›è¡Œçš„è¿æ¥ï¼Œå³æ¯ä¸€ä¸ªç¡¬é“¾æ¥éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹åº”åŒºåŸŸçš„æ–‡ä»¶ã€‚</p><p>ä»¥åˆšæ‰çš„ <code>1.txt</code> æ–‡ä»¶ï¼Œå»ºç«‹ä»–çš„ç¡¬é“¾æ¥æ¥çœ‹</p><pre class="line-numbers language-null" data-language="null"><code class="language-null">ln 1.txt hl.txt9700383 -rw-r--r-- 2 root root 5 Jan 31 11:52 1.txt9700383 -rw-r--r-- 2 root root 5 Jan 31 11:52 hl.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å‰é¢çš„ <code>9700383</code> æ˜¯æ–‡ä»¶çš„ inodeï¼Œå¯ä»¥ç®€å•æŠŠå®ƒæƒ³æˆ C è¯­è¨€ä¸­çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº†ç‰©ç†ç¡¬ç›˜çš„ä¸€ä¸ªåŒºå—ï¼Œäº‹å®ä¸Šæ–‡ä»¶ç³»ç»Ÿä¼šç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œåªè¦æœ‰æ–‡ä»¶æŒ‡å‘è¿™ä¸ªåŒºå—ï¼Œå®ƒå°±ä¸ä¼šä»ç¡¬ç›˜ä¸Šæ¶ˆå¤±ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ‹¥æœ‰ç›¸åŒçš„ inodeï¼Œé€šè¿‡æŸ¥çœ‹æ–‡ä»¶å†…å®¹ä¹Ÿä¼šå‘ç°æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼š</p><p>ç¡¬é“¾æ¥çš„ä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªæœ‰æ•ˆè·¯å¾„åï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å»ºç«‹ç¡¬é“¾æ¥åˆ°é‡è¦æ–‡ä»¶,ä»¥é˜²æ­¢â€œè¯¯åˆ â€çš„åŠŸèƒ½ï¼Œç”±äºå¯¹åº”è¯¥ç›®å½•çš„ç´¢å¼•èŠ‚ç‚¹æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¿æ¥ï¼Œå‡è®¾æˆ‘ä»¬åˆ é™¤äº†åŸå§‹çš„ <code>1.txt</code> æ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token number">1</span>.txt<span class="token function">cat</span> hl.txt<span class="token comment"># test</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶æ–‡ä»¶çš„å†…å®¹ä¾ç„¶å­˜åœ¨ï¼Œæ‰€ä»¥åªåˆ é™¤ä¸€ä¸ªè¿æ¥å¹¶ä¸å½±å“ç´¢å¼•èŠ‚ç‚¹æœ¬èº«å’Œå…¶å®ƒçš„è¿æ¥ï¼Œåªæœ‰å½“æœ€åä¸€ä¸ªé“¾æ¥è¢«åˆ é™¤åï¼Œæ–‡ä»¶çš„æ•°æ®å—åŠç›®å½•çš„è¿æ¥æ‰ä¼šè¢«é‡Šæ”¾ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡ä»¶æ‰ä¼šè¢«çœŸæ­£åˆ é™¤</p><h2 id="è½¯é“¾æ¥">è½¯é“¾æ¥</h2><p>ä»¥åˆšæ‰çš„è½¯è¿æ¥ <code>ll.txt</code> ä¸ºä¾‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> ll.txt<span class="token comment">## cat: ll.txt: No such file or directory</span><span class="token comment">## æ­¤æ—¶æ–‡ä»¶å·²ç»ä¸å­˜åœ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../linux-ln/image-20240131135440649.png" alt=""></p><p>è½¯é“¾æ¥åˆå«ç¬¦å·é“¾æ¥ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å¦ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„åï¼Œä¾‹å¦‚åœ¨ä¸Šå›¾ä¸­ï¼Œ<code>ll.txt</code> å°±æ˜¯ <code>1.txt</code> çš„è½¯è¿æ¥ï¼Œ<code>1.txt</code> æ˜¯å®é™…çš„æ–‡ä»¶ï¼Œ<code>ll.txt</code>åŒ…å«çš„æ˜¯å¯¹äº <code>1.txt</code> çš„ inode çš„è®°å½•ã€‚</p><p>è½¯è¿æ¥å¯ä»¥æ˜¯ä»»æ„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥é“¾æ¥ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ï¼Œåœ¨å¯¹ç¬¦å·æ–‡ä»¶è¿›è¡Œè¯»æˆ–å†™æ“ä½œçš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠŠè¯¥æ“ä½œè½¬æ¢ä¸ºå¯¹æºæ–‡ä»¶çš„æ“ä½œï¼Œä½†åˆ é™¤é“¾æ¥æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä»…ä»…åˆ é™¤é“¾æ¥æ–‡ä»¶ï¼Œè€Œä¸åˆ é™¤æºæ–‡ä»¶æœ¬èº«ï¼Œè¿™ä¸€ç‚¹ç±»ä¼¼äº Windows æ“ä½œç³»ç»Ÿä¸‹çš„å¿«æ·æ–¹å¼ã€‚</p><h3 id="è½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ«">è½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ«</h3><table><thead><tr><th></th><th>è½¯é“¾æ¥</th><th>ç¡¬é“¾æ¥</th></tr></thead><tbody><tr><td>inode</td><td>è½¯é“¾æ¥æºæ–‡ä»¶ &amp; é“¾æ¥æ–‡ä»¶æ‹¥æœ‰ä¸é€šçš„ inode å·ï¼Œè¡¨æ˜ä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶</td><td>ç¡¬é“¾æ¥åŸæ–‡ä»¶å’Œé“¾æ¥æ–‡ä»¶å…±ç”¨ä¸€ä¸ª inode å·ï¼Œå°±åƒä¸€ä¸ªæ–‡ä»¶æœ‰å¤šä¸ªæ–‡ä»¶åï¼Œè¯´æ˜ä»–ä»¬æ˜¯åŒä¸€ä¸ªæ–‡ä»¶</td></tr><tr><td>æ–‡ä»¶å±æ€§</td><td>è½¯é“¾æ¥æ˜ç¡®å†™å‡ºäº†æ˜¯é“¾æ¥æ–‡ä»¶</td><td>ç¡¬é“¾æ¥æ²¡æœ‰å†™å‡ºæ¥ï¼Œå› ä¸ºåœ¨æœ¬è´¨ä¸Šç¡¬é“¾æ¥æ–‡ä»¶å’ŒåŸæ–‡ä»¶æ˜¯å®Œå…¨å¹³ç­‰å…³ç³»</td></tr><tr><td>è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿå»ºç«‹</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>é“¾æ¥æ•°ç›®</td><td>è½¯é“¾æ¥çš„é“¾æ¥æ•°ç›®ä¸ä¼šå¢åŠ ï¼Œæ–‡ä»¶å¤§å°æ˜¯ä¸ä¸€æ ·çš„ï¼ˆå¯ä»¥ç†è§£ä¸ºå¿«æ·æ–¹å¼å’Œå¯¹åº”æºæ–‡ä»¶ä¹‹é—´çš„å…³ç³»ï¼‰</td><td>ç¡¬é“¾æ¥æ–‡ä»¶æ˜¾ç¤ºçš„å¤§å°æ˜¯è·ŸåŸæ–‡ä»¶shi</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springä¸­äº‹åŠ¡ç®¡ç†</title>
      <link href="/2024/01/30/trans-manager/"/>
      <url>/2024/01/30/trans-manager/</url>
      
        <content type="html"><![CDATA[<h1>Springä¸­äº‹åŠ¡ç®¡ç†</h1><h2 id="ä½¿ç”¨èƒŒæ™¯">ä½¿ç”¨èƒŒæ™¯</h2><blockquote><p><a href="https://docs.spring.io/spring-framework/reference/data-access/transaction/programmatic.html#page-title">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸šåŠ¡åœºæ™¯ä¸­å¯ä»¥ä½¿ç”¨ Spring æä¾›çš„ @Transactional æ³¨è§£æ¥æŠŠäº‹åŠ¡çš„ç®¡ç†äº¤ç»™æ¡†æ¶æ¥å¤„ç†ï¼Œæ¡†æ¶é€šè¿‡ AOP çš„ä¸€ä¸ª Aspect æ¥åˆ›å»ºå’Œç»´æŠ¤äº‹åŠ¡ï¼Œå¸®æˆ‘ä»¬æŠŠäº‹åŠ¡ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘åˆ†å¼€ã€‚ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ª service ä¼šæœ‰è¾ƒä¸ºå¤æ‚çš„ SQL é€»è¾‘ï¼Œäº‹åŠ¡çš„åŠ›åº¦ç›¸å¯¹ä¹Ÿä¼šè¾ƒå¤§ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">testSave01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">testSave02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Transactional-å¤±æ•ˆ">@Transactional å¤±æ•ˆ</h3><ul><li>åœ¨ç±»çš„å†…éƒ¨è°ƒç”¨ç±»å†…çš„ç”¨ @Transactional æ ‡æ³¨çš„æ–¹æ³•</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">testSave01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">testSave02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSave01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//é€»è¾‘...</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSave02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//é€»è¾‘...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>ç±»å†…éƒ¨çš„æ–¹æ³•ä¸é€šè¿‡ä»£ç†è°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ç±»çš„ this è°ƒç”¨ï¼Œè°ƒç”¨çš„æ˜¯è‡ªèº«ï¼Œä»£ç†æ–¹æ³•æœªè¢«è°ƒç”¨ã€‚</p></li><li><p>äº‹åŠ¡æ–¹æ³•å†…çš„å¼‚å¸¸è¢« catch ä¹‹åæœªæŠ›å‡ºæ–°çš„å¼‚å¸¸</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// å¼‚å¸¸è¢«æ•æ‰åˆ°ä¹‹åæœªæŠ›å‡ºæ–°çš„å¼‚å¸¸ï¼Œäº‹åŠ¡å¤±æ•ˆ</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        <span class="token comment">// æ›´æ–°æ•°æ®</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç†æ–¹æ³•çœ‹åˆ°çš„æ˜¯æ— å¼‚å¸¸ï¼Œæ‰€ä»¥ä¸ä¼šå›æ»šäº‹åŠ¡ã€‚</p><h2 id="TransactionTemplate">TransactionTemplate</h2><h3 id="æ— è¿”å›å€¼">æ— è¿”å›å€¼</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å…³é”®åŒ… */</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">PlatformTransactionManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">TransactionStatus</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">TransactionCallbackWithoutResult</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">TransactionTemplate</span></span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">BlogCommentsServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">PlatformTransactionManager</span> transactionManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionTemplate</span><span class="token punctuation">(</span>transactionManager<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallbackWithoutResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doInTransactionWithoutResult</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> transactionStatus<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœ‰è¿”å›å€¼">æœ‰è¿”å›å€¼</h3><h4 id="å¸¸è§„å†™æ³•">å¸¸è§„å†™æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** *  å…³é”®åŒ…: å¦‚æœæŠ¥é”™æŸ¥çœ‹åŒ…æ˜¯å¦å¯¼é”™ */</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">PlatformTransactionManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">TransactionStatus</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">TransactionTemplate</span></span><span class="token punctuation">;</span><span class="token comment">//çœç•¥ç±»å</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">BlogCommentsServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">PlatformTransactionManager</span> transactionManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionTemplate</span><span class="token punctuation">(</span>transactionManager<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Boolean</span> result <span class="token operator">=</span> transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">doInTransaction</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> transactionStatus<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Lambda-å†™æ³•">Lambda å†™æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//service æ–¹æ³•</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Boolean</span> result <span class="token operator">=</span> transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>transactionStatus <span class="token operator">-></span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†">è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</h3><h4 id="å¸¸è§„å†™æ³•-2">å¸¸è§„å†™æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">BlogCommentsServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">PlatformTransactionManager</span> transactionManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionTemplate</span><span class="token punctuation">(</span>transactionManager<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TransactionCallbackWithoutResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doInTransactionWithoutResult</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> transactionStatus<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                transactionStatus<span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Lambda-å†™æ³•-2">Lambda å†™æ³•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTryCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Boolean</span> result <span class="token operator">=</span> transactionTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>status <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//é€»è¾‘å¤„ç†</span>            status<span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‚æ•°è®¾å®š">å‚æ•°è®¾å®š</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æˆªå–è‡ªå®˜ç½‘</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleService</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransactionTemplate</span> transactionTemplate<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">SimpleService</span><span class="token punctuation">(</span><span class="token class-name">PlatformTransactionManager</span> transactionManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionTemplate</span><span class="token punctuation">(</span>transactionManager<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// the transaction settings can be set here explicitly if so desired</span><span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate<span class="token punctuation">.</span><span class="token function">setIsolationLevel</span><span class="token punctuation">(</span><span class="token class-name">TransactionDefinition</span><span class="token punctuation">.</span><span class="token constant">ISOLATION_READ_UNCOMMITTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>transactionTemplate<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 30 seconds</span><span class="token comment">// and so forth...</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="TransactionManager">TransactionManager</h2><h3 id="ä½¿ç”¨-PlatformTransactionManager">ä½¿ç”¨ PlatformTransactionManager</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Resource</span><span class="token keyword">private</span> <span class="token class-name">PlatformTransactionManager</span> txManager<span class="token punctuation">;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">DefaultTransactionDefinition</span> def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultTransactionDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// explicitly setting the transaction name is something that can be done only programmatically</span>    def<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"SomeTxName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    def<span class="token punctuation">.</span><span class="token function">setPropagationBehavior</span><span class="token punctuation">(</span><span class="token class-name">TransactionDefinition</span><span class="token punctuation">.</span><span class="token constant">PROPAGATION_REQUIRED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">TransactionStatus</span> status <span class="token operator">=</span> txManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// put your business logic here</span>        <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        txManager<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    txManager<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä»£ç†ç±»ç»“åˆ-Transactional">ä»£ç†ç±»ç»“åˆ @Transactional</h2><p><img src="./../trans-manager/image-20240201092747350.png" alt="this ç´¢å¼•å¤±æ•ˆ"></p><p>é’ˆå¯¹è¿™ç§æ–¹å¼å¯¹é½æ”¹é€ ï¼Œæ‹¿åˆ°å½“å‰ç±»çš„ä»£ç†ç±»å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†ç±»è°ƒç”¨å±€éƒ¨æ–¹æ³•å³å¯å®ç°ç»†ç²’åº¦äº‹åŠ¡å¤„ç†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">IBlogCommentsService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IBlogCommentsService</span><span class="token punctuation">)</span> <span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">currentProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    proxy<span class="token punctuation">.</span><span class="token function">tProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token annotation punctuation">@Transactional</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BlogComments</span> blogComments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//blogComments.set(xxx);</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>blogComments<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘è“æ´¾ä¸Šæ‰‹é…ç½®</title>
      <link href="/2024/01/23/rasppi-start/"/>
      <url>/2024/01/23/rasppi-start/</url>
      
        <content type="html"><![CDATA[<h1>æ ‘è“æ´¾å¯åŠ¨é…ç½®</h1><p>å‰ç½®çƒ§å½•ä½¿ç”¨ Raspberry Pi Imager</p><h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2><p><strong>æŸ¥çœ‹ Ubuntu ç‰ˆæœ¬</strong></p><p><code>lsb_release -a</code></p><p><img src="./../rasppi-start/image-20240123225719147.png" alt=""></p><p><strong>æŸ¥çœ‹ç³»ç»Ÿæ¶æ„</strong></p><p><code>uname -m</code></p><p><strong>scp</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> <span class="token punctuation">[</span>å‚æ•°<span class="token punctuation">]</span> <span class="token operator">&lt;</span>æºåœ°å€ï¼ˆç”¨æˆ·å@IPåœ°å€æˆ–ä¸»æœºåï¼‰<span class="token operator">></span>:<span class="token operator">&lt;</span>æ–‡ä»¶è·¯å¾„<span class="token operator">></span> <span class="token operator">&lt;</span>ç›®çš„åœ°å€ï¼ˆç”¨æˆ·å @IP åœ°å€æˆ–ä¸»æœºåï¼‰<span class="token operator">></span>:<span class="token operator">&lt;</span>æ–‡ä»¶è·¯å¾„<span class="token operator">></span><span class="token comment">####ä¸¾ä¾‹</span><span class="token function">scp</span> ./init.sh dee@192.168.1.99:/home/dee/ <span class="token comment">#æŠŠæœ¬åœ°çš„init.shæ–‡ä»¶æ‹·è´åˆ°192.168.1.99çš„/home/deeç›®å½•ä¸‹</span><span class="token function">scp</span> orangepi@192.168.1.111:/etc/apt/sources.list ./ <span class="token comment">#æŠŠ192.168.1.111çš„sources.listæ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°å½“å‰ç›®å½•ä¸‹</span><span class="token function">scp</span> <span class="token parameter variable">-r</span> /home/work/sourcedir work@192.168.0.10:/home/work/ <span class="token comment">#æ‹·è´æ–‡ä»¶å¤¹ï¼ŒåŠ -rå‚æ•°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç£ç›˜æŒ‚è½½</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /home/data<span class="token function">sudo</span> <span class="token function">mount</span> /dev/sda1 /home/data <span class="token comment">#æŒ‚è½½</span><span class="token function">sudo</span> <span class="token function">umount</span> /dev/sda1 <span class="token comment">#å¸è½½</span><span class="token function">fuser</span> <span class="token parameter variable">-m</span> /dev/sda1 <span class="token comment">#æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨ç£ç›˜çš„åº”ç”¨</span><span class="token function">sudo</span> <span class="token function">fdisk</span> <span class="token parameter variable">-l</span> <span class="token comment">#æŸ¥çœ‹æ‰€æœ‰ç£ç›˜ä¿¡æ¯(åŒ…æ‹¬æœªæŒ‚è½½çš„)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è´¦æˆ·ç›¸å…³">è´¦æˆ·ç›¸å…³</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ä¿®æ”¹ root è´¦å·çš„å¯†ç (è¦åˆ‡æ¢è‡³root)</span>paswd<span class="token comment">#ä¿®æ”¹ orangepi è´¦å·çš„å¯†ç </span><span class="token function">passwd</span> orangepi<span class="token comment">#ä¿®æ”¹ orangepi çš„è´¦å·ä¸º dee</span><span class="token function">usermod</span> <span class="token parameter variable">-l</span> dee orangepi<span class="token comment">#ä¿®æ”¹ç»„</span><span class="token function">groupmod</span> <span class="token parameter variable">-n</span> dee orangepi<span class="token comment">#æŠŠåŸæ¥ orangepi ç›®å½•æ”¹æ‰</span><span class="token function">mv</span> /home/ornagepi /home/dee<span class="token comment">#æŠŠè¿™ç›®å½•è®¾ç½®æˆ orangepi ç”¨æˆ·çš„ home ç›®å½•</span><span class="token function">usermod</span> <span class="token parameter variable">-d</span> /home/orangepi orangepi<span class="token comment">#æŸ¥çœ‹ Linux ä¸­æ‰€æœ‰ç”¨æˆ·</span><span class="token function">cat</span> /etc/passwd<span class="token comment">#æŸ¥çœ‹ Linux ä¸­æ·»åŠ äº†å¤šå°‘ç”¨æˆ·</span><span class="token function">cat</span> /etc/passwd<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> nologin<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">halt</span><span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">shutdown</span><span class="token operator">|</span>awk-F<span class="token string">":"</span> <span class="token string">'&#123; print $1"|"$3"|"$4 &#125;'</span><span class="token operator">|</span><span class="token function">more</span><span class="token comment">#æŸ¥çœ‹ Linux ä¸­æ‰€æœ‰ç»„</span><span class="token function">cat</span> /etc/group<span class="token comment">#åˆ é™¤ Linux æŸä¸ªç”¨æˆ·</span><span class="token function">userdel</span> <span class="token operator">&lt;</span>ç”¨æˆ·å<span class="token operator">></span><span class="token comment">#åˆ é™¤linuxä¸­æŸä¸ªç”¨æˆ·æ‰€æœ‰ä¿¡æ¯</span><span class="token function">userdel</span> <span class="token parameter variable">-r</span> <span class="token operator">&lt;</span>ç”¨æˆ·å<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸ç”¨-apt-å‘½ä»¤">å¸¸ç”¨ apt å‘½ä»¤</h3><p>æ›´æ¢é•œåƒæº</p><p>å…ˆæŸ¥çœ‹é•œåƒæº</p><p><a href="http://www.raspbian.org/RaspbianMirrors">RaspbianMirrors - Raspbian</a></p><p><a href="https://mirror.tuna.tsinghua.edu.cn/help/debian/">debian | æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#å¤‡ä»½é•œåƒæº</span><span class="token function">sudo</span> <span class="token function">cp</span> /etc/apt/sources.list /etc/apt/sources.list.back<span class="token function">sudo</span> <span class="token function">vi</span> /etc/apt/sources.list<span class="token comment">####æ›¿æ¢é•œåƒæº</span><span class="token comment"># é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š</span>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware<span class="token comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware</span>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware<span class="token comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware</span>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware<span class="token comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware</span>deb https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware<span class="token comment"># deb-src https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware</span><span class="token comment">####</span><span class="token function">sudo</span> <span class="token function">vi</span> /etc/apt/sources.list.d/raspi.list<span class="token comment">####æ›¿æ¢é•œåƒæº</span>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main<span class="token comment">####</span><span class="token comment">#æ›´æ–°é•œåƒæº</span><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token comment">#æ›´æ–°è½¯ä»¶</span><span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token comment">#åˆ—å‡ºæ‰€æœ‰å¯æ›´æ–°çš„è½¯ä»¶æ¸…å•å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#å®‰è£…æŒ‡å®šçš„è½¯ä»¶å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package_<span class="token operator"><span class="token file-descriptor important">1</span>></span> <span class="token operator">&lt;</span>package_<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token operator">&lt;</span>package_<span class="token operator"><span class="token file-descriptor important">3</span>></span> <span class="token comment">#å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…</span><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#æ›´æ–°æŒ‡å®šçš„è½¯ä»¶å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> remove <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#åˆ é™¤è½¯ä»¶åŒ…å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> autoremove <span class="token comment">#æ¸…ç†ä¸å†ä½¿ç”¨çš„ä¾èµ–å’Œåº“æ–‡ä»¶</span><span class="token function">sudo</span> <span class="token function">apt</span> purge <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#ç§»é™¤è½¯ä»¶åŒ…åŠé…ç½®æ–‡ä»¶</span><span class="token function">sudo</span> <span class="token function">apt</span> search <span class="token operator">&lt;</span>keyword<span class="token operator">></span> <span class="token comment">#æŸ¥æ‰¾è½¯ä»¶åŒ…å‘½ä»¤</span><span class="token function">apt</span> list <span class="token parameter variable">--installed</span> <span class="token comment">#åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…</span><span class="token function">apt</span> list --all-versions <span class="token comment">#åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸ç”¨é˜²ç«å¢™å‘½ä»¤">å¸¸ç”¨é˜²ç«å¢™å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ufw <span class="token comment">#å®‰è£…é˜²ç«å¢™</span><span class="token function">sudo</span> ufw status <span class="token comment">#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span><span class="token function">sudo</span> ufw <span class="token builtin class-name">enable</span> <span class="token comment">#å¼€å¯é˜²ç«å¢™</span><span class="token function">sudo</span> ufw disable <span class="token comment">#å…³é—­é˜²ç«å¢™</span><span class="token function">sudo</span> ufw allow <span class="token number">80</span> <span class="token comment">#å…è®¸å¤–éƒ¨è®¿é—®80ç«¯å£, åè®®åŒ…å« tcp å’Œ udp</span><span class="token function">sudo</span> ufw allow <span class="token number">80</span>/tcp <span class="token comment">#å…è®¸å…¶å®ƒä¸»æœºä½¿ç”¨ tcp åè®®è®¿é—®æœ¬æœº 80 ç«¯å£</span><span class="token function">sudo</span> ufw delete allow <span class="token number">80</span> <span class="token comment">#ç¦æ­¢å¤–éƒ¨è®¿é—®80 ç«¯å£</span><span class="token function">sudo</span> ufw allow from <span class="token number">192.168</span>.1.1 <span class="token comment">#å…è®¸æ­¤IPè®¿é—®æ‰€æœ‰çš„æœ¬æœºç«¯å£</span><span class="token function">sudo</span> ufw deny smtp <span class="token comment">#ç¦æ­¢å¤–éƒ¨è®¿é—®smtpæœåŠ¡</span><span class="token function">sudo</span> ufw reject out smtp <span class="token comment">#ç¦æ­¢è®¿é—®å¤–éƒ¨smtpç«¯å£ï¼Œä¸å‘ŠçŸ¥â€œè¢«é˜²ç«å¢™é˜»æ­¢â€</span><span class="token function">sudo</span> ufw deny out to <span class="token number">192.168</span>.1.1 <span class="token comment">#ç¦æ­¢æœ¬æœº 192.168.1.1 å¯¹å¤–è®¿é—®ï¼Œå‘ŠçŸ¥â€œè¢«é˜²ç«å¢™é˜»æ­¢â€</span><span class="token function">sudo</span> ufw delete allow smtp <span class="token comment">#åˆ é™¤ä¸Šé¢å»ºç«‹çš„æŸæ¡è§„åˆ™</span><span class="token function">sudo</span> ufw delete deny <span class="token number">80</span>/tcp <span class="token comment">#è¦åˆ é™¤è§„åˆ™ï¼Œåªè¦åœ¨å‘½ä»¤ä¸­åŠ å…¥deleteå°±è¡Œäº†</span><span class="token comment">###å¯ä»¥å…è®¸æ‰€æœ‰RFC1918ç½‘ç»œï¼ˆå±€åŸŸç½‘/æ— çº¿å±€åŸŸç½‘çš„ï¼‰è®¿é—®è¿™ä¸ªä¸»æœºï¼ˆ/8,/16,/12æ˜¯ä¸€ç§ç½‘ç»œåˆ†çº§ï¼‰</span><span class="token function">sudo</span> ufw allow from <span class="token number">10.0</span>.0.0/8<span class="token function">sudo</span> ufw allow from <span class="token number">172.16</span>.0.0/12<span class="token function">sudo</span> ufw allow from <span class="token number">192.168</span>.0.0/16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸ç”¨ç«¯å£å‘½ä»¤">å¸¸ç”¨ç«¯å£å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">netstat</span> -ntulp<span class="token operator">|</span><span class="token function">grep</span> <span class="token operator">&lt;</span>åº”ç”¨å<span class="token operator">></span> <span class="token comment">#æ³¨æ„è¦åŠ sudo</span><span class="token function">sudo</span> <span class="token function">lsof</span> -i:<span class="token operator">&lt;</span>ç«¯å£å·<span class="token operator">></span> <span class="token comment">#æ³¨æ„è¦åŠ sudo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="è‡ªåŠ¨åŒ–éƒ¨ç½²">è‡ªåŠ¨åŒ–éƒ¨ç½²</h2><h3 id="åŸºç¡€åº”ç”¨å®‰è£…">åŸºç¡€åº”ç”¨å®‰è£…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span> samba <span class="token parameter variable">-y</span>:set mouse-<span class="token operator">=</span>a <span class="token comment">#å¯ç”¨é¼ æ ‡æ”¯æŒ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å±€åŸŸç½‘å…±äº«">å±€åŸŸç½‘å…±äº«</h3><p><strong>å®‰è£…</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#å®‰è£…Samba</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> samba <span class="token parameter variable">-y</span><span class="token comment">#æ–°å¢å…±äº«ç›®å½•</span><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /dee/sharedata<span class="token comment">#ä¿®æ”¹æƒé™</span><span class="token function">sudo</span> <span class="token function">chown</span> dee:dee /dee/sharedata<span class="token comment">#å°†ç”¨æˆ·smbuseræ·»åŠ åˆ°sambaçš„smbpasswd fileä¸­(å³åœ¨sambaæœåŠ¡ä¸­æ³¨å†Œè¯¥è´¦æˆ·)</span><span class="token function">sudo</span> smbpasswd <span class="token parameter variable">-a</span> dee<span class="token comment">#pass=dee</span><span class="token comment">#æŸ¥çœ‹ç”¨æˆ·</span><span class="token function">sudo</span> pdbedit <span class="token parameter variable">-L</span><span class="token comment">#åˆ é™¤ç”¨æˆ·</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é…ç½®æ–‡ä»¶</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc/samba/<span class="token function">sudo</span> <span class="token function">vim</span> /etc/samba/smb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ«å°¾æ·»åŠ </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#åŒ¿å</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span>   path <span class="token operator">=</span> /dee/sharedata   browseable <span class="token operator">=</span> <span class="token function">yes</span>   writable <span class="token operator">=</span> <span class="token function">yes</span>   guest ok <span class="token operator">=</span> <span class="token function">yes</span>   <span class="token comment">#è´¦å·</span><span class="token punctuation">[</span>share<span class="token punctuation">]</span>  comment <span class="token operator">=</span> share folder  browseable <span class="token operator">=</span> <span class="token function">yes</span>  writeable <span class="token operator">=</span> <span class="token function">yes</span>  path <span class="token operator">=</span> /dee/sharedata  create mask <span class="token operator">=</span> 0777  directory mask <span class="token operator">=</span> 0777  valid <span class="token function">users</span> <span class="token operator">=</span> dee  force user <span class="token operator">=</span> dee  force group <span class="token operator">=</span> nogroup  public <span class="token operator">=</span> <span class="token function">yes</span>  available <span class="token operator">=</span> <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Pi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-05-ç»“æ„å‹æ¨¡å¼ â… </title>
      <link href="/2024/01/23/design-pattern-structural/"/>
      <url>/2024/01/23/design-pattern-structural/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é“¾æ¥:</p><a href="/2024/02/04/design-pattern-structural2/" title="è®¾è®¡æ¨¡å¼-06-ç»“æ„å‹æ¨¡å¼ â…¡">ç»“æ„å‹æ¨¡å¼â…¡</a></blockquote><h1>ç»“æ„å‹æ¨¡å¼ â… </h1><p>ç»“æ„å‹æ¨¡å¼æè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ã€‚å®ƒåˆ†ä¸º<strong>ç±»ç»“æ„å‹æ¨¡å¼</strong>å’Œ<strong>å¯¹è±¡ç»“æ„å‹æ¨¡å¼</strong>ï¼Œå‰è€…é‡‡ç”¨ç»§æ‰¿æœºåˆ¶æ¥ç»„ç»‡æ¥å£å’Œç±»ï¼Œåè€…é‡†ç”¨ç»„åˆæˆ–èšåˆæ¥ç»„åˆå¯¹è±¡ã€‚</p><p>ç”±äºç»„åˆå…³ç³»æˆ–èšåˆå…³ç³»æ¯”ç»§æ‰¿å…³ç³»è€¦åˆåº¦ä½ï¼Œæ»¡è¶³â€œåˆæˆå¤ç”¨åŸåˆ™â€ï¼Œæ‰€ä»¥å¯¹è±¡ç»“æ„å‹æ¨¡å¼æ¯”ç±»ç»“æ„å‹æ¨¡å¼å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚</p><p>ç»“æ„å‹æ¨¡å¼åˆ†ä¸ºä»¥ä¸‹ 7 ç§ï¼š</p><ul><li>ä»£ç†æ¨¡å¼</li><li>é€‚é…å™¨æ¨¡å¼</li><li>è£…é¥°è€…æ¨¡å¼</li><li>æ¡¥æ¥æ¨¡å¼</li><li>å¤–è§‚æ¨¡å¼</li><li>ç»„åˆæ¨¡å¼</li><li>äº«å…ƒæ¨¡å¼</li></ul><h2 id="1-ä»£ç†æ¨¡å¼">1-ä»£ç†æ¨¡å¼</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p>ç”±äºæŸäº›åŸå› éœ€è¦ç»™æŸå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚è¿™æ—¶ï¼Œè®¿é—®å¯¹è±¡ä¸é€‚åˆæˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨ç›®æ ‡å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ä½œä¸ºè®¿é—®å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´çš„ä¸­ä»‹ã€‚</p><p>Java ä¸­çš„ä»£ç†æŒ‰ç…§ä»£ç†ç±»ç”Ÿæˆæ—¶æœºä¸åŒåˆåˆ†ä¸º<strong>é™æ€ä»£ç†</strong>å’Œ<strong>åŠ¨æ€ä»£ç†</strong>ã€‚</p><ul><li><p>é™æ€ä»£ç†ä»£ç†ç±»åœ¨ç¼–è¯‘æœŸå°±ç”Ÿæˆ</p></li><li><p>åŠ¨æ€ä»£ç†ä»£ç†ç±»åˆ™æ˜¯åœ¨ Java è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆ</p><p>åŠ¨æ€ä»£ç†åˆæœ‰</p><ul><li>JDK ä»£ç†</li><li>CGLib ä»£ç†ä¸¤ç§</li></ul></li></ul><h3 id="ç»“æ„">ç»“æ„</h3><p>ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼åˆ†ä¸ºä¸‰ç§è§’è‰²ï¼š</p><ul><li>æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ç±»ï¼š é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»å£°æ˜çœŸå®ä¸»é¢˜å’Œä»£ç†å¯¹è±¡å®ç°çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li><li>çœŸå®ä¸»é¢˜ï¼ˆReal Subjectï¼‰ç±»ï¼š å®ç°äº†æŠ½è±¡ä¸»é¢˜ä¸­çš„å…·ä½“ä¸šåŠ¡ï¼Œæ˜¯ä»£ç†å¯¹è±¡æ‰€ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œæ˜¯æœ€ç»ˆè¦å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>ä»£ç†ï¼ˆProxyï¼‰ç±» ï¼š æä¾›äº†ä¸çœŸå®ä¸»é¢˜ç›¸åŒçš„æ¥å£ï¼Œå…¶å†…éƒ¨å«æœ‰å¯¹çœŸå®ä¸»é¢˜çš„å¼•ç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®ã€æ§åˆ¶æˆ–æ‰©å±•çœŸå®ä¸»é¢˜çš„åŠŸèƒ½ã€‚</li></ul><h3 id="é™æ€ä»£ç†">é™æ€ä»£ç†</h3><p>æˆ‘ä»¬é€šè¿‡æ¡ˆä¾‹æ¥æ„Ÿå—ä¸€ä¸‹é™æ€ä»£ç†ã€‚</p><p>ã€ä¾‹ã€‘ç«è½¦ç«™å–ç¥¨</p><p>å¦‚æœè¦ä¹°ç«è½¦ç¥¨çš„è¯ï¼Œéœ€è¦å»ç«è½¦ç«™ä¹°ç¥¨ï¼Œåè½¦åˆ°ç«è½¦ç«™ï¼Œæ’é˜Ÿç­‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ˜¾ç„¶æ¯”è¾ƒéº»çƒ¦ã€‚è€Œç«è½¦ç«™åœ¨å¤šä¸ªåœ°æ–¹éƒ½æœ‰ä»£å”®ç‚¹ï¼Œæˆ‘ä»¬å»ä»£å”®ç‚¹ä¹°ç¥¨å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚è¿™ä¸ªä¾‹å­å…¶å®å°±æ˜¯å…¸å‹çš„ä»£ç†æ¨¡å¼ï¼Œç«è½¦ç«™æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œä»£å”®ç‚¹æ˜¯ä»£ç†å¯¹è±¡ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass SellTickets {<< interface >>+ sell() void}class Client {+ main() void}class TrainStation {+ sell() void}class ProxyPoint {+ sell() void}SellTickets <|.. TrainStationSellTickets <|.. ProxyPointClient ..> ProxyPointProxyPoint o-- TrainStation : èšåˆnote for SellTickets "æŠ½è±¡ä¸»é¢˜ç±»"</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å–ç¥¨æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SellTickets</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//ç«è½¦ç«™  ç«è½¦ç«™å…·æœ‰å–ç¥¨åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å®ç°SellTicketsæ¥å£</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrainStation</span> <span class="token keyword">implements</span> <span class="token class-name">SellTickets</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç«è½¦ç«™å–ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//ä»£å”®ç‚¹</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyPoint</span> <span class="token keyword">implements</span> <span class="token class-name">SellTickets</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">TrainStation</span> station <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrainStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»£ç†ç‚¹æ”¶å–ä¸€äº›æœåŠ¡è´¹ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        station<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ProxyPoint</span> pp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pp<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹å‡ºæµ‹è¯•ç±»ç›´æ¥è®¿é—®çš„æ˜¯ ProxyPoint ç±»å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ ProxyPoint ä½œä¸ºè®¿é—®å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡çš„ä¸­ä»‹ã€‚åŒæ—¶ä¹Ÿå¯¹ sell() æ–¹æ³•è¿›è¡Œäº†å¢å¼ºï¼ˆä»£ç†ç‚¹æ”¶å–ä¸€äº›æœåŠ¡è´¹ç”¨ï¼‰ã€‚</p><h3 id="JDKåŠ¨æ€ä»£ç†">JDKåŠ¨æ€ä»£ç†</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°ä¸Šé¢æ¡ˆä¾‹ï¼Œå…ˆè¯´è¯´ JDK æä¾›çš„åŠ¨æ€ä»£ç†ã€‚Java ä¸­æä¾›äº†ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±» Proxyï¼ŒProxy å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸Šè¿°æ‰€è¯´çš„ä»£ç†å¯¹è±¡çš„ç±»ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ä¸ªåˆ›å»ºä»£ç†å¯¹è±¡çš„é™æ€æ–¹æ³•ï¼ˆnewProxyInstanceæ–¹æ³•ï¼‰æ¥è·å–ä»£ç†å¯¹è±¡ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å–ç«è½¦ç¥¨æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SellTickets</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç«è½¦ç«™å®ç°å–ç¥¨æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrainStation</span> <span class="token keyword">implements</span> <span class="token class-name">SellTickets</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç«è½¦ç«™å–ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è·å–ä»£ç†å¯¹è±¡çš„å·¥å‚ç±» * ä»£ç†ç±»ä¹Ÿå®ç°äº†å¯¹åº”çš„æ¥å£ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyFactory</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å£°æ˜ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">TrainStation</span> station <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrainStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">SellTickets</span> <span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*              è·å–ä»£ç†å¯¹è±¡              ClassLoader loader : ç±»åŠ è½½å™¨, ç”¨äºåŠ è½½ä»£ç†ç±». å¯ä»¥é€šè¿‡ç›®æ ‡å¯¹è±¡è·å–ç±»åŠ è½½å™¨              Class&lt;?>[] interfaces : ä»£ç†ç±»å®ç°çš„æ¥å£çš„å­—èŠ‚ç å¯¹è±¡              InvocationHandler h : ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åº         */</span>        <span class="token class-name">SellTickets</span> proxyObject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SellTickets</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>                station<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                station<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">/*                        Object proxy : ä»£ç†å¯¹è±¡, å’ŒproxyObjectå¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡, åœ¨invokeæ–¹æ³•åŸºæœ¬ä¸ç”¨                        Method method : å¯¹æ¥å£ä¸­çš„æ–¹æ³•è¿›è¡Œå°è£…çš„methodå¯¹è±¡                        Object[] args : è°ƒç”¨æ–¹æ³•çš„å®é™…å‚æ•°                        è¿”å›å€¼: æ–¹æ³•çš„è¿”å›å€¼                     */</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»£å”®ç‚¹æ”¶å–ä¸€å®šè´¹ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">Object</span> obj <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>station<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> proxyObject<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SellTickets</span> sellTickets <span class="token operator">=</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sellTickets<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/** ====è¾“å‡º====         * ä»£å”®ç‚¹æ”¶å–ä¸€å®šè´¹ç”¨(jdkåŠ¨æ€ä»£ç†)         * ç«è½¦ç«™å–ç¥¨         */</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color="red">ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œæ€è€ƒä¸‹é¢é—®é¢˜ï¼š</font></p><h4 id="ProxyFactory-æ˜¯ä»£ç†ç±»å—ï¼Ÿ">ProxyFactory æ˜¯ä»£ç†ç±»å—ï¼Ÿ</h4><p>ProxyFactory ä¸æ˜¯ä»£ç†æ¨¡å¼ä¸­æ‰€è¯´çš„ä»£ç†ç±»ï¼Œè€Œä»£ç†ç±»æ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€çš„åœ¨å†…å­˜ä¸­ç”Ÿæˆçš„ç±»ã€‚é€šè¿‡é˜¿é‡Œå·´å·´å¼€æºçš„ Java è¯Šæ–­å·¥å…·ï¼ˆArthasï¼‰æŸ¥çœ‹ä»£ç†ç±»çš„ç»“æ„ï¼š</p><ol><li><p>æ›´æ”¹æµ‹è¯•ç±», è®©ç¨‹åºä¸€ç›´æ‰§è¡Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è·å–å¯¹è±¡å…¨ç±»å</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sellTickets<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®©ç¨‹åºä¸€ç›´è¿›è¡Œ</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨ jad å‘½ä»¤</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">jad com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$<span class="token class-name">Proxy0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p>â€‹<img src="./../design-pattern-structural/image-20240125202224870.png" alt=""></p><p>ç²¾ç®€åä»£ç å¦‚ä¸‹:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> $<span class="token class-name">Proxy0</span> <span class="token keyword">extends</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">SellTickets</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m3<span class="token punctuation">;</span>    <span class="token keyword">public</span> $<span class="token class-name">Proxy0</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span> invocationHandler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>invocationHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m3<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        m3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"cn.saddyfire.pattern.proxy.jdk_proxy.SellTickets"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"sell"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶ä»£ç†ç±»çš„æœ‰å‚æ„é€  <code>$Proxy0(InvocationHandler invocationHandler)</code> çš„å‚æ•°ç›´æ¥èµ‹å€¼ç»™äº† <code>super()</code> çˆ¶ç±». ç»§ç»­è¿›å…¥ <code>Proxy</code> ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Proxyç±»ç‰‡æ®µ</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token class-name">InvocationHandler</span> h<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//Invokeæ–¹æ³•</span><span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/*      Object proxy : ä»£ç†å¯¹è±¡, å’ŒproxyObjectå¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡, åœ¨invokeæ–¹æ³•åŸºæœ¬ä¸ç”¨      Method method : å¯¹æ¥å£ä¸­çš„æ–¹æ³•è¿›è¡Œå°è£…çš„methodå¯¹è±¡      Object[] args : è°ƒç”¨æ–¹æ³•çš„å®é™…å‚æ•°      è¿”å›å€¼: æ–¹æ³•çš„è¿”å›å€¼     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»£å”®ç‚¹æ”¶å–ä¸€å®šè´¹ç”¨(jdkåŠ¨æ€ä»£ç†)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> obj <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>station<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤: ä»£ç†ç±»ä¸­çš„ <code>this.h.invoke(this, m3, null);</code> å®é™…å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ <code>invoke()</code> æ–¹æ³•</p><ul><li>ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰å®ç°äº† SellTicketsã€‚è¿™ä¹Ÿå°±å°è¯äº†æˆ‘ä»¬ä¹‹å‰è¯´çš„çœŸå®ç±»å’Œä»£ç†ç±»å®ç°åŒæ ·çš„æ¥å£ã€‚</li><li>ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰å°†æˆ‘ä»¬æä¾›äº†çš„åŒ¿åå†…éƒ¨ç±»å¯¹è±¡ä¼ é€’ç»™äº†çˆ¶ç±»ã€‚</li></ul><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><pre><code>1. åœ¨æµ‹è¯•ç±»ä¸­é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨sell()æ–¹æ³•2. æ ¹æ®å¤šæ€çš„ç‰¹æ€§ï¼Œæ‰§è¡Œçš„æ˜¯ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰ä¸­çš„ sell() æ–¹æ³•3. ä»£ç†ç±»ï¼ˆ$Proxy0ï¼‰ä¸­çš„ sell() æ–¹æ³•ä¸­åˆè°ƒç”¨äº† InvocationHandler æ¥å£çš„å­å®ç°ç±»å¯¹è±¡çš„invokeæ–¹æ³•4. invoke æ–¹æ³•é€šè¿‡åå°„æ‰§è¡Œäº†çœŸå®å¯¹è±¡æ‰€å±ç±»(TrainStation)ä¸­çš„ sell() æ–¹æ³•</code></pre><h3 id="CGLIBåŠ¨æ€ä»£ç†">CGLIBåŠ¨æ€ä»£ç†</h3><p>åŒæ ·æ˜¯ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ CGLIB ä»£ç†å®ç°ã€‚</p><p>å¦‚æœæ²¡æœ‰å®šä¹‰ SellTickets æ¥å£ï¼Œåªå®šä¹‰äº† TrainStation(ç«è½¦ç«™ç±»)ã€‚å¾ˆæ˜¾ç„¶ JDK ä»£ç†æ˜¯æ— æ³•ä½¿ç”¨äº†ï¼Œå› ä¸º JDK åŠ¨æ€ä»£ç†è¦æ±‚å¿…é¡»å®šä¹‰æ¥å£ï¼Œå¯¹æ¥å£è¿›è¡Œä»£ç†ã€‚</p><p>CGLIB æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ï¼Œé«˜æ€§èƒ½çš„ä»£ç ç”ŸæˆåŒ…ã€‚å®ƒä¸ºæ²¡æœ‰å®ç°æ¥å£çš„ç±»æä¾›ä»£ç†ï¼Œä¸º JDK çš„åŠ¨æ€ä»£ç†æä¾›äº†å¾ˆå¥½çš„è¡¥å……ã€‚</p><p>CGLIB æ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„åŒ…ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥ jar åŒ…çš„åæ ‡ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>cglib<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>cglib<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">2.2</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//CGLibä»£ç†æ— éœ€æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrainStation</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç«è½¦ç«™å–ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ä»£ç†å·¥å‚</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyFactory</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">TrainStation</span> station <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrainStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">TrainStation</span> <span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºEnhancerå¯¹è±¡, ç±»ä¼¼äºJDKä»£ç†ä¸­çš„Proxyç±»</span>        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®çˆ¶ç±»çš„å­—èŠ‚ç å¯¹è±¡</span>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">TrainStation</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®å›è°ƒå‡½æ•°</span>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºä»£ç†å¯¹è±¡</span>        <span class="token class-name">TrainStation</span> proxyObject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TrainStation</span><span class="token punctuation">)</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> proxyObject<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»£å”®ç‚¹æ”¶å–ä¸€å®šæœåŠ¡è´¹(CGLibä»£ç†)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>station<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºä»£ç†å·¥å‚å¯¹è±¡</span>        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–ä»£ç†å¯¹è±¡</span>        <span class="token class-name">TrainStation</span> proxyObject <span class="token operator">=</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        proxyObject<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸‰ç§ä»£ç†çš„å¯¹æ¯”">ä¸‰ç§ä»£ç†çš„å¯¹æ¯”</h3><ul><li><p>JDK ä»£ç†å’Œ CGLIB ä»£ç†</p><p>ä½¿ç”¨ CGLib å®ç°åŠ¨æ€ä»£ç†ï¼ŒCGLib åº•å±‚é‡‡ç”¨ ASM å­—èŠ‚ç ç”Ÿæˆæ¡†æ¶ï¼Œä½¿ç”¨å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»ï¼Œåœ¨ JDK1.6 ä¹‹å‰æ¯”ä½¿ç”¨ Java åå°„æ•ˆç‡è¦é«˜ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCGLib ä¸èƒ½å¯¹å£°æ˜ä¸º final çš„ç±»æˆ–è€…æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå› ä¸º CGLib åŸç†æ˜¯åŠ¨æ€ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±»ã€‚</p><p>åœ¨ JDK1.6ã€JDK1.7ã€JDK1.8 é€æ­¥å¯¹ JDK åŠ¨æ€ä»£ç†ä¼˜åŒ–ä¹‹åï¼Œåœ¨è°ƒç”¨æ¬¡æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ŒJDK ä»£ç†æ•ˆç‡é«˜äº CGLib ä»£ç†æ•ˆç‡ï¼Œåªæœ‰å½“è¿›è¡Œå¤§é‡è°ƒç”¨çš„æ—¶å€™ï¼ŒJDK1.6 å’Œ JDK1.7 æ¯” CGLib ä»£ç†æ•ˆç‡ä½ä¸€ç‚¹ï¼Œä½†æ˜¯åˆ° JDK1.8 çš„æ—¶å€™ï¼ŒJDK ä»£ç†æ•ˆç‡é«˜äº CGLib ä»£ç†ã€‚æ‰€ä»¥å¦‚æœæœ‰æ¥å£ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦‚æœæ²¡æœ‰æ¥å£ä½¿ç”¨ CGLIB ä»£ç†ã€‚</p></li><li><p>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†</p><p>åŠ¨æ€ä»£ç†ä¸é™æ€ä»£ç†ç›¸æ¯”è¾ƒï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯æ¥å£ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•éƒ½è¢«è½¬ç§»åˆ°è°ƒç”¨å¤„ç†å™¨ä¸€ä¸ªé›†ä¸­çš„æ–¹æ³•ä¸­å¤„ç†ï¼ˆInvocationHandler.invokeï¼‰ã€‚è¿™æ ·ï¼Œåœ¨æ¥å£æ–¹æ³•æ•°é‡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œçµæ´»å¤„ç†ï¼Œè€Œä¸éœ€è¦åƒé™æ€ä»£ç†é‚£æ ·æ¯ä¸€ä¸ªæ–¹æ³•è¿›è¡Œä¸­è½¬ã€‚</p><p>å¦‚æœæ¥å£å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œé™æ€ä»£ç†æ¨¡å¼é™¤äº†æ‰€æœ‰å®ç°ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•å¤–ï¼Œæ‰€æœ‰ä»£ç†ç±»ä¹Ÿéœ€è¦å®ç°æ­¤æ–¹æ³•ã€‚å¢åŠ äº†ä»£ç ç»´æŠ¤çš„å¤æ‚åº¦ã€‚è€ŒåŠ¨æ€ä»£ç†ä¸ä¼šå‡ºç°è¯¥é—®é¢˜</p></li></ul><h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>ä»£ç†æ¨¡å¼åœ¨å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸€ä¸ªä¸­ä»‹ä½œç”¨å’Œä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ï¼›</li><li>ä»£ç†å¯¹è±¡å¯ä»¥æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼›</li><li>ä»£ç†æ¨¡å¼èƒ½å°†å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼›</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼›</li></ul><h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><ul><li><p>è¿œç¨‹ï¼ˆRemoteï¼‰ä»£ç†</p><p>æœ¬åœ°æœåŠ¡é€šè¿‡ç½‘ç»œè¯·æ±‚è¿œç¨‹æœåŠ¡ã€‚ä¸ºäº†å®ç°æœ¬åœ°åˆ°è¿œç¨‹çš„é€šä¿¡ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ç½‘ç»œé€šä¿¡ï¼Œå¤„ç†å…¶ä¸­å¯èƒ½çš„å¼‚å¸¸ã€‚ä¸ºè‰¯å¥½çš„ä»£ç è®¾è®¡å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬å°†ç½‘ç»œé€šä¿¡éƒ¨åˆ†éšè—èµ·æ¥ï¼Œåªæš´éœ²ç»™æœ¬åœ°æœåŠ¡ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¯¥æ¥å£å³å¯è®¿é—®è¿œç¨‹æœåŠ¡æä¾›çš„åŠŸèƒ½ï¼Œè€Œä¸å¿…è¿‡å¤šå…³å¿ƒé€šä¿¡éƒ¨åˆ†çš„ç»†èŠ‚ã€‚</p></li><li><p>é˜²ç«å¢™ï¼ˆFirewallï¼‰ä»£ç†</p><p>å½“ä½ å°†æµè§ˆå™¨é…ç½®æˆä½¿ç”¨ä»£ç†åŠŸèƒ½æ—¶ï¼Œé˜²ç«å¢™å°±å°†ä½ çš„æµè§ˆå™¨çš„è¯·æ±‚è½¬ç»™äº’è”ç½‘ï¼›å½“äº’è”ç½‘è¿”å›å“åº”æ—¶ï¼Œä»£ç†æœåŠ¡å™¨å†æŠŠå®ƒè½¬ç»™ä½ çš„æµè§ˆå™¨ã€‚</p></li><li><p>ä¿æŠ¤ï¼ˆProtect or Accessï¼‰ä»£ç†</p><p>æ§åˆ¶å¯¹ä¸€ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥ç»™ä¸åŒçš„ç”¨æˆ·æä¾›ä¸åŒçº§åˆ«çš„ä½¿ç”¨æƒé™ã€‚</p></li></ul><h2 id="2-é€‚é…å™¨æ¨¡å¼">2-é€‚é…å™¨æ¨¡å¼</h2><p>å¦‚æœå»æ¬§æ´²å›½å®¶å»æ—…æ¸¸çš„è¯ï¼Œä»–ä»¬çš„æ’åº§å¦‚ä¸‹å›¾æœ€å·¦è¾¹ï¼Œæ˜¯æ¬§æ´²æ ‡å‡†ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨çš„æ’å¤´å¦‚ä¸‹å›¾æœ€å³è¾¹çš„ã€‚å› æ­¤æˆ‘ä»¬çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œæ‰‹æœºåœ¨å½“åœ°ä¸èƒ½ç›´æ¥å……ç”µã€‚æ‰€ä»¥å°±éœ€è¦ä¸€ä¸ªæ’åº§è½¬æ¢å™¨ï¼Œè½¬æ¢å™¨ç¬¬ 1 é¢æ’å…¥å½“åœ°çš„æ’åº§ï¼Œç¬¬ 2 é¢ä¾›æˆ‘ä»¬å……ç”µï¼Œè¿™æ ·ä½¿å¾—æˆ‘ä»¬çš„æ’å¤´åœ¨å½“åœ°èƒ½ä½¿ç”¨ã€‚ç”Ÿæ´»ä¸­è¿™æ ·çš„ä¾‹å­å¾ˆå¤šï¼Œæ‰‹æœºå……ç”µå™¨ï¼ˆå°† 220v è½¬æ¢ä¸º 5v çš„ç”µå‹ï¼‰ï¼Œè¯»å¡å™¨ç­‰ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€‚</p><p><img src="./../design-pattern-structural/image-20240125210108820.png" alt=""></p><p><strong>å®šä¹‰ï¼š</strong></p><p>â€‹å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»èƒ½ä¸€èµ·å·¥ä½œã€‚</p><p>â€‹é€‚é…å™¨æ¨¡å¼åˆ†ä¸º<strong>ç±»é€‚é…å™¨æ¨¡å¼</strong>å’Œ<strong>å¯¹è±¡é€‚é…å™¨æ¨¡å¼</strong>ï¼Œå‰è€…ç±»ä¹‹é—´çš„è€¦åˆåº¦æ¯”åè€…é«˜ï¼Œä¸”è¦æ±‚ç¨‹åºå‘˜äº†è§£ç°æœ‰ç»„ä»¶åº“ä¸­çš„ç›¸å…³ç»„ä»¶çš„å†…éƒ¨ç»“æ„ï¼Œæ‰€ä»¥åº”ç”¨ç›¸å¯¹è¾ƒå°‘äº›ã€‚</p><h3 id="ç»“æ„-2">ç»“æ„</h3><p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ul><li><strong>ç›®æ ‡ï¼ˆTargetï¼‰æ¥å£</strong>(æ’åº§)ï¼šå½“å‰ç³»ç»Ÿä¸šåŠ¡æ‰€æœŸå¾…çš„æ¥å£ï¼Œå®ƒå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ã€‚</li><li><strong>é€‚é…è€…ï¼ˆAdapteeï¼‰ç±»</strong>(æ’å¤´)ï¼šå®ƒæ˜¯è¢«è®¿é—®å’Œé€‚é…çš„ç°å­˜ç»„ä»¶åº“ä¸­çš„ç»„ä»¶æ¥å£ã€‚</li><li><strong>é€‚é…å™¨ï¼ˆAdapterï¼‰ç±»</strong>(è½¬æ¢å™¨)ï¼šå®ƒæ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œé€šè¿‡ç»§æ‰¿æˆ–å¼•ç”¨é€‚é…è€…çš„å¯¹è±¡ï¼ŒæŠŠé€‚é…è€…æ¥å£è½¬æ¢æˆç›®æ ‡æ¥å£ï¼Œè®©å®¢æˆ·æŒ‰ç›®æ ‡æ¥å£çš„æ ¼å¼è®¿é—®é€‚é…è€…ã€‚</li></ul><h3 id="ç±»é€‚é…å™¨æ¨¡å¼">ç±»é€‚é…å™¨æ¨¡å¼</h3><p>å®ç°æ–¹å¼ï¼šå®šä¹‰ä¸€ä¸ªé€‚é…å™¨ç±»æ¥å®ç°å½“å‰ç³»ç»Ÿçš„ä¸šåŠ¡æ¥å£ï¼ŒåŒæ—¶åˆç»§æ‰¿ç°æœ‰ç»„ä»¶åº“ä¸­å·²ç»å­˜åœ¨çš„ç»„ä»¶ã€‚</p><p>ã€ä¾‹ã€‘è¯»å¡å™¨</p><p>ç°æœ‰ä¸€å°ç”µè„‘åªèƒ½è¯»å– SD å¡ï¼Œè€Œè¦è¯»å– TF å¡ä¸­çš„å†…å®¹çš„è¯å°±éœ€è¦ä½¿ç”¨åˆ°é€‚é…å™¨æ¨¡å¼ã€‚åˆ›å»ºä¸€ä¸ªè¯»å¡å™¨ï¼Œå°† TF å¡ä¸­çš„å†…å®¹è¯»å–å‡ºæ¥ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Client {+ main() void}class Computer {+ read(SDCard sdCard) String }class SDCard {<< interface >>+ readSD() String+ writeSD() void}class SDcardImpl {+ readSD() String+ writeSD() void}class SDAdapterTF {+ readSD() String+ writeSD() void}class TFCard {<< interface >>+ readTF() String+ writeTF() void}class TFCardImpl {+ readTF() String+ writeTF() void}TFCard <|.. TFCardImpl : å®ç°TFCardImpl <|-- SDAdapterTF : ç»§æ‰¿SDCard <|.. SDcardImpl : å®ç°SDCard <|.. SDAdapterTF : å®ç°Computer ..> SDCard : ä¾èµ–Client ..> ComputerClient ..> SDcardImplClient ..> SDAdapterTF</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é€‚é…è€…ç±»</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TFCard</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ä» TF å¡ä¸­è¯»å–æ•°æ®</span>    <span class="token class-name">String</span> <span class="token function">readTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å¾€ TF å¡ä¸­å†™æ•°æ®</span>    <span class="token keyword">void</span> <span class="token function">writeTF</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é€‚é…è€…ç±»å®ç°ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TFCardImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TFCard</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"TFCard read msg: hellp word TFcard"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeTF</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TFCard write msg : "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç›®æ ‡æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SDCard</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ä»SDå¡ä¸­è¯»å–æ•°æ®</span>    <span class="token class-name">String</span> <span class="token function">readSD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å¾€SDå¡ä¸­å†™æ•°æ®</span>    <span class="token keyword">void</span> <span class="token function">writeSD</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//SDå¡å®ç°ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SDCardImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SDCard</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readSD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"SDCard read msg: hello word SD"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeSD</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SDCard write msg: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç”µè„‘ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readSD</span><span class="token punctuation">(</span><span class="token class-name">SDCard</span> sdCard<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>sdCard <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">"sd card is not null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> sdCard<span class="token punctuation">.</span><span class="token function">readSD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é€‚é…å™¨ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SDAdapterTF</span> <span class="token keyword">extends</span> <span class="token class-name">TFCardImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SDCard</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readSD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"adapter read tf card"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">readTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeSD</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"adapter write tf card"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">writeTF</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºè®¡ç®—æœºå¯¹è±¡</span>        <span class="token class-name">Computer</span> computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¯»å–SDå¡ä¸­çš„æ•°æ®</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> computer<span class="token punctuation">.</span><span class="token function">readSD</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SDCardImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä½¿ç”¨è¯¥ç”µè„‘è¯»å–TFå¡ä¸­çš„æ•°æ®</span>        <span class="token comment">//å®šä¹‰é€‚é…å™¨ç±»</span>        <span class="token class-name">String</span> msg1 <span class="token operator">=</span> computer<span class="token punctuation">.</span><span class="token function">readSD</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SDAdapterTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç±»é€‚é…å™¨æ¨¡å¼è¿èƒŒäº†åˆæˆå¤ç”¨åŸåˆ™ã€‚ç±»é€‚é…å™¨æ˜¯å®¢æˆ·ç±»æœ‰ä¸€ä¸ªæ¥å£è§„èŒƒçš„æƒ…å†µä¸‹å¯ç”¨ï¼Œåä¹‹ä¸å¯ç”¨ã€‚</p><h3 id="å¯¹è±¡é€‚é…å™¨æ¨¡å¼">å¯¹è±¡é€‚é…å™¨æ¨¡å¼</h3><p>å®ç°æ–¹å¼ï¼šå¯¹è±¡é€‚é…å™¨æ¨¡å¼å¯é‡†ç”¨å°†ç°æœ‰ç»„ä»¶åº“ä¸­å·²ç»å®ç°çš„ç»„ä»¶å¼•å…¥é€‚é…å™¨ç±»ä¸­ï¼Œè¯¥ç±»åŒæ—¶å®ç°å½“å‰ç³»ç»Ÿçš„ä¸šåŠ¡æ¥å£ã€‚</p><p>ã€ä¾‹ã€‘è¯»å¡å™¨</p><p>æˆ‘ä»¬ä½¿ç”¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼å°†è¯»å¡å™¨çš„æ¡ˆä¾‹è¿›è¡Œæ”¹å†™ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Client {+ main() void}class SDcardImpl {+ readSD() String+ writeSD() void}class SDCard {+ readSD() String+ writeSD() void}class Computer {+ readSD(SDCard sdCard) String}class SDcardImpl {+ readSD() String+ writeSD() void}class SDAdapterTF {- tfCard : TFCard+ SDAdapterTF(TFCard tfCard)+ readSD() String+ writeSD() void}class TFCard {<< interface >>+ readTF() String+ writeTF() void}class TFCardImpl {+ readTF() String+ writeTF() void}SDCard <|.. SDcardImpl : å®ç°SDCard <|.. SDAdapterTF : å®ç°SDAdapterTF o-- TFCard : èšåˆTFCard <|.. TFCardImpl : å®ç°Computer ..> SDCard : ä¾èµ–Client ..> ComputerClient ..> SDcardImplClient ..> SDAdapterTF</pre><p><strong>Code:</strong></p><p>ç±»é€‚é…å™¨æ¨¡å¼çš„ä»£ç ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹é€‚é…å™¨ç±»ï¼ˆSDAdapterTFï¼‰å’Œæµ‹è¯•ç±»ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é€‚é…å™¨ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SDAdapterTF</span> <span class="token keyword">implements</span> <span class="token class-name">SDCard</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å£°æ˜é€‚é…è€…ç±»</span>    <span class="token keyword">private</span> <span class="token class-name">TFCard</span> tfCard<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">SDAdapterTF</span><span class="token punctuation">(</span><span class="token class-name">TFCard</span> tfCard<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>tfCard <span class="token operator">=</span> tfCard<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readSD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"adapter read tf card"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> tfCard<span class="token punctuation">.</span><span class="token function">readTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeSD</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"adapter write tf card"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        tfCard<span class="token punctuation">.</span><span class="token function">writeTF</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºè®¡ç®—æœºå¯¹è±¡</span>        <span class="token class-name">Computer</span> computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¯»å–SDå¡ä¸­çš„æ•°æ®</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> computer<span class="token punctuation">.</span><span class="token function">readSD</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SDCardImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä½¿ç”¨è¯¥ç”µè„‘è¯»å–TFå¡ä¸­çš„æ•°æ®</span>        <span class="token class-name">SDAdapterTF</span> sdAdapterTF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SDAdapterTF</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TFCardImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> msg1 <span class="token operator">=</span> computer<span class="token punctuation">.</span><span class="token function">readSD</span><span class="token punctuation">(</span>sdAdapterTF<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„ï¼šè¿˜æœ‰ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼æ˜¯æ¥å£é€‚é…å™¨æ¨¡å¼ã€‚å½“ä¸å¸Œæœ›å®ç°ä¸€ä¸ªæ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±» Adapter ï¼Œå®ç°æ‰€æœ‰æ–¹æ³•ã€‚è€Œæ­¤æ—¶æˆ‘ä»¬åªéœ€è¦ç»§æ‰¿è¯¥æŠ½è±¡ç±»å³å¯ã€‚</p></blockquote><h3 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h3><ul><li>ä»¥å‰å¼€å‘çš„ç³»ç»Ÿå­˜åœ¨æ»¡è¶³æ–°ç³»ç»ŸåŠŸèƒ½éœ€æ±‚çš„ç±»ï¼Œä½†å…¶æ¥å£åŒæ–°ç³»ç»Ÿçš„æ¥å£ä¸ä¸€è‡´ã€‚</li><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„ç»„ä»¶ï¼Œä½†ç»„ä»¶æ¥å£å®šä¹‰å’Œè‡ªå·±è¦æ±‚çš„æ¥å£å®šä¹‰ä¸åŒã€‚</li></ul><h3 id="JDKæºç è§£æ">JDKæºç è§£æ</h3><p>Readerï¼ˆå­—ç¬¦æµï¼‰ã€InputStreamï¼ˆå­—èŠ‚æµï¼‰çš„é€‚é…ä½¿ç”¨çš„æ˜¯InputStreamReaderã€‚</p><p>InputStreamReader ç»§æ‰¿è‡ª <a href="http://java.io">java.io</a> åŒ…ä¸­çš„ Readerï¼Œå¯¹ä»–ä¸­çš„æŠ½è±¡çš„æœªå®ç°çš„æ–¹æ³•ç»™å‡ºå®ç°ã€‚å¦‚ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> sd<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">char</span> cbuf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> sd<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>cbuf<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šä»£ç ä¸­çš„ sdï¼ˆStreamDecoder ç±»å¯¹è±¡ï¼‰ï¼Œåœ¨ Sun çš„ JDK å®ç°ä¸­ï¼Œå®é™…çš„æ–¹æ³•å®ç°æ˜¯å¯¹ sun.nio.cs.StreamDecoder ç±»çš„åŒåæ–¹æ³•çš„è°ƒç”¨å°è£…ã€‚ç±»ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Reader {+ read(char cbuff[]) int+ read(char cbuff[], int off, int len) int}class InputStreamReader {- sd : StreamDecoder+ read(char cbuff[]) int+ read(char cbuff[], int off, int len) int}class InputStream {+ read() int+ read(byte cbuff[]) int+ read(byte cbuff[], int off, int len) int}class StreamDecoder {- in : InputStream+ read(char cbuff[]) int+ read(char cbuff[], int off, int len) int}Reader <|-- InputStreamReader : ç»§æ‰¿InputStreamReader o-- StreamDecoder : èšåˆReader <|-- StreamDecoder : ç»§æ‰¿InputStream --o StreamDecoder : èšåˆ</pre><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼š</p><ul><li>InputStreamReader æ˜¯å¯¹åŒæ ·å®ç°äº† Reader çš„ StreamDecoder çš„å°è£…ã€‚</li><li>StreamDecoder ä¸æ˜¯ Java SE API ä¸­çš„å†…å®¹ï¼Œæ˜¯ Sun JDK ç»™å‡ºçš„è‡ªèº«å®ç°ã€‚ä½†æˆ‘ä»¬çŸ¥é“ä»–ä»¬å¯¹æ„é€ æ–¹æ³•ä¸­çš„å­—èŠ‚æµç±»ï¼ˆInputStreamï¼‰è¿›è¡Œå°è£…ï¼Œå¹¶é€šè¿‡è¯¥ç±»è¿›è¡Œäº†å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„è§£ç è½¬æ¢ã€‚</li></ul><p><font color="red">ç»“è®ºï¼š</font></p><p>â€‹ä»è¡¨å±‚æ¥çœ‹ï¼ŒInputStreamReader åšäº† InputStream å­—èŠ‚æµç±»åˆ° Reader å­—ç¬¦æµä¹‹é—´çš„è½¬æ¢ã€‚<strong>è€Œä»å¦‚ä¸Š Sun JDK ä¸­çš„å®ç°ç±»å…³ç³»ç»“æ„ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ˜¯ StreamDecoder çš„è®¾è®¡å®ç°åœ¨å®é™…ä¸Šé‡‡ç”¨äº†å¯¹è±¡é€‚é…å™¨æ¨¡å¼</strong>ã€‚</p><h2 id="3-è£…é¥°è€…æ¨¡å¼">3-è£…é¥°è€…æ¨¡å¼</h2><h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå¿«é¤åº—çš„ä¾‹å­ã€‚</p><p>å¿«é¤åº—æœ‰ç‚’é¢ã€ç‚’é¥­è¿™äº›å¿«é¤ï¼Œå¯ä»¥é¢å¤–é™„åŠ é¸¡è›‹ã€ç«è…¿ã€åŸ¹æ ¹è¿™äº›é…èœï¼Œå½“ç„¶åŠ é…èœéœ€è¦é¢å¤–åŠ é’±ï¼Œæ¯ä¸ªé…èœçš„ä»·é’±é€šå¸¸ä¸å¤ªä¸€æ ·ï¼Œé‚£ä¹ˆè®¡ç®—æ€»ä»·å°±ä¼šæ˜¾å¾—æ¯”è¾ƒéº»çƒ¦ã€‚</p><pre class="mermaid">classDiagramclass FastFood {- price : float- desc : String+ setPrice(float price) void+ setDesc(String desc) void+ getPrice() float+ getDesc() String+ cost() float}class FriedRice {+ FriedRice()+ cost() float}class EggFriedRice { }class BaconFriedRice { }class FriedNoodles {+ FriedNoodles()+ cost() float}class EggFriedNoodles { }class BaconFriedNoodles { }FastFood <|-- FriedRice : ç»§æ‰¿FastFood <|-- FriedNoodles : ç»§æ‰¿FriedRice <|-- EggFriedRiceFriedRice <|-- BaconFriedRiceFriedNoodles <|-- EggFriedNoodlesFriedNoodles <|-- BaconFriedNoodles</pre><p>ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li><p>æ‰©å±•æ€§ä¸å¥½</p><p>å¦‚æœè¦å†åŠ ä¸€ç§é…æ–™ï¼ˆç«è…¿è‚ ï¼‰ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°éœ€è¦ç»™ FriedRice å’ŒFriedNoodles åˆ†åˆ«å®šä¹‰ä¸€ä¸ªå­ç±»ã€‚å¦‚æœè¦æ–°å¢ä¸€ä¸ªå¿«é¤å“ç±»ï¼ˆç‚’æ²³ç²‰ï¼‰çš„è¯ï¼Œå°±éœ€è¦å®šä¹‰æ›´å¤šçš„å­ç±»ã€‚</p></li><li><p>äº§ç”Ÿè¿‡å¤šçš„å­ç±»</p></li></ul><p><strong>å®šä¹‰ï¼š</strong></p><p>â€‹æŒ‡åœ¨ä¸æ”¹å˜ç°æœ‰å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ç»™è¯¥å¯¹è±¡å¢åŠ ä¸€äº›èŒè´£ï¼ˆå³å¢åŠ å…¶é¢å¤–åŠŸèƒ½ï¼‰çš„æ¨¡å¼ã€‚</p><h3 id="ç»“æ„-3">ç»“æ„</h3><p>è£…é¥°ï¼ˆDecoratorï¼‰æ¨¡å¼ä¸­çš„è§’è‰²ï¼š</p><ul><li>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰è§’è‰² ï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¥å£ä»¥è§„èŒƒå‡†å¤‡æ¥æ”¶é™„åŠ è´£ä»»çš„å¯¹è±¡ã€‚</li><li>å…·ä½“æ„ä»¶ï¼ˆConcrete  Componentï¼‰è§’è‰² ï¼šå®ç°æŠ½è±¡æ„ä»¶ï¼Œé€šè¿‡è£…é¥°è§’è‰²ä¸ºå…¶æ·»åŠ ä¸€äº›èŒè´£ã€‚</li><li>æŠ½è±¡è£…é¥°ï¼ˆDecoratorï¼‰è§’è‰² ï¼š ç»§æ‰¿æˆ–å®ç°æŠ½è±¡æ„ä»¶ï¼Œå¹¶åŒ…å«å…·ä½“æ„ä»¶çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡å…¶å­ç±»æ‰©å±•å…·ä½“æ„ä»¶çš„åŠŸèƒ½ã€‚</li><li>å…·ä½“è£…é¥°ï¼ˆConcreteDecoratorï¼‰è§’è‰² ï¼šå®ç°æŠ½è±¡è£…é¥°çš„ç›¸å…³æ–¹æ³•ï¼Œå¹¶ç»™å…·ä½“æ„ä»¶å¯¹è±¡æ·»åŠ é™„åŠ çš„è´£ä»»ã€‚</li></ul><h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3><p>æˆ‘ä»¬ä½¿ç”¨è£…é¥°è€…æ¨¡å¼å¯¹å¿«é¤åº—æ¡ˆä¾‹è¿›è¡Œæ”¹è¿›ï¼Œä½“ä¼šè£…é¥°è€…æ¨¡å¼çš„ç²¾é«“ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass FastFood {- price : float- desc : String+ setPrice(float price) void+ setDesc(String desc) void+ getPrice() float+ getDesc() String+ cost() float}class FriedRice {+ FriedRice()+ cost() float}class FriedNoodles {+ FriedNoodles()+ cost() float}class Garnish {- fastFood : FastFood+ Garnish(FastFood fastFood, float price, String desc)+ setFastFood(FastFood fastFood)+ getFastFood() FastFood}class Egg {+ Egg(FastFood fastFood)+ cost() float+ getDesc() String}class Bacon {+ Bacon(FastFood fastFood)+ cost() float+ getDesc() String}FastFood <|-- FriedRice : ç»§æ‰¿FastFood <|-- FriedNoodles : ç»§æ‰¿FastFood <|-- Garnish : ç»§æ‰¿FastFood --o Garnish : èšåˆGarnish <|-- Egg : ç»§æ‰¿Garnish <|-- Bacon : ç»§æ‰¿link FastFood "#FastFood"link FriedRice "#FriedRice"link FriedNoodles "#FriedNoodles"link Garnish "#Garnish"link Egg "#Egg"link Bacon "#Bacon"</pre><h6 id="FastFood">FastFood</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¿«é¤ç±»(æŠ½è±¡æ„å»ºè§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FastFood</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">float</span> price<span class="token punctuation">;</span><span class="token comment">//ä»·æ ¼</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span><span class="token comment">//æè¿°</span><span class="token comment">//çœç•¥ get set..</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="FriedNoodles">FriedNoodles</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç‚’é¢(å…·ä½“æ„å»ºè§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FriedNoodles</span> <span class="token keyword">extends</span> <span class="token class-name">FastFood</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">FriedNoodles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"ç‚’é¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="FriedRice">FriedRice</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç‚’é¥­ç±»(å…·ä½“æ„å»ºè§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FriedRice</span> <span class="token keyword">extends</span> <span class="token class-name">FastFood</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">FriedRice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"ç‚’é¥­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="Garnish">Garnish</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è£…é¥°è€…ç±»(æŠ½è±¡è£…é¥°è€…è§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Garnish</span> <span class="token keyword">extends</span> <span class="token class-name">FastFood</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å£°æ˜å¿«é¤ç±»çš„å˜é‡</span>    <span class="token keyword">private</span> <span class="token class-name">FastFood</span> fastFood<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">FastFood</span> <span class="token function">getFastFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> fastFood<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFastFood</span><span class="token punctuation">(</span><span class="token class-name">FastFood</span> fastFood<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>fastFood <span class="token operator">=</span> fastFood<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Garnish</span><span class="token punctuation">(</span><span class="token class-name">FastFood</span> fastFood<span class="token punctuation">,</span> <span class="token keyword">float</span> price<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>price<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>fastFood <span class="token operator">=</span> fastFood<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="Egg">Egg</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é¸¡è›‹ç±»(å…·ä½“è£…é¥°è€…è§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Egg</span> <span class="token keyword">extends</span> <span class="token class-name">Garnish</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Egg</span><span class="token punctuation">(</span><span class="token class-name">FastFood</span> fastFood<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>fastFood<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"é¸¡è›‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è®¡ç®—ä»·æ ¼</span>        <span class="token keyword">return</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getFastFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getFastFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="Bacon">Bacon</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//åŸ¹æ ¹ç±»(å…·ä½“è£…é¥°è€…è§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bacon</span> <span class="token keyword">extends</span> <span class="token class-name">Garnish</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Bacon</span><span class="token punctuation">(</span><span class="token class-name">FastFood</span> fastFood<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>fastFood<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"åŸ¹æ ¹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è®¡ç®—ä»·æ ¼</span>        <span class="token keyword">return</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getFastFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getFastFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ç‚¹ä¸€ä»½ç‚’é¥­</span>        <span class="token class-name">FastFood</span> food <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FriedRice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>food<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"  "</span> <span class="token operator">+</span> food<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å…ƒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åœ¨ä¸Šé¢çš„ç‚’é¥­ä¸­åŠ ä¸€ä¸ªé¸¡è›‹</span>        food <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Egg</span><span class="token punctuation">(</span>food<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>food<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"  "</span> <span class="token operator">+</span> food<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å…ƒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å†åŠ ä¸€ä¸ªé¸¡è›‹</span>        food <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Egg</span><span class="token punctuation">(</span>food<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>food<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"  "</span> <span class="token operator">+</span> food<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å…ƒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åŠ ä¸€ä¸ªåŸ¹æ ¹</span>        food <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bacon</span><span class="token punctuation">(</span>food<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>food<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"  "</span> <span class="token operator">+</span> food<span class="token punctuation">.</span><span class="token function">cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å…ƒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ç‚’é¥­  10.0å…ƒ&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;é¸¡è›‹ç‚’é¥­  11.0å…ƒ&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;é¸¡è›‹é¸¡è›‹ç‚’é¥­  12.0å…ƒ&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;åŸ¹æ ¹é¸¡è›‹é¸¡è›‹ç‚’é¥­  14.0å…ƒ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¥½å¤„">å¥½å¤„</h3><ul><li><p>é¥°è€…æ¨¡å¼å¯ä»¥å¸¦æ¥æ¯”ç»§æ‰¿æ›´åŠ çµæ´»æ€§çš„æ‰©å±•åŠŸèƒ½ï¼Œä½¿ç”¨æ›´åŠ æ–¹ä¾¿ï¼Œå¯ä»¥é€šè¿‡ç»„åˆä¸åŒçš„è£…é¥°è€…å¯¹è±¡æ¥è·å–å…·æœ‰ä¸åŒè¡Œä¸ºçŠ¶æ€çš„å¤šæ ·åŒ–çš„ç»“æœã€‚è£…é¥°è€…æ¨¡å¼æ¯”ç»§æ‰¿æ›´å…·è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå®Œç¾çš„éµå¾ªå¼€é—­åŸåˆ™ï¼Œç»§æ‰¿æ˜¯é™æ€çš„é™„åŠ è´£ä»»ï¼Œè£…é¥°è€…åˆ™æ˜¯åŠ¨æ€çš„é™„åŠ è´£ä»»ã€‚</p></li><li><p>è£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ¨¡å¼ï¼Œè£…é¥°æ¨¡å¼å¯ä»¥åŠ¨æ€æ‰©å±•ä¸€ä¸ªå®ç°ç±»çš„åŠŸèƒ½ã€‚</p></li></ul><h3 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</h3><ul><li><p>å½“ä¸èƒ½é‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼å¯¹ç³»ç»Ÿè¿›è¡Œæ‰©å……æˆ–è€…é‡‡ç”¨ç»§æ‰¿ä¸åˆ©äºç³»ç»Ÿæ‰©å±•å’Œç»´æŠ¤æ—¶ã€‚</p><p>ä¸èƒ½é‡‡ç”¨ç»§æ‰¿çš„æƒ…å†µä¸»è¦æœ‰ä¸¤ç±»ï¼š</p><ul><li>ç¬¬ä¸€ç±»æ˜¯ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç‹¬ç«‹çš„æ‰©å±•ï¼Œä¸ºæ”¯æŒæ¯ä¸€ç§ç»„åˆå°†äº§ç”Ÿå¤§é‡çš„å­ç±»ï¼Œä½¿å¾—å­ç±»æ•°ç›®å‘ˆçˆ†ç‚¸æ€§å¢é•¿ï¼›</li><li>ç¬¬äºŒç±»æ˜¯å› ä¸ºç±»å®šä¹‰ä¸èƒ½ç»§æ‰¿ï¼ˆå¦‚ final ç±»ï¼‰</li></ul></li><li><p>åœ¨ä¸å½±å“å…¶ä»–å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä»¥åŠ¨æ€ã€é€æ˜çš„æ–¹å¼ç»™å•ä¸ªå¯¹è±¡æ·»åŠ èŒè´£ã€‚</p></li><li><p>å½“å¯¹è±¡çš„åŠŸèƒ½è¦æ±‚å¯ä»¥åŠ¨æ€åœ°æ·»åŠ ï¼Œä¹Ÿå¯ä»¥å†åŠ¨æ€åœ°æ’¤é”€æ—¶ã€‚</p></li></ul><h3 id="JDKæºç è§£æ-2">JDKæºç è§£æ</h3><p>IO æµä¸­çš„åŒ…è£…ç±»ä½¿ç”¨åˆ°äº†è£…é¥°è€…æ¨¡å¼ã€‚BufferedInputStreamï¼ŒBufferedOutputStreamï¼ŒBufferedReaderï¼ŒBufferedWriterã€‚</p><p>æˆ‘ä»¬ä»¥ BufferedWriter ä¸¾ä¾‹æ¥è¯´æ˜ï¼Œå…ˆçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ BufferedWriter</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºBufferedWriterå¯¹è±¡</span>        <span class="token comment">//åˆ›å»ºFileWriterå¯¹è±¡</span>        <span class="token class-name">FileWriter</span> fw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Think\\Desktop\\a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BufferedWriter</span> bw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span>fw<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å†™æ•°æ®</span>        bw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello Buffered"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bw<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨èµ·æ¥æ„Ÿè§‰ç¡®å®åƒæ˜¯è£…é¥°è€…æ¨¡å¼ï¼Œæ¥ä¸‹æ¥çœ‹å®ƒä»¬çš„ç»“æ„ï¼š</p><pre class="mermaid">classDiagramclass Writer {- wrieteBuffer : char[]+ write(int c) void+ write(char cbuf[]) void+ write(char cbuf[], int off, int len) voidwrite(String str) voidwrite(String str, int off, int len) void}class InputStreamWriter { }class FileWriter { }class BufferedWriter { }Writer <|-- InputStreamWriter : ç»§æ‰¿Writer --o BufferedWriter : èšåˆWriter <|-- BufferedWriter : ç»§æ‰¿InputStreamWriter <|-- FileWriter</pre><blockquote><p><font color="red">å°ç»“ï¼š</font></p><p>â€‹BufferedWriter ä½¿ç”¨è£…é¥°è€…æ¨¡å¼å¯¹ Writer å­å®ç°ç±»è¿›è¡Œäº†å¢å¼ºï¼Œæ·»åŠ äº†ç¼“å†²åŒºï¼Œæé«˜äº†å†™æ•°æ®çš„æ•ˆç‡ã€‚</p><p>â€‹è£…é¥°ç€æ¨¡å¼æœ€å¤§çš„ç‰¹ç‚¹åŠå·§å¦™ä¹‹å¤„å°±æ˜¯ç»§æ‰¿çš„åŒæ—¶åˆèšåˆäº†çˆ¶ç±»ã€‚</p></blockquote><h3 id="ä»£ç†å’Œè£…é¥°è€…çš„åŒºåˆ«">ä»£ç†å’Œè£…é¥°è€…çš„åŒºåˆ«</h3><p>é™æ€ä»£ç†å’Œè£…é¥°è€…æ¨¡å¼çš„åŒºåˆ«ï¼š</p><ul><li><p>ç›¸åŒç‚¹ï¼š</p><ul><li>éƒ½è¦å®ç°ä¸ç›®æ ‡ç±»ç›¸åŒçš„ä¸šåŠ¡æ¥å£</li><li>åœ¨ä¸¤ä¸ªç±»ä¸­éƒ½è¦å£°æ˜ç›®æ ‡å¯¹è±¡</li><li>éƒ½å¯ä»¥åœ¨ä¸ä¿®æ”¹ç›®æ ‡ç±»çš„å‰æä¸‹å¢å¼ºç›®æ ‡æ–¹æ³•</li></ul></li><li><p>ä¸åŒç‚¹ï¼š</p><ul><li><p><strong>ç›®çš„ä¸åŒ</strong></p><p>è£…é¥°è€…æ˜¯ä¸ºäº†å¢å¼ºç›®æ ‡å¯¹è±¡</p><p>é™æ€ä»£ç†æ˜¯ä¸ºäº†ä¿æŠ¤å’Œéšè—ç›®æ ‡å¯¹è±¡</p></li><li><p><strong>è·å–ç›®æ ‡å¯¹è±¡æ„å»ºçš„åœ°æ–¹ä¸åŒ</strong></p><p>è£…é¥°è€…æ˜¯ç”±å¤–ç•Œä¼ é€’è¿›æ¥ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•ä¼ é€’</p><p>é™æ€ä»£ç†æ˜¯åœ¨ä»£ç†ç±»å†…éƒ¨åˆ›å»ºï¼Œä»¥æ­¤æ¥éšè—ç›®æ ‡å¯¹è±¡</p></li></ul></li></ul><h2 id="4-æ¡¥æ¥æ¨¡å¼">4-æ¡¥æ¥æ¨¡å¼</h2><h3 id="æ¦‚è¿°-3">æ¦‚è¿°</h3><p>ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦åˆ›å»ºä¸åŒçš„å›¾å½¢ï¼Œå¹¶ä¸”æ¯ä¸ªå›¾å½¢éƒ½æœ‰å¯èƒ½ä¼šæœ‰ä¸åŒçš„é¢œè‰²ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥è®¾è®¡ç±»çš„å…³ç³»ï¼š</p><pre class="mermaid">classDiagramclass Shape {+ draw()}class Circle {+ draw()}class Rectangle {+ draw()}class Square {+ draw()}class BlackCircle { }class GrayCircle { }class WhiteCircle { }class BlackRectangle { }class GrayRectangle { }class WhiteRectangle { }class BlackSquare { }class GraySquare { }class WhiteSquare { }Shape <|-- CircleShape <|-- RectangleShape <|-- SquareCircle <|-- BlackCircleCircle <|-- GrayCircleCircle <|-- WhiteCircleRectangle <|-- BlackRectangleRectangle <|-- GrayRectangleRectangle <|-- WhiteRectangleSquare <|-- BlackSquareSquare <|-- GraySquareSquare <|-- WhiteSquare</pre><p>æˆ‘ä»¬å¯ä»¥å‘ç°æœ‰å¾ˆå¤šçš„ç±»ï¼Œå‡å¦‚æˆ‘ä»¬å†å¢åŠ ä¸€ä¸ªå½¢çŠ¶æˆ–å†å¢åŠ ä¸€ç§é¢œè‰²ï¼Œå°±éœ€è¦åˆ›å»ºæ›´å¤šçš„ç±»ã€‚</p><p>è¯•æƒ³ï¼Œåœ¨ä¸€ä¸ªæœ‰å¤šç§å¯èƒ½ä¼šå˜åŒ–çš„ç»´åº¦çš„ç³»ç»Ÿä¸­ï¼Œç”¨ç»§æ‰¿æ–¹å¼ä¼šé€ æˆç±»çˆ†ç‚¸ï¼Œæ‰©å±•èµ·æ¥ä¸çµæ´»ã€‚æ¯æ¬¡åœ¨ä¸€ä¸ªç»´åº¦ä¸Šæ–°å¢ä¸€ä¸ªå…·ä½“å®ç°éƒ½è¦å¢åŠ å¤šä¸ªå­ç±»ã€‚ä¸ºäº†æ›´åŠ çµæ´»çš„è®¾è®¡ç³»ç»Ÿï¼Œæˆ‘ä»¬æ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ã€‚</p><p><strong>å®šä¹‰ï¼š</strong></p><p>â€‹å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚å®ƒæ˜¯ç”¨ç»„åˆå…³ç³»ä»£æ›¿ç»§æ‰¿å…³ç³»æ¥å®ç°ï¼Œä»è€Œé™ä½äº†æŠ½è±¡å’Œå®ç°è¿™ä¸¤ä¸ªå¯å˜ç»´åº¦çš„è€¦åˆåº¦ã€‚</p><h3 id="ç»“æ„-4">ç»“æ„</h3><p>æ¡¥æ¥ï¼ˆBridgeï¼‰æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ï¼š</p><ul><li>æŠ½è±¡åŒ–ï¼ˆAbstractionï¼‰è§’è‰² ï¼šå®šä¹‰æŠ½è±¡ç±»ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ã€‚</li><li>æ‰©å±•æŠ½è±¡åŒ–ï¼ˆRefined  Abstractionï¼‰è§’è‰² ï¼šæ˜¯æŠ½è±¡åŒ–è§’è‰²çš„å­ç±»ï¼Œå®ç°çˆ¶ç±»ä¸­çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå¹¶é€šè¿‡ç»„åˆå…³ç³»è°ƒç”¨å®ç°åŒ–è§’è‰²ä¸­çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li><li>å®ç°åŒ–ï¼ˆImplementorï¼‰è§’è‰² ï¼šå®šä¹‰å®ç°åŒ–è§’è‰²çš„æ¥å£ï¼Œä¾›æ‰©å±•æŠ½è±¡åŒ–è§’è‰²è°ƒç”¨ã€‚</li><li>å…·ä½“å®ç°åŒ–ï¼ˆConcrete Implementorï¼‰è§’è‰² ï¼šç»™å‡ºå®ç°åŒ–è§’è‰²æ¥å£çš„å…·ä½“å®ç°ã€‚</li></ul><h3 id="æ¡ˆä¾‹-2">æ¡ˆä¾‹</h3><p>ã€ä¾‹ã€‘è§†é¢‘æ’­æ”¾å™¨</p><p>éœ€è¦å¼€å‘ä¸€ä¸ªè·¨å¹³å°è§†é¢‘æ’­æ”¾å™¨ï¼Œå¯ä»¥åœ¨ä¸åŒæ“ä½œç³»ç»Ÿå¹³å°ï¼ˆå¦‚ Windowsã€Macã€Linux ç­‰ï¼‰ä¸Šæ’­æ”¾å¤šç§æ ¼å¼çš„è§†é¢‘æ–‡ä»¶ï¼Œå¸¸è§çš„è§†é¢‘æ ¼å¼åŒ…æ‹¬ RMVBã€AVIã€WMV ç­‰ã€‚è¯¥æ’­æ”¾å™¨åŒ…å«äº†ä¸¤ä¸ªç»´åº¦ï¼Œé€‚åˆä½¿ç”¨æ¡¥æ¥æ¨¡å¼ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass OperatingSystem {# videoFile : VideoFile+ OperatingSystem(VideoFile videoFile)+ play(String fileName) void}class Windows {+ Windows(VideoFile videoFile)+ play(String fileName) void}class Mac {+ Mac(VideoFile videoFile)+ play(String fileName) void}class VideoFile {+ decode(String fileName) void}class AVIFile {+ decode(String fileName) void} class RMVBFile {+ decode(String fileName) void}OperatingSystem <|-- WindowsOperatingSystem <|-- MacOperatingSystem o-- VideoFileVideoFile <|.. AVIFileVideoFile <|.. RMVBFile</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è§†é¢‘æ–‡ä»¶(å®ç°åŒ–è§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">VideoFile</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//rmvbè§†é¢‘æ–‡ä»¶ï¼ˆå…·ä½“çš„å®ç°åŒ–è§’è‰²ï¼‰</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RmvbFile</span> <span class="token keyword">implements</span> <span class="token class-name">VideoFile</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rmvbè§†é¢‘æ–‡ä»¶ ï¼š"</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//aviè§†é¢‘æ–‡ä»¶ï¼ˆå…·ä½“çš„å®ç°åŒ–è§’è‰²ï¼‰</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AviFile</span> <span class="token keyword">implements</span> <span class="token class-name">VideoFile</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"aviè§†é¢‘æ–‡ä»¶ ï¼š"</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æŠ½è±¡æ“ä½œç³»ç»Ÿ(æŠ½è±¡åŒ–è§’è‰²)</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OperatingSystem</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å£°æ˜videoFileå˜é‡</span>    <span class="token keyword">protected</span> <span class="token class-name">VideoFile</span> videoFile<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">OperatingSystem</span><span class="token punctuation">(</span><span class="token class-name">VideoFile</span> videoFile<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>videoFile <span class="token operator">=</span> videoFile<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ‰©å±•æŠ½è±¡åŒ–è§’è‰²(windowsæ“ä½œç³»ç»Ÿ)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">OperatingSystem</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token class-name">VideoFile</span> videoFile<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>videoFile<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        videoFile<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ‰©å±•æŠ½è±¡åŒ–è§’è‰²(Macæ“ä½œç³»ç»Ÿ)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mac</span> <span class="token keyword">extends</span> <span class="token class-name">OperatingSystem</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Mac</span><span class="token punctuation">(</span><span class="token class-name">VideoFile</span> videoFile<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>videoFile<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        videoFile<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">OperatingSystem</span> system <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mac</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AviFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        system<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">"æˆ˜ç‹¼3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¥½å¤„-2">å¥½å¤„</h3><ul><li><p>æ¡¥æ¥æ¨¡å¼æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å……æ€§ï¼Œåœ¨ä¸¤ä¸ªå˜åŒ–ç»´åº¦ä¸­ä»»æ„æ‰©å±•ä¸€ä¸ªç»´åº¦ï¼Œéƒ½ä¸éœ€è¦ä¿®æ”¹åŸæœ‰ç³»ç»Ÿã€‚</p><p>å¦‚ï¼šå¦‚æœç°åœ¨è¿˜æœ‰ä¸€ç§è§†é¢‘æ–‡ä»¶ç±»å‹ wmvï¼Œæˆ‘ä»¬åªéœ€è¦å†å®šä¹‰ä¸€ä¸ªç±»å®ç° VideoFile æ¥å£å³å¯ï¼Œå…¶ä»–ç±»ä¸éœ€è¦å‘ç”Ÿå˜åŒ–ã€‚</p></li><li><p>å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜</p></li></ul><h3 id="ä½¿ç”¨åœºæ™¯-3">ä½¿ç”¨åœºæ™¯</h3><ul><li>å½“ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªç»´åº¦éƒ½éœ€è¦è¿›è¡Œæ‰©å±•æ—¶ã€‚</li><li>å½“ä¸€ä¸ªç³»ç»Ÿä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ æ—¶ã€‚</li><li>å½“ä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§æ—¶ã€‚é¿å…åœ¨ä¸¤ä¸ªå±‚æ¬¡ä¹‹é—´å»ºç«‹é™æ€çš„ç»§æ‰¿è”ç³»ï¼Œé€šè¿‡æ¡¥æ¥æ¨¡å¼å¯ä»¥ä½¿å®ƒä»¬åœ¨æŠ½è±¡å±‚å»ºç«‹ä¸€ä¸ªå…³è”å…³ç³»ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-04-åˆ›å»ºå‹æ¨¡å¼-åŸå‹&amp;å»ºé€ è€…</title>
      <link href="/2024/01/22/design-pattern-builder/"/>
      <url>/2024/01/22/design-pattern-builder/</url>
      
        <content type="html"><![CDATA[<h1>åˆ›å»ºå‹æ¨¡å¼ â…¢</h1><h2 id="åŸå‹æ¨¡å¼">åŸå‹æ¨¡å¼</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><p>ç”¨ä¸€ä¸ªå·²ç»åˆ›å»ºçš„å®ä¾‹ä½œä¸ºåŸå‹ï¼Œé€šè¿‡å¤åˆ¶è¯¥åŸå‹å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå’ŒåŸå‹å¯¹è±¡ç›¸åŒçš„æ–°å¯¹è±¡ã€‚</p><h3 id="ç»“æ„">ç»“æ„</h3><p>åŸå‹æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡åŸå‹ç±»ï¼šè§„å®šäº†å…·ä½“åŸå‹å¯¹è±¡å¿…é¡»å®ç°çš„çš„ clone() æ–¹æ³•ã€‚</li><li>å…·ä½“åŸå‹ç±»ï¼šå®ç°æŠ½è±¡åŸå‹ç±»çš„ clone() æ–¹æ³•ï¼Œå®ƒæ˜¯å¯è¢«å¤åˆ¶çš„å¯¹è±¡ã€‚</li><li>è®¿é—®ç±»ï¼šä½¿ç”¨å…·ä½“åŸå‹ç±»ä¸­çš„ clone() æ–¹æ³•æ¥å¤åˆ¶æ–°çš„å¯¹è±¡ã€‚</li></ul><p>æ¥å£ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Prototype {<< interface >>clone() Prototype}class PrototypeTest {+ main() void}class Realizetype {+ clone() Realizetype}Prototype <|.. Realizetype : å®ç°link Realizetype "#Realizetypeï¼ˆå…·ä½“çš„åŸå‹ç±»ï¼‰"link PrototypeTest "#PrototypeTestï¼ˆæµ‹è¯•è®¿é—®ç±»ï¼‰"</pre><h3 id="å®ç°">å®ç°</h3><p>åŸå‹æ¨¡å¼çš„å…‹éš†åˆ†ä¸ºæµ…å…‹éš†å’Œæ·±å…‹éš†ã€‚</p><blockquote><p>æµ…å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å±æ€§å’ŒåŸæ¥å¯¹è±¡å®Œå…¨ç›¸åŒï¼Œå¯¹äºéåŸºæœ¬ç±»å‹å±æ€§ï¼Œä»æŒ‡å‘åŸæœ‰å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</p><p>æ·±å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå±æ€§ä¸­å¼•ç”¨çš„å…¶ä»–å¯¹è±¡ä¹Ÿä¼šè¢«å…‹éš†ï¼Œä¸å†æŒ‡å‘åŸæœ‰å¯¹è±¡åœ°å€ã€‚</p></blockquote><p>Javaä¸­ çš„ Object ç±»ä¸­æä¾›äº† <code>clone()</code> æ–¹æ³•æ¥å®ç°æµ…å…‹éš†ã€‚ Cloneable æ¥å£æ˜¯ä¸Šé¢çš„ç±»å›¾ä¸­çš„æŠ½è±¡åŸå‹ç±»ï¼Œè€Œå®ç°äº†Cloneable æ¥å£çš„å­å®ç°ç±»å°±æ˜¯å…·ä½“çš„åŸå‹ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><h6 id="Realizetypeï¼ˆå…·ä½“çš„åŸå‹ç±»ï¼‰">Realizetypeï¼ˆå…·ä½“çš„åŸå‹ç±»ï¼‰</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Realizetype</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Realizetype</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“çš„åŸå‹å¯¹è±¡åˆ›å»ºå®Œæˆï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">Realizetype</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…·ä½“åŸå‹å¤åˆ¶æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Realizetype</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="PrototypeTestï¼ˆæµ‹è¯•è®¿é—®ç±»ï¼‰">PrototypeTestï¼ˆæµ‹è¯•è®¿é—®ç±»ï¼‰</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrototypeTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Realizetype</span> r1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Realizetype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Realizetype</span> r2 <span class="token operator">=</span> r1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯¹è±¡r1å’Œr2æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Ÿ"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>r1 <span class="token operator">==</span> r2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3><p><strong>ç”¨åŸå‹æ¨¡å¼ç”Ÿæˆâ€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶</strong></p><p>åŒä¸€å­¦æ ¡çš„â€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶é™¤äº†è·å¥–äººå§“åä¸åŒï¼Œå…¶ä»–éƒ½ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼å¤åˆ¶å¤šä¸ªâ€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶å‡ºæ¥ï¼Œç„¶ååœ¨ä¿®æ”¹å¥–çŠ¶ä¸Šçš„åå­—å³å¯ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Cloneable {+ clone() Object<< interface >>}class CitationTest {+ main() void}class Citation {- name : String+ setName(String name) void+ getName() String+ clone() Citation}Cloneable <|.. Citation : å®ç°</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¥–çŠ¶ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Citation</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">&#123;</span>    <span class="token comment">//ä¸‰å¥½å­¦ç”Ÿä¸Šçš„å§“å</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token comment">//çœç•¥ get set..</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Citation</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Citation</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"åŒå­¦ï¼šåœ¨2020å­¦å¹´ç¬¬ä¸€å­¦æœŸä¸­è¡¨ç°ä¼˜ç§€ï¼Œè¢«è¯„ä¸ºä¸‰å¥½å­¦ç”Ÿã€‚ç‰¹å‘æ­¤çŠ¶ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æµ‹è¯•è®¿é—®ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CitationTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Citation</span> citation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Citation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Citation</span> clone <span class="token operator">=</span> citation<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clone<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        citation<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clone<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        citation<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><ul><li>å¯¹è±¡çš„åˆ›å»ºéå¸¸å¤æ‚ï¼Œå¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼å¿«æ·çš„åˆ›å»ºå¯¹è±¡ã€‚</li><li>æ€§èƒ½å’Œå®‰å…¨è¦æ±‚æ¯”è¾ƒé«˜ã€‚</li></ul><h3 id="æ‹“å±•-æ·±å…‹éš†">æ‹“å±•(æ·±å…‹éš†)</h3><p>å°†ä¸Šé¢çš„â€œä¸‰å¥½å­¦ç”Ÿâ€å¥–çŠ¶çš„æ¡ˆä¾‹ä¸­ Citation ç±»çš„ name å±æ€§ä¿®æ”¹ä¸º Student ç±»å‹çš„å±æ€§ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¥–çŠ¶ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Citation</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Student</span> stu<span class="token punctuation">;</span><span class="token comment">//çœç•¥ get set..</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Citation</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Citation</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stu<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åŒå­¦ï¼šåœ¨2020å­¦å¹´ç¬¬ä¸€å­¦æœŸä¸­è¡¨ç°ä¼˜ç§€ï¼Œè¢«è¯„ä¸ºä¸‰å¥½å­¦ç”Ÿã€‚ç‰¹å‘æ­¤çŠ¶ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//å­¦ç”Ÿç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token comment">//çœç•¥ get set toString..</span><span class="token punctuation">&#125;</span><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CitationTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Citation</span> citation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Citation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Student</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stu<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        citation<span class="token punctuation">.</span><span class="token function">setStu</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Citation</span> clone <span class="token operator">=</span> citation<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clone<span class="token punctuation">.</span><span class="token function">getStu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        citation<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clone<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../design-pattern-builder/image-20240123203048668.png" alt=""></p><p><font color="red">è¯´æ˜ï¼š</font></p><p>â€‹stu å¯¹è±¡å’Œ clone å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¼šäº§ç”Ÿå°† cloneå¯¹è±¡ä¸­ name å±æ€§å€¼æ”¹ä¸ºâ€œæå››â€ï¼Œä¸¤ä¸ª Citationï¼ˆå¥–çŠ¶ï¼‰å¯¹è±¡ä¸­æ˜¾ç¤ºçš„éƒ½æ˜¯æå››ã€‚è¿™å°±æ˜¯æµ…å…‹éš†çš„æ•ˆæœï¼Œå¯¹å…·ä½“åŸå‹ç±»ï¼ˆCitationï¼‰ä¸­çš„å¼•ç”¨ç±»å‹çš„å±æ€§è¿›è¡Œå¼•ç”¨çš„å¤åˆ¶ã€‚è¿™ç§æƒ…å†µéœ€è¦ä½¿ç”¨æ·±å…‹éš†ï¼Œè€Œè¿›è¡Œæ·±å…‹éš†éœ€è¦ä½¿ç”¨å¯¹è±¡æµã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CitationTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Citation</span> citation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Citation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Student</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stu<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        citation<span class="token punctuation">.</span><span class="token function">setStu</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¾“å‡ºè‡³æ–‡ä»¶</span>        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"./a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>citation<span class="token punctuation">)</span><span class="token punctuation">;</span>        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¯»å–è¾“å…¥æµ</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"./a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¯»å–å¯¹è±¡</span>        <span class="token class-name">Citation</span> citation1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Citation</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ois<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//é‡æ–°èµ‹å€¼</span>        citation1<span class="token punctuation">.</span><span class="token function">getStu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        citation<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        citation1<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„ï¼šCitation ç±»å’Œ Student ç±»å¿…é¡»å®ç° Serializable æ¥å£ï¼Œå¦åˆ™ä¼šæŠ› NotSerializableException å¼‚å¸¸ã€‚</p></blockquote><h2 id="å»ºé€ è€…æ¨¡å¼">å»ºé€ è€…æ¨¡å¼</h2><h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3><p>å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</p><p><img src="./../design-pattern-builder/image-20240123204342968.png" alt=""></p><ul><li>åˆ†ç¦»äº†éƒ¨ä»¶çš„æ„é€ (ç”± Builder æ¥è´Ÿè´£)å’Œè£…é…(ç”± Director è´Ÿè´£)ã€‚ ä»è€Œå¯ä»¥æ„é€ å‡ºå¤æ‚çš„å¯¹è±¡ã€‚è¿™ä¸ªæ¨¡å¼é€‚ç”¨äºï¼šæŸä¸ªå¯¹è±¡çš„æ„å»ºè¿‡ç¨‹å¤æ‚çš„æƒ…å†µã€‚</li><li>ç”±äºå®ç°äº†æ„å»ºå’Œè£…é…çš„è§£è€¦ã€‚ä¸åŒçš„æ„å»ºå™¨ï¼Œç›¸åŒçš„è£…é…ï¼Œä¹Ÿå¯ä»¥åšå‡ºä¸åŒçš„å¯¹è±¡ï¼›ç›¸åŒçš„æ„å»ºå™¨ï¼Œä¸åŒçš„è£…é…é¡ºåºä¹Ÿå¯ä»¥åšå‡ºä¸åŒçš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯å®ç°äº†æ„å»ºç®—æ³•ã€è£…é…ç®—æ³•çš„è§£è€¦ï¼Œå®ç°äº†æ›´å¥½çš„å¤ç”¨ã€‚</li><li>å»ºé€ è€…æ¨¡å¼å¯ä»¥å°†éƒ¨ä»¶å’Œå…¶ç»„è£…è¿‡ç¨‹åˆ†å¼€ï¼Œä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚ç”¨æˆ·åªéœ€è¦æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»å‹å°±å¯ä»¥å¾—åˆ°è¯¥å¯¹è±¡ï¼Œè€Œæ— é¡»çŸ¥é“å…¶å†…éƒ¨çš„å…·ä½“æ„é€ ç»†èŠ‚ã€‚</li></ul><h3 id="ç»“æ„-2">ç»“æ„</h3><p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li><p>æŠ½è±¡å»ºé€ è€…ç±»ï¼ˆBuilderï¼‰ï¼šè¿™ä¸ªæ¥å£è§„å®šè¦å®ç°å¤æ‚å¯¹è±¡çš„é‚£äº›éƒ¨åˆ†çš„åˆ›å»ºï¼Œå¹¶ä¸æ¶‰åŠå…·ä½“çš„éƒ¨ä»¶å¯¹è±¡çš„åˆ›å»ºã€‚</p></li><li><p>å…·ä½“å»ºé€ è€…ç±»ï¼ˆConcreteBuilderï¼‰ï¼šå®ç° Builder æ¥å£ï¼Œå®Œæˆå¤æ‚äº§å“çš„å„ä¸ªéƒ¨ä»¶çš„å…·ä½“åˆ›å»ºæ–¹æ³•ã€‚åœ¨æ„é€ è¿‡ç¨‹å®Œæˆåï¼Œæä¾›äº§å“çš„å®ä¾‹ã€‚</p></li><li><p>äº§å“ç±»ï¼ˆProductï¼‰ï¼šè¦åˆ›å»ºçš„å¤æ‚å¯¹è±¡ã€‚</p></li><li><p>æŒ‡æŒ¥è€…ç±»ï¼ˆDirectorï¼‰ï¼šè°ƒç”¨å…·ä½“å»ºé€ è€…æ¥åˆ›å»ºå¤æ‚å¯¹è±¡çš„å„ä¸ªéƒ¨åˆ†ï¼Œåœ¨æŒ‡å¯¼è€…ä¸­ä¸æ¶‰åŠå…·ä½“äº§å“çš„ä¿¡æ¯ï¼Œåªè´Ÿè´£ä¿è¯å¯¹è±¡å„éƒ¨åˆ†å®Œæ•´åˆ›å»ºæˆ–æŒ‰æŸç§é¡ºåºåˆ›å»ºã€‚</p></li></ul><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Director {- builder : Builder+ construct() Product}class Builder {+ buildPartA() void+ buildPartB() void}class ConcreteBuilder {+ buildPartA() void+ buildPartB() void+ getResult() Product}class ProductBuilder --o Director : ç»„åˆBuilder <|-- ConcreteBuilder : ç»§æ‰¿ConcreteBuilder ..> Product : ä¾èµ–note for Director "æŒ‡æŒ¥è€…, æ˜¯æ„å»ºä¸€ä¸ªä½¿ç”¨Builderæ¥å£çš„å¯¹è±¡"note for Builder "Builderæ˜¯ä¸ºåˆ›å»ºä¸€ä¸ªProductå¯¹äº«çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šçš„æ¥å£"note for Product "å…·ä½“çš„äº§å“"</pre><h3 id="å®ç°-2">å®ç°</h3><p><strong>åˆ›å»ºå…±äº«å•è½¦</strong></p><p>ç”Ÿäº§è‡ªè¡Œè½¦æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œå®ƒåŒ…å«äº†è½¦æ¶ï¼Œè½¦åº§ç­‰ç»„ä»¶çš„ç”Ÿäº§ã€‚è€Œè½¦æ¶åˆæœ‰ç¢³çº¤ç»´ï¼Œé“åˆé‡‘ç­‰æè´¨çš„ï¼Œè½¦åº§æœ‰æ©¡èƒ¶ï¼ŒçœŸçš®ç­‰æè´¨ã€‚å¯¹äºè‡ªè¡Œè½¦çš„ç”Ÿäº§å°±å¯ä»¥ä½¿ç”¨å»ºé€ è€…æ¨¡å¼ã€‚</p><p>è¿™é‡Œ Bike æ˜¯äº§å“ï¼ŒåŒ…å«è½¦æ¶ï¼Œè½¦åº§ç­‰ç»„ä»¶ï¼›Builder æ˜¯æŠ½è±¡å»ºé€ è€…ï¼Œ MobikeBuilder å’Œ OfoBuilder æ˜¯å…·ä½“çš„å»ºé€ è€…ï¼›Director æ˜¯æŒ‡æŒ¥è€…ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Client {+ main() void+ showBike() void}class Bike {- frame : String- seat : String+ setFrame(String seat) void+ getFrame() String+ getSeat() String}class Builder {# mBike : Bike+ buildFrame() void+ buildSeat() void+ createBike() Bike}class Director {- mBuilder : Builder+ Director(Builder builder)+ construct() Bike}class MobikeBuilder {+ buildFrame() voidbuildSeat() voidcreateBike() Bike}class OfoBuilder {+ buildFrame() void+ buildSeat() void+ createBike() Bike}Client ..> BikeClient ..> BuilderClient ..> DirectorBuilder o-- Bike : èšåˆDirector o-- Builder : èšåˆBuilder <|-- MobikeBuilderBuilder <|-- OfoBuilderlink Bike "#è‡ªè¡Œè½¦-Code"link Builder "#æŠ½è±¡æ„å»ºè€…-Code"link MobikeBuilder "#mobileæ„å»ºè€…-Code"link OfoBuilder "#ofoæ„å»ºè€…-Code"link Director "#æŒ‡æŒ¥è€…-Code"link Client "#æ„å»ºè€…æµ‹è¯•ç±»-Code"</pre><h6 id="è‡ªè¡Œè½¦-Code">è‡ªè¡Œè½¦-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bike</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> frame<span class="token punctuation">;</span><span class="token comment">//è½¦æ¶</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> seat<span class="token punctuation">;</span><span class="token comment">//è½¦åº§</span><span class="token comment">//çœç•¥ get set..</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="æŠ½è±¡æ„å»ºè€…-Code">æŠ½è±¡æ„å»ºè€…-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token class-name">Bike</span> bike <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ„å»ºè½¦æ¶</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ„å»ºè½¦åº§</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildSeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ„å»ºè‡ªè¡Œè½¦æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Bike</span> <span class="token function">createBike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="mobileæ„å»ºè€…-Code">mobileæ„å»ºè€…-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MobileBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">Builder</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bike<span class="token punctuation">.</span><span class="token function">setFrame</span><span class="token punctuation">(</span><span class="token string">"ç¢³é’ç»´è½¦æ¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildSeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bike<span class="token punctuation">.</span><span class="token function">setSeat</span><span class="token punctuation">(</span><span class="token string">"çœŸçš®è½¦åº§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Bike</span> <span class="token function">createBike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> bike<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="ofoæ„å»ºè€…-Code">ofoæ„å»ºè€…-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OfoBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">Builder</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bike<span class="token punctuation">.</span><span class="token function">setFrame</span><span class="token punctuation">(</span><span class="token string">"é“åˆé‡‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildSeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        bike<span class="token punctuation">.</span><span class="token function">setSeat</span><span class="token punctuation">(</span><span class="token string">"æ©¡èƒ¶è½¦åº§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Bike</span> <span class="token function">createBike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> bike<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="æŒ‡æŒ¥è€…-Code">æŒ‡æŒ¥è€…-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å£°æ˜builderç±»å‹çš„å˜é‡</span>    <span class="token keyword">private</span> <span class="token class-name">Builder</span> builder<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>builder <span class="token operator">=</span> builder<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ç»„è£…è‡ªè¡Œè½¦çš„åŠŸèƒ½</span>    <span class="token keyword">public</span> <span class="token class-name">Bike</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        builder<span class="token punctuation">.</span><span class="token function">buildFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">buildSeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">createBike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="æ„å»ºè€…æµ‹è¯•ç±»-Code">æ„å»ºè€…æµ‹è¯•ç±»-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºæŒ‡æŒ¥è€…å¯¹è±¡</span>        <span class="token class-name">Director</span> director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MobileBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®©æŒ‡æŒ¥è€…æŒ‡æŒ¥ç»„è£…è‡ªè¡Œè½¦</span>        <span class="token class-name">Bike</span> bike <span class="token operator">=</span> director<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bike<span class="token punctuation">.</span><span class="token function">getFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bike<span class="token punctuation">.</span><span class="token function">getSeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„ï¼š</strong></p><p>â€‹ä¸Šé¢ç¤ºä¾‹æ˜¯ Builder æ¨¡å¼çš„å¸¸è§„ç”¨æ³•ï¼ŒæŒ‡æŒ¥è€…ç±» Director åœ¨å»ºé€ è€…æ¨¡å¼ä¸­å…·æœ‰å¾ˆé‡è¦çš„ä½œç”¨ï¼Œå®ƒç”¨äºæŒ‡å¯¼å…·ä½“æ„å»ºè€…å¦‚ä½•æ„å»ºäº§å“ï¼Œæ§åˆ¶è°ƒç”¨å…ˆåæ¬¡åºï¼Œå¹¶å‘è°ƒç”¨è€…è¿”å›å®Œæ•´çš„äº§å“ç±»ï¼Œä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹éœ€è¦ç®€åŒ–ç³»ç»Ÿç»“æ„ï¼Œå¯ä»¥æŠŠæŒ‡æŒ¥è€…ç±»å’ŒæŠ½è±¡å»ºé€ è€…è¿›è¡Œç»“åˆ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æŠ½è±¡ builder ç±»</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token class-name">Bike</span> mBike <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buildSeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Bike</span> <span class="token function">createBike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">Bike</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>BuildSeat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createBike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¯´æ˜ï¼š</strong></p><p>â€‹è¿™æ ·åšç¡®å®ç®€åŒ–äº†ç³»ç»Ÿç»“æ„ï¼Œä½†åŒæ—¶ä¹ŸåŠ é‡äº†æŠ½è±¡å»ºé€ è€…ç±»çš„èŒè´£ï¼Œä¹Ÿä¸æ˜¯å¤ªç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œå¦‚æœ construct() è¿‡äºå¤æ‚ï¼Œå»ºè®®è¿˜æ˜¯å°è£…åˆ° Director ä¸­ã€‚</p><h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>å»ºé€ è€…æ¨¡å¼çš„å°è£…æ€§å¾ˆå¥½ã€‚ä½¿ç”¨å»ºé€ è€…æ¨¡å¼å¯ä»¥æœ‰æ•ˆçš„å°è£…å˜åŒ–ï¼Œåœ¨ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„åœºæ™¯ä¸­ï¼Œä¸€èˆ¬äº§å“ç±»å’Œå»ºé€ è€…ç±»æ˜¯æ¯”è¾ƒç¨³å®šçš„ï¼Œå› æ­¤ï¼Œå°†ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘å°è£…åœ¨æŒ‡æŒ¥è€…ç±»ä¸­å¯¹æ•´ä½“è€Œè¨€å¯ä»¥å–å¾—æ¯”è¾ƒå¥½çš„ç¨³å®šæ€§ã€‚</li><li>åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå°†äº§å“æœ¬èº«ä¸äº§å“çš„åˆ›å»ºè¿‡ç¨‹è§£è€¦ï¼Œä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡ã€‚</li><li>å¯ä»¥æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æ§åˆ¶åˆ›å»ºè¿‡ç¨‹ã€‚</li><li>å»ºé€ è€…æ¨¡å¼å¾ˆå®¹æ˜“è¿›è¡Œæ‰©å±•ã€‚å¦‚æœæœ‰æ–°çš„éœ€æ±‚ï¼Œé€šè¿‡å®ç°ä¸€ä¸ªæ–°çš„å»ºé€ è€…ç±»å°±å¯ä»¥å®Œæˆï¼ŒåŸºæœ¬ä¸Šä¸ç”¨ä¿®æ”¹ä¹‹å‰å·²ç»æµ‹è¯•é€šè¿‡çš„ä»£ç ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šå¯¹åŸæœ‰åŠŸèƒ½å¼•å…¥é£é™©ã€‚ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>â€‹é€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼Œå¦‚æœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</h3><p>å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼åˆ›å»ºçš„æ˜¯å¤æ‚å¯¹è±¡ï¼Œå…¶äº§å“çš„å„ä¸ªéƒ¨åˆ†ç»å¸¸é¢ä¸´ç€å‰§çƒˆçš„å˜åŒ–ï¼Œä½†å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çš„ç®—æ³•å´ç›¸å¯¹ç¨³å®šï¼Œæ‰€ä»¥å®ƒé€šå¸¸åœ¨ä»¥ä¸‹åœºåˆä½¿ç”¨ã€‚</p><ul><li>åˆ›å»ºçš„å¯¹è±¡è¾ƒå¤æ‚ï¼Œç”±å¤šä¸ªéƒ¨ä»¶æ„æˆï¼Œå„éƒ¨ä»¶é¢ä¸´ç€å¤æ‚çš„å˜åŒ–ï¼Œä½†æ„ä»¶é—´çš„å»ºé€ é¡ºåºæ˜¯ç¨³å®šçš„ã€‚</li><li>åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼ï¼Œå³äº§å“çš„æ„å»ºè¿‡ç¨‹å’Œæœ€ç»ˆçš„è¡¨ç¤ºæ˜¯ç‹¬ç«‹çš„ã€‚</li></ul><h3 id="æ¨¡å¼æ‹“å±•">æ¨¡å¼æ‹“å±•</h3><p>å»ºé€ è€…æ¨¡å¼é™¤äº†ä¸Šé¢çš„ç”¨é€”å¤–ï¼Œåœ¨å¼€å‘ä¸­è¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±æ˜¯å½“ä¸€ä¸ªç±»æ„é€ å™¨éœ€è¦ä¼ å…¥å¾ˆå¤šå‚æ•°æ—¶ï¼Œå¦‚æœåˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œä»£ç å¯è¯»æ€§ä¼šéå¸¸å·®ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¼•å…¥é”™è¯¯ï¼Œæ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨å»ºé€ è€…æ¨¡å¼è¿›è¡Œé‡æ„ã€‚</p><p>é‡æ„å‰ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> cpu<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> screen<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> memory<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> mainboard<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token class-name">String</span> cpu<span class="token punctuation">,</span> <span class="token class-name">String</span> screen<span class="token punctuation">,</span> <span class="token class-name">String</span> memory<span class="token punctuation">,</span> <span class="token class-name">String</span> mainboard<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>cpu <span class="token operator">=</span> cpu<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>screen <span class="token operator">=</span> screen<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>memory <span class="token operator">=</span> memory<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>mainboard <span class="token operator">=</span> mainboard<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">// çœç•¥ get set toString..</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//æ„å»ºPhoneå¯¹è±¡</span>        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token string">"intel"</span><span class="token punctuation">,</span><span class="token string">"ä¸‰æ˜Ÿå±å¹•"</span><span class="token punctuation">,</span><span class="token string">"é‡‘å£«é¡¿"</span><span class="token punctuation">,</span><span class="token string">"åç¡•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æ„å»º Phone å¯¹è±¡ï¼Œä¼ é€’äº†å››ä¸ªå‚æ•°ï¼Œå¦‚æœå‚æ•°æ›´å¤šå‘¢ï¼Ÿä»£ç çš„å¯è¯»æ€§åŠä½¿ç”¨çš„æˆæœ¬å°±æ˜¯æ¯”è¾ƒé«˜ã€‚</p><p><strong>ä½¿ç”¨æ„å»ºè€…æ¨¡å¼é‡æ„</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> cpu<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> screen<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> memory<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> mainboard<span class="token punctuation">;</span>    <span class="token comment">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>cpu <span class="token operator">=</span> builder<span class="token punctuation">.</span>cpu<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>screen <span class="token operator">=</span> builder<span class="token punctuation">.</span>screen<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>memory <span class="token operator">=</span> builder<span class="token punctuation">.</span>memory<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>mainboard <span class="token operator">=</span> builder<span class="token punctuation">.</span>mainboard<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å†…éƒ¨æ„å»ºè€…</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> cpu<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> screen<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> memory<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> mainboard<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">cpu</span><span class="token punctuation">(</span><span class="token class-name">String</span> cpu<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>cpu <span class="token operator">=</span> cpu<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">screen</span><span class="token punctuation">(</span><span class="token class-name">String</span> screen<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>screen <span class="token operator">=</span> screen<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">memory</span><span class="token punctuation">(</span><span class="token class-name">String</span> memory<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>memory <span class="token operator">=</span> memory<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">mainboard</span><span class="token punctuation">(</span><span class="token class-name">String</span> mainboard<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>mainboard <span class="token operator">=</span> mainboard<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//ä½¿ç”¨æ„å»ºè€…æ¥æ„å»ºå¯¹è±¡</span>        <span class="token keyword">public</span> <span class="token class-name">Phone</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//çœç•¥ toString</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">cpu</span><span class="token punctuation">(</span><span class="token string">"intel"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">screen</span><span class="token punctuation">(</span><span class="token string">"ä¸‰æ˜Ÿ"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">memory</span><span class="token punctuation">(</span><span class="token string">"é‡‘å£«é¡¿"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">mainboard</span><span class="token punctuation">(</span><span class="token string">"åç¡•ä¸»æ¿"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡æ„åçš„ä»£ç åœ¨ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼ŒæŸç§ç¨‹åº¦ä¸Šä¹Ÿå¯ä»¥æé«˜å¼€å‘æ•ˆç‡ã€‚ä»è½¯ä»¶è®¾è®¡ä¸Šï¼Œå¯¹ç¨‹åºå‘˜çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚</p><h2 id="å»ºé€ è€…æ¨¡å¼å¯¹æ¯”">å»ºé€ è€…æ¨¡å¼å¯¹æ¯”</h2><h3 id="å·¥å‚æ–¹æ³•-VS-å»ºé€ è€…">å·¥å‚æ–¹æ³• VS å»ºé€ è€…</h3><p>å·¥å‚æ–¹æ³•æ¨¡å¼æ³¨é‡çš„æ˜¯æ•´ä½“å¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼›è€Œå»ºé€ è€…æ¨¡å¼æ³¨é‡çš„æ˜¯éƒ¨ä»¶æ„å»ºçš„è¿‡ç¨‹ï¼Œæ„åœ¨é€šè¿‡ä¸€æ­¥ä¸€æ­¥åœ°ç²¾ç¡®æ„é€ åˆ›å»ºå‡ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­æ¥è¯´æ˜ä¸¤è€…çš„å·®å¼‚ï¼Œå¦‚è¦åˆ¶é€ ä¸€ä¸ªè¶…äººï¼Œå¦‚æœä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œç›´æ¥äº§ç”Ÿå‡ºæ¥çš„å°±æ˜¯ä¸€ä¸ªåŠ›å¤§æ— ç©·ã€èƒ½å¤Ÿé£ç¿”ã€å†…è£¤å¤–ç©¿çš„è¶…äººï¼›è€Œå¦‚æœä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œåˆ™éœ€è¦ç»„è£…æ‰‹ã€å¤´ã€è„šã€èº¯å¹²ç­‰éƒ¨åˆ†ï¼Œç„¶åå†æŠŠå†…è£¤å¤–ç©¿ï¼Œäºæ˜¯ä¸€ä¸ªè¶…äººå°±è¯ç”Ÿäº†ã€‚</p><h3 id="æŠ½è±¡å·¥å‚-VS-å»ºé€ è€…">æŠ½è±¡å·¥å‚ VS å»ºé€ è€…</h3><p>æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°å¯¹äº§å“å®¶æ—çš„åˆ›å»ºï¼Œä¸€ä¸ªäº§å“å®¶æ—æ˜¯è¿™æ ·çš„ä¸€ç³»åˆ—äº§å“ï¼šå…·æœ‰ä¸åŒåˆ†ç±»ç»´åº¦çš„äº§å“ç»„åˆï¼Œé‡‡ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼åˆ™æ˜¯ä¸éœ€è¦å…³å¿ƒæ„å»ºè¿‡ç¨‹ï¼Œåªå…³å¿ƒä»€ä¹ˆäº§å“ç”±ä»€ä¹ˆå·¥å‚ç”Ÿäº§å³å¯ã€‚</p><p>å»ºé€ è€…æ¨¡å¼åˆ™æ˜¯è¦æ±‚æŒ‰ç…§æŒ‡å®šçš„è“å›¾å»ºé€ äº§å“ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç»„è£…é›¶é…ä»¶è€Œäº§ç”Ÿä¸€ä¸ªæ–°äº§å“ã€‚</p><p>å¦‚æœå°†æŠ½è±¡å·¥å‚æ¨¡å¼çœ‹æˆæ±½è½¦é…ä»¶ç”Ÿäº§å·¥å‚ï¼Œç”Ÿäº§ä¸€ä¸ªäº§å“æ—çš„äº§å“ï¼Œé‚£ä¹ˆå»ºé€ è€…æ¨¡å¼å°±æ˜¯ä¸€ä¸ªæ±½è½¦ç»„è£…å·¥å‚ï¼Œé€šè¿‡å¯¹éƒ¨ä»¶çš„ç»„è£…å¯ä»¥è¿”å›ä¸€è¾†å®Œæ•´çš„æ±½è½¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mermaid-æ—¶åºå›¾</title>
      <link href="/2024/01/22/mermaid-sequence/"/>
      <url>/2024/01/22/mermaid-sequence/</url>
      
        <content type="html"><![CDATA[<h1>Mermaid-æ—¶åºå›¾</h1><p>åºåˆ—å›¾æ˜¯ä¸€ç§äº¤äº’å›¾ï¼Œæ˜¾ç¤ºè¿›ç¨‹å¦‚ä½•å½¼æ­¤è¿è¡Œä»¥åŠä»¥ä»€ä¹ˆé¡ºåºè¿è¡Œã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    John-->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Great!    Alice-<span class="token punctuation">)</span><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> See you later!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->>John: Hello John, how are you?    John-->>Alice: Great!    Alice-)John: See you later!</pre><h2 id="è¯­æ³•">è¯­æ³•</h2><h3 id="å‚åŠ è€…">å‚åŠ è€…</h3><p>å¯ä»¥åƒæœ¬é¡µç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­é‚£æ ·éšå¼å®šä¹‰å‚ä¸è€…ã€‚ å‚ä¸è€…æˆ–å‚ä¸è€…æŒ‰ç…§å›¾è¡¨æºæ–‡æœ¬ä¸­çš„å‡ºç°é¡ºåºæ¸²æŸ“ã€‚ æœ‰æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›ä»¥ä¸åŒäºç¬¬ä¸€æ¡æ¶ˆæ¯ä¸­çš„é¡ºåºæ˜¾ç¤ºå‚ä¸è€…ã€‚ å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥æŒ‡å®šè§’è‰²çš„å‡ºåœºé¡ºåºï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    participant Alice    participant Bob    Alice->><span class="token function"><span class="token prefix">Bob<span class="token punctuation">:</span></span></span> Hi Bob    Bob->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Hi Alice<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    participant Alice    participant Bob    Alice->>Bob: Hi Bob    Bob->>Alice: Hi Alice</pre><h3 id="è§’è‰²">è§’è‰²</h3><p>å¦‚æœä½ ç‰¹åˆ«æƒ³ä½¿ç”¨è§’è‰²ç¬¦å·è€Œä¸æ˜¯å¸¦æœ‰æ–‡æœ¬çš„çŸ©å½¢ï¼Œåˆ™å¯ä»¥é€šè¿‡ä½¿ç”¨è§’è‰²è¯­å¥æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    actor Alice    actor Bob    Alice->><span class="token function"><span class="token prefix">Bob<span class="token punctuation">:</span></span></span> Hi Bob    Bob->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Hi Alice<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    actor Alice    actor Bob    Alice->>Bob: Hi Bob    Bob->>Alice: Hi Alice</pre><h3 id="åˆ«å">åˆ«å</h3><p>è§’è‰²å¯ä»¥æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„æ ‡è¯†ç¬¦å’Œæè¿°æ€§æ ‡ç­¾ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    participant A as Alice    participant J as John    A->><span class="token function"><span class="token prefix">J<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    J->><span class="token function"><span class="token prefix">A<span class="token punctuation">:</span></span></span> Great!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    participant A as Alice    participant J as John    A->>J: Hello John, how are you?    J->>A: Great!</pre><h3 id="Actor-åˆ›å»ºå’Œé”€æ¯-v10-3-0">Actor åˆ›å»ºå’Œé”€æ¯ (v10.3.0+)</h3><p>å¯ä»¥é€šè¿‡æ¶ˆæ¯åˆ›å»ºå’Œé”€æ¯å‚ä¸è€…ã€‚ ä¸ºæ­¤ï¼Œè¯·åœ¨æ¶ˆæ¯ä¹‹å‰æ·»åŠ åˆ›å»ºæˆ–é”€æ¯æŒ‡ä»¤ã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">create participant BA --> <span class="token function"><span class="token prefix">B<span class="token punctuation">:</span></span></span> Hello<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ›å»ºæŒ‡ä»¤æ”¯æŒå‚ä¸è€…/å‚ä¸è€…åŒºåˆ†å’Œåˆ«åã€‚ æ¶ˆæ¯çš„å‘é€è€…æˆ–æ¥æ”¶è€…å¯ä»¥è¢«é”€æ¯ï¼Œä½†åªèƒ½åˆ›å»ºæ¥æ”¶è€…ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice->><span class="token function"><span class="token prefix">Bob<span class="token punctuation">:</span></span></span> Hello Bob<span class="token punctuation">,</span> how are you ?    Bob->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Fine<span class="token punctuation">,</span> thank you<span class="token punctuation">.</span> And you?    create participant Carl    Alice->><span class="token function"><span class="token prefix">Carl<span class="token punctuation">:</span></span></span> Hi Carl!    create actor D as Donald    Carl->><span class="token function"><span class="token prefix">D<span class="token punctuation">:</span></span></span> Hi!    destroy Carl    <span class="token function"><span class="token prefix">Alice-xCarl<span class="token punctuation">:</span></span></span> We are too many    destroy Bob    Bob->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> I agree<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->>Bob: Hello Bob, how are you ?    Bob->>Alice: Fine, thank you. And you?    create participant Carl    Alice->>Carl: Hi Carl!    create actor D as Donald    Carl->>D: Hi!    destroy Carl    Alice-xCarl: We are too many    destroy Bob    Bob->>Alice: I agree</pre><h3 id="åˆ†ç»„-æ¡†">åˆ†ç»„/æ¡†</h3><p>è§’è‰²å¯ä»¥åˆ†ç»„åœ¨å‚ç›´æ¡†ä¸­ã€‚ ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¬¦å·å®šä¹‰é¢œè‰²ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå®ƒå°†æ˜¯é€æ˜çš„ï¼‰å’Œ/æˆ–æè¿°æ€§æ ‡ç­¾ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">box Aqua Group Description<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> actors <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>endbox Group without description<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> actors <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>endbox rgb<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> actors <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span class="token comment">#ç»§æ‰¿</span>box transparent Aqua<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> actors <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    box Purple Alice &amp; John    participant A    participant J    end    box Another Group    participant B    participant C    end    A->><span class="token function"><span class="token prefix">J<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    J->><span class="token function"><span class="token prefix">A<span class="token punctuation">:</span></span></span> Great!    A->><span class="token function"><span class="token prefix">B<span class="token punctuation">:</span></span></span> Hello Bob<span class="token punctuation">,</span> how is Charly?    B->><span class="token function"><span class="token prefix">C<span class="token punctuation">:</span></span></span> Hello Charly<span class="token punctuation">,</span> how are you?    box rgb<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span>    participant D    participant E    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    box Purple Alice & John    participant A    participant J    end    box Another Group    participant B    participant C    end    A->>J: Hello John, how are you?    J->>A: Great!    A->>B: Hello Bob, how is Charly?    B->>C: Hello Charly, how are you?    box rgb(33,66,99)    participant D    participant E    end</pre><h2 id="ä¿¡æ¯">ä¿¡æ¯</h2><p>æ¶ˆæ¯å¯ä»¥æœ‰ä¸¤æ¡æ˜¾ç¤ºï¼Œå¯ä»¥æ˜¯å®çº¿ï¼Œä¹Ÿå¯ä»¥æ˜¯è™šçº¿ã€‚</p><pre class="line-numbers language-none"><code class="language-none">[Actor][Arrow][Actor]:Message text<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›®å‰æ”¯æŒå…­ç§ç±»å‹çš„ç®­å¤´ï¼š</p><table><thead><tr><th style="text-align:left">ç±»å‹</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>-&gt;</code></td><td style="text-align:left">æ²¡æœ‰ç®­å¤´çš„å®çº¿</td></tr><tr><td style="text-align:left"><code>--&gt;</code></td><td style="text-align:left">æ²¡æœ‰ç®­å¤´çš„è™šçº¿</td></tr><tr><td style="text-align:left"><code>-&gt;&gt;</code></td><td style="text-align:left">å¸¦ç®­å¤´çš„å®çº¿</td></tr><tr><td style="text-align:left"><code>--&gt;&gt;</code></td><td style="text-align:left">å¸¦ç®­å¤´çš„è™šçº¿</td></tr><tr><td style="text-align:left"><code>-x</code></td><td style="text-align:left">æœ«ç«¯æœ‰åå­—çš„å®çº¿</td></tr><tr><td style="text-align:left"><code>--x</code></td><td style="text-align:left">æœ«ç«¯å¸¦æœ‰åå­—çš„è™šçº¿ã€‚</td></tr><tr><td style="text-align:left"><code>-)</code></td><td style="text-align:left">æœ«å°¾å¸¦æœ‰ç©ºå¿ƒç®­å¤´çš„å®çº¿ï¼ˆå¼‚æ­¥ï¼‰</td></tr><tr><td style="text-align:left"><code>--)</code></td><td style="text-align:left">æœ«å°¾å¸¦æœ‰ç©ºå¿ƒç®­å¤´çš„è™šçº¿ï¼ˆå¼‚æ­¥ï¼‰</td></tr></tbody></table><h2 id="æ¿€æ´»">æ¿€æ´»</h2><p>å¯ä»¥æ¿€æ´»å’Œåœç”¨è§’è‰²ã€‚ (de)activation å¯ä»¥æ˜¯ä¸“ç”¨å£°æ˜ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    activate John    John-->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Great!    deactivate John<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->>John: Hello John, how are you?    activate John    John-->>Alice: Great!    deactivate John</pre><p>è¿˜æœ‰ä¸€ç§å¿«æ·è¡¨ç¤ºæ³•ï¼Œå³åœ¨æ¶ˆæ¯ç®­å¤´åé™„åŠ  <code>+</code>/<code>-</code> åç¼€ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice->>+<span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    John-->>-<span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Great!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->>+John: Hello John, how are you?    John-->>-Alice: Great!</pre><p>åŒä¸€è§’è‰²çš„æ¿€æ´»å¯ä»¥å åŠ ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice->>+<span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    Alice->>+<span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> John<span class="token punctuation">,</span> can you hear me?    John-->>-<span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Hi Alice<span class="token punctuation">,</span> I can hear you!    John-->>-<span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> I feel great!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->>+John: Hello John, how are you?    Alice->>+John: John, can you hear me?    John-->>-Alice: Hi Alice, I can hear you!    John-->>-Alice: I feel great!</pre><h2 id="æ³¨æ„">æ³¨æ„</h2><p>å¯ä»¥å‘åºåˆ—å›¾æ·»åŠ æ³¨é‡Šã€‚ è¿™æ˜¯é€šè¿‡æ³¨é‡Š[å³è¾¹çš„ | çš„å·¦è¾¹ | over ] [Actor]: æ³¨æ„å†…å®¹ä¸­çš„æ–‡æœ¬</p><p>è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    participant John    Note right of <span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Text in note<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    participant John    Note right of John: Text in note</pre><p>è¿˜å¯ä»¥åˆ›å»ºè·¨è¶Šä¸¤ä¸ªå‚ä¸è€…çš„æ³¨æ„ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice-><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    Note over Alice<span class="token punctuation">,</span><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> A typical interaction<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->John: Hello John, how are you?    Note over Alice,John: A typical interaction</pre><p>è¿˜å¯ä»¥æ·»åŠ æ¢è¡Œç¬¦ï¼ˆä¸€èˆ¬é€‚ç”¨äºæ–‡æœ¬è¾“å…¥ï¼‰ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice-><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    Note over Alice<span class="token punctuation">,</span><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> A typical interaction<span class="token url"><span class="token punctuation">&lt;</span>br/<span class="token punctuation">></span></span>But now in two lines<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->John: Hello John, how are you?    Note over Alice,John: A typical interaction<br/>But now in two lines</pre><h2 id="å¾ªç¯">å¾ªç¯</h2><p>å¯ä»¥åœ¨åºåˆ—å›¾ä¸­è¡¨è¾¾å¾ªç¯ã€‚ è¿™æ˜¯é€šè¿‡ç¬¦å·å®Œæˆçš„</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">loop Loop text<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice-><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    loop Every minute        John--><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Great!    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->John: Hello John, how are you?    loop Every minute        John-->Alice: Great!    end</pre><h2 id="æ›¿ä»£">æ›¿ä»£</h2><p>å¯ä»¥åœ¨åºåˆ—å›¾ä¸­è¡¨è¾¾æ›¿ä»£è·¯å¾„ã€‚ è¿™æ˜¯é€šè¿‡ç¬¦å·å®Œæˆçš„</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">alt Describing text<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>else<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–è€…å¦‚æœæœ‰å¯é€‰çš„åºåˆ—ï¼ˆå¦‚æœæ²¡æœ‰å…¶ä»–ï¼‰ã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">opt Describing text<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice->><span class="token function"><span class="token prefix">Bob<span class="token punctuation">:</span></span></span> Hello Bob<span class="token punctuation">,</span> how are you?    alt is sick        Bob->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Not so good <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span><span class="token punctuation">(</span>    else is well        Bob->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Feeling fresh like <span class="token keyword">a</span> daisy    end    opt Extra response        Bob->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Thanks for asking    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->>Bob: Hello Bob, how are you?    alt is sick        Bob->>Alice: Not so good :(    else is well        Bob->>Alice: Feeling fresh like a daisy    end    opt Extra response        Bob->>Alice: Thanks for asking    end</pre><h2 id="å¹³è¡Œçº¿">å¹³è¡Œçº¿</h2><p>å¯ä»¥æ˜¾ç¤ºå¹¶è¡Œå‘ç”Ÿçš„åŠ¨ä½œã€‚</p><p>è¿™æ˜¯é€šè¿‡ç¬¦å·å®Œæˆçš„</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">par <span class="token punctuation">[</span>Action <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>and <span class="token punctuation">[</span>Action <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>and <span class="token punctuation">[</span>Action N<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    par Alice to Bob        Alice->><span class="token function"><span class="token prefix">Bob<span class="token punctuation">:</span></span></span> Hello guys!    and Alice to John        Alice->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello guys!    end    Bob-->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Hi Alice!    John-->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Hi Alice!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    par Alice to Bob        Alice->>Bob: Hello guys!    and Alice to John        Alice->>John: Hello guys!    end    Bob-->>Alice: Hi Alice!    John-->>Alice: Hi Alice!</pre><p>ä¹Ÿå¯ä»¥åµŒå¥—å¹¶è¡Œå—ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    par Alice to Bob        Alice->><span class="token function"><span class="token prefix">Bob<span class="token punctuation">:</span></span></span> Go help John    and Alice to John        Alice->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> I want this done today        par John to Charlie            John->><span class="token function"><span class="token prefix">Charlie<span class="token punctuation">:</span></span></span> Can we do this today?        and John to Diana            John->><span class="token function"><span class="token prefix">Diana<span class="token punctuation">:</span></span></span> Can you help us today?        end    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    par Alice to Bob        Alice->>Bob: Go help John    and Alice to John        Alice->>John: I want this done today        par John to Charlie            John->>Charlie: Can we do this today?        and John to Diana            John->>Diana: Can you help us today?        end    end</pre><h2 id="ä¸´ç•ŒåŒº">ä¸´ç•ŒåŒº</h2><p>å¯ä»¥é€šè¿‡å¯¹æƒ…å†µè¿›è¡Œæ¡ä»¶å¤„ç†æ¥æ˜¾ç¤ºå¿…é¡»è‡ªåŠ¨å‘ç”Ÿçš„æ“ä½œã€‚</p><p>è¿™æ˜¯é€šè¿‡ç¬¦å·å®Œæˆçš„</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">critical <span class="token punctuation">[</span>Action that must be performed<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>option <span class="token punctuation">[</span>Circumstance A<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>option <span class="token punctuation">[</span>Circumstance B<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    critical Establish <span class="token keyword">a</span> connection to the DB        Service--><span class="token function"><span class="token prefix">DB<span class="token punctuation">:</span></span></span> connect    option Network timeout        Service--><span class="token function"><span class="token prefix">Service<span class="token punctuation">:</span></span></span> Log error    option Credentials rejected        Service--><span class="token function"><span class="token prefix">Service<span class="token punctuation">:</span></span></span> Log different error    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    critical Establish a connection to the DB        Service-->DB: connect    option Network timeout        Service-->Service: Log error    option Credentials rejected        Service-->Service: Log different error    end</pre><p>ä¹Ÿæœ‰å¯èƒ½æ ¹æœ¬æ²¡æœ‰é€‰é¡¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    critical Establish <span class="token keyword">a</span> connection to the DB        Service--><span class="token function"><span class="token prefix">DB<span class="token punctuation">:</span></span></span> connect    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    critical Establish a connection to the DB        Service-->DB: connect    end</pre><p>è¿™ä¸ªå…³é”®å—ä¹Ÿå¯ä»¥åµŒå¥—ï¼Œç›¸å½“äºä¸Šé¢çœ‹åˆ°çš„ <code>par</code> è¯­å¥ã€‚</p><h2 id="ä¸­æ–­">ä¸­æ–­</h2><p>å¯ä»¥æŒ‡ç¤ºæµå†…åºåˆ—çš„åœæ­¢ï¼ˆé€šå¸¸ç”¨äºå¯¹å¼‚å¸¸è¿›è¡Œå»ºæ¨¡ï¼‰ã€‚</p><p>è¿™æ˜¯é€šè¿‡ç¬¦å·å®Œæˆçš„</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">break <span class="token punctuation">[</span>something happened<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> statements <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Consumer--><span class="token function"><span class="token prefix">API<span class="token punctuation">:</span></span></span> Book something    API--><span class="token function"><span class="token prefix">BookingService<span class="token punctuation">:</span></span></span> Start booking process    break when the booking process fails        API--><span class="token function"><span class="token prefix">Consumer<span class="token punctuation">:</span></span></span> show failure    end    API--><span class="token function"><span class="token prefix">BillingService<span class="token punctuation">:</span></span></span> Start billing process<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Consumer-->API: Book something    API-->BookingService: Start booking process    break when the booking process fails        API-->Consumer: show failure    end    API-->BillingService: Start billing process</pre><h2 id="èƒŒæ™¯é«˜äº®">èƒŒæ™¯é«˜äº®</h2><p>å¯ä»¥é€šè¿‡æä¾›å½©è‰²èƒŒæ™¯çŸ©å½¢æ¥é«˜äº®æµã€‚ è¿™æ˜¯é€šè¿‡ç¬¦å·å®Œæˆçš„</p><p>é¢œè‰²æ˜¯ä½¿ç”¨ rgb å’Œ rgba è¯­æ³•å®šä¹‰çš„ã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">rect rgb<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> content <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>endrect rgba<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> content <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    participant Alice    participant John    rect rgb<span class="token punctuation">(</span><span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>    note right of <span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Alice calls John<span class="token punctuation">.</span>    Alice->>+<span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    rect rgb<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>    Alice->>+<span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> John<span class="token punctuation">,</span> can you hear me?    John-->>-<span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Hi Alice<span class="token punctuation">,</span> I can hear you!    end    John-->>-<span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> I feel great!    end    Alice ->>+ <span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Did you want to go to the game tonight?    John -->>- <span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Yeah! See you there<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    participant Alice    participant John    rect rgb(191, 223, 255)    note right of Alice: Alice calls John.    Alice->>+John: Hello John, how are you?    rect rgb(200, 150, 255)    Alice->>+John: John, can you hear me?    John-->>-Alice: Hi Alice, I can hear you!    end    John-->>-Alice: I feel great!    end    Alice ->>+ John: Did you want to go to the game tonight?    John -->>- Alice: Yeah! See you there.</pre><h2 id="æ³¨é‡Š">æ³¨é‡Š</h2><p>å¯ä»¥åœ¨åºåˆ—å›¾ä¸­è¾“å…¥æ³¨é‡Šï¼Œè§£æå™¨å°†å¿½ç•¥è¿™äº›æ³¨é‡Šã€‚ æ³¨é‡Šéœ€è¦ç‹¬å ä¸€è¡Œï¼Œå¹¶ä¸”å¿…é¡»ä»¥ <code>%%</code>ï¼ˆåŒç™¾åˆ†å·ï¼‰å¼€å¤´ã€‚ æ³¨é‡Šå¼€å§‹ååˆ°ä¸‹ä¸€ä¸ªæ¢è¡Œç¬¦çš„ä»»ä½•æ–‡æœ¬éƒ½å°†è¢«è§†ä¸ºæ³¨é‡Šï¼ŒåŒ…æ‹¬ä»»ä½•å›¾è¡¨è¯­æ³•</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    Alice->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    %% this is <span class="token keyword">a</span> comment    John-->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Great!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    Alice->>John: Hello John, how are you?    %% this is a comment    John-->>Alice: Great!</pre><h2 id="ç”¨äºè½¬ä¹‰å­—ç¬¦çš„å®ä½“ä»£ç ">ç”¨äºè½¬ä¹‰å­—ç¬¦çš„å®ä½“ä»£ç </h2><p>å¯ä»¥ä½¿ç”¨æ­¤å¤„ç¤ºä¾‹çš„è¯­æ³•å¯¹å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    A->><span class="token function"><span class="token prefix">B<span class="token punctuation">:</span></span></span> I <span class="token comment">#9829; you!</span>    B->><span class="token function"><span class="token prefix">A<span class="token punctuation">:</span></span></span> I <span class="token comment">#9829; you #infin; times more!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    A->>B: I #9829; you!    B->>A: I #9829; you #infin; times more!</pre><p>ç»™å‡ºçš„æ•°å­—ä»¥ 10 ä¸ºåŸºæ•°ï¼Œå› æ­¤ <code>#</code> å¯ä»¥ç¼–ç ä¸º <code>#35;</code>ã€‚ è¿˜æ”¯æŒä½¿ç”¨ HTML å­—ç¬¦åç§°ã€‚</p><p>ç”±äºå¯ä»¥ä½¿ç”¨åˆ†å·ä»£æ›¿æ¢è¡Œç¬¦æ¥å®šä¹‰æ ‡è®°ï¼Œå› æ­¤ä½ éœ€è¦ä½¿ç”¨ <code>#59;</code> åœ¨æ¶ˆæ¯æ–‡æœ¬ä¸­åŒ…å«åˆ†å·ã€‚</p><h2 id="sequenceNumbers">sequenceNumbers</h2><p>å¯ä»¥åœ¨åºåˆ—å›¾ä¸­çš„æ¯ä¸ªç®­å¤´ä¸Šé™„åŠ ä¸€ä¸ªåºåˆ—å·ã€‚ å¯ä»¥é€šè¿‡å›¾è¡¨ä»£ç æ‰“å¼€å®ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">sequenceDiagram    autonumber    Alice->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Hello John<span class="token punctuation">,</span> how are you?    loop Healthcheck        John->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Fight against hypochondria    end    Note right of <span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Rational thoughts!    John-->><span class="token function"><span class="token prefix">Alice<span class="token punctuation">:</span></span></span> Great!    John->><span class="token function"><span class="token prefix">Bob<span class="token punctuation">:</span></span></span> How about you?    Bob-->><span class="token function"><span class="token prefix">John<span class="token punctuation">:</span></span></span> Jolly good!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">sequenceDiagram    autonumber    Alice->>John: Hello John, how are you?    loop Healthcheck        John->>John: Fight against hypochondria    end    Note right of John: Rational thoughts!    John-->>Alice: Great!    John->>Bob: How about you?    Bob-->>John: Jolly good!</pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mermaid </tag>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-03-åˆ›å»ºå‹æ¨¡å¼-å·¥å‚æ¨¡å¼</title>
      <link href="/2024/01/22/design-pattern-factory/"/>
      <url>/2024/01/22/design-pattern-factory/</url>
      
        <content type="html"><![CDATA[<h1>åˆ›å»ºå‹æ¨¡å¼ â…¡</h1><h2 id="1-æ¦‚è¿°">1-æ¦‚è¿°</h2><p>éœ€æ±‚ï¼šè®¾è®¡ä¸€ä¸ªå’–å•¡åº—ç‚¹é¤ç³»ç»Ÿã€‚</p><p>è®¾è®¡ä¸€ä¸ªå’–å•¡ç±»ï¼ˆCoffeeï¼‰ï¼Œå¹¶å®šä¹‰å…¶ä¸¤ä¸ªå­ç±»ï¼ˆç¾å¼å’–å•¡ã€AmericanCoffeeã€‘å’Œæ‹¿é“å’–å•¡ã€LatteCoffeeã€‘ï¼‰ï¼›å†è®¾è®¡ä¸€ä¸ªå’–å•¡åº—ç±»ï¼ˆCoffeeStoreï¼‰ï¼Œå’–å•¡åº—å…·æœ‰ç‚¹å’–å•¡çš„åŠŸèƒ½ã€‚</p><p>å…·ä½“ç±»çš„è®¾è®¡å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass CoffeeStore {    + orderCoffee(String type) Coffee}class Coffee {    + getName() String    + addMilk() void    + addSugar() void}class AmericanCoffee {    + getName() String}class LatteCoffee {+ getName() String}link CoffeeStore "#Code-orderCoffee" "ä»£ç é“¾æ¥"note for CoffeeStore "ç‚¹å‡»ã€CoffeeStoreã€‘"Coffee <|-- AmericanCoffeeCoffee <|-- LatteCoffeeCoffee <.. CoffeeStore</pre><h6 id="Code-orderCoffee">Code-orderCoffee</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">orderCoffee</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"american"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmericanoCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"lattle"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatteCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ·»åŠ é…æ–™</span>    coffee<span class="token punctuation">.</span><span class="token function">addMilk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    coffee<span class="token punctuation">.</span><span class="token function">addsugar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> coffee<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ Java ä¸­ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡éƒ½éœ€è¦åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„æ—¶å€™ç›´æ¥ new è¯¥å¯¹è±¡ï¼Œå°±ä¼šå¯¹è¯¥å¯¹è±¡è€¦åˆä¸¥é‡ï¼Œå‡å¦‚æˆ‘ä»¬è¦æ›´æ¢å¯¹è±¡ï¼Œæ‰€æœ‰ new å¯¹è±¡çš„åœ°æ–¹éƒ½éœ€è¦ä¿®æ”¹ä¸€éï¼Œè¿™æ˜¾ç„¶è¿èƒŒäº†è½¯ä»¶è®¾è®¡çš„å¼€é—­åŸåˆ™ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨å·¥å‚æ¥ç”Ÿäº§å¯¹è±¡ï¼Œæˆ‘ä»¬å°±åªå’Œå·¥å‚æ‰“äº¤é“å°±å¯ä»¥äº†ï¼Œå½»åº•å’Œå¯¹è±¡è§£è€¦ï¼Œå¦‚æœè¦æ›´æ¢å¯¹è±¡ï¼Œç›´æ¥åœ¨å·¥å‚é‡Œæ›´æ¢è¯¥å¯¹è±¡å³å¯ï¼Œè¾¾åˆ°äº†ä¸å¯¹è±¡è§£è€¦çš„ç›®çš„ï¼›æ‰€ä»¥è¯´ï¼Œå·¥å‚æ¨¡å¼æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ï¼š<strong>è§£è€¦</strong>ã€‚</p><p>åœ¨æœ¬æ•™ç¨‹ä¸­ä¼šä»‹ç»ä¸‰ç§å·¥å‚çš„ä½¿ç”¨</p><ul><li>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆä¸å±äº GOF çš„ 23 ç§ç»å…¸è®¾è®¡æ¨¡å¼ï¼‰</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼</li><li>æŠ½è±¡å·¥å‚æ¨¡å¼</li></ul><h2 id="2-ç®€å•å·¥å‚æ¨¡å¼">2-ç®€å•å·¥å‚æ¨¡å¼</h2><p>ç®€å•å·¥å‚ä¸æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œåè€Œæ¯”è¾ƒåƒæ˜¯ä¸€ç§ç¼–ç¨‹ä¹ æƒ¯ã€‚</p><h3 id="2-1-ç»“æ„">2.1 ç»“æ„</h3><p>ç®€å•å·¥å‚åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡äº§å“ ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li><li>å…·ä½“äº§å“ ï¼šå®ç°æˆ–è€…ç»§æ‰¿æŠ½è±¡äº§å“çš„å­ç±»</li><li>å…·ä½“å·¥å‚ ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ–¹æ³•ï¼Œè°ƒç”¨è€…é€šè¿‡è¯¥æ–¹æ³•æ¥è·å–äº§å“ã€‚</li></ul><h3 id="2-2-å®ç°">2.2 å®ç°</h3><p>ç°åœ¨ä½¿ç”¨ç®€å•å·¥å‚å¯¹ä¸Šé¢æ¡ˆä¾‹è¿›è¡Œæ”¹è¿›ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass CoffeeStore {+ orderCoffee(String type) Coffee}class SimpleCoffeeFactory {+ createCoffee(String type) Coffee}class Coffee {+ getName() String+ addMilk() void+ addSugar() void}class AmericanCoffee {+ getName() String}class LatteCoffee {+ getName() String}Coffee <.. SimpleCoffeeFactory : ä¾èµ–Coffee <|-- AmericanCoffee : ç»§æ‰¿Coffee <|-- LatteCoffee : ç»§æ‰¿CoffeeStore ..> SimpleCoffeeFactory : ä¾èµ–link SimpleCoffeeFactory "#SimpleCoffeeFactory-Code" "ä»£ç é“¾æ¥"</pre><h6 id="SimpleCoffeeFactory-Code">SimpleCoffeeFactory-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleCoffeeFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"americano"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmericanoCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"latte"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatteCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> coffee<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å·¥å‚ï¼ˆfactoryï¼‰å¤„ç†åˆ›å»ºå¯¹è±¡çš„ç»†èŠ‚ï¼Œä¸€æ—¦æœ‰äº†SimpleCoffeeFactoryï¼ŒCoffeeStore ç±»ä¸­çš„ orderCoffee() å°±å˜æˆæ­¤å¯¹è±¡çš„å®¢æˆ·ï¼ŒåæœŸå¦‚æœéœ€è¦ Coffee å¯¹è±¡ç›´æ¥ä»å·¥å‚ä¸­è·å–å³å¯ã€‚è¿™æ ·ä¹Ÿå°±è§£é™¤äº†å’Œ Coffee å®ç°ç±»çš„è€¦åˆï¼ŒåŒæ—¶åˆäº§ç”Ÿäº†æ–°çš„è€¦åˆï¼ŒCoffeeStore å¯¹è±¡å’Œ SimpleCoffeeFactory å·¥å‚å¯¹è±¡çš„è€¦åˆï¼Œå·¥å‚å¯¹è±¡å’Œå•†å“å¯¹è±¡çš„è€¦åˆã€‚</p><p>åæœŸå¦‚æœå†åŠ æ–°å“ç§çš„å’–å•¡ï¼Œæˆ‘ä»¬åŠ¿å¿…è¦éœ€æ±‚ä¿®æ”¹ SimpleCoffeeFactory çš„ä»£ç ï¼Œè¿åäº†å¼€é—­åŸåˆ™ã€‚å·¥å‚ç±»çš„å®¢æˆ·ç«¯å¯èƒ½æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚åˆ›å»ºç¾å›¢å¤–å–ç­‰ï¼Œè¿™æ ·åªéœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œçœå»å…¶ä»–çš„ä¿®æ”¹æ“ä½œã€‚</p><h3 id="2-3-ä¼˜ç¼ºç‚¹">2.3 ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><p>å°è£…äº†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡å‚æ•°ç›´æ¥è·å–å¯¹è±¡ã€‚æŠŠå¯¹è±¡çš„åˆ›å»ºå’Œä¸šåŠ¡é€»è¾‘å±‚åˆ†å¼€ï¼Œè¿™æ ·ä»¥åå°±é¿å…äº†ä¿®æ”¹å®¢æˆ·ä»£ç ï¼Œå¦‚æœè¦å®ç°æ–°äº§å“ç›´æ¥ä¿®æ”¹å·¥å‚ç±»ï¼Œè€Œä¸éœ€è¦åœ¨åŸä»£ç ä¸­ä¿®æ”¹ï¼Œè¿™æ ·å°±é™ä½äº†å®¢æˆ·ä»£ç ä¿®æ”¹çš„å¯èƒ½æ€§ï¼Œæ›´åŠ å®¹æ˜“æ‰©å±•ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>å¢åŠ æ–°äº§å“æ—¶è¿˜æ˜¯éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚</p><h3 id="2-4-æ‹“å±•-é™æ€å·¥å‚">2.4 æ‹“å±•(é™æ€å·¥å‚)</h3><p>åœ¨å¼€å‘ä¸­ä¹Ÿæœ‰ä¸€éƒ¨åˆ†äººå°†å·¥å‚ç±»ä¸­çš„åˆ›å»ºå¯¹è±¡çš„åŠŸèƒ½å®šä¹‰ä¸ºé™æ€çš„ï¼Œè¿™ä¸ªå°±æ˜¯é™æ€å·¥å‚æ¨¡å¼ï¼Œå®ƒä¹Ÿä¸æ˜¯ 23 ç§è®¾è®¡æ¨¡å¼ä¸­çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleCoffeeFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"americano"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmericanoCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"latte"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            coffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatteCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> coffe<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-å·¥å‚æ–¹æ³•æ¨¡å¼">3-å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p>é’ˆå¯¹ä¸Šä¾‹ä¸­çš„ç¼ºç‚¹ï¼Œä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å°±å¯ä»¥å®Œç¾çš„è§£å†³ï¼Œå®Œå…¨éµå¾ªå¼€é—­åŸåˆ™ã€‚</p><h3 id="3-1-æ¦‚å¿µ">3.1 æ¦‚å¿µ</h3><p>å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªäº§å“ç±»å¯¹è±¡ã€‚å·¥å‚æ–¹æ³•ä½¿ä¸€ä¸ªäº§å“ç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å·¥å‚çš„å­ç±»ã€‚</p><h3 id="3-2-ç»“æ„">3.2 ç»“æ„</h3><p>å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¸»è¦è§’è‰²ï¼š</p><ul><li>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³•æ¥åˆ›å»ºäº§å“ã€‚</li><li>å…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li><li>æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li><li>å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚</li></ul><h3 id="3-3-å®ç°">3.3 å®ç°</h3><p>ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å¯¹ä¸Šä¾‹è¿›è¡Œæ”¹è¿›ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass CoffeeFactory {<< interface >>+ createCoffee() Coffee}class CoffeeStore {+ orderCoffee Coffee}class Coffee {+ getName() String+ addMilk() void+ addSugar() void}class AmericanCoffeeFactory {+ createCoffee() Coffee}class LatteCoffeeFactory {+ createCoffee() Coffee}class AmericanCoffee {+ getName() String}class LatteCoffee {+ getName() String}CoffeeFactory <|.. AmericanCoffeeFactory : å®ç°CoffeeFactory <|.. LatteCoffeeFactory : å®ç°CoffeeStore ..> Coffee : ä¾èµ–CoffeeFactory <.. CoffeeStore : ä¾èµ–AmericanCoffeeFactory ..> AmericanCoffee : ä¾èµ–Coffee <|-- AmericanCoffee : ç»§æ‰¿Coffee <|-- LatteCoffee : ç»§æ‰¿LatteCoffeeFactory ..> LatteCoffee : ä¾èµ–link CoffeeFactory "#æŠ½è±¡å·¥å‚-Code" "ä»£ç é“¾æ¥"link AmericanCoffeeFactory "#å…·ä½“å·¥å‚-Code" "ä»£ç é“¾æ¥"link LatteCoffeeFactory "#å…·ä½“å·¥å‚-Code" "ä»£ç é“¾æ¥"link CoffeeStore "#å’–å•¡åº—ç±»-Code" "ä»£ç é“¾æ¥"</pre><h6 id="æŠ½è±¡å·¥å‚-Code">æŠ½è±¡å·¥å‚-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CoffeeFactory</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h6 id="å…·ä½“å·¥å‚-Code">å…·ä½“å·¥å‚-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LatteCoffeeFactory</span> <span class="token keyword">implements</span> <span class="token class-name">CoffeeFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatteCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AmericanCoffeeFactory</span> <span class="token keyword">implements</span> <span class="token class-name">CoffeeFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AmericanCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="å’–å•¡åº—ç±»-Code">å’–å•¡åº—ç±»-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoffeeStore</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">CoffeeFactory</span> factory<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">CoffeeStore</span><span class="token punctuation">(</span><span class="token class-name">CoffeeFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>factory <span class="token operator">=</span> factory<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">orderCoffee</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        coffee<span class="token punctuation">.</span><span class="token function">addMilk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        coffee<span class="token punctuation">.</span><span class="token function">addsugar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> coffee<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºå’–å•¡åº—å¯¹è±¡</span>        <span class="token class-name">CoffeeStore</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoffeeStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºå¯¹è±¡</span>        <span class="token comment">//CoffeeFactory factory = new AmericanCoffeeFactory();//ç¾å¼å’–å•¡</span>        <span class="token class-name">CoffeeFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatteCoffeeFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‹¿é“å’–å•¡</span>        store<span class="token punctuation">.</span><span class="token function">setFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç‚¹å’–å•¡</span>        <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">orderCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>coffee<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä»¥ä¸Šçš„ç¼–å†™çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œè¦å¢åŠ äº§å“ç±»æ—¶ä¹Ÿè¦ç›¸åº”åœ°å¢åŠ å·¥å‚ç±»ï¼Œä¸éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç äº†ï¼Œè¿™æ ·å°±è§£å†³äº†ç®€å•å·¥å‚æ¨¡å¼çš„ç¼ºç‚¹ã€‚</p><p>å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„è¿›ä¸€æ­¥æŠ½è±¡ã€‚ç”±äºä½¿ç”¨äº†å¤šæ€æ€§ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼ä¿æŒäº†ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œè€Œä¸”å…‹æœäº†å®ƒçš„ç¼ºç‚¹ã€‚</p><h3 id="3-4-ä¼˜ç¼ºç‚¹">3.4 ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>ç”¨æˆ·åªéœ€è¦çŸ¥é“å…·ä½“å·¥å‚çš„åç§°å°±å¯å¾—åˆ°æ‰€è¦çš„äº§å“ï¼Œæ— é¡»çŸ¥é“äº§å“çš„å…·ä½“åˆ›å»ºè¿‡ç¨‹ï¼›</li><li>åœ¨ç³»ç»Ÿå¢åŠ æ–°çš„äº§å“æ—¶åªéœ€è¦æ·»åŠ å…·ä½“äº§å“ç±»å’Œå¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œæ— é¡»å¯¹åŸå·¥å‚è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ï¼›</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>æ¯å¢åŠ ä¸€ä¸ªäº§å“å°±è¦å¢åŠ ä¸€ä¸ªå…·ä½“äº§å“ç±»å’Œä¸€ä¸ªå¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</li></ul><h2 id="4-æŠ½è±¡å·¥å‚æ¨¡å¼">4-æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>å‰é¢ä»‹ç»çš„å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­è€ƒè™‘çš„æ˜¯ä¸€ç±»äº§å“çš„ç”Ÿäº§ï¼Œå¦‚ç•œç‰§åœºåªå…»åŠ¨ç‰©ã€ç”µè§†æœºå‚åªç”Ÿäº§ç”µè§†æœºç­‰ã€‚</p><p>è¿™äº›å·¥å‚åªç”Ÿäº§åŒç§ç±»äº§å“ï¼ŒåŒç§ç±»äº§å“ç§°ä¸ºåŒç­‰çº§äº§å“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼åªè€ƒè™‘ç”Ÿäº§åŒç­‰çº§çš„äº§å“ï¼Œä½†æ˜¯åœ¨ç°å®ç”Ÿæ´»ä¸­è®¸å¤šå·¥å‚æ˜¯ç»¼åˆå‹çš„å·¥å‚ï¼Œèƒ½ç”Ÿäº§å¤šç­‰çº§ï¼ˆç§ç±»ï¼‰ çš„äº§å“ï¼Œå¦‚ç”µå™¨å‚æ—¢ç”Ÿäº§ç”µè§†æœºåˆç”Ÿäº§æ´—è¡£æœºæˆ–ç©ºè°ƒï¼Œå¤§å­¦æ—¢æœ‰è½¯ä»¶ä¸“ä¸šåˆæœ‰ç”Ÿç‰©ä¸“ä¸šç­‰ã€‚</p><p>æœ¬èŠ‚è¦ä»‹ç»çš„æŠ½è±¡å·¥å‚æ¨¡å¼å°†è€ƒè™‘å¤šç­‰çº§äº§å“çš„ç”Ÿäº§ï¼Œå°†åŒä¸€ä¸ªå…·ä½“å·¥å‚æ‰€ç”Ÿäº§çš„ä½äºä¸åŒç­‰çº§çš„ä¸€ç»„äº§å“ç§°ä¸ºä¸€ä¸ªäº§å“æ—ï¼Œä¸‹å›¾æ‰€ç¤ºæ¨ªè½´æ˜¯äº§å“ç­‰çº§ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ç±»äº§å“ï¼›çºµè½´æ˜¯äº§å“æ—ï¼Œä¹Ÿå°±æ˜¯åŒä¸€å“ç‰Œçš„äº§å“ï¼ŒåŒä¸€å“ç‰Œçš„äº§å“äº§è‡ªåŒä¸€ä¸ªå·¥å‚ã€‚</p><p><img src="./../design-pattern-factory/image-20240122213730401.png" alt=""></p><h3 id="4-1-æ¦‚å¿µ">4.1 æ¦‚å¿µ</h3><p>æ˜¯ä¸€ç§ä¸ºè®¿é—®ç±»æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œä¸”è®¿é—®ç±»æ— é¡»æŒ‡å®šæ‰€è¦äº§å“çš„å…·ä½“ç±»å°±èƒ½å¾—åˆ°åŒæ—çš„ä¸åŒç­‰çº§çš„äº§å“çš„æ¨¡å¼ç»“æ„ã€‚</p><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å‡çº§ç‰ˆæœ¬ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼åªç”Ÿäº§ä¸€ä¸ªç­‰çº§çš„äº§å“ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¯ç”Ÿäº§å¤šä¸ªç­‰çº§çš„äº§å“ã€‚</p><h3 id="4-2-ç»“æ„">4.2 ç»“æ„</h3><p>æŠ½è±¡å·¥å‚æ¨¡å¼çš„ä¸»è¦è§’è‰²å¦‚ä¸‹ï¼š</p><ul><li>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œå®ƒåŒ…å«å¤šä¸ªåˆ›å»ºäº§å“çš„æ–¹æ³•ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒç­‰çº§çš„äº§å“ã€‚</li><li>å…·ä½“å·¥å‚ï¼ˆConcrete Factoryï¼‰ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li><li>æŠ½è±¡äº§å“ï¼ˆProductï¼‰ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¤šä¸ªæŠ½è±¡äº§å“ã€‚</li><li>å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒ åŒå…·ä½“å·¥å‚ä¹‹é—´æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ã€‚</li></ul><h3 id="4-3-å®ç°">4.3 å®ç°</h3><p>ç°å’–å•¡åº—ä¸šåŠ¡å‘ç”Ÿæ”¹å˜ï¼Œä¸ä»…è¦ç”Ÿäº§å’–å•¡è¿˜è¦ç”Ÿäº§ç”œç‚¹ï¼Œå¦‚ææ‹‰ç±³è‹ã€æŠ¹èŒ¶æ…•æ–¯ç­‰ï¼Œè¦æ˜¯æŒ‰ç…§å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œéœ€è¦å®šä¹‰ææ‹‰ç±³è‹ç±»ã€æŠ¹èŒ¶æ…•æ–¯ç±»ã€ææ‹‰ç±³è‹å·¥å‚ã€æŠ¹èŒ¶æ…•æ–¯å·¥å‚ã€ç”œç‚¹å·¥å‚ç±»ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿç±»çˆ†ç‚¸æƒ…å†µã€‚å…¶ä¸­æ‹¿é“å’–å•¡ã€ç¾å¼å’–å•¡æ˜¯ä¸€ä¸ªäº§å“ç­‰çº§ï¼Œéƒ½æ˜¯å’–å•¡ï¼›ææ‹‰ç±³è‹ã€æŠ¹èŒ¶æ…•æ–¯ä¹Ÿæ˜¯ä¸€ä¸ªäº§å“ç­‰çº§ï¼›æ‹¿é“å’–å•¡å’Œææ‹‰ç±³è‹æ˜¯åŒä¸€äº§å“æ—ï¼ˆä¹Ÿå°±æ˜¯éƒ½å±äºæ„å¤§åˆ©é£å‘³ï¼‰ï¼Œç¾å¼å’–å•¡å’ŒæŠ¹èŒ¶æ…•æ–¯æ˜¯åŒä¸€äº§å“æ—ï¼ˆä¹Ÿå°±æ˜¯éƒ½å±äºç¾å¼é£å‘³ï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªæ¡ˆä¾‹å¯ä»¥ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Dessert {+ show() void}class Coffee {+ getName() String+ addMilk() void+ addSugar() void}class Tiramisu {+ show() void}class MatchaMousse {+ show() void}class AmericanCoffee {+ getName() String}class LatteCoffee {+ getName() String}class AmericanDessertFactory {+ createCoffee() Coffee+ createDessert() Dessert}class ItalyDessertFactory {+ createCoffee() Coffee+ createDessert() Dessert}class DessertFactory {<< interface >>+ craeteCOffee() Coffee+ createDessert() Dessert}Dessert <|-- Tiramisu : ç»§æ‰¿Dessert <|-- MatchaMousse : ç»§æ‰¿Coffee <|-- AmericanCoffee : ç»§æ‰¿Coffee <|-- LatteCoffee : ç»§æ‰¿Tiramisu <.. AmericanDessertFactory : ä¾èµ–MatchaMousse <..AmericanDessertFactory : ä¾èµ–AmericanCoffee <.. ItalyDessertFactory : ä¾èµ–LatteCoffee <.. ItalyDessertFactory : ä¾èµ–ItalyDessertFactory ..|> DessertFactory : å®ç°AmericanDessertFactory ..|> DessertFactory : å®ç°link DessertFactory "#æŠ½è±¡å·¥ç¨‹-Code"link ItalyDessertFactory "#å…·ä½“å·¥å‚2-Code"link AmericanDessertFactory "#å…·ä½“å·¥å‚2-Code"</pre><h6 id="æŠ½è±¡å·¥å‚-Code-2">æŠ½è±¡å·¥å‚-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DessertFactory</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç”Ÿäº§å’–å•¡çš„åŠŸèƒ½</span>    <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç”Ÿäº§ç”œå“çš„åŠŸèƒ½</span>    <span class="token class-name">Dessert</span> <span class="token function">createDessert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="å…·ä½“å·¥å‚2-Code">å…·ä½“å·¥å‚2-Code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç¾å¼ç”œç‚¹å·¥å‚</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AmericanDessertFactory</span> <span class="token keyword">implements</span> <span class="token class-name">DessertFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AmericanCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Dessert</span> <span class="token function">createDessert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MatchaMousse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ„å¤§åˆ©é£å‘³ç”œç‚¹å·¥å‚</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItalyDessertFactory</span> <span class="token keyword">implements</span> <span class="token class-name">DessertFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Coffee</span> <span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatteCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Dessert</span> <span class="token function">createDessert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Tiramisu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æµ‹è¯•ç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºçš„æ˜¯æ„å¤§åˆ©é£å‘³ç”œå“å·¥å‚å¯¹è±¡</span>        <span class="token comment">//ItalyDessertFactory factory = new ItalyDessertFactory();//æ„å¤§åˆ©é£å‘³å·¥å‚</span>        <span class="token class-name">AmericanDessertFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AmericanDessertFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç¾å¼é£å‘³å·¥å‚</span>        <span class="token comment">//è·å–æ‹¿é“å’–å•¡å’Œææ‹‰ç±³è‹ç”œå“</span>        <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Dessert</span> dessert <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createDessert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>coffee<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dessert<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè¦åŠ åŒä¸€ä¸ªäº§å“æ—çš„è¯ï¼Œåªéœ€è¦å†åŠ ä¸€ä¸ªå¯¹åº”çš„å·¥å‚ç±»å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹å…¶ä»–çš„ç±»ã€‚</p><h3 id="4-3-ä¼˜ç¼ºç‚¹">4.3 ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><p>å½“ä¸€ä¸ªäº§å“æ—ä¸­çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œæ—¶ï¼Œå®ƒèƒ½ä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“æ—ä¸­çš„å¯¹è±¡ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>å½“äº§å“æ—ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—¶ï¼Œæ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="4-4-ä½¿ç”¨åœºæ™¯">4.4 ä½¿ç”¨åœºæ™¯</h3><ul><li><p>å½“éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ˜¯ä¸€ç³»åˆ—ç›¸äº’å…³è”æˆ–ç›¸äº’ä¾èµ–çš„äº§å“æ—æ—¶ï¼Œå¦‚ç”µå™¨å·¥å‚ä¸­çš„ç”µè§†æœºã€æ´—è¡£æœºã€ç©ºè°ƒç­‰ã€‚</p></li><li><p>ç³»ç»Ÿä¸­æœ‰å¤šä¸ªäº§å“æ—ï¼Œä½†æ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„æŸä¸€æ—äº§å“ã€‚å¦‚æœ‰äººåªå–œæ¬¢ç©¿æŸä¸€ä¸ªå“ç‰Œçš„è¡£æœå’Œé‹ã€‚</p></li><li><p>ç³»ç»Ÿä¸­æä¾›äº†äº§å“çš„ç±»åº“ï¼Œä¸”æ‰€æœ‰äº§å“çš„æ¥å£ç›¸åŒï¼Œå®¢æˆ·ç«¯ä¸ä¾èµ–äº§å“å®ä¾‹çš„åˆ›å»ºç»†èŠ‚å’Œå†…éƒ¨ç»“æ„ã€‚</p></li></ul><p>å¦‚ï¼šè¾“å…¥æ³•æ¢çš®è‚¤ï¼Œä¸€æ•´å¥—ä¸€èµ·æ¢ã€‚ç”Ÿæˆä¸åŒæ“ä½œç³»ç»Ÿçš„ç¨‹åºã€‚</p><h2 id="5-æ¨¡å¼æ‰©å±•">5-æ¨¡å¼æ‰©å±•</h2><h3 id="ç®€å•å·¥å‚-é…ç½®æ–‡ä»¶è§£é™¤è€¦åˆ">ç®€å•å·¥å‚+é…ç½®æ–‡ä»¶è§£é™¤è€¦åˆ</h3><p>å¯ä»¥é€šè¿‡å·¥å‚æ¨¡å¼ + é…ç½®æ–‡ä»¶çš„æ–¹å¼è§£é™¤å·¥å‚å¯¹è±¡å’Œäº§å“å¯¹è±¡çš„è€¦åˆã€‚åœ¨å·¥å‚ç±»ä¸­åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…¨ç±»åï¼Œå¹¶åˆ›å»ºå¯¹è±¡è¿›è¡Œå­˜å‚¨ï¼Œå®¢æˆ·ç«¯å¦‚æœéœ€è¦å¯¹è±¡ï¼Œç›´æ¥è¿›è¡Œè·å–å³å¯ã€‚</p><h4 id="â‘ -å®šä¹‰é…ç½®æ–‡ä»¶">â‘  å®šä¹‰é…ç½®æ–‡ä»¶</h4><p>ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨ properties æ–‡ä»¶ä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œåç§°ä¸º bean.properties</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">american</span><span class="token punctuation">=</span><span class="token value attr-value">cn.saddyfire.pattern.factory.config_factory.AmericanCoffee</span><span class="token key attr-name">latte</span><span class="token punctuation">=</span><span class="token value attr-value">cn.saddyfire.pattern.factory.config_factory.LatteCoffee</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="â‘¡-æ”¹è¿›å·¥å‚ç±»">â‘¡ æ”¹è¿›å·¥å‚ç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoffeeFactory</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åŠ è½½é…ç½®æ–‡ä»¶, è·å–é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„å…¨ç±»å, å¹¶åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡è¿›è¡Œå­˜å‚¨</span>    <span class="token comment">//1.å®šä¹‰å®¹å™¨å¯¹è±¡å­˜å‚¨å’–å•¡å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Coffee</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//2.åŠ è½½é…ç½®æ–‡ä»¶, åªéœ€è¦åŠ è½½ä¸€æ¬¡, å› æ­¤æ”¾åœ¨é™æ€ä»£ç å—é‡Œ</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//2.1 åˆ›å»ºPropertieså¯¹è±¡</span>        <span class="token class-name">Properties</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.2 è°ƒç”¨på¯¹è±¡ä¸­çš„loadæ–¹æ³•è¿›è¡Œé…ç½®æ–‡ä»¶çš„åŠ è½½</span>        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token class-name">CoffeeFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"bean.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            p<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//ä»pé›†åˆä¸­è·å–å…¨ç±»åå¹¶åˆ›å»ºå¯¹è±¡</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> key <span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//æ— å‚æ„é€ </span>                <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Coffee</span><span class="token punctuation">)</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> key<span class="token punctuation">,</span> coffee<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Coffee</span> <span class="token function">craeteCoffee</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æµ‹è¯•ç±»">æµ‹è¯•ç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Coffee</span> coffee <span class="token operator">=</span> <span class="token class-name">CoffeeFactory</span><span class="token punctuation">.</span><span class="token function">craeteCoffee</span><span class="token punctuation">(</span><span class="token string">"american"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>coffee<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Coffee</span> latte <span class="token operator">=</span> <span class="token class-name">CoffeeFactory</span><span class="token punctuation">.</span><span class="token function">craeteCoffee</span><span class="token punctuation">(</span><span class="token string">"latte"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>coffee<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™æ€æˆå‘˜å˜é‡ç”¨æ¥å­˜å‚¨åˆ›å»ºçš„å¯¹è±¡ï¼ˆé”®å­˜å‚¨çš„æ˜¯åç§°ï¼Œå€¼å­˜å‚¨çš„æ˜¯å¯¹åº”çš„å¯¹è±¡ï¼‰ï¼Œè€Œè¯»å–é…ç½®æ–‡ä»¶ä»¥åŠåˆ›å»ºå¯¹è±¡å†™åœ¨é™æ€ä»£ç å—ä¸­ï¼Œç›®çš„å°±æ˜¯åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ã€‚</p><h2 id="6-JDK-æºç æ¡ˆä¾‹">6-JDK æºç æ¡ˆä¾‹</h2><p><strong>Collection.iterator() æ–¹æ³•</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ä»¤ç‹å†²"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"é£æ¸…æ‰¬"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ä»»æˆ‘è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–è¿­ä»£å™¨å¯¹è±¡</span>        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> it <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä½¿ç”¨è¿­ä»£å™¨éå†</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> ele <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹ä¸Šé¢çš„ä»£ç å¤§å®¶åº”è¯¥å¾ˆç†Ÿï¼Œä½¿ç”¨è¿­ä»£å™¨éå†é›†åˆï¼Œè·å–é›†åˆä¸­çš„å…ƒç´ ã€‚è€Œå•åˆ—é›†åˆè·å–è¿­ä»£å™¨çš„æ–¹æ³•å°±ä½¿ç”¨åˆ°äº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚æˆ‘ä»¬çœ‹é€šè¿‡ç±»å›¾çœ‹çœ‹ç»“æ„ï¼š</p><pre class="mermaid">classDiagramclass Collection {<< interface >>+ iterator() Iterator}class Iterator {<< interface >>+ hasNext() boolean+ next() I}class ArrayList {+ iterator() Iterator}class `ArrayList$Iter` {+ hasNext() boolean+ next() I}Collection <|.. ArrayList : å®ç°Collection ..> Iterator: ä¾èµ–Iterator <|.. `ArrayList$Iter` : å®ç°ArrayList ..> `ArrayList$Iter` : ä¾èµ–</pre><p>Collection æ¥å£æ˜¯<strong>æŠ½è±¡å·¥å‚ç±»</strong>ï¼ŒArrayList æ˜¯<strong>å…·ä½“å·¥å‚ç±»</strong>ï¼›Iterator æ¥å£æ˜¯<strong>æŠ½è±¡å•†å“ç±»</strong>ï¼ŒArrayList ç±»ä¸­çš„ Iter å†…éƒ¨ç±»æ˜¯<strong>å…·ä½“å•†å“ç±»</strong>ã€‚åœ¨å…·ä½“çš„å·¥å‚ç±»ä¸­ iterator() æ–¹æ³•åˆ›å»ºå…·ä½“çš„å•†å“ç±»çš„å¯¹è±¡ã€‚</p><blockquote><p>å¦ï¼š</p><ol><li>DateForamt ç±»ä¸­çš„ getInstance() æ–¹æ³•ä½¿ç”¨çš„æ˜¯å·¥å‚æ¨¡å¼ï¼›</li><li>Calendar ç±»ä¸­çš„ getInstance() æ–¹æ³•ä½¿ç”¨çš„æ˜¯å·¥å‚æ¨¡å¼ï¼›</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-02-åˆ›å»ºå‹æ¨¡å¼-å•ä¾‹æ¨¡å¼</title>
      <link href="/2024/01/21/design-pattern-singleton/"/>
      <url>/2024/01/21/design-pattern-singleton/</url>
      
        <content type="html"><![CDATA[<h1>åˆ›å»ºå‹æ¨¡å¼</h1><p>åˆ›å»ºå‹æ¨¡å¼çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯â€œæ€æ ·åˆ›å»ºå¯¹è±¡ï¼Ÿâ€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚</p><p>è¿™æ ·å¯ä»¥é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œä½¿ç”¨è€…ä¸éœ€è¦å…³æ³¨å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ã€‚</p><p>åˆ›å»ºå‹æ¨¡å¼åˆ†ä¸ºï¼š</p><ul><li>å•ä¾‹æ¨¡å¼</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼</li><li>æŠ½è±¡å·¥å‚æ¨¡å¼</li><li>åŸå‹æ¨¡å¼</li><li>å»ºé€ è€…æ¨¡å¼</li></ul><h1>å•ä¾‹è®¾è®¡æ¨¡å¼</h1><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p><p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚</p><h2 id="1-å•ä¾‹æ¨¡å¼çš„ç»“æ„">1-å•ä¾‹æ¨¡å¼çš„ç»“æ„</h2><p>å•ä¾‹æ¨¡å¼çš„ä¸»è¦æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>å•ä¾‹ç±»ã€‚åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ç±»</li><li>è®¿é—®ç±»ã€‚ä½¿ç”¨å•ä¾‹ç±»</li></ul><h2 id="2-å•ä¾‹æ¨¡å¼çš„å®ç°">2-å•ä¾‹æ¨¡å¼çš„å®ç°</h2><blockquote><p>å•ä¾‹è®¾è®¡æ¨¡å¼åˆ†ç±»ä¸¤ç§ï¼š</p><ul><li>é¥¿æ±‰å¼ï¼šç±»åŠ è½½å°±ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»º</li><li>æ‡’æ±‰å¼ï¼šç±»åŠ è½½ä¸ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»ºï¼Œè€Œæ˜¯é¦–æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶æ‰ä¼šåˆ›å»º</li></ul></blockquote><h3 id="â‘ -é™æ€å˜é‡-é¥¿æ±‰å¼">â‘  é™æ€å˜é‡(é¥¿æ±‰å¼)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é¥¿æ±‰å¼ï¼š é™æ€æˆå‘˜å˜é‡</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1ï¼Œç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//2ï¼Œåœ¨æœ¬ç±»ä¸­åˆ›å»ºæœ¬ç±»å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//3ï¼Œæä¾›ä¸€ä¸ªå…¬å…±çš„è®¿é—®æ–¹å¼ï¼Œè®©å¤–ç•Œè·å–è¯¥å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color='red'>è¯´æ˜ï¼š</font></p><p>â€‹è¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜ Singleton ç±»å‹çš„é™æ€å˜é‡ï¼Œå¹¶åˆ›å»º Singleton ç±»çš„å¯¹è±¡ instanceã€‚instance å¯¹è±¡æ˜¯éšç€ç±»çš„åŠ è½½è€Œåˆ›å»ºçš„ã€‚å¦‚æœè¯¥å¯¹è±¡è¶³å¤Ÿå¤§çš„è¯ï¼Œè€Œä¸€ç›´æ²¡æœ‰ä½¿ç”¨å°±ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚</p><h3 id="â‘¡-é™æ€ä»£ç å—-é¥¿æ±‰å¼">â‘¡ é™æ€ä»£ç å—(é¥¿æ±‰å¼)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é¥¿æ±‰å¼ ï¼š é™æ€ä»£ç å—</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//å£°æ˜Singletonç±»å‹çš„å˜é‡</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span> <span class="token comment">//null</span>    <span class="token comment">//åœ¨é™æ€ä»£ç å—ä¸­è¿›è¡Œèµ‹å€¼</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å¯¹å¤–æä¾›è·å–è¯¥ç±»å¯¹è±¡çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color='red'>è¯´æ˜ï¼š</font></p><p>â€‹è¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜ Singleton ç±»å‹çš„é™æ€å˜é‡ï¼Œè€Œå¯¹è±¡çš„åˆ›å»ºæ˜¯åœ¨é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯å¯¹ç€ç±»çš„åŠ è½½è€Œåˆ›å»ºã€‚æ‰€ä»¥å’Œé¥¿æ±‰å¼çš„æ–¹å¼1åŸºæœ¬ä¸Šä¸€æ ·ï¼Œå½“ç„¶è¯¥æ–¹å¼ä¹Ÿå­˜åœ¨å†…å­˜æµªè´¹é—®é¢˜ã€‚</p><h3 id="â‘¢-synchronized-æ‡’æ±‰å¼">â‘¢ synchronized(æ‡’æ±‰å¼)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//å£°æ˜Singletonç±»å‹çš„å˜é‡instance</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span> <span class="token comment">//åªæ˜¯å£°æ˜ä¸€ä¸ªè¯¥ç±»å‹çš„å˜é‡ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œèµ‹å€¼</span>    <span class="token comment">//å¯¹å¤–æä¾›è®¿é—®æ–¹å¼(åŠ é”)</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ¤æ–­instanceæ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ºnullï¼Œè¯´æ˜è¿˜æ²¡æœ‰åˆ›å»ºSingletonç±»çš„å¯¹è±¡</span>        <span class="token comment">//å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºä¸€ä¸ªå¹¶è¿”å›ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//çº¿ç¨‹1ç­‰å¾…ï¼Œçº¿ç¨‹2è·å–åˆ°cpuçš„æ‰§è¡Œæƒï¼Œä¹Ÿä¼šè¿›å…¥åˆ°è¯¥åˆ¤æ–­é‡Œé¢</span>            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color='red'>è¯´æ˜ï¼š</font></p><p>â€‹è¯¥æ–¹å¼ä¹Ÿå®ç°äº†æ‡’åŠ è½½æ•ˆæœï¼ŒåŒæ—¶åˆè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯åœ¨ getInstance() æ–¹æ³•ä¸Šæ·»åŠ äº† synchronized å…³é”®å­—ï¼Œå¯¼è‡´è¯¥æ–¹æ³•çš„æ‰§è¡Œæ•ˆæœç‰¹åˆ«ä½ã€‚ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå…¶å®å°±æ˜¯åœ¨åˆå§‹åŒ– instance çš„æ—¶å€™æ‰ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸€æ—¦åˆå§‹åŒ–å®Œæˆå°±ä¸å­˜åœ¨äº†ã€‚</p><h3 id="â‘£-åŒé‡æ£€æŸ¥é”-æ‡’æ±‰å¼-ğŸ‘">â‘£ åŒé‡æ£€æŸ¥é”(æ‡’æ±‰å¼)ğŸ‘</h3><p>å†æ¥è®¨è®ºä¸€ä¸‹æ‡’æ±‰æ¨¡å¼ä¸­åŠ é”çš„é—®é¢˜ï¼Œå¯¹äº getInstance() æ–¹æ³•æ¥è¯´ï¼Œ<strong>ç»å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½æ˜¯è¯»æ“ä½œï¼Œè¯»æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡å¿…è®©æ¯ä¸ªçº¿ç¨‹å¿…é¡»æŒæœ‰é”æ‰èƒ½è°ƒç”¨è¯¥æ–¹æ³•</strong>ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´åŠ é”çš„æ—¶æœºã€‚ç”±æ­¤ä¹Ÿäº§ç”Ÿäº†ä¸€ç§æ–°çš„å®ç°æ¨¡å¼ï¼š<strong>åŒé‡æ£€æŸ¥é”æ¨¡å¼</strong></p><h6 id="code-double-checked">code-double-checked</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//å£°æ˜Singletonç±»å‹çš„å˜é‡</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>    <span class="token comment">//å¯¹å¤–æä¾›å…¬å…±çš„è®¿é—®æ–¹å¼</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ç¬¬ä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœinstanceçš„å€¼ä¸ä¸ºnullï¼Œä¸éœ€è¦æŠ¢å é”ï¼Œç›´æ¥è¿”å›å¯¹è±¡</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//ä¹Ÿè®¸æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®ä¾‹ï¼Œæ‰€ä»¥å†åˆ¤æ–­ä¸€æ¬¡</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§éå¸¸å¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œè§£å†³äº†å•ä¾‹ã€æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸Šé¢çš„åŒé‡æ£€æµ‹é”æ¨¡å¼çœ‹ä¸Šå»å®Œç¾æ— ç¼ºï¼Œå…¶å®æ˜¯å­˜åœ¨é—®é¢˜ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œå‡ºç°é—®é¢˜çš„åŸå› æ˜¯ JVM åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¼šè¿›è¡Œä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’åºæ“ä½œã€‚</p><p>è¦è§£å†³åŒé‡æ£€æŸ¥é”æ¨¡å¼å¸¦æ¥ç©ºæŒ‡é’ˆå¼‚å¸¸çš„é—®é¢˜ï¼Œåªéœ€è¦ä½¿ç”¨ <code>volatile</code> å…³é”®å­—, <code>volatile</code> å…³é”®å­—å¯ä»¥ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ã€‚</p><p><font color="red">å°ç»“ï¼š</font></p><p>æ·»åŠ  <code>volatile</code> å…³é”®å­—ä¹‹åçš„åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œèƒ½å¤Ÿä¿è¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹çº¿ç¨‹å®‰å…¨ä¹Ÿä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚</p><h3 id="â‘£-è¡¥å……-æŒ‡ä»¤é‡æ’-ğŸ‘">â‘£ è¡¥å……(æŒ‡ä»¤é‡æ’)ğŸ‘</h3><p><img src="./../design-pattern-singleton/image-20240121184520210.png" alt="åŒé‡æ£€æŸ¥-å­—èŠ‚ç æŒ‡ä»¤"></p><p><font color="red">å…¶ä¸­:</font></p><ul><li>17 new è¡¨ç¤ºåˆ›å»ºå¯¹è±¡ï¼Œå°†å¯¹è±¡å¼•ç”¨å…¥æ ˆ  // new Singleton</li><li>20 dup è¡¨ç¤ºå¤åˆ¶ä¸€ä»½å¯¹è±¡å¼•ç”¨  // å¼•ç”¨åœ°å€</li><li>21 invokespecial è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œè°ƒç”¨æ„é€ æ–¹æ³•</li><li>24 putstatic è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œèµ‹å€¼ç»™ static INSTANCE</li></ul><p>ä¹Ÿè®¸ JVM ä¼šä¼˜åŒ–ä¸ºï¼šå…ˆæ‰§è¡Œ 24ï¼Œå†æ‰§è¡Œ 21ã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹ t1ï¼Œt2 æŒ‰å¦‚ä¸‹æ—¶é—´åºåˆ—æ‰§è¡Œï¼š</p><pre class="mermaid">sequenceDiagramparticipant t1 as t1participant I as INSTANCEparticipant t2 as t2t1 ->> t1: 17: newt1 ->> t1: 20: dupt1 ->> I: 24: putstatic(ç»™ INSTANCE èµ‹å€¼)t2 ->> I: 0: getstatic(è·å– INSTANCE å¼•ç”¨)t2 ->> t2: 3: ifnonull 37(åˆ¤æ–­ä¸ä¸ºç©º, è·³è½¬ 37 è¡Œ)t2 ->> I: 37: getstatic(è·å– INSTANCE å¼•ç”¨)t2 ->> t2: 40: return(è¿”å›)t2 ->> t2: ä½¿ç”¨å¯¹è±¡t1 ->> t1: 21: invokespecial(è°ƒç”¨æ„é€ æ–¹æ³•)</pre><p>å…³é”®åœ¨äº <code>0: getstatic</code> è¿™è¡Œä»£ç åœ¨ monitor æ§åˆ¶ä¹‹å¤–ï¼Œå®ƒå°±åƒä¹‹å‰ä¸¾ä¾‹ä¸­ä¸å®ˆè§„åˆ™çš„äººï¼Œå¯ä»¥è¶Šè¿‡ monitor è¯»å– INSTANCE å˜é‡çš„å€¼</p><p>è¿™æ—¶ t1 è¿˜æœªå®Œå…¨å°†æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­è¦æ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆ t2 æ‹¿åˆ°çš„æ˜¯å°†æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹<br>å¯¹ INSTANCE ä½¿ç”¨ volatile ä¿®é¥°å³å¯ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œä½†è¦æ³¨æ„åœ¨ JDK5 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„ volatile æ‰ä¼šçœŸæ­£æœ‰æ•ˆ</p><p><strong>åŠ å…¥ volatile åæ•ˆæœ</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#------------------->åŠ å…¥å¯¹ INSTANCE å˜é‡çš„è¯»å±éšœ</span> <span class="token number">0</span> getstatic <span class="token comment">#2 </span> <span class="token number">3</span> ifnonnull <span class="token number">37</span> <span class="token punctuation">(</span>+34<span class="token punctuation">)</span> <span class="token number">6</span> ldc <span class="token comment">#3 </span> <span class="token number">8</span> dup <span class="token number">9</span> astore_0<span class="token number">10</span> monitorenter<span class="token number">11</span> getstatic <span class="token comment">#2 </span><span class="token number">14</span> ifnonnull <span class="token number">27</span> <span class="token punctuation">(</span>+13<span class="token punctuation">)</span><span class="token number">17</span> new <span class="token comment">#3 </span><span class="token number">20</span> dup<span class="token number">21</span> invokespecial <span class="token comment">#4 </span><span class="token number">24</span> putstatic <span class="token comment">#2 </span><span class="token comment">#------------------>åŠ å…¥å¯¹ INSTANCE å˜é‡çš„å†™å±éšœ</span><span class="token number">27</span> aload_0<span class="token number">28</span> monitorexit <span class="token comment">#--->ä¿è¯åŸå­æ€§ã€å¯è§æ€§</span><span class="token number">29</span> goto <span class="token number">37</span> <span class="token punctuation">(</span>+8<span class="token punctuation">)</span><span class="token number">32</span> astore_1<span class="token number">33</span> aload_0<span class="token number">34</span> monitorexit<span class="token number">35</span> aload_1<span class="token number">36</span> athrow<span class="token number">37</span> getstatic <span class="token comment">#2 </span><span class="token number">40</span> areturn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šé¢çš„æ³¨é‡Šå†…å®¹æ‰€ç¤ºï¼Œè¯»å†™ volatile å˜é‡æ—¶ä¼šåŠ å…¥å†…å­˜å±éšœï¼ˆMemory Barrierï¼ˆMemory Fenceï¼‰ï¼‰ï¼Œä¿è¯ä¸‹é¢ä¸¤ç‚¹ï¼š</p><ul><li>å¯è§æ€§<ul><li>å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ t1 å¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</li><li>è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å t2 å¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®</li></ul></li><li>æœ‰åºæ€§<ul><li>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å(æˆ‘å†™æˆ‘åå†™)</li><li>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰(æˆ‘è¯»æˆ‘å…ˆè¯»)</li></ul></li><li>æ›´åº•å±‚æ˜¯è¯»å†™å˜é‡æ—¶ä½¿ç”¨ lock æŒ‡ä»¤æ¥å¤šæ ¸ CPU ä¹‹é—´çš„å¯è§æ€§ä¸æœ‰åºæ€§</li></ul><pre class="mermaid">sequenceDiagramparticipant t1 as t1participant I as INSTANCEparticipant t2 as t2t1 ->> t1: 17: newt1 ->> t1: 20: dupt1 ->> t1: 21: invokespecial(è°ƒç”¨æ„é€ æ–¹æ³•)t2 --x I: 0: getstatic(è·å– INSTANCE å¼•ç”¨, å¸¦è¯»å±éšœ)t1 --x I: 24: putstatic(ç»™ INSTANCE èµ‹å€¼, å¸¦å†™å±éšœ)t2 ->> t2: 3: ifnonull 37(åˆ¤æ–­ä¸ä¸ºç©º, è·³è½¬ 37 è¡Œ)t2 --x I: 37: getstatic(è·å– INSTANCE å¼•ç”¨)t2 ->> t2: 40: return(è¿”å›)t2 ->> t2: ä½¿ç”¨å¯¹è±¡</pre><h3 id="â‘¤-é™æ€å†…éƒ¨ç±»-æ‡’æ±‰å¼-ğŸ‘">â‘¤ é™æ€å†…éƒ¨ç±»(æ‡’æ±‰å¼)ğŸ‘</h3><p>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ä¸­å®ä¾‹ç”±å†…éƒ¨ç±»åˆ›å»ºï¼Œç”±äº JVM åœ¨åŠ è½½å¤–éƒ¨ç±»çš„è¿‡ç¨‹ä¸­, æ˜¯ä¸ä¼šåŠ è½½é™æ€å†…éƒ¨ç±»çš„, åªæœ‰å†…éƒ¨ç±»çš„å±æ€§/æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰ä¼šè¢«åŠ è½½, å¹¶åˆå§‹åŒ–å…¶é™æ€å±æ€§ã€‚é™æ€å±æ€§ç”±äºè¢« <code>static</code> ä¿®é¥°ï¼Œä¿è¯åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸¥æ ¼ä¿è¯å®ä¾‹åŒ–é¡ºåºã€‚</p><h6 id="code-static-inner-class">code-static-inner-class</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//å®šä¹‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åœ¨å†…éƒ¨ç±»ä¸­å£°æ˜å¹¶åˆå§‹åŒ–å¤–éƒ¨ç±»çš„å¯¹è±¡</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Singleton</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æä¾›å…¬å…±çš„è®¿é—®æ–¹å¼</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color='red'>è¯´æ˜ï¼š</font></p><p>â€‹ç¬¬ä¸€æ¬¡åŠ è½½ Singleton ç±»æ—¶ä¸ä¼šå»åˆå§‹åŒ– INSTANCEï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ getInstance()ï¼Œè™šæ‹ŸæœºåŠ è½½ SingletonHolder</p><p>å¹¶åˆå§‹åŒ– INSTANCEï¼Œè¿™æ ·ä¸ä»…èƒ½ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½ä¿è¯ Singleton ç±»çš„å”¯ä¸€æ€§ã€‚</p><p><font color="red">å°ç»“ï¼š</font></p><p>â€‹é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§ä¼˜ç§€çš„å•ä¾‹æ¨¡å¼ï¼Œæ˜¯å¼€æºé¡¹ç›®ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§å•ä¾‹æ¨¡å¼ã€‚åœ¨æ²¡æœ‰åŠ ä»»ä½•é”çš„æƒ…å†µä¸‹ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¸‹çš„å®‰å…¨ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•æ€§èƒ½å½±å“å’Œç©ºé—´çš„æµªè´¹ã€‚</p><h3 id="â‘¥-æšä¸¾-é¥¿æ±‰å¼">â‘¥ æšä¸¾(é¥¿æ±‰å¼)</h3><p>æšä¸¾ç±»å®ç°å•ä¾‹æ¨¡å¼æ˜¯æåŠ›æ¨èçš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œå› ä¸ºæšä¸¾ç±»å‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”åªä¼šè£…è½½ä¸€æ¬¡ï¼Œè®¾è®¡è€…å……åˆ†çš„åˆ©ç”¨äº†æšä¸¾çš„è¿™ä¸ªç‰¹æ€§æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾çš„å†™æ³•éå¸¸ç®€å•ï¼Œè€Œä¸”æšä¸¾ç±»å‹æ˜¯æ‰€ç”¨å•ä¾‹å®ç°ä¸­å”¯ä¸€ä¸€ç§ä¸ä¼šè¢«ç ´åçš„å•ä¾‹å®ç°æ¨¡å¼ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æšä¸¾æ–¹å¼ */</span><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token constant">INSTANCE</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color='red'>è¯´æ˜ï¼š</font></p><p>â€‹æšä¸¾æ–¹å¼å±äºæ¶æ±‰å¼æ–¹å¼ã€‚</p><h2 id="3-å­˜åœ¨çš„é—®é¢˜">3-å­˜åœ¨çš„é—®é¢˜</h2><h3 id="ç ´åå•ä¾‹æ¨¡å¼">ç ´åå•ä¾‹æ¨¡å¼</h3><p>ä½¿ä¸Šé¢å®šä¹‰çš„å•ä¾‹ç±»ï¼ˆSingletonï¼‰å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œæšä¸¾æ–¹å¼é™¤å¤–ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åºåˆ—åŒ–å’Œåå°„ã€‚</p><h4 id="â… -åºåˆ—åŒ–ååºåˆ—åŒ–">â…  åºåˆ—åŒ–ååºåˆ—åŒ–</h4><p><strong>Singletonç±»ï¼š</strong></p><p><a href="#code-double-checked">åŒé‡æ£€æŸ¥é” Code</a> æˆ–è€… <a href="#code-static-inner-class">é™æ€å†…éƒ¨ç±» Code</a></p><p><strong>Testç±»</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DestroySingletonTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span><span class="token comment">//        writeObject2File(); //1.å…ˆå†™æ•°æ®</span>        <span class="token function">readObjectFromFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2.å¤šæ¬¡è¯»æ•°æ®</span>        <span class="token function">readObjectFromFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2.å¤šæ¬¡è¯»æ•°æ®</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//ä»æ–‡ä»¶è¯»å–æ•°æ®ï¼ˆå¯¹è±¡ï¼‰</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readObjectFromFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1,åˆ›å»ºå¯¹è±¡è¾“å…¥æµå¯¹è±¡</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Think\\Desktop\\a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2,è¯»å–å¯¹è±¡</span>        <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//é‡Šæ”¾èµ„æº</span>        ois<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å‘æ–‡ä»¶ä¸­å†™æ•°æ®ï¼ˆå¯¹è±¡ï¼‰</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeObject2File</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1,è·å–Singletonå¯¹è±¡</span>        <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2,åˆ›å»ºå¯¹è±¡è¾“å‡ºæµå¯¹è±¡</span>        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"./a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3,å†™å¯¹è±¡</span>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4,é‡Šæ”¾èµ„æº</span>        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="â…¡-åå°„">â…¡ åå°„</h4><p><strong>Singletonç±»ï¼š</strong></p><p><a href="#code-double-checked">åŒé‡æ£€æŸ¥é” Code</a> æˆ–è€… <a href="#code-static-inner-class">é™æ€å†…éƒ¨ç±» Code</a></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DestroySingletionTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1,è·å–Singletonçš„å­—èŠ‚ç å¯¹è±¡</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token comment">//2,è·å–æ— å‚æ„é€ æ–¹æ³•å¯¹è±¡</span>        <span class="token class-name">Constructor</span> cons <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3,å–æ¶ˆè®¿é—®æ£€æŸ¥</span>        cons<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4,åˆ›å»ºSingletonå¯¹è±¡</span>        <span class="token class-name">Singleton</span> s1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">)</span> cons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Singleton</span> s2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">)</span> cons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å¦‚æœè¿”å›çš„æ˜¯trueï¼Œè¯´æ˜å¹¶æ²¡æœ‰ç ´åå•ä¾‹æ¨¡å¼ï¼Œå¦‚æœæ˜¯falseï¼Œè¯´æ˜ç ´åäº†å•ä¾‹æ¨¡å¼</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é˜²æ­¢ç ´è§£åŠæ³•">é˜²æ­¢ç ´è§£åŠæ³•</h3><h4 id="â… -åºåˆ—åŒ–ã€ååºåˆ—ç ´è§£">â…  åºåˆ—åŒ–ã€ååºåˆ—ç ´è§£</h4><p>åœ¨ Singleton ç±»ä¸­æ·»åŠ  <code>readResolve()</code> æ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶è¢«åå°„è°ƒç”¨ï¼Œå¦‚æœå®šä¹‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±è¿”å›è¿™ä¸ªæ–¹æ³•çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™è¿”å›æ–° new å‡ºæ¥çš„å¯¹è±¡ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//å®šä¹‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åœ¨å†…éƒ¨ç±»ä¸­å£°æ˜å¹¶åˆå§‹åŒ–å¤–éƒ¨ç±»çš„å¯¹è±¡</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Singleton</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æä¾›å…¬å…±çš„è®¿é—®æ–¹å¼</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å½“è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†è¯¥æ–¹æ³•çš„è¿”å›å€¼ç›´æ¥è¿”å›ğŸ‘</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æºç è§£æ</strong></p><p>ObjectInputStream ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readObject0</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readOrdinaryObject</span><span class="token punctuation">(</span>unshared<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">//åˆ¤æ–­æ˜¯å¦æœ‰ readResolve() æ–¹æ³•</span><span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>    handles<span class="token punctuation">.</span><span class="token function">lookupException</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>    desc<span class="token punctuation">.</span><span class="token function">hasReadResolveMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span> rep <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">invokeReadResolve</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="â…¡-åå°„ç ´è§£">â…¡ åå°„ç ´è§£</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token comment">//ç§æœ‰æ„é€ æ–¹æ³•</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//åˆ¤æ–­flagçš„å€¼æ˜¯å¦æ˜¯trueï¼Œå¦‚æœæ˜¯trueï¼Œè¯´æ˜éç¬¬ä¸€æ¬¡è®¿é—®ï¼Œç›´æ¥æŠ›ä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœæ˜¯falseçš„è¯ï¼Œè¯´æ˜ç¬¬ä¸€æ¬¡è®¿é—®</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ä¸èƒ½åˆ›å»ºå¤šä¸ªå¯¹è±¡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//å°†flagçš„å€¼è®¾ç½®ä¸ºtrue</span>            flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å®šä¹‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åœ¨å†…éƒ¨ç±»ä¸­å£°æ˜å¹¶åˆå§‹åŒ–å¤–éƒ¨ç±»çš„å¯¹è±¡</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Singleton</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æä¾›å…¬å…±çš„è®¿é—®æ–¹å¼</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color="red">è¯´æ˜:</font></p><p>â€‹è¿™ç§æ–¹å¼æ¯”è¾ƒå¥½ç†è§£ã€‚å½“é€šè¿‡åå°„æ–¹å¼è°ƒç”¨æ„é€ æ–¹æ³•è¿›è¡Œåˆ›å»ºåˆ›å»ºæ—¶ï¼Œç›´æ¥æŠ›å¼‚å¸¸ã€‚ä¸è¿è¡Œæ­¤ä¸­æ“ä½œã€‚</p><h2 id="4-JDK-å•ä¾‹æ¨¡å¼æ¡ˆä¾‹-Runtime">4-JDK å•ä¾‹æ¨¡å¼æ¡ˆä¾‹(Runtime)</h2><p>Runtimeç±»å°±æ˜¯ä½¿ç”¨çš„å•ä¾‹è®¾è®¡æ¨¡å¼ã€‚</p><h3 id="æºç ">æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Runtime</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Runtime</span> currentRuntime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Runtime</span> <span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> currentRuntime<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">Runtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä¸Šé¢æºä»£ç ä¸­å¯ä»¥çœ‹å‡º Runtime ç±»ä½¿ç”¨çš„æ˜¯æ¶æ±‰å¼ï¼ˆé™æ€å±æ€§ï¼‰æ–¹å¼æ¥å®ç°å•ä¾‹æ¨¡å¼çš„ã€‚</p><h3 id="ä½¿ç”¨-Runtime-ç±»ä¸­çš„æ–¹æ³•">ä½¿ç”¨ Runtime ç±»ä¸­çš„æ–¹æ³•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuntimeDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è·å–Runtimeç±»çš„å¯¹è±¡</span>        <span class="token class-name">Runtime</span> runtime <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨runtimeçš„æ–¹æ³•exec, å‚æ•°è¦çš„æ˜¯ä¸€ä¸ªå‘½ä»¤</span>        <span class="token class-name">Process</span> process <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"ipconfig"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨processå¯¹è±¡çš„è·å–è¾“å…¥æµçš„æ–¹æ³•</span>        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//100M</span>        <span class="token comment">//è¯»å–æ•°æ®</span>        <span class="token keyword">int</span> len <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿”å›è¯»åˆ°çš„å­—èŠ‚çš„ä¸ªæ•°</span>        <span class="token comment">//å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¾“å‡ºåˆ°æ§åˆ¶å°</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">,</span><span class="token string">"GBK"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-Tuning-04-JVMç›‘æ§åŠè¯Šæ–­-åˆ†æGCæ—¥å¿—</title>
      <link href="/2024/01/20/jvm-tuning4/"/>
      <url>/2024/01/20/jvm-tuning4/</url>
      
        <content type="html"><![CDATA[<h1>JVMç›‘æ§åŠè¯Šæ–­-åˆ†æGCæ—¥å¿—</h1><h2 id="01-GCæ—¥å¿—å‚æ•°">01-GCæ—¥å¿—å‚æ•°</h2><p>è§ä¸Šä¸€ç¯‡</p><h2 id="02-GCæ—¥å¿—æ ¼å¼">02-GCæ—¥å¿—æ ¼å¼</h2><p>é’ˆå¯¹ HotSpot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC æŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç§ç±»å‹ï¼šä¸€ç§æ˜¯éƒ¨åˆ†æ”¶é›†(Partial GC), ä¸€ç§æ˜¯æ•´å †æ”¶é›†(Full GC)</p><ul><li>éƒ¨åˆ†æ”¶é›†ï¼šä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJava å †çš„åƒåœ¾æ”¶é›†ã€‚å…¶ä¸­åˆåˆ†ä¸ºï¼š<ul><li>æ–°ç”Ÿä»£æ”¶é›†(Minor GC / Young GC): åªæ˜¯æ–°ç”Ÿä»£(Eden \ S0, S1)çš„åƒåœ¾æ”¶é›†</li><li>è€å¹´ä»£æ”¶é›†(Major GC / Old GC): åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚<ul><li>ç›®å‰ï¼Œåªæœ‰ CMS GC ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚</li><li>æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™ Major GC ä¼šå’Œ Full GC æ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</li></ul></li><li>æ··åˆæ”¶é›†(Mixed GC): æ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚<ul><li>ç›®å‰ï¼Œåªæœ‰G1 GCä¼šæœ‰è¿™ç§è¡Œä¸º</li></ul></li></ul></li><li>æ•´å †æ”¶é›†(Full GC):æ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li></ul><blockquote><ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼šå½“EdenåŒºæ»¡çš„æ—¶å€™å°±ä¼šè¿›è¡Œæ–°ç”Ÿä»£æ”¶é›†ï¼Œæ‰€ä»¥æ–°ç”Ÿä»£æ”¶é›†å’ŒS0åŒºåŸŸå’ŒS1åŒºåŸŸæ— å…³</li><li>è€å¹´ä»£æ”¶é›†å’Œæ–°ç”Ÿä»£æ”¶é›†çš„å…³ç³»ï¼šè¿›è¡Œè€å¹´ä»£æ”¶é›†ä¹‹å‰ä¼šå…ˆè¿›è¡Œä¸€æ¬¡å¹´è½»ä»£çš„åƒåœ¾æ”¶é›†ï¼ŒåŸå› å¦‚ä¸‹ï¼šä¸€ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡æ— æ³•æ”¾å…¥æ–°ç”Ÿä»£ï¼Œé‚£å®ƒè‡ªç„¶ä¼šå¾€è€å¹´ä»£å»æ”¾ï¼Œå¦‚æœè€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹ï¼Œé‚£ä¼šå…ˆè¿›è¡Œä¸€æ¬¡æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ï¼Œä¹‹åå°è¯•å¾€æ–°ç”Ÿä»£æ”¾ï¼Œå¦‚æœè¿˜æ˜¯æ”¾ä¸ä¸‹ï¼Œæ‰ä¼šè¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œä¹‹ååœ¨å¾€è€å¹´ä»£å»æ”¾ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œæˆ‘æ¥è¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦å¾€è€å¹´ä»£æ”¾ï¼Œä½†æ˜¯æ”¾ä¸ä¸‹ï¼Œè€Œè¿›è¡Œæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†çš„åŸå› ï¼Œè¿™æ˜¯å› ä¸ºæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†æ¯”è€å¹´ä»£åƒåœ¾æ”¶é›†æ›´åŠ ç®€å•ï¼Œè¿™æ ·åšå¯ä»¥èŠ‚çœæ€§èƒ½</li><li>è¿›è¡Œåƒåœ¾æ”¶é›†çš„æ—¶å€™ï¼Œå †åŒ…å«æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€å…ƒç©ºé—´/æ°¸ä¹…ä»£ï¼šå¯ä»¥çœ‹å‡ºHeapåé¢åŒ…å«ç€æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€å…ƒç©ºé—´ï¼Œä½†æ˜¯æˆ‘ä»¬è®¾ç½®å †ç©ºé—´å¤§å°çš„æ—¶å€™è®¾ç½®çš„åªæ˜¯æ–°ç”Ÿä»£ã€è€å¹´ä»£è€Œå·²ï¼Œå…ƒç©ºé—´æ˜¯åˆ†å¼€è®¾ç½®çš„</li><li>å“ªäº›æƒ…å†µä¼šè§¦å‘ Full GC?<ul><li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li><li>æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li><li>æ˜¾ç¤ºè°ƒç”¨ System.gc()</li><li>Minor GC è¿›å…¥è€å¹´ä»£çš„æ•°æ®çš„å¹³å‡å¤§å° &gt; è€å¹´ä»£çš„å¯ç”¨å†…å­˜</li><li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£, è€Œè€å¹´ä»£ç©ºé—´ä¸è¶³</li></ul></li></ul></blockquote><h3 id="GCæ—¥å¿—åˆ†ç±»">GCæ—¥å¿—åˆ†ç±»</h3><h4 id="MinorGC">MinorGC</h4><p>MinorGC(æˆ– Young GC YGC)æ—¥å¿—</p><p><img src="./../jvm-tuning4/image-20240120215254320.png" alt=""></p><p><img src="./../jvm-tuning4/image-20240120215425954.png" alt=""></p><h4 id="Full-GCæ—¥å¿—ä»‹ç»">Full GCæ—¥å¿—ä»‹ç»</h4><p><img src="./../jvm-tuning4/image-20240120215455431.png" alt=""></p><p><img src="./../jvm-tuning4/image-20240120215522224.png" alt=""></p><h3 id="GCæ—¥å¿—ç»“æ„å‰–æ">GCæ—¥å¿—ç»“æ„å‰–æ</h3><h4 id="åƒåœ¾æ”¶é›†å™¨">åƒåœ¾æ”¶é›†å™¨</h4><ul><li>ä½¿ç”¨ Serial æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯ Default New Generation, å› æ­¤æ˜¾ç¤ºçš„æ˜¯ â€œ[DefNewâ€</li><li>ä½¿ç”¨ ParNew æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—ä¼šå˜æˆ â€œ[ParNewâ€,æ„æ€æ˜¯ â€œParallel New Generationâ€</li><li>ä½¿ç”¨ Parallel Scavengel æ”¶é›†å™¨åœ¨æ–°ç”Ÿä»£çš„åå­—æ˜¯ â€œ[PSYoungGenâ€, è¿™é‡Œçš„ JDK1.7 ä½¿ç”¨çš„å°±æ˜¯ PSYoungGen</li><li>ä½¿ç”¨ Parallel Old Generation æ”¶é›†å™¨åœ¨è€å¹´ä»£çš„åå­—æ˜¯ â€œ[Par0ldGenâ€</li><li>ä½¿ç”¨ G1 æ”¶é›†å™¨çš„è¯ï¼Œä¼šæ˜¾ç¤ºä¸º â€œgarbage-first heapâ€</li></ul><p><strong>Allocation Failure</strong></p><p>è¡¨æ˜æœ¬æ¬¡å¼•èµ· GC çš„åŸå› æ˜¯å› ä¸ºåœ¨å¹´è½»ä»£ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´èƒ½å¤Ÿå­˜å‚¨æ–°çš„æ•°æ®äº†ã€‚</p><h4 id="GCå‰åæƒ…å†µ">GCå‰åæƒ…å†µ</h4><p>é€šè¿‡å›¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°GCæ—¥å¿—æ ¼å¼çš„è§„å¾‹ä¸€èˆ¬éƒ½æ˜¯ï¼šGCå‰å†…å­˜å ç”¨ -&gt; GC åå†…å­˜å ç”¨ï¼ˆè¯¥åŒºåŸŸå†…å­˜æ€»å¤§å°)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>PSYoungGen:5986K-<span class="token operator">></span>696K<span class="token punctuation">(</span>8704K<span class="token punctuation">)</span><span class="token punctuation">]</span>5986K-<span class="token operator">></span>704K<span class="token punctuation">(</span>9216K<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸­æ‹¬å·å†…ï¼šGC å›æ”¶å‰å¹´è½»ä»£å †å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£å †æ€»å¤§å°ï¼‰</p><p>æ‹¬å·å¤–ï¼šGC å›æ”¶å‰å¹´è½»ä»£å’Œè€å¹´ä»£å¤§å°ï¼Œå›æ”¶åå¤§å°ï¼Œï¼ˆå¹´è½»ä»£å’Œè€å¹´ä»£æ€»å¤§å°ï¼‰</p><h4 id="GCæ—¶é—´">GCæ—¶é—´</h4><p>GC æ—¥å¿—ä¸­æœ‰ä¸‰ä¸ªæ—¶é—´ï¼šuser, sys å’Œ real</p><ul><li>user - è¿›ç¨‹æ‰§è¡Œç”¨æˆ·æ€ä»£ç ï¼ˆæ ¸å¿ƒä¹‹å¤–ï¼‰æ‰€ä½¿ç”¨çš„æ—¶é—´ã€‚<strong>è¿™æ˜¯æ‰§è¡Œæ­¤è¿›ç¨‹æ‰€ä½¿ç”¨çš„å®é™… CPU æ—¶é—´</strong>ï¼Œå…¶ä»–è¿›ç¨‹å’Œæ­¤è¿›ç¨‹é˜»å¡çš„æ—¶é—´å¹¶ä¸åŒ…æ‹¬åœ¨å†…ã€‚åœ¨åƒåœ¾æ”¶é›†çš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤º GC çº¿ç¨‹æ‰§è¡Œæ‰€ä½¿ç”¨çš„ CPU æ€»æ—¶é—´ã€‚</li><li>sys - è¿›ç¨‹åœ¨å†…æ ¸æ€æ¶ˆè€—çš„ CPU æ—¶é—´ï¼Œå³<strong>åœ¨å†…æ ¸æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æˆ–ç­‰å¾…ç³»ç»Ÿäº‹ä»¶æ‰€ä½¿ç”¨çš„ CPU æ—¶é—´</strong></li><li>real - ç¨‹åºä»å¼€å§‹åˆ°ç»“æŸæ‰€ç”¨çš„æ—¶é’Ÿæ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´åŒ…æ‹¬å…¶ä»–è¿›ç¨‹ä½¿ç”¨çš„æ—¶é—´ç‰‡å’Œè¿›ç¨‹é˜»å¡çš„æ—¶é—´ï¼ˆæ¯”å¦‚ç­‰å¾… I/O å®Œæˆï¼‰ã€‚å¯¹äºå¹¶è¡Œ gc , è¿™ä¸ªæ•°å­—åº”è¯¥æ¥è¿‘ï¼ˆç”¨æˆ·æ—¶é—´ + ç³»ç»Ÿæ—¶é—´ï¼‰é™¤ä»¥åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨çš„çº¿ç¨‹æ•°ã€‚</li></ul><p>ç”±äºå¤šæ ¸çš„åŸå› ï¼Œä¸€èˆ¬çš„ GC äº‹ä»¶ä¸­ï¼Œreal time æ˜¯å°äº sys + user time çš„ï¼Œå› ä¸ºä¸€èˆ¬æ˜¯å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„å»åš GC ,æ‰€ä»¥ real time æ˜¯è¦å°äº sys + user time çš„ã€‚å¦‚æœ real &gt; sys + user çš„è¯ï¼Œåˆ™ä½ çš„åº”ç”¨å¯èƒ½å­˜åœ¨ä¸‹åˆ—é—®é¢˜ï¼šIO è´Ÿè½½éå¸¸é‡æˆ–è€…æ˜¯ CPU ä¸å¤Ÿç”¨ã€‚</p><h3 id="Minor-GC-æ—¥å¿—è§£æ">Minor GC æ—¥å¿—è§£æ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2020</span>-11-20T17:19:43.265-0800:0.822:<span class="token punctuation">[</span>GC<span class="token punctuation">(</span>ALL0CATI0 N FAILURE<span class="token punctuation">)</span> <span class="token punctuation">[</span>PSYOUNGGEN:76800K-<span class="token operator">></span>8433K<span class="token punctuation">(</span>89600K<span class="token punctuation">)</span><span class="token punctuation">]</span>76800K-<span class="token operator">></span>8449K<span class="token punctuation">(</span>294400K<span class="token punctuation">)</span>,0.0088371SECS<span class="token punctuation">]</span><span class="token punctuation">[</span>TIMES:<span class="token environment constant">USER</span><span class="token operator">=</span><span class="token number">0.02</span> <span class="token assign-left variable">SYS</span><span class="token operator">=</span><span class="token number">0.01</span>,REAL<span class="token operator">=</span><span class="token number">0.01</span> SECS<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¯¦è§£</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2020</span>-11-20T17:19:43.265-0800<span class="token comment">#æ—¥å¿—æ‰“å°æ—¶é—´ æ—¥æœŸæ ¼å¼ å¦‚2013-05-04T21:53:59.234+0800 (æ·»åŠ -XX:+PrintGCDateStampså‚æ•°)</span><span class="token number">0.822</span>:<span class="token comment">#gcå‘ç”Ÿæ—¶ï¼ŒJavaè™šæ‹Ÿæœºå¯åŠ¨ä»¥æ¥ç»è¿‡çš„ç§’æ•°</span><span class="token punctuation">[</span>GC<span class="token punctuation">(</span>Allocation Failure<span class="token punctuation">)</span><span class="token comment">#å‘ç”Ÿäº†ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œè¿™æ˜¯ä¸€æ¬¡Minior GCã€‚å®ƒä¸åŒºåˆ†æ–°ç”Ÿä»£è¿˜æ˜¯è€å¹´ä»£GCï¼Œæ‹¬å·é‡Œçš„å†…å®¹æ˜¯gcå‘ç”Ÿçš„åŸå› ï¼Œè¿™é‡Œçš„Allocation Failureçš„åŸå› æ˜¯æ–°ç”Ÿä»£ä¸­æ²¡æœ‰è¶³å¤ŸåŒºåŸŸèƒ½å¤Ÿå­˜æ”¾éœ€è¦åˆ†é…çš„æ•°æ®è€Œå¤±è´¥</span><span class="token punctuation">[</span>PSYoungGen:76800K-<span class="token operator">></span>8433K<span class="token punctuation">(</span>89600K<span class="token punctuation">)</span>PSYoungGenï¼š<span class="token comment">#è¡¨ç¤ºGCå‘ç”Ÿçš„åŒºåŸŸï¼ŒåŒºåŸŸåç§°ä¸ä½¿ç”¨çš„GCæ”¶é›†å™¨æ˜¯å¯†åˆ‡ç›¸å…³çš„</span><span class="token comment">#Serialæ”¶é›†å™¨ï¼šDefault New Generation æ˜¾ç¤ºDefnew</span><span class="token comment">#ParNewæ”¶é›†å™¨ï¼šParNew</span><span class="token comment">#Parallel Scanvengeæ”¶é›†å™¨ï¼šPSYoung</span><span class="token comment">#è€å¹´ä»£å’Œæ–°ç”Ÿä»£åŒç†ï¼Œä¹Ÿæ˜¯å’Œæ”¶é›†å™¨åç§°ç›¸å…³</span>76800K-<span class="token operator">></span>8433K<span class="token punctuation">(</span>89600K<span class="token punctuation">)</span>ï¼š<span class="token comment">#GCå‰è¯¥å†…å­˜åŒºåŸŸå·²ä½¿ç”¨å®¹é‡->GCåç›–åŒºåŸŸå®¹é‡(è¯¥åŒºåŸŸæ€»å®¹é‡)</span><span class="token comment">#å¦‚æœæ˜¯æ–°ç”Ÿä»£ï¼Œæ€»å®¹é‡åˆ™ä¼šæ˜¾ç¤ºæ•´ä¸ªæ–°ç”Ÿä»£å†…å­˜çš„9/10ï¼Œå³eden+from/toåŒº</span><span class="token comment">#å¦‚æœæ˜¯è€å¹´ä»£ï¼Œæ€»å®¹é‡åˆ™æ˜¯å…¨èº«å†…å­˜å¤§å°ï¼Œæ— å˜åŒ–</span>76800K-<span class="token operator">></span>8449K<span class="token punctuation">(</span>294400K<span class="token punctuation">)</span><span class="token comment">#åœ¨æ˜¾ç¤ºå®ŒåŒºåŸŸå®¹é‡GCçš„æƒ…å†µä¹‹åï¼Œä¼šæ¥ç€æ˜¾ç¤ºæ•´ä¸ªå †å†…å­˜åŒºåŸŸçš„GCæƒ…å†µï¼šGCå‰å †å†…å­˜å·²ä½¿ç”¨å®¹é‡->GCåå †å†…å­˜å®¹é‡ï¼ˆå †å†…å­˜æ€»å®¹é‡ï¼‰ï¼Œå¹¶ä¸”å †å†…å­˜æ€»å®¹é‡ = 9/10 æ–°ç”Ÿä»£ + è€å¹´ä»£ï¼Œç„¶åå †å†…å­˜æ€»å®¹é‡è‚¯å®šå°äºåˆå§‹åŒ–çš„å†…å­˜å¤§å°</span>,0.0088371 <span class="token comment">#æ•´ä¸ªGCæ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</span><span class="token punctuation">[</span>Timesï¼šuser<span class="token operator">=</span><span class="token number">0.02</span> <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">0.01</span>,real<span class="token operator">=</span><span class="token number">0.01</span> secs<span class="token punctuation">]</span>userï¼š<span class="token comment">#æŒ‡CPUå·¥ä½œåœ¨ç”¨æˆ·æ€æ‰€èŠ±è´¹çš„æ—¶é—´</span>sysï¼š<span class="token comment">#æŒ‡CPUå·¥ä½œåœ¨å†…æ ¸æ€æ‰€èŠ±è´¹çš„æ—¶é—´</span>realï¼š<span class="token comment">#æŒ‡åœ¨æ­¤æ¬¡äº‹ä»¶ä¸­æ‰€èŠ±è´¹çš„æ€»æ—¶é—´</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Full-GC-æ—¥å¿—è§£æ">Full GC æ—¥å¿—è§£æ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2020</span>-11-20T17:19:43.794-0800:1.351:<span class="token punctuation">[</span>FULL GC<span class="token punctuation">(</span>METADATA GC THRESH0LD<span class="token punctuation">)</span> <span class="token punctuation">[</span>PSYOUNGGEN:10082K-<span class="token operator">></span>0K<span class="token punctuation">(</span>89600K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>PAR0 LDGEN:32K-<span class="token operator">></span>9638K<span class="token punctuation">(</span>204800K<span class="token punctuation">)</span><span class="token punctuation">]</span> 10114K-<span class="token operator">></span>9638K<span class="token punctuation">(</span>294400K<span class="token punctuation">)</span>, <span class="token punctuation">[</span>METASPACE:20158K-<span class="token operator">></span>20156K<span class="token punctuation">(</span>1067008K<span class="token punctuation">)</span><span class="token punctuation">]</span>,0.0285388SECS<span class="token punctuation">]</span><span class="token punctuation">[</span>TIMES:<span class="token environment constant">USER</span><span class="token operator">=</span><span class="token number">0.11</span>,SYS<span class="token operator">=</span><span class="token number">0.00</span>,REAL<span class="token operator">=</span><span class="token number">0.03</span> SECS<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¯¦è§£</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2020</span>-11-20T17:19:43.794-0800<span class="token comment">#æ—¥å¿—æ‰“å°æ—¶é—´ æ—¥æœŸæ ¼å¼ å¦‚:2013-05-04T21:53:59.234+0800 (æ·»åŠ -XX:+PrintGCDateStampså‚æ•°)</span><span class="token number">1.351</span><span class="token comment">#gcå‘ç”Ÿæ—¶ï¼ŒJavaè™šæ‹Ÿæœºå¯åŠ¨ä»¥æ¥ç»è¿‡çš„ç§’æ•°</span>Full GC<span class="token punctuation">(</span>Metadata GCThreshold<span class="token punctuation">)</span><span class="token comment">#å‘ç”Ÿäº†ä¸€æ¬¡åƒåœ¾å›æ”¶, è¿™ä¸€æ¬¡ Full GC. å®ƒä¸åŒºåˆ†æ–°ç”Ÿä»£ GC è¿˜æ˜¯è€å¹´ä»£ GC</span><span class="token comment">#æ‹¬å·ä¸­æ˜¯ gc å‘ç”Ÿçš„åŸå› ï¼ŒåŸå› ï¼šMetaspaceåŒºä¸å¤Ÿç”¨äº†ã€‚</span><span class="token comment">#é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ç§æƒ…å†µä¼šå¼•èµ·Full GCï¼Œå¦‚ä¸‹ï¼š</span><span class="token comment">#1ã€Full GC(FErgonomics)</span><span class="token comment">#åŸå› ï¼šJVMè‡ªé€‚åº”è°ƒæ•´å¯¼è‡´çš„GC</span><span class="token comment">#2ã€Full GCï¼ˆSystemï¼‰</span><span class="token comment">#åŸå› ï¼šè°ƒç”¨äº†System.gc()æ–¹æ³•</span><span class="token punctuation">[</span>PSYoungGen: 100082K-<span class="token operator">></span>0K<span class="token punctuation">(</span>89600K<span class="token punctuation">)</span><span class="token punctuation">]</span>PSYoungGenï¼š<span class="token comment">#è¡¨ç¤ºGCå‘ç”Ÿçš„åŒºåŸŸï¼ŒåŒºåŸŸåç§°ä¸ä½¿ç”¨çš„GCæ”¶é›†å™¨æ˜¯å¯†åˆ‡ç›¸å…³çš„</span><span class="token comment">#Serialæ”¶é›†å™¨ï¼šDefault New Generation æ˜¾ç¤ºDefnew</span><span class="token comment">#ParNewæ”¶é›†å™¨ï¼šParNew</span><span class="token comment">#Parallel Scanvengeæ”¶é›†å™¨ï¼šPSYoungGen</span><span class="token comment">#è€å¹´ä»£å’Œæ–°ç”Ÿä»£åŒç†ï¼Œä¹Ÿæ˜¯å’Œæ”¶é›†å™¨åç§°ç›¸å…³</span>10082K-<span class="token operator">></span>0K<span class="token punctuation">(</span>89600K<span class="token punctuation">)</span>ï¼š<span class="token comment">#GCå‰è¯¥å†…å­˜åŒºåŸŸå·²ä½¿ç”¨å®¹é‡->GCè¯¥åŒºåŸŸå®¹é‡(è¯¥åŒºåŸŸæ€»å®¹é‡)</span><span class="token comment">#å¦‚æœæ˜¯æ–°ç”Ÿä»£ï¼Œæ€»å®¹é‡ä¼šæ˜¾ç¤ºæ•´ä¸ªæ–°ç”Ÿä»£å†…å­˜çš„9/10ï¼Œå³eden+from/toåŒº</span><span class="token comment">#å¦‚æœæ˜¯è€å¹´ä»£ï¼Œæ€»å®¹é‡åˆ™æ˜¯å…¨éƒ¨å†…å­˜å¤§å°ï¼Œæ— å˜åŒ–</span>ParOldGenï¼š32K-<span class="token operator">></span>9638K<span class="token punctuation">(</span>204800K<span class="token punctuation">)</span><span class="token comment">#è€å¹´ä»£åŒºåŸŸæ²¡æœ‰å‘ç”ŸGCï¼Œå› æ­¤æœ¬æ¬¡GCæ˜¯metaspaceå¼•èµ·çš„</span>10114K-<span class="token operator">></span>9638K<span class="token punctuation">(</span>294400K<span class="token punctuation">)</span>,<span class="token comment">#åœ¨æ˜¾ç¤ºå®ŒåŒºåŸŸå®¹é‡GCçš„æƒ…å†µä¹‹åï¼Œä¼šæ¥ç€æ˜¾ç¤ºæ•´ä¸ªå †å†…å­˜åŒºåŸŸçš„GCæƒ…å†µï¼šGCå‰å †å†…å­˜å·²ä½¿ç”¨å®¹é‡->GCåå †å†…å­˜å®¹é‡ï¼ˆå †å†…å­˜æ€»å®¹é‡ï¼‰ï¼Œå¹¶ä¸”å †å†…å­˜æ€»å®¹é‡ = 9/10 æ–°ç”Ÿä»£ + è€å¹´ä»£ï¼Œç„¶åå †å†…å­˜æ€»å®¹é‡è‚¯å®šå°äºåˆå§‹åŒ–çš„å†…å­˜å¤§å°</span><span class="token punctuation">[</span>Meatspace:20158K-<span class="token operator">></span>20156K<span class="token punctuation">(</span>1067008K<span class="token punctuation">)</span><span class="token punctuation">]</span>,<span class="token comment">#metaspace GC å›æ”¶2Kç©ºé—´</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="03-GCæ—¥å¿—åˆ†æå·¥å…·">03-GCæ—¥å¿—åˆ†æå·¥å…·</h2><h3 id="GCeasy">GCeasy</h3><p>å®˜ç½‘åœ°å€ï¼š<a href="https://gceasy.io/%EF%BC%8C">https://gceasy.io/ï¼Œ</a></p><p>GCeasy æ˜¯ä¸€æ¬¾åœ¨çº¿çš„ GC æ—¥å¿—åˆ†æå™¨ï¼Œå¯ä»¥é€šè¿‡ GC æ—¥å¿—åˆ†æè¿›è¡Œå†…å­˜æ³„æ¼æ£€æµ‹ã€GC æš‚åœåŸå› åˆ†æã€JVM é…ç½®å»ºè®®ä¼˜åŒ–ç­‰åŠŸèƒ½ï¼Œè€Œä¸”æ˜¯å¯ä»¥å…è´¹ä½¿ç”¨çš„ï¼ˆæœ‰ä¸€äº›æœåŠ¡æ˜¯æ”¶è´¹çš„)</p><p><img src="./../jvm-tuning4/image-20240120223205565.png" alt=""></p><p><img src="./../jvm-tuning4/image-20240120223312661.png" alt=""></p><h3 id="GCViewer">GCViewer</h3><ol><li><p>ä¸‹è½½GCViewerå·¥å…·</p><p>æºç ä¸‹è½½ï¼š<a href="https://github.com/chewiebug/GCViewer">https://github.com/chewiebug/GCViewer</a></p><p>è¿è¡Œç‰ˆæœ¬ä¸‹è½½ï¼š<a href="https://github.com/chewiebug/GCViewer/wiki/Changelog">https://github.com/chewiebug/GCViewer/wiki/Changelog</a></p></li><li><p>åªéœ€åŒå‡» gcviewer-1.3x.jar æˆ–è¿è¡Œ java-jar gcviewer-1.3x.jar (å®ƒéœ€è¦è¿è¡Œ java1.8vm),å³å¯å¯åŠ¨ GCViewer(gui)</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mermaid-æµç¨‹å›¾</title>
      <link href="/2024/01/20/mermaid-flowchart/"/>
      <url>/2024/01/20/mermaid-flowchart/</url>
      
        <content type="html"><![CDATA[<h1>Mermaid-æµç¨‹å›¾</h1><blockquote><p>æ‘˜å½•è‡ª <a href="https://mermaid.nodejs.cn/syntax/flowchart.html">æµç¨‹å›¾è¯­æ³• | Mermaid ä¸­æ–‡ç½‘ (nodejs.cn)</a></p></blockquote><p>æµç¨‹å›¾ç”± <strong>nodes</strong>ï¼ˆå‡ ä½•å½¢çŠ¶ï¼‰å’Œ <strong>edges</strong>ï¼ˆç®­å¤´æˆ–çº¿æ¡ï¼‰ç»„æˆã€‚ Mermaid ä»£ç å®šä¹‰äº†å¦‚ä½•åˆ¶ä½œèŠ‚ç‚¹å’Œè¾¹ï¼Œå¹¶é€‚åº”ä¸åŒçš„ç®­å¤´ç±»å‹ã€å¤šæ–¹å‘ç®­å¤´ä»¥åŠä»»ä½•ä¸å­å›¾çš„é“¾æ¥ã€‚</p><h2 id="ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé»˜è®¤ï¼‰">ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé»˜è®¤ï¼‰</h2><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">---<span class="token function"><span class="token prefix">title<span class="token punctuation">:</span></span></span> Node---flowchart LR    id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">---title: Node---flowchart LR    id</pre><h2 id="å¸¦æœ‰æ–‡æœ¬çš„èŠ‚ç‚¹">å¸¦æœ‰æ–‡æœ¬çš„èŠ‚ç‚¹</h2><p>ä¹Ÿå¯ä»¥åœ¨æ¡†ä¸­è®¾ç½®ä¸ id ä¸åŒçš„æ–‡æœ¬ã€‚ å¦‚æœæ‰§è¡Œæ­¤æ“ä½œå¤šæ¬¡ï¼Œåˆ™å®ƒå°†æ˜¯ä¸ºè¦ä½¿ç”¨çš„èŠ‚ç‚¹æ‰¾åˆ°çš„æœ€åä¸€ä¸ªæ–‡æœ¬ã€‚ æ­¤å¤–ï¼Œå¦‚æœç¨åä¸ºèŠ‚ç‚¹å®šä¹‰è¾¹ï¼Œåˆ™å¯ä»¥çœç•¥æ–‡æœ¬å®šä¹‰ã€‚ æ¸²æŸ“ç›’å­æ—¶å°†ä½¿ç”¨å…ˆå‰å®šä¹‰çš„å€¼ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">---<span class="token function"><span class="token prefix">title<span class="token punctuation">:</span></span></span> Node with text---flowchart LR    id1<span class="token punctuation">[</span>This is the text in the box<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">---title: Node with text---flowchart LR    id1[This is the text in the box]</pre><h3 id="ç»Ÿä¸€ç æ–‡æœ¬">ç»Ÿä¸€ç æ–‡æœ¬</h3><p>ä½¿ç”¨ <code>&quot;</code> å°† unicode æ–‡æœ¬æ‹¬èµ·æ¥ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id<span class="token punctuation">[</span><span class="token string">"This â¤ Unicode"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id["This â¤ Unicode"]</pre><h3 id="Markdown-æ ¼å¼">Markdown æ ¼å¼</h3><p>ä½¿ç”¨åŒå¼•å·å’Œåå¼•å· â€œ<code>text</code>â€ å°† Markdown æ–‡æœ¬æ‹¬èµ·æ¥ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">%%<span class="token punctuation">&#123;</span><span class="token function"><span class="token prefix">init<span class="token punctuation">:</span></span></span> <span class="token punctuation">&#123;</span><span class="token string">"flowchart"</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token punctuation">&#123;</span><span class="token string">"htmlLabels"</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>%%flowchart LR    markdown<span class="token punctuation">[</span><span class="token string">"`This **is** _Markdown_`"</span><span class="token punctuation">]</span>    newLines<span class="token punctuation">[</span>"`Line1    Line <span class="token number">2</span>    Line <span class="token number">3</span>`"<span class="token punctuation">]</span>    markdown --> newLines<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">%%{init: {"flowchart": {"htmlLabels": false}} }%%flowchart LR    markdown["`This **is** _Markdown_`"]    newLines["`Line1    Line 2    Line 3`"]    markdown --> newLines</pre><h2 id="æ–¹å‘">æ–¹å‘</h2><p>è¯¥è¯­å¥å£°æ˜äº†æµç¨‹å›¾çš„æ–¹å‘ã€‚</p><p>è¿™å£°æ˜æµç¨‹å›¾æ˜¯ä»ä¸Šåˆ°ä¸‹ï¼ˆ<code>TD</code> æˆ– <code>TB</code>ï¼‰çš„ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    Start --> Stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    Start --> Stop</pre><p>è¿™å£°æ˜æµç¨‹å›¾æ˜¯ä»å·¦åˆ°å³å®šå‘çš„ (<code>LR</code>)ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    Start --> Stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    Start --> Stop</pre><p>å¯èƒ½çš„æµç¨‹å›¾æ–¹å‘æ˜¯ï¼š</p><ul><li>TB - ä»ä¸Šåˆ°ä¸‹</li><li>TD - è‡ªä¸Šè€Œä¸‹/ä¸è‡ªä¸Šè€Œä¸‹ç›¸åŒ</li><li>BT - ä»ä¸‹åˆ°ä¸Š</li><li>RL - ä»å³åˆ°å·¦</li><li>LR - ä»å·¦åˆ°å³</li></ul><h2 id="èŠ‚ç‚¹å½¢çŠ¶">èŠ‚ç‚¹å½¢çŠ¶</h2><p>å…·æœ‰åœ†è¾¹çš„èŠ‚ç‚¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">(</span>This is the text in the box<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1(This is the text in the box)</pre><p>ä½“è‚²åœºå½¢çŠ¶çš„èŠ‚ç‚¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">(</span><span class="token punctuation">[</span>This is the text in the box<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1([This is the text in the box])</pre><p>å­ç¨‹åºå½¢çŠ¶ä¸­çš„èŠ‚ç‚¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">[</span><span class="token punctuation">[</span>This is the text in the box<span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1[[This is the text in the box]]</pre><p>åœ†æŸ±å½¢èŠ‚ç‚¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">[</span><span class="token punctuation">(</span>Database<span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1[(Database)]</pre><p>ä¸€ä¸ªåœ†å½¢çš„èŠ‚ç‚¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">(</span><span class="token punctuation">(</span>This is the text in the circle<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1((This is the text in the circle))</pre><p>å½¢çŠ¶ä¸å¯¹ç§°çš„èŠ‚ç‚¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1>This is the text in the box<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1>This is the text in the box]</pre><p>ç›®å‰åªæœ‰ä¸Šé¢çš„å½¢çŠ¶æ˜¯å¯èƒ½çš„ï¼Œè€Œä¸æ˜¯å®ƒçš„é•œåƒã€‚ è¿™å¯èƒ½ä¼šéšç€æœªæ¥çš„ç‰ˆæœ¬è€Œæ”¹å˜ã€‚</p><p>èŠ‚ç‚¹ï¼ˆè±å½¢ï¼‰</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">&#123;</span>This is the text in the box<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1{This is the text in the box}</pre><p>å…­è¾¹å½¢èŠ‚ç‚¹</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> This is the text in the box <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>æ­¤å¤„æ¸²æŸ“ä¼šæŠ¥é”™</p></blockquote><p>å¹³è¡Œå››è¾¹å½¢</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    id1<span class="token punctuation">[</span>/This is the text in the box/<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    id1[/This is the text in the box/]</pre><p>å¹³è¡Œå››è¾¹å½¢ alt</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    id1<span class="token punctuation">[</span>\This is the text in the box\<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    id1[\This is the text in the box\]</pre><p>æ¢¯å½¢</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    A<span class="token punctuation">[</span>/Christmas\<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    A[/Christmas\]</pre><p>æ¢¯å½¢ alt</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    B<span class="token punctuation">[</span>\Go shopping/<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    B[\Go shopping/]</pre><p>åŒåœˆ</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    id1<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>This is the text in the circle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    id1(((This is the text in the circle)))</pre><h2 id="èŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥">èŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥</h2><p>èŠ‚ç‚¹å¯ä»¥é€šè¿‡é“¾æ¥/è¾¹è¿æ¥ã€‚ å¯ä»¥æœ‰ä¸åŒç±»å‹çš„é“¾æ¥æˆ–å°†æ–‡æœ¬å­—ç¬¦ä¸²é™„åŠ åˆ°é“¾æ¥ã€‚</p><h3 id="å¸¦ç®­å¤´çš„é“¾æ¥">å¸¦ç®­å¤´çš„é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A-->B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A-->B</pre><h3 id="ä¸€ä¸ªæ‰“å¼€çš„é“¾æ¥">ä¸€ä¸ªæ‰“å¼€çš„é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A --- B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A --- B</pre><h3 id="é“¾æ¥ä¸Šçš„æ–‡æœ¬">é“¾æ¥ä¸Šçš„æ–‡æœ¬</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A-- This is the text! ---B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A-- This is the text! ---B</pre><p>or</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A---|This is the text|B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A---|This is the text|B</pre><h3 id="å¸¦æœ‰ç®­å¤´å’Œæ–‡æœ¬çš„é“¾æ¥">å¸¦æœ‰ç®­å¤´å’Œæ–‡æœ¬çš„é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A-->|text|B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A-->|text|B</pre><p>or</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A-- text -->B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A-- text -->B</pre><h3 id="è™šçº¿é“¾æ¥">è™šçº¿é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR   A-<span class="token punctuation">.</span>->B<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR   A-.->B;</pre><h3 id="å¸¦æ–‡æœ¬çš„è™šçº¿é“¾æ¥">å¸¦æ–‡æœ¬çš„è™šçº¿é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR   A-<span class="token punctuation">.</span> text <span class="token punctuation">.</span>-> B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR   A-. text .-> B</pre><h3 id="ç²—é“¾æ¥">ç²—é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR   A <span class="token keyword">=</span><span class="token keyword">=</span>> B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR   A ==> B</pre><h3 id="å¸¦æ–‡æœ¬çš„ç²—é“¾æ¥">å¸¦æ–‡æœ¬çš„ç²—é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR   A <span class="token keyword">=</span><span class="token keyword">=</span> text <span class="token keyword">=</span><span class="token keyword">=</span>> B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR   A == text ==> B</pre><h3 id="çœ‹ä¸è§çš„é“¾æ¥">çœ‹ä¸è§çš„é“¾æ¥</h3><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A ~~~ B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A ~~~ B</pre><h3 id="é“¾æ¥çš„é“¾æ¥">é“¾æ¥çš„é“¾æ¥</h3><p>å¯ä»¥åœ¨åŒä¸€è¡Œä¸­å£°æ˜å¤šä¸ªé“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR   A -- text --> B -- text2 --> C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR   A -- text --> B -- text2 --> C</pre><p>è¿˜å¯ä»¥åœ¨åŒä¸€è¡Œä¸­å£°æ˜å¤šä¸ªèŠ‚ç‚¹é“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR   <span class="token keyword">a</span> --> b &amp; c--> d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR   a --> b & c--> d</pre><p>ç„¶åï¼Œä½ å¯ä»¥ä»¥éå¸¸å¯Œæœ‰è¡¨ç°åŠ›çš„æ–¹å¼æè¿°ä¾èµ–ã€‚ å°±åƒä¸‹é¢çš„ä¸€è¡Œå­—ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TB    A &amp; B--> C &amp; D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TB    A & B--> C & D</pre><p>å¦‚æœä½¿ç”¨åŸºæœ¬è¯­æ³•æè¿°åŒä¸€ä¸ªå›¾ï¼Œåˆ™éœ€è¦å››è¡Œã€‚ è­¦å‘Šä¸€å¥ï¼Œè¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´æµç¨‹å›¾æ›´éš¾ä»¥ Markdown å½¢å¼é˜…è¯»ã€‚ æˆ‘æƒ³åˆ°äº†ç‘å…¸è¯­â€œ<code>lagom</code>â€ã€‚ æ„æ€æ˜¯ï¼Œä¸èƒ½å¤ªå¤šï¼Œä¹Ÿä¸èƒ½å¤ªå°‘ã€‚ è¿™ä¹Ÿé€‚ç”¨äºè¡¨è¾¾è¯­æ³•ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TB    A --> C    A --> D    B --> C    B --> D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TB    A --> C    A --> D    B --> C    B --> D</pre><h3 id="æ–°çš„ç®­å¤´ç±»å‹">æ–°çš„ç®­å¤´ç±»å‹</h3><p>æ”¯æŒä»¥ä¸‹æ–°ç±»å‹çš„ç®­å¤´ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A --o B    B --x C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A --o B    B --x C</pre><h3 id="å¤šæ–¹å‘ç®­å¤´">å¤šæ–¹å‘ç®­å¤´</h3><p>å¯ä»¥ä½¿ç”¨å¤šå‘ç®­å¤´ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A o--o B    B <span class="token url"><span class="token punctuation">&lt;</span>--<span class="token punctuation">></span></span> C    C x--x D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A o--o B    B <--> C    C x--x D</pre><h3 id="é“¾æ¥çš„æœ€å°é•¿åº¦">é“¾æ¥çš„æœ€å°é•¿åº¦</h3><p>æµç¨‹å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æœ€ç»ˆæ ¹æ®å…¶é“¾æ¥åˆ°çš„èŠ‚ç‚¹åˆ†é…ç»™æ¸²æŸ“å›¾ä¸­çš„ä¸€ä¸ªç­‰çº§ï¼Œå³å‚ç›´æˆ–æ°´å¹³çº§åˆ«ï¼ˆå–å†³äºæµç¨‹å›¾æ–¹å‘ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé“¾æ¥å¯ä»¥è·¨è¶Šä»»æ„æ•°é‡çš„ç­‰çº§ï¼Œä½†ä½ å¯ä»¥é€šè¿‡åœ¨é“¾æ¥å®šä¹‰ä¸­æ·»åŠ é¢å¤–çš„ç ´æŠ˜å·æ¥è¦æ±‚ä»»ä½•é“¾æ¥æ¯”å…¶ä»–é“¾æ¥æ›´é•¿ã€‚</p><p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œåœ¨ä»èŠ‚ç‚¹ B åˆ°èŠ‚ç‚¹ E çš„é“¾æ¥ä¸­æ·»åŠ äº†ä¸¤ä¸ªé¢å¤–çš„ç ´æŠ˜å·ï¼Œä»¥ä¾¿å®ƒæ¯”å¸¸è§„é“¾æ¥å¤šè·¨è¶Šä¸¤ä¸ªç­‰çº§ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    A<span class="token punctuation">[</span>Start<span class="token punctuation">]</span> --> B<span class="token punctuation">&#123;</span>Is it?<span class="token punctuation">&#125;</span>    B -->|Yes| C<span class="token punctuation">[</span>OK<span class="token punctuation">]</span>    C --> D<span class="token punctuation">[</span>Rethink<span class="token punctuation">]</span>    D --> B    B ---->|No| E<span class="token punctuation">[</span>End<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    A[Start] --> B{Is it?}    B -->|Yes| C[OK]    C --> D[Rethink]    D --> B    B ---->|No| E[End]</pre><blockquote><p><strong>æ³¨æ„</strong> é“¾æ¥ä»å¯èƒ½æ¯”æ¸²æŸ“å¼•æ“æ‰€è¯·æ±‚çš„ç­‰çº§æ•°æ›´é•¿ï¼Œä»¥é€‚åº”å…¶ä»–è¯·æ±‚ã€‚</p></blockquote><p>å½“é“¾æ¥æ ‡ç­¾å†™åœ¨é“¾æ¥ä¸­é—´æ—¶ï¼Œå¿…é¡»åœ¨é“¾æ¥å³ä¾§æ·»åŠ é¢å¤–çš„ç ´æŠ˜å·ã€‚ ä»¥ä¸‹ç¤ºä¾‹ä¸ä¸Šä¸€ä¸ªç¤ºä¾‹ç­‰æ•ˆï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    A<span class="token punctuation">[</span>Start<span class="token punctuation">]</span> --> B<span class="token punctuation">&#123;</span>Is it?<span class="token punctuation">&#125;</span>    B -- Yes --> C<span class="token punctuation">[</span>OK<span class="token punctuation">]</span>    C --> D<span class="token punctuation">[</span>Rethink<span class="token punctuation">]</span>    D --> B    B -- No ----> E<span class="token punctuation">[</span>End<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    A[Start] --> B{Is it?}    B -- Yes --> C[OK]    C --> D[Rethink]    D --> B    B -- No ----> E[End]</pre><p>å¯¹äºç‚¹é“¾æ¥æˆ–ç²—é“¾æ¥ï¼Œè¦æ·»åŠ çš„å­—ç¬¦æ˜¯ç­‰å·æˆ–ç‚¹ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th style="text-align:left">é•¿åº¦</th><th style="text-align:center">1</th><th style="text-align:center">2</th><th style="text-align:center">3</th></tr></thead><tbody><tr><td style="text-align:left">æ™®é€šçš„</td><td style="text-align:center"><code>---</code></td><td style="text-align:center"><code>----</code></td><td style="text-align:center"><code>-----</code></td></tr><tr><td style="text-align:left">æ­£å¸¸å¸¦ç®­å¤´</td><td style="text-align:center"><code>--&gt;</code></td><td style="text-align:center"><code>---&gt;</code></td><td style="text-align:center"><code>----&gt;</code></td></tr><tr><td style="text-align:left">åšçš„</td><td style="text-align:center"><code>===</code></td><td style="text-align:center"><code>====</code></td><td style="text-align:center"><code>=====</code></td></tr><tr><td style="text-align:left">ç²—å¸¦ç®­å¤´</td><td style="text-align:center"><code>==&gt;</code></td><td style="text-align:center"><code>===&gt;</code></td><td style="text-align:center"><code>====&gt;</code></td></tr><tr><td style="text-align:left">ç‚¹çŠ¶</td><td style="text-align:center"><code>-.-</code></td><td style="text-align:center"><code>-..-</code></td><td style="text-align:center"><code>-...-</code></td></tr><tr><td style="text-align:left">å¸¦æœ‰ç®­å¤´çš„è™šçº¿</td><td style="text-align:center"><code>-.-&gt;</code></td><td style="text-align:center"><code>-..-&gt;</code></td><td style="text-align:center"><code>-...-&gt;</code></td></tr></tbody></table><h2 id="ç ´åè¯­æ³•çš„ç‰¹æ®Šå­—ç¬¦">ç ´åè¯­æ³•çš„ç‰¹æ®Šå­—ç¬¦</h2><p>å¯ä»¥å°†æ–‡æœ¬æ”¾åœ¨å¼•å·å†…ä»¥æ¸²æŸ“æ›´éº»çƒ¦çš„å­—ç¬¦ã€‚ å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">[</span><span class="token string">"This is the (text) in the box"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1["This is the (text) in the box"]</pre><h3 id="ç”¨äºè½¬ä¹‰å­—ç¬¦çš„å®ä½“ä»£ç ">ç”¨äºè½¬ä¹‰å­—ç¬¦çš„å®ä½“ä»£ç </h3><p>å¯ä»¥ä½¿ç”¨æ­¤å¤„ç¤ºä¾‹çš„è¯­æ³•å¯¹å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LRA<span class="token punctuation">[</span><span class="token string">"A double quote:#quot;"</span><span class="token punctuation">]</span> --> B<span class="token punctuation">[</span><span class="token string">"A dec char:#9829;"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LRA["A double quote:#quot;"] --> B["A dec char:#9829;"]</pre><p>ç»™å‡ºçš„æ•°å­—ä»¥ 10 ä¸ºåŸºæ•°ï¼Œå› æ­¤ <code>#</code> å¯ä»¥ç¼–ç ä¸º <code>#35;</code>ã€‚ è¿˜æ”¯æŒä½¿ç”¨ HTML å­—ç¬¦åç§°ã€‚</p><h2 id="å­å›¾">å­å›¾</h2><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TB    c1-->a2    subgraph one    a1-->a2    end    subgraph two    b1-->b2    end    subgraph three    c1-->c2    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TB    c1-->a2    subgraph one    a1-->a2    end    subgraph two    b1-->b2    end    subgraph three    c1-->c2    end</pre><p>ä½ è¿˜å¯ä»¥ä¸ºå­å›¾è®¾ç½®æ˜¾å¼ idã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TB    c1-->a2    subgraph ide1 <span class="token punctuation">[</span>one<span class="token punctuation">]</span>    a1-->a2    end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TB    c1-->a2    subgraph ide1 [one]    a1-->a2    end</pre><h3 id="æµç¨‹å›¾">æµç¨‹å›¾</h3><p>ä½¿ç”¨å›¾å½¢ç±»å‹æµç¨‹å›¾ï¼Œè¿˜å¯ä»¥è®¾ç½®å­å›¾çš„è¾¹å’Œå­å›¾çš„è¾¹ï¼Œå¦‚ä¸‹æµç¨‹å›¾æ‰€ç¤ºã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TB    c1-->a2    subgraph one    a1-->a2    end    subgraph two    b1-->b2    end    subgraph three    c1-->c2    end    one --> two    three --> two    two --> c2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TB    c1-->a2    subgraph one    a1-->a2    end    subgraph two    b1-->b2    end    subgraph three    c1-->c2    end    one --> two    three --> two    two --> c2</pre><h3 id="å­å›¾ä¸­çš„æ–¹å‘">å­å›¾ä¸­çš„æ–¹å‘</h3><p>ä½¿ç”¨ graphtype æµç¨‹å›¾ï¼Œä½ å¯ä»¥ä½¿ç”¨æ–¹å‘è¯­å¥æ¥è®¾ç½®å­å›¾æ¸²æŸ“çš„æ–¹å‘ï¼Œå¦‚æœ¬ä¾‹æ‰€ç¤ºã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR  subgraph TOP    direction TB    subgraph B1        direction RL        i1 -->f1    end    subgraph B2        direction BT        i2 -->f2    end  end  A --> TOP --> B  B1 --> B2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR  subgraph TOP    direction TB    subgraph B1        direction RL        i1 -->f1    end    subgraph B2        direction BT        i2 -->f2    end  end  A --> TOP --> B  B1 --> B2</pre><h4 id="å±€é™æ€§">å±€é™æ€§</h4><p>å¦‚æœä»»ä½•å­å›¾çš„èŠ‚ç‚¹é“¾æ¥åˆ°å¤–éƒ¨ï¼Œåˆ™å­å›¾æ–¹å‘å°†è¢«å¿½ç•¥ã€‚ ç›¸åï¼Œå­å›¾å°†ç»§æ‰¿çˆ¶å›¾çš„æ–¹å‘ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    subgraph subgraph1        direction TB        top1<span class="token punctuation">[</span>top<span class="token punctuation">]</span> --> bottom1<span class="token punctuation">[</span>bottom<span class="token punctuation">]</span>    end    subgraph subgraph2        direction TB        top2<span class="token punctuation">[</span>top<span class="token punctuation">]</span> --> bottom2<span class="token punctuation">[</span>bottom<span class="token punctuation">]</span>    end    %% ^ These subgraphs are identical<span class="token punctuation">,</span> except for the links to <span class="token function"><span class="token prefix">them<span class="token punctuation">:</span></span></span>    %% Link *to* <span class="token function"><span class="token prefix">subgraph1<span class="token punctuation">:</span></span></span> subgraph1 direction is maintained    outside --> subgraph1    %% Link *within* <span class="token function"><span class="token prefix">subgraph2<span class="token punctuation">:</span></span></span>    %% subgraph2 inherits the direction of the top-level <span class="token keyword">graph</span> <span class="token punctuation">(</span>LR<span class="token punctuation">)</span>    outside ---> top2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    subgraph subgraph1        direction TB        top1[top] --> bottom1[bottom]    end    subgraph subgraph2        direction TB        top2[top] --> bottom2[bottom]    end    %% ^ These subgraphs are identical, except for the links to them:    %% Link *to* subgraph1: subgraph1 direction is maintained    outside --> subgraph1    %% Link *within* subgraph2:    %% subgraph2 inherits the direction of the top-level graph (LR)    outside ---> top2</pre><h2 id="Markdown-å­—ç¬¦ä¸²">Markdown å­—ç¬¦ä¸²</h2><p>â€œMarkdown å­—ç¬¦ä¸²â€ åŠŸèƒ½é€šè¿‡æä¾›æ›´é€šç”¨çš„å­—ç¬¦ä¸²ç±»å‹æ¥å¢å¼ºæµç¨‹å›¾å’Œæ€ç»´å¯¼å›¾ï¼Œè¯¥å­—ç¬¦ä¸²ç±»å‹æ”¯æŒç²—ä½“å’Œæ–œä½“ç­‰æ–‡æœ¬æ ¼å¼é€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨å°†æ–‡æœ¬æ¢è¡Œåœ¨æ ‡ç­¾å†…ã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">%%<span class="token punctuation">&#123;</span><span class="token function"><span class="token prefix">init<span class="token punctuation">:</span></span></span> <span class="token punctuation">&#123;</span><span class="token string">"flowchart"</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token punctuation">&#123;</span><span class="token string">"htmlLabels"</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>%%flowchart LRsubgraph <span class="token string">"One"</span>  <span class="token keyword">a</span><span class="token punctuation">(</span>"`The **cat**  in the hat`<span class="token string">") -- "</span>edge label<span class="token string">" --> b>"</span>`The **dog** in the hog`"<span class="token punctuation">]</span>endsubgraph <span class="token string">"`**Two**`"</span>  c<span class="token punctuation">(</span>"`The **cat**  in the hat`<span class="token string">") -- "</span>`Bold **edge label**`<span class="token string">" --> d("</span>The dog in the hog"<span class="token punctuation">)</span>end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">%%{init: {"flowchart": {"htmlLabels": false}} }%%flowchart LRsubgraph "One"  a("`The **cat**  in the hat`") -- "edge label" --> b>"`The **dog** in the hog`"]endsubgraph "`**Two**`"  c("`The **cat**  in the hat`") -- "`Bold **edge label**`" --> d("The dog in the hog")end</pre><p>æ ¼å¼è®¾ç½®ï¼š</p><ul><li>å¯¹äºç²—ä½“æ–‡æœ¬ï¼Œè¯·åœ¨æ–‡æœ¬å‰åä½¿ç”¨åŒæ˜Ÿå· (<code>**</code>)ã€‚</li><li>å¯¹äºæ–œä½“ï¼Œè¯·åœ¨æ–‡æœ¬å‰åä½¿ç”¨å•ä¸ªæ˜Ÿå· (<code>*</code>)ã€‚</li><li>å¯¹äºä¼ ç»Ÿå­—ç¬¦ä¸²ï¼Œä½ éœ€è¦æ·»åŠ  <code>&lt;br&gt;</code> æ ‡ç­¾ä»¥ä½¿æ–‡æœ¬æ¢è¡Œåœ¨èŠ‚ç‚¹ä¸­ã€‚ ä½†æ˜¯ï¼Œå½“æ–‡æœ¬å˜å¾—å¤ªé•¿æ—¶ï¼ŒMarkdown å­—ç¬¦ä¸²ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œå¹¶å…è®¸ä½ åªéœ€ä½¿ç”¨æ¢è¡Œç¬¦è€Œä¸æ˜¯ <code>&lt;br&gt;</code> æ ‡è®°æ¥å¼€å§‹æ–°è¡Œã€‚</li></ul><p>æ­¤åŠŸèƒ½é€‚ç”¨äºèŠ‚ç‚¹æ ‡ç­¾ã€è¾¹æ ‡ç­¾å’Œå­å›¾æ ‡ç­¾ã€‚</p><h2 id="ç›¸äº’ä½œç”¨">ç›¸äº’ä½œç”¨</h2><p>å¯ä»¥å°†å•å‡»äº‹ä»¶ç»‘å®šåˆ°èŠ‚ç‚¹ï¼Œå•å‡»å¯ä»¥å¯¼è‡´ JavaScript å›è°ƒ(demoç•¥)æˆ–å°†åœ¨æ–°æµè§ˆå™¨é€‰é¡¹å¡ä¸­æ‰“å¼€çš„é“¾æ¥ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    A-->B    B-->C    C-->D    D-->E    click A <span class="token string">"https://www.github.com"</span> _blank    click B <span class="token string">"https://www.github.com"</span> <span class="token string">"Open this in a new tab"</span> _blank    click C href <span class="token string">"https://www.github.com"</span> _blank    click D href <span class="token string">"https://www.github.com"</span> <span class="token string">"Open this in a new tab"</span> _blank<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A-->B    B-->C    C-->D    D-->E    click A "https://www.github.com" _blank    click B "https://www.github.com" "Open this in a new tab" _blank    click C href "https://www.github.com" _blank    click D href "https://www.github.com" "Open this in a new tab" _blank</pre><h3 id="æ³¨é‡Š">æ³¨é‡Š</h3><p>å¯ä»¥åœ¨æµç¨‹å›¾ä¸­è¾“å…¥æ³¨é‡Šï¼Œè§£æå™¨å°†å¿½ç•¥è¿™äº›æ³¨é‡Šã€‚ æ³¨é‡Šéœ€è¦ç‹¬å ä¸€è¡Œï¼Œå¹¶ä¸”å¿…é¡»ä»¥ <code>%%</code>ï¼ˆåŒç™¾åˆ†å·ï¼‰å¼€å¤´ã€‚ æ³¨é‡Šå¼€å§‹ååˆ°ä¸‹ä¸€ä¸ªæ¢è¡Œç¬¦çš„ä»»ä½•æ–‡æœ¬éƒ½å°†è¢«è§†ä¸ºæ³¨é‡Šï¼ŒåŒ…æ‹¬ä»»ä½•æµè¯­æ³•</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR%% this is <span class="token keyword">a</span> comment A -- text --> B<span class="token punctuation">&#123;</span>node<span class="token punctuation">&#125;</span>   A -- text --> B -- text2 --> C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR%% this is a comment A -- text --> B{node}   A -- text --> B -- text2 --> C</pre><h2 id="æ ·å¼å’Œç±»åˆ«">æ ·å¼å’Œç±»åˆ«</h2><h3 id="è®¾ç½®é“¾æ¥æ ·å¼">è®¾ç½®é“¾æ¥æ ·å¼</h3><p>å¯ä»¥è®¾ç½®é“¾æ¥æ ·å¼ã€‚ ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦è®¾è®¡ä¸€ä¸ªåœ¨æµç¨‹ä¸­å‘åç§»åŠ¨çš„é“¾æ¥ã€‚ ç”±äºé“¾æ¥æ²¡æœ‰åƒèŠ‚ç‚¹ä¸€æ ·çš„ idï¼Œå› æ­¤éœ€è¦å…¶ä»–ä¸€äº›æ–¹æ³•æ¥å†³å®šé“¾æ¥åº”é™„åŠ åˆ°ä»€ä¹ˆæ ·å¼ã€‚ ä½¿ç”¨å›¾è¡¨ä¸­å®šä¹‰é“¾æ¥æ—¶çš„é¡ºåºå·æ¥ä»£æ›¿ idsï¼Œæˆ–è€…ä½¿ç”¨é»˜è®¤å€¼åº”ç”¨äºæ‰€æœ‰é“¾æ¥ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼ŒlinkStyle è¯­å¥ä¸­å®šä¹‰çš„æ ·å¼å°†å±äºå›¾ä¸­çš„ç¬¬å››ä¸ªé“¾æ¥ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">linkStyle <span class="token number">3</span> <span class="token function"><span class="token prefix">stroke<span class="token punctuation">:</span></span></span><span class="token comment">#ff3,stroke-width:4px,color:red;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿˜å¯ä»¥é€šè¿‡ç”¨é€—å·åˆ†éš”é“¾æ¥ç¼–å·ï¼Œåœ¨å•ä¸ªè¯­å¥ä¸­å‘å¤šä¸ªé“¾æ¥æ·»åŠ æ ·å¼ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">linkStyle <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token function"><span class="token prefix">color<span class="token punctuation">:</span></span><span class="token local-name">blue</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ ·å¼çº¿æ¡æ›²çº¿">æ ·å¼çº¿æ¡æ›²çº¿</h3><p>å¦‚æœé»˜è®¤æ–¹æ³•ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œå¯ä»¥è®¾ç½®ç”¨äºé¡¹ç›®ä¹‹é—´çº¿æ¡çš„æ›²çº¿ç±»å‹çš„æ ·å¼ã€‚ å¯ç”¨çš„æ›²çº¿æ ·å¼åŒ…æ‹¬ <code>basis</code>ã€<code>bumpX</code>ã€<code>bumpY</code>ã€<code>cardinal</code>ã€<code>catmullRom</code>ã€<code>linear</code>ã€<code>monotoneX</code>ã€<code>monotoneY</code>ã€<code>natural</code>ã€<code>step</code>ã€<code>stepAfter</code> å’Œ <code>stepBefore</code>ã€‚</p><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä»å·¦åˆ°å³çš„å›¾è¡¨ä½¿ç”¨ <code>stepBefore</code> æ›²çº¿æ ·å¼ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">%%<span class="token punctuation">&#123;</span> <span class="token function"><span class="token prefix">init<span class="token punctuation">:</span></span></span> <span class="token punctuation">&#123;</span> <span class="token string">'flowchart'</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token punctuation">&#123;</span> <span class="token string">'curve'</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token string">'stepBefore'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>%%<span class="token keyword">graph</span> LR<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æœ‰å…³å¯ç”¨æ›²çº¿çš„å®Œæ•´åˆ—è¡¨ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰æ›²çº¿çš„è¯´æ˜ï¼Œè¯·å‚é˜… <a href="https://github.com/d3/d3-shape/">d3-shape</a> é¡¹ç›®ä¸­çš„ <a href="https://github.com/d3/d3-shape/blob/main/README.md#curves">å½¢çŠ¶</a> æ–‡æ¡£ã€‚</p><h3 id="è®¾ç½®èŠ‚ç‚¹æ ·å¼">è®¾ç½®èŠ‚ç‚¹æ ·å¼</h3><p>å¯ä»¥å¯¹èŠ‚ç‚¹åº”ç”¨ç‰¹å®šæ ·å¼ï¼Œä¾‹å¦‚è¾ƒç²—çš„è¾¹æ¡†æˆ–ä¸åŒçš„èƒŒæ™¯é¢œè‰²ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    id1<span class="token punctuation">(</span>Start<span class="token punctuation">)</span>-->id2<span class="token punctuation">(</span>Stop<span class="token punctuation">)</span>    style id1 <span class="token function"><span class="token prefix">fill<span class="token punctuation">:</span></span></span><span class="token comment">#f9f,stroke:#333,stroke-width:4px</span>    style id2 <span class="token function"><span class="token prefix">fill<span class="token punctuation">:</span></span></span><span class="token comment">#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    id1(Start)-->id2(Stop)    style id1 fill:#f9f,stroke:#333,stroke-width:4px    style id2 fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5</pre><h4 id="ç±»">ç±»</h4><p>æ¯”æ¯æ¬¡å®šä¹‰æ ·å¼æ›´æ–¹ä¾¿çš„æ˜¯å®šä¹‰ä¸€ç±»æ ·å¼å¹¶å°†è¯¥ç±»é™„åŠ åˆ°åº”è¯¥å…·æœ‰ä¸åŒå¤–è§‚çš„èŠ‚ç‚¹ã€‚</p><p>ç±»å®šä¹‰å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDef className <span class="token function"><span class="token prefix">fill<span class="token punctuation">:</span></span></span><span class="token comment">#f9f,stroke:#333,stroke-width:4px;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨ä¸€æ¡è¯­å¥ä¸­ä¸ºå¤šä¸ªç±»å®šä¹‰æ ·å¼ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDef firstClassName<span class="token punctuation">,</span>secondClassName <span class="token function"><span class="token prefix">font-size<span class="token punctuation">:</span></span><span class="token local-name">12pt</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°†ç±»é™„åŠ åˆ°èŠ‚ç‚¹çš„æ“ä½œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">class nodeId1 className<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿˜å¯ä»¥åœ¨ä¸€æ¡è¯­å¥ä¸­å°†ä¸€ä¸ªç±»é™„åŠ åˆ°èŠ‚ç‚¹åˆ—è¡¨ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">class nodeId1<span class="token punctuation">,</span>nodeId2 className<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ·»åŠ ç±»çš„ä¸€ç§è¾ƒçŸ­å½¢å¼æ˜¯ä½¿ç”¨ <code>:::</code> è¿ç®—ç¬¦å°†ç±»åé™„åŠ åˆ°èŠ‚ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    <span class="token function"><span class="token prefix">A<span class="token punctuation">:</span></span><span class="token local-name">::someclass</span></span> --> B    classDef someclass <span class="token function"><span class="token prefix">fill<span class="token punctuation">:</span></span></span><span class="token comment">#f96</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A:::someclass --> B    classDef someclass fill:#f96</pre><p>å½“å£°æ˜èŠ‚ç‚¹ä¹‹é—´çš„å¤šä¸ªé“¾æ¥æ—¶å¯ä»¥ä½¿ç”¨è¿™ç§å½¢å¼ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart LR    <span class="token function"><span class="token prefix">A<span class="token punctuation">:</span></span><span class="token local-name">::foo</span></span> &amp; <span class="token function"><span class="token prefix">B<span class="token punctuation">:</span></span><span class="token local-name">::bar</span></span> --> <span class="token function"><span class="token prefix">C<span class="token punctuation">:</span></span><span class="token local-name">::foobar</span></span>    classDef foo <span class="token function"><span class="token prefix">stroke<span class="token punctuation">:</span></span></span><span class="token comment">#f00</span>    classDef bar <span class="token function"><span class="token prefix">stroke<span class="token punctuation">:</span></span></span><span class="token comment">#0f0</span>    classDef foobar <span class="token function"><span class="token prefix">stroke<span class="token punctuation">:</span></span></span><span class="token comment">#00f</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart LR    A:::foo & B:::bar --> C:::foobar    classDef foo stroke:#f00    classDef bar stroke:#0f0    classDef foobar stroke:#00f</pre><h2 id="å¯¹-fontawesome-çš„åŸºæœ¬æ”¯æŒ">å¯¹ fontawesome çš„åŸºæœ¬æ”¯æŒ</h2><p>å¯ä»¥æ·»åŠ æ¥è‡ª fontawesome çš„å›¾æ ‡ã€‚</p><p>é€šè¿‡è¯­æ³• fa è®¿é—®å›¾æ ‡ï¼š#å›¾æ ‡ç±»å#.</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">flowchart TD    B<span class="token punctuation">[</span><span class="token string">"fa:fa-twitter for peace"</span><span class="token punctuation">]</span>    B-->C<span class="token punctuation">[</span><span class="token function"><span class="token prefix">fa<span class="token punctuation">:</span></span><span class="token local-name">fa-ban</span></span> forbidden<span class="token punctuation">]</span>    B-->D<span class="token punctuation">(</span><span class="token function"><span class="token prefix">fa<span class="token punctuation">:</span></span><span class="token local-name">fa-spinner</span></span><span class="token punctuation">)</span>    B-->E<span class="token punctuation">(</span>A <span class="token function"><span class="token prefix">fa<span class="token punctuation">:</span></span><span class="token local-name">fa-camera-retro</span></span> perhaps?<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">flowchart TD    B["fa:fa-twitter for peace"]    B-->C[fa:fa-ban forbidden]    B-->D(fa:fa-spinner)    B-->E(A fa:fa-camera-retro perhaps?)</pre><p>Mermaid ä¸ Font Awesome ç‰ˆæœ¬ 5 å…¼å®¹ï¼Œä»…é™å…è´¹å›¾æ ‡ã€‚ æ£€æŸ¥ä½ ä½¿ç”¨çš„å›¾æ ‡æ˜¯å¦æ¥è‡ª <a href="https://fontawesome.com/v5/search?o=r&amp;m=free">æ”¯æŒçš„å›¾æ ‡é›†</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mermaid </tag>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nvmç®¡ç†node.js</title>
      <link href="/2024/01/20/nvm-note/"/>
      <url>/2024/01/20/nvm-note/</url>
      
        <content type="html"><![CDATA[<h1>nvm ç®¡ç† node.js</h1><h2 id="Quick-Start">Quick Start</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">##1. å®‰è£…nvm(æœ€å¥½é¿å…cç›˜, nvmå’Œnodejsä¸è¦åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹)</span>nvm node_mirror http://npm.taobao.org/mirrors/node/nvm npm_mirror https://npm.taobao.org/mirrors/npm/nvm list availablenvm <span class="token function">install</span> <span class="token number">20.11</span>.0nvm use <span class="token number">20.11</span>.0nvm list<span class="token comment">##2. é…ç½®nodejsç¯å¢ƒå˜é‡</span><span class="token function">node</span> <span class="token parameter variable">-v</span><span class="token function">npm</span> get registry  <span class="token punctuation">(</span>æ£€æŸ¥æ˜¯ä¸æ˜¯æ·˜å®<span class="token punctuation">)</span><span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org/<span class="token comment">##3. æ‰¾ä¸ªæ–‡ä»¶å¤¹åšå‰ç«¯æœåŠ¡å™¨(ç±»ä¼¼tomcat)</span><span class="token function">npm</span> <span class="token function">install</span> express <span class="token parameter variable">-D</span>æˆ–è€… <span class="token function">npm</span> <span class="token function">install</span> express --save-dev<span class="token comment">##4. æ›´æ”¹package.jsoné…ç½®</span><span class="token punctuation">&#123;</span>  <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"module"</span>,  //å¯¼åŒ…é…ç½®  <span class="token string">"devDependencies"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>    <span class="token string">"express"</span><span class="token builtin class-name">:</span> <span class="token string">"^4.18.1"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">##4. å¯åŠ¨ç±»ä¹¦å†™ main.js</span><span class="token function">import</span> express from <span class="token string">'express'</span>  const app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span>  //expressæœåŠ¡å™¨  app.use<span class="token punctuation">(</span>express.static<span class="token punctuation">(</span><span class="token string">'public/'</span><span class="token punctuation">))</span>  //é™æ€èµ„æºç›®å½•  app.listen<span class="token punctuation">(</span><span class="token number">7070</span><span class="token punctuation">)</span>  //ç›‘å¬7070ç«¯å£<span class="token comment">##5.å¯åŠ¨æœåŠ¡</span><span class="token function">node</span> main.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®‰è£…-nvm">å®‰è£… nvm</h2><p>nvm å³ (node version manager)ï¼Œå¥½å¤„æ˜¯æ–¹ä¾¿åˆ‡æ¢ node.js ç‰ˆæœ¬</p><p>å®‰è£…æ³¨æ„äº‹é¡¹</p><ol><li>è¦å¸è½½æ‰ç°æœ‰çš„ nodejs</li><li>æç¤ºé€‰æ‹© nvm å’Œ nodejs ç›®å½•æ—¶ï¼Œä¸€å®šè¦é¿å…ç›®å½•ä¸­å‡ºç°ç©ºæ ¼</li><li>é€‰ç”¨ã€ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‘cmd ç¨‹åºæ¥æ‰§è¡Œ nvm å‘½ä»¤</li><li>é¦–æ¬¡è¿è¡Œå‰è®¾ç½®å¥½å›½å†…é•œåƒåœ°å€</li></ol><pre class="line-numbers language-none"><code class="language-none">nvm node_mirror http:&#x2F;&#x2F;npm.taobao.org&#x2F;mirrors&#x2F;node&#x2F;nvm npm_mirror https:&#x2F;&#x2F;npm.taobao.org&#x2F;mirrors&#x2F;npm&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é¦–å…ˆæŸ¥çœ‹æœ‰å“ªäº›å¯ç”¨ç‰ˆæœ¬</p><pre class="line-numbers language-none"><code class="language-none">nvm list available<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">|   CURRENT    |     LTS      |  OLD STABLE  | OLD UNSTABLE ||--------------|--------------|--------------|--------------||    18.7.0    |   16.16.0    |   0.12.18    |   0.11.16    ||    18.6.0    |   16.15.1    |   0.12.17    |   0.11.15    ||    18.5.0    |   16.15.0    |   0.12.16    |   0.11.14    ||    18.4.0    |   16.14.2    |   0.12.15    |   0.11.13    ||    18.3.0    |   16.14.1    |   0.12.14    |   0.11.12    ||    18.2.0    |   16.14.0    |   0.12.13    |   0.11.11    ||    18.1.0    |   16.13.2    |   0.12.12    |   0.11.10    ||    18.0.0    |   16.13.1    |   0.12.11    |    0.11.9    ||    17.9.1    |   16.13.0    |   0.12.10    |    0.11.8    ||    17.9.0    |   14.20.0    |    0.12.9    |    0.11.7    ||    17.8.0    |   14.19.3    |    0.12.8    |    0.11.6    ||    17.7.2    |   14.19.2    |    0.12.7    |    0.11.5    ||    17.7.1    |   14.19.1    |    0.12.6    |    0.11.4    ||    17.7.0    |   14.19.0    |    0.12.5    |    0.11.3    ||    17.6.0    |   14.18.3    |    0.12.4    |    0.11.2    ||    17.5.0    |   14.18.2    |    0.12.3    |    0.11.1    ||    17.4.0    |   14.18.1    |    0.12.2    |    0.11.0    ||    17.3.1    |   14.18.0    |    0.12.1    |    0.9.12    ||    17.3.0    |   14.17.6    |    0.12.0    |    0.9.11    ||    17.2.0    |   14.17.5    |   0.10.48    |    0.9.10    |<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å»ºè®®å®‰è£… LTSï¼ˆé•¿æœŸæ”¯æŒç‰ˆï¼‰</p><pre class="line-numbers language-none"><code class="language-none">nvm install 16.16.0nvm install 14.20.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰§è¡Œ <code>nvm list</code> ä¼šåˆ—å‡ºå·²å®‰è£…ç‰ˆæœ¬</p><p>åˆ‡æ¢åˆ° 16.16.0</p><pre class="line-numbers language-none"><code class="language-none">nvm use 16.16.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ‡æ¢åˆ° 14.20.0</p><pre class="line-numbers language-none"><code class="language-none">nvm use 14.20.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®‰è£…å nvm è‡ªå·±çš„ç¯å¢ƒå˜é‡ä¼šè‡ªåŠ¨æ·»åŠ ï¼Œä½†å¯èƒ½éœ€è¦æ‰‹å·¥æ·»åŠ  nodejs çš„ PATH ç¯å¢ƒå˜é‡</p><h2 id="æ£€æŸ¥-npm">æ£€æŸ¥ npm</h2><p>npm æ˜¯ js çš„åŒ…ç®¡ç†å™¨ï¼Œå°±ç±»ä¼¼äº java ç•Œçš„ mavenï¼Œè¦ç¡®ä¿å®ƒä½¿ç”¨çš„æ˜¯å›½å†…é•œåƒ</p><p>æ£€æŸ¥é•œåƒ</p><pre class="line-numbers language-none"><code class="language-none">npm get registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœè¿”å›çš„ä¸æ˜¯ <code>https://registry.npm.taobao.org/</code>ï¼Œéœ€è¦åšå¦‚ä¸‹è®¾ç½®</p><pre class="line-numbers language-none"><code class="language-none">npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="npm-å¸¸ç”¨å‘½ä»¤">npm å¸¸ç”¨å‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token parameter variable">-v</span> <span class="token comment">#æŸ¥çœ‹ npm çš„ç‰ˆæœ¬</span><span class="token function">npm</span> <span class="token parameter variable">-l</span> <span class="token comment">#æŸ¥çœ‹å„ä¸ªå‘½ä»¤çš„ç®€å•ç”¨æ³•</span><span class="token function">npm</span> <span class="token builtin class-name">help</span> <span class="token comment">#æŸ¥çœ‹ npm å‘½ä»¤åˆ—è¡¨</span><span class="token function">npm</span> config list <span class="token parameter variable">-l</span> <span class="token comment">#æŸ¥çœ‹ npm çš„é…ç½®</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token comment">#å®‰è£…é¡¹ç›®çš„å…¨éƒ¨ä¾èµ–åŒ…</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#å®‰è£…æŒ‡å®šçš„ä¾èµ–åŒ…</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#å®‰è£…æŒ‡å®šçš„ä¾èµ–åŒ…ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°é¡¹ç›®çš„ dependencies èŠ‚ç‚¹ä¸­ã€‚</span><span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#å®‰è£…æŒ‡å®šçš„ä¾èµ–åŒ…ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°é¡¹ç›®çš„ devDependencies èŠ‚ç‚¹ä¸­ã€‚</span><span class="token function">npm</span> uninstall <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#å¸è½½æŒ‡å®šçš„ä¾èµ–åŒ…ã€‚</span><span class="token function">npm</span> update <span class="token comment">#æ›´æ–°é¡¹ç›®çš„å…¨éƒ¨ä¾èµ–åŒ…ã€‚</span><span class="token function">npm</span> outdated <span class="token comment">#æ£€æŸ¥é¡¹ç›®çš„ä¾èµ–åŒ…æ˜¯å¦æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚</span><span class="token function">npm</span> init <span class="token comment">#åˆå§‹åŒ–é¡¹ç›®ï¼Œç”Ÿæˆpackage.jsonæ–‡ä»¶ã€‚</span><span class="token function">npm</span> publish <span class="token comment">#å‘å¸ƒè‡ªå·±çš„åŒ…ã€‚</span><span class="token function">npm</span> search <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#æœç´¢æŒ‡å®šçš„ä¾èµ–åŒ…ã€‚</span><span class="token function">npm</span> info <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#æŸ¥çœ‹æŒ‡å®šä¾èµ–åŒ…çš„è¯¦ç»†ä¿¡æ¯ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="npm-search-æœç´¢æ¨¡å—">npm search æœç´¢æ¨¡å—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> search <span class="token operator">&lt;</span>æœç´¢è¯<span class="token operator">></span> <span class="token punctuation">[</span>-g<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>npm search</code> å‘½ä»¤ç”¨äºæœç´¢ npm ä»“åº“ï¼Œå®ƒåé¢å¯ä»¥è·Ÿå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥è·Ÿæ­£åˆ™è¡¨è¾¾å¼ã€‚</p><h3 id="npm-list-æŸ¥çœ‹æ¨¡å—">npm list æŸ¥çœ‹æ¨¡å—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#å½“å‰é¡¹ç›®å®‰è£…çš„æ‰€æœ‰æ¨¡å—</span><span class="token function">npm</span> list<span class="token comment">#åˆ—å‡ºå…¨å±€å®‰è£…çš„æ¨¡å— å¸¦ä¸Š[--depth 0] ä¸æ·±å…¥åˆ°åŒ…çš„æ”¯ç‚¹ æ›´ç®€æ´</span><span class="token function">npm</span> list <span class="token parameter variable">-g</span> <span class="token parameter variable">--depth</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="npm-install-å®‰è£…æ¨¡å—">npm install å®‰è£…æ¨¡å—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#è¯»å–package.jsoné‡Œé¢çš„é…ç½®å•å®‰è£…  </span><span class="token function">npm</span> <span class="token function">install</span> <span class="token comment">#å¯ç®€å†™æˆ npm i</span><span class="token comment">#é»˜è®¤å®‰è£…æŒ‡å®šæ¨¡å—çš„æœ€æ–°(@latest)ç‰ˆæœ¬</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>@scope<span class="token operator">></span>/<span class="token punctuation">]</span><span class="token operator">&lt;</span>name<span class="token operator">></span>  <span class="token comment">#eg:npm install gulp</span><span class="token comment">#å®‰è£…æŒ‡å®šæ¨¡å—çš„æŒ‡å®šç‰ˆæœ¬</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>@scope<span class="token operator">></span>/<span class="token punctuation">]</span><span class="token operator">&lt;</span>name<span class="token operator">></span>@<span class="token operator">&lt;</span>version<span class="token operator">></span> <span class="token comment">#eg: npm install gulp@3.9.1</span><span class="token comment">#å®‰è£…æŒ‡å®šæŒ‡å®šç‰ˆæœ¬èŒƒå›´å†…çš„æ¨¡å—</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>@scope<span class="token operator">></span>/<span class="token punctuation">]</span><span class="token operator">&lt;</span>name<span class="token operator">></span>@<span class="token operator">&lt;</span>version range<span class="token operator">></span> <span class="token comment">#eg: npm install vue@">=1.0.28 &lt; 2.0.0"</span><span class="token comment">#å®‰è£…æŒ‡å®šæ¨¡å—çš„æŒ‡å®šæ ‡ç­¾ é»˜è®¤å€¼ä¸º(@latest)</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>@scope<span class="token operator">></span>/<span class="token punctuation">]</span><span class="token operator">&lt;</span>name<span class="token operator">></span>@<span class="token operator">&lt;</span>tag<span class="token operator">></span> <span class="token comment">#eg:npm install sax@0.1.1</span><span class="token comment"># é€šè¿‡Githubä»£ç åº“åœ°å€å®‰è£…</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>tarball url<span class="token operator">></span> <span class="token comment">#eg:npm install git://github.com/package/path.git</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="npm-uninstall-å¸è½½æ¨¡å—">npm uninstall å¸è½½æ¨¡å—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#å¸è½½å½“å‰é¡¹ç›®æˆ–å…¨å±€æ¨¡å— </span><span class="token function">npm</span> uninstall <span class="token operator">&lt;</span>name<span class="token operator">></span> <span class="token punctuation">[</span>-g<span class="token punctuation">]</span> <span class="token comment">#eg: npm uninstall gulp --save-dev  </span><span class="token comment">#    npm i gulp -g</span><span class="token comment">#å¸è½½åï¼Œä½ å¯ä»¥åˆ° /node\_modules/ ç›®å½•ä¸‹æŸ¥çœ‹åŒ…æ˜¯å¦è¿˜å­˜åœ¨ï¼Œæˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</span><span class="token function">npm</span> <span class="token function">ls</span> <span class="token comment">#æŸ¥çœ‹å®‰è£…çš„æ¨¡å—</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="npm-update-æ›´æ–°æ¨¡å—">npm update æ›´æ–°æ¨¡å—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> update <span class="token comment">#æ£€æŸ¥å¹¶æ›´æ–°é¡¹ç›®çš„å…¨éƒ¨ä¾èµ–åŒ…</span><span class="token comment">#å‡çº§å½“å‰é¡¹ç›®æˆ–å…¨å±€çš„æŒ‡å®šæ¨¡å—</span><span class="token function">npm</span> update <span class="token operator">&lt;</span>name<span class="token operator">></span> <span class="token punctuation">[</span>-g<span class="token punctuation">]</span> <span class="token comment">#eg: npm update express </span><span class="token comment">#    npm update express -g</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
            <tag> node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mermaid-ç±»å›¾</title>
      <link href="/2024/01/19/mermaid-uml/"/>
      <url>/2024/01/19/mermaid-uml/</url>
      
        <content type="html"><![CDATA[<h1>Mermaid-ç±»å›¾</h1><blockquote><p>æ‘˜å½•è‡ª <a href="https://mermaid.nodejs.cn/syntax/classDiagram.html">ç±»å›¾ | Mermaid ä¸­æ–‡ç½‘ (nodejs.cn)</a></p></blockquote><p>ç±»å›¾æ˜¯é¢å‘å¯¹è±¡å»ºæ¨¡çš„ä¸»è¦æ„å»ºå—ã€‚ å®ƒç”¨äºåº”ç”¨ç»“æ„çš„ä¸€èˆ¬æ¦‚å¿µå»ºæ¨¡ï¼Œä»¥åŠå°†æ¨¡å‹è½¬æ¢ä¸ºç¼–ç¨‹ä»£ç çš„è¯¦ç»†å»ºæ¨¡ã€‚ ç±»å›¾ä¹Ÿå¯ç”¨äºæ•°æ®å»ºæ¨¡ã€‚ ç±»å›¾ä¸­çš„ç±»è¡¨ç¤ºä¸»è¦å…ƒç´ ã€åº”ç”¨ä¸­çš„äº¤äº’ä»¥åŠè¦ç¼–ç¨‹çš„ç±»ã€‚</p><p><strong>Code</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">---<span class="token function"><span class="token prefix">title<span class="token punctuation">:</span></span></span> Animal example---classDiagram    note <span class="token string">"From Duck till Zebra"</span>    Animal &lt;|-- Duck    note for Duck <span class="token string">"can fly\ncan swim\ncan dive\ncan help in debugging"</span>    Animal &lt;|-- Fish    Animal &lt;|-- Zebra    Animal <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +int age    Animal <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +String gender    <span class="token function"><span class="token prefix">Animal<span class="token punctuation">:</span></span></span> +isMammal<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function"><span class="token prefix">Animal<span class="token punctuation">:</span></span></span> +mate<span class="token punctuation">(</span><span class="token punctuation">)</span>    class Duck<span class="token punctuation">&#123;</span>        +String beakColor        +swim<span class="token punctuation">(</span><span class="token punctuation">)</span>        +quack<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    class Fish<span class="token punctuation">&#123;</span>        -int sizeInFeet        -canEat<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    class Zebra<span class="token punctuation">&#123;</span>        +bool is_wild        +run<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">---title: Animal example---classDiagram    note "From Duck till Zebra"    Animal <|-- Duck    note for Duck "can fly\ncan swim\ncan dive\ncan help in debugging"    Animal <|-- Fish    Animal <|-- Zebra    Animal : +int age    Animal : +String gender    Animal: +isMammal()    Animal: +mate()    class Duck{        +String beakColor        +swim()        +quack()    }    class Fish{        -int sizeInFeet        -canEat()    }    class Zebra{        +bool is_wild        +run()    }</pre><h2 id="è¯­æ³•">è¯­æ³•</h2><h3 id="ç±»">ç±»</h3><p>UML æä¾›äº†è¡¨ç¤ºç±»æˆå‘˜ï¼ˆä¾‹å¦‚å±æ€§å’Œæ–¹æ³•ï¼‰ä»¥åŠæœ‰å…³å®ƒä»¬çš„é™„åŠ ä¿¡æ¯çš„æœºåˆ¶ã€‚å›¾ä¸­ç±»çš„å•ä¸ªå®ä¾‹åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>é¡¶éƒ¨éš”é—´åŒ…å«ç±»çš„åç§°ã€‚ å®ƒä»¥ç²—ä½“å±…ä¸­æ‰“å°ï¼Œç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ã€‚ å®ƒè¿˜å¯èƒ½åŒ…å«æè¿°ç±»æ€§è´¨çš„å¯é€‰æ³¨é‡Šæ–‡æœ¬ã€‚</li><li>ä¸­é—´çš„éƒ¨åˆ†åŒ…å«ç±»çš„å±æ€§ã€‚ å®ƒä»¬å·¦å¯¹é½ä¸”ç¬¬ä¸€ä¸ªå­—æ¯å°å†™ã€‚</li><li>åº•éƒ¨éš”é—´åŒ…å«è¯¥ç±»å¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚ å®ƒä»¬ä¹Ÿæ˜¯å·¦å¯¹é½çš„ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯å°å†™çš„ã€‚</li></ul><p><strong>Code</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">---<span class="token function"><span class="token prefix">title<span class="token punctuation">:</span></span></span> Bank example---classDiagramclass BankAccountBankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +String ownerBankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +Bigdecimal balanceBankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +deposit<span class="token punctuation">(</span>amount<span class="token punctuation">)</span>BankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +withdrawal<span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">---title: Bank example---classDiagramclass BankAccountBankAccount : +String ownerBankAccount : +Bigdecimal balanceBankAccount : +deposit(amount)BankAccount : +withdrawal(amount)</pre><h2 id="å®šä¹‰ä¸€ä¸ªç±»ç±»">å®šä¹‰ä¸€ä¸ªç±»ç±»</h2><p><strong>å®šä¹‰ç±»æœ‰ä¸¤ç§æ–¹æ³•:</strong></p><ul><li>æ˜¾ç¤ºä½¿ç”¨å…³é”®å­— class (å¦‚ <code>class Animal</code>) æ¥å®šä¹‰ Animal ç±»ã€‚</li><li>é€šè¿‡ relatinoship ä¸€æ¬¡å®šä¹‰ä¸¤ä¸ªç±»åŠå…¶å…³ç³»ã€‚ä¾‹å¦‚, <code>Vehicle &lt;|-- Car</code>ã€‚</li></ul><p><strong>Code</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclass AnimalVehicle &lt;|-- Car<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclass AnimalVehicle <|-- Car</pre><p>å‘½åçº¦å®šï¼š ç±»ååªèƒ½ç”±å­—æ¯æ•°å­—å­—ç¬¦ï¼ˆåŒ…æ‹¬ unicodeï¼‰ã€ä¸‹åˆ’çº¿å’ŒçŸ­åˆ’çº¿ (-) ç»„æˆã€‚</p><h3 id="ç±»åˆ«æ ‡ç­¾">ç±»åˆ«æ ‡ç­¾</h3><p>å¦‚æœä½ éœ€è¦ä¸ºç±»æä¾›æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram    class Animal<span class="token punctuation">[</span><span class="token string">"Animal with a label"</span><span class="token punctuation">]</span>    class Car<span class="token punctuation">[</span><span class="token string">"Car with *! symbols"</span><span class="token punctuation">]</span>    Animal --> Car<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram    class Animal["Animal with a label"]    class Car["Car with *! symbols"]    Animal --> Car</pre><p>ä½ è¿˜å¯ä»¥ä½¿ç”¨åå¼•å·æ¥è½¬ä¹‰æ ‡ç­¾ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram    class `Animal Class!`    class `Car Class`    `Animal Class!` --> `Car Class`<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram    class `Animal Class!`    class `Car Class`    `Animal Class!` --> `Car Class`</pre><h2 id="å®šä¹‰ç±»çš„æˆå‘˜">å®šä¹‰ç±»çš„æˆå‘˜</h2><p>UML æä¾›äº†è¡¨ç¤ºç±»æˆå‘˜ï¼ˆä¾‹å¦‚å±æ€§å’Œæ–¹æ³•ï¼‰çš„æœºåˆ¶ï¼Œä»¥åŠæœ‰å…³å®ƒä»¬çš„é™„åŠ ä¿¡æ¯ã€‚</p><p>Mermaid æ ¹æ® parenthesis<code>()</code> æ˜¯å¦å­˜åœ¨æ¥åŒºåˆ†å±æ€§å’Œå‡½æ•°/æ–¹æ³•ã€‚å¸¦æœ‰ <code>()</code> çš„è¢«è§†ä¸ºå‡½æ•°/æ–¹æ³•ï¼Œæ‰€æœ‰å…¶ä»–è¢«è§†ä¸ºå±æ€§ã€‚</p><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å®šä¹‰ç±»çš„æˆå‘˜ï¼Œæ— è®ºä½¿ç”¨é‚£ç§è¯­æ³•æ¥å®šä¹‰æˆå‘˜ï¼Œè¾“å‡ºä»ç„¶æ˜¯ç›¸åŒçš„ã€‚ä¸¤ç§ä¸åŒçš„æ–¹å¼æ˜¯ï¼š</p><ul><li>ä½¿ç”¨ <strong>:</strong>ï¼ˆå†’å·ï¼‰åè·Ÿæˆå‘˜åç§°æ¥å…³è”ç±»çš„æˆå‘˜ï¼Œè¿™å¯¹äºä¸€æ¬¡å®šä¹‰ä¸€ä¸ªæˆå‘˜å¾ˆæœ‰ç”¨ã€‚ ä¾‹å¦‚ï¼š</li></ul><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram    class BankAccount    BankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +String owner    BankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +BigDecimal balance    BankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +deposit<span class="token punctuation">(</span>amount<span class="token punctuation">)</span>    BankAccount <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +withdrawal<span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram    class BankAccount    BankAccount : +String owner    BankAccount : +BigDecimal balance    BankAccount : +deposit(amount)    BankAccount : +withdrawal(amount)</pre><ul><li>ä½¿ç”¨ <strong>{}</strong> æ‹¬å·å…³è”ç±»çš„æˆå‘˜ï¼Œå…¶ä¸­æˆå‘˜åˆ†ç»„åœ¨å¤§æ‹¬å·å†…ã€‚ é€‚åˆä¸€æ¬¡å®šä¹‰å¤šä¸ªæˆå‘˜ã€‚ ä¾‹å¦‚ï¼š</li></ul><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclass BankAccount<span class="token punctuation">&#123;</span>    +String owner    +BigDecimal balance    +deposit<span class="token punctuation">(</span>amount<span class="token punctuation">)</span>    +withdrawal<span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclass BankAccount{    +String owner    +BigDecimal balance    +deposit(amount)    +withdrawal(amount)}</pre><h3 id="è¿”å›ç±»å‹">è¿”å›ç±»å‹</h3><p>æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨å°†è¿”å›çš„æ•°æ®ç±»å‹æ¥ç»“æŸæ–¹æ³•/å‡½æ•°å®šä¹‰ï¼ˆæ³¨æ„ï¼šæœ€ç»ˆçš„ <code>)</code> å’Œè¿”å›ç±»å‹ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ï¼‰ã€‚ ä¸€ä¸ªä¾‹å­ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclass BankAccount<span class="token punctuation">&#123;</span>    +String owner    +BigDecimal balance    +deposit<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> bool    +withdrawal<span class="token punctuation">(</span>amount<span class="token punctuation">)</span> int<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclass BankAccount{    +String owner    +BigDecimal balance    +deposit(amount) bool    +withdrawal(amount) int}</pre><h3 id="é€šç”¨ç±»å‹">é€šç”¨ç±»å‹</h3><p>æ³›å‹å¯ä»¥è¡¨ç¤ºä¸ºç±»å®šä¹‰çš„ä¸€éƒ¨åˆ†ä»¥åŠç±»æˆå‘˜/è¿”å›ç±»å‹ã€‚ ä¸ºäº†å°†è¯¥é¡¹ç›®è¡¨ç¤ºä¸ºé€šç”¨é¡¹ï¼Œè¯·å°†è¯¥ç±»å‹æ‹¬åœ¨ <code>~</code> (<strong>tilde</strong>) å†…ã€‚ æ”¯æŒ <strong>åµŒå¥—</strong> ç±»å‹å£°æ˜ï¼ˆä¾‹å¦‚ <code>List&lt;List&lt;int&gt;&gt;</code>ï¼‰ï¼Œä½†å½“å‰ä¸æ”¯æŒåŒ…å«é€—å·çš„æ³›å‹ã€‚ ï¼ˆå¦‚ <code>List&lt;List&lt;K, V&gt;&gt;</code>ï¼‰</p><blockquote><p>è¯·æ³¨æ„ï¼Œå½“åœ¨ç±»å®šä¹‰ä¸­ä½¿ç”¨æ³›å‹æ—¶ï¼Œæ³›å‹ç±»å‹ä¸è¢«è§†ä¸ºç±»åç§°çš„ä¸€éƒ¨åˆ†ã€‚ IEã€‚ï¼š å¯¹äºä»»ä½•éœ€è¦å¼•ç”¨ç±»åçš„è¯­æ³•ï¼Œä½ éœ€è¦åˆ é™¤å®šä¹‰çš„ç±»å‹éƒ¨åˆ†ã€‚ è¿™ä¹Ÿæ„å‘³ç€ mermaid ç›®å‰ä¸æ”¯æŒä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°ä½†æ³›å‹ç±»å‹ä¸åŒçš„ç±»ã€‚</p></blockquote><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclass Square~Shape~<span class="token punctuation">&#123;</span>    int id    List~int~ position    setPoints<span class="token punctuation">(</span>List~int~ points<span class="token punctuation">)</span>    getPoints<span class="token punctuation">(</span><span class="token punctuation">)</span> List~int~<span class="token punctuation">&#125;</span>Square <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> -List~string~ messagesSquare <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +setMessages<span class="token punctuation">(</span>List~string~ messages<span class="token punctuation">)</span>Square <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +getMessages<span class="token punctuation">(</span><span class="token punctuation">)</span> List~string~Square <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> +getDistanceMatrix<span class="token punctuation">(</span><span class="token punctuation">)</span> List~List~int~~<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclass Square~Shape~{    int id    List~int~ position    setPoints(List~int~ points)    getPoints() List~int~}Square : -List~string~ messagesSquare : +setMessages(List~string~ messages)Square : +getMessages() List~string~Square : +getDistanceMatrix() List~List~int~~</pre><h4 id="èƒ½è§åº¦">èƒ½è§åº¦</h4><p>ä¸ºäº†æè¿°å±äºç±»ï¼ˆå³ç±»æˆå‘˜ï¼‰çš„å±æ€§æˆ–æ–¹æ³•/å‡½æ•°çš„å¯è§æ€§ï¼ˆæˆ–å°è£…ï¼‰ï¼Œå¯ä»¥åœ¨è¯¥æˆå‘˜åç§°ä¹‹å‰æ”¾ç½®å¯é€‰çš„ç¬¦å·ï¼š</p><ul><li><code>+</code> æ°‘ä¼—</li><li><code>-</code> ç§æœ‰çš„</li><li><code>#</code> å—ä¿æŠ¤</li><li><code>~</code> å°è£…/å†…éƒ¨</li></ul><blockquote><p>è¯·æ³¨æ„ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡åœ¨æ–¹æ³•æœ«å°¾æ·»åŠ ä»¥ä¸‹ç¬¦å·æ¥åœ¨æ–¹æ³•å®šä¹‰ä¸­åŒ…å«å…¶ä»–åˆ†ç±»å™¨ï¼Œå³ï¼š åœ¨ <code>()</code> æˆ–è¿”å›ç±»å‹ä¹‹åï¼š</p><ul><li><code>*</code> æ‘˜è¦ä¾‹å¦‚ï¼š <code>someAbstractMethod()*</code> æˆ– <code>someAbstractMethod() int*</code></li><li><code>$</code> é™æ€ä¾‹å¦‚ï¼š <code>someStaticMethod() æˆ– </code>someStaticMethod() String</li></ul></blockquote><blockquote><p>è¯·æ³¨æ„ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡åœ¨æœ«å°¾æ·»åŠ ä»¥ä¸‹ç¬¦å·æ¥åœ¨å­—æ®µå®šä¹‰ä¸­åŒ…å«å…¶ä»–åˆ†ç±»å™¨ï¼š</p><ul><li><code>$</code> é™æ€ä¾‹å¦‚ï¼š `String someField</li></ul></blockquote><h2 id="å®šä¹‰å…³ç³»">å®šä¹‰å…³ç³»</h2><p>å…³ç³»æ˜¯ä¸€ä¸ªé€šç”¨æœ¯è¯­ï¼Œæ¶µç›–ç±»å›¾å’Œå¯¹è±¡å›¾ä¸Šå‘ç°çš„ç‰¹å®šç±»å‹çš„é€»è¾‘è¿æ¥ã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle"><span class="token punctuation">[</span>classA<span class="token punctuation">]</span><span class="token punctuation">[</span>Arrow<span class="token punctuation">]</span><span class="token punctuation">[</span>ClassB<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›®å‰æ”¯æŒçš„ UML ä¸‹ä¸ºç±»å®šä¹‰äº†å…«ç§ä¸åŒç±»å‹çš„å…³ç³»ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>&lt;|--</code></td><td>ç»§æ‰¿</td></tr><tr><td><code>*--</code></td><td>ä½œå“</td></tr><tr><td><code>o--</code></td><td>èšåˆ</td></tr><tr><td><code>--&gt;</code></td><td>å…³è”</td></tr><tr><td><code>--</code></td><td>é“¾æ¥ï¼ˆå®å¿ƒï¼‰</td></tr><tr><td><code>..&gt;</code></td><td>ä¾èµ–</td></tr><tr><td><code>..|&gt;</code></td><td>å®ç°</td></tr><tr><td><code>..</code></td><td>é“¾æ¥ï¼ˆè™šçº¿ï¼‰</td></tr></tbody></table><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclassA &lt;|-- classBclassC *-- classDclassE o-- classFclassG &lt;-- classHclassI -- classJclassK &lt;<span class="token punctuation">.</span><span class="token punctuation">.</span> classLclassM &lt;|<span class="token punctuation">.</span><span class="token punctuation">.</span> classNclassO <span class="token punctuation">.</span><span class="token punctuation">.</span> classP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclassA <|-- classBclassC *-- classDclassE o-- classFclassG <-- classHclassI -- classJclassK <.. classLclassM <|.. classNclassO .. classP</pre><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¥æè¿°ä¸¤ä¸ªç±»ä¹‹é—´å…³ç³»çš„æ€§è´¨ã€‚ æ­¤å¤–ï¼Œç®­å¤´ä¹Ÿå¯ä»¥ç”¨äºç›¸åçš„æ–¹å‘ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclassA --|> classB <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> InheritanceclassC --* classD <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> CompositionclassE --o classF <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> AggregationclassG --> classH <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> AssociationclassI -- classJ <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> Link<span class="token punctuation">(</span>Solid<span class="token punctuation">)</span>classK <span class="token punctuation">.</span><span class="token punctuation">.</span>> classL <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> DependencyclassM <span class="token punctuation">.</span><span class="token punctuation">.</span>|> classN <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> RealizationclassO <span class="token punctuation">.</span><span class="token punctuation">.</span> classP <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> Link<span class="token punctuation">(</span>Dashed<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclassA --|> classB : InheritanceclassC --* classD : CompositionclassE --o classF : AggregationclassG --> classH : AssociationclassI -- classJ : Link(Solid)classK ..> classL : DependencyclassM ..|> classN : RealizationclassO .. classP : Link(Dashed)</pre><h3 id="å…³ç³»æ ‡ç­¾">å…³ç³»æ ‡ç­¾</h3><p>å¯ä»¥å°†æ ‡ç­¾æ–‡æœ¬æ·»åŠ åˆ°å…³ç³»ä¸­ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle"><span class="token punctuation">[</span>classA<span class="token punctuation">]</span><span class="token punctuation">[</span>Arrow<span class="token punctuation">]</span><span class="token punctuation">[</span>ClassB<span class="token punctuation">]</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">LabelText</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclassA &lt;|-- classB <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> implementsclassC *-- classD <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> compositionclassE o-- classF <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> aggregation<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclassA <|-- classB : implementsclassC *-- classD : compositionclassE o-- classF : aggregation</pre><h3 id="åŒå‘å…³ç³»">åŒå‘å…³ç³»</h3><p>å…³ç³»åœ¨é€»è¾‘ä¸Šå¯ä»¥è¡¨ç¤ºä¸€ä¸ª Nï¼šM å…³è”ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram    Animal &lt;|--|> Zebra<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram    Animal <|--|> Zebra</pre><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle"><span class="token punctuation">[</span>Relation Type<span class="token punctuation">]</span><span class="token punctuation">[</span>Link<span class="token punctuation">]</span><span class="token punctuation">[</span>Relation Type<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­ <code>Relation Type</code> å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š</p><table><thead><tr><th style="text-align:left">ç±»å‹</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>&lt;|</code></td><td style="text-align:left">ç»§æ‰¿</td></tr><tr><td style="text-align:left"><code>\*</code></td><td style="text-align:left">ä½œå“</td></tr><tr><td style="text-align:left"><code>o</code></td><td style="text-align:left">èšåˆ</td></tr><tr><td style="text-align:left"><code>&gt;</code></td><td style="text-align:left">å…³è”</td></tr><tr><td style="text-align:left"><code>&lt;</code></td><td style="text-align:left">å…³è”</td></tr><tr><td style="text-align:left"><code>|&gt;</code></td><td style="text-align:left">å®ç°</td></tr></tbody></table><p><code>Link</code> å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š</p><table><thead><tr><th style="text-align:left">ç±»å‹</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">â€“</td><td style="text-align:left">å®çº¿</td></tr><tr><td style="text-align:left">â€¦</td><td style="text-align:left">è™šçº¿</td></tr></tbody></table><h2 id="å®šä¹‰å‘½åç©ºé—´">å®šä¹‰å‘½åç©ºé—´</h2><p>å‘½åç©ºé—´å¯¹ç±»è¿›è¡Œåˆ†ç»„ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramnamespace BaseShapes <span class="token punctuation">&#123;</span>    class Triangle    class Rectangle <span class="token punctuation">&#123;</span>      double width      double height    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramnamespace BaseShapes {    class Triangle    class Rectangle {      double width      double height    }}</pre><h2 id="å…³ç³»çš„åŸºæ•°-å¤šé‡æ€§">å…³ç³»çš„åŸºæ•°/å¤šé‡æ€§</h2><p>ç±»å›¾ä¸­çš„å¤šé‡æ€§æˆ–åŸºæ•°æŒ‡ç¤ºå¯ä»¥é“¾æ¥åˆ°å¦ä¸€ç±»çš„å®ä¾‹çš„ä¸€ä¸ªç±»çš„å®ä¾‹æ•°ã€‚ ä¾‹å¦‚ï¼Œæ¯ä¸ªå…¬å¸éƒ½ä¼šæœ‰ä¸€åæˆ–å¤šåå‘˜å·¥ï¼ˆä¸æ˜¯é›¶ï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªå‘˜å·¥å½“å‰ä¸ºé›¶ä¸ªæˆ–ä¸€ä¸ªå…¬å¸å·¥ä½œã€‚</p><p>å¤šé‡ç¬¦å·æ”¾ç½®åœ¨å…³è”çš„æœ«å°¾é™„è¿‘ã€‚</p><p>ä¸åŒçš„åŸºæ•°é€‰é¡¹æ˜¯ï¼š</p><ul><li><code>1</code> åªæœ‰ 1 ä¸ª</li><li><code>0..1</code> é›¶æˆ–ä¸€</li><li><code>1..*</code> ä¸€ä¸ªæˆ–å¤šä¸ª</li><li><code>*</code> è®¸å¤š</li><li><code>n</code> å’Œ</li><li><code>0..n</code> é›¶åˆ° n</li><li><code>1..n</code> ä¸€å¯¹å¤š</li></ul><p>é€šè¿‡å°†æ–‡æœ¬é€‰é¡¹æ”¾åœ¨ç»™å®šç®­å¤´ä¹‹å‰æˆ–ä¹‹åçš„å¼•å· <code>&quot;</code> å†…ï¼Œå¯ä»¥è½»æ¾å®šä¹‰åŸºæ•°ã€‚ ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle"><span class="token punctuation">[</span>classA<span class="token punctuation">]</span> <span class="token string">"cardinality1"</span> <span class="token punctuation">[</span>Arrow<span class="token punctuation">]</span> <span class="token string">"cardinality2"</span> <span class="token punctuation">[</span>ClassB<span class="token punctuation">]</span><span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">LabelText</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram    Customer <span class="token string">"1"</span> --> <span class="token string">"*"</span> Ticket    Student <span class="token string">"1"</span> --> <span class="token string">"1..*"</span> Course    Galaxy --> <span class="token string">"many"</span> Star <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> Contains<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram    Customer "1" --> "*" Ticket    Student "1" --> "1..*" Course    Galaxy --> "many" Star : Contains</pre><h2 id="ç±»ä¸Šçš„æ³¨é‡Š">ç±»ä¸Šçš„æ³¨é‡Š</h2><p>å¯ä»¥ä½¿ç”¨æ ‡è®°æ¥æ³¨é‡Šç±»ï¼Œä»¥æä¾›æœ‰å…³è¯¥ç±»çš„é™„åŠ å…ƒæ•°æ®ã€‚ è¿™å¯ä»¥æ›´æ¸…æ¥šåœ°è¡¨æ˜å…¶æ€§è´¨ã€‚ ä¸€äº›å¸¸è§çš„æ³¨é‡ŠåŒ…æ‹¬ï¼š</p><ul><li><code>&lt;&lt;Interface&gt;&gt;</code> è¡¨ç¤ºä¸€ä¸ªæ¥å£ç±»</li><li><code>&lt;&lt;Abstract&gt;&gt;</code> è¡¨ç¤ºä¸€ä¸ªæŠ½è±¡ç±»</li><li><code>&lt;&lt;Service&gt;&gt;</code> ä»£è¡¨ä¸€ä¸ªæœåŠ¡ç±»</li><li><code>&lt;&lt;Enumeration&gt;&gt;</code> è¡¨ç¤ºä¸€ä¸ªæšä¸¾</li></ul><p>æ³¨é‡Šåœ¨å¼€å¤´ <code>&lt;&lt;</code> å’Œç»“å°¾ <code>&gt;&gt;</code> å†…å®šä¹‰ã€‚ æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å‘ç±»æ·»åŠ æ³¨é‡Šï¼Œä¸¤ç§æ–¹æ³•çš„è¾“å‡ºéƒ½æ˜¯ç›¸åŒçš„ï¼š</p><ul><li>åœ¨ <strong>å•ç‹¬çš„çº¿</strong> ä¸­å®šä¹‰äº†ä¸€ä¸ªç±»ä¹‹åï¼š</li></ul><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclass Shape&lt;<span class="token url"><span class="token punctuation">&lt;</span>interface<span class="token punctuation">></span></span>> ShapeShape <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> noOfVerticesShape <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> draw<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclass Shape<<interface>> ShapeShape : noOfVerticesShape : draw()</pre><ul><li>åœ¨ <strong>åµŒå¥—ç»“æ„</strong> ä¸­è¿åŒç±»å®šä¹‰ï¼š</li></ul><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclass Shape<span class="token punctuation">&#123;</span>    &lt;<span class="token url"><span class="token punctuation">&lt;</span>interface<span class="token punctuation">></span></span>>    noOfVertices    draw<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>class Color<span class="token punctuation">&#123;</span>    &lt;<span class="token url"><span class="token punctuation">&lt;</span>Enumeration<span class="token punctuation">></span></span>>    RED    BLUE    GREEN    WHITE    BLACK<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclass Shape{    << interface >>    noOfVertices    draw()}class Color{    << Enumeration >>    RED    BLUE    GREEN    WHITE    BLACK}</pre><blockquote><p>è¿™ç§æ–¹å¼åœ¨ç±»æ³¨é‡Š  <code>&lt;&lt;xxx&gt;&gt;</code>  ä¼šåœ¨htmlä¸­æŠ¥é”™, åœ¨ <code>&lt;&lt;&gt;&gt;</code> ä¸æ³¨é‡Šä¸­æ·»åŠ ç©ºæ ¼</p></blockquote><h2 id="æ³¨é‡Š">æ³¨é‡Š</h2><p>å¯ä»¥åœ¨ç±»å›¾ä¸­è¾“å…¥æ³¨é‡Šï¼Œè§£æå™¨å°†å¿½ç•¥è¯¥æ³¨é‡Šã€‚ æ³¨é‡Šéœ€è¦ç‹¬å ä¸€è¡Œï¼Œå¹¶ä¸”å¿…é¡»ä»¥ <code>%%</code>ï¼ˆåŒç™¾åˆ†å·ï¼‰å¼€å¤´ã€‚ ä¸‹ä¸€ä¸ªæ¢è¡Œç¬¦ä¹‹å‰çš„ä»»ä½•æ–‡æœ¬éƒ½å°†è¢«è§†ä¸ºæ³¨é‡Šï¼ŒåŒ…æ‹¬ä»»ä½•ç±»å›¾è¯­æ³•ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram%% This whole line is <span class="token keyword">a</span> comment classDiagram class Shapeclass Shape<span class="token punctuation">&#123;</span>    &lt;<span class="token url"><span class="token punctuation">&lt;</span>interface<span class="token punctuation">></span></span>>    noOfVertices    draw<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram%% This whole line is a comment classDiagram class Shape << interface >>class Shape{<< interface >>    noOfVertices    draw()}</pre><h2 id="è®¾ç½®å›¾è¡¨çš„æ–¹å‘">è®¾ç½®å›¾è¡¨çš„æ–¹å‘</h2><p>å¯¹äºç±»å›¾ï¼Œä½ å¯ä»¥ä½¿ç”¨æ–¹å‘è¯­å¥æ¥è®¾ç½®å›¾æ¸²æŸ“çš„æ–¹å‘ï¼š</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram  direction RL  class Student <span class="token punctuation">&#123;</span>    -idCard <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> IdCard  <span class="token punctuation">&#125;</span>  class IdCard<span class="token punctuation">&#123;</span>    -id <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> int    -name <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> string  <span class="token punctuation">&#125;</span>  class Bike<span class="token punctuation">&#123;</span>    -id <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> int    -name <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> string  <span class="token punctuation">&#125;</span>  Student <span class="token string">"1"</span> --o <span class="token string">"1"</span> IdCard <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> carries  Student <span class="token string">"1"</span> --o <span class="token string">"1"</span> Bike <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> rides<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram  direction RL  class Student {    -idCard : IdCard  }  class IdCard{    -id : int    -name : string  }  class Bike{    -id : int    -name : string  }  Student "1" --o "1" IdCard : carries  Student "1" --o "1" Bike : rides</pre><h2 id="ç›¸äº’ä½œç”¨">ç›¸äº’ä½œç”¨</h2><p>å¯ä»¥å°†å•å‡»äº‹ä»¶ç»‘å®šåˆ°èŠ‚ç‚¹ã€‚ å•å‡»å¯èƒ½ä¼šå¯¼è‡´ JavaScript å›è°ƒæˆ–å¯¼è‡´åœ¨æ–°æµè§ˆå™¨é€‰é¡¹å¡ä¸­æ‰“å¼€çš„é“¾æ¥ã€‚ <strong>æ³¨æ„</strong>ï¼š ä½¿ç”¨ <code>securityLevel='strict'</code> æ—¶ç¦ç”¨æ­¤åŠŸèƒ½ï¼Œä½¿ç”¨ <code>securityLevel='loose'</code> æ—¶å¯ç”¨æ­¤åŠŸèƒ½ã€‚</p><p>å£°æ˜æ‰€æœ‰ç±»åï¼Œä½ å¯ä»¥åœ¨å•ç‹¬çš„è¡Œä¸Šå®šä¹‰è¿™äº›æ“ä½œã€‚</p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">action className <span class="token string">"reference"</span> <span class="token string">"tooltip"</span>click className call callback<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token string">"tooltip"</span>click className href <span class="token string">"url"</span> <span class="token string">"tooltip"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>action æ˜¯ <code>link</code> æˆ– <code>callback</code>ï¼Œå…·ä½“å–å†³äºä½ æƒ³è¦è°ƒç”¨çš„äº¤äº’ç±»å‹</li><li>className æ˜¯ä¸æ“ä½œå…³è”çš„èŠ‚ç‚¹çš„ id</li><li>Reference å¯ä»¥æ˜¯ url é“¾æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å›è°ƒçš„å‡½æ•°åç§°ã€‚</li><li>ï¼ˆå¯é€‰ï¼‰tooltip æ˜¯å½“é¼ æ ‡æ‚¬åœåœ¨å…ƒç´ ä¸Šæ—¶è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ï¼ˆæ³¨æ„ï¼štooltip çš„æ ·å¼ç”±ç±».mermaidTooltip è®¾ç½®ã€‚ï¼‰</li><li>note: å°†ä»¥ nodeId ä½œä¸ºå‚æ•°è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</li></ul><h2 id="å›¾è¡¨æ³¨é‡Š">å›¾è¡¨æ³¨é‡Š</h2><p>å¯ä»¥ä½¿ç”¨ <code>note &quot;line1\nline2&quot;</code> åœ¨å›¾è¡¨ä¸Šæ·»åŠ æ³¨é‡Šã€‚ å¯ä»¥ä½¿ç”¨ <code>note for &lt;CLASS NAME&gt; &quot;line1\nline2&quot;</code> ä¸ºç‰¹å®šç±»æ·»åŠ æ³¨é‡Šã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram    note <span class="token string">"This is a general note"</span>    note for Student <span class="token string">"This is a note for a class"</span>    class Student<span class="token punctuation">&#123;</span>    +String name    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram    note "This is a general note"    note for Student "This is a note for a class"    class Student{    +String name    }</pre><h2 id="ç½‘å€é“¾æ¥">ç½‘å€é“¾æ¥</h2><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagramclass Shapelink Shape <span class="token string">"https://www.github.com"</span> <span class="token string">"This is a tooltip for a link"</span>class Shape2click Shape2 href <span class="token string">"https://www.github.com"</span> <span class="token string">"This is a tooltip for a link"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagramclass Shapelink Shape "https://www.github.com" "This is a tooltip for a link"class Shape2click Shape2 href "https://www.github.com" "This is a tooltip for a link"</pre><h2 id="æ ·å¼">æ ·å¼</h2><h3 id="è®¾ç½®èŠ‚ç‚¹æ ·å¼-v-MERMAID-RELEASE-VERSION">è®¾ç½®èŠ‚ç‚¹æ ·å¼ (v&lt;MERMAID_RELEASE_VERSION&gt;+)</h3><p>å¯ä»¥ä½¿ç”¨ <code>style</code> å…³é”®å­—å°†ç‰¹å®šæ ·å¼ï¼ˆä¾‹å¦‚è¾ƒç²—çš„è¾¹æ¡†æˆ–ä¸åŒçš„èƒŒæ™¯é¢œè‰²ï¼‰åº”ç”¨äºå•ä¸ªèŠ‚ç‚¹ã€‚</p><p><strong>Code:</strong></p><pre class="line-numbers language-turtle" data-language="turtle"><code class="language-turtle">classDiagram  class Animal  class Mineral  style Animal <span class="token function"><span class="token prefix">fill<span class="token punctuation">:</span></span></span><span class="token comment">#f9f,stroke:#333,stroke-width:4px</span>  style Mineral <span class="token function"><span class="token prefix">fill<span class="token punctuation">:</span></span></span><span class="token comment">#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="mermaid">classDiagram  class Animal  class Mineral  style Animal fill:#f9f,stroke:#333,stroke-width:4px  style Mineral fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5</pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mermaid </tag>
            
            <tag> Markdown </tag>
            
            <tag> UML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-01-æ¦‚è¿°</title>
      <link href="/2024/01/19/design-pattern/"/>
      <url>/2024/01/19/design-pattern/</url>
      
        <content type="html"><![CDATA[<h1>è®¾è®¡æ¨¡å¼æ¦‚è¿°</h1><h2 id="1-è®¾è®¡æ¨¡å¼åˆ†ç±»">1-è®¾è®¡æ¨¡å¼åˆ†ç±»</h2><ul><li><p><strong>åˆ›å»ºå‹æ¨¡å¼</strong></p><p>ç”¨äºæè¿°â€œæ€æ ·åˆ›å»ºå¯¹è±¡â€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚GoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†å•ä¾‹ã€åŸå‹ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€å»ºé€ è€…ç­‰ 5 ç§åˆ›å»ºå‹æ¨¡å¼ã€‚</p></li><li><p><strong>ç»“æ„å‹æ¨¡å¼</strong></p><p>ç”¨äºæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ï¼ŒGoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†ä»£ç†ã€é€‚é…å™¨ã€æ¡¥æ¥ã€è£…é¥°ã€å¤–è§‚ã€äº«å…ƒã€ç»„åˆç­‰ 7 ç§ç»“æ„å‹æ¨¡å¼ã€‚</p></li><li><p><strong>è¡Œä¸ºå‹æ¨¡å¼</strong></p><p>ç”¨äºæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚GoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†æ¨¡æ¿æ–¹æ³•ã€ç­–ç•¥ã€å‘½ä»¤ã€èŒè´£é“¾ã€çŠ¶æ€ã€è§‚å¯Ÿè€…ã€ä¸­ä»‹è€…ã€è¿­ä»£å™¨ã€è®¿é—®è€…ã€å¤‡å¿˜å½•ã€è§£é‡Šå™¨ç­‰ 11 ç§è¡Œä¸ºå‹æ¨¡å¼ã€‚</p></li></ul><h2 id="2-UMLå›¾">2-UMLå›¾</h2><p>ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUnified Modeling Languageï¼ŒUMLï¼‰æ˜¯ç”¨æ¥è®¾è®¡è½¯ä»¶çš„å¯è§†åŒ–å»ºæ¨¡è¯­è¨€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ç®€å•ã€ç»Ÿä¸€ã€å›¾å½¢åŒ–ã€èƒ½è¡¨è¾¾è½¯ä»¶è®¾è®¡ä¸­çš„åŠ¨æ€ä¸é™æ€ä¿¡æ¯ã€‚</p><p>UML ä»ç›®æ ‡ç³»ç»Ÿçš„ä¸åŒè§’åº¦å‡ºå‘ï¼Œå®šä¹‰äº†ç”¨ä¾‹å›¾ã€ç±»å›¾ã€å¯¹è±¡å›¾ã€çŠ¶æ€å›¾ã€æ´»åŠ¨å›¾ã€æ—¶åºå›¾ã€åä½œå›¾ã€æ„ä»¶å›¾ã€éƒ¨ç½²å›¾ç­‰ 9 ç§å›¾ã€‚</p><h3 id="2-1-ç±»å›¾æ¦‚è¿°">2.1 ç±»å›¾æ¦‚è¿°</h3><p>ç±»å›¾(Class diagram)æ˜¯æ˜¾ç¤ºäº†æ¨¡å‹çš„é™æ€ç»“æ„ï¼Œç‰¹åˆ«æ˜¯æ¨¡å‹ä¸­å­˜åœ¨çš„ç±»ã€ç±»çš„å†…éƒ¨ç»“æ„ä»¥åŠå®ƒä»¬ä¸å…¶ä»–ç±»çš„å…³ç³»ç­‰ã€‚ç±»å›¾ä¸æ˜¾ç¤ºæš‚æ—¶æ€§çš„ä¿¡æ¯ã€‚ç±»å›¾æ˜¯é¢å‘å¯¹è±¡å»ºæ¨¡çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚</p><h3 id="2-2-ç±»å›¾çš„ä½œç”¨">2.2 ç±»å›¾çš„ä½œç”¨</h3><ul><li>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œç±»å›¾æ˜¯ä¸€ç§é™æ€çš„ç»“æ„å›¾ï¼Œæè¿°äº†ç³»ç»Ÿçš„ç±»çš„é›†åˆï¼Œç±»çš„å±æ€§å’Œç±»ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥ç®€åŒ–äº†äººä»¬å¯¹ç³»ç»Ÿçš„ç†è§£ï¼›</li><li>ç±»å›¾æ˜¯ç³»ç»Ÿåˆ†æå’Œè®¾è®¡é˜¶æ®µçš„é‡è¦äº§ç‰©ï¼Œæ˜¯ç³»ç»Ÿç¼–ç å’Œæµ‹è¯•çš„é‡è¦æ¨¡å‹ã€‚</li></ul><h3 id="2-3-ç±»å›¾è¡¨ç¤ºæ³•">2.3 ç±»å›¾è¡¨ç¤ºæ³•</h3><h4 id="ç±»çš„è¡¨ç¤ºæ–¹å¼">ç±»çš„è¡¨ç¤ºæ–¹å¼</h4><p>åœ¨UMLç±»å›¾ä¸­ï¼Œç±»ä½¿ç”¨åŒ…å«ç±»åã€å±æ€§(field) å’Œæ–¹æ³•(method) ä¸”å¸¦æœ‰åˆ†å‰²çº¿çš„çŸ©å½¢æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ª Employee ç±»ï¼Œå®ƒåŒ…å« name,age å’Œ address è¿™3ä¸ªå±æ€§ï¼Œä»¥åŠ work() æ–¹æ³•ã€‚</p><pre class="mermaid">classDiagramclass Employee{- name : String- age : int- address : String+ work() void}</pre><p>å±æ€§/æ–¹æ³•åç§°å‰åŠ çš„åŠ å·å’Œå‡å·è¡¨ç¤ºäº†è¿™ä¸ªå±æ€§/æ–¹æ³•çš„å¯è§æ€§ï¼ŒUMLç±»å›¾ä¸­è¡¨ç¤ºå¯è§æ€§çš„ç¬¦å·æœ‰ä¸‰ç§ï¼š</p><ul><li><p>+ï¼šè¡¨ç¤º public</p></li><li><p>-ï¼šè¡¨ç¤º private</p></li><li><p>#ï¼šè¡¨ç¤º protected</p></li></ul><p>å±æ€§çš„å®Œæ•´è¡¨ç¤ºæ–¹å¼æ˜¯ï¼š <strong>å¯è§æ€§  åç§° ï¼šç±»å‹ [ = ç¼ºçœå€¼]</strong></p><p>æ–¹æ³•çš„å®Œæ•´è¡¨ç¤ºæ–¹å¼æ˜¯ï¼š <strong>å¯è§æ€§  åç§°(å‚æ•°åˆ—è¡¨) [ ï¼š è¿”å›ç±»å‹]</strong></p><blockquote><p>æ³¨æ„ï¼š</p><ol><li>ä¸­æ‹¬å·ä¸­çš„å†…å®¹è¡¨ç¤ºæ˜¯å¯é€‰çš„</li><li>ä¹Ÿæœ‰å°†ç±»å‹æ”¾åœ¨å˜é‡åå‰é¢ï¼Œè¿”å›å€¼ç±»å‹æ”¾åœ¨æ–¹æ³•åå‰é¢</li></ol></blockquote><p><strong>ä¸¾ä¸ªä¾‹å­</strong></p><pre class="mermaid">classDiagramclass Demo{+ method() void- method1() String# method2(int part1, String par2) int}</pre><p>ä¸Šå›¾Demoç±»å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li>method() æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸º publicï¼Œæ²¡æœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</li><li>method1() æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸º privateï¼Œæ²¡æœ‰å‚æ•°ï¼Œè¿”å›å€¼ç±»å‹ä¸ºStringã€‚</li><li>method2() æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸º protectedï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹ä¸º intï¼Œç¬¬äºŒä¸ªå‚æ•°ç±»å‹ä¸º Stringï¼Œè¿”å›å€¼ç±»å‹æ˜¯ intã€‚</li></ul><h4 id="ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„è¡¨ç¤ºæ–¹å¼">ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„è¡¨ç¤ºæ–¹å¼</h4><h5 id="â… -å…³è”å…³ç³»">â…  å…³è”å…³ç³»</h5><p>å…³è”å…³ç³»æ˜¯å¯¹è±¡ä¹‹é—´çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œç”¨äºè¡¨ç¤ºä¸€ç±»å¯¹è±¡ä¸å¦ä¸€ç±»å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œå¦‚è€å¸ˆå’Œå­¦ç”Ÿã€å¸ˆå‚…å’Œå¾’å¼Ÿã€ä¸ˆå¤«å’Œå¦»å­ç­‰ã€‚å…³è”å…³ç³»æ˜¯ç±»ä¸ç±»ä¹‹é—´æœ€å¸¸ç”¨çš„ä¸€ç§å…³ç³»ï¼Œåˆ†ä¸ºä¸€èˆ¬å…³è”å…³ç³»ã€èšåˆå…³ç³»å’Œç»„åˆå…³ç³»ã€‚æˆ‘ä»¬å…ˆä»‹ç»ä¸€èˆ¬å…³è”ã€‚</p><p>å…³è”åˆå¯ä»¥åˆ†ä¸ºå•å‘å…³è”ï¼ŒåŒå‘å…³è”ï¼Œè‡ªå…³è”ã€‚</p><ol><li>å•å‘å…³è”</li></ol><pre class="mermaid">classDiagramclass Customer{- address: Address}class Address{}Address <-- Customer</pre><p>åœ¨UMLç±»å›¾ä¸­å•å‘å…³è”ç”¨ä¸€ä¸ªå¸¦ç®­å¤´çš„å®çº¿è¡¨ç¤ºã€‚ä¸Šå›¾è¡¨ç¤ºæ¯ä¸ªé¡¾å®¢éƒ½æœ‰ä¸€ä¸ªåœ°å€ï¼Œè¿™é€šè¿‡è®© Customer ç±»æŒæœ‰ä¸€ä¸ªç±»å‹ä¸º Address çš„æˆå‘˜å˜é‡ç±»å®ç°ã€‚</p><ol start="2"><li>åŒå‘å…³è”</li></ol><pre class="mermaid">classDiagramclass Customer{- products: list~Product~}class Product{- customer: Customer}Customer -- Product</pre><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œæ‰€è°“çš„åŒå‘å…³è”å°±æ˜¯åŒæ–¹å„è‡ªæŒæœ‰å¯¹æ–¹ç±»å‹çš„æˆå‘˜å˜é‡ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼ŒåŒå‘å…³è”ç”¨ä¸€ä¸ªä¸å¸¦ç®­å¤´çš„ç›´çº¿è¡¨ç¤ºã€‚ä¸Šå›¾ä¸­åœ¨ Customer ç±»ä¸­ç»´æŠ¤ä¸€ä¸ª List&lt;Product&gt;ï¼Œè¡¨ç¤ºä¸€ä¸ªé¡¾å®¢å¯ä»¥è´­ä¹°å¤šä¸ªå•†å“ï¼›åœ¨ Product ç±»ä¸­ç»´æŠ¤ä¸€ä¸ª Customer ç±»å‹çš„æˆå‘˜å˜é‡è¡¨ç¤ºè¿™ä¸ªäº§å“è¢«å“ªä¸ªé¡¾å®¢æ‰€è´­ä¹°ã€‚</p><ol start="3"><li>è‡ªå…³è”</li></ol><pre class="mermaid">classDiagramclass Node{- subNode: Node}Node --> Node</pre><p>è‡ªå…³è”åœ¨UMLç±»å›¾ä¸­ç”¨ä¸€ä¸ªå¸¦æœ‰ç®­å¤´ä¸”æŒ‡å‘è‡ªèº«çš„çº¿è¡¨ç¤ºã€‚ä¸Šå›¾çš„æ„æ€å°±æ˜¯ Node ç±»åŒ…å«ç±»å‹ä¸º Node çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯â€œè‡ªå·±åŒ…å«è‡ªå·±â€ã€‚</p><h5 id="â…¡-èšåˆå…³ç³»">â…¡ èšåˆå…³ç³»</h5><p>èšåˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ï¼Œæ˜¯å¼ºå…³è”å…³ç³»ï¼Œæ˜¯æ•´ä½“å’Œéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»ã€‚</p><p>èšåˆå…³ç³»ä¹Ÿæ˜¯é€šè¿‡æˆå‘˜å¯¹è±¡æ¥å®ç°çš„ï¼Œå…¶ä¸­æˆå‘˜å¯¹è±¡æ˜¯æ•´ä½“å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æˆå‘˜å¯¹è±¡å¯ä»¥è„±ç¦»æ•´ä½“å¯¹è±¡è€Œç‹¬ç«‹å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå­¦æ ¡ä¸è€å¸ˆçš„å…³ç³»ï¼Œå­¦æ ¡åŒ…å«è€å¸ˆï¼Œä½†å¦‚æœå­¦æ ¡åœåŠäº†ï¼Œè€å¸ˆä¾ç„¶å­˜åœ¨ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œèšåˆå…³ç³»å¯ä»¥ç”¨å¸¦ç©ºå¿ƒè±å½¢çš„å®çº¿æ¥è¡¨ç¤ºï¼Œè±å½¢æŒ‡å‘æ•´ä½“ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¤§å­¦å’Œæ•™å¸ˆçš„å…³ç³»å›¾ï¼š</p><pre class="mermaid">classDiagramclass University {- teas : List~Teacher~}class Teacher {- name : String+ teach() void}University o-- Teacher</pre><h5 id="â…¢-ç»„åˆå…³ç³»">â…¢ ç»„åˆå…³ç³»</h5><p>ç»„åˆè¡¨ç¤ºç±»ä¹‹é—´çš„æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œä½†å®ƒæ˜¯ä¸€ç§æ›´å¼ºçƒˆçš„èšåˆå…³ç³»ã€‚</p><p>åœ¨ç»„åˆå…³ç³»ä¸­ï¼Œæ•´ä½“å¯¹è±¡å¯ä»¥æ§åˆ¶éƒ¨åˆ†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€æ—¦æ•´ä½“å¯¹è±¡ä¸å­˜åœ¨ï¼Œéƒ¨åˆ†å¯¹è±¡ä¹Ÿå°†ä¸å­˜åœ¨ï¼Œéƒ¨åˆ†å¯¹è±¡ä¸èƒ½è„±ç¦»æ•´ä½“å¯¹è±¡è€Œå­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå¤´å’Œå˜´çš„å…³ç³»ï¼Œæ²¡æœ‰äº†å¤´ï¼Œå˜´ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œç»„åˆå…³ç³»ç”¨å¸¦å®å¿ƒè±å½¢çš„å®çº¿æ¥è¡¨ç¤ºï¼Œè±å½¢æŒ‡å‘æ•´ä½“ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¤´å’Œå˜´çš„å…³ç³»å›¾ï¼š</p><pre class="mermaid">classDiagramclass Head{- mouth : Mouth}class Mouth {+ eat() void}Head *-- Mouth</pre><h5 id="â…£-ä¾èµ–å…³ç³»ğŸ‘">â…£ ä¾èµ–å…³ç³»ğŸ‘</h5><p>ä¾èµ–å…³ç³»æ˜¯ä¸€ç§ä½¿ç”¨å…³ç³»ï¼Œå®ƒæ˜¯å¯¹è±¡ä¹‹é—´<strong>è€¦åˆåº¦æœ€å¼±</strong>çš„ä¸€ç§å…³è”æ–¹å¼ï¼Œæ˜¯ä¸´æ—¶æ€§çš„å…³è”ã€‚åœ¨ä»£ç ä¸­ï¼ŒæŸä¸ªç±»çš„æ–¹æ³•é€šè¿‡å±€éƒ¨å˜é‡ã€æ–¹æ³•çš„å‚æ•°æˆ–è€…å¯¹é™æ€æ–¹æ³•çš„è°ƒç”¨æ¥è®¿é—®å¦ä¸€ä¸ªç±»ï¼ˆè¢«ä¾èµ–ç±»ï¼‰ä¸­çš„æŸäº›æ–¹æ³•æ¥å®Œæˆä¸€äº›èŒè´£ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œä¾èµ–å…³ç³»ä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»ä½¿ç”¨ç±»æŒ‡å‘è¢«ä¾èµ–çš„ç±»ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¸æœºå’Œæ±½è½¦çš„å…³ç³»å›¾ï¼Œå¸æœºé©¾é©¶æ±½è½¦ï¼š</p><pre class="mermaid">classDiagramclass Driver {- name : String+ drive(Car car) void}class Car {+ move() void}Driver ..> Carlink Driver "#drive(Car car)" "method"</pre><h6 id="drive-Car-car">drive(Car car)</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token class-name">Car</span> car<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    car<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ±½è½¦ç§»åŠ¨</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="â…¤-ç»§æ‰¿å…³ç³»ğŸ‘">â…¤ ç»§æ‰¿å…³ç³»ğŸ‘</h5><p>ç»§æ‰¿å…³ç³»æ˜¯å¯¹è±¡ä¹‹é—´<strong>è€¦åˆåº¦æœ€å¤§</strong>çš„ä¸€ç§å…³ç³»ï¼Œè¡¨ç¤ºä¸€èˆ¬ä¸ç‰¹æ®Šçš„å…³ç³»ï¼Œæ˜¯çˆ¶ç±»ä¸å­ç±»ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯ä¸€ç§ç»§æ‰¿å…³ç³»ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œæ³›åŒ–å…³ç³»ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„å®çº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»å­ç±»æŒ‡å‘çˆ¶ç±»ã€‚åœ¨ä»£ç å®ç°æ—¶ï¼Œä½¿ç”¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿æœºåˆ¶æ¥å®ç°æ³›åŒ–å…³ç³»ã€‚ä¾‹å¦‚ï¼ŒStudent ç±»å’Œ Teacher ç±»éƒ½æ˜¯ Person ç±»çš„å­ç±»ï¼Œå…¶ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><pre class="mermaid">classDiagramclass Person {- name : String- age : int+ speak() void}class Student {- studentNo : String+ study() void}class Teacher {- teacherNo : String+ teach() void}Person <|-- StudentPerson <|-- Teacher</pre><h5 id="â…¥-å®ç°å…³ç³»">â…¥ å®ç°å…³ç³»</h5><p>å®ç°å…³ç³»æ˜¯æ¥å£ä¸å®ç°ç±»ä¹‹é—´çš„å…³ç³»ã€‚åœ¨è¿™ç§å…³ç³»ä¸­ï¼Œç±»å®ç°äº†æ¥å£ï¼Œç±»ä¸­çš„æ“ä½œå®ç°äº†æ¥å£ä¸­æ‰€å£°æ˜çš„æ‰€æœ‰çš„æŠ½è±¡æ“ä½œã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œå®ç°å…³ç³»ä½¿ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„è™šçº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»å®ç°ç±»æŒ‡å‘æ¥å£ã€‚ä¾‹å¦‚ï¼Œæ±½è½¦å’Œèˆ¹å®ç°äº†äº¤é€šå·¥å…·ï¼Œå…¶ç±»å›¾å¦‚å›¾æ‰€ç¤ºã€‚</p><pre class="mermaid">classDiagramclass Vehicle {<< Interface >>+ move() void}class Car {+ move() void}class Ship {+ move() void}Vehicle <|.. CarVehicle <|.. Ship</pre><h2 id="3-è½¯ä»¶è®¾è®¡åŸåˆ™">3-è½¯ä»¶è®¾è®¡åŸåˆ™</h2><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸ºäº†æé«˜è½¯ä»¶ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ï¼Œå¢åŠ è½¯ä»¶çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œç¨‹åºå‘˜è¦å°½é‡æ ¹æ®6æ¡åŸåˆ™æ¥å¼€å‘ç¨‹åºï¼Œä»è€Œæé«˜è½¯ä»¶å¼€å‘æ•ˆç‡ã€èŠ‚çº¦è½¯ä»¶å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚</p><h3 id="3-1-å¼€é—­åŸåˆ™">3.1 å¼€é—­åŸåˆ™</h3><p><strong>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</strong>ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚</p><p>æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ã€‚</p><p>å› ä¸ºæŠ½è±¡çµæ´»æ€§å¥½ï¼Œé€‚åº”æ€§å¹¿ï¼Œåªè¦æŠ½è±¡çš„åˆç†ï¼Œå¯ä»¥åŸºæœ¬ä¿æŒè½¯ä»¶æ¶æ„çš„ç¨³å®šã€‚è€Œè½¯ä»¶ä¸­æ˜“å˜çš„ç»†èŠ‚å¯ä»¥ä»æŠ½è±¡æ´¾ç”Ÿæ¥çš„å®ç°ç±»æ¥è¿›è¡Œæ‰©å±•ï¼Œå½“è½¯ä»¶éœ€è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªéœ€è¦æ ¹æ®éœ€æ±‚é‡æ–°æ´¾ç”Ÿä¸€ä¸ªå®ç°ç±»æ¥æ‰©å±•å°±å¯ä»¥äº†ã€‚</p><p>ä¸‹é¢ä»¥ <code>æœç‹—è¾“å…¥æ³•</code> çš„çš®è‚¤ä¸ºä¾‹ä»‹ç»å¼€é—­åŸåˆ™çš„åº”ç”¨ã€‚</p><p>ã€ä¾‹ã€‘<code>æœç‹—è¾“å…¥æ³•</code> çš„çš®è‚¤è®¾è®¡ã€‚</p><p>åˆ†æï¼š<code>æœç‹—è¾“å…¥æ³•</code> çš„çš®è‚¤æ˜¯è¾“å…¥æ³•èƒŒæ™¯å›¾ç‰‡ã€çª—å£é¢œè‰²å’Œå£°éŸ³ç­‰å…ƒç´ çš„ç»„åˆã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œçˆ±æ›´æ¢è‡ªå·±çš„è¾“å…¥æ³•çš„çš®è‚¤ï¼Œä¹Ÿå¯ä»¥ä»ç½‘ä¸Šä¸‹è½½æ–°çš„çš®è‚¤ã€‚è¿™äº›çš®è‚¤æœ‰å…±åŒçš„ç‰¹ç‚¹ï¼Œå¯ä»¥ä¸ºå…¶å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆAbstractSkinï¼‰ï¼Œè€Œæ¯ä¸ªå…·ä½“çš„çš®è‚¤ï¼ˆDefaultSpecificSkin å’Œ DiySpecificSkinï¼‰æ˜¯å…¶å­ç±»ã€‚ç”¨æˆ·çª—ä½“å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æˆ–è€…å¢åŠ æ–°çš„ä¸»é¢˜ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åŸä»£ç ï¼Œæ‰€ä»¥å®ƒæ˜¯æ»¡è¶³å¼€é—­åŸåˆ™çš„ã€‚</p><pre class="mermaid">classDiagramclass AbstractSkin {+ display() void}class SouGouInput {+ skin : AbstractSkin+ display() void}class DefaultSpecificSkin {+ display() void}class DiySpecificSkin {+ display() void}SouGouInput o-- AbstractSkinAbstractSkin <|-- DefaultSpecificSkinAbstractSkin <|-- DiySpecificSkin</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æŠ½è±¡çš®è‚¤ç±»</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractSkin</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ˜¾ç¤ºçš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é»˜è®¤çš®è‚¤</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSkin</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSkin</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é»˜è®¤çš®è‚¤"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//diyçš®è‚¤</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DiySkin</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSkin</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"diyçš®è‚¤"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æœç‹—è¾“å…¥æ³•</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SougouInput</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">AbstractSkin</span> skin<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSkin</span><span class="token punctuation">(</span><span class="token class-name">AbstractSkin</span> skin<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>skin <span class="token operator">=</span> skin<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        skin<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1,åˆ›å»ºæœç‹—è¾“å…¥æ³•å¯¹è±¡</span>        <span class="token class-name">SougouInput</span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SougouInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2,åˆ›å»ºçš®è‚¤å¯¹è±¡</span>        <span class="token comment">//DefaultSkin skin = new DefaultSkin();</span>        <span class="token class-name">DiySkin</span> skin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DiySkin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3,å°†çš®è‚¤è®¾ç½®åˆ°è¾“å…¥æ³•ä¸­</span>        input<span class="token punctuation">.</span><span class="token function">setSkin</span><span class="token punctuation">(</span>skin<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//4,æ˜¾ç¤ºçš®è‚¤</span>        input<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-é‡Œæ°ä»£æ¢åŸåˆ™">3.2 é‡Œæ°ä»£æ¢åŸåˆ™</h3><p>é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚</p><p>é‡Œæ°ä»£æ¢åŸåˆ™ï¼š<strong>ä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°</strong>ã€‚é€šä¿—ç†è§£ï¼šå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚æ¢å¥è¯è¯´ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œé™¤æ·»åŠ æ–°çš„æ–¹æ³•å®Œæˆæ–°å¢åŠŸèƒ½å¤–ï¼Œå°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚</p><p>å¦‚æœé€šè¿‡é‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥å®Œæˆæ–°çš„åŠŸèƒ½ï¼Œè¿™æ ·å†™èµ·æ¥è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æ•´ä¸ªç»§æ‰¿ä½“ç³»çš„å¯å¤ç”¨æ€§ä¼šæ¯”è¾ƒå·®ï¼Œç‰¹åˆ«æ˜¯è¿ç”¨å¤šæ€æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œç¨‹åºè¿è¡Œå‡ºé”™çš„æ¦‚ç‡ä¼šéå¸¸å¤§ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªé‡Œæ°æ›¿æ¢åŸåˆ™ä¸­ç»å…¸çš„ä¸€ä¸ªä¾‹å­</p><p>ã€ä¾‹ã€‘æ­£æ–¹å½¢ä¸æ˜¯é•¿æ–¹å½¢ã€‚</p><p>åœ¨æ•°å­¦é¢†åŸŸé‡Œï¼Œæ­£æ–¹å½¢æ¯«æ— ç–‘é—®æ˜¯é•¿æ–¹å½¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªé•¿å®½ç›¸ç­‰çš„é•¿æ–¹å½¢ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼€å‘çš„ä¸€ä¸ªä¸å‡ ä½•å›¾å½¢ç›¸å…³çš„è½¯ä»¶ç³»ç»Ÿï¼Œå°±å¯ä»¥é¡ºç†æˆç« çš„è®©æ­£æ–¹å½¢ç»§æ‰¿è‡ªé•¿æ–¹å½¢ã€‚</p><h4 id="æ”¹è¿›å‰">æ”¹è¿›å‰</h4><pre class="mermaid">classDiagramclass Rectangle {- length : double- width : double+ setLength(double length) void+ getLength() double+ setWidth(double width) void+ getWidth() double}class RectangleDemo {+ resize(Rectangle rectangle) void+ printLengthAndWidth(Rectangle rectangle) void}class Square {+ setWidth(double width) void+ setLength(double length) void}Rectangle <|-- Square: ç»§æ‰¿Rectangle <.. RectangleDemo: ä¾èµ–</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é•¿æ–¹å½¢ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> length<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> width<span class="token punctuation">;</span><span class="token comment">//çœç•¥ get set æ–¹æ³•...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ­£æ–¹å½¢ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token keyword">extends</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLength</span><span class="token punctuation">(</span><span class="token keyword">double</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token keyword">double</span> width<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»(æ³¨æ„,ç”±äºæ²¡æœ‰éµå¾ªé‡Œæ°ä»£æ¢åŸåˆ™,è¯¥ç¨‹åºä¼šä¸€ç›´è¿›è¡Œä¸‹å»,ç›´è‡³æº¢å‡º)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RectangleDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºé•¿æ–¹å½¢å¯¹è±¡</span>        <span class="token class-name">Rectangle</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®é•¿å’Œå®½</span>        r<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®½</span>        <span class="token function">resize</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printLengthAndWidth</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ‰“å°</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºæ­£æ–¹å½¢å¯¹è±¡</span>        <span class="token class-name">Square</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Square</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®é•¿å’Œå®½</span>        s<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®½</span>        <span class="token function">resize</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printLengthAndWidth</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ‰“å°</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰©å®½æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token class-name">Rectangle</span> rectangle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ¤æ–­å®½å¦‚æœæ¯”é•¿å°ï¼Œè¿›è¡Œæ‰©å®½çš„æ“ä½œ</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> rectangle<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            rectangle<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰“å°é•¿å’Œå®½</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printLengthAndWidth</span><span class="token punctuation">(</span><span class="token class-name">Rectangle</span> rectangle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¿™æ®µä»£ç å°±ä¼šå‘ç°ï¼Œå‡å¦‚æˆ‘ä»¬æŠŠä¸€ä¸ªæ™®é€šé•¿æ–¹å½¢ä½œä¸ºå‚æ•°ä¼ å…¥ resize æ–¹æ³•ï¼Œå°±ä¼šçœ‹åˆ°é•¿æ–¹å½¢å®½åº¦é€æ¸å¢é•¿çš„æ•ˆæœï¼Œå½“å®½åº¦å¤§äºé•¿åº¦,ä»£ç å°±ä¼šåœæ­¢ï¼Œè¿™ç§è¡Œä¸ºçš„ç»“æœç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼›å‡å¦‚æˆ‘ä»¬å†æŠŠä¸€ä¸ªæ­£æ–¹å½¢ä½œä¸ºå‚æ•°ä¼ å…¥ resize æ–¹æ³•åï¼Œå°±ä¼šçœ‹åˆ°æ­£æ–¹å½¢çš„å®½åº¦å’Œé•¿åº¦éƒ½åœ¨ä¸æ–­å¢é•¿ï¼Œä»£ç ä¼šä¸€ç›´è¿è¡Œä¸‹å»ï¼Œç›´è‡³ç³»ç»Ÿäº§ç”Ÿæº¢å‡ºé”™è¯¯ã€‚æ‰€ä»¥ï¼Œæ™®é€šçš„é•¿æ–¹å½¢æ˜¯é€‚åˆè¿™æ®µä»£ç çš„ï¼Œæ­£æ–¹å½¢ä¸é€‚åˆã€‚<br>æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šåœ¨ resize æ–¹æ³•ä¸­ï¼ŒRectangle ç±»å‹çš„å‚æ•°æ˜¯ä¸èƒ½è¢« Square ç±»å‹çš„å‚æ•°æ‰€ä»£æ›¿ï¼Œå¦‚æœè¿›è¡Œäº†æ›¿æ¢å°±å¾—ä¸åˆ°é¢„æœŸç»“æœã€‚å› æ­¤ï¼Œ<strong>Square ç±»å’Œ Rectangle ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»è¿åäº†é‡Œæ°ä»£æ¢åŸåˆ™ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ä¸æˆç«‹ï¼Œæ­£æ–¹å½¢ä¸æ˜¯é•¿æ–¹å½¢ã€‚</strong></p><p>å¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°è®¾è®¡ä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚æŠ½è±¡å‡ºæ¥ä¸€ä¸ªå››è¾¹å½¢æ¥å£(Quadrilateral)ï¼Œè®© Rectangle ç±»å’Œ Square ç±»å®ç° Quadrilateral æ¥å£</p><h4 id="æ”¹è¿›å">æ”¹è¿›å</h4><pre class="mermaid">classDiagramclass Quadrilateral {<<interface>>+ getLength() double+ getWidth() double}class RectangleDemo {+ resize(Rectangle rectangle) void+ printLengthAndWidth(Quadrilateral quadrilateral) void}class Square {- size : double+ getLength() double+ getWidth() double+ setSide(double size) void+ getSide() double}class Rectangle {- length : double- width : double+ setLength(double length) void+ getLength() double+ setWidth(double width) void+ getWidth() double}Quadrilateral <|.. Square : å®ç°Quadrilateral <|.. Rectangle : å®ç°RectangleDemo  <.. Quadrilateral : ä¾èµ–RectangleDemo <.. Rectangle : ä¾èµ–</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å››è¾¹å½¢æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Quadrilateral</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è·å–é•¿</span>    <span class="token keyword">double</span> <span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è·å–å®½</span>    <span class="token keyword">double</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ­£æ–¹å½¢ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token keyword">implements</span> <span class="token class-name">Quadrilateral</span> <span class="token punctuation">&#123;</span><span class="token comment">//è¾¹é•¿</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> side<span class="token punctuation">;</span><span class="token comment">//çœç•¥ get set...</span><span class="token comment">//é‡å†™æ¥å£</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> side<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> side<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é•¿æ–¹å½¢ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">implements</span> <span class="token class-name">Quadrilateral</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> length<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> width<span class="token punctuation">;</span><span class="token comment">//çœç•¥ get set...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æµ‹è¯•ç±»(é‡Œæ°ä»£æ¢åŸåˆ™)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RectangleDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºé•¿æ–¹å½¢å¯¹è±¡</span>        <span class="token class-name">Rectangle</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è°ƒç”¨æ–¹æ³•è¿›è¡Œæ‰©å®½æ“ä½œ</span>        <span class="token function">resize</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ‰“å°é•¿å®½</span>        <span class="token function">printLengthAndWidth</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰©å®½çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token class-name">Rectangle</span> rectangle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ¤æ–­å®½å¦‚æœæ¯”é•¿å°ï¼Œè¿›è¡Œæ‰©å®½çš„æ“ä½œ</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> rectangle<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            rectangle<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ‰“å°é•¿å’Œå®½</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printLengthAndWidth</span><span class="token punctuation">(</span><span class="token class-name">Quadrilateral</span> quadrilateral<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>quadrilateral<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>quadrilateral<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-ä¾èµ–å€’è½¬åŸåˆ™">3.3 ä¾èµ–å€’è½¬åŸåˆ™</h3><p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ç®€å•çš„è¯´å°±æ˜¯è¦æ±‚å¯¹æŠ½è±¡è¿›è¡Œç¼–ç¨‹ï¼Œä¸è¦å¯¹å®ç°è¿›è¡Œç¼–ç¨‹ï¼Œè¿™æ ·å°±é™ä½äº†å®¢æˆ·ä¸å®ç°æ¨¡å—é—´çš„è€¦åˆã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¾èµ–å€’è½¬åŸåˆ™</p><p>ã€ä¾‹ã€‘ç»„è£…ç”µè„‘</p><p>ç°è¦ç»„è£…ä¸€å°ç”µè„‘ï¼Œéœ€è¦é…ä»¶ cpuï¼Œç¡¬ç›˜ï¼Œå†…å­˜æ¡ã€‚åªæœ‰è¿™äº›é…ç½®éƒ½æœ‰äº†ï¼Œè®¡ç®—æœºæ‰èƒ½æ­£å¸¸çš„è¿è¡Œã€‚é€‰æ‹© cpu æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚ Intelï¼ŒAMD ç­‰ï¼Œç¡¬ç›˜å¯ä»¥é€‰æ‹©å¸Œæ·ï¼Œè¥¿æ•°ç­‰ï¼Œå†…å­˜æ¡å¯ä»¥é€‰æ‹©é‡‘å£«é¡¿ï¼Œæµ·ç›—èˆ¹ç­‰ã€‚</p><h4 id="æ”¹è¿›å‰-2">æ”¹è¿›å‰</h4><pre class="mermaid">classDiagramclass Computer {- hardDisk : XiJieHardDisk- cpu : IntelCpu- memory : KingstonMemory+ setHardDisk(XiJieHardDisk hardDisk) void+ getHardDisk() XiJieHardDisk+ setCpu(IntelCpu cpu) void+ getCpu() IntelCpu+ setMemory(KingstonMemory memory) void+ getMemory() KingstonMemory+ run() void}class XiJieHardDisk {+ save(String data) void+ get() String}class IntelCpu {+ run() void}class KingstonMemory {+ save() void}Computer *-- XiJieHardDisk : ç»„åˆComputer *-- IntelCpu : ç»„åˆComputer *-- KingstonMemory : ç»„åˆ</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¸Œæ·ç¡¬ç›˜</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiJieHardDisk</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å­˜å‚¨æ•°æ®çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨å¸Œæ·ç¡¬ç›˜å­˜å‚¨æ•°æ®ä¸ºï¼š"</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–æ•°æ®çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨å¸Œæ·å¸Œæ·ç¡¬ç›˜å–æ•°æ®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"æ•°æ®"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Intel cpu</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IntelCpu</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨Intelå¤„ç†å™¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é‡‘å£«é¡¿å†…å­˜æ¡ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KingstonMemory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨é‡‘å£«é¡¿å†…å­˜æ¡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è®¡ç®—æœº</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">XiJieHardDisk</span> hardDisk<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">IntelCpu</span> cpu<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">KingstonMemory</span> memory<span class="token punctuation">;</span><span class="token comment">//çœç•¥ get set...</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿è¡Œè®¡ç®—æœº"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> data <span class="token operator">=</span> hardDisk<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»ç¡¬ç›˜ä¸Šè·å–çš„æ•°æ®æ˜¯ï¼š"</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>        cpu<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        memory<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ä¾èµ–å€’è½¬åŸåˆ™(åä¾‹)-æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComputerDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºç»„ä»¶å¯¹è±¡</span>        <span class="token class-name">XiJieHardDisk</span> hardDisk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiJieHardDisk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">IntelCpu</span> cpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntelCpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">KingstonMemory</span> memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KingstonMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºè®¡ç®—æœºå¯¹è±¡</span>        <span class="token class-name">Computer</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç»„è£…è®¡ç®—æœº</span>        c<span class="token punctuation">.</span><span class="token function">setCpu</span><span class="token punctuation">(</span>cpu<span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">setHardDisk</span><span class="token punctuation">(</span>hardDisk<span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿è¡Œè®¡ç®—æœº</span>        c<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°å·²ç»ç»„è£…äº†ä¸€å°ç”µè„‘ï¼Œä½†æ˜¯ä¼¼ä¹ç»„è£…çš„ç”µè„‘çš„ cpu åªèƒ½æ˜¯ Intel çš„ï¼Œå†…å­˜æ¡åªèƒ½æ˜¯é‡‘å£«é¡¿çš„ï¼Œç¡¬ç›˜åªèƒ½æ˜¯å¸Œæ·çš„ï¼Œè¿™å¯¹ç”¨æˆ·è‚¯å®šæ˜¯ä¸å‹å¥½çš„ï¼Œç”¨æˆ·æœ‰äº†æœºç®±è‚¯å®šæ˜¯æƒ³æŒ‰ç…§è‡ªå·±çš„å–œå¥½ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„é…ä»¶ã€‚</p><p>æ ¹æ®ä¾èµ–å€’è½¬åŸåˆ™è¿›è¡Œæ”¹è¿›ï¼š</p><p>ä»£ç æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ Computer ç±»ï¼Œè®© Computer ç±»ä¾èµ–æŠ½è±¡ï¼ˆå„ä¸ªé…ä»¶çš„æ¥å£ï¼‰ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå„ä¸ªç»„ä»¶å…·ä½“çš„å®ç°ç±»ã€‚</p><h4 id="æ”¹è¿›å-2">æ”¹è¿›å</h4><pre class="mermaid">classDiagramclass Computer {- hardDisk : HardDisk- cpu : Cpu- memory : Memory+ setHardDisk(HardDisk hardDisk) void+ getHardDisk() HardDisk+ setCpu(Cpu cpu) void+ getCpu() Cpu+ setMemory(Memory memory) void+ getMemory() Memory+ run() void}class HardDisk {<< interface >>+ save(String data) void+ get() String}class Cpu {<< interface >>+ run() void}class Memory {<< interface >>+ save() void}class XiJieHardDisk {+ save(String data) void+ get() String}class IntelCpu {+ run() void}class KingstonMemory {+ save() void}Computer *-- HardDisk : ç»„åˆComputer *-- Cpu : ç»„åˆComputer *-- Memory : ç»„åˆHardDisk <|.. XiJieHardDisk : å®ç°Cpu <|.. IntelCpu : å®ç°Memory <|.. KingstonMemory : å®ç°</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç¡¬ç›˜æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HardDisk</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å­˜å‚¨æ•°æ®</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è·å–æ•°æ®</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//cpuæ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Cpu</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è¿è¡Œcpu</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å†…å­˜æ¡æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Memory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¸Œæ·ç¡¬ç›˜</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiJieHardDisk</span> <span class="token keyword">implements</span> <span class="token class-name">HardDisk</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å­˜å‚¨æ•°æ®çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨å¸Œæ·ç¡¬ç›˜å­˜å‚¨æ•°æ®ä¸ºï¼š"</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–æ•°æ®çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨å¸Œæ·å¸Œæ·ç¡¬ç›˜å–æ•°æ®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"æ•°æ®"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Intel cpu</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IntelCpu</span> <span class="token keyword">implements</span> <span class="token class-name">Cpu</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨Intelå¤„ç†å™¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é‡‘å£«é¡¿å†…å­˜æ¡ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KingstonMemory</span> <span class="token keyword">implements</span> <span class="token class-name">Memory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½¿ç”¨é‡‘å£«é¡¿å†…å­˜æ¡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è®¡ç®—æœº</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">HardDisk</span> hardDisk<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Cpu</span> cpu<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Memory</span> memory<span class="token punctuation">;</span>    <span class="token comment">// çœç•¥ get set...</span>        <span class="token comment">//è¿è¡Œè®¡ç®—æœº</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿è¡Œè®¡ç®—æœº"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> data <span class="token operator">=</span> hardDisk<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»ç¡¬ç›˜ä¸Šè·å–çš„æ•°æ®æ˜¯ï¼š"</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>        cpu<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        memory<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ä¾èµ–å€’è½¬åŸåˆ™(æ”¹è¿›å)-æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComputerDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºè®¡ç®—æœºçš„ç»„ä»¶å¯¹è±¡</span>        <span class="token class-name">HardDisk</span> hardDisk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiJieHardDisk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Cpu</span> cpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntelCpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Memory</span> memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KingstonMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºè®¡ç®—æœºå¯¹è±¡</span>        <span class="token class-name">Computer</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç»„è£…è®¡ç®—æœº</span>        c<span class="token punctuation">.</span><span class="token function">setCpu</span><span class="token punctuation">(</span>cpu<span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">setHardDisk</span><span class="token punctuation">(</span>hardDisk<span class="token punctuation">)</span><span class="token punctuation">;</span>        c<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>memory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿è¡Œè®¡ç®—æœº</span>        c<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¢å‘å¯¹è±¡çš„å¼€å‘å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æŠ½è±¡çš„å˜åŒ–æ¦‚ç‡å¾ˆå°ï¼Œè®©ç”¨æˆ·ç¨‹åºä¾èµ–äºæŠ½è±¡ï¼Œå®ç°çš„ç»†èŠ‚ä¹Ÿä¾èµ–äºæŠ½è±¡ã€‚å³ä½¿å®ç°ç»†èŠ‚ä¸æ–­å˜åŠ¨ï¼Œåªè¦æŠ½è±¡ä¸å˜ï¼Œå®¢æˆ·ç¨‹åºå°±ä¸éœ€è¦å˜åŒ–ã€‚è¿™å¤§å¤§é™ä½äº†å®¢æˆ·ç¨‹åºä¸å®ç°ç»†èŠ‚çš„è€¦åˆåº¦ã€‚</p><h3 id="3-4-æ¥å£éš”ç¦»åŸåˆ™">3.4 æ¥å£éš”ç¦»åŸåˆ™</h3><p>å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–äºå®ƒä¸ä½¿ç”¨çš„æ–¹æ³•ï¼›ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚</p><p><img src="./../design-pattern/image-20240121132936719.png" alt=""></p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£æ¥å£éš”ç¦»åŸåˆ™</p><p>ã€ä¾‹ã€‘å®‰å…¨é—¨æ¡ˆä¾‹</p><p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>saddyfire</code>å“ç‰Œçš„å®‰å…¨é—¨ï¼Œè¯¥å®‰å…¨é—¨å…·æœ‰é˜²ç«ã€é˜²æ°´ã€é˜²ç›—çš„åŠŸèƒ½ã€‚å¯ä»¥å°†é˜²ç«ï¼Œé˜²æ°´ï¼Œé˜²ç›—åŠŸèƒ½æå–æˆä¸€ä¸ªæ¥å£ï¼Œå½¢æˆä¸€å¥—è§„èŒƒã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass SafetyDoor {<< interface >>+ antiTheft() void+ fireproof() void+ waterproof() void}class SaddyFireSafetyDoor {+ antiTheft() void+ fireproof() void+ waterproof() void}SafetyDoor <|.. SaddyFireSafetyDoor : å®ç°</pre><p>ä¸Šé¢çš„è®¾è®¡æˆ‘ä»¬å‘ç°äº†å®ƒå­˜åœ¨çš„é—®é¢˜ï¼Œ<code>saddyfire</code>å“ç‰Œçš„å®‰å…¨é—¨å…·æœ‰é˜²ç›—ï¼Œé˜²æ°´ï¼Œé˜²ç«çš„åŠŸèƒ½ã€‚ç°åœ¨å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦å†åˆ›å»ºä¸€ä¸ªä¼ æ™ºå“ç‰Œçš„å®‰å…¨é—¨ï¼Œè€Œè¯¥å®‰å…¨é—¨åªå…·æœ‰é˜²ç›—ã€é˜²æ°´åŠŸèƒ½å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶å¦‚æœå®ç° SafetyDoor æ¥å£å°±è¿èƒŒäº†æ¥å£éš”ç¦»åŸåˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿçœ‹å¦‚ä¸‹ç±»å›¾ï¼š</p><pre class="mermaid">classDiagramclass AntiTheft {<< interface >>+ antiTheft() void}class Fireproof {<< interface >>+ fireproof() void}class Waterproof {<< interface >>+ waterproof() void}class SaddyFireDoor {+ antiTheft() void+ fireproof() void+ waterproof() void}AntiTheft <|.. SaddyFireDoor : å®ç°Fireproof <|.. SaddyFireDoor : å®ç°Waterproof <|.. SaddyFireDoor : å®ç°</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é˜²ç›—æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AntiTheft</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">antiTheft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é˜²ç«æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Fireproof</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">fireproof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//é˜²æ°´æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Waterproof</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">waterproof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//SaddyFireå®‰å…¨é—¨</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaddyFireSafetyDoor</span> <span class="token keyword">implements</span> <span class="token class-name">AntiTheft</span><span class="token punctuation">,</span><span class="token class-name">Fireproof</span><span class="token punctuation">,</span><span class="token class-name">Waterproof</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">antiTheft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é˜²ç›—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fireproof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é˜²ç«"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">waterproof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é˜²æ°´"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//DeeSanå®‰å…¨é—¨</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeeSanSafetyDoor</span> <span class="token keyword">implements</span> <span class="token class-name">AntiTheft</span><span class="token punctuation">,</span><span class="token class-name">Fireproof</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">antiTheft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é˜²ç›—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fireproof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é˜²ç«"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-è¿ªç±³ç‰¹æ³•åˆ™">3.5 è¿ªç±³ç‰¹æ³•åˆ™</h3><p>è¿ªç±³ç‰¹æ³•åˆ™åˆå«æœ€å°‘çŸ¥è¯†åŸåˆ™ã€‚</p><p>åªå’Œä½ çš„ç›´æ¥æœ‹å‹äº¤è°ˆï¼Œä¸è·Ÿâ€œé™Œç”Ÿäººâ€è¯´è¯ï¼ˆTalk only to your immediate friends and not to strangersï¼‰ã€‚</p><p>å…¶å«ä¹‰æ˜¯ï¼šå¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è¯¥è°ƒç”¨ã€‚å…¶ç›®çš„æ˜¯é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚</p><p><img src="./../design-pattern/image-20240121134400988.png" alt=""></p><p>è¿ªç±³ç‰¹æ³•åˆ™ä¸­çš„â€œæœ‹å‹â€æ˜¯æŒ‡ï¼šå½“å‰å¯¹è±¡æœ¬èº«ã€å½“å‰å¯¹è±¡çš„æˆå‘˜å¯¹è±¡ã€å½“å‰å¯¹è±¡æ‰€åˆ›å»ºçš„å¯¹è±¡ã€å½“å‰å¯¹è±¡çš„æ–¹æ³•å‚æ•°ç­‰ï¼Œè¿™äº›å¯¹è±¡åŒå½“å‰å¯¹è±¡å­˜åœ¨å…³è”ã€èšåˆæˆ–ç»„åˆå…³ç³»ï¼Œå¯ä»¥ç›´æ¥è®¿é—®è¿™äº›å¯¹è±¡çš„æ–¹æ³•ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿ªç±³ç‰¹æ³•åˆ™</p><p>ã€ä¾‹ã€‘æ˜æ˜Ÿä¸ç»çºªäººçš„å…³ç³»å®ä¾‹</p><p>æ˜æ˜Ÿç”±äºå…¨èº«å¿ƒæŠ•å…¥è‰ºæœ¯ï¼Œæ‰€ä»¥è®¸å¤šæ—¥å¸¸äº‹åŠ¡ç”±ç»çºªäººè´Ÿè´£å¤„ç†ï¼Œå¦‚å’Œç²‰ä¸çš„è§é¢ä¼šï¼Œå’Œåª’ä½“å…¬å¸çš„ä¸šåŠ¡æ´½æ·¡ç­‰ã€‚è¿™é‡Œçš„ç»çºªäººæ˜¯æ˜æ˜Ÿçš„æœ‹å‹ï¼Œè€Œç²‰ä¸å’Œåª’ä½“å…¬å¸æ˜¯é™Œç”Ÿäººï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨è¿ªç±³ç‰¹æ³•åˆ™ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Agent {- star : Star- fans : Fans- company : Company+ setStar(Star star) void+ setFans(Fans fans) void+ setCompany(Company company) void+ meetinf() void+ business() void}class Star {- name : String+ Star(String name)+ getName() String}class Fans {- name : String+ Fans(String name)+ getName() String}class Company {- name : String+ Company(Strng name)+ getName() void}Agent o-- Star : èšåˆAgent o--  Fans : èšåˆAgent o--  Company : èšåˆ</pre><p><strong>Code:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ˜æ˜Ÿç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Star</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Star</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//çœç•¥ get</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç²‰ä¸ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Fans</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Fans</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//çœç•¥ get</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//åª’ä½“å…¬å¸ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Company</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Company</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//çœç•¥ get</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ç»çºªäººç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Agent</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Star</span> star<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Fans</span> fans<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Company</span> company<span class="token punctuation">;</span><span class="token comment">//çœç•¥ set</span>    <span class="token comment">//å’Œç²‰ä¸è§é¢çš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">meeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>star<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å’Œç²‰ä¸"</span> <span class="token operator">+</span> fans<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è§é¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å’Œåª’ä½“å…¬å¸æ´½è°ˆçš„æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">business</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>star<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å’Œ"</span> <span class="token operator">+</span> company<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ´½è°ˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//è¿ªç±³ç‰¹æ³•åˆ™æµ‹è¯•ç±»</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºç»çºªäººç±»</span>        <span class="token class-name">Agent</span> agent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºæ˜æ˜Ÿå¯¹è±¡</span>        <span class="token class-name">Star</span> star <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Star</span><span class="token punctuation">(</span><span class="token string">"æ—é’éœ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        agent<span class="token punctuation">.</span><span class="token function">setStar</span><span class="token punctuation">(</span>star<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºç²‰ä¸å¯¹è±¡</span>        <span class="token class-name">Fans</span> fans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fans</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        agent<span class="token punctuation">.</span><span class="token function">setFans</span><span class="token punctuation">(</span>fans<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºåª’ä½“å…¬å¸å¯¹è±¡</span>        <span class="token class-name">Company</span> company <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Company</span><span class="token punctuation">(</span><span class="token string">"é»‘é©¬åª’ä½“å…¬å¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        agent<span class="token punctuation">.</span><span class="token function">setCompany</span><span class="token punctuation">(</span>company<span class="token punctuation">)</span><span class="token punctuation">;</span>        agent<span class="token punctuation">.</span><span class="token function">meeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å’Œç²‰ä¸è§é¢</span>        agent<span class="token punctuation">.</span><span class="token function">business</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å’Œåª’ä½“å…¬å¸æ´½è°ˆä¸šåŠ¡</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-6-åˆæˆå¤ç”¨åŸåˆ™">3.6 åˆæˆå¤ç”¨åŸåˆ™</h3><p>åˆæˆå¤ç”¨åŸåˆ™æ˜¯æŒ‡ï¼šå°½é‡å…ˆä½¿ç”¨ç»„åˆæˆ–è€…èšåˆç­‰å…³è”å…³ç³»æ¥å®ç°ï¼Œå…¶æ¬¡æ‰è€ƒè™‘ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°ã€‚</p><p>é€šå¸¸ç±»çš„å¤ç”¨åˆ†ä¸º<strong>ç»§æ‰¿å¤ç”¨</strong>å’Œ<strong>åˆæˆå¤ç”¨</strong>ä¸¤ç§ã€‚</p><p>ç»§æ‰¿å¤ç”¨è™½ç„¶æœ‰ç®€å•å’Œæ˜“å®ç°çš„ä¼˜ç‚¹ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ol><li>ç»§æ‰¿å¤ç”¨ç ´åäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºç»§æ‰¿ä¼šå°†çˆ¶ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼Œçˆ¶ç±»å¯¹å­ç±»æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œç™½ç®±â€å¤ç”¨ã€‚</li><li>å­ç±»ä¸çˆ¶ç±»çš„è€¦åˆåº¦é«˜ã€‚çˆ¶ç±»çš„å®ç°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå¯¼è‡´å­ç±»çš„å®ç°å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸åˆ©äºç±»çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚</li><li>å®ƒé™åˆ¶äº†å¤ç”¨çš„çµæ´»æ€§ã€‚ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å·²ç»å®šä¹‰ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ä¸å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚</li></ol><p>é‡‡ç”¨ç»„åˆæˆ–èšåˆå¤ç”¨æ—¶ï¼Œå¯ä»¥å°†å·²æœ‰å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>å®ƒç»´æŒäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºæˆåˆ†å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯æ–°å¯¹è±¡çœ‹ä¸è§çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œé»‘ç®±â€å¤ç”¨ã€‚</li><li>å¯¹è±¡é—´çš„è€¦åˆåº¦ä½ã€‚å¯ä»¥åœ¨ç±»çš„æˆå‘˜ä½ç½®å£°æ˜æŠ½è±¡ã€‚</li><li>å¤ç”¨çš„çµæ´»æ€§é«˜ã€‚è¿™ç§å¤ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è¿›è¡Œï¼Œæ–°å¯¹è±¡å¯ä»¥åŠ¨æ€åœ°å¼•ç”¨ä¸æˆåˆ†å¯¹è±¡ç±»å‹ç›¸åŒçš„å¯¹è±¡ã€‚</li></ol><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£åˆæˆå¤ç”¨åŸåˆ™</p><p>ã€ä¾‹ã€‘æ±½è½¦åˆ†ç±»ç®¡ç†ç¨‹åº</p><h4 id="æ”¹è¿›å‰-3">æ”¹è¿›å‰</h4><p>æ±½è½¦æŒ‰â€œåŠ¨åŠ›æºâ€åˆ’åˆ†å¯åˆ†ä¸ºæ±½æ²¹æ±½è½¦ã€ç”µåŠ¨æ±½è½¦ç­‰ï¼›æŒ‰â€œé¢œè‰²â€åˆ’åˆ†å¯åˆ†ä¸ºç™½è‰²æ±½è½¦ã€é»‘è‰²æ±½è½¦å’Œçº¢è‰²æ±½è½¦ç­‰ã€‚å¦‚æœåŒæ—¶è€ƒè™‘è¿™ä¸¤ç§åˆ†ç±»ï¼Œå…¶ç»„åˆå°±å¾ˆå¤šã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid">classDiagramclass Car {+ move() void}class PetrolCar {+ move() void}class ElectricCar { + move() void}class RedPeroCar {+ move() void}class WhitePetrolCar {+ move() void}class RedElectricCar {+ move() void}class WhiteElectricCar {+ move() void}Car <|-- PetrolCarCar <|-- ElectricCarPetrolCar <|-- RedPeroCarPetrolCar <|-- WhitePetrolCarElectricCar <|-- RedElectricCarElectricCar <|-- WhiteElectricCar</pre><h4 id="æ”¹è¿›å-3">æ”¹è¿›å</h4><p>ä»ä¸Šé¢ç±»å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ç»§æ‰¿å¤ç”¨äº§ç”Ÿäº†å¾ˆå¤šå­ç±»ï¼Œå¦‚æœç°åœ¨åˆæœ‰æ–°çš„åŠ¨åŠ›æºæˆ–è€…æ–°çš„é¢œè‰²çš„è¯ï¼Œå°±éœ€è¦å†å®šä¹‰æ–°çš„ç±»ã€‚æˆ‘ä»¬è¯•ç€å°†ç»§æ‰¿å¤ç”¨æ”¹ä¸ºèšåˆå¤ç”¨çœ‹ä¸€ä¸‹ã€‚</p><pre class="mermaid">classDiagramclass Car {# color : Color+ move() void}class PetrolCar {+ move() void}class ElectricCar { + move() void}class Color {<< interface >>}class Red { }class White { }Car <|-- PetrolCar : ç»§æ‰¿Car <|-- ElectricCar : ç»§æ‰¿Car o-- Color : èšåˆColor <|.. Red : å®ç°Color <|.. White : å®ç°</pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> DesignPattern </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-Tuning-03-JVMç›‘æ§åŠè¯Šæ–­-è¿è¡Œå‚æ•°ç¯‡</title>
      <link href="/2024/01/17/jvm-tuning3/"/>
      <url>/2024/01/17/jvm-tuning3/</url>
      
        <content type="html"><![CDATA[<h1>JVMç›‘æ§åŠè¯Šæ–­-è¿è¡Œå‚æ•°ç¯‡</h1><h2 id="01-JVMå‚æ•°é€‰é¡¹ç±»å‹">01-JVMå‚æ•°é€‰é¡¹ç±»å‹</h2><h3 id="Xå‚æ•°é€‰é¡¹">-Xå‚æ•°é€‰é¡¹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-Xms<span class="token operator">&lt;</span>size<span class="token operator">></span>        è®¾ç½®åˆå§‹ Java å †å¤§å°, ç­‰ä»·äº-XX:InitialHeapSize-Xmx<span class="token operator">&lt;</span>size<span class="token operator">></span>        è®¾ç½®æœ€å¤§ Java å †å¤§å°, ç­‰ä»·äº-XX:MaxHeapSize-Xss<span class="token operator">&lt;</span>size<span class="token operator">></span>        è®¾ç½® Java çº¿ç¨‹å †æ ˆå¤§å°, ç­‰ä»·äº-XX:ThreadStackSize<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="XXå‚æ•°é€‰é¡¹">-XXå‚æ•°é€‰é¡¹</h3><p>Booleanç±»å‹æ ¼å¼</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-XX:+<span class="token operator">&lt;</span>option<span class="token operator">></span> è¡¨ç¤ºå¯ç”¨optionå±æ€§-XX:-<span class="token operator">&lt;</span>option<span class="token operator">></span> è¡¨ç¤ºç¦ç”¨optionå±æ€§<span class="token parameter variable">-XX:+UseParallelGC</span>  é€‰æ‹©åƒåœ¾å›æ”¶å™¨è¡Œä¸ºå¹¶è¡Œæ”¶é›†å™¨<span class="token parameter variable">-XX:+UseG1GC</span>  è¡¨ç¤ºå¯ç”¨G1æ”¶é›†å™¨<span class="token parameter variable">-XX:+UseAdaptiveSizePolicy</span>  è‡ªåŠ¨é€‰æ‹©å¹´è½»ä»£åŒºå¤§å°å’Œç›¸åº”çš„SurvivoråŒºæ¯”ä¾‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é Boolean ç±»å‹æ ¼å¼(key-valueç±»å‹)</p><ul><li>å­ç±»å‹1: æ•°å€¼å‹æ ¼å¼ <code>-XX&lt;option&gt;=&lt;number&gt;</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-XX:NewSize-1024m  è¡¨ç¤ºè®¾ç½®æ–°ç”Ÿä»£åˆå§‹å¤§å°ä¸º1024m<span class="token parameter variable">-XX:MaxGCPauseMillis</span><span class="token operator">=</span><span class="token number">500</span>  è¡¨ç¤ºè®¾ç½®GCåœé¡¿æ—¶é—´ï¼š500æ¯«ç§’<span class="token parameter variable">-XX:GCTimeRatio</span><span class="token operator">=</span><span class="token number">19</span>  è¡¨ç¤ºè®¾ç½®ååé‡<span class="token parameter variable">-XX:NewRatio</span><span class="token operator">=</span><span class="token number">2</span>  è¡¨ç¤ºæ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å­ç±»å‹2: éæ•°å€¼å‹æ ¼å¼ <code>-XX:&lt;name&gt;=&lt;string&gt;</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:HeapDumpPath</span><span class="token operator">=</span>/usr/local/heapdump.hprof  ç”¨æ¥æŒ‡å®š heap è½¬å­˜æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç‰¹åˆ«çš„</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:+PrintFlagsFinal</span>è¾“å‡ºæ‰€æœ‰å‚æ•°çš„é»˜è®¤å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="02-æ·»åŠ JVMå‚æ•°é€‰é¡¹">02-æ·»åŠ JVMå‚æ•°é€‰é¡¹</h2><p>ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­</p><ul><li>ä½¿ç”¨ <code>jinfo -flag &lt;name&gt;=&lt;value&gt; &lt;pid&gt;</code> è®¾ç½®é Boolean ç±»å‹å‚æ•°</li><li>ä½¿ç”¨ <code>jinfo -flag [+|-]&lt;name&gt; &lt;pid&gt;</code> è®¾ç½®Boolean ç±»å‹å‚æ•°</li></ul><h2 id="03-å¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹">03-å¸¸ç”¨çš„JVMå‚æ•°é€‰é¡¹</h2><h3 id="æ‰“å°è®¾ç½®çš„XXé€‰é¡¹åŠå€¼">æ‰“å°è®¾ç½®çš„XXé€‰é¡¹åŠå€¼</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:+PrintCommandLineFlags</span>  å¯ä»¥è®©åœ¨ç¨‹åºè¿è¡Œå‰æ‰“å°å‡ºç”¨æˆ·æ‰‹åŠ¨è®¾ç½®æˆ–è€… JVM è‡ªåŠ¨è®¾ç½®çš„ XX é€‰é¡¹<span class="token parameter variable">-XX:+PrintFlagsInitial</span>  è¡¨ç¤ºæ‰“å°å‡ºæ‰€æœ‰ XX é€‰é¡¹çš„é»˜è®¤å€¼XX:+PrintFlagsFinal  ğŸ‘è¡¨ç¤ºæ‰“å°å‡º XX é€‰é¡¹åœ¨è¿è¡Œç¨‹åºæ—¶ç”Ÿæ•ˆçš„å€¼<span class="token parameter variable">-XX:+PrintVMOptions</span>  æ‰“å° JVM çš„å‚æ•°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜å¤§å°è®¾ç½®">å †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜å¤§å°è®¾ç½®</h3><p>æ ˆ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-Xss128k</span>  è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°ä¸º128k<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å †å†…å­˜</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-Xms3550m</span>  ç­‰ä»·äº-XX:InitialHeapSize,è®¾ç½® JVM åˆå§‹å †å†…å­˜ä¸º3550M<span class="token parameter variable">-Xmx3550m</span>  ç­‰ä»·äº-XX:MaxHeapSize,è®¾ç½® JVM æœ€å¤§å †å†…å­˜ä¸º3550M<span class="token parameter variable">-Xmn2g</span>  è®¾ç½®å¹´è½»ä»£å¤§å°ä¸º2G, å®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †å¤§å°çš„3/8<span class="token parameter variable">-XX:NewSize</span><span class="token operator">=</span>1024m  è®¾ç½®å¹´è½»ä»£åˆå§‹å€¼ä¸º1024M<span class="token parameter variable">-XX:MaxNewSize</span><span class="token operator">=</span>1024m  è®¾ç½®å¹´è½»ä»£æœ€å¤§å€¼ä¸º1024M<span class="token parameter variable">-XX:SurvivorRatio</span><span class="token operator">=</span><span class="token number">8</span>  è®¾ç½®å¹´è½»ä»£ä¸­ Eden åŒºä¸ä¸€ä¸ª Survivorl åŒºçš„æ¯”å€¼ï¼Œé»˜è®¤ä¸º8<span class="token parameter variable">-XX:+UseAdaptiveSizePolicy</span>  è‡ªåŠ¨é€‰æ‹©å„åŒºå¤§å°æ¯”ä¾‹<span class="token parameter variable">-XX:NewRatio</span><span class="token operator">=</span><span class="token number">4</span>  è®¾ç½®è€å¹´ä»£ä¸å¹´è½»ä»£ï¼ˆåŒ…æ‹¬1ä¸ªEdenå’Œ2ä¸ªSurvivorlåŒºï¼‰çš„æ¯”å€¼<span class="token parameter variable">-XX:PretenureSizeThreadshold</span><span class="token operator">=</span><span class="token number">1024</span>  è®¾ç½®è®©å¤§äºæ­¤é˜ˆå€¼çš„å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ï¼Œå•ä½ä¸ºå­—èŠ‚  åªå¯¹Serialã€ParNewlæ”¶é›†å™¨æœ‰æ•ˆ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–¹æ³•åŒº</p><ul><li>æ°¸ä¹…ä»£</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">XX:PermSize<span class="token operator">=</span>256m  è®¾ç½®æ°¸ä¹…ä»£åˆå§‹å€¼ä¸º256M<span class="token parameter variable">-XX:MaxPermSize</span><span class="token operator">=</span>256m  è®¾ç½®æ°¸ä¹…ä»£æœ€å¤§å€¼ä¸º256M<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å…ƒç©ºé—´</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:MetaspaceSize</span>  åˆå§‹ç©ºé—´å¤§å°<span class="token parameter variable">-XX:MaxMetaspaceSize</span>  æœ€å¤§ç©ºé—´ï¼Œé»˜è®¤æ²¡æœ‰é™åˆ¶<span class="token parameter variable">-XX:+UseCompressedOops</span>  å‹ç¼©å¯¹è±¡æŒ‡é’ˆ<span class="token parameter variable">-XX:+UseCompressedClassPointers</span>  å‹ç¼©ç±»æŒ‡é’ˆ<span class="token parameter variable">-XX:CompressedClassSpaceSize</span>  è®¾ç½®Klass Metaspaceçš„å¤§å°ï¼Œé»˜è®¤1G<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥å†…å­˜</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:MaxDirectMemorySize</span> æŒ‡å®šDirectMemoryå®¹é‡ï¼Œè‹¥æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸Javaå †æœ€å¤§å€¼ä¸€æ ·<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="OutofMemoryç›¸å…³çš„é€‰é¡¹">OutofMemoryç›¸å…³çš„é€‰é¡¹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span>  è¡¨ç¤ºåœ¨å†…å­˜å‡ºç°OOMçš„æ—¶å€™ï¼ŒæŠŠHeapè½¬å­˜<span class="token punctuation">(</span>Dump<span class="token punctuation">)</span>åˆ°æ–‡ä»¶ä»¥ä¾¿åç»­åˆ†æ<span class="token parameter variable">-XX:+HeapDumpBeforeFullGC</span>  è¡¨ç¤ºåœ¨å‡ºç°FulIGCä¹‹å‰ï¼Œç”ŸæˆHeapè½¬å‚¨æ–‡ä»¶<span class="token parameter variable">-XX:HeapDumpPath</span><span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator">></span>  æŒ‡å®šheapè½¬å­˜æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„<span class="token parameter variable">-XX:OnOutofMemoryError</span>  æŒ‡å®šä¸€ä¸ªå¯è¡Œæ€§ç¨‹åºæˆ–è€…è„šæœ¬çš„è·¯å¾„ï¼Œå½“å‘ç”ŸOOMçš„æ—¶å€™ï¼Œå»æ‰§è¡Œè¿™ä¸ªè„šæœ¬<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¯¹ OnOutOfMemoryError çš„è¿ç»´å¤„ç†<br>ä»¥éƒ¨ç½²åœ¨ linux ç³»ç»Ÿ /opt/Server ç›®å½•ä¸‹çš„ Server.jar ä¸ºä¾‹</p><ol><li><p>åœ¨ <a href="http://run.sh">run.sh</a> å¯åŠ¨è„šæœ¬ä¸­æ·»åŠ  jvm å‚æ•°ï¼š</p><p>-XX:OnOutofMemoryError=/opt/Server/restart.sh</p></li><li><p>restart.shè„šæœ¬</p></li></ol></blockquote><p>linux ç¯å¢ƒï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> Server.jar<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;if($8=="java")&#123;print $2&#125;&#125;'</span><span class="token variable">)</span></span><span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token variable">$pid</span><span class="token builtin class-name">cd</span> /opt/Server/<span class="token punctuation">;</span><span class="token function">sh</span> run.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Windows ç¯å¢ƒï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> offwmic process where <span class="token assign-left variable">Name</span><span class="token operator">=</span><span class="token string">'java.exe'</span>delete<span class="token builtin class-name">cd</span> D:<span class="token punctuation">\</span>Serverstart run.bat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åƒåœ¾æ”¶é›†å™¨ç›¸å…³é€‰é¡¹">åƒåœ¾æ”¶é›†å™¨ç›¸å…³é€‰é¡¹</h3><ul><li>æŸ¥çœ‹é»˜è®¤åƒåœ¾å›æ”¶å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:PrintCommandLineFlags</span>æŸ¥çœ‹å‘½ä»¤è¡Œç›¸å…³å‚æ•°<span class="token punctuation">(</span>åŒ…å«ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>Serial å›æ”¶å™¨</li></ul><p>Serial æ”¶é›†å™¨ä½œä¸º HotSpot ä¸­ Client æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ã€‚SerialOld æ˜¯è¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹é»˜è®¤çš„è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨ã€‚</p><p>-XX:+UseSerialGC</p><p>æŒ‡å®šå¹´è½»ä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ã€‚ç­‰ä»·äºæ–°ç”Ÿä»£ç”¨ Seria GC, ä¸”è€å¹´ä»£ç”¨Serial Old GCã€‚å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚</p><ul><li>ParNew å›æ”¶å™¨</li></ul><p>-XX:+UseParNewGC</p><p>æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ ParNew æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚å®ƒè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œä¸å½±å“è€å¹´ä»£ã€‚</p><p>-XX:ParallelGCThreads=N</p><p>é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤å¼€å¯å’Œ CPU æ•°æ®ç›¸åŒçš„çº¿ç¨‹æ•°ã€‚</p><ul><li>Parallel å›æ”¶å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:+UseParallelGC</span>æ‰‹åŠ¨æŒ‡å®šå¹´è½»ä»£ä½¿ç”¨ Parallel å¹¶è¡Œæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚<span class="token parameter variable">-XX:+UseParallelOldGC</span>æ‰‹åŠ¨æŒ‡å®šè€å¹´ä»£éƒ½æ˜¯ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨ã€‚åˆ†åˆ«é€‚ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚é»˜è®¤jdk8æ˜¯å¼€çš„ã€‚ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè¢«å¼€å¯ã€‚ï¼ˆäº’ç›¸æ¿€æ´»ï¼‰<span class="token parameter variable">-XX:ParallelGCThreads</span>è®¾ç½®å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚ä¸€èˆ¬åœ°ï¼Œæœ€å¥½ä¸ CPU æ•°é‡ç›¸ç­‰ï¼Œä»¥é¿å…è¿‡å¤šçš„çº¿ç¨‹æ•°å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½ã€‚åœ¨é»˜è®¤æƒ…æ²‰ä¸‹ï¼Œå½“ CPU æ•°é‡å°äº <span class="token number">8</span> ä¸ªï¼ŒParallelGCThreads çš„å€¼ç­‰äº CPU æ•°é‡ã€‚å½“ CPU æ•°é‡å¤§äº <span class="token number">8</span> ä¸ªï¼ŒParallelGCThreads çš„å€¼ç­‰äº <span class="token number">3</span>+<span class="token punctuation">[</span><span class="token number">5</span>*CPU_Count<span class="token punctuation">]</span>/8<span class="token punctuation">]</span>ã€‚<span class="token parameter variable">-XX:MaxGCPauseMillis</span> è®¾ç½®åƒåœ¾æ”¶é›†å™¨æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆå³STWçš„æ—¶é—´ï¼‰ã€‚å•ä½æ˜¯æ¯«ç§’ã€‚ä¸ºäº†å°½å¯èƒ½åœ°æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨ MaxGCPauseMills ä»¥å†…ï¼Œæ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ä¼šè°ƒæ•´ Java å †å¤§å°æˆ–è€…å…¶ä»–ä¸€äº›å‚æ•°ã€‚å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ä½“éªŒè¶Šå¥½ã€‚ä½†æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬æ³¨é‡é«˜å¹¶å‘ï¼Œæ•´ä½“çš„ååé‡æ‰€ä»¥æœåŠ¡å™¨ç«¯é€‚åˆ Parallel,è¿›è¡Œæ§åˆ¶ã€‚è¯¥å‚æ•°ä½¿ç”¨éœ€è°¨æ…ã€‚<span class="token parameter variable">-XX:GCTimeRatio</span>åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹<span class="token punctuation">(</span><span class="token operator">=</span><span class="token number">1</span>/<span class="token punctuation">(</span>N+1<span class="token punctuation">))</span>ã€‚ç”¨äºè¡¡é‡ååé‡çš„å¤§å°ã€‚å–å€¼èŒƒå›´ï¼ˆ0, <span class="token number">100</span>ï¼‰ã€‚é»˜è®¤å€¼99ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶æ—¶é—´ä¸è¶…è¿‡1%ã€‚ä¸å‰ä¸€ä¸ª <span class="token parameter variable">-X:MaxGCPauseMillis</span> å‚æ•°æœ‰ä¸€å®šçŸ›ç›¾æ€§ã€‚æš‚åœæ—¶é—´è¶Šé•¿ï¼ŒRadio å‚æ•°å°±å®¹æ˜“è¶…è¿‡è®¾å®šçš„æ¯”ä¾‹ã€‚<span class="token parameter variable">-XX:+UseAdaptivesizePolicy</span>è®¾ç½® Parallel Scavengel æ”¶é›†å™¨å…·æœ‰è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>CMS å›æ”¶å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:+UseConcMarkSweepGC</span>æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ CMS æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚å¼€å¯è¯¥å‚æ•°åä¼šè‡ªåŠ¨å°† <span class="token parameter variable">-XX:+UseParNewGC</span> æ‰“å¼€ã€‚å³: ParNew<span class="token punctuation">(</span>YoungåŒºç”¨<span class="token punctuation">)</span> + CMS<span class="token punctuation">(</span>OldåŒºç”¨<span class="token punctuation">)</span> + Serial Old çš„ç»„åˆã€‚<span class="token parameter variable">-XX:CMSInitiatingOccupanyFraction</span> è®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡çš„é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¯¥é˜ˆå€¼ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶ã€‚JDK5åŠä»¥å‰ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º68ï¼Œå³å½“è€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨ç‡è¾¾åˆ° <span class="token number">68</span>% æ—¶ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡ CMS å›æ”¶ã€‚JDK6åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º92%å¦‚æœå†…å­˜å¢é•¿ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸€ä¸ªç¨å¤§çš„å€¼ï¼Œå¤§çš„é˜ˆå€¼å¯ä»¥æœ‰æ•ˆé™ä½ CMS çš„è§¦å‘é¢‘ç‡ï¼Œå‡å°‘è€å¹´ä»£å›æ”¶çš„æ¬¡æ•°å¯ä»¥è¾ƒä¸ºæ˜æ˜¾åœ°æ”¹å–„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚åä¹‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨ç‡å¢é•¿å¾ˆå¿«ï¼Œåˆ™åº”è¯¥é™ä½è¿™ä¸ªé˜ˆå€¼ï¼Œä»¥é¿å…é¢‘ç¹è§¦å‘è€å¹´ä»£ä¸²è¡Œæ”¶é›†å™¨ã€‚å› æ­¤é€šè¿‡è¯¥é€‰é¡¹ä¾¿å¯ä»¥æœ‰æ•ˆé™ä½ Full GC çš„æ‰§è¡Œæ¬¡æ•°ã€‚<span class="token parameter variable">-XX:+UseCMSCompactAtFullCollection</span>ç”¨äºæŒ‡å®šåœ¨æ‰§è¡Œå®Œ Full GC åå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œä»¥æ­¤é¿å…å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚ä¸è¿‡ç”±äºå†…å­˜å‹ç¼©æ•´ç†è¿‡ç¨‹æ— æ³•å¹¶å‘æ‰§è¡Œï¼Œæ‰€å¸¦æ¥çš„é—®é¢˜å°±æ˜¯åœé¡¿æ—¶é—´å˜å¾—æ›´é•¿äº†ã€‚<span class="token parameter variable">-XX:CMSFullGCsBeforeCompaction</span>è®¾ç½®åœ¨æ‰§è¡Œå¤šå°‘æ¬¡ Full GC åå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ã€‚<span class="token parameter variable">-XX:ParallelCMSThreads</span>è®¾ç½® CMS çš„çº¿ç¨‹æ•°é‡ã€‚CMS é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°æ˜¯<span class="token punctuation">(</span>ParallelGCThreads+3<span class="token punctuation">)</span>/4, ParallelGCThreads æ˜¯å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚å½“ CPU èµ„æºæ¯”è¾ƒç´§å¼ æ—¶ï¼Œå—åˆ° CMS æ”¶é›†å™¨çº¿ç¨‹çš„å½±å“ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½åœ¨åƒåœ¾å›æ”¶é˜¶æ®µå¯èƒ½ä¼šéå¸¸ç³Ÿç³•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>G1 å›æ”¶å™¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:+UseG1GC</span>æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ G1 æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚<span class="token parameter variable">-XX:G1HeapRegionSize</span>è®¾ç½®æ¯ä¸ª Region çš„å¤§å°ã€‚å€¼æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„ Java å †å¤§å°åˆ’åˆ†å‡ºçº¦2048ä¸ªåŒºåŸŸã€‚é»˜è®¤æ˜¯å †å†…å­˜çš„1/2000ã€‚<span class="token parameter variable">-XX:MaxGCPauseMillis</span>è®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§GCåœé¡¿æ—¶é—´æŒ‡æ ‡<span class="token punctuation">(</span>JVMä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°<span class="token punctuation">)</span>ã€‚é»˜è®¤å€¼æ˜¯200ms<span class="token parameter variable">-XX:ParallelGCThread</span>è®¾ç½® STW æ—¶ GC çº¿ç¨‹æ•°çš„å€¼ã€‚æœ€å¤šè®¾ç½®ä¸º8<span class="token parameter variable">-XX:ConcGCThreads</span>è®¾ç½®å¹¶å‘æ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°†nè®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°<span class="token punctuation">(</span>Parallel GCThreads<span class="token punctuation">)</span>çš„1/4å·¦å³ã€‚<span class="token parameter variable">-XX:InitiatingHeapOccupancyPercent</span>è®¾ç½®è§¦å‘å¹¶å‘GCå‘¨æœŸçš„Javaå †å ç”¨ç‡é˜ˆå€¼ã€‚è¶…è¿‡æ­¤å€¼ï¼Œå°±è§¦å‘GCã€‚é»˜è®¤å€¼æ˜¯45ã€‚<span class="token parameter variable">-XX:G1NewSizePercent</span>  <span class="token parameter variable">-XX:G1MaxNewSizePercent</span>æ–°ç”Ÿä»£å ç”¨æ•´ä¸ªå †å†…å­˜çš„æœ€å°ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤5%ï¼‰ã€æœ€å¤§ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤6%ï¼‰<span class="token parameter variable">-XX:G1ReservePercent</span><span class="token operator">=</span><span class="token number">10</span>ä¿ç•™å†…å­˜åŒºåŸŸï¼Œé˜²æ­¢to space<span class="token punctuation">(</span>Survivorä¸­çš„toåŒº<span class="token punctuation">)</span>æº¢å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä½•é€‰æ‹©</p><ul><li>ä¼˜å…ˆè°ƒæ•´å †çš„å¤§å°è®© JVM è‡ªé€‚åº”å®Œæˆã€‚</li><li>å¦‚æœå†…å­˜å°äº 100M, ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨</li><li>å¦‚æœæ˜¯å•æ ¸ã€å•æœºç¨‹åºï¼Œå¹¶ä¸”æ²¡æœ‰åœé¡¿æ—¶é—´çš„è¦æ±‚ï¼Œä¸²è¡Œæ”¶é›†å™¨</li><li>å¦‚æœæ˜¯å¤š CPUã€éœ€è¦é«˜ååé‡ã€å…è®¸åœé¡¿æ—¶é—´è¶…è¿‡1ç§’ï¼Œé€‰æ‹©å¹¶è¡Œæˆ–è€… JVM è‡ªå·±é€‰æ‹©</li><li>å¦‚æœæ˜¯å¤š CPUã€è¿½æ±‚ä½åœé¡¿æ—¶é—´ï¼Œéœ€å¿«é€Ÿå“åº”ï¼ˆæ¯”å¦‚å»¶è¿Ÿä¸èƒ½è¶…è¿‡1ç§’ï¼Œå¦‚äº’è”ç½‘åº”ç”¨ï¼‰,ä½¿ç”¨å¹¶å‘æ”¶é›†å™¨ã€‚å®˜æ–¹æ¨è G1, æ€§èƒ½é«˜ã€‚ç°åœ¨äº’è”ç½‘çš„é¡¹ç›®ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨G1ã€‚</li></ul><blockquote><p>ç‰¹åˆ«è¯´æ˜ï¼š</p><ol><li>æ²¡æœ‰æœ€å¥½çš„æ”¶é›†å™¨ï¼Œæ›´æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†</li><li>è°ƒä¼˜æ°¸è¿œæ˜¯é’ˆå¯¹ç‰¹å®šåœºæ™¯ã€ç‰¹å®šéœ€æ±‚ï¼Œä¸å­˜åœ¨ä¸€åŠ³æ°¸é€¸çš„æ”¶é›†å™¨</li></ol></blockquote><h3 id="GCæ—¥å¿—ç›¸å…³é€‰é¡¹">GCæ—¥å¿—ç›¸å…³é€‰é¡¹</h3><h3 id="å¸¸ç”¨å‚æ•°">å¸¸ç”¨å‚æ•°</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-verbose:gc</span>è¾“å‡º gc æ—¥å¿—ä¿¡æ¯ï¼Œé»˜è®¤è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º<span class="token parameter variable">-XX:+PrintGC</span>ç­‰åŒäº -verbose:gc, è¡¨ç¤ºæ‰“å¼€ç®€åŒ–çš„GCæ—¥å¿—<span class="token parameter variable">-XX:+PrintGCDetails</span>åœ¨å‘ç”Ÿåƒåœ¾å›æ”¶æ—¶æ‰“å°å†…å­˜å›æ”¶è¯¦ç»†çš„æ—¥å¿—ï¼Œå¹¶åœ¨è¿›ç¨‹é€€å‡ºæ—¶è¾“å‡ºå½“å‰å†…å­˜å„åŒºåŸŸåˆ†é…æƒ…å†µ<span class="token parameter variable">-XX:+PrintGCTimeStamps</span>è¾“å‡ºGCå‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³<span class="token punctuation">(</span>ä¸å¯ç‹¬ç«‹ä½¿ç”¨, éœ€è¦é…åˆ-XX:+PrintGCDetails<span class="token punctuation">)</span><span class="token parameter variable">-XX:+PrintGCDateStamps</span>è¾“å‡ºGCå‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚2013-05-04T21:53:59.234+0800<span class="token punctuation">)</span><span class="token punctuation">(</span>ä¸å¯ç‹¬ç«‹ä½¿ç”¨, éœ€è¦é…åˆ-XX:+PrintGCDetails<span class="token punctuation">)</span><span class="token parameter variable">-XX:+PrintHeapAtGC</span>æ¯ä¸€æ¬¡ GC å‰å’Œ GC åï¼Œéƒ½æ‰“å°å †ä¿¡æ¯-Xloggc:<span class="token operator">&lt;</span>file<span class="token operator">></span>æŠŠGCæ—¥å¿—å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å»ï¼Œè€Œä¸æ˜¯æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="04-é€šè¿‡Javaä»£ç è·å–JVMå‚æ•°">04-é€šè¿‡Javaä»£ç è·å–JVMå‚æ•°</h2><p>Java æä¾›äº† java.lang.management åŒ…ç”¨äºç›‘è§†å’Œç®¡ç† Java è™šæ‹Ÿæœºå’Œ Java è¿è¡Œæ—¶ä¸­çš„å…¶ä»–ç»„ä»¶ï¼Œå®ƒå…è®¸æœ¬åœ°å’Œè¿œç¨‹ç›‘æ§å’Œç®¡ç†è¿è¡Œçš„ Java è™šæ‹Ÿæœºã€‚å…¶ä¸­ ManagementFactory è¿™ä¸ªç±»è¿˜æ˜¯æŒºå¸¸ç”¨çš„ã€‚å¦å¤–è¿˜æœ‰ Runtime ç±»ä¹Ÿå¯ä»¥è·å–ä¸€äº›å†…å­˜ã€CPUæ ¸æ•°ç­‰ç›¸å…³çš„æ•°æ®ã€‚<br>é€šè¿‡è¿™äº›apiå¯ä»¥ç›‘æ§æˆ‘ä»¬çš„åº”ç”¨æœåŠ¡å™¨çš„å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè®¾ç½®ä¸€äº›é˜ˆå€¼è¿›è¡ŒæŠ¥è­¦ç­‰å¤„ç†ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">MemoryMXBean</span> memorymbean <span class="token operator">=</span> <span class="token class-name">ManagementFactory</span><span class="token punctuation">.</span><span class="token function">getMemoryMXBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">MemoryUsage</span> usage <span class="token operator">=</span> memorymbean<span class="token punctuation">.</span><span class="token function">getHeapMemoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"INIT HEAP: "</span> <span class="token operator">+</span> usage<span class="token punctuation">.</span><span class="token function">getInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MAX HEAP: "</span> <span class="token operator">+</span> usage<span class="token punctuation">.</span><span class="token function">getMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"USE HEAP: "</span> <span class="token operator">+</span> usage<span class="token punctuation">.</span><span class="token function">getUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\nFull Information:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Heap Memory Usage: "</span> <span class="token operator">+</span> memorymbean<span class="token punctuation">.</span><span class="token function">getHeapMemoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Non-Heap Memory Usage: "</span> <span class="token operator">+</span> memorymbean<span class="token punctuation">.</span><span class="token function">getNonHeapMemoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=======================é€šè¿‡javaæ¥è·å–ç›¸å…³ç³»ç»ŸçŠ¶æ€============================ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰å †å†…å­˜å¤§å°totalMemory "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å½“å‰å †å†…å­˜å¤§å°</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç©ºé—²å †å†…å­˜å¤§å°freeMemory "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç©ºé—²å †å†…å­˜å¤§å°</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ€å¤§å¯ç”¨æ€»å †å†…å­˜maxMemory "</span> <span class="token operator">+</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ€å¤§å¯ç”¨æ€»å †å†…å­˜å¤§å°</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¦™æ©™æ´¾5Bä¸Šæ‰‹è®°å½•</title>
      <link href="/2024/01/10/oranpi-start/"/>
      <url>/2024/01/10/oranpi-start/</url>
      
        <content type="html"><![CDATA[<h1>é¦™æ©™æ´¾5Bä¸Šæ‰‹è®°å½•</h1><blockquote><p>æœ¬æ–‡åŸºäºé¦™æ©™æ´¾å®˜æ–¹æ–‡æ¡£, ç»“åˆè‡ªå·±ä¸Šæ‰‹è®°å½•è¿‡ç¨‹</p><p><a href="http://www.orangepi.cn/html/hardWare/computerAndMicrocontrollers/service-and-support/Orange-Pi-5B.html">é¦™æ©™æ´¾5B èµ„æ–™é¡µé¢é“¾æ¥</a></p></blockquote><p><img src="./../oranpi-start/image-20240110205343056.png" alt="æ­£é¢è§†å›¾(å°¤å…¶æ³¨æ„ç”µæºä½ç½®)"></p><h2 id="å‰ç½®å·¥ä½œ">å‰ç½®å·¥ä½œ</h2><ul><li>å¼€å‘æ¿</li><li>5V/4A/20W ç”µæº (æ‰‹å†Œä¸­å¤šæ¬¡æåŠç”µå‹ä¸èƒ½è¶…è¿‡5V, å¦åˆ™ä¼šçƒ§åæ¿å­)</li><li>3.3V çš„ USB è½¬ TTL æ¨¡å—å’Œæœé‚¦çº¿, ä½¿ç”¨ä¸²å£è°ƒè¯•åŠŸèƒ½æ—¶, éœ€è¦ USB è½¬ TTL æ¨¡å—å’Œæœé‚¦çº¿æ¥è¿æ¥å¼€å‘æ¿å’Œç”µè„‘</li><li>ä¸Šä¸€æ¡å¯ä»¥æ¢æˆç½‘çº¿</li><li>è¯»å¡å™¨ + TFå¡ (å¯¹äºé¦™æ©™æ´¾5, æ¿è½½emmcè‡ªå¸¦ Droid ç³»ç»Ÿ)</li><li>Ubuntué•œåƒæ–‡ä»¶ + çƒ§å½•è½¯ä»¶ balenaEtcher</li></ul><blockquote><p>balenaEtcherå®˜æ–¹åœ°å€ <a href="https://www.balena.io/etcher/">https://www.balena.io/etcher/</a></p></blockquote><h2 id="Ubuntu-ç³»ç»Ÿå¯åŠ¨">Ubuntu ç³»ç»Ÿå¯åŠ¨</h2><h3 id="å‰ç½®çƒ§å½•">å‰ç½®çƒ§å½•</h3><h4 id="çƒ§å½•è‡³-TF-å¡">çƒ§å½•è‡³ TF å¡</h4><p><img src="./../oranpi-start/image-20240110210102428.png" alt=""></p><h4 id="ä½¿ç”¨-TF-å¡çƒ§å½•è‡³-emmc">ä½¿ç”¨ TF å¡çƒ§å½•è‡³ emmc</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> /dev/mmcblk*boot0 <span class="token operator">|</span> <span class="token function">cut</span> -c1-12<span class="token comment">#æ ¼å¼åŒ–</span><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/mmcblk1 <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token assign-left variable">status</span><span class="token operator">=</span>progress<span class="token function">sudo</span> <span class="token function">sync</span><span class="token comment">#çƒ§å½•</span><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">if</span><span class="token operator">=</span><span class="token operator">&lt;</span>é•œåƒè·¯å¾„/é•œåƒå<span class="token operator">></span> <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/mmcblk1 <span class="token assign-left variable">status</span><span class="token operator">=</span>progress<span class="token function">sudo</span> <span class="token function">sync</span><span class="token comment">#å®ä¾‹</span><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">if</span><span class="token operator">=</span>Orangepi5b_1.0.8_ubuntu_focal_server_linux5.10.160.img <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/mmcblk1 <span class="token assign-left variable">status</span><span class="token operator">=</span>progress<span class="token function">sudo</span> <span class="token function">sync</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä½¿ç”¨-RKDevTool-çƒ§å½•è‡³-emmc">ä½¿ç”¨ RKDevTool çƒ§å½•è‡³ emmc</h4><ol><li><p>å‡†å¤‡å·¥å…·</p><p><img src="./../oranpi-start/image-20240113215312745.png" alt=""></p><blockquote><p>æ³¨æ„ï¼Œ&quot;MiniLoader-çƒ§å½• Linux é•œåƒæ‰éœ€è¦ç”¨åˆ°çš„ä¸œè¥¿&quot;æ–‡ä»¶å¤¹ä¸‹æ–‡ç®€ç§°ä¸º MiniLoader æ–‡ä»¶å¤¹ã€‚</p></blockquote></li><li><p>åœ¨æ–‡ä»¶å¤¹ DriverAssitant_v5.12 ä¸­æ‰¾åˆ° DriverInstall.exe å¯æ‰§è¡Œæ–‡ä»¶å¹¶æ‰“å¼€å³å¯</p></li><li><p>æ‰“å¼€ DriverInstall.exe åå®‰è£…ç‘èŠ¯å¾®é©±åŠ¨çš„æ­¥éª¤å¦‚ä¸‹æ‰€ç¤º:</p><ol><li><p>ç‚¹å‡»â€œé©±åŠ¨å®‰è£…â€æŒ‰é’®</p><p><img src="./../oranpi-start/image-20240113215457426.png" alt=""></p></li><li><p>ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œä¼šå¼¹å‡ºçª—å£æç¤ºâ€œå®‰è£…é©±åŠ¨æˆåŠŸâ€ï¼Œç„¶åç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®å³å¯</p><p><img src="./../oranpi-start/image-20240113215521619.png" alt=""></p></li></ol></li><li><p>åœ¨ RKDevTool_Release ä¸­æ‰“å¼€ RKDevTool</p><p><img src="./../oranpi-start/image-20240113215904896.png" alt=""></p></li><li><p>æ‰“å¼€ RKDevTool çƒ§å½•å·¥å…·åï¼Œå› ä¸ºç”µè„‘æ­¤æ—¶è¿˜æ²¡æœ‰é€šè¿‡ Type-C çº¿è¿æ¥ä¸Šå¼€å‘æ¿ï¼Œæ‰€ä»¥å·¦ä¸‹è§’ä¼šæç¤º&quot;æ²¡æœ‰å‘ç°è®¾å¤‡&quot;</p><p><img src="./../oranpi-start/image-20240113215954181.png" alt=""></p></li><li><p>ç„¶åå¼€å§‹çƒ§å½• Linux é•œåƒåˆ° eMMC ä¸­</p><ol><li><p>é¦–å…ˆé€šè¿‡ Type-C æ•°æ®çº¿è¿æ¥å¥½å¼€å‘æ¿ä¸ Windows ç”µè„‘</p></li><li><p>ç¡®ä¿å¼€å‘æ¿æ²¡æœ‰æ’å…¥ TF å¡ï¼Œæ²¡æœ‰è¿æ¥ç”µæº</p></li><li><p>è¿˜éœ€ç¡®ä¿ä¸‹å›¾ä½ç½®çš„ç™½è‰² USB2.0 æ¥å£æ²¡æœ‰æ’å…¥ USB è®¾å¤‡</p></li><li><p>ç„¶åæŒ‰ä½å¼€å‘æ¿çš„ MaskROM æŒ‰é”®ä¸æ”¾ï¼ŒMaskROM æŒ‰é”®åœ¨å¼€å‘æ¿çš„ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="./../oranpi-start/image-20240113220111610.png" alt=""></p></li><li><p>ç„¶åç»™å¼€å‘æ¿æ¥ä¸Š Type-C æ¥å£çš„ç”µæºï¼Œå¹¶ä¸Šç”µï¼Œç„¶åå°±å¯ä»¥æ¾å¼€ MaskROM æŒ‰é”®äº†</p><p><img src="./../oranpi-start/image-20240113220151020.png" alt=""></p></li><li><p>å¦‚æœå‰é¢çš„æ­¥éª¤é¡ºåˆ©ï¼Œæ­¤æ—¶å¼€å‘æ¿ä¼šè¿›å…¥ MASKROM æ¨¡å¼ï¼Œåœ¨çƒ§å½•å·¥å…·çš„ç•Œé¢ä¸Šä¼šæç¤º&quot;å‘ç°ä¸€ä¸ª MASKROM è®¾å¤‡&quot;</p><p><img src="./../oranpi-start/image-20240113220226739.png" alt=""></p></li><li><p>ç„¶åå°†é¼ æ ‡å…‰æ ‡æ”¾åœ¨ä¸‹é¢çš„è¿™ç‰‡åŒºåŸŸä¸­</p><p><img src="./../oranpi-start/image-20240113220312051.png" alt=""></p></li><li><p>ç„¶åç‚¹å‡»é¼ æ ‡å³é”®ä¼šå¼¹å‡ºä¸‹å›¾æ‰€ç¤ºçš„é€‰æ‹©ç•Œé¢</p><p><img src="./../oranpi-start/image-20240113220342529.png" alt=""></p></li><li><p>ç„¶åé€‰æ‹©<strong>å¯¼å…¥é…ç½®</strong>é€‰é¡¹</p><p><img src="./../oranpi-start/image-20240113220421330.png" alt=""></p></li><li><p>ç„¶åé€‰æ‹©å‰é¢ä¸‹è½½çš„ MiniLoader æ–‡ä»¶å¤¹ä¸­çš„ rk3588_linux_emmc.cfg é…ç½®æ–‡ä»¶ï¼Œå†ç‚¹å‡»<strong>æ‰“å¼€</strong></p><p><img src="./../oranpi-start/image-20240113220458479.png" alt=""></p></li><li><p>ç„¶åç‚¹å‡»<strong>ç¡®å®š</strong></p><p><img src="./../oranpi-start/image-20240113220539678.png" alt=""></p></li><li><p>ç„¶åç‚¹å‡»ä¸‹å›¾æ‰€ç¤ºçš„ä½ç½®</p><p><img src="./../oranpi-start/image-20240113220610577.png" alt=""></p></li><li><p>å†é€‰æ‹©å‰é¢ä¸‹è½½çš„ MiniLoader æ–‡ä»¶å¤¹ä¸­ MiniLoaderAll.binï¼Œå†ç‚¹å‡»<strong>æ‰“å¼€</strong></p><p><img src="./../oranpi-start/image-20240113220631065.png" alt=""></p></li><li><p>ç„¶åç‚¹å‡»ä¸‹å›¾æ‰€ç¤ºçš„ä½ç½®</p><p><img src="./../oranpi-start/image-20240113220736369.png" alt=""></p></li><li><p>ç„¶åé€‰æ‹©æƒ³è¦çƒ§å½•çš„ linux é•œåƒçš„è·¯å¾„ï¼Œå†ç‚¹å‡»<strong>æ‰“å¼€</strong></p><blockquote><p>åœ¨çƒ§å½•é•œåƒå‰ï¼Œå»ºè®®å°†è¦çƒ§å½•çš„linuxé•œåƒé‡å‘½åä¸ºorangepi.imgæˆ–è€…å…¶å®ƒæ¯”è¾ƒçŸ­çš„åå­—ï¼Œè¿™æ ·åœ¨çƒ§å½•é•œåƒçš„æ—¶å€™å°±èƒ½çœ‹åˆ°çƒ§å½•è¿›åº¦çš„ç™¾åˆ†æ¯”æ•°å€¼ã€‚</p></blockquote></li></ol><p><img src="./../oranpi-start/image-20240113220850498.png" alt=""></p><ol start="16"><li><p>ç„¶åè¯·<strong>å‹¾é€‰ä¸Šå¼ºåˆ¶æŒ‰åœ°å€å†™</strong>é€‰é¡¹</p><p><img src="./../oranpi-start/image-20240113220918394.png" alt=""></p></li><li><p>å†ç‚¹å‡»æ‰§è¡ŒæŒ‰é’®å°±ä¼šå¼€å§‹çƒ§å½• linux é•œåƒåˆ°å¼€å‘æ¿çš„ eMMC ä¸­</p></li><li><p>linux é•œåƒçƒ§å½•å®Œåçš„æ˜¾ç¤º log å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="./../oranpi-start/image-20240113220958757.png" alt=""></p></li><li><p>çƒ§å½•å®Œ linux é•œåƒåˆ° eMMC ä¸­åï¼Œlinux ç³»ç»Ÿä¼šè‡ªåŠ¨å¯åŠ¨ã€‚</p></li></ol></li></ol><h3 id="Linux-å¯åŠ¨å¹¶ç™»å½•">Linux å¯åŠ¨å¹¶ç™»å½•</h3><blockquote><p>æ­¤å¤„æˆ‘çƒ§å½•çš„æ˜¯ Ubuntu Server, å› æ­¤æå‰å‡†å¤‡äº†ä¸€æ ¹ç½‘çº¿</p></blockquote><ol><li><p>è¿æ¥ç½‘çº¿, ç”µæºå¹¶å¯åŠ¨</p></li><li><p>ç™»å½• 192.168.1.1 æŸ¥çœ‹é¦™æ©™æ´¾ç½‘ç»œ</p><p><img src="./../oranpi-start/image-20240110212239167.png" alt=""></p></li><li><p>ä½¿ç”¨ ssh å·¥å…·è¿æ¥é¦™æ©™æ´¾</p><p>è´¦å·åŠå¯†ç éƒ½æ˜¯ (orangepi)</p></li></ol><h3 id="ä¸²å£è°ƒè¯•">ä¸²å£è°ƒè¯•</h3><ul><li>RX (Receive Data) æ¥æ”¶æ•°æ®</li><li>TX (Transmit Data) å‘é€æ•°æ®</li></ul><ol><li>é¦–å…ˆæŸ¥çœ‹è‡ªå·±æ‰‹ä¸Šçš„æ¨¡å—çš„å¼•è„šå¯¹åº”å…³ç³»</li></ol><p><img src="./../oranpi-start/Snipaste_2024-01-14_14-32-46.png" alt="TXé’è‰²ã€RXè“è‰²ã€GNç´«è‰²"></p><ol start="2"><li>å¼€å‘æ¿çš„è°ƒè¯•ä¸²å£å¼•è„šå…³ç³»å¯¹åº”å¦‚ä¸‹</li></ol><p><img src="./../oranpi-start/image-20240114143604445.png" alt=""></p><ol start="3"><li><p>USB è½¬ TTL æ¨¡å— GNDã€TXD å’Œ RXD å¼•è„šéœ€è¦é€šè¿‡æœé‚¦çº¿è¿æ¥åˆ°å¼€å‘æ¿çš„è°ƒè¯•ä¸²å£ä¸Š</p><ul><li>USB è½¬ TTL æ¨¡å—çš„ GND æ¥åˆ°å¼€å‘æ¿çš„ GND ä¸Š</li><li>USB è½¬ TTL æ¨¡å—çš„ RX æ¥åˆ°å¼€å‘æ¿çš„ TX ä¸Š</li><li>USB è½¬ TTL æ¨¡å—çš„ TX æ¥åˆ°å¼€å‘æ¿çš„ RX ä¸Š</li></ul></li><li><p>ç”±æ­¤æœé‚¦çº¿æ¥çº¿çš„é¡ºåºåº”è¯¥(ç´«ã€é’ã€è“)</p></li><li><p>è°ƒæ•´ç»ˆç«¯å·¥å…·å‚æ•°</p></li></ol><p><img src="./../oranpi-start/image-20240114153426102.png" alt="ä»¥xshellä¸ºä¾‹"></p><ol start="6"><li>å¼€æœº</li></ol><h3 id="WIFI-è¿æ¥">WIFI è¿æ¥</h3><ol><li>é¦–å…ˆä½¿ç”¨ <code>nmcli dev wifi</code> å‘½ä»¤æ‰«æå‘¨å›´çš„ WIFI çƒ­ç‚¹</li></ol><p><img src="./../oranpi-start/image-20240110212620976.png" alt=""></p><ol start="2"><li>ç„¶åä½¿ç”¨ <code>nmcli</code> å‘½ä»¤è¿æ¥æ‰«æåˆ°çš„ WIFI çƒ­ç‚¹ï¼š</li></ol><p><code>nmcli dev wifi connect &lt;wifi_name&gt; password &lt;wifi_passwd&gt;</code></p><p><img src="./../oranpi-start/image-20240110212831443.png" alt=""></p><ol start="3"><li>é€šè¿‡ <code>ip addr show wlan0</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ wifi çš„ IP åœ°å€</li></ol><p><img src="./../oranpi-start/image-20240110213012840.png" alt=""></p><ol start="4"><li>ä½¿ç”¨ <code>ping</code> å‘½ä»¤å¯ä»¥æµ‹è¯• wifi ç½‘ç»œçš„è¿é€šæ€§</li></ol><p><img src="./../oranpi-start/image-20240110213123089.png" alt=""></p><h3 id="è®¾ç½®é™æ€-IP-åœ°å€">è®¾ç½®é™æ€ IP åœ°å€</h3><h4 id="ä½¿ç”¨-nmcli-å‘½ä»¤è®¾ç½®">ä½¿ç”¨ nmcli å‘½ä»¤è®¾ç½®</h4><blockquote><p>å¦‚æœè¦è®¾ç½®ç½‘å£çš„é™æ€ IP åœ°å€ï¼Œè¯·å…ˆå°†ç½‘çº¿æ’å…¥å¼€å‘æ¿ï¼Œå¦‚æœéœ€è¦è®¾ç½® WIFIçš„é™æ€ IP åœ°å€ï¼Œè¯·å…ˆè¿æ¥å¥½ WIFIï¼Œç„¶åå†å¼€å§‹è®¾ç½®é™æ€ IP åœ°å€</p></blockquote><ol><li>ç„¶åé€šè¿‡ <code>nmcli con show</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç½‘ç»œè®¾å¤‡çš„åå­—ï¼Œå¦‚ä¸‹æ‰€ç¤º</li></ol><p><img src="./../oranpi-start/image-20240110220800203.png" alt=""></p><ol start="2"><li><p>ç„¶åè¾“å…¥ä¸‹é¢çš„å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmcli con mod <span class="token string">"&lt;ç½‘ç»œå>"</span> <span class="token punctuation">\</span>ipv4.addresses <span class="token string">"192.168.1.110"</span> <span class="token punctuation">\</span>ipv4.gateway <span class="token string">"192.168.1.1"</span> <span class="token punctuation">\</span>ipv4.dns <span class="token string">"8.8.8.8"</span> <span class="token punctuation">\</span>ipv4.method <span class="token string">"manual"</span>nmcli con mod <span class="token string">"CMCC-6Xcu-5G"</span> <span class="token punctuation">\</span>ipv4.addresses <span class="token string">"192.168.1.111"</span> <span class="token punctuation">\</span>ipv4.gateway <span class="token string">"192.168.1.1"</span> <span class="token punctuation">\</span>ipv4.dns <span class="token string">"8.8.8.8"</span> <span class="token punctuation">\</span>ipv4.method <span class="token string">"manual"</span><span class="token comment"># Wired connection 1 è¡¨ç¤ºè®¾ç½®ä»¥å¤ªç½‘çš„é™æ€ IP åœ°å€</span><span class="token comment"># ipv4.addresses åé¢æ˜¯è¦è®¾ç½®çš„é™æ€ IP åœ°å€ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºè‡ªå·±æƒ³è¦è®¾ç½®çš„å€¼</span><span class="token comment"># ipv4.gateway è¡¨ç¤ºç½‘å…³çš„åœ°å€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç„¶åé‡å¯ linux ç³»ç»Ÿ</p><p><code>sudo reboot</code></p></li><li><p>ç„¶åé‡æ–°è¿›å…¥ linux ç³»ç»Ÿä½¿ç”¨ <code>ip addr show eth0</code> å‘½ä»¤å°±å¯ä»¥æŸ¥çœ‹åˆ° IP åœ°å€å·²ç»è®¾ç½®ä¸ºæƒ³è¦çš„å€¼äº† (å¦‚æœè®¾ç½®æˆåŠŸåé€šè¿‡ sshç™»å½•å°±èƒ½å‘ç°äº†ğŸ¤£)</p></li></ol><h4 id="ä½¿ç”¨-nmtui-å‘½ä»¤è®¾ç½®">ä½¿ç”¨ nmtui å‘½ä»¤è®¾ç½®</h4><ol><li>é¦–å…ˆè¿è¡Œ <code>nmtui</code> å‘½ä»¤</li></ol><p><img src="./../oranpi-start/image-20240110214452331.png" alt=""></p><ol start="2"><li>é€‰æ‹© Edit a connection, å¹¶æŒ‰ä¸‹å›è½¦</li><li>é€‰æ‹©éœ€è¦è®¾ç½®é™æ€ IP åœ°å€çš„ç½‘ç»œæ¥å£, æ¯”å¦‚è®¾ç½® CMCC-6Xcu-5G, æŒ‰ä¸‹ Tab é”®è¿›å…¥</li></ol><p><img src="./../oranpi-start/image-20240110214624786.png" alt=""></p><ol start="4"><li>å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹å›¾æ‰€ç¤ºçš„ <code>&lt;Automatic&gt;</code> ä½ç½®è¿›è¡Œ IPv4 çš„é…ç½®</li></ol><p><img src="./../oranpi-start/image-20240110214901015.png" alt=""></p><ol start="5"><li>ç„¶åå›è½¦, é€šè¿‡æ–¹å‘é”®é€‰æ‹© <code>Manual</code>, ç„¶åå›è½¦ç¡®å®š</li></ol><p><img src="./../oranpi-start/image-20240110214945084.png" alt=""></p><ol start="6"><li>ç„¶åé€šè¿‡ Tab é”®å°†å…‰æ ‡ç§»åŠ¨åˆ° <code>&lt;Show&gt;</code></li></ol><p><img src="./../oranpi-start/image-20240110215021768.png" alt=""></p><ol start="7"><li>åœ¨ä¸‹å›¾æ‰€ç¤ºçš„ä½ç½®è®¾ç½® IP åœ°å€(Addresses)ã€ç½‘å…³(Gateway)å’Œ DNS æœåŠ¡å™¨çš„åœ°å€ï¼ˆé‡Œé¢è¿˜æœ‰å¾ˆå¤šå…¶ä»–è®¾ç½®é€‰é¡¹ï¼Œè¯·è‡ªè¡Œæ¢ç´¢ï¼‰ï¼Œè¯·æ ¹æ®è‡ªå·±çš„å…·ä½“éœ€æ±‚æ¥è®¾ç½®ï¼Œä¸‹å›¾ä¸­è®¾ç½®çš„å€¼åªæ˜¯ä¸€ä¸ªç¤ºä¾‹</li></ol><p><img src="./../oranpi-start/image-20240110215211432.png" alt=""></p><ol start="8"><li>å®Œåå°†å…‰æ ‡ç§»åŠ¨åˆ°å³ä¸‹è§’çš„ <code>&lt;OK&gt;</code>ï¼Œç„¶åå›è½¦ç¡®è®¤, ç„¶åç‚¹å‡» <code>&lt;Back&gt;</code> å›é€€åˆ°ä¸Šä¸€çº§é€‰æ‹©ç•Œé¢</li><li>ç„¶åé€‰æ‹© Activate a connectionï¼Œå†å°†å…‰æ ‡ç§»åŠ¨åˆ° <code>&lt;OK&gt;</code>ï¼Œæœ€åç‚¹å‡»å›è½¦</li></ol><p><img src="./../oranpi-start/image-20240110215400337.png" alt=""></p><ol start="10"><li>ç„¶åé€‰æ‹©éœ€è¦è®¾ç½®çš„ç½‘ç»œæ¥å£ï¼Œæ¿€æ´»è¯¥æ¿€æ´»çš„, å…³é—­æƒ³å…³é—­çš„ç½‘ç»œ</li></ol><p><img src="./../oranpi-start/image-20240110215705785.png" alt=""></p><ol start="11"><li>è®¾ç½®å®Œæˆ, å‹å¥½é€€å‡ºå³å¯</li><li>æœ€åé€šè¿‡ <code>ip addr show wlan0</code> å°±èƒ½çœ‹åˆ°ç½‘å£çš„ IP åœ°å€å·²ç»å˜æˆå‰é¢è®¾ç½®çš„é™æ€ IPåœ°å€äº†</li></ol><p><img src="./../oranpi-start/image-20240110215932436.png" alt=""></p><h3 id="æ¿è½½-LED-ç¯è¯´æ˜">æ¿è½½ LED ç¯è¯´æ˜</h3><ol><li>å¼€å‘æ¿ä¸Šæœ‰ä¸¤ä¸ª LED ç¯ï¼Œä¸€ä¸ªç»¿ç¯ï¼Œä¸€ä¸ªçº¢ç¯ï¼Œæ‰€åœ¨ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ol><p><img src="./../oranpi-start/image-20240110210834760.png" alt=""></p><ol start="2"><li><p>åªè¦å¼€å‘æ¿æ‰“å¼€äº†ç”µæºï¼Œçº¢è‰²çš„ LED ç¯å°±ä¼šå¸¸äº®ï¼Œè¿™æ˜¯ç”±ç¡¬ä»¶æ§åˆ¶çš„ï¼Œè½¯ä»¶æ— æ³•å…³é—­ã€‚</p></li><li><p>ç»¿è‰²çš„ LED ç¯åœ¨å†…æ ¸å¯åŠ¨åä¼šä¸€ç›´é—ªçƒï¼Œè¿™æ˜¯ç”±è½¯ä»¶æ§åˆ¶çš„</p></li><li><p>è®¾ç½®ç»¿ç¯äº®ç­å’Œé—ªçƒçš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤º</p><blockquote><p>æ³¨æ„: ä¸‹é¢çš„æ“ä½œè¯·åœ¨ root ç”¨æˆ·ä¸‹è¿›è¡Œ</p></blockquote><ol><li><p>é¦–å…ˆè¿›å…¥ç»¿ç¯çš„è®¾ç½®ç›®å½•</p><p><code>cd /sys/class/leds/status_led</code></p></li><li><p>è®¾ç½®ç»¿ç¯åœæ­¢é—ªçƒçš„å‘½ä»¤å¦‚ä¸‹</p><p><code>echo none &gt; trigger</code></p></li><li><p>è®¾ç½®ç»¿ç¯å¸¸äº®çš„å‘½ä»¤å¦‚ä¸‹</p><p><code>echo default-on &gt; trigger</code></p></li><li><p>è®¾ç½®ç»¿ç¯é—ªçƒçš„å‘½ä»¤å¦‚ä¸‹</p><p><code>echo heartbeat &gt; trigger</code></p></li><li><p>å¦‚æœå¼€æœºåä¸éœ€è¦ LED ç¯é—ªçƒ, å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥å…³é—­ç»¿ç¯å’Œè“ç¯</p><ol><li><p>é¦–å…ˆè¿è¡Œä¸‹ orangepi-configï¼Œæ™®é€šç”¨æˆ·è®°å¾—åŠ  sudo æƒé™</p><p><code>sudo orangepi-config</code></p></li><li><p>ç„¶åé€‰æ‹© System</p><p><img src="./../oranpi-start/image-20240110211444336.png" alt=""></p></li><li><p>ç„¶åé€‰æ‹© Hardware</p><p><img src="./../oranpi-start/image-20240110211500003.png" alt=""></p></li><li><p>ç„¶åä½¿ç”¨é”®ç›˜çš„æ–¹å‘é”®å®šä½åˆ°ä¸‹å›¾æ‰€ç¤ºçš„ä½ç½®ï¼Œå†ä½¿ç”¨ç©ºæ ¼é€‰ä¸­ disable-led é…ç½®</p><p><img src="./../oranpi-start/image-20240110211601620.png" alt=""></p></li><li><p>ç„¶åé€‰æ‹© <code>&lt;Save&gt;</code> ä¿å­˜, ç„¶åé€‰æ‹© <code>&lt;Back&gt;</code></p><p><img src="./../oranpi-start/image-20240110211627953.png" alt=""></p></li><li><p>ç„¶åé€‰æ‹© <code>&lt;Reboot&gt;</code> é‡å¯ç³»ç»Ÿä½¿é…ç½®ç”Ÿæ•ˆ, é‡å¯åå°±å¯ä»¥çœ‹åˆ°å¼€å‘æ¿ä¸Šåªæœ‰çº¢ç¯å¸¸äº®, ç»¿ç¯ä¸ä¼šé—ªçƒäº†</p><p><img src="./../oranpi-start/image-20240110211709091.png" alt=""></p></li></ol></li></ol></li></ol><h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2><p><strong>æŸ¥çœ‹ Ubuntu ç‰ˆæœ¬</strong></p><p><code>lsb_release -a</code></p><p><img src="./../oranpi-start/image-20240110222823841.png" alt=""></p><p><strong>æŸ¥çœ‹ç³»ç»Ÿæ¶æ„</strong></p><p><code>uname -m</code></p><p><strong>scp</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> <span class="token punctuation">[</span>å‚æ•°<span class="token punctuation">]</span> <span class="token operator">&lt;</span>æºåœ°å€ï¼ˆç”¨æˆ·å@IPåœ°å€æˆ–ä¸»æœºåï¼‰<span class="token operator">></span>:<span class="token operator">&lt;</span>æ–‡ä»¶è·¯å¾„<span class="token operator">></span> <span class="token operator">&lt;</span>ç›®çš„åœ°å€ï¼ˆç”¨æˆ·å @IP åœ°å€æˆ–ä¸»æœºåï¼‰<span class="token operator">></span>:<span class="token operator">&lt;</span>æ–‡ä»¶è·¯å¾„<span class="token operator">></span><span class="token comment">####ä¸¾ä¾‹</span><span class="token function">scp</span> ./init.sh dee@192.168.1.99:/home/dee/ <span class="token comment">#æŠŠæœ¬åœ°çš„init.shæ–‡ä»¶æ‹·è´åˆ°192.168.1.99çš„/home/deeç›®å½•ä¸‹</span><span class="token function">scp</span> orangepi@192.168.1.111:/etc/apt/sources.list ./ <span class="token comment">#æŠŠ192.168.1.111çš„sources.listæ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°å½“å‰ç›®å½•ä¸‹</span><span class="token function">scp</span> <span class="token parameter variable">-r</span> /home/work/sourcedir work@192.168.0.10:/home/work/ <span class="token comment">#æ‹·è´æ–‡ä»¶å¤¹ï¼ŒåŠ -rå‚æ•°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç£ç›˜æŒ‚è½½</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /home/data<span class="token function">sudo</span> <span class="token function">mount</span> /dev/sda1 /home/data <span class="token comment">#æŒ‚è½½</span><span class="token function">sudo</span> <span class="token function">umount</span> /dev/sda1 <span class="token comment">#å¸è½½</span><span class="token function">fuser</span> <span class="token parameter variable">-m</span> /dev/sda1 <span class="token comment">#æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨ç£ç›˜çš„åº”ç”¨</span><span class="token function">sudo</span> <span class="token function">fdisk</span> <span class="token parameter variable">-l</span> <span class="token comment">#æŸ¥çœ‹æ‰€æœ‰ç£ç›˜ä¿¡æ¯(åŒ…æ‹¬æœªæŒ‚è½½çš„)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è´¦æˆ·ç›¸å…³">è´¦æˆ·ç›¸å…³</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ä¿®æ”¹ root è´¦å·çš„å¯†ç (è¦åˆ‡æ¢è‡³root)</span>paswd<span class="token comment">#ä¿®æ”¹ orangepi è´¦å·çš„å¯†ç </span><span class="token function">passwd</span> orangepi<span class="token comment">#ä¿®æ”¹ orangepi çš„è´¦å·ä¸º dee</span><span class="token function">usermod</span> <span class="token parameter variable">-l</span> dee orangepi<span class="token comment">#ä¿®æ”¹ç»„</span><span class="token function">groupmod</span> <span class="token parameter variable">-n</span> dee orangepi<span class="token comment">#æŠŠåŸæ¥ orangepi ç›®å½•æ”¹æ‰</span><span class="token function">mv</span> /home/ornagepi /home/dee<span class="token comment">#æŠŠè¿™ç›®å½•è®¾ç½®æˆ orangepi ç”¨æˆ·çš„ home ç›®å½•</span><span class="token function">usermod</span> <span class="token parameter variable">-d</span> /home/orangepi orangepi<span class="token comment">#æŸ¥çœ‹ Linux ä¸­æ‰€æœ‰ç”¨æˆ·</span><span class="token function">cat</span> /etc/passwd<span class="token comment">#æŸ¥çœ‹ Linux ä¸­æ·»åŠ äº†å¤šå°‘ç”¨æˆ·</span><span class="token function">cat</span> /etc/passwd<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> nologin<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">halt</span><span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">shutdown</span><span class="token operator">|</span>awk-F<span class="token string">":"</span> <span class="token string">'&#123; print $1"|"$3"|"$4 &#125;'</span><span class="token operator">|</span><span class="token function">more</span><span class="token comment">#æŸ¥çœ‹ Linux ä¸­æ‰€æœ‰ç»„</span><span class="token function">cat</span> /etc/group<span class="token comment">#åˆ é™¤ Linux æŸä¸ªç”¨æˆ·</span><span class="token function">userdel</span> <span class="token operator">&lt;</span>ç”¨æˆ·å<span class="token operator">></span><span class="token comment">#åˆ é™¤linuxä¸­æŸä¸ªç”¨æˆ·æ‰€æœ‰ä¿¡æ¯</span><span class="token function">userdel</span> <span class="token parameter variable">-r</span> <span class="token operator">&lt;</span>ç”¨æˆ·å<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è®¾ç½®æ—¶åŒº</strong></p><p><code>sudo dpkg-reconfigure tzdata</code> é€‰æ‹©Asiaç„¶åshanghaiå³å¯</p><h3 id="å¸¸ç”¨-apt-å‘½ä»¤">å¸¸ç”¨ apt å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹å½“å‰Ubuntuç³»ç»Ÿä½¿ç”¨çš„é•œåƒæº</span><span class="token function">cat</span> /etc/apt/sources.listå¦‚æœæƒ³ä½¿ç”¨å…¶ä»–é•œåƒæºï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ·»åŠ æˆ–ç¼–è¾‘ç›¸åº”çš„è¡Œã€‚ç¼–è¾‘å®Œæˆåï¼Œè®°å¾—è¿è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š<span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token comment"># è¿™æ˜¯ä¸€ä¸ªä¸»è¦åœ¨æ–°ç³»ç»Ÿå®‰è£…ä¹‹åæˆ–å®‰è£…æ–°è½¯ä»¶åŒ…ä¹‹å‰è°ƒç”¨çš„å‘½ä»¤ã€‚apt update å‘½ä»¤æ›´æ–° Linux ç³»ç»Ÿçš„åŒ…ç´¢å¼•æˆ–åŒ…åˆ—è¡¨ã€‚å®ƒä¸ä¼šå‡çº§ä»»ä½•è½¯ä»¶åŒ…ï¼Œæ­£å¦‚ä¸€äº› Linux ç”¨æˆ·è¢«è¯¯å¯¼çš„é‚£æ ·ã€‚</span><span class="token function">sudo</span> <span class="token function">apt</span> upgrade<span class="token comment"># éœ€è¦å°†æ‚¨çš„è½¯ä»¶åŒ…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿç„¶åapt upgradeæ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚apt upgrade å‘½ä»¤ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œå°†ç³»ç»Ÿä¸Šæ‰€æœ‰è¿‡æ—¶çš„è½¯ä»¶åŒ…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</span><span class="token comment"># å¦‚æœéœ€è¦ä»»ä½•ä¾èµ–é¡¹ï¼Œè¯¥å‘½ä»¤è¿˜ä¼šè§¦å‘æ–°è½¯ä»¶åŒ…çš„å®‰è£…ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œapt upgradeè¿˜ä¼šå®‰è£…æ‚¨ç³»ç»Ÿæ‰€éœ€çš„æ‰€æœ‰å®‰å…¨æ›´æ–°ï¼Œè¿™åŠ å¼ºäº†æ‚¨ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</span><span class="token function">apt</span> list <span class="token parameter variable">--upgradable</span> <span class="token comment">#åˆ—å‡ºéœ€è¦å‡çº§çš„è½¯ä»¶åŒ…</span><span class="token comment">#### </span><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token comment">#åˆ—å‡ºæ‰€æœ‰å¯æ›´æ–°çš„è½¯ä»¶æ¸…å•å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#å®‰è£…æŒ‡å®šçš„è½¯ä»¶å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package_<span class="token operator"><span class="token file-descriptor important">1</span>></span> <span class="token operator">&lt;</span>package_<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token operator">&lt;</span>package_<span class="token operator"><span class="token file-descriptor important">3</span>></span> <span class="token comment">#å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…</span><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#æ›´æ–°æŒ‡å®šçš„è½¯ä»¶å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> remove <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#åˆ é™¤è½¯ä»¶åŒ…å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> autoremove <span class="token comment">#æ¸…ç†ä¸å†ä½¿ç”¨çš„ä¾èµ–å’Œåº“æ–‡ä»¶</span><span class="token function">sudo</span> <span class="token function">apt</span> purge <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment">#ç§»é™¤è½¯ä»¶åŒ…åŠé…ç½®æ–‡ä»¶</span><span class="token function">sudo</span> <span class="token function">apt</span> search <span class="token operator">&lt;</span>keyword<span class="token operator">></span> <span class="token comment">#æŸ¥æ‰¾è½¯ä»¶åŒ…å‘½ä»¤</span><span class="token function">apt</span> list <span class="token parameter variable">--installed</span> <span class="token comment">#åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…</span><span class="token function">apt</span> list --all-versions <span class="token comment">#åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸ç”¨é˜²ç«å¢™å‘½ä»¤">å¸¸ç”¨é˜²ç«å¢™å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ufw <span class="token comment">#å®‰è£…é˜²ç«å¢™</span><span class="token function">sudo</span> ufw status <span class="token comment">#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span><span class="token function">sudo</span> ufw <span class="token builtin class-name">enable</span> <span class="token comment">#å¼€å¯é˜²ç«å¢™</span><span class="token function">sudo</span> ufw disable <span class="token comment">#å…³é—­é˜²ç«å¢™</span><span class="token function">sudo</span> ufw allow <span class="token number">80</span> <span class="token comment">#å…è®¸å¤–éƒ¨è®¿é—®80ç«¯å£, åè®®åŒ…å« tcp å’Œ udp</span><span class="token function">sudo</span> ufw allow <span class="token number">80</span>/tcp <span class="token comment">#å…è®¸å…¶å®ƒä¸»æœºä½¿ç”¨ tcp åè®®è®¿é—®æœ¬æœº 80 ç«¯å£</span><span class="token function">sudo</span> ufw delete allow <span class="token number">80</span> <span class="token comment">#ç¦æ­¢å¤–éƒ¨è®¿é—®80 ç«¯å£</span><span class="token function">sudo</span> ufw allow from <span class="token number">192.168</span>.1.1 <span class="token comment">#å…è®¸æ­¤IPè®¿é—®æ‰€æœ‰çš„æœ¬æœºç«¯å£</span><span class="token function">sudo</span> ufw deny smtp <span class="token comment">#ç¦æ­¢å¤–éƒ¨è®¿é—®smtpæœåŠ¡</span><span class="token function">sudo</span> ufw reject out smtp <span class="token comment">#ç¦æ­¢è®¿é—®å¤–éƒ¨smtpç«¯å£ï¼Œä¸å‘ŠçŸ¥â€œè¢«é˜²ç«å¢™é˜»æ­¢â€</span><span class="token function">sudo</span> ufw deny out to <span class="token number">192.168</span>.1.1 <span class="token comment">#ç¦æ­¢æœ¬æœº 192.168.1.1 å¯¹å¤–è®¿é—®ï¼Œå‘ŠçŸ¥â€œè¢«é˜²ç«å¢™é˜»æ­¢â€</span><span class="token function">sudo</span> ufw delete allow smtp <span class="token comment">#åˆ é™¤ä¸Šé¢å»ºç«‹çš„æŸæ¡è§„åˆ™</span><span class="token function">sudo</span> ufw delete deny <span class="token number">80</span>/tcp <span class="token comment">#è¦åˆ é™¤è§„åˆ™ï¼Œåªè¦åœ¨å‘½ä»¤ä¸­åŠ å…¥deleteå°±è¡Œäº†</span><span class="token comment">###å¯ä»¥å…è®¸æ‰€æœ‰RFC1918ç½‘ç»œï¼ˆå±€åŸŸç½‘/æ— çº¿å±€åŸŸç½‘çš„ï¼‰è®¿é—®è¿™ä¸ªä¸»æœºï¼ˆ/8,/16,/12æ˜¯ä¸€ç§ç½‘ç»œåˆ†çº§ï¼‰</span><span class="token function">sudo</span> ufw allow from <span class="token number">10.0</span>.0.0/8<span class="token function">sudo</span> ufw allow from <span class="token number">172.16</span>.0.0/12<span class="token function">sudo</span> ufw allow from <span class="token number">192.168</span>.0.0/16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¸¸ç”¨ç«¯å£å‘½ä»¤">å¸¸ç”¨ç«¯å£å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">netstat</span> -ntulp<span class="token operator">|</span><span class="token function">grep</span> <span class="token operator">&lt;</span>åº”ç”¨å<span class="token operator">></span> <span class="token comment">#æ³¨æ„è¦åŠ sudo</span><span class="token function">sudo</span> <span class="token function">lsof</span> -i:<span class="token operator">&lt;</span>ç«¯å£å·<span class="token operator">></span> <span class="token comment">#æ³¨æ„è¦åŠ sudo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="è½¯ä»¶åŠæœåŠ¡">è½¯ä»¶åŠæœåŠ¡</h2><h3 id="JDK">JDK</h3><p><strong>å®‰è£… OpenJDK 8</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> openjdk-8-jdk <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é€šè¿‡æ£€æŸ¥ Java ç‰ˆæœ¬ï¼Œæ¥éªŒè¯å®‰è£…è¿‡ç¨‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-version</span><span class="token comment">##### æ§åˆ¶å° ####</span>openjdk version <span class="token string">"1.8.0_382"</span>OpenJDK Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_382-8u382-ga-1~20.04.1-b05<span class="token punctuation">)</span>OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.382</span>-b05, mixed mode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®‰è£…OpenJDK 11</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> openjdk-11-jdk <span class="token parameter variable">-y</span><span class="token comment">##### æ§åˆ¶å° ####</span>openjdk version <span class="token string">"11.0.20.1"</span> <span class="token number">2023</span>-08-24OpenJDK Runtime Environment <span class="token punctuation">(</span>build <span class="token number">11.0</span>.20.1+1-post-Ubuntu-0ubuntu120.04<span class="token punctuation">)</span>OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">11.0</span>.20.1+1-post-Ubuntu-0ubuntu120.04, mixed mode<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è®¾ç½®é»˜è®¤ç‰ˆæœ¬</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> update-alternatives <span class="token parameter variable">--config</span> <span class="token function">java</span> <span class="token comment">#åŒæ—¶ä¹Ÿå¯æŸ¥çœ‹ Java å®‰è£…è·¯å¾„</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>JAVA_HOME ç¯å¢ƒå˜é‡</strong></p><p>java å®‰è£…è·¯å¾„å¦‚ä¸‹:</p><ul><li>OpenJDK 11 is located at <code>/usr/lib/jvm/java-11-openjdk-amd64/bin/java</code></li><li>OpenJDK 8 is located at <code>/usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ç¯å¢ƒå˜é‡ä½ç½®</span><span class="token function">sudo</span> <span class="token function">vim</span> /etc/environment<span class="token comment">#æœ«å°¾æ·»åŠ </span><span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token string">"/usr/lib/jvm/java-8-openjdk-arm64/jre/bin/java"</span><span class="token comment">#ç«‹å³ç”Ÿæ•ˆ</span><span class="token builtin class-name">source</span> /etc/environment<span class="token comment">#æ ¡éªŒ</span><span class="token builtin class-name">echo</span> <span class="token variable">$JAVA_HOME</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> remove openjdk-11-jdk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="MySql">MySql</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#æŸ¥çœ‹</span><span class="token function">sudo</span> <span class="token function">apt</span> search mysql<span class="token comment">#å®‰è£…</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mysql-server <span class="token parameter variable">-y</span><span class="token comment">#æŸ¥çœ‹æœåŠ¡</span><span class="token function">sudo</span> systemctl status mysql<span class="token comment">#æŸ¥çœ‹ç‰ˆæœ¬</span>mysql <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å®‰å…¨é…ç½®å‘å¯¼è¯´æ˜">å®‰å…¨é…ç½®å‘å¯¼è¯´æ˜</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> mysql_secure_installation<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="é…ç½®è¿œç¨‹è®¿é—®">é…ç½®è¿œç¨‹è®¿é—®</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#å…è®¸è¿œç¨‹è®¿é—®</span><span class="token builtin class-name">cd</span> /etc/mysql/mysql.conf.d<span class="token function">sudo</span> <span class="token function">vim</span> mysqld.cnf <span class="token comment">#æ­¤å¤„ä¸è¦ä¿®æ”¹æƒé™, å¦åˆ™ mysql æ— æ³•è¯»å–é…ç½®</span><span class="token comment"># é‡å¯mysql</span><span class="token function">sudo</span> systemctl restart mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../oranpi-start/image-20240113105048034.png" alt=""></p><h4 id="ç™»å½•">ç™»å½•</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ç™»å½•</span><span class="token function">sudo</span> mysql<span class="token function">sudo</span> mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token comment">#æ¥ç€è¾“å…¥å¯†ç </span><span class="token comment">#æ›´æ”¹ root å¯†ç </span>ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'sad_mysql'</span><span class="token punctuation">;</span><span class="token comment">#### æ¨èæ–°å»ºç”¨æˆ· (é€šè¿‡ SELECT @@VERSION; æŸ¥çœ‹ç‰ˆæœ¬: mysqlç‰ˆæœ¬8.0.13ä¹‹å, æ–°ç”¨æˆ·æˆæƒæ–¹å¼å‘ç”Ÿäº†å˜åŒ–</span>create user <span class="token string">'saddyfire'</span>@<span class="token string">'%'</span> identified by  <span class="token string">'sad_mysql'</span><span class="token punctuation">;</span>grant all privileges on *.* to <span class="token string">'saddyfire'</span>@<span class="token string">'%'</span> with grant option<span class="token punctuation">;</span>flush privileges<span class="token punctuation">;</span><span class="token comment">#### å¦‚æœå‡ºç°äº†ç­–ç•¥ ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</span>show variables like <span class="token string">'validate_password%'</span><span class="token punctuation">;</span><span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password.policy</span><span class="token operator">=</span>LOW<span class="token punctuation">;</span><span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password.length</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span>flush privileges<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¸è½½">å¸è½½</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#æŸ¥çœ‹MySQLçš„ä¾èµ–é¡¹</span>dpkg --list<span class="token operator">|</span><span class="token function">grep</span> mysql<span class="token comment">#åˆ é™¤</span><span class="token function">sudo</span> <span class="token function">apt</span> remove mysql-*<span class="token comment">#ç»§ç»­æŸ¥çœ‹</span>dpkg --list<span class="token operator">|</span><span class="token function">grep</span> mysql<span class="token comment">#ç»§ç»­åˆ é™¤</span><span class="token function">sudo</span> <span class="token function">apt</span> autoremove <span class="token parameter variable">--purge</span> mysql-server-8.0 mysql-common<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Redis">Redis</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> redis-server <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>é…ç½®æ–‡ä»¶åŠæ—¥å¿—</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc/redis<span class="token function">sudo</span> <span class="token function">vim</span> /etc/redis/redis.conf<span class="token comment">#(å®šä½åˆ° bind ç«¯å£ç»‘å®š) >>> æ³¨é‡Š# bind 127.0.0.1 ::1</span><span class="token comment">#(å®šä½åˆ° requirepass å¹¶ä¿®æ”¹å¯†ç )</span><span class="token comment">#æŸ¥çœ‹æ—¥å¿—</span><span class="token builtin class-name">cd</span> /var/log/redis<span class="token comment">#ä¸­é—´ä¼šé‡åˆ°æ–‡ä»¶å¤¹åŠæ–‡ä»¶æƒé™é—®é¢˜</span><span class="token function">chmod</span> <span class="token number">755</span> *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Nginx">Nginx</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx-full <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>é…ç½®æ–‡ä»¶åŠæ—¥å¿—</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#é…ç½®æ–‡ä»¶å¤¹</span><span class="token builtin class-name">cd</span> /etc/nginx<span class="token comment">#æ—¥å¿—</span><span class="token builtin class-name">cd</span> /var/log/nginx/<span class="token comment">#ä¸­é—´ä¼šé‡åˆ°æ–‡ä»¶å¤¹åŠæ–‡ä»¶æƒé™é—®é¢˜</span><span class="token function">chmod</span> <span class="token number">755</span> *<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å±€åŸŸç½‘å…±äº«">å±€åŸŸç½‘å…±äº«</h3><p><strong>å®‰è£…åŠé…ç½®</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#å®‰è£…Samba</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> samba <span class="token parameter variable">-y</span><span class="token comment">#æ–°å¢å…±äº«ç›®å½•</span><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /dee/sharedata<span class="token comment">#æ·»åŠ ç”¨æˆ·</span><span class="token function">sudo</span> <span class="token function">useradd</span> dee <span class="token parameter variable">-s</span> /usr/sbin/nologin<span class="token comment">#ä¿®æ”¹æƒé™</span><span class="token function">sudo</span> <span class="token function">chown</span> dee:dee /dee/sharedata<span class="token comment">#å°†ç”¨æˆ·smbuseræ·»åŠ åˆ°sambaçš„smbpasswd fileä¸­(å³åœ¨sambaæœåŠ¡ä¸­æ³¨å†Œè¯¥è´¦æˆ·)</span><span class="token function">sudo</span> smbpasswd <span class="token parameter variable">-a</span> dee<span class="token comment">#pass=dee</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é…ç½®æ–‡ä»¶</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc/samba/<span class="token function">sudo</span> <span class="token function">vim</span> /etc/samba/smb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>shift g</code> åœ¨æœ«å°¾æ·»åŠ </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## æ³¨æ„: åé¢çš„æ³¨é‡Šè¦è¾“å‡º</span><span class="token punctuation">[</span>secret<span class="token punctuation">]</span>    <span class="token comment">#å…±äº«ç›®å½•åï¼Œè®¿é—®æ—¶çš„å±•ç¤ºå</span>    comment <span class="token operator">=</span> Secret File       <span class="token comment">#è¯¥å…±äº«ç›®å½•çš„æè¿°</span>    path <span class="token operator">=</span> /dee/sharedir  <span class="token comment">#è®¿é—®çš„å®é™…è·¯å¾„,å‰é¢è®¾ç½®çš„</span>    valid <span class="token function">users</span> <span class="token operator">=</span> dee       <span class="token comment">#è®¾ç½®å¯è®¿é—®çš„ç”¨æˆ·ï¼Œæ­¤å¤„ä¸ºå‰é¢æ·»åŠ çš„ç”¨æˆ·smbuserï¼ˆæ³¨æ„usersä¸è¦æ‹¼å†™é”™è¯¯ï¼‰</span>    guest ok <span class="token operator">=</span> no               <span class="token comment">#æ˜¯å¦å…è®¸è®¿å®¢ï¼Œå¦</span>    writable <span class="token operator">=</span> <span class="token function">yes</span>              <span class="token comment">#å¯å†™ï¼Œæ˜¯</span>    browsable <span class="token operator">=</span> <span class="token function">yes</span>             <span class="token comment">#å¯æµè§ˆï¼Œæ˜¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é‡å¯ç”Ÿæ•ˆ</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart smbd<span class="token function">sudo</span> systemctl restart nmbd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>åŒ¿åæ–¹å¼ç±»ä¼¼</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰“å¼€æ–‡ä»¶</span><span class="token function">sudo</span> <span class="token function">vim</span> /etc/samba/smb.conf<span class="token comment"># å°¾éƒ¨å†™å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜</span><span class="token punctuation">[</span>share<span class="token punctuation">]</span>     comment <span class="token operator">=</span> Ubuntu File Server     path <span class="token operator">=</span> /dee/shareAll     browsable <span class="token operator">=</span> <span class="token function">yes</span>     guest ok <span class="token operator">=</span> <span class="token function">yes</span>     <span class="token builtin class-name">read</span> only <span class="token operator">=</span> no<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é™„åŠ å‘½ä»¤</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹sambaç”¨æˆ·åˆ—è¡¨</span><span class="token function">sudo</span> pdbedit <span class="token parameter variable">-L</span><span class="token comment">#åˆ é™¤sambaæœåŠ¡ä¸­çš„æŸä¸ªç”¨æˆ·</span><span class="token function">sudo</span> smbpasswd -x<span class="token operator">&lt;</span>ç”¨æˆ·å<span class="token operator">></span><span class="token comment"># å¯¹sambaç”¨æˆ·è¿›è¡Œç®¡ç†ï¼ˆç”¨æˆ·å·²ç»åœ¨ç³»ç»Ÿä¸­åˆ›å»ºï¼‰</span><span class="token function">sudo</span> smbpasswd <span class="token parameter variable">-h</span>  <span class="token comment">#æŸ¥çœ‹æ”¯æŒçš„å‘½ä»¤åˆ—è¡¨</span><span class="token comment"># å¼‚å¸¸æ—¶å¯æŸ¥çœ‹æ—¥å¿—æƒ…å†µ</span><span class="token function">cat</span> /var/log/samba/log.%m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è‡ªåŠ¨åŒ–éƒ¨ç½²">è‡ªåŠ¨åŒ–éƒ¨ç½²</h2><h3 id="wifi">wifi</h3><p><code>vim inti-wifi.sh</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bash</span><span class="token comment">## å¦‚æœå‡ºç° -bash: /bin/bash^M: bad interpreter: No such file or directory</span><span class="token comment">## vimæˆ–è€…viçš„å‘½ä»¤æ¨¡å¼ä¸‹, è¾“å…¥å‘½ä»¤ set ff=unix å³å¯è§£å†³æ¢è¡Œé—®é¢˜</span><span class="token comment">#æ ¡éªŒæ˜¯å¦ä¸ºåˆæ³•ipæ ¼å¼</span><span class="token keyword">function</span> <span class="token function-name function">validate_ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token variable">$1</span>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">stat</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$ip</span> <span class="token operator">=~</span> ^<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1,3</span><span class="token punctuation">&#125;</span><span class="token punctuation">\</span>.<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1,3</span><span class="token punctuation">&#125;</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        <span class="token assign-left variable">OIFS</span><span class="token operator">=</span><span class="token environment constant">$IFS</span>        <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">'.'</span>        <span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">)</span>        <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token variable">$OIFS</span>        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$&#123;ip<span class="token punctuation">[</span>0<span class="token punctuation">]</span>&#125;</span> <span class="token parameter variable">-le</span> <span class="token number">255</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$&#123;ip<span class="token punctuation">[</span>1<span class="token punctuation">]</span>&#125;</span> <span class="token parameter variable">-le</span> <span class="token number">255</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$&#123;ip<span class="token punctuation">[</span>2<span class="token punctuation">]</span>&#125;</span> <span class="token parameter variable">-le</span> <span class="token number">255</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$&#123;ip<span class="token punctuation">[</span>3<span class="token punctuation">]</span>&#125;</span> <span class="token parameter variable">-le</span> <span class="token number">255</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>            <span class="token assign-left variable">stat</span><span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">fi</span>    <span class="token keyword">fi</span>    <span class="token builtin class-name">return</span> <span class="token variable">$stat</span><span class="token punctuation">&#125;</span><span class="token comment">#è®¾ç½®é™æ€ip</span><span class="token keyword">function</span> <span class="token function-name function">set_stat_ip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token builtin class-name">local</span> <span class="token assign-left variable">gate_way</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$3</span>"</span><span class="token keyword">if</span> <span class="token operator">!</span> validate_ip <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span> <span class="token keyword">then</span><span class="token assign-left variable">gate_way</span><span class="token operator">=</span><span class="token string">"192.168.1.1"</span><span class="token keyword">fi</span>nmcli con mod <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">\</span>ipv4.addresses <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">\</span>ipv4.gateway <span class="token string">"<span class="token variable">$gate_way</span>"</span> <span class="token punctuation">\</span>ipv4.dns <span class="token string">"8.8.8.8"</span> <span class="token punctuation">\</span>ipv4.method <span class="token string">"manual"</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"ä½¿ç”¨è¯´æ˜ï¼š"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"    ./init-wifi &lt;wifiå> &lt;å¯†ç > &lt;é™æ€ip> [ç½‘å…³ip]"</span>    <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><span class="token builtin class-name">echo</span> <span class="token string">"wifiåä¸èƒ½ä¸ºç©º"</span><span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$2</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><span class="token builtin class-name">echo</span> <span class="token string">"wifiå¯†ç ä¸èƒ½ä¸ºç©º"</span><span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span class="token comment">#æ ¡éªŒé™æ€ip</span><span class="token keyword">if</span> <span class="token operator">!</span> validate_ip <span class="token string">"<span class="token variable">$3</span>"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$3</span>"</span>  <span class="token builtin class-name">echo</span> <span class="token string">"é™æ€ipä¸åˆæ³•"</span>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span class="token assign-left variable">conn_result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>nmcli dev wifi connect $1 password $2<span class="token variable">`</span></span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$conn_result</span> <span class="token operator">=~</span> <span class="token string">"successfully"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><span class="token builtin class-name">echo</span> <span class="token string">">>> wifiè¿æ¥æˆåŠŸ, æ­£åœ¨ä¿®æ”¹é™æ€ip &lt;&lt;&lt;"</span>set_stat_ip <span class="token variable">$1</span> <span class="token variable">$3</span> <span class="token variable">$4</span><span class="token builtin class-name">echo</span> <span class="token string">">>> ä¿®æ”¹å®Œæˆ, è¯·é‡å¯è®¡ç®—æœº &lt;&lt;&lt;"</span><span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token keyword">else</span><span class="token builtin class-name">echo</span> <span class="token string">"è¿æ¥å¤±è´¥"</span><span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŸºç¡€åº”ç”¨å®‰è£…">åŸºç¡€åº”ç”¨å®‰è£…</h3><p><code>vim init-prog.sh</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bash</span><span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> <span class="token string">":r:"</span> opt<span class="token punctuation">;</span> <span class="token keyword">do</span>  <span class="token keyword">case</span> <span class="token variable">$opt</span> <span class="token keyword">in</span>    r<span class="token punctuation">)</span>      <span class="token assign-left variable">redis_pass</span><span class="token operator">=</span><span class="token variable">$OPTARG</span>      <span class="token punctuation">;</span><span class="token punctuation">;</span>    <span class="token punctuation">\</span>?<span class="token punctuation">)</span>      <span class="token builtin class-name">echo</span> <span class="token string">"å‚æ•°é”™è¯¯ > ä½¿ç”¨è¯´æ˜ï¼š"</span>      <span class="token builtin class-name">echo</span> <span class="token string">"./init-prog.sh -r &lt;rediså¯†ç >"</span>      <span class="token builtin class-name">exit</span> <span class="token number">0</span>      <span class="token punctuation">;</span><span class="token punctuation">;</span>  <span class="token keyword">esac</span><span class="token keyword">done</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"ä½¿ç”¨è¯´æ˜ï¼š"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"./init-prog.sh -r &lt;rediså¯†ç >"</span>    <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$redis_pass</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token assign-left variable">redis_pass</span><span class="token operator">=</span><span class="token string">'123456'</span>  <span class="token builtin class-name">echo</span> <span class="token string">"redisé»˜è®¤å¯†ç : <span class="token variable">$redis_pass</span>"</span><span class="token keyword">fi</span><span class="token builtin class-name">echo</span> <span class="token string">">>> å¼€å§‹å®‰è£… telnet &lt;&lt;&lt;"</span> <span class="token function">nohup</span> <span class="token function">apt</span> <span class="token function">install</span> telnet <span class="token parameter variable">-y</span> <span class="token operator">>></span> init-program.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token builtin class-name">echo</span> <span class="token string">">>> å¼€å§‹å®‰è£… Redis &lt;&lt;&lt;"</span><span class="token function">nohup</span> <span class="token function">apt</span> <span class="token function">install</span> redis-server <span class="token parameter variable">-y</span> <span class="token operator">>></span> init-program.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^bind 127.0.0.1 ::1/#bind 127.0.0.1 ::1/g'</span> /etc/redis/redis.conf<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">"s/# requirepass foobared/requirepass <span class="token variable">$1</span>/g"</span> /etc/redis/redis.conf<span class="token builtin class-name">echo</span> <span class="token string">"rediså®‰è£…å¹¶é…ç½®å®Œæˆ,å¯†ç ä¸º <span class="token variable">$1</span> "</span><span class="token builtin class-name">echo</span> <span class="token string">">>> å¼€å§‹å®‰è£… Nginx &lt;&lt;&lt;"</span><span class="token function">nohup</span> <span class="token function">apt</span> <span class="token function">install</span> nginx-full <span class="token parameter variable">-y</span> <span class="token operator">>></span> init-program.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token builtin class-name">echo</span> <span class="token string">">>> å¼€å§‹å®‰è£… JDK8 &lt;&lt;&lt;"</span><span class="token function">nohup</span> <span class="token function">apt</span> <span class="token function">install</span> openjdk-8-jdk <span class="token parameter variable">-y</span> <span class="token operator">>></span> init-program.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> $<span class="token builtin class-name">echo</span> <span class="token string">"æ·»åŠ  JAVA ç¯å¢ƒå˜é‡"</span><span class="token builtin class-name">echo</span> <span class="token string">'JAVA_HOME8="/usr/lib/jvm/java-8-openjdk-arm64/jre/bin/java"'</span> <span class="token operator">>></span> /etc/environment<span class="token builtin class-name">echo</span> <span class="token string">'JAVA_HOME=$JAVA_HOME8'</span> <span class="token operator">>></span> /etc/profile<span class="token builtin class-name">source</span> /etc/environment<span class="token builtin class-name">echo</span> <span class="token string">'è¯·è¾“å…¥ echo $JAVA_HOME ç”¨ä»¥æ ¡éªŒ'</span><span class="token builtin class-name">echo</span> <span class="token string">">>> å¼€å§‹å®‰è£… mysql &lt;&lt;&lt;"</span> <span class="token function">nohup</span> <span class="token function">apt</span> <span class="token function">install</span> mysql-server <span class="token parameter variable">-y</span> <span class="token operator">>></span> init-mysql.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^bind-address/#bind-address/g'</span> /etc/mysql/mysql.conf.d/mysqld.cnfmysql <span class="token operator">&lt;&lt;</span> <span class="token string">EOFALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'dee_mysql';create user 'saddyfire'@'%' identified by  'dee_mysql';grant all privileges on *.* to 'saddyfire'@'%' with grant option;flush privileges;exitEOF</span><span class="token builtin class-name">echo</span> <span class="token string">">>> mysql å®‰è£…å®Œæˆ&lt;&lt;&lt;"</span><span class="token builtin class-name">echo</span> <span class="token string">">>> è´¦å·: saddyfire å¯†ç : dee_mysql&lt;&lt;&lt;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Pi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-Tuning-02-JVMç›‘æ§åŠè¯Šæ–­-å·¥å…·ç¯‡</title>
      <link href="/2024/01/07/jvm-tuning2/"/>
      <url>/2024/01/07/jvm-tuning2/</url>
      
        <content type="html"><![CDATA[<h1>JVMç›‘æ§åŠè¯Šæ–­-å·¥å…·ç¯‡</h1><h2 id="01-å·¥å…·æ¦‚è¿°">01-å·¥å…·æ¦‚è¿°</h2><p>ä½¿ç”¨ä¸Šä¸€ç« å‘½ä»¤è¡Œå·¥å…·æˆ–ç»„åˆèƒ½å¸®æ‚¨è·å–ç›®æ ‡]aVaåº”ç”¨æ€§èƒ½ç›¸å…³çš„åŸºç¡€ä¿¡æ¯ï¼Œä½†å®ƒä»¬å­˜åœ¨ä¸‹åˆ—å±€é™ï¼š</p><ol><li>æ— æ³•è·å–æ–¹æ³•çº§åˆ«çš„åˆ†ææ•°æ®ï¼Œå¦‚æ–¹æ³•é—´çš„è°ƒç”¨å…³ç³»ã€å„æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´<br>ç­‰ï¼ˆè¿™å¯¹å®šä½åº”ç”¨æ€§èƒ½ç“¶é¢ˆè‡³å…³é‡è¦ï¼‰ã€‚</li><li>è¦æ±‚ç”¨æˆ·ç™»å½•åˆ°ç›®æ ‡Javaåº”ç”¨æ‰€åœ¨çš„å®¿ä¸»æœºä¸Šï¼Œä½¿ç”¨èµ·æ¥ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚</li><li>åˆ†ææ•°æ®é€šè¿‡ç»ˆç«¯è¾“å‡ºï¼Œç»“æœå±•ç¤ºä¸å¤Ÿç›´è§‚ã€‚</li></ol><p>ä¸ºæ­¤ï¼ŒJDK æä¾›äº†ä¸€äº›å†…å­˜æ³„æ¼çš„åˆ†æå·¥å…·ï¼Œå¦‚ jconsole, jvisualvm ç­‰ï¼Œç”¨äºè¾…åŠ©å¼€å‘äººå‘˜å®šä½é—®é¢˜ï¼Œä½†æ˜¯è¿™äº›å·¥å…·å¾ˆå¤šæ—¶å€™å¹¶ä¸è¶³ä»¥æ»¡è¶³å¿«é€Ÿå®šä½çš„éœ€æ±‚ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä»‹ç»çš„å·¥å…·ç›¸å¯¹å¤šä¸€äº›ã€ä¸°å¯Œä¸€äº›ã€‚</p><p><strong>å›¾å½¢åŒ–ç»¼åˆè¯Šæ–­å·¥å…·</strong></p><ul><li><p>JDKè‡ªå¸¦çš„å·¥å…·</p><ul><li>jconsole: JDK è‡ªå¸¦çš„å¯è§†åŒ–ç›‘æ§å·¥å…·ã€‚æŸ¥çœ‹Javaåº”ç”¨ç¨‹åºçš„è¿è¡Œæ¦‚å†µã€ç›‘æ§å †ä¿¡ã€‚<br>æ¯ã€æ°¸ä¹…åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰ä½¿ç”¨æƒ…å†µã€ç±»åŠ è½½æƒ…å†µç­‰ã€‚</li><li>Visual VM: Visual VM æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¯è§†ç•Œé¢ï¼Œç”¨äºæŸ¥çœ‹ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„åŸºäºJavaæŠ€æœ¯çš„åº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li>JMC: Java Mission Control, å†…ç½® Java Flight Recorderã€‚èƒ½å¤Ÿä»¥æä½çš„æ€§èƒ½å¼€é”€æ”¶é›† Java è™šæ‹Ÿæœºçš„æ€§èƒ½æ•°æ®ã€‚</li></ul></li><li><p>ç¬¬ä¸‰æ–¹å·¥å…·</p><ul><li><p>MAT: MAT(Memory Analyzer Tool) æ˜¯åŸºäº Eclipse çš„å†…å­˜åˆ†æå·¥å…·ï¼Œæ˜¯ä¸€ä¸ªå¿«é€Ÿã€åŠŸèƒ½ä¸°å¯Œçš„ Java heap åˆ†æå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾å†…å­˜æ³„æ¼å’Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚</p><blockquote><p>Eclipseçš„æ’ä»¶å½¢å¼</p></blockquote></li><li><p>JProfiler: å•†ä¸šè½¯ä»¶ï¼Œéœ€è¦ä»˜è´¹ã€‚åŠŸèƒ½å¼ºå¤§ã€‚</p><blockquote><p>ä¸ VisualVM ç±»ä¼¼</p></blockquote></li><li><p>Arthas: Alibaba å¼€æºçš„ Java è¯Šæ–­å·¥å…·ã€‚</p></li><li><p>Btrace: Java è¿è¡Œæ—¶è¿½è¸ªå·¥å…·. å¯ä»¥åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹, è·Ÿè¸ªæŒ‡å®šçš„æ–¹æ³•è°ƒç”¨ã€æ„é€ å‡½æ•°è°ƒç”¨å’Œç³»ç»Ÿå†…å­˜ç­‰ä¿¡æ¯ã€‚</p></li></ul></li></ul><h2 id="02-JConsole">02-JConsole</h2><p><img src="./../jvm-tuning2/image-20240108221409666.png" alt="æ¦‚è§ˆ"></p><p><img src="./../jvm-tuning2/image-20240108221430344.png" alt="å†…å­˜"></p><p><img src="./../jvm-tuning2/image-20240108221631164.png" alt="æ£€æµ‹æ­»é”"></p><p><img src="./../jvm-tuning2/image-20240108221658907.png" alt="VM æ¦‚è¦"></p><h2 id="03-Visual-VM">03-Visual VM</h2><h3 id="æ’ä»¶çš„å®‰è£…">æ’ä»¶çš„å®‰è£…</h3><ul><li>Visual VM çš„ä¸€å¤§ç‰¹ç‚¹æ˜¯æ”¯æŒæ’ä»¶æ‰©å±•ï¼Œå¹¶ä¸”æ’ä»¶å®‰è£…éå¸¸æ–¹ä¾¿ã€‚æˆ‘ä»¬æ—¢å¯ä»¥é€šè¿‡ç¦»çº¿ä¸‹è½½æ’ä»¶æ–‡ä»¶ *.nbm, ç„¶ååœ¨ Plugin å¯¹è¯æ¡†çš„å·±ä¸‹è½½é¡µé¢ä¸‹ï¼Œæ·»åŠ å·±ä¸‹è½½çš„æ’ä»¶ã€‚ä¹Ÿå¯ä»¥åœ¨å¯ç”¨æ’ä»¶é¡µé¢ä¸‹ï¼Œåœ¨çº¿å®‰è£…æ’ä»¶ã€‚ï¼ˆè¿™é‡Œå»ºè®®å®‰è£…ä¸Šï¼šVisualGC)<br>æ’ä»¶åœ°å€ï¼š<a href="https://visualvm.github.io/pluginscenters.html">https://visualvm.github.io/pluginscenters.html</a></li></ul><h3 id="1-ç”Ÿæˆ-è¯»å–å †å†…å­˜å¿«ç…§">1-ç”Ÿæˆ/è¯»å–å †å†…å­˜å¿«ç…§</h3><h2 id="04-Eclipse-MAT">04-Eclipse MAT</h2><h3 id="è·å–å †dumpæ–‡ä»¶">è·å–å †dumpæ–‡ä»¶</h3><p>MATå¯ä»¥åˆ†æheap dumpæ–‡ä»¶ã€‚åœ¨è¿›è¡Œå†…å­˜åˆ†ææ—¶ï¼Œåªè¦è·å¾—äº†åæ˜ å½“å‰è®¾å¤‡å†…å­˜æ˜ åƒçš„nprofæ–‡ä»¶ï¼Œé€šè¿‡MATæ‰“å¼€å°±å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°å½“å‰çš„å†…å­˜ä¿¡æ¯ã€‚<br>ä¸€èˆ¬è¯´æ¥ï¼Œè¿™äº›å†…å­˜ä¿¡æ¯åŒ…å«ï¼š</p><ul><li>æ‰€æœ‰çš„å¯¹è±¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¯¹è±¡å®ä¾‹ã€æˆå‘˜å˜é‡ã€å­˜å‚¨äºæ ˆä¸­çš„åŸºæœ¬ç±»å‹å€¼å’Œå­˜å‚¨äºå †ä¸­çš„å…¶ä»–å¯¹è±¡çš„å¼•ç”¨å€¼ã€‚</li><li>æ‰€æœ‰çš„ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬classloaderã€ç±»åç§°ã€çˆ¶ç±»ã€é™æ€å˜é‡ç­‰</li><li>GCRoot åˆ°æ‰€æœ‰çš„è¿™äº›å¯¹è±¡çš„å¼•ç”¨è·¯å¾„</li><li>çº¿ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„è°ƒç”¨æ ˆåŠæ­¤çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡(TLS)</li></ul><p><strong>è·å–å †dumpæ–‡ä»¶</strong></p><ol><li><p>é€šè¿‡å‰ä¸€ç« ä»‹ç»çš„jmapå·¥å…·ç”Ÿæˆï¼Œå¯ä»¥ç”Ÿæˆä»»æ„ä¸€ä¸ªjavaè¿›ç¨‹çš„dumpæ–‡ä»¶ï¼š</p></li><li><p>é€šè¿‡é…ç½®JVMå‚æ•°ç”Ÿæˆã€‚</p><ul><li>é€‰é¡¹ <code>-XX:+HeapDumpOnOutOfMemoryError</code> æˆ– <code>-XX:+HeapDumpBeforeFullGC</code></li><li>é€‰é¡¹ <code>-XX:HeapDumpPath</code> æ‰€ä»£è¡¨çš„å«ä¹‰å°±æ˜¯å½“ç¨‹åºå‡ºç° OutofMemory æ—¶ï¼Œå°†ä¼šåœ¨ç›¸åº”çš„ç›®å½•ä¸‹ç”Ÿæˆä¸€ä»½ dump æ–‡ä»¶ã€‚å¦‚æœä¸æŒ‡å®šé€‰é¡¹ <code>-XX:HeapDumpPath</code> åˆ™åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ dump æ–‡ä»¶ã€‚</li></ul></li></ol><p>å¯¹æ¯”ï¼šè€ƒè™‘åˆ°ç”Ÿäº§ç¯å¢ƒä¸­å‡ ä¹ä¸å¯èƒ½åœ¨çº¿å¯¹å…¶è¿›è¡Œåˆ†æï¼Œå¤§éƒ½æ˜¯é‡‡ç”¨ç¦»çº¿åˆ†æï¼Œå› æ­¤ä½¿ç”¨ jmap + MAT å·¥å…·æ˜¯æœ€å¸¸è§çš„ç»„åˆã€‚</p><ol start="3"><li><p>ä½¿ç”¨ VisualVM å¯ä»¥å¯¼å‡ºå † ump æ–‡ä»¶ã€‚</p></li><li><p>ä½¿ç”¨ MAT å³å¯æ‰“å¼€ä¸€ä¸ªå·²æœ‰çš„å †å¿«ç…§, ä¹Ÿå¯ä»¥é€šè¿‡ MAT ç›´æ¥ä»æ´»åŠ¨ Java ç¨‹åºä¸­å¯¼å‡ºå †å¿«ç…§ã€‚</p><p>è¯¥åŠŸèƒ½å°†å€ŸåŠ© jps åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„ Java è¿›ç¨‹, ä»¥ä¾›é€‰æ‹©å¹¶è·å–å¿«ç…§ã€‚</p></li></ol><h3 id="åˆ†æå †dumpæ–‡ä»¶">åˆ†æå †dumpæ–‡ä»¶</h3><h4 id="æ¦‚è¿°">æ¦‚è¿°</h4><p><img src="./../jvm-tuning2/image-20240114213029332.png" alt=""></p><p><img src="./../jvm-tuning2/image-20240115130520402.png" alt="image-20240115130520402"></p><h4 id="Histogram">Histogram</h4><p><img src="./../jvm-tuning2/image-20240114215411645.png" alt=""></p><h4 id="thread-overview">thread_overview</h4><p><img src="./../jvm-tuning2/image-20240114220539571.png" alt="è·å¾—æ¹˜æ¹–å¼•ç”¨çš„å…³ç³»"></p><h4 id="æ·±å †ä¸æµ…å †">æ·±å †ä¸æµ…å †</h4><p><strong>æµ…å †(Shallow Heap)</strong> æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡æ‰€æ¶ˆè€—çš„å†…å­˜ã€‚åœ¨ 32 ä½ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä¼šå æ® 4 ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ª int ç±»å‹ä¼šå æ® 4 ä¸ªå­—èŠ‚ï¼Œlong å‹å˜é‡ä¼šå æ® 8 ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå¯¹è±¡å¤´éœ€è¦å ç”¨ 8 ä¸ªå­—èŠ‚ã€‚æ ¹æ®å †å¿«ç…§æ ¼å¼ä¸åŒï¼Œå¯¹è±¡çš„å¤§å°å¯èƒ½ä¼šå‘ 8 å­—èŠ‚è¿›è¡Œå¯¹é½ã€‚</p><p>ä»¥ String ä¸ºä¾‹ï¼š2 ä¸ª int å€¼å…±å  8 å­—èŠ‚ï¼Œå¯¹è±¡å¼•ç”¨å ç”¨ 4 å­—èŠ‚ï¼Œå¯¹è±¡å¤´ 8 å­—èŠ‚ï¼Œåˆè®¡ 20 å­—èŠ‚ï¼Œå‘ 8 å­—èŠ‚å¯¹é½ï¼Œæ•…å  24 å­—èŠ‚ã€‚(jdk7ä¸­)</p><table><thead><tr><th>Stringå¯¹è±¡ç©ºé—´</th><th></th><th></th></tr></thead><tbody><tr><td>int</td><td>hash32</td><td>0</td></tr><tr><td>int</td><td>hash</td><td>0</td></tr><tr><td>ref</td><td>value</td><td>C:\Users\Administrat</td></tr></tbody></table><p>è¿™ 24 å­—èŠ‚ä¸º String å¯¹è±¡çš„æµ…å †å¤§å°. å®ƒä¸ String çš„ value å®é™…å–å€¼æ— å…³, æ— è®ºå­—ç¬¦ä¸²é•¿åº¦å¦‚ä½•, æµ…å †å¤§å°å§‹ç»ˆæ˜¯ 24 å­—èŠ‚</p><p><strong>ä¿ç•™é›†(Retained Set):</strong><br>å¯¹è±¡ A çš„ä¿ç•™é›†æŒ‡å½“å¯¹è±¡ A è¢«æ‹‰åƒåœ¾å›æ”¶åï¼Œå¯ä»¥è¢«é‡Šæ”¾çš„æ‰€æœ‰çš„å¯¹è±¡é›†åˆï¼ˆåŒ…æ‹¬å¯¹è±¡ A æœ¬èº«ï¼‰ï¼Œå³å¯¹è±¡ A çš„ä¿ç•™é›†å¯ä»¥è¢«è®¤ä¸ºæ˜¯<strong>åªèƒ½é€šè¿‡</strong>å¯¹è±¡ A è¢«ç›´æ¥æˆ–é—´æ¥è®¿é—®åˆ°çš„æ‰€æœ‰å¯¹è±¡çš„é›†åˆã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯æŒ‡ä»…è¢«å¯¹è±¡Aæ‰€æŒæœ‰çš„å¯¹è±¡çš„é›†åˆã€‚</p><img src="./../jvm-tuning2/image-20240114222017532.png" style="zoom: 50%;" /><p><strong>æ·±å †(Retained Heap):</strong><br>æ·±å †æ˜¯æŒ‡å¯¹è±¡çš„ä¿ç•™é›†ä¸­æ‰€æœ‰çš„å¯¹è±¡çš„æµ…å †å¤§å°ä¹‹å’Œã€‚</p><p>æ³¨æ„ï¼šæµ…å †æŒ‡å¯¹è±¡æœ¬èº«å ç”¨çš„å†…å­˜ï¼Œä¸åŒ…æ‹¬å…¶å†…éƒ¨å¼•ç”¨å¯¹è±¡çš„å¤§å°ã€‚ä¸€ä¸ªå¯¹è±¡çš„æ·±å †æŒ‡åªèƒ½é€šè¿‡è¯¥å¯¹è±¡è®¿é—®åˆ°çš„ï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰æ‰€æœ‰å¯¹è±¡çš„æµ…å †ä¹‹å’Œï¼Œå³å¯¹è±¡è¢«å›æ”¶åï¼Œå¯ä»¥é‡Šæ”¾çš„çœŸå®ç©ºé—´ã€‚</p><p><strong>å¯¹è±¡çš„å®é™…å¤§å°</strong></p><p>å¦å¤–ä¸€ä¸ªå¸¸ç”¨çš„æ¦‚å¿µæ˜¯å¯¹è±¡çš„å®é™…å¤§å°ã€‚è¿™é‡Œï¼Œå¯¹è±¡çš„å®é™…å¤§å°å®šä¹‰ä¸ºä¸€ä¸ªå¯¹è±¡æ‰€èƒ½è§¦åŠçš„æ‰€æœ‰å¯¹è±¡çš„æµ…å †å¤§å°ä¹‹å’Œï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šæˆ‘ä»¬è¯´çš„å¯¹è±¡å¤§å°ã€‚ä¸æ·±å †ç›¸æ¯”ï¼Œä¼¼ä¹è¿™ä¸ªåœ¨æ—¥å¸¸å¼€å‘ä¸­æ›´ä¸ºç›´è§‚å’Œè¢«äººæ¥å—ï¼Œ<strong>ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªæ¦‚å¿µå’Œåƒåœ¾å›æ”¶æ— å…³ã€‚</strong></p><p>ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„å¯¹è±¡å¼•ç”¨å…³ç³»å›¾ï¼Œå¯¹è±¡ A å¼•ç”¨äº† C å’Œ D, å¯¹è±¡ B å¼•ç”¨äº† C å’Œ Eã€‚é‚£ä¹ˆå¯¹è±¡ A çš„æµ…å †å¤§å°åªæ˜¯ A æœ¬èº«ï¼Œä¸å« C å’Œ D,è€Œ A çš„å®é™…å¤§å°ä¸ºAã€Cã€Dä¸‰è€…ä¹‹å’Œã€‚è€Œ A çš„æ·±å †å¤§å°ä¸º A ä¸ D ä¹‹å’Œï¼Œç”±äºå¯¹è±¡ C è¿˜å¯ä»¥é€šè¿‡å¯¹è±¡ B è®¿é—®åˆ°ï¼Œå› æ­¤ä¸åœ¨å¯¹è±¡ A çš„æ·±å †èŒƒå›´å†…ã€‚</p><p><img src="./../jvm-tuning2/image-20240114222337156.png" alt=""></p><blockquote><p>A çš„æµ…å †å¤§å°åªæœ‰å®ƒè‡ªå·±, A çš„æ·±å †å¤§å°åˆ™æ˜¯ A + D, A å¯¹è±¡çš„å®é™…å¤§å°æ˜¯ A + C + D</p></blockquote><p><strong>çœ‹å›¾ç†è§£ Retained Size</strong></p><p><img src="./../jvm-tuning2/image-20240114222649031.png" alt=""></p><blockquote><p>ä¸Šå›¾ä¸­, GC Roots ç›´æ¥å¼•ç”¨äº† A å’Œ B ä¸¤ä¸ªå¯¹è±¡</p><p>A å¯¹è±¡çš„ Retained Size=A å¯¹è±¡çš„ Shallow Size</p><p>B å¯¹è±¡çš„ Retained Size=B å¯¹è±¡çš„ Shallow Size + C å¯¹è±¡çš„ Shallow Size</p><p>è¿™é‡Œéƒ¨åŒ…æ‹¬ D å¯¹è±¡, å› ä¸º D å¯¹è±¡è¢« GC Roots ç›´æ¥å¼•ç”¨</p><p>å¦‚æœ GC Roots ä¸å¼•ç”¨ D å¯¹è±¡å‘¢?</p></blockquote><p><img src="./../jvm-tuning2/image-20240114222937490.png" alt="æ­¤æ—¶Bçš„æ·±å †å’Œå®é™…å¤§å°æ˜¯ä¸€æ ·çš„"></p><p><strong>æ¡ˆä¾‹åˆ†æ StudentTrace</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//-XX:+HeapDumpBeforeFullGC -XX:HeapDumpPath=d:\student.hprof</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentTrace</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebPage</span><span class="token punctuation">></span></span> webpages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebPage</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createWebPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">WebPage</span> wp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            wp<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"http://www."</span> <span class="token operator">+</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            wp<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            webpages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>wp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">createWebPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºäº†100ä¸ªç½‘é¡µ</span>        <span class="token comment">//åˆ›å»º3ä¸ªå­¦ç”Ÿå¯¹è±¡</span>        <span class="token class-name">Student</span> st3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"Tom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Student</span> st5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"Jerry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Student</span> st7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"Lily"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> webpages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> st3<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                st3<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>webpages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> st5<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                st5<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>webpages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> st7<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                st7<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>webpages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        webpages<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebPage</span><span class="token punctuation">></span></span> history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> id<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebPage</span><span class="token punctuation">></span></span> <span class="token function">getHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> history<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHistory</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebPage</span><span class="token punctuation">></span></span> history<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> history<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">WebPage</span> wp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>wp <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            history<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>wp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">WebPage</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> url<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> content<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œåç”¨ MAT æ‰“å¼€, æ‰“å¼€ thread_over</p><p><img src="./../jvm-tuning2/image-20240115101947087.png" alt=""></p><p><img src="./../jvm-tuning2/image-20240115110940270.png" alt=""></p><blockquote><p>ä»¥ Lily ä¸ºä¾‹, elementData[ ] ä¸­æ€»å…±æœ‰15ä¸ª WebPage å¯¹è±¡(æ­¤å¤„ä¸èƒ½åªçœ‹æ•°ç»„é•¿åº¦, è¿™é‡Œæ˜¯æ•°ç»„é•¿åº¦æ°å¥½ç­‰äºå…ƒç´ ä¸ªæ•°)</p><p>13ä¸ª152 å­—èŠ‚, 2ä¸ª144å­—èŠ‚, 13 * 152 + 2 * 144 = 2264 &lt; 1288</p><p>æ˜¯å› ä¸ºæœ‰ä¸€äº› WebPage æ˜¯å®ƒä»¬å…±æœ‰çš„, å› æ­¤ä¸èƒ½ç®—ä½œ Lily çš„æ·±å †</p><p>èƒ½è¢« 7 æ•´é™¤, ä¸”èƒ½è¢« 3 æ•´é™¤, ä»¥åŠèƒ½è¢« 5æ•´é™¤çš„æ•°: 0, 21, 35, 42, 63, 70, 84. å…± 7 ä¸ª. å³ 6 * 152 + 1 * 144 = 1056</p><p>2264 - 1056 = 1208 = 1288 - 80å­—èŠ‚! (å³: è¿˜å¯ä»¥å¤šå›æ”¶ 80 ä¸ªå­—èŠ‚)</p><p>è¿™ 80 ä¸ªå­—èŠ‚æ˜¯ä»€ä¹ˆ??</p><p>å³ elementData å¯¹è±¡æœ¬èº«çš„æµ…å †:</p><ul><li>å¯¹è±¡å¤´ = 12ä¸ªå­—èŠ‚(é»˜è®¤é‡‡ç”¨æŒ‡é’ˆå‹ç¼©, æ²¡æœ‰åˆ™æ˜¯16å­—èŠ‚) + 4(æ•°ç»„é•¿åº¦)</li><li>æ•°ç»„æœ¬èº«4ä¸ªå­—èŠ‚æ•°</li><li>æ•°ç»„å¼•ç”¨ = 15ä¸ªelementDataçš„å…ƒç´  * 4 = 60å­—èŠ‚</li></ul><p><strong>è¡¥å……: ä¸ºä»€ä¹ˆä¼šæœ‰ 152 å­—èŠ‚å’Œ 144 å­—èŠ‚:</strong></p><p>å› ä¸ºURLå’Œcontentä¼šå­˜åœ¨ä¸¤ç§æƒ…å†µ:</p><ul><li><p>URL: â€œ<a href="http://www.7.com">http://www.7.com</a>â€  content: â€œ7â€</p><ul><li><p>URLé•¿åº¦ä¸º 16, åº•å±‚çš„ char æ•°ç»„çš„å ç”¨ç©ºé—´ä¸º([ ] æ–¹æ‹¬å·é‡Œé¢æ•´ä¸ªéƒ½å±äºå¯¹è±¡å¤´, åˆ†å¼€å†™æ–¹ä¾¿ç†è§£)</p><p>[æ™®é€šå¯¹è±¡å¤´(12) + æ•°ç»„é•¿åº¦(4)] + 16ä¸ªå­—ç¬¦(32) = 48å­—èŠ‚, ç¬¦åˆ 8 å­—èŠ‚å¯¹é½</p><p>åŒç† content å ç”¨ [æ™®é€šå¯¹è±¡å¤´(12) + æ•°ç»„é•¿åº¦(4)] + ä¸€ä¸ªå­—ç¬¦(2) = 18 å­—èŠ‚, å…«å­—èŠ‚å¯¹é½=24å­—èŠ‚</p></li></ul></li><li><p>URL: â€œ<a href="http://www.14.com">http://www.14.com</a>â€  content: â€œ14â€</p><ul><li><p>URLé•¿åº¦ä¸º17, åº•å±‚çš„ char æ•°ç»„çš„å ç”¨ç©ºé—´ä¸º</p><p>[æ™®é€šå¯¹è±¡å¤´(12) + æ•°ç»„é•¿åº¦(4)] + 17ä¸ªå­—ç¬¦(34) = 50å­—èŠ‚, ä¸ç¬¦åˆ8å­—èŠ‚å¯¹é½, å¯¹é½ä¸º 56</p><p>åŒç† content å ç”¨ [æ™®é€šå¯¹è±¡å¤´(12) + æ•°ç»„é•¿åº¦(4)] + ä¸¤ä¸ªå­—ç¬¦(4) = 20 å­—èŠ‚, å…«å­—èŠ‚å¯¹é½=24å­—èŠ‚</p></li></ul></li></ul><p>å› æ­¤ç¬¬äºŒç§æ¯”ç¬¬ä¸€ç§å¤šäº† 8 å­—èŠ‚, æ‰€ä»¥æ˜¯ 152 å’Œ 144 (ä¸ºä»€ä¹ˆæ€»å¤§å°æ˜¯ 152 è€Œä¸æ˜¯ 72 æ˜¯å› ä¸ºæˆ‘ä»¬åªè®¡ç®—äº† String åº•å±‚çš„ char æ•°ç»„çš„åŒºåˆ«, æ²¡æœ‰è®¡ç®—å„å˜é‡æœ¬èº«çš„æµ…å †, å› ä¸ºç»“æ„éƒ½ç›¸åŒ, æ‰€ä»¥å·®åˆ«å°±å·®åœ¨å†…å®¹çš„å ç”¨ä¸Š)</p></blockquote><h4 id="æ”¯é…æ ‘">æ”¯é…æ ‘</h4><p>(Dominator Tree)</p><p>æ”¯é…æ ‘çš„æ¦‚å¿µæºè‡ªå›¾è®ºã€‚</p><p>MAT æä¾›äº†ä¸€ä¸ªç§°ä¸ºæ”¯é…æ ‘(Dominator Tree)çš„å¯¹è±¡å›¾ã€‚æ”¯é…æ ‘ä½“ç°äº†å¯¹è±¡å®ä¾‹é—´çš„æ”¯é…å…³ç³»ã€‚åœ¨å¯¹è±¡å¼•ç”¨å›¾ä¸­ï¼Œæ‰€æœ‰æŒ‡å‘å¯¹è±¡Bçš„è·¯å¾„éƒ½ç»è¿‡å¯¹è±¡ A, åˆ™è®¤ä¸º<strong>å¯¹è±¡ A æ”¯é…å¯¹è±¡ B</strong>ã€‚å¦‚æœå¯¹è±¡ A æ˜¯ç¦»å¯¹è±¡ B æœ€è¿‘çš„ä¸€ä¸ªæ”¯é…å¯¹è±¡ï¼Œåˆ™è®¤ä¸ºå¯¹è±¡ A ä¸ºå¯¹è±¡ B çš„<strong>ç›´æ¥æ”¯é…è€…</strong>ã€‚æ”¯é…æ ‘æ˜¯åŸºäºå¯¹è±¡é—´çš„å¼•ç”¨å›¾æ‰€å»ºç«‹çš„ï¼Œå®ƒæœ‰ä»¥ä¸‹åŸºæœ¬æ€§è´¨ï¼š</p><ul><li>å¯¹è±¡Açš„å­æ ‘ï¼ˆæ‰€æœ‰è¢«å¯¹è±¡Aæ”¯é…çš„å¯¹è±¡é›†åˆï¼‰è¡¨ç¤ºå¯¹è±¡Açš„ä¿ç•™é›†(retained set),å³æ·±å †ã€‚</li><li>å¦‚æœå¯¹è±¡Aæ”¯é…å¯¹è±¡B,é‚£ä¹ˆå¯¹è±¡Açš„ç›´æ¥æ”¯é…è€…ä¹Ÿæ”¯é…å¯¹è±¡Bã€‚</li><li>æ”¯é…æ ‘çš„è¾¹ä¸å¯¹è±¡å¼•ç”¨å›¾çš„è¾¹ä¸ç›´æ¥å¯¹åº”ã€‚</li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå·¦å›¾è¡¨ç¤ºå¯¹è±¡å¼•ç”¨å›¾ï¼Œå³å›¾è¡¨ç¤ºå·¦å›¾æ‰€å¯¹åº”çš„æ”¯é…æ ‘ã€‚å¯¹è±¡ A å’Œ B ç”±æ ¹å¯¹è±¡ç›´æ¥æ”¯é…ï¼Œç”±äºåœ¨åˆ°å¯¹è±¡ C çš„è·¯å¾„ä¸­ï¼Œå¯ä»¥ç»è¿‡ Aï¼Œä¹Ÿå¯ä»¥ç»è¿‡ B, å› æ­¤å¯¹è±¡ C çš„ç›´æ¥æ”¯é…è€…ä¹Ÿæ˜¯æ ¹å¯¹è±¡ã€‚å¯¹è±¡ F ä¸å¯¹è±¡ D ç›¸äº’å¼•ç”¨ï¼Œå› ä¸ºåˆ°å¯¹è±¡ F çš„æ‰€æœ‰è·¯å¾„å¿…ç„¶ç»è¿‡å¯¹è±¡ D, å› æ­¤ï¼Œå¯¹è±¡ D æ˜¯å¯¹è±¡ F çš„ç›´æ¥æ”¯é…è€…ã€‚è€Œåˆ°å¯¹è±¡ D çš„æ‰€æœ‰è·¯å¾„ä¸­ï¼Œå¿…ç„¶ç»è¿‡å¯¹è±¡ C, å³ä½¿æ˜¯ä»å¯¹è±¡ F åˆ°å¯¹è±¡ D çš„å¼•ç”¨ï¼Œä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œä¹Ÿæ˜¯ç»è¿‡å¯¹è±¡ C çš„ï¼Œæ‰€ä»¥ï¼Œå¯¹è±¡ D çš„ç›´æ¥æ”¯é…è€…ä¸ºå¯¹è±¡ Cã€‚</p><p><img src="./../jvm-tuning2/image-20240115124856415.png" alt="å·¦-å¼•ç”¨å…³ç³» å³-æ”¯é…æ ‘"></p><p>åŒç†ï¼Œå¯¹è±¡ E æ”¯é…å¯¹è±¡ Gã€‚åˆ°è¾¾å¯¹è±¡ H çš„å¯ä»¥é€šè¿‡å¯¹è±¡ D ,ä¹Ÿå¯ä»¥é€šè¿‡å¯¹è±¡ E,å› æ­¤å¯¹è±¡ D å’Œ E éƒ½ä¸èƒ½æ”¯é…å¯¹è±¡ H, è€Œç»è¿‡å¯¹è±¡ C æ—¢å¯ä»¥åˆ°è¾¾ D ä¹Ÿå¯ä»¥åˆ°è¾¾ E, å› æ­¤å¯¹è±¡ C ä¸ºå¯¹è±¡ H çš„ç›´æ¥æ”¯é…è€…ã€‚</p><p>åœ¨ MAT ä¸­, å•æœºå·¥å…·æ ä¸Šçš„å¯¹è±¡æ”¯é…æ ‘æŒ‰é’®, å¯ä»¥æ‰“å¼€å¯¹è±¡æ”¯é…æ ‘è§†å›¾ã€‚</p><p><img src="./../jvm-tuning2/image-20240115125324965.png" alt=""></p><p>ä¸‹å›¾æ˜¾ç¤ºäº†å¯¹è±¡æ”¯é…æ ‘è§†å›¾çš„ä¸€éƒ¨åˆ†ã€‚è¯¥æˆªå›¾æ˜¾ç¤ºéƒ¨åˆ† Lily å­¦ç”Ÿçš„ history é˜Ÿåˆ—çš„ç›´æ¥æ”¯é…å¯¹è±¡ã€‚å³å½“ Lily å¯¹è±¡è¢«å›æ”¶ï¼Œä¹Ÿä¼šä¸€å¹¶å›æ”¶çš„æ‰€æœ‰å¯¹è±¡ã€‚æ˜¾ç„¶èƒ½è¢« 3 æˆ–è€… 5 æ•´é™¤çš„ç½‘é¡µä¸ä¼šå‡ºç°åœ¨è¯¥åˆ—è¡¨ä¸­ï¼Œå› ä¸ºå®ƒä»¬åŒæ—¶è¢«å¦å¤–ä¸¤åå­¦ç”Ÿå¯¹è±¡å¼•ç”¨ã€‚</p><p><img src="./../jvm-tuning2/image-20240115125714133.png" alt=""></p><blockquote><p>é€šè¿‡æ­£åˆ™æœç´¢ Thread å, æ‰¾åˆ° Lily,</p><p>æ³¨æ„: æ­¤å¤„æ”¯é…æ ‘ä¸­çš„ ArrayList åªæœ‰ 8 ä¸ª, ä¸å‰é¢çš„å¼•ç”¨åˆ†æä¸­ 15-7=8 å°±èƒ½å¯¹ä¸Šäº†</p></blockquote><h3 id="æ¡ˆä¾‹-Tomcatå †æº¢å‡ºåˆ†æ">æ¡ˆä¾‹: Tomcatå †æº¢å‡ºåˆ†æ</h3><p>Tomcat æ˜¯æœ€å¸¸ç”¨çš„ Java Servlet å®¹å™¨ä¹‹ä¸€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å½“åšå•ç‹¬çš„ Web æœåŠ¡å™¨ä½¿ç”¨ã€‚Tomcat æœ¬èº«ä½¿ç”¨ Java å®ç°ï¼Œå¹¶è¿è¡Œäº Java è™šæ‹Ÿæœºä¹‹ä¸Šã€‚åœ¨å¤§è§„æ¨¡è¯·æ±‚æ—¶ï¼ŒTomcat æœ‰å¯èƒ½ä¼šå› ä¸ºæ— æ³•æ‰¿å—å‹åŠ›è€Œå‘ç”Ÿå†…å­˜æº¢å‡ºé”™è¯¯ã€‚è¿™é‡Œæ ¹æ®ä¸€ä¸ªè¢«å‹å®çš„ Tomcat çš„å †å¿«ç…§æ–‡ä»¶ï¼Œæ¥åˆ†æ Tomcat åœ¨å´©æºƒæ—¶çš„å†…éƒ¨æƒ…å†µã€‚</p><h4 id="åˆ†æè¿‡ç¨‹">åˆ†æè¿‡ç¨‹</h4><p><img src="./../jvm-tuning2/image-20240115132535587.png" alt=""></p><p><img src="./../jvm-tuning2/image-20240115132622706.png" alt=""></p><p><img src="./../jvm-tuning2/image-20240115132641999.png" alt=""></p><p><img src="./../jvm-tuning2/image-20240115133555411.png" alt=""></p><p>ç”±æ­¤ç»§ç»­æ’æŸ¥, å¹¶ä¸”ç»“åˆå®é™…åˆ†æ</p><h2 id="05-JProfiler">05-JProfiler</h2><h3 id="æ¦‚è¿°-2">æ¦‚è¿°</h3><ol><li><p>æ–¹æ³•è°ƒç”¨</p><p>å¯¹æ–¹æ³•è°ƒç”¨çš„åˆ†æå¯ä»¥å¸®åŠ©æ‚¨äº†è§£åº”ç”¨ç¨‹åºæ­£åœ¨åšä»€ä¹ˆï¼Œå¹¶æ‰¾åˆ°æé«˜å…¶æ€§èƒ½çš„æ–¹æ³•</p></li><li><p>å†…å­˜åˆ†é…</p><p>é€šè¿‡åˆ†æå †ä¸Šå¯¹è±¡ã€å¼•ç”¨é“¾å’Œåƒåœ¾æ”¶é›†èƒ½å¸®æ‚¨ä¿®å¤å†…å­˜æ³„éœ²é—®é¢˜ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨</p></li><li><p>çº¿ç¨‹å’Œé”</p><p>JProfileræä¾›å¤šç§é’ˆå¯¹çº¿ç¨‹å’Œé”çš„åˆ†æè§†å›¾åŠ©æ‚¨å‘ç°å¤šçº¿ç¨‹é—®é¢˜</p></li><li><p>é«˜çº§å­ç³»ç»Ÿ</p><p>è®¸å¤šæ€§èƒ½é—®é¢˜éƒ½å‘ç”Ÿåœ¨æ›´é«˜çš„è¯­ä¹‰çº§åˆ«ä¸Šã€‚ä¾‹å¦‚ï¼Œå¯¹äºJDBCè°ƒç”¨ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æ‰¾å‡ºæ‰§è¡Œæœ€æ…¢çš„SQLè¯­å¥ã€‚JProfileræ”¯æŒå¯¹è¿™äº›å­ç³»ç»Ÿè¿›è¡Œé›†æˆåˆ†æ</p></li></ol><h3 id="å®‰è£…ä¸é…ç½®">å®‰è£…ä¸é…ç½®</h3><h3 id="ä½¿ç”¨">ä½¿ç”¨</h3><p><strong>æ•°æ®é‡‡é›†æ–¹å¼</strong></p><p>JProfieræ•°æ®é‡‡é›†æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼šSampling(æ ·æœ¬é‡‡é›†) å’Œ Instrumentation(é‡æ„æ¨¡å¼)</p><ul><li>Instrumentation: è¿™æ˜¯ JProfiler:å…¨åŠŸèƒ½æ¨¡å¼ã€‚åœ¨ class åŠ è½½ä¹‹å‰ï¼ŒJProfier æŠŠç›¸å…³åŠŸèƒ½ä»£ç å†™å…¥åˆ°éœ€è¦åˆ†æçš„ class çš„ bytecodeä¸­ï¼Œå¯¹æ­£åœ¨è¿è¡Œçš„ jvm æœ‰ä¸€å®šå½±å“ã€‚<ul><li>ä¼˜ç‚¹ï¼šåŠŸèƒ½å¼ºå¤§ã€‚åœ¨æ­¤è®¾ç½®ä¸­ï¼Œè°ƒç”¨å †æ ˆä¿¡æ¯æ˜¯å‡†ç¡®çš„ã€‚</li><li>ç¼ºç‚¹ï¼šè‹¥è¦åˆ†æçš„ class è¾ƒå¤šï¼Œåˆ™å¯¹åº”ç”¨çš„æ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒCPU å¼€é”€å¯èƒ½å¾ˆé«˜ï¼ˆå–å†³äº Filter çš„æ§åˆ¶)ã€‚å› æ­¤ä½¿ç”¨æ­¤æ¨¡å¼ä¸€èˆ¬é…åˆ Filter ä½¿ç”¨ï¼Œåªå¯¹ç‰¹å®šçš„ç±»æˆ–åŒ…è¿›è¡Œåˆ†æ</li></ul></li><li>Sampling: ç±»ä¼¼äºæ ·æœ¬ç»Ÿè®¡ï¼Œæ¯éš”ä¸€å®šæ—¶é—´(5ms)å°†æ¯ä¸ªçº¿ç¨‹æ ˆä¸­æ–¹æ³•æ ˆä¸­çš„ä¿¡æ¯ç»Ÿè®¡å‡ºæ¥ã€‚<ul><li>ä¼˜ç‚¹ï¼šå¯¹ CPU çš„å¼€é”€éå¸¸ä½ï¼Œå¯¹åº”ç”¨å½±å“å°ï¼ˆå³ä½¿ä½ ä¸é…ç½®ä»»ä½• Filter)</li><li>ç¼ºç‚¹ï¼šä¸€äº›æ•°æ®/ç‰¹æ€§ä¸èƒ½æä¾›ï¼ˆä¾‹å¦‚ï¼šæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ï¼‰</li></ul></li></ul><blockquote><p>æ³¨ï¼šJProfiler æœ¬èº«æ²¡æœ‰æŒ‡å‡ºæ•°æ®çš„é‡‡é›†ç±»å‹ï¼Œè¿™é‡Œçš„é‡‡é›†ç±»å‹æ˜¯é’ˆå¯¹æ–¹æ³•è°ƒç”¨çš„é‡‡é›†ç±»å‹ã€‚<br>å› ä¸º JProfiler çš„ç»å¤§å¤šæ•°æ ¸å¿ƒåŠŸèƒ½éƒ½ä¾èµ–æ–¹æ³•è°ƒç”¨é‡‡é›†çš„æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è®¤ä¸ºæ˜¯ JProfiler çš„æ•°æ®é‡‡é›†ç±»å‹ã€‚</p></blockquote><p><strong>é¥æ„Ÿç›‘æµ‹ Telemetries</strong></p><p><strong>å†…å­˜è§†å›¾ Live Memory</strong></p><p>Live memory å†…å­˜å‰–æï¼šclass/class instance çš„ç›¸å…³ä¿¡æ¯ã€‚ä¾‹å¦‚å¯¹è±¡çš„ä¸ªæ•°ï¼Œå¤§å°ï¼Œå¯¹è±¡åˆ›å»ºçš„æ–¹æ³•æ‰§è¡Œæ ˆï¼Œå¯¹è±¡åˆ›å»ºçš„çƒ­ç‚¹ã€‚</p><ul><li><p>æ‰€æœ‰å¯¹è±¡ All Objects</p><p>æ˜¾ç¤ºæ‰€æœ‰åŠ è½½çš„ç±»çš„åˆ—è¡¨å’Œåœ¨å †ä¸Šåˆ†é…çš„å®ä¾‹æ•°ã€‚åªæœ‰ Java1.5(JMTI) æ‰ä¼šæ˜¾ç¤ºæ­¤è§†å›¾ã€‚</p></li></ul><p><img src="./../jvm-tuning2/image-20240117205945955.png" alt=""></p><ul><li><p>è®°å½•å¯¹è±¡ Record Objects</p><p>æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µå¯¹è±¡çš„åˆ†é…ï¼Œå¹¶è®°å½•åˆ†é…çš„è°ƒç”¨å †æ ˆã€‚</p></li><li><p>åˆ†é…è®¿é—®æ ‘ Allocation Call Tree<br>æ˜¾ç¤ºä¸€æ£µè¯·æ±‚æ ‘æˆ–è€…æ–¹æ³•ã€ç±»ã€åŒ…æˆ–å¯¹å·±é€‰æ‹©ç±»æœ‰å¸¦æ³¨é‡Šçš„åˆ†é…ä¿¡æ¯çš„ J2EE ç»„ä»¶ã€‚</p></li><li><p>åˆ†é…çƒ­ç‚¹ Allocation Hot Spots</p><p>æ˜¾ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…æ‹¬æ–¹æ³•ã€ç±»ã€åŒ…æˆ–åˆ†é…å·²é€‰ç±»çš„ J2EE ç»„ä»¶ã€‚ä½ å¯ä»¥æ ‡æ³¨å½“å‰å€¼å¹¶ä¸”æ˜¾ç¤ºå·®å¼‚å€¼ã€‚å¯¹äºæ¯ä¸ªçƒ­ç‚¹éƒ½å¯ä»¥æ˜¾ç¤ºå®ƒçš„è·Ÿè¸ªè®°å½•æ ‘ã€‚</p></li><li><p>ç±»è¿½è¸ªå™¨ Class Tracker</p><p>ç±»è·Ÿè¸ªè§†å›¾å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„å›¾è¡¨ï¼Œæ˜¾ç¤ºé€‰å®šçš„ç±»å’ŒåŒ…çš„å®ä¾‹ä¸æ—¶é—´ã€‚</p></li></ul><blockquote><p>åˆ†æ: å†…å­˜ä¸­çš„å¯¹è±¡çš„æƒ…å†µ</p><ul><li>é¢‘ç¹åˆ›å»ºçš„ Java å¯¹è±¡ï¼šæ­»å¾ªç¯ã€å¾ªç¯æ¬¡æ•°è¿‡å¤š(Instance Count å¤š, Size ä¹Ÿå¤§)</li><li>å­˜åœ¨å¤§çš„å¯¹è±¡ï¼šè¯»å–æ–‡ä»¶æ—¶ï¼Œbyte[ ] åº”è¯¥è¾¹è¯»è¾¹å†™ã€‚â€“&gt; å¦‚æœé•¿æ—¶é—´ä¸å†™å‡ºçš„è¯ï¼Œå¯¼è‡´ byte[ ] è¿‡å¤§å­˜åœ¨å†…å­˜æ³„æ¼</li></ul><p>æ³¨æ„ï¼š</p><ul><li>All Objects åé¢çš„ Size å¤§å°æ˜¯æµ…å †å¤§å°</li><li>Record Objects åœ¨åˆ¤æ–­å†…å­˜æ³„éœ²çš„æ—¶å€™ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡è§‚å¯Ÿ Telemetries ä¸­çš„ Memoryï¼Œå¦‚æœé‡Œé¢å‡ºç°åƒåœ¾å›æ”¶ä¹‹åçš„å†…å­˜å ç”¨é€æ­¥æé«˜ï¼Œè¿™å°±æœ‰å¯èƒ½å‡ºç°å†…å­˜æ³„éœ²é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Record Objects æŸ¥çœ‹ï¼Œä½†æ˜¯è¯¥åˆ†æé»˜è®¤ä¸å¼€å¯ï¼Œæ¯•ç«Ÿå ç”¨ CPU æ€§èƒ½å¤ªå¤š</li></ul></blockquote><p><strong>å †éå† heap walker</strong></p><p><strong>cpuè§†å›¾ cpu views</strong></p><p>JProfiler æä¾›ä¸åŒçš„æ–¹æ³•æ¥è®°å½•è®¿é—®æ ‘ä»¥ä¼˜åŒ–æ€§èƒ½å’Œç»†èŠ‚ã€‚çº¿ç¨‹æˆ–è€…çº¿ç¨‹ç»„ä»¥åŠçº¿ç¨‹çŠ¶å†µå¯ä»¥è¢«æ‰€æœ‰çš„è§†å›¾é€‰æ‹©ã€‚æ‰€æœ‰çš„è§†å›¾éƒ½å¯ä»¥èšé›†åˆ°æ–¹æ³•ã€ç±»ã€åŒ…æˆ– J2EE ç»„ä»¶ç­‰ä¸åŒå±‚ä¸Šã€‚</p><p>è®¿é—®æ ‘ Call Tree</p><p>æ˜¾ç¤ºä¸€ä¸ªç§¯ç´¯çš„è‡ªé¡¶å‘ä¸‹çš„æ ‘ï¼Œæ ‘ä¸­åŒ…å«æ‰€æœ‰åœ¨ JVM ä¸­å·±è®°å½•çš„è®¿é—®é˜Ÿåˆ—ã€‚JDBC, JMS å’Œ JNDI æœåŠ¡è¯·æ±‚éƒ½è¢«æ³¨é‡Šåœ¨è¯·æ±‚æ ‘ä¸­ã€‚è¯·æ±‚æ ‘å¯ä»¥æ ¹æ® Servlet å’Œ JSP å¯¹ URL çš„ä¸åŒéœ€è¦è¿›è¡Œæ‹†åˆ†ã€‚</p><p>çƒ­ç‚¹ Hot Spots</p><p>æ˜¾ç¤ºæ¶ˆè€—æ—¶é—´æœ€å¤šçš„æ–¹æ³•çš„åˆ—è¡¨ã€‚å¯¹æ¯ä¸ªçƒ­ç‚¹éƒ½èƒ½å¤Ÿæ˜¾ç¤ºå›æº¯æ ‘ã€‚è¯¥çƒ­ç‚¹å¯ä»¥æŒ‰ç…§æ–¹æ³•è¯·æ±‚ï¼ŒJDBC,  JMS å’Œ JNDI æœåŠ¡è¯·æ±‚ä»¥åŠæŒ‰ç…§ URLè¯·æ±‚æ¥è¿›è¡Œè®¡ç®—ã€‚</p><p>è®¿é—®å›¾ Call Graph</p><p>æ˜¾ç¤ºä¸€ä¸ªä»å·²é€‰æ–¹æ³•ã€ç±»ã€åŒ…æˆ– J2EE ç»„ä»¶å¼€å§‹çš„è®¿é—®é˜Ÿåˆ—çš„å›¾ã€‚</p><p>æ–¹æ³•ç»Ÿè®¡ Method Statistis</p><p>æ˜¾ç¤ºä¸€æ®µæ—¶é—´å†…è®°å½•çš„æ–¹æ³•çš„è°ƒç”¨æ—¶é—´ç»†èŠ‚ã€‚</p><p><strong>çº¿ç¨‹è§†å›¾ threads</strong></p><p>JProfiler é€šè¿‡å¯¹çº¿ç¨‹å†å²çš„ç›‘æ§åˆ¤æ–­å…¶è¿è¡ŒçŠ¶æ€ï¼Œå¹¶ç›‘æ§æ˜¯å¦æœ‰çº¿ç¨‹é˜»å¡äº§ç”Ÿï¼Œè¿˜èƒ½å°†ä¸€ä¸ªçº¿ç¨‹æ‰€ç®¡ç†çš„æ–¹æ³•ä»¥æ ‘çŠ¶å½¢å¼å‘ˆç°ã€‚å¯¹çº¿ç¨‹å‰–æã€‚</p><p>çº¿ç¨‹å†å² Thread History</p><p>æ˜¾ç¤ºä¸€ä¸ªä¸çº¿ç¨‹æ´»åŠ¨å’Œçº¿ç¨‹çŠ¶æ€åœ¨ä¸€èµ·çš„æ´»åŠ¨æ—¶é—´è¡¨ã€‚</p><p>çº¿ç¨‹ç›‘æ§ Thread Monitor</p><p>æ˜¾ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„æ´»åŠ¨çº¿ç¨‹ä»¥åŠå®ƒä»¬ç›®å‰çš„æ´»åŠ¨çŠ¶å†µã€‚</p><p>çº¿ç¨‹è½¬å‚¨ Thread Dumps</p><p>æ˜¾ç¤ºæ‰€æœ‰çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªã€‚</p><blockquote><p>çº¿ç¨‹åˆ†æä¸»è¦å…³å¿ƒä¸‰ä¸ªæ–¹é¢ï¼š</p><ol><li>web å®¹å™¨çš„çº¿ç¨‹æœ€å¤§æ•°ã€‚æ¯”å¦‚ï¼šTomcat çš„çº¿ç¨‹å®¹é‡åº”è¯¥ç•¥å¤§äºæœ€å¤§å¹¶å‘æ•°ã€‚</li><li>çº¿ç¨‹é˜»å¡</li><li>çº¿ç¨‹æ­»é”</li></ol></blockquote><p><strong>ç›‘è§†å™¨&amp;é” Monitors&amp;locks</strong></p><p>ç›‘æ§å’Œé” Monitors &amp; Locks æ‰€æœ‰çº¿ç¨‹æŒæœ‰é”çš„æƒ…å†µä»¥åŠé”çš„ä¿¡æ¯ã€‚</p><p>è§‚å¯Ÿ JVM çš„å†…éƒ¨çº¿ç¨‹å¹¶æŸ¥çœ‹çŠ¶æ€ï¼š</p><ul><li>æ­»é”æ¢æµ‹å›¾è¡¨ Current Locking Graph: æ˜¾ç¤º JVM ä¸­çš„å½“å‰æ­»é”å›¾è¡¨ã€‚</li><li>ç›®å‰ä½¿ç”¨çš„ç›‘æµ‹å™¨ Current Monitors: æ˜¾ç¤ºç›®å‰ä½¿ç”¨çš„ç›‘æµ‹å™¨å¹¶ä¸”åŒ…æ‹¬å®ƒä»¬çš„å…³è”çº¿ç¨‹ã€‚</li><li>é”å®šå†å²å›¾è¡¨ Locking History Graph: æ˜¾ç¤ºè®°å½•åœ¨ JVM ä¸­çš„é”å®šå†å²ã€‚</li><li>å†å²æ£€æµ‹è®°å½• Monitor History: æ˜¾ç¤ºé‡å¤§çš„ç­‰å¾…äº‹ä»¶å’Œé˜»å¡äº‹ä»¶çš„å†å²è®°å½•ã€‚</li><li>ç›‘æ§å™¨ä½¿ç”¨ç»Ÿè®¡ Monitor Usage Statistics: æ˜¾ç¤ºåˆ†ç»„ç›‘æµ‹ï¼Œçº¿ç¨‹å’Œç›‘æµ‹ç±»çš„ç»Ÿè®¡ç›‘æµ‹æ•°æ®</li></ul><h3 id="æ¡ˆä¾‹åˆ†æ">æ¡ˆä¾‹åˆ†æ</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JProfilerTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">ArrayList</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Data</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//1mb</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> info <span class="token operator">=</span> <span class="token string">"hello,dee"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemoryLeak</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ArrayList</span> beanList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Bean</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                data<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10kb</span>                beanList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Bean</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> info <span class="token operator">=</span> <span class="token string">"hello,dee"</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token class-name">ArrayList</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="06-Arthas">06-Arthas</h2><h3 id="æ¦‚è¿°-3">æ¦‚è¿°</h3><p>Arthas(é˜¿å°”è¨æ–¯) æ˜¯Alibaba å¼€æºçš„ Java è¯Šæ–­å·¥å…·ï¼Œæ·±å—å¼€å‘è€…å–œçˆ±ã€‚åœ¨çº¿æ’æŸ¥é—®é¢˜ï¼Œæ— éœ€é‡å¯; åŠ¨æ€è·Ÿè¸ª Java ä»£ç ï¼šå®æ—¶ç›‘æ§ JVM çŠ¶æ€ã€‚</p><p>Arthas æ”¯æŒ JDK6+,æ”¯æŒ Linux,/Mac/Windows, é‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„ Tab è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚</p><p>å½“ä½ é‡åˆ°ä»¥ä¸‹ç±»ä¼¼é—®é¢˜è€ŒæŸæ‰‹æ— ç­–æ—¶ï¼ŒArthas å¯ä»¥å¸®åŠ©ä½ è§£å†³ï¼š</p><ul><li>è¿™ä¸ªç±»ä»å“ªä¸ª jar åŒ…åŠ è½½çš„ï¼Ÿä¸ºä»€ä¹ˆä¼šæŠ¥å„ç§ç±»ç›¸å…³çš„ Exception?</li><li>æˆ‘æ”¹çš„ä»£ç ä¸ºä»€ä¹ˆæ²¡æœ‰æ‰§è¡Œåˆ°ï¼Ÿéš¾é“æ˜¯æˆ‘æ²¡ commit? åˆ†æ”¯æé”™äº†ï¼Ÿ</li><li>é‡åˆ°é—®é¢˜æ— æ³•åœ¨çº¿ä¸Š debug, éš¾é“åªèƒ½é€šè¿‡åŠ æ—¥å¿—å†é‡æ–°å‘å¸ƒå—ï¼Ÿ</li><li>çº¿ä¸Šé‡åˆ°æŸä¸ªç”¨æˆ·çš„æ•°æ®å¤„ç†æœ‰é—®é¢˜ï¼Œä½†çº¿ä¸ŠåŒæ ·æ— æ³• debug, çº¿ä¸‹æ— æ³•é‡ç°ï¼</li><li>æ˜¯å¦æœ‰ä¸€ä¸ªå…¨å±€è§†è§’æ¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Ÿ</li><li>æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç›‘æ§åˆ° JVM çš„å®æ—¶è¿è¡ŒçŠ¶æ€ï¼Ÿ</li><li>æ€ä¹ˆå¿«é€Ÿå®šä½åº”ç”¨çš„çƒ­ç‚¹ï¼Œç”Ÿæˆç«ç„°å›¾ï¼Ÿ</li></ul><p><strong>åŸºäºå“ªäº›å·¥å…·è€Œæ¥</strong></p><ul><li>greys-anatomy: Arthas ä»£ç åŸºäº Greys äºŒæ¬¡å¼€å‘è€Œæ¥ï¼Œéå¸¸æ„Ÿè°¢ Greys ä¹‹å‰æ‰€æœ‰çš„å·¥ä½œï¼Œä»¥åŠ Greys åŸä½œè€…å¯¹ Arthas æå‡ºçš„æ„è§å’Œå»ºè®®ï¼</li><li>termd: Arthas çš„å‘½ä»¤è¡Œå®ç°åŸºäº termd å¼€å‘ï¼Œæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„å‘½ä»¤è¡Œç¨‹åºå¼€å‘æ¡†æ¶ï¼Œæ„Ÿè°¢ termd æä¾›äº†ä¼˜ç§€çš„æ¡†æ¶ã€‚</li><li>crash: Arthas çš„æ–‡æœ¬æ¸²æŸ“åŠŸèƒ½åŸºäº crash ä¸­çš„æ–‡æœ¬æ¸²æŸ“åŠŸèƒ½å¼€å‘ï¼Œå¯ä»¥ä»è¿™é‡Œçœ‹åˆ°æºç ï¼Œæ„Ÿè°¢ crash åœ¨è¿™æ–¹é¢æ‰€åšçš„ä¼˜ç§€å·¥ä½œã€‚</li><li>cli: Arthas çš„å‘½ä»¤è¡Œç•Œé¢åŸºäº vert.x æä¾›çš„ cli åº“è¿›è¡Œå¼€å‘ï¼Œæ„Ÿè°¢ vert.x åœ¨è¿™æ–¹é¢åšçš„ä¼˜ç§€å·¥ä½œã€‚</li><li>compiler Arthas é‡Œçš„å†…å­˜ç¼–ç»å™¨ä»£ç æ¥æº</li><li>Apache Commons Net Arthas é‡Œçš„ Telnet client ä»£ç æ¥æº</li><li>JavaAgent: è¿è¡Œåœ¨ main æ–¹æ³•ä¹‹å‰çš„æ‹¦æˆªå™¨ï¼Œå®ƒå†…å®šçš„æ–¹æ³•åå« premain, ä¹Ÿå°±æ˜¯è¯´å…ˆæ‰§è¡Œ premain æ–¹æ³•ç„¶åå†æ‰§è¡Œ main æ–¹æ³•</li><li>ASM: ä¸€ä¸ªé€šç”¨çš„ Java å­—èŠ‚ç æ“ä½œå’Œåˆ†ææ¡†æ¶ã€‚å®ƒå¯ä»¥ç”¨äºä¿®æ”¹ç°æœ‰çš„ç±»æˆ–ç›´æ¥ä»¥äºŒè¿›åˆ¶å½¢å¼åŠ¨æ€ç”Ÿæˆç±»ã€‚ASM æä¾›äº†ä¸€äº›å¸¸è§çš„å­—èŠ‚ç è½¬æ¢å’Œåˆ†æç®—æ³•ï¼Œå¯ä»¥ä»å®ƒä»¬æ„å»ºå®šåˆ¶çš„å¤æ‚è½¬æ¢å’Œä»£ç åˆ†æå·¥å…·ã€‚ASM æä¾›äº†ä¸å…¶ä»– Java å­—èŠ‚ç æ¡†æ¶ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸»è¦å…³æ³¨æ€§èƒ½ã€‚å› ä¸ºå®ƒè¢«è®¾è®¡å’Œå®ç°å¾—å°½å¯èƒ½å°å’Œå¿«ï¼Œæ‰€ä»¥éå¸¸é€‚åˆåœ¨åŠ¨æ€ç³»ç»Ÿä¸­ä½¿ç”¨ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä»¥é™æ€æ–¹å¼ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ç¼–è¯‘å™¨ä¸­)</li></ul><blockquote><p>å®˜æ–¹æ–‡æ¡£ <a href="https://arthas.aliyun.com/doc/quick-start.html">https://arthas.aliyun.com/doc/quick-start.html</a></p></blockquote><h3 id="å®‰è£…ä¸ä½¿ç”¨">å®‰è£…ä¸ä½¿ç”¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://alibaba.github.io/arthas/arthas-boot.jar<span class="token function">wget</span> https://arthas.gitee.io/arthas-boot.jar<span class="token comment">#å¯åŠ¨</span><span class="token function">java</span> <span class="token parameter variable">-jar</span> arthas-boot.jar <span class="token punctuation">[</span>pid<span class="token punctuation">]</span><span class="token comment">#é€€å‡º</span><span class="token comment"># æœ€åä¸€è¡Œ[arthas(@7457]$,è¯´æ˜æ‰“å¼€è¿›å…¥äº†ç›‘æ§å®¢æˆ·ç«¯ï¼Œåœ¨è¿™é‡Œå°±å¯ä»¥æ‰§è¡Œç›¸å…³å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹äº†ã€‚</span><span class="token comment"># ä½¿ç”¨quit\exit:é€€å‡ºå½“å‰å®¢æˆ·ç«¯</span><span class="token comment"># ä½¿ç”¨stop\shutdown:å…³é—­arthasæœåŠ¡ç«¯ï¼Œå¹¶é€€å‡ºæ‰€æœ‰å®¢æˆ·ç«¯ã€‚</span><span class="token comment">#å¸è½½ï¼š</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> ~/.arthas/I<span class="token function">rm</span> <span class="token parameter variable">-rf</span> ~/logs/arthas<span class="token comment">#Windowså¹³å°ç›´æ¥åˆ é™¤user homeä¸‹é¢çš„.arthaså’Œlogs/arthasç›®å½•</span><span class="token comment">#æŸ¥çœ‹æ—¥å¿—</span><span class="token function">cat</span> ~/logs/arthas/arthas.log<span class="token comment">#æŸ¥çœ‹å¸®åŠ©</span><span class="token function">java</span> <span class="token parameter variable">-jar</span> arthas-boot.jar <span class="token parameter variable">-h</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å·¥ä½œç›®å½•</strong></p><p>arthas-agent: åŸºäº JavaAgent æŠ€æœ¯çš„ä»£ç†</p><p>bin: ä¸€äº›å¯åŠ¨è„šæœ¬</p><p>arthas-boot: Javaç‰ˆæœ¬çš„ä¸€é”®å®‰è£…å¯åŠ¨è„šæœ¬</p><p>arthas-client: telnet client ä»£ç </p><p>arthas-common: ä¸€äº›å…±ç”¨çš„å·¥å…·ç±»å’Œæšä¸¾ç±»</p><p>arthas-core: æ ¸å¿ƒåº“ï¼Œå„ç§ arthas å‘½ä»¤çš„äº¤äº’å’Œå®ç°</p><p>arthas-demo: ç¤ºä¾‹ä»£ç </p><p>arthas-memorycompiler: å†…å­˜ç¼–ç»å™¨ä»£ç ï¼ŒFork from<br><a href="https://github.com/skalogs/SkaETL/tree/master/compiler">https://github.com/skalogs/SkaETL/tree/master/compiler</a></p><p>arthas-packaging: maven æ‰“åŒ…ç›¸å…³çš„</p><p>arthas-site: arthas ç«™ç‚¹</p><p>arthas-spy: ç¼–ç»‡åˆ°ç›®æ ‡ç±»ä¸­çš„å„ä¸ªåˆ‡é¢</p><p>static: é™æ€èµ„æº</p><p>arthas-testcase: æµ‹è¯•</p><p><strong>web console</strong></p><p>é™¤äº†åœ¨å‘½ä»¤è¡ŒæŸ¥çœ‹å¤–ï¼ŒArthas ç›®å‰è¿˜æ”¯æŒ Web Consoleã€‚åœ¨æˆåŠŸå¯åŠ¨è¿æ¥è¿›ç¨‹ä¹‹åå°±å·²ç»è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥ç›´æ¥è®¿é—®<a href="http://127.0.0.1:8563/%E8%AE%BF%E9%97%AE%EF%BC%8C%E9%A1%B5%E9%9D%A2%E4%B8%8A%E7%9A%84%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%BC%8F%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%AE%8C%E5%85%A8%E4%B8%80%E6%A0%B7%E3%80%82">http://127.0.0.1:8563/è®¿é—®ï¼Œé¡µé¢ä¸Šçš„æ“ä½œæ¨¡å¼å’Œæ§åˆ¶å°å®Œå…¨ä¸€æ ·ã€‚</a></p><h3 id="ç›¸å…³æŒ‡ä»¤">ç›¸å…³æŒ‡ä»¤</h3><p><strong>class/classloader ç›¸å…³</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sc <span class="token comment">#æŸ¥çœ‹VMå·²åŠ è½½çš„ç±»ä¿¡æ¯</span>sm <span class="token comment">#æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯</span>jad <span class="token comment">#åç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç </span><span class="token function">mc</span> <span class="token comment">#å†…å­˜ç¼–è¯‘å™¨ï¼Œå†…å­˜ç¼–è¯‘.javaæ–‡ä»¶ä¸º.classæ–‡ä»¶</span>retransform <span class="token comment">#åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œretransformåˆ°JVMé‡Œ</span>redefine <span class="token comment">#åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œredefineåˆ°JVMé‡Œ</span>dump <span class="token comment">#dumpå·²åŠ è½½ç±»çš„byte codeåˆ°ç‰¹å®šç›®å½•</span>classloader <span class="token comment">#æŸ¥çœ‹classloaderfçš„ç»§æ‰¿æ ‘ï¼Œurls,ç±»åŠ è½½ä¿¡æ¯ï¼Œä½¿ç”¨classloaderå»getResource</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>monitor/watch/traceç›¸å…³</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">monitor <span class="token comment">#æ–¹æ³•æ‰§è¡Œç›‘æ§</span><span class="token function">watch</span> <span class="token comment">#æ–¹æ³•æ‰§è¡Œæ•°è§‚æµ‹</span>trce <span class="token comment">#æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶</span>stack <span class="token comment">#è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„</span>tt <span class="token comment">#æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="07-Java-Mission-Control">07-Java Mission Control</h2><h2 id="08-å…¶ä»–å·¥å…·">08-å…¶ä»–å·¥å…·</h2><h2 id="09-è¡¥å……å†…å®¹">09-è¡¥å……å†…å®¹</h2><h3 id="å†…å­˜æ³„æ¼">å†…å­˜æ³„æ¼</h3><h4 id="memory-leak-æ¦‚å¿µ"><strong>(memory leak) æ¦‚å¿µ</strong></h4><p><img src="./../jvm-tuning2/image-20240115134009517.png" alt=""></p><p>å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œæœ¬è´¨éƒ½æ˜¯åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¿˜è¢«å¼•ç”¨ã€‚é‚£ä¹ˆå¯¹äºè¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºä»£ç çš„å®ç°ä¸åŒå°±ä¼šå‡ºç°å¾ˆå¤šç§å†…å­˜æ³„æ¼é—®é¢˜ï¼ˆè®© JVM è¯¯ä»¥ä¸ºæ­¤å¯¹è±¡è¿˜åœ¨å¼•ç”¨ä¸­ï¼Œæ— æ³•å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼)ã€‚</p><ul><li>æ˜¯å¦è¿˜è¢«ä½¿ç”¨? æ˜¯</li><li>æ˜¯å¦è¿˜è¢«éœ€è¦? å¦</li></ul><p><strong>å†…å­˜æ³„æ¼çš„ç†è§£</strong></p><p><strong>ä¸¥æ ¼æ¥è¯´</strong>ï¼Œåªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯ GC åˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚</p><p>ä½†å®é™…æƒ…å†µå¾ˆå¤šæ—¶å€™ä¸€äº›ä¸å¤ªå¥½çš„å®è·µï¼ˆæˆ–ç–å¿½ï¼‰ä¼šå¯¼è‡´å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¾ˆé•¿ç”šè‡³å¯¼è‡´ OOM, ä¹Ÿå¯ä»¥å«åš<strong>å®½æ³›æ„ä¹‰ä¸Šçš„&quot;å†…å­˜æ³„æ¼&quot;</strong>ã€‚</p><p><img src="./../jvm-tuning2/image-20240115134602479.png" alt=""></p><p>å¯¹è±¡ X å¼•ç”¨å¯¹è±¡ Y, X çš„ç”Ÿå‘½å‘¨æœŸæ¯” Y çš„ç”Ÿå‘½å‘¨æœŸé•¿ï¼š</p><p>é‚£ä¹ˆå½“ Y ç”Ÿå‘½å‘¨æœŸç»“æŸçš„æ—¶å€™ï¼ŒX ä¾ç„¶å¼•ç”¨ç€ Y, è¿™æ—¶å€™ï¼Œåƒåœ¾å›æ”¶æœŸæ˜¯ä¸ä¼šå›æ”¶å¯¹è±¡ Y çš„ï¼š</p><p>å¦‚æœå¯¹è±¡ X è¿˜å¼•ç”¨ç€ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒçŸ­çš„Aã€Bã€C, å¯¹è±¡ A åˆå¼•ç”¨ç€å¯¹è±¡aã€bã€c,è¿™æ ·å°±å¯èƒ½é€ æˆå¤§é‡æ— ç”¨çš„å¯¹è±¡ä¸èƒ½è¢«å›æ”¶ï¼Œè¿›è€Œå æ®äº†å†…å­˜èµ„æºï¼Œé€ æˆå†…å­˜æ³„æ¼ï¼Œç›´åˆ°å†…å­˜æº¢å‡ºã€‚</p><p><strong>å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡ºçš„å…³ç³»</strong></p><ol><li><p>å†…å­˜æ³„æ¼(memory leak)</p><p>ç”³è¯·äº†å†…å­˜ç”¨å®Œäº†ä¸é‡Šæ”¾ï¼Œæ¯”å¦‚ä¸€å…±æœ‰ 1024M çš„å†…å­˜ï¼Œåˆ†é…äº† 521M çš„å†…å­˜ä¸€ç›´ä¸å›æ”¶ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨çš„å†…å­˜åªæœ‰ 521M äº†ï¼Œä»¿ä½›æ³„éœ²æ‰äº†ä¸€éƒ¨åˆ†ï¼š</p><p>é€šä¿—ä¸€ç‚¹è®²çš„è¯ï¼Œå†…å­˜æ³„æ¼å°±æ˜¯ã€å ç€èŒ…å‘ä¸æ‹‰ğŸ’©ã€‘ã€‚</p></li><li><p>å†…å­˜æº¢å‡º(out of memory)</p><p>ç”³è¯·å†…å­˜æ—¶ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ä»¥ä½¿ç”¨ï¼š</p><p>é€šä¿—ä¸€ç‚¹å„¿è®²ï¼Œä¸€ä¸ªå•æ‰€å°±ä¸‰ä¸ªå‘ï¼Œæœ‰ä¸¤ä¸ªç«™ç€èŒ…å‘ä¸èµ°çš„ï¼ˆå†…å­˜æ³„æ¼ï¼‰ï¼Œå‰©ä¸‹æœ€åä¸€ä¸ªå‘ï¼Œå•æ‰€è¡¨ç¤ºæ¥å¾…å‹åŠ›å¾ˆå¤§ï¼Œè¿™æ—¶å€™ä¸€ä¸‹å­æ¥äº†ä¸¤ä¸ªäººï¼Œå‘ä½ï¼ˆå†…å­˜ï¼‰å°±ä¸å¤Ÿäº†ï¼Œå†…å­˜æ³„æ¼å˜æˆå†…å­˜æº¢å‡ºäº†ã€‚</p></li></ol><p><strong>æ³„æ¼çš„åˆ†ç±»</strong></p><ul><li>ç»å¸¸å‘ç”Ÿ: å‘ç”Ÿå†…å­˜æ³„æ¼çš„ä»£ç ä¼šè¢«å¤šæ¬¡æ‰§è¡Œ, æ¯æ¬¡æ‰§è¡Œ, æ³„æ¼ä¸€å—å†…å­˜</li><li>å¶ç„¶å‘ç”Ÿ: åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹æ‰ä¼šå‘ç”Ÿ</li><li>ä¸€æ¬¡æ€§: å‘ç”Ÿå†…å­˜æ³„æ¼çš„æ–¹æ³•æŒ‡æŒ¥æ‰§è¡Œä¸€æ¬¡</li><li>éšå¼æ³„æ¼: ä¸€ç›´å ç€å†…å­˜ä¸é‡Šæ”¾, çŸ¥é“æ‰§è¡Œç»“æŸ; ä¸¥æ ¼çš„è¯´è¿™ä¸ªä¸ç®—å†…å­˜æ³„æ¼, å› ä¸ºæœ€ç»ˆé‡Šæ”¾æ‰äº†, ä½†æ˜¯å¦‚æœæ‰§è¡Œæ—¶é—´ç‰¹åˆ«é•¿, ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å†…å­˜è€—å°½</li></ul><h4 id="å†…å­˜æ³„æ¼çš„8ç§æƒ…å†µ">å†…å­˜æ³„æ¼çš„8ç§æƒ…å†µ</h4><p><strong>1-é™æ€é›†åˆç±»</strong></p><p>é™æ€é›†åˆç±»ï¼Œå¦‚ HashMapã€LinkedList ç­‰ç­‰ã€‚å¦‚æœè¿™äº›å®¹å™¨ä¸ºé™æ€çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸ JVM ç¨‹åºä¸€è‡´ï¼Œåˆ™å®¹å™¨ä¸­çš„å¯¹è±¡åœ¨ç¨‹åºç»“æŸä¹‹å‰å°†ä¸èƒ½è¢«é‡Šæ”¾ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚ç®€å•è€Œè¨€ï¼Œé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«å›æ”¶ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemoryLeak</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//é™æ€é›†åˆç±»</span>    <span class="token keyword">static</span> <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">oomTests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å±€éƒ¨å˜é‡</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç”±äºlistå®¹å™¨æ˜¯é™æ€çš„, éšç€ç±»åŠ è½½è€ŒåŠ è½½, ä»è€Œä½¿å¯¹è±¡æ— æ³•è¢«å›æ”¶</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2-å•ä¾‹æ¨¡å¼</strong></p><p>å•ä¾‹æ¨¡å¼ï¼Œå’Œé™æ€é›†åˆå¯¼è‡´å†…å­˜æ³„éœ²çš„åŸå› ç±»ä¼¼ï¼Œå› ä¸ºå•ä¾‹çš„é™æ€ç‰¹æ€§ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œ JVM çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œæ‰€ä»¥å¦‚æœå•ä¾‹å¯¹è±¡å¦‚æœæŒæœ‰å¤–éƒ¨å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡ä¹Ÿä¸ä¼šè¢«å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p><p><strong>3-å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»</strong></p><p>å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»ï¼Œå¦‚æœä¸€ä¸ªå¤–éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡çš„æ–¹æ³•è¿”å›äº†ä¸€ä¸ªå†…éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p><p>è¿™ä¸ªå†…éƒ¨ç±»å¯¹è±¡è¢«é•¿æœŸå¼•ç”¨äº†ï¼Œå³ä½¿é‚£ä¸ªå¤–éƒ¨ç±»å®ä¾‹å¯¹è±¡ä¸å†è¢«ä½¿ç”¨ï¼Œä½†ç”±äºå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¤–éƒ¨ç±»å¯¹è±¡å°†ä¸ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œè¿™ä¹Ÿä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p><p><strong>4-å„ç§è¿æ¥, å¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’ŒIOè¿æ¥ç­‰</strong></p><p>å„ç§è¿æ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’ŒIOè¿æ¥ç­‰ã€‚</p><p>åœ¨å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆéœ€è¦å»ºç«‹ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œå½“ä¸å†ä½¿ç”¨æ—¶ï¼Œéœ€è¦è°ƒç”¨ close æ–¹æ³•æ¥é‡Šæ”¾ä¸æ•°æ®åº“çš„è¿æ¥ã€‚åªæœ‰è¿æ¥è¢«å…³é—­åï¼Œåƒåœ¾å›æ”¶å™¨æ‰ä¼šå›æ”¶å¯¹åº”çš„å¯¹è±¡ã€‚</p><p>å¦åˆ™ï¼Œå¦‚æœåœ¨è®¿é—®æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹Connectionã€Statement æˆ– ResultSet ä¸æ˜¾æ€§åœ°å…³é—­ï¼Œå°†ä¼šé€ æˆå¤§é‡çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConnectLeak</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//1.å…³é—­ç»“æœé›† Statement</span>            <span class="token comment">//2.å…³é—­å£°æ˜çš„å¯¹è±¡ ResultSet</span>            <span class="token comment">//3.å…³é—­è¿æ¥ Connection</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>5-å˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸ</strong></p><p>å˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªå˜é‡çš„å®šä¹‰çš„ä½œç”¨èŒƒå›´å¤§äºå…¶ä½¿ç”¨èŒƒå›´ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ²¡æœ‰åŠæ—¶åœ°æŠŠå¯¹è±¡è®¾ç½®ä¸º null, å¾ˆæœ‰å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„å‘ç”Ÿã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsingRandom</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//private String msg; //å¯å®šä¹‰åœ¨æ–¹æ³•ä¸­</span>        <span class="token function">readFromNet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä»ç½‘ç»œä¸­æ¥æ”¶æ•°æ®ä¿å­˜åˆ°msgä¸­</span>        <span class="token function">saveDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŠŠmsgä¿å­˜åˆ°æ•°æ®åº“ä¸­</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä¸Šé¢è¿™ä¸ªä¼ªä»£ç ï¼Œé€šè¿‡ readFromNet æ–¹æ³•æŠŠæ¥å—çš„æ¶ˆæ¯ä¿å­˜åœ¨å˜é‡ msg ä¸­ï¼Œç„¶åè°ƒç”¨ saveDB æ–¹æ³•æŠŠ msg çš„å†…å®¹ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæ­¤æ—¶ msg å·²ç»å°±æ²¡ç”¨äº†ï¼Œç”±äº msg çš„ç”Ÿå‘½å‘¨æœŸä¸å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œæ­¤æ—¶ msg è¿˜ä¸èƒ½å›æ”¶ï¼Œå› æ­¤é€ æˆäº†å†…å­˜æ³„æ¼ã€‚</p><p>å®é™…ä¸Šè¿™ä¸ª msg å˜é‡å¯ä»¥æ”¾åœ¨ receiveMsg æ–¹æ³•å†…éƒ¨ï¼Œå½“æ–¹æ³•ä½¿ç”¨å®Œï¼Œé‚£ä¹ˆ msg çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå°±ç»“æŸï¼Œæ­¤æ—¶å°±å¯ä»¥å›æ”¶äº†ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œåœ¨ä½¿ç”¨å®Œ msg åï¼ŒæŠŠ msg è®¾ç½®ä¸º null ,è¿™æ ·åƒåœ¾å›æ”¶å™¨ä¹Ÿä¼šå›æ”¶ msg çš„å†…å­˜ç©ºé—´ã€‚</p><p><strong>6-æ”¹å˜å“ˆå¸Œå€¼</strong>ğŸ‘</p><p>æ”¹å˜å“ˆå¸Œå€¼ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«å­˜å‚¨è¿› HashSet é›†åˆä¸­ä»¥åï¼Œå°±ä¸èƒ½ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„é‚£äº›å‚ä¸è®¡ç®—å“ˆå¸Œå€¼çš„å­—æ®µäº†ã€‚<br>å¦åˆ™ï¼Œå¯¹è±¡ä¿®æ”¹åçš„å“ˆå¸Œå€¼ä¸æœ€åˆå­˜å‚¨è¿› HashSet é›†åˆä¸­æ—¶çš„å“ˆå¸Œå€¼å°±ä¸åŒäº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿åœ¨ contains æ–¹æ³•ä½¿ç”¨è¯¥å¯¹è±¡çš„å½“å‰å¼•ç”¨ä½œä¸ºçš„å‚æ•°å» HashSet é›†åˆä¸­æ£€ç´¢å¯¹è±¡ï¼Œä¹Ÿå°†è¿”å›æ‰¾ä¸åˆ°å¯¹è±¡çš„ç»“æœï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´æ— æ³•ä» HashSet é›†åˆä¸­å•ç‹¬åˆ é™¤å½“å‰å¯¹è±¡ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p><p>è¿™ä¹Ÿæ˜¯ String ä¸ºä»€ä¹ˆè¢«è®¾ç½®æˆäº†ä¸å¯å˜ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°æŠŠ String å­˜å…¥ HashSet, æˆ–è€…æŠŠ String å½“åš HashMap çš„ key å€¼ï¼›</p><p>å½“æˆ‘ä»¬æƒ³æŠŠè‡ªå·±å®šä¹‰çš„ç±»ä¿å­˜åˆ°æ•£åˆ—è¡¨çš„æ—¶å€™ï¼Œéœ€è¦ä¿è¯å¯¹è±¡çš„ hashCode ä¸å¯å˜ã€‚</p><ul><li>æ¡ˆä¾‹ä¸€</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChangeHashCode</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Point</span><span class="token punctuation">></span></span> hs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Point</span> cc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cc<span class="token punctuation">.</span><span class="token function">setX</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hashCode = 41</span>        hs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cc<span class="token punctuation">)</span><span class="token punctuation">;</span>        cc<span class="token punctuation">.</span><span class="token function">setX</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hashCode= 51 æ­¤è¡Œä¸ºä¿®æ”¹äº†hashå€¼, å¯¼è‡´äº†å†…å­˜æ³„æ¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hs.remove(cc) = "</span> <span class="token operator">+</span> hs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>cc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>        hs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hs.size() = "</span> <span class="token operator">+</span> hs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//size=2</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> x<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setX</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>        <span class="token keyword">return</span> x <span class="token operator">==</span> point<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> prime <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        result <span class="token operator">=</span> prime <span class="token operator">*</span> result <span class="token operator">+</span> x<span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Point&#123;"</span> <span class="token operator">+</span>                <span class="token string">"x="</span> <span class="token operator">+</span> x <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ¡ˆä¾‹äºŒ</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChangeHashCode1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token string">"AA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span> <span class="token string">"BB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>        p1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"CC"</span><span class="token punctuation">;</span><span class="token comment">//å¯¼è‡´äº†å†…å­˜çš„æ³„æ¼</span>        set<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ é™¤å¤±è´¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token string">"CC"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token string">"AA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ­¤æ—¶æ€»å…±è¿›æ¥äº†4ä¸ªå…ƒç´ </span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">!=</span> person<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> result <span class="token operator">=</span> id<span class="token punctuation">;</span>        result <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> result <span class="token operator">+</span> <span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> name<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Person&#123;"</span> <span class="token operator">+</span>                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-tuning2/image-20240115144702050.png" alt="å›¾è§£"></p><p><strong>7-ç¼“å­˜æ³„æ¼</strong></p><p>å†…å­˜æ³„æ¼çš„å¦ä¸€ä¸ªå¸¸è§æ¥æºæ˜¯ç¼“å­˜ï¼Œä¸€æ—¦ä½ æŠŠå¯¹è±¡å¼•ç”¨æ”¾å…¥åˆ°ç¼“å­˜ä¸­ï¼Œä»–å°±å¾ˆå®¹æ˜“é—å¿˜ã€‚æ¯”å¦‚ï¼šä¹‹å‰é¡¹ç›®åœ¨ä¸€æ¬¡ä¸Šçº¿çš„æ—¶å€™ï¼Œåº”ç”¨å¯åŠ¨å¥‡æ…¢ç›´åˆ°å¤¯æ­»ï¼Œå°±æ˜¯å› ä¸ºä»£ç ä¸­ä¼šåŠ è½½ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åˆ°ç¼“å­˜ï¼ˆå†…å­˜ï¼‰ä¸­ï¼Œæµ‹è¯•ç¯å¢ƒåªæœ‰å‡ ç™¾æ¡æ•°æ®ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒæœ‰å‡ ç™¾ä¸‡çš„æ•°æ®ã€‚</p><p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ WeakHashMap ä»£è¡¨ç¼“å­˜ï¼Œæ­¤ç§ Map çš„ç‰¹ç‚¹æ˜¯ï¼Œå½“é™¤äº†è‡ªèº«æœ‰å¯¹ key çš„å¼•ç”¨å¤–ï¼Œæ­¤ key æ²¡æœ‰å…¶ä»–å¼•ç”¨é‚£ä¹ˆæ­¤ map ä¼šè‡ªåŠ¨ä¸¢å¼ƒæ­¤å€¼ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheMapTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token class-name">Map</span> wMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">testWeakHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">testHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> ref1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"obejct1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> ref2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"obejct2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> ref3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"obejct3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> ref4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"obejct4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        wMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ref1<span class="token punctuation">,</span> <span class="token string">"cacheObject1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        wMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ref2<span class="token punctuation">,</span> <span class="token string">"cacheObject2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ref3<span class="token punctuation">,</span> <span class="token string">"cacheObject3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ref4<span class="token punctuation">,</span> <span class="token string">"cacheObject4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Stringå¼•ç”¨ref1ï¼Œref2ï¼Œref3ï¼Œref4 æ¶ˆå¤±"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testWeakHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"WeakHashMap GCä¹‹å‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> wMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"WeakHashMap GCä¹‹å"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> wMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HashMap GCä¹‹å‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HashMap GCä¹‹å"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-tuning2/image-20240115224832668.png" alt=""></p><p>ä¸Šé¢ä»£ç å’Œå›¾ç¤ºä¸»æ¼”æ¼”ç¤º WeakHashMap å¦‚ä½•è‡ªåŠ¨é‡Šæ”¾ç¼“å­˜å¯¹è±¡, å½“ init å‡½æ•°æ‰§è¡Œå®Œæˆå, å±€éƒ¨å˜é‡å­—ç¬¦ä¸²å¼•ç”¨ weakd1, weakd2, d1, d2 éƒ½ä¼šæ¶ˆå¤±, æ­¤æ—¶åªæœ‰é™æ€ map ä¸­ä¿å­˜å¯¹å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨, å¯ä»¥çœ‹åˆ°, è°ƒç”¨ gc ä¹‹å, HashMap çš„æ²¡æœ‰è¢«å›æ”¶, è€Œ WeakHashMap é‡Œé¢çš„ç¼“å­˜è¢«å›æ”¶äº†ã€‚</p><p><strong>8-ç›‘å¬å™¨å’Œå›è°ƒ</strong></p><p>å†…å­˜æ³„æ¼ç¬¬ä¸‰ä¸ªå¸¸è§æ¥æºæ˜¯ç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨ä½ å®ç°çš„ API ä¸­æ³¨å†Œå›è°ƒï¼Œå´æ²¡æœ‰æ˜¾ç¤ºçš„å–æ¶ˆï¼Œé‚£ä¹ˆå°±ä¼šç§¯èšã€‚</p><p>éœ€è¦ç¡®ä¿å›è°ƒç«‹å³è¢«å½“ä½œåƒåœ¾å›æ”¶çš„æœ€ä½³æ–¹æ³•æ˜¯åªä¿å­˜å®ƒçš„å¼±å¼•ç”¨ï¼Œä¾‹å¦‚å°†ä»–ä»¬ä¿å­˜æˆä¸º WeakHashMap ä¸­çš„é”®ã€‚</p><h4 id="å†…å­˜æ³„æ¼æ¡ˆä¾‹åˆ†æ">å†…å­˜æ³„æ¼æ¡ˆä¾‹åˆ†æ</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stack</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        elements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Object</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//å…¥æ ˆ</span>        <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        elements<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å­˜åœ¨å†…å­˜æ³„æ¼</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//å‡ºæ ˆ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EmptyStackException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> elements<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„ç§»å‡ºçš„æ—¶å€™åªæ˜¯å°†æŒ‡é’ˆå‰ç§», å¹¶æ²¡æœ‰çœŸæ­£ç§»å‡ºå¯¹è±¡, GCä¹Ÿæ— æ³•å›æ”¶</span>    <span class="token punctuation">&#125;</span><span class="token comment">//åº”è¯¥æ”¹æˆè¿™æ ·</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EmptyStackException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> result <span class="token operator">=</span> elements<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>        elements<span class="token punctuation">[</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//å°†å †ä¸­æ•°æ®æŒ‡é’ˆæ–­æ‰</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>elements<span class="token punctuation">.</span>length <span class="token operator">==</span> size<span class="token punctuation">)</span>            elements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="OQLè¯­è¨€æŸ¥è¯¢å¯¹è±¡ä¿¡æ¯">OQLè¯­è¨€æŸ¥è¯¢å¯¹è±¡ä¿¡æ¯</h3><p>MAT æ”¯æŒä¸€ç§ç±»ä¼¼äº SQL çš„æŸ¥è¯¢è¯­è¨€ OQL(Object Query Language)ã€‚OQL ä½¿ç”¨ç±» SQL è¯­æ³•ï¼Œå¯ä»¥åœ¨å †ä¸­è¿›è¡Œå¯¹è±¡çš„æŸ¥æ‰¾å’Œç­›é€‰ã€‚</p><p><strong>Select å­å¥ï¼š</strong></p><p>åœ¨MATä¸­ï¼ŒSelect å­å¥çš„æ ¼å¼ä¸ SQL åŸºæœ¬ä¸€è‡´ï¼Œç”¨äºæŒ‡å®šè¦æ˜¾ç¤ºçš„åˆ—ã€‚Select å­å¥ä¸­å¯ä»¥ä½¿ç”¨&quot;*&quot;ï¼ŒæŸ¥çœ‹ç»“æœå¯¹è±¡çš„å¼•ç”¨å®ä¾‹ï¼ˆç›¸å½“äºoutgoing references)ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Vector v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨&quot;OBJECTS&quot;å…³é”®å­—ï¼Œå¯ä»¥å°†è¿”å›ç»“æœé›†ä¸­çš„é¡¹ä»¥å¯¹è±¡çš„å½¢å¼æ˜¾ç¤ºã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> objects v<span class="token punctuation">.</span>elementData <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Vector v<span class="token keyword">SELECT</span> OBJECTS s<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨ Select å­å¥ä¸­ï¼Œä½¿ç”¨&quot;AS RETAINED SET&quot;å…³é”®å­—å¯ä»¥å¾—åˆ°æ‰€å¾—å¯¹è±¡çš„ä¿ç•™é›†ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">AS</span> RETAINED <span class="token keyword">SET</span> <span class="token keyword">FROM</span> com<span class="token punctuation">.</span>saddyfire<span class="token punctuation">.</span>mat<span class="token punctuation">.</span>Student<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>&quot;DISTINCT&quot;å…³é”®å­—ç”¨äºåœ¨ç»“æœé›†ä¸­å»é™¤é‡å¤å¯¹è±¡ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> OBJECTS classof<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>FROMå­å¥</strong></p><p>Fomå­å¥ç”¨äºæŒ‡å®šæŸ¥è¯¢èŒƒå›´ï¼Œå®ƒå¯ä»¥æŒ‡å®šç±»åã€æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…å¯¹è±¡åœ°å€ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹ä¾‹ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé™å®šæœç´¢èŒƒå›´ï¼Œè¾“å‡ºæ‰€æœ‰ com.saddyfire åŒ…ä¸‹æ‰€æœ‰ç±»çš„å®ä¾‹</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">FROM</span> <span class="token string">"com\.saddyfire\..*"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç±»çš„åœ°å€è¿›è¡Œæœç´¢ã€‚ä½¿ç”¨ç±»çš„åœ°å€çš„å¥½å¤„æ˜¯å¯ä»¥åŒºåˆ†è¢«ä¸åŒ ClassLoader åŠ è½½çš„åŒä¸€ç§ç±»å‹</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">from</span> <span class="token number">0x37a0b4d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>WHEREå­å¥</strong></p><p>Where å­å¥ç”¨äºæŒ‡å®š OQL çš„æŸ¥è¯¢æ¡ä»¶ã€‚OQL æŸ¥è¯¢å°†åªè¿”å›æ»¡è¶³ Where å­å¥æŒ‡å®šæ¡ä»¶çš„å¯¹è±¡ã€‚</p><p>Where å­å¥çš„æ ¼å¼ä¸ä¼ ç»Ÿ SQL æä¸ºç›¸ä¼¼ã€‚<br>ä¸‹ä¾‹è¿”å›é•¿åº¦å¤§äº 10 çš„ char æ•°ç»„ã€‚</p><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">SELECT FROM char[] s WHERE s.@length&gt;10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹ä¾‹è¿”å›åŒ…å« â€œjavaâ€ å­å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ &quot;LIKE æ“ä½œç¬¦ï¼Œâ€œLIKEâ€ æ“ä½œç¬¦çš„æ“ä½œå‚æ•°ä¸ºæ­£åˆ™è¡¨è¾¾å¼ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">WHERE</span> toString<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">LIKE</span> "<span class="token operator">*</span>java<span class="token punctuation">.</span><span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹ä¾‹è¿”å›æ‰€æœ‰ value åŸŸä¸ä¸º null çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ â€œ=â€ æ“ä½œç¬¦ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s <span class="token keyword">where</span> s<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">!=</span> <span class="token boolean">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Where å­å¥æ”¯æŒå¤šä¸ªæ¡ä»¶çš„ ANDã€OR è¿ç®—ã€‚ä¸‹ä¾‹è¿”å›æ•°ç»„é•¿åº¦å¤§äº15ï¼Œå¹¶ä¸”æ·±å †å¤§äº 1000 å­—èŠ‚çš„æ‰€æœ‰ Vector å¯¹è±¡ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Vector v <span class="token keyword">WHERE</span> v<span class="token punctuation">.</span>elementData<span class="token punctuation">.</span><span class="token variable">@length</span><span class="token operator">></span><span class="token number">15</span> <span class="token operator">AND</span> v<span class="token punctuation">.</span><span class="token variable">@retainedHeapsize</span><span class="token operator">></span><span class="token number">1000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å†…ç½®å¯¹è±¡ä¸æ–¹æ³•</strong></p><p>OQL ä¸­å¯ä»¥è®¿é—®å †å†…å¯¹è±¡çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è®¿é—®å †å†…ä»£ç†å¯¹è±¡çš„å±æ€§ã€‚è®¿é—®å †å†…å¯¹è±¡çš„å±æ€§æ—¶ï¼Œ<br>æ ¼å¼å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">[</span> <span class="token operator">&lt;</span>alias<span class="token operator">></span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token operator">&lt;</span>field<span class="token operator">></span><span class="token punctuation">.</span><span class="token operator">&lt;</span>field<span class="token operator">></span><span class="token punctuation">.</span><span class="token operator">&lt;</span>field<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä¸­ alias ä¸ºå¯¹è±¡åç§°ã€‚</p><p>è®¿é—® java.io.File å¯¹è±¡çš„ path å±æ€§ï¼Œå¹¶è¿›ä¸€æ­¥è®¿é—® path çš„ value å±æ€§ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> toString<span class="token punctuation">(</span>f<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token keyword">File</span> f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹ä¾‹æ˜¾ç¤ºäº† String å¯¹è±¡çš„å†…å®¹ã€objectid å’Œ objectAddressã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> s<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span><span class="token variable">@objectId</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span><span class="token variable">@objectAddress</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹ä¾‹æ˜¾ç¤º java.util.Vector å†…éƒ¨æ•°ç»„çš„é•¿åº¦ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> v<span class="token punctuation">.</span>elementData<span class="token punctuation">.</span><span class="token variable">@length</span> <span class="token keyword">FROM</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Vector v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸‹ä¾‹æ˜¾ç¤ºäº†æ‰€æœ‰çš„java.util.Vectorå¯¹è±¡åŠå…¶å­ç±»å‹</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">from</span> INSTANCEOF java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Vector<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-Tuning-01-JVMç›‘æ§åŠè¯Šæ–­-å‘½ä»¤ç¯‡</title>
      <link href="/2024/01/07/jvm-tuning1/"/>
      <url>/2024/01/07/jvm-tuning1/</url>
      
        <content type="html"><![CDATA[<h1>JVMç›‘æ§åŠè¯Šæ–­-å‘½ä»¤ç¯‡</h1><h2 id="æ¦‚è¿°">æ¦‚è¿°</h2><h3 id="æ€§èƒ½è°ƒä¼˜æ€è·¯">æ€§èƒ½è°ƒä¼˜æ€è·¯</h3><p><strong>1-å‘ç°é—®é¢˜: æ€§èƒ½ç›‘æ§</strong></p><ul><li>GC é¢‘ç¹</li><li>cpu load è¿‡é«˜</li><li>OOM</li><li>å†…å­˜æ³„æ¼</li><li>æ­»é”</li><li>ç¨‹åºå“åº”æ—¶é—´é•¿</li></ul><p><strong>2-æ’æŸ¥é—®é¢˜: æ€§èƒ½åˆ†æ</strong></p><ul><li>æ‰“å° GC æ—¥å¿—, é€šè¿‡ GCviewer æˆ–è€… <a href="http://gceasy.io">http://gceasy.io</a> æ¥åˆ†ææ—¥å¿—ä¿¡æ¯</li><li>çµæ´»è¿ç”¨å‘½ä»¤è¡Œå·¥å…·: jstack, jmap, jinfo ç­‰</li><li>dumpå‡ºå †æ–‡ä»¶, ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·åˆ†ææ–‡ä»¶</li><li>ä½¿ç”¨é˜¿é‡Œ Arthas, æˆ– jconsole, JVisualVM æ¥å®æ—¶æŸ¥çœ‹ JVM çŠ¶æ€</li><li>jstack æŸ¥çœ‹å †æ ˆä¿¡æ¯</li></ul><p><strong>3-è§£å†³é—®é¢˜: æ€§èƒ½è°ƒä¼˜</strong></p><ul><li>é€‚å½“å¢åŠ å†…å­˜, æ ¹æ®ä¸šåŠ¡èƒŒæ™¯é€‰æ‹©åƒåœ¾å›æ”¶å™¨</li><li>ä¼˜åŒ–ä»£ç , æ§åˆ¶å†…å­˜ä½¿ç”¨</li><li>å¢åŠ æœºå™¨, åˆ†æ•£èŠ‚ç‚¹å‹åŠ›</li><li>åˆç†è®¾ç½®çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡</li><li>ä½¿ç”¨ä¸­é—´ä»¶æé«˜ç¨‹åºæ•ˆç‡, æ¯”å¦‚ç¼“å­˜, æ¶ˆæ¯é˜Ÿåˆ—ç­‰</li></ul><h3 id="æ€§èƒ½è¯„ä»·-æµ‹è¯•æŒ‡æ ‡">æ€§èƒ½è¯„ä»·/æµ‹è¯•æŒ‡æ ‡</h3><h4 id="1-åœé¡¿æ—¶é—´-æˆ–å“åº”æ—¶é—´">1-åœé¡¿æ—¶é—´(æˆ–å“åº”æ—¶é—´)</h4><p>æäº¤è¯·æ±‚å’Œè¿”å›è¯¥è¯·æ±‚çš„å“åº”ä¹‹é—´ä½¿ç”¨çš„æ—¶é—´, ä¸€èˆ¬æ¯”è¾ƒå…³æ³¨å¹³å‡å“åº”æ—¶é—´</p><p>å¸¸ç”¨æ“ä½œçš„å“åº”æ—¶é—´åˆ—è¡¨</p><table><thead><tr><th>æ“ä½œ</th><th>å“åº”æ—¶é—´</th></tr></thead><tbody><tr><td>æ‰“å¼€ä¸€ä¸ªç«™ç‚¹</td><td>å‡ ç§’</td></tr><tr><td>æ•°æ®åº“æŸ¥è¯¢ä¸€æ¡è®°å½•(æœ‰ç´¢å¼•)</td><td>åå‡ æ¯«ç§’</td></tr><tr><td>æœºæ¢°ç¡¬ç›˜ä¸€æ¬¡å¯»å€å®šä½</td><td>4æ¯«ç§’</td></tr><tr><td>ä»æœºæ¢°ç£ç›˜é¡ºåºè¯»å– 1M æ•°æ®</td><td>2æ¯«ç§’</td></tr><tr><td>ä» SSD ç£ç›˜é¡ºåºè¯»å– 1M æ•°æ®</td><td>0.3æ¯«ç§’</td></tr><tr><td>ä»è¿œç¨‹åˆ†å¸ƒå¼æ¢æˆ Redis è¯»å–ä¸€ä¸ªæ•°æ®</td><td>0.5æ¯«ç§’</td></tr><tr><td>ä»å†…å­˜è¯»å– 1M æ•°æ®</td><td>åå‡ å¾®å¦™</td></tr><tr><td>ç½‘ç»œä¼ è¾“ 2KB æ•°æ®</td><td>1 å¾®å¦™</td></tr></tbody></table><p>åœ¨åƒåœ¾å›æ”¶ç¯èŠ‚ä¸­:</p><p>æš‚åœæ—¶é—´: <strong>æ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶, ç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´</strong></p><p><code>-XX:MaxGCPauseMillis</code></p><h4 id="2-ååé‡">2-ååé‡</h4><p>å¯¹å•ä½æ—¶é—´å†…å®Œæˆçš„å·¥ä½œé‡(è¯·æ±‚é‡)çš„é‡åº¦</p><p>åœ¨ GC ä¸­: è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹(æ€»è¿è¡Œæ—¶é—´: ç¨‹åºçš„è¿è¡Œæ—¶é—´ + å†…å­˜å›æ”¶çš„æ—¶é—´)</p><p><strong>ååé‡ä¸º 1-1/(1 + n)</strong> <code>-XX:GCTimeRatio=n</code></p><h4 id="3-å¹¶å‘æ•°">3-å¹¶å‘æ•°</h4><p>åŒä¸€æ—¶åˆ», å¯¹æœåŠ¡å™¨ç”±å®é™…äº¤äº’çš„è¯·æ±‚æ•°</p><blockquote><p>1000ä¸ªäººåŒæ—¶åœ¨çº¿, ä¼°è®¡å¹¶å‘æ•°åœ¨ 5%-15% ä¹‹é—´, ä¹Ÿå°±æ˜¯åŒæ—¶å¹¶å‘é‡: 50-150 ä¹‹é—´</p></blockquote><h4 id="4-å†…å­˜å ç”¨">4-å†…å­˜å ç”¨</h4><p>Java å †åŒºæ‰€å ç”¨çš„å†…å­˜å¤§å°</p><h2 id="02-jps">02-jps</h2><p><strong>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹</strong></p><h2 id="03-jstat">03-jstat</h2><p><strong>jstat(JVM Statistics Monitoring Tool)</strong>:</p><p>ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</p><p>åœ¨æ²¡æœ‰GUTå›¾å½¢ç•Œé¢ï¼Œåªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚å¸¸ç”¨äºæ£€æµ‹åƒåœ¾å›æ”¶é—®é¢˜ä»¥åŠå†…å­˜æ³„æ¼é—®é¢˜ã€‚<br>å®˜æ–¹æ–‡æ¡£ï¼š<br><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/istat.html">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/istat.html</a></p><h3 id="åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•</h3><p>å®ƒçš„åŸºæœ¬ä½¿ç”¨è¯­æ³•ä¸ºï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jstat -<span class="token operator">&lt;</span>option<span class="token operator">></span> <span class="token punctuation">[</span>-t<span class="token punctuation">]</span> <span class="token punctuation">[</span>-h<span class="token operator">&lt;</span>linues<span class="token operator">></span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>vmid<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>interval<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>count<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">]</span>ç±»è£…è½½ç›¸å…³:-class: æ˜¾ç¤º ClassLoader çš„ç›¸å…³ä¿¡æ¯: ç±»çš„è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ã€ç±»è£…è½½æ‰€æ¶ˆè€—çš„æ—¶é—´ç­‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>optionå‚æ•°</strong></p><ul><li>ç±»è£…è½½ç›¸å…³:</li></ul><table><thead><tr><th>é€‰é¡¹</th><th>é€‰é¡¹è¯´æ˜</th></tr></thead><tbody><tr><td><code>- class</code></td><td>æ˜¾ç¤º ClassLoader çš„ç›¸å…³ä¿¡æ¯: ç±»çš„è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ã€ç±»è£…è½½æ‰€æ¶ˆè€—çš„æ—¶é—´ç­‰</td></tr></tbody></table><ul><li>åƒåœ¾å›æ”¶ç›¸å…³çš„ï¼š</li></ul><table><thead><tr><th>é€‰é¡¹</th><th>é€‰é¡¹è¯´æ˜</th></tr></thead><tbody><tr><td>ğŸ‘-gc</td><td>æ˜¾ç¤ºä¸ GC ç›¸å…³çš„å †ä¿¡æ¯ã€‚åŒ…æ‹¬ Eden åŒºã€ä¸¤ä¸ª Survivor åŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GC æ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ã€‚</td></tr><tr><td>-gccapacity</td><td>æ˜¾ç¤ºå†…å®¹ä¸ <code>-gc</code> åŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨ Java å †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ã€‚</td></tr><tr><td>ğŸ‘-gcutil</td><td>æ˜¾ç¤ºå†…å®¹ä¸ <code>-gc</code> åŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·±ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”ã€‚</td></tr><tr><td>ğŸ‘-gccause</td><td>ä¸ <code>-gcutil</code> åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´æœ€åä¸€æ¬¡æˆ–å½“å‰æ­£åœ¨å‘ç”Ÿçš„GCäº§ç”Ÿçš„åŸå› ã€‚</td></tr><tr><td>-gcnew</td><td>æ˜¾ç¤ºæ–°ç”Ÿä»£GCçŠ¶å†µ</td></tr><tr><td>-gcnewcapacity</td><td>æ˜¾ç¤ºå†…å®¹ä¸ <code>-gcnew</code> åŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td>-geold</td><td>æ˜¾ç¤ºè€å¹´ä»£ GC çŠ¶å†µ</td></tr><tr><td>-gcoldcapacity</td><td>æ˜¾ç¤ºå†…å®¹ä¸ <code>-gcold</code>åŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td>-gcpermcapacity</td><td>æ˜¾ç¤ºæ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ã€‚</td></tr></tbody></table><ul><li>JIT ç›¸å…³çš„ï¼š</li></ul><table><thead><tr><th>é€‰é¡¹</th><th>é€‰é¡¹è¯´æ˜</th></tr></thead><tbody><tr><td><code>-compiler</code></td><td>æ˜¾ç¤º JIT ç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯</td></tr><tr><td><code>-printcompilation</code></td><td>è¾“å‡ºå·±ç»è¢« JIT ç¼–è¯‘çš„æ–¹æ³•</td></tr></tbody></table><p>ğŸ‘<strong>intervalå‚æ•°</strong></p><ul><li>ç”¨äºæŒ‡å®šè¾“å‡ºç»Ÿè®¡æ•°æ®çš„å‘¨æœŸ, å•ä½ä¸ºæ¯«ç§’. å³: æŸ¥è¯¢æ—¶é—´</li></ul><p>ğŸ‘<strong>countå‚æ•°</strong></p><ul><li>ç”¨äºæŒ‡å®šæŸ¥è¯¢çš„æ€»æ¬¡æ•°</li></ul><p>ğŸ‘**-tå‚æ•°**</p><ul><li>å¯ä»¥åœ¨è¾“å‡ºä¿¡æ¯å‰åŠ ä¸Šä¸€ä¸ªTimestampåˆ—ï¼Œæ˜¾ç¤ºç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚å•ä½ï¼šç§’</li><li>å¯ä»¥æ¯”è¾ƒ Java è¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ä»¥åŠæ€» GC æ—¶é—´ (GCT åˆ—), æˆ–è€…ä¸¤æ¬¡æµ‹é‡çš„é—´éš”æ—¶é—´ä»¥åŠæ€» GC æ—¶é—´çš„å¢é‡, æ¥å¾—å‡º GC æ—¶é—´å è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹</li><li>å¦‚æœè¯¥æ¯”ä¾‹è¶…è¿‡ 20%, åˆ™è¯´æ˜ç›®å‰å †çš„å‹åŠ›è¾ƒå¤§; å¦‚æœè¯¥æ¯”ä¾‹è¶…è¿‡ 90%, åˆ™è¯´æ˜å †é‡Œå‡ ä¹æ²¡æœ‰å¯ç”¨ç©ºé—´, éšæ—¶éƒ½å¯èƒ½æŠ›å‡º OOM å¼‚å¸¸</li></ul><p><strong>-hå‚æ•°</strong></p><ul><li>å¯ä»¥åœ¨å‘¨æœŸæ€§è¾“å‡ºæ—¶, è¾“å‡ºå¤šå°‘è¡Œæ•°æ®åè¾“å‡ºä¸€ä¸ªè¡¨å¤´ä¿¡æ¯</li></ul><h3 id="gc-æ§åˆ¶å°è¯¦è§£">-gc æ§åˆ¶å°è¯¦è§£</h3><p><strong>å †ç©ºé—´é»˜è®¤æ¯”ä¾‹</strong></p><p><img src="./../jvm-tuning1/image-20240107203204723.png" alt=""></p><p><strong>æ–°ç”Ÿä»£ç›¸å…³</strong></p><ul><li>S0C æ˜¯ç¬¬ä¸€ä¸ªå¹¸å­˜è€…åŒºçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li><li>S1C æ˜¯ç¬¬äºŒä¸ªå¹¸å­˜è€…åŒºçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li><li>S0U æ˜¯ç¬¬ä¸€ä¸ªå¹¸å­˜è€…åŒºå·²ä½¿ç”¨çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li><li>S1U æ˜¯ç¬¬äºŒä¸ªå¹¸å­˜è€…åŒºå·²ä½¿ç”¨çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li><li>EC æ˜¯ Eden ç©ºé—´çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li><li>EU æ˜¯ Eden ç©ºé—´å·²ä½¿ç”¨å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li></ul><p><strong>è€å¹´ä»£ç›¸å…³</strong></p><ul><li>OC æ˜¯è€å¹´ä»£çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li><li>OU æ˜¯è€å¹´ä»£å·²ä½¿ç”¨çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰</li></ul><p><strong>æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ç›¸å…³</strong></p><ul><li>MC æ˜¯æ–¹æ³•åŒºçš„å¤§å°</li><li>MU æ˜¯æ–¹æ³•åŒºå·²ä½¿ç”¨çš„å¤§å°</li><li>CCSC æ˜¯å‹ç¼©ç±»ç©ºé—´çš„å¤§å°</li><li>CCSU æ˜¯å‹ç¼©ç±»ç©ºé—´å·²ä½¿ç”¨çš„å¤§å°</li></ul><p><strong>å…¶ä»–</strong></p><ul><li>YGC æ˜¯ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ young gc çš„æ¬¡æ•°</li><li>YGCT æ˜¯æŒ‡ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ young gc æ¶ˆè€—æ—¶é—´ï¼ˆç§’ï¼‰</li><li>FGC æ˜¯ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ full gc çš„æ¬¡æ•°</li><li>FGCT æ˜¯ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶çš„ full gc çš„æ¶ˆè€—æ—¶é—´ï¼ˆç§’ï¼‰</li><li>GCT æ˜¯ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ gc çš„æ€»æ—¶é—´</li></ul><p><strong>ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// -Xms60m -Xmx60m -XX:SurvivorRatio=8</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GCTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//100kb</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// ç»ˆç«¯å‘½ä»¤</span><span class="token comment">// jstat -gc -t 1476 1000 10</span><span class="token comment">// jstat -gcutil -t 1476 1000 10</span><span class="token comment">// jstat -gccause -t 10200 1000 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="t-å‚æ•°è§‚å¯Ÿè¯´æ˜">-t å‚æ•°è§‚å¯Ÿè¯´æ˜</h4><p>GCTçš„æ—¶é—´å·®/Timestampæ—¶é—´å·®: å¦‚æœå¤§äº20%,è¯´æ˜å †å‹åŠ›è¾ƒå¤§; å¦‚æœå¤§äº90%, åˆ™éšæ—¶éƒ½å¯èƒ½GC, è¯¦ç»†è§ -tå‚æ•° æè¿°</p><h4 id="åˆ¤æ–­æ˜¯å¦å‡ºç°å†…å­˜æ³„æ¼">åˆ¤æ–­æ˜¯å¦å‡ºç°å†…å­˜æ³„æ¼</h4><ol><li>åœ¨é•¿æ—¶é—´è¿è¡Œçš„ Java ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ <code>jstat</code> å‘½ä»¤è¿ç»­è·å–å¤šè¡Œæ€§èƒ½æ•°æ®ï¼Œå¹¶å–è¿™å‡ è¡Œæ•°æ®ä¸­ OU åˆ—ï¼ˆå³å·±å ç”¨çš„è€å¹´ä»£å†…å­˜ï¼‰çš„æœ€å°å€¼ã€‚</li><li>ç„¶åï¼Œæˆ‘ä»¬æ¯éš”ä¸€æ®µè¾ƒé•¿çš„æ—¶é—´é‡å¤ä¸€æ¬¡ä¸Šè¿°æ“ä½œï¼Œæ¥è·å¾—å¤šç»„ OU æœ€å°å€¼ã€‚å¦‚æœè¿™äº›å€¼å‘ˆä¸Šæ¶¨è¶‹åŠ¿ï¼Œåˆ™è¯´æ˜è¯¥ Java ç¨‹åºçš„è€å¹´ä»£å†…å­˜å·±ä½¿ç”¨é‡åœ¨ä¸æ–­ä¸Šæ¶¨ï¼Œè¿™æ„å‘³ç€æ— æ³•å›æ”¶çš„å¯¹è±¡åœ¨ä¸æ–­å¢åŠ ï¼Œå› æ­¤å¾ˆæœ‰å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ã€‚</li></ol><h2 id="04-jinfo">04-jinfo</h2><p><strong>æŸ¥çœ‹è™šæ‹Ÿæœºé…ç½®å‚æ•°ä¿¡æ¯, ä¹Ÿå¯ç”¨äºè°ƒæ•´è™šæ‹Ÿæœºçš„é…ç½®å‚æ•°</strong></p><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒJava åº”ç”¨ç¨‹åºä¸ä¼šæŒ‡å®šæ‰€æœ‰çš„ Java è™šæ‹Ÿæœºå‚æ•°ã€‚è€Œæ­¤æ—¶ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸çŸ¥é“æŸä¸€ä¸ªå…·ä½“çš„ Java è™šæ‹Ÿæœºå‚æ•°çš„é»˜è®¤å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦é€šè¿‡æŸ¥æ‰¾æ–‡æ¡£è·å–æŸä¸ªå‚æ•°çš„é»˜è®¤å€¼ã€‚è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å¯èƒ½æ˜¯éå¸¸è‰°éš¾çš„ã€‚ä½†æœ‰äº† <code>jinfo</code> å·¥å…·ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰¾åˆ° Java è™šæ‹Ÿæœºå‚æ•°çš„å½“å‰å€¼ã€‚</p><h3 id="åŸºæœ¬è¯­æ³•-2">åŸºæœ¬è¯­æ³•</h3><p><code>jinfo [options] pid</code></p><p>è¯´æ˜: java è¿›ç¨‹ ID å¿…é¡»è¦åŠ ä¸Š</p><table><thead><tr><th>é€‰é¡¹</th><th>é€‰é¡¹è¯´æ˜</th></tr></thead><tbody><tr><td>-flag name</td><td>è¾“å‡ºå¯¹åº”åç§°çš„å‚æ•°</td></tr><tr><td>-flag [Â±] name</td><td>å¼€å¯æˆ–è€…å…³é—­å¯¹åº”åç§°çš„å‚æ•°, åªæœ‰è¢«æ ‡è®°ä¸º manageable çš„å‚æ•°æ‰å¯ä»¥è¢«åŠ¨æ€ä¿®æ”¹</td></tr><tr><td>-flag name=value</td><td>è®¾å®šå¯¹åº”åç§°çš„å‚æ•°</td></tr><tr><td>-flags</td><td>è¾“å‡ºå…¨éƒ¨çš„å‚æ•°</td></tr><tr><td>-sysprops</td><td>è¾“å‡ºç³»ç»Ÿå±æ€§</td></tr></tbody></table><h3 id="æ§åˆ¶å°è¯¦è§£">æ§åˆ¶å°è¯¦è§£</h3><p><strong>ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScannerTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> info <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æŸ¥çœ‹å‚æ•°">æŸ¥çœ‹å‚æ•°</h4><p><code>jinfo -flags 23456</code></p><p><img src="./../jvm-tuning1/image-20240107212623817.png" alt=""></p><p><code>jinfo -flag UseParallelGC 23456</code></p><p><img src="./../jvm-tuning1/image-20240107212717024.png" alt=""></p><h4 id="ä¿®æ”¹å‚æ•°">ä¿®æ”¹å‚æ•°</h4><p><code>jinfo</code> ä¸ä»…å¯ä»¥æŸ¥çœ‹è¿è¡Œæ—¶æŸä¸€ä¸ª Java è™šæ‹Ÿæœºå‚æ•°çš„å®é™…å–å€¼, ç”šè‡³å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹éƒ¨åˆ†å‚æ•°, å¹¶ä½¿ä¹‹ç«‹å³ç”Ÿæ•ˆ.</p><p>ä½†æ˜¯, å¹¶éæ‰€æœ‰å‚æ•°éƒ½æ”¯æŒåŠ¨æ€ä¿®æ”¹. å‚æ•°åªæœ‰è¢«æ ‡è®° manageable çš„ flag å¯ä»¥è¢«å®æ—¶ä¿®æ”¹. å…¶å®, è¿™ä¸ªä¿®æ”¹èƒ½åŠ›æ˜¯åŠå…¶æœ‰é™çš„.</p><ul><li>æŸ¥çœ‹è¢«æ ‡è®° manageable çš„å‚æ•°</li><li><code>java -XX:+PrintFlagsFinal -version | grep manageable</code></li></ul><p><strong>é’ˆå¯¹booleanç±»å‹</strong></p><p><code>jinfo -flag [+/-]å‚æ•°åç§° è¿›ç¨‹id</code></p><p><strong>é’ˆå¯¹ébooleanç±»å‹</strong></p><p><code>jinfo -flag å‚æ•°åç§°=å‚æ•°å€¼ è¿›ç¨‹id</code></p><h3 id="æ‹“å±•">æ‹“å±•</h3><p><strong>æŸ¥çœ‹æ‰€æœ‰ JVM å‚æ•°å¯åŠ¨çš„åˆå§‹å€¼</strong></p><p><code>java -XX:+PrintFlagsInitial</code></p><p><strong>æŸ¥çœ‹æ‰€æœ‰ JVM å‚æ•°çš„æœ€ç»ˆå€¼</strong></p><p><code>java -XX:+PrintFlagsFinal</code></p><p><strong>æŸ¥çœ‹é‚£äº›å·²ç»è¢«ç”¨æˆ·æˆ–è€… JVM è®¾ç½®è¿‡çš„è¯¦æƒ…çš„XXå‚æ•°çš„åç§°å’Œå€¼</strong></p><p><code>java -å‚æ•°åç§°:+PrintCommandLineFlags</code></p><h2 id="05-jmap">05-jmap</h2><p><strong>å¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶&amp;å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></p><p>jmap(JVM Memory Map): ä½œç”¨ä¸€æ–¹é¢æ˜¯è·å– dump æ–‡ä»¶ï¼ˆå †è½¬å‚¨å¿«ç…§æ–‡ä»¶ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰, å®ƒè¿˜å¯ä»¥è·å–ç›®æ ‡ Java è¿›ç¨‹çš„å†…å­˜ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Java å †å„åŒºåŸŸçš„ä½¿ç”¨æƒ…å†µã€å †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ã€ç±»åŠ è½½ä¿¡æ¯ç­‰ã€‚</p><p>å¼€å‘äººå‘˜å¯ä»¥åœ¨æ§åˆ¶å°ä¸­è¾“å…¥å‘½ä»¤ <code>jmap-help</code> æŸ¥é˜… jmap å·¥å…·çš„å…·ä½“ä½¿ç”¨æ–¹å¼å’Œä¸€äº›æ ‡å‡†é€‰é¡¹é…ç½®ã€‚</p><p>å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š<br><a href="https://docs.oracle.com/en/java/javase/11/tools/jmap.html">https://docs.oracle.com/en/java/javase/11/tools/jmap.html</a></p><h3 id="åŸºæœ¬è¯­æ³•-3">åŸºæœ¬è¯­æ³•</h3><ul><li><code>jmap [option] &lt;pid&gt;</code></li><li><code>jmap [option] &lt;executable&gt;</code></li><li><code>jmap [option] [server_id@]&lt;remote server IP or hostname&gt;</code></li></ul><p><strong>option åŒ…æ‹¬</strong></p><table><thead><tr><th>é€‰é¡¹</th><th>é€‰é¡¹è¯´æ˜</th></tr></thead><tbody><tr><td>-dump</td><td>ç”Ÿæˆdumpæ–‡ä»¶</td></tr><tr><td>-finalizerinfo</td><td>ä»¥ ClassLoader ä¸ºç»Ÿè®¡å£å¾„è¾“å‡ºæ°¸ä¹…ä»£çš„å†…å­˜çŠ¶æ€ä¿¡æ¯</td></tr><tr><td>-heap</td><td>è¾“å‡ºæ•´ä¸ªå †ç©ºé—´çš„è¯¦ç»†ä¿¡æ¯, åŒ…æ‹¬ GC çš„ä½¿ç”¨ã€å †é…ç½®ä¿¡æ¯, ä»¥åŠå†…å­˜çš„å®ç”¨ä¿¡æ¯ç­‰</td></tr><tr><td>-histo</td><td>è¾“å‡ºå †ç©ºé—´ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯, åŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡å’Œåˆè®¡å®¹é‡</td></tr><tr><td>-permstat</td><td>ä»¥ ClassLoader ä¸ºç»Ÿè®¡å£å¾„è¾“å‡ºæ°¸ä¹…ä»£çš„å†…å­˜çŠ¶æ€ä¿¡æ¯</td></tr><tr><td>-F</td><td>å½“è™šæ‹Ÿæœºè¿›ç¨‹å¯¹ -dump é€‰é¡¹æ²¡æœ‰ä»»ä½•å“åº”æ—¶, å¼ºåˆ¶æ‰§è¡Œç”Ÿæˆ dump æ–‡ä»¶</td></tr></tbody></table><p>ğŸ‘**-dump**</p><ul><li>ç”ŸæˆJavaå †è½¬å‚¨å¿«ç…§ï¼šdumpæ–‡ä»¶</li><li>ç‰¹åˆ«çš„ï¼š-dump:liveåªä¿å­˜å †ä¸­çš„å­˜æ´»å¯¹è±¡</li></ul><p>ğŸ‘**-heap**</p><ul><li>è¾“å‡ºæ•´ä¸ªå †ç©ºé—´çš„è¯¦ç»†ä¿¡æ¯, åŒ…æ‹¬ GC çš„ä½¿ç”¨ã€å †é…ç½®ä¿¡æ¯, ä»¥åŠå†…å­˜çš„ä½¿ç”¨ä¿¡æ¯ç­‰</li></ul><p>ğŸ‘**-histo**</p><ul><li>è¾“å‡ºå †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯, åŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡å’Œåˆè®¡å®¹é‡</li><li>ç‰¹åˆ«çš„: -histo:live åªç»Ÿè®¡å †ä¸­çš„å­˜æ´»å¯¹è±¡</li></ul><p><strong>-permstat</strong></p><ul><li>ä»¥ ClassLoader ä¸ºç»Ÿè®¡å£å¾„è¾“å‡ºæ°¸ä¹…ä»£çš„å†…å­˜çŠ¶æ€ä¿¡æ¯</li><li>ä»… linux/solaris å¹³å°æœ‰æ•ˆ</li></ul><p><strong>-finalizerinfo</strong></p><ul><li>æ˜¾ç¤ºåœ¨ F-Queue ä¸­ç­‰å¾… Finalizer çº¿ç¨‹æ‰§è¡Œ finalize æ–¹æ³•çš„å¯¹è±¡</li><li>ä»… linux/solaris å¹³å°æœ‰æ•ˆ</li></ul><p><strong>-F</strong></p><ul><li>å½“è™šæ‹Ÿæœºè¿›ç¨‹å¯¹ -dump é€‰é¡¹æ²¡æœ‰ä»»ä½•å“åº”æ—¶, å¯ä½¿ç”¨æ­¤é€‰é¡¹å¼ºåˆ¶æ‰§è¡Œç”Ÿæˆ dump æ–‡ä»¶</li><li>ä»… linux/solaris å¹³å°æœ‰æ•ˆ</li></ul><p><strong><code>-J &lt;flag&gt;</code></strong></p><ul><li>ä¼ é€’å‚æ•°ç»™ jmap å¯åŠ¨çš„ JVM</li></ul><h3 id="ä½¿ç”¨1-å¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶">ä½¿ç”¨1: å¯¼å‡ºå†…å­˜æ˜ åƒæ–‡ä»¶</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ jmap æŒ‡ä»¤ç”Ÿæˆ dump æ–‡ä»¶çš„æ“ä½œç®—å¾—ä¸Šæ˜¯æœ€å¸¸ç”¨çš„ jmap å‘½ä»¤ä¹‹ä¸€ï¼Œå°†å †ä¸­æ‰€æœ‰å­˜æ´»å¯¹è±¡å¯¼å‡ºè‡³ä¸€ä¸ªæ–‡ä»¶ä¹‹ä¸­ã€‚</p><p>Heap Dump åˆå«åšå †å­˜å‚¨æ–‡ä»¶ï¼ŒæŒ‡ä¸€ä¸ª Java è¿›ç¨‹åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å†…å­˜å¿«ç…§ã€‚Heap Dump åœ¨è§¦å‘å†…å­˜å¿«ç…§çš„æ—¶å€™ä¼šä¿å­˜æ­¤åˆ»çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><ul><li>A110 bjects<br>Class,fields,primitive values and references</li><li>A11C1 asses<br>ClassLoader,name,super class,static fields</li><li>Garbage Collection Roots<br>objects defined to be reachable by the JVM</li><li>Thread Stacks and Local Variables<br>The call-stacks of threads at the moment of the snapshot,and per-frame<br>information about local objects</li></ul><p><strong>è¯´æ˜ï¼š</strong></p><ol><li>é€šå¸¸åœ¨ Heap Dump æ–‡ä»¶å‰ä¼šè§¦å‘ä¸€æ¬¡ Full GC,æ‰€ä»¥neap dumpæ–‡ä»¶é‡Œä¿å­˜çš„éƒ½æ˜¯ Full GC åç•™ä¸‹çš„å¯¹è±¡ä¿¡æ¯ã€‚</li><li>ç”±äºç”Ÿæˆ dump æ–‡ä»¶æ¯”è¾ƒè€—æ—¶ï¼Œå› æ­¤å¤§å®¶éœ€è¦è€å¿ƒç­‰å¾…ï¼Œå°¤å…¶æ˜¯å¤§å†…å­˜é•œåƒç”Ÿæˆ dump æ–‡ä»¶åˆ™éœ€è¦è€—è´¹æ›´é•¿çš„æ—¶é—´æ¥å®Œæˆã€‚</li></ol><p><strong>æ‰‹åŠ¨çš„æ–¹å¼</strong></p><ul><li><code>jmap -dump:format=b,file=&lt;filename.hprof&gt; &lt;pid&gt;</code></li><li>ğŸ‘<code>jmap -dump:live,format=b,file=&lt;filename.hprof&gt; &lt;pid&gt;</code></li></ul><p><strong>è‡ªåŠ¨çš„æ–¹å¼</strong></p><ul><li><code>-XX:+HeapDumpOnOutOfMemoryError</code></li><li><code>-XX:HeapDumpPath=&lt;filename.hprof&gt;</code></li></ul><p>å½“ç¨‹åºå‘ç”Ÿ OOM é€€å‡ºç³»ç»Ÿæ—¶ï¼Œä¸€äº›ç¬æ—¶ä¿¡æ¯éƒ½éšç€ç¨‹åºçš„ç»ˆæ­¢è€Œæ¶ˆå¤±ï¼Œè€Œé‡ç° OOM é—®é¢˜å¾€å¾€æ¯”è¾ƒå›°éš¾æˆ–è€…è€—æ—¶ã€‚æ­¤æ—¶è‹¥èƒ½åœ¨ OOM æ—¶ï¼Œè‡ªåŠ¨å¯¼å‡º dump æ–‡ä»¶å°±æ˜¾å¾—éå¸¸è¿«åˆ‡ã€‚</p><p>è¿™é‡Œä»‹ç»ä¸€ç§æ¯”è¾ƒå¸¸ç”¨çš„å–å¾—å †å¿«ç…§æ–‡ä»¶çš„æ–¹æ³•ï¼Œå³ä½¿ç”¨ï¼š</p><p>-XX:+HeapDumpOnOutofMemoryErrorï¼šåœ¨ç¨‹åºå‘ç”ŸOOMæ—¶ï¼Œå¯¼å‡ºåº”ç”¨ç¨‹åºçš„å½“å‰å †å¿«ç…§ã€‚<br>-XX:HeapDumpPathï¼šå¯ä»¥æŒ‡å®šå †å¿«ç…§çš„ä¿å­˜ä½ç½®ã€‚</p><p>æ¯”å¦‚ï¼š<br>-Xmx100m -XX:+HeapDumpOnOutofMemoryError -XX:HeapDumpPath=D:\m.hprof</p><h3 id="ä½¿ç”¨2-æ˜¾ç¤ºå †å†…å­˜ç›¸å…³ä¿¡æ¯">ä½¿ç”¨2: æ˜¾ç¤ºå †å†…å­˜ç›¸å…³ä¿¡æ¯</h3><ul><li><code>jmap -heap pid</code> å±•ç¤ºå½“å‰å †ç©ºé—´ä¿¡æ¯</li><li><code>jmap -histo pid</code> å±•ç¤ºå½“å‰å¯¹è±¡ä¿¡æ¯</li></ul><h3 id="å°ç»“">å°ç»“</h3><p>ç”±äº jmap å°†è®¿é—®å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œä¸ºäº†ä¿è¯åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸è¢«åº”ç”¨çº¿ç¨‹å¹²æ‰°ï¼Œjmap éœ€è¦å€ŸåŠ©å®‰å…¨ç‚¹æœºåˆ¶ï¼Œè®©æ‰€æœ‰çº¿ç¨‹åœç•™åœ¨ä¸æ”¹å˜å †ä¸­æ•°æ®çš„çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”± jmap å¯¼å‡ºçš„å †å¿«ç…§å¿…å®šæ˜¯å®‰å…¨ç‚¹ä½ç½®çš„ã€‚è¿™å¯èƒ½å¯¼è‡´åŸºäºè¯¥å †å¿«ç…§çš„åˆ†æç»“æœå­˜åœ¨åå·®ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾åœ¨ç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç ä¸­ï¼ŒæŸäº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåœ¨ä¸¤ä¸ªå®‰å…¨ç‚¹ä¹‹é—´ï¼Œé‚£ä¹ˆ :live é€‰é¡¹å°†æ— æ³•æ¢çŸ¥åˆ°è¿™äº›å¯¹è±¡ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹é•¿æ—¶é—´æ— æ³•è·‘åˆ°å®‰å…¨ç‚¹ï¼Œjmap å°†ä¸€ç›´ç­‰ä¸‹å»ã€‚</p><p>ä¸å‰é¢è®²çš„ jstat åˆ™ä¸åŒï¼Œåƒåœ¾å›æ”¶å™¨ä¼šä¸»åŠ¨å°† jstat æ‰€éœ€è¦çš„æ‘˜è¦æ•°æ®ä¿å­˜è‡³å›ºå®šä½ç½®ä¹‹ä¸­è€Œ jstat åªéœ€ç›´æ¥è¯»å–å³å¯ã€‚</p><h2 id="06-jhat">06-jhat</h2><p><strong>(JVM Heap Analysis Tool): JDK è‡ªå¸¦å †åˆ†æå·¥å…·</strong><br>Sun JDK æä¾›çš„ jhat å‘½ä»¤ä¸ jmap å‘½ä»¤æ­é…ä½¿ç”¨ï¼Œç”¨äºåˆ†æ jmap ç”Ÿæˆçš„ heap dump æ–‡ä»¶ï¼ˆå †è½¬å‚¨å¿«ç…§)ã€‚jhat å†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„ HTTP/HTML æœåŠ¡å™¨ï¼Œç”Ÿæˆ dump æ–‡ä»¶çš„åˆ†æç»“æœåï¼Œç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹åˆ†æç»“æœï¼ˆåˆ†æè™šæ‹Ÿæœºè½¬å‚¨å¿«ç…§ä¿¡æ¯ï¼‰ã€‚</p><p>ä½¿ç”¨äº† jhat å‘½ä»¤ï¼Œå°±å¯åŠ¨äº†ä¸€ä¸ª http æœåŠ¡ï¼Œç«¯å£æ˜¯7000ï¼Œå³ <a href="http://1oca1host:7000/">http://1oca1host:7000/</a> , å°±å¯ä»¥åœ¨æµè§ˆå™¨é‡Œåˆ†æã€‚</p><p>è¯´æ˜ï¼šjhatå‘½ä»¤åœ¨JDK9ã€JDK10ä¸­å·²ç»è¢«åˆ é™¤ï¼Œå®˜æ–¹å»ºè®®ç”¨VisualVMä»£æ›¿ã€‚</p><h2 id="07-jstack">07-jstack</h2><p><strong>æ‰“å° JVM ä¸­çº¿ç¨‹å¿«ç…§</strong></p><p>jstack(JVM Stack Trace): ç”¨äºç”Ÿæˆè™šæ‹ŸæœºæŒ‡å®šè¿›ç¨‹å½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼ˆè™šæ‹Ÿæœºå †æ ˆè·Ÿè¸ª)ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æŒ‡å®šè¿›ç¨‹çš„æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆã€‚</p><p>ç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä½œç”¨ï¼šå¯ç”¨äºå®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚<strong>çº¿ç¨‹é—´æ­»é”</strong>ã€<strong>æ­»å¾ªç¯</strong>ã€<strong>è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…</strong>ç­‰é—®é¢˜ã€‚è¿™äº›éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚å½“çº¿ç¨‹å‡ºç°åœé¡¿æ—¶ï¼Œå°±å¯ä»¥ç”¨jstackæ˜¾ç¤ºå„ä¸ªçº¿ç¨‹è°ƒç”¨çš„å †æ ˆæƒ…å†µã€‚</p><p>å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š<br><a href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html">https://docs.oracle.com/en/java/javase/11/tools/jstack.html</a></p><p>åœ¨thread dumpä¸­ï¼Œè¦ç•™æ„ä¸‹é¢å‡ ç§çŠ¶æ€</p><ul><li><strong>æ­»é”ï¼ŒDeadlock(é‡ç‚¹å…³æ³¨)</strong></li><li><strong>ç­‰å¾…èµ„æºï¼ŒWaiting on condition(é‡ç‚¹å…³æ³¨)</strong></li><li><strong>ç­‰å¾…è·å–ç›‘è§†å™¨ï¼ŒWaiting on monitor entry(é‡ç‚¹å…³æ³¨)</strong></li><li><strong>é˜»å¡ï¼ŒBlocked(é‡ç‚¹å…³æ³¨)</strong></li><li>æ‰§è¡Œä¸­ï¼ŒRunnable</li><li>æš‚åœï¼ŒSuspended</li><li>åœæ­¢ï¼ŒParked</li></ul><p><strong>æ­»é” ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDeadLock</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    s2<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>jps</code> -&gt; <code>jstack 18980</code></p><p><img src="./../jvm-tuning1/image-20240107224824883.png" alt=""></p><p><img src="./../jvm-tuning1/image-20240107224843349.png" alt=""></p><p><strong>TIMED_WAITING ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadSleepTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello - 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello - 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-tuning1/image-20240107225054663.png" alt="image-20240107225054663"></p><p><strong>çº¿ç¨‹åŒæ­¥ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadSyncTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Number</span> number <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>        t1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        t2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Number</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>                    number<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-tuning1/image-20240107225727222.png" alt=""></p><h2 id="08-jcmd">08-jcmd</h2><p><strong>å¤šåŠŸèƒ½å‘½ä»¤è¡Œ</strong></p><p>åœ¨JDK1.7ä»¥åï¼Œæ–°å¢äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· jcmdã€‚</p><p>å®ƒæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥å®ç°å‰é¢é™¤äº† jstat ä¹‹å¤–æ‰€æœ‰å‘½ä»¤çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼šç”¨å®ƒæ¥å¯¼å‡ºå †ã€å†…å­˜ä½¿ç”¨ã€æŸ¥çœ‹ Java è¿›ç¨‹ã€å¯¼å‡ºçº¿ç¨‹ä¿¡æ¯ã€æ‰§è¡Œ GCã€JVM è¿è¡Œæ—¶é—´ç­‰ã€‚</p><p>å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼š<br><a href="https://docs.oracle.com/en/java/javase/11/tools/jcmd.html">https://docs.oracle.com/en/java/javase/11/tools/jcmd.html</a></p><p>jcmd æ‹¥æœ‰ jmap çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨ Oracle çš„å®˜æ–¹ç½‘ç«™ä¸Šä¹Ÿæ¨èä½¿ç”¨ jcmd å‘½ä»¤ä»£ jmap å‘½ä»¤</p><h3 id="åŸºæœ¬è¯­æ³•-4">åŸºæœ¬è¯­æ³•</h3><ul><li><code>jcmd -l</code> åˆ—å‡ºæ‰€æœ‰çš„ JVM è¿›ç¨‹</li><li><code>jcmd pid help</code> é’ˆå¯¹æŒ‡å®šçš„è¿›ç¨‹, åˆ—å‡ºæ”¯æŒçš„æ‰€æœ‰å‘½ä»¤</li><li><code>jcmd pid å…·ä½“å‘½ä»¤</code> æ˜¾ç¤ºæŒ‡å®šè¿›ç¨‹çš„æŒ‡ä»¤å‘½ä»¤æ•°æ®</li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jcmd <span class="token parameter variable">-l</span> <span class="token comment">#æŸ¥çœ‹æ‰€æœ‰javaè¿›ç¨‹</span>jcmd <span class="token number">13508</span> <span class="token builtin class-name">help</span> <span class="token comment">#æŸ¥çœ‹å¯ä½¿ç”¨å‘½ä»¤</span>jcmd <span class="token number">13508</span> Thread.print <span class="token comment">#æŸ¥çœ‹æ ˆä¿¡æ¯,ç­‰åŒäºjstack</span>jcmd <span class="token number">13508</span> GC.class_histogram <span class="token comment">#ç­‰åŒäºjmap -histo</span>jcmd <span class="token number">13508</span> GC.heap_dump d:<span class="token punctuation">\</span><span class="token number">1</span>.hprof <span class="token comment">#ç­‰åŒäºjmap -dump:live,format=b,file=&lt;filename.hprof> &lt;pid></span>jcmd <span class="token number">13508</span> VM.flags <span class="token comment">#ç­‰åŒäºjinfo -flags 23456</span>jcmd <span class="token number">13508</span> VM.command_line<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-Class-03-ç±»çš„åŠ è½½è¿‡ç¨‹è¯¦è§£</title>
      <link href="/2024/01/06/jvm-class3/"/>
      <url>/2024/01/06/jvm-class3/</url>
      
        <content type="html"><![CDATA[<h1>ç±»çš„åŠ è½½è¿‡ç¨‹è¯¦è§£</h1><h2 id="01-æ¦‚è¿°">01-æ¦‚è¿°</h2><p>åœ¨ Java ä¸­æ•°æ®ç±»å‹åˆ†ä¸ºåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ã€‚<strong>åŸºæœ¬æ•°æ®ç±»å‹ç”±è™šæ‹Ÿæœºé¢„å…ˆå®šä¹‰ï¼Œå¼•ç”¨æ•°æ®ç±»å‹åˆ™éœ€è¦è¿›è¡Œç±»çš„åŠ è½½ã€‚</strong></p><p>æŒ‰ç…§ Java è™šæ‹Ÿæœºè§„èŒƒï¼Œä» class æ–‡ä»¶åˆ°åŠ è½½åˆ°å†…å­˜ä¸­çš„ç±»ï¼Œåˆ°ç±»å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬å¦‚ä¸‹7ä¸ªé˜¶æ®µï¼š</p><p><img src="./../jvm-class3/image-20240106235908087.png" alt=""></p><p>å…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡ã€è§£æ3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºé“¾æ¥(Linking)</p><p>ä»ç¨‹åºä¸­ç±»çš„ä½¿ç”¨è¿‡ç¨‹çœ‹:</p><p><img src="./../jvm-class3/image-20240107000058146.png" alt=""></p><p><strong>é¢è¯•é¢˜</strong></p><ul><li>æè¿°ä»¥ä¸‹ JVM åŠ è½½ Class æ–‡ä»¶çš„åŸç†æœºåˆ¶</li><li>ç±»åŠ è½½è¿‡ç¨‹</li><li>åŠ è½½ç±»çš„æ—¶æœº</li></ul><h2 id="02-è¿‡ç¨‹ä¸€ï¼šLoadingï¼ˆåŠ è½½ï¼‰é˜¶æ®µ">02-è¿‡ç¨‹ä¸€ï¼šLoadingï¼ˆåŠ è½½ï¼‰é˜¶æ®µ</h2><h3 id="1-åŠ è½½å®Œæˆçš„æ“ä½œ">1-åŠ è½½å®Œæˆçš„æ“ä½œ</h3><p><strong>åŠ è½½çš„ç†è§£</strong></p><p>**æ‰€è°“åŠ è½½ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯å°† Java ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æœºå™¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ„å»ºå‡º Java ç±»çš„åŸå‹ä¸€ä¸€ç±»æ¨¡æ¿å¯¹è±¡ã€‚**æ‰€è°“ç±»æ¨¡æ¿å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ Java ç±»åœ¨VMå†…å­˜ä¸­çš„ä¸€ä¸ªå¿«ç…§ï¼ŒJVMå°†ä»å­—èŠ‚ç æ–‡ä»¶ä¸­è§£æå‡ºçš„å¸¸é‡æ± ã€ç±»å­—æ®µã€ç±»æ–¹æ³•ç­‰ä¿¡æ¯</p><p>å­˜å‚¨åˆ°ç±»æ¨¡æ¿ä¸­ï¼Œè¿™æ · JVM åœ¨è¿è¡ŒæœŸä¾¿èƒ½é€šè¿‡ç±»æ¨¡æ¿è€Œè·å– Java ç±»ä¸­çš„ä»»æ„ä¿¡æ¯ï¼Œèƒ½å¤Ÿå¯¹ Java ç±»çš„æˆå‘˜å˜é‡è¿›è¡Œéå†ï¼Œä¹Ÿèƒ½è¿›è¡Œ Java æ–¹æ³•çš„è°ƒç”¨ã€‚</p><p>åå°„çš„æœºåˆ¶å³åŸºäºè¿™ä¸€åŸºç¡€ã€‚å¦‚æœ JVM æ²¡æœ‰å°† Java ç±»çš„å£°æ˜ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œåˆ™ JVM åœ¨è¿è¡ŒæœŸä¹Ÿæ— æ³•åå°„ã€‚</p><p><strong>åŠ è½½å®Œæˆçš„æ“ä½œ</strong></p><p><strong>åŠ è½½é˜¶æ®µï¼Œç®€è¨€ä¹‹ï¼ŒæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç”Ÿæˆ Class çš„å®ä¾‹ã€‚</strong></p><p>åœ¨åŠ è½½ç±»æ—¶ï¼ŒJava è™šæ‹Ÿæœºå¿…é¡»å®Œæˆä»¥ä¸‹3ä»¶äº‹æƒ…ï¼š</p><ul><li>é€šè¿‡ç±»çš„å…¨åï¼Œè·å–ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµã€‚</li><li>è§£æç±»çš„äºŒè¿›åˆ¶æ•°æ®æµä¸ºæ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„( Java ç±»æ¨¡å‹)</li><li>åˆ›å»º java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè¯¥ç±»å‹ã€‚ä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li></ul><h3 id="2-äºŒè¿›åˆ¶æµçš„è·å–æ–¹å¼">2-äºŒè¿›åˆ¶æµçš„è·å–æ–¹å¼</h3><p>å¯¹äºç±»çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œè™šæ‹Ÿæœºå¯ä»¥é€šè¿‡å¤šç§é€”å¾„äº§ç”Ÿæˆ–è·å¾—ã€‚ï¼ˆåªè¦æ‰€è¯»å–çš„å­—èŠ‚ç ç¬¦åˆ JVM è§„èŒƒå³å¯ï¼‰</p><ul><li>è™šæ‹Ÿæœºå¯èƒ½é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè¯»å…¥ä¸€ä¸ª class åç¼€çš„æ–‡ä»¶ï¼ˆæœ€å¸¸è§ï¼‰</li><li>è¯»å…¥ jarã€zip ç­‰å½’æ¡£æ•°æ®åŒ…ï¼Œæå–ç±»æ–‡ä»¶ã€‚</li><li>äº‹å…ˆå­˜æ”¾åœ¨æ•°æ®åº“ä¸­çš„ç±»çš„äºŒè¿›åˆ¶æ•°æ®</li><li>ä½¿ç”¨ç±»ä¼¼äº HTTP ä¹‹ç±»çš„åè®®é€šè¿‡ç½‘ç»œè¿›è¡ŒåŠ è½½</li><li>åœ¨è¿è¡Œæ—¶ç”Ÿæˆä¸€æ®µ Class çš„äºŒè¿›åˆ¶ä¿¡æ¯ç­‰</li></ul><p>åœ¨è·å–åˆ°ç±»çš„äºŒè¿›åˆ¶ä¿¡æ¯åï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šå¤„ç†è¿™äº›æ•°æ®ï¼Œå¹¶æœ€ç»ˆè½¬ä¸ºä¸€ä¸ª java.lang.Classçš„å®ä¾‹ã€‚</p><p>å¦‚æœè¾“å…¥æ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼Œåˆ™ä¼šæŠ›å‡ºClassFormatErrorã€‚</p><h3 id="3-ç±»æ¨¡å‹ä¸Classå®ä¾‹çš„">3-ç±»æ¨¡å‹ä¸Classå®ä¾‹çš„</h3><p><strong>1ã€ç±»æ¨¡å‹çš„ä½ç½®</strong></p><p>åŠ è½½çš„ç±»åœ¨JVMä¸­åˆ›å»ºç›¸åº”çš„ç±»ç»“æ„ï¼Œç±»ç»“æ„ä¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆJDK1.8 ä¹‹å‰ï¼šæ°¸ä¹…ä»£ï¼›JDK1.8 åŠä¹‹åï¼šå…ƒç©ºé—´ï¼‰ã€‚<br><strong>2ã€Class å®ä¾‹çš„ä½ç½®</strong></p><p>ç±»å°† .class æ–‡ä»¶åŠ è½½è‡³å…ƒç©ºé—´åï¼Œä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ª Java.lang.Class å¯¹è±¡ï¼Œç”¨æ¥å°è£…ç±»ä½äºæ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼Œè¯¥<br>Class å¯¹è±¡æ˜¯åœ¨åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­åˆ›å»ºçš„ï¼Œæ¯ä¸ªç±»éƒ½å¯¹åº”æœ‰ä¸€ä¸ª Class ç±»å‹çš„å¯¹è±¡ã€‚(instancKass --&gt; mirror: Classçš„å®ä¾‹)</p><p><strong>3ã€å›¾ç¤º</strong></p><p><img src="./../jvm-class3/004.jpg" alt=""></p><p>å¤–éƒ¨å¯ä»¥é€šè¿‡è®¿é—®ä»£è¡¨ Order ç±»çš„ Class å¯¹è±¡æ¥è·å– Order çš„ç±»æ•°æ®ç»“æ„</p><p><strong>4ã€å†è¯´æ˜</strong></p><p>Class ç±»çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„, åªæœ‰ JVM èƒ½å¤Ÿåˆ›å»º</p><p>java.lang.Class å®ä¾‹è®¿é—®ç±»å‹å…ƒæ•°æ®çš„æ¥å£, ä¹Ÿæ˜¯å®ç°åå°„çš„å…³é”®æ•°æ®ã€å…¥å£. é€šè¿‡ Class ç±»æä¾›çš„æ¥å£, å¯ä»¥è·å–ç›®æ ‡ç±»æ‰€å…³è”çš„ .class æ–‡ä»¶ä¸­å…·ä½“çš„æ•°æ®ç»“æ„: æ–¹æ³•ã€å­—æ®µä¿¡æ¯ç­‰.</p><p><strong>é€šè¿‡Classç±», è·å¾—äº†java.lang.Stringç±»çš„æ‰€æœ‰æ–¹æ³•ä¿¡æ¯, å¹¶æ‰“å°æ–¹æ³•è®¿é—®æ ‡è¯†ç¬¦ã€æè¿°ç¬¦</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoadingTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.String"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//è·å–å½“å‰è¿è¡Œæ—¶ç±»å£°æ˜çš„æ‰€æœ‰æ–¹æ³•</span>            <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ms <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> m <span class="token operator">:</span> ms<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//è·å–æ–¹æ³•çš„ä¿®é¥°ç¬¦</span>                <span class="token class-name">String</span> mod <span class="token operator">=</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>mod <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è·å–æ–¹æ³•çš„è¿”å›å€¼ç±»å‹</span>                <span class="token class-name">String</span> returnType <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>returnType <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è·å–æ–¹æ³•å</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è·å–æ–¹æ³•çš„å‚æ•°åˆ—è¡¨</span>                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ps <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>ps<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">char</span> end <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> ps<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">')'</span> <span class="token operator">:</span> <span class="token char">','</span><span class="token punctuation">;</span>                    <span class="token comment">//è·å–å‚æ•°ç±»å‹</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-æ•°ç»„ç±»çš„åŠ è½½">4-æ•°ç»„ç±»çš„åŠ è½½</h3><p>åˆ›å»ºæ•°ç»„ç±»çš„æƒ…å†µç¨å¾®æœ‰äº›ç‰¹æ®Šï¼Œ<strong>å› ä¸ºæ•°ç»„ç±»æœ¬èº«å¹¶ä¸æ˜¯ç”±ç±»åŠ è½½å™¨è´Ÿè´£åˆ›å»º</strong>ï¼Œè€Œæ˜¯ç”± JVM åœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦è€Œç›´æ¥åˆ›å»ºçš„ï¼Œä½†æ•°ç»„çš„å…ƒç´ ç±»å‹ä»ç„¶éœ€è¦ä¾é ç±»åŠ è½½å™¨å»åˆ›å»ºã€‚åˆ›å»ºæ•°ç»„ç±»ï¼ˆä¸‹è¿°ç®€ç§°Aï¼‰çš„è¿‡ç¨‹ï¼š</p><ol><li>å¦‚æœæ•°ç»„çš„å…ƒç´ ç±»å‹æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆå°±éµå¾ªå®šä¹‰çš„åŠ è½½è¿‡ç¨‹é€’å½’åŠ è½½å’Œåˆ›å»ºæ•°ç»„ A çš„å…ƒç´ ç±»å‹</li><li>JVM ä½¿ç”¨æŒ‡å®šçš„å…ƒç´ ç±»å‹å’Œæ•°ç»„ç»´åº¦æ¥åˆ›å»ºæ–°çš„æ•°ç»„ç±»</li></ol><p>å¦‚æœæ•°ç»„çš„å…ƒç´ ç±»å‹æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ•°ç»„ç±»çš„å¯è®¿é—®æ€§å°±ç”±å…ƒç´ ç±»å‹çš„å¯è®¿é—®æ€§å†³å®šã€‚å¦åˆ™æ•°ç»„ç±»çš„å¯è®¿é—®æ€§å°†è¢«ç¼ºçœå®šä¹‰ä¸º publicã€‚</p><h2 id="03-è¿‡ç¨‹äºŒï¼šLinkingï¼ˆé“¾æ¥ï¼‰é˜¶æ®µ">03-è¿‡ç¨‹äºŒï¼šLinkingï¼ˆé“¾æ¥ï¼‰é˜¶æ®µ</h2><h3 id="1-ç¯èŠ‚1ï¼šé“¾æ¥é˜¶æ®µä¹‹Verificationï¼ˆéªŒè¯ï¼‰">1-ç¯èŠ‚1ï¼šé“¾æ¥é˜¶æ®µä¹‹Verificationï¼ˆéªŒè¯ï¼‰</h3><p><strong>éªŒè¯é˜¶æ®µ(Verification)</strong></p><ul><li><p>å½“ç±»åŠ è½½åˆ°ç³»ç»Ÿåï¼Œå°±å¼€å§‹é“¾æ¥æ“ä½œï¼ŒéªŒè¯æ˜¯é“¾æ¥æ“ä½œçš„ç¬¬ä¸€æ­¥ã€‚</p></li><li><p><strong>å®ƒçš„ç›®çš„æ˜¯ä¿è¯åŠ è½½çš„å­—èŠ‚ç æ˜¯åˆæ³•ã€åˆç†å¹¶ç¬¦åˆè§„èŒƒçš„ã€‚</strong></p></li></ul><p>éªŒè¯çš„æ­¥éª¤æ¯”è¾ƒå¤æ‚, å®é™…éœ€è¦éªŒè¯çš„é¡¹ç›®ä¹Ÿå¾ˆç¹å¤š, å¤§ä½“ä¸Š Java è™šæ‹Ÿæœºéœ€è¦åšä»¥ä¸‹æ£€æŸ¥, å¦‚å›¾æ‰€ç¤º:</p><p><img src="./../jvm-class3/image-20240107101652172.png" alt=""></p><p><strong>æ•´ä½“è¯´æ˜ï¼š</strong></p><p>éªŒè¯çš„å†…å®¹åˆ™æ¶µç›–äº†ç±»æ•°æ®ä¿¡æ¯çš„æ ¼å¼éªŒè¯ã€è¯­ä¹‰æ£€æŸ¥ã€å­—èŠ‚ç éªŒè¯ï¼Œä»¥åŠç¬¦å·å¼•ç”¨éªŒè¯ç­‰ã€‚</p><ul><li>å…¶ä¸­<strong>æ ¼å¼éªŒè¯ä¼šå’ŒåŠ è½½é˜¶æ®µä¸€èµ·æ‰§è¡Œ</strong>ã€‚éªŒè¯é€šè¿‡ä¹‹åï¼Œç±»åŠ è½½å™¨æ‰ä¼šæˆåŠŸå°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®ä¿¡æ¯åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ã€‚</li><li><strong>æ ¼å¼éªŒè¯ä¹‹å¤–çš„éªŒè¯æ“ä½œå°†ä¼šåœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œã€‚</strong></li></ul><p>é“¾æ¥é˜¶æ®µçš„éªŒè¯è™½ç„¶æ‹–æ…¢äº†åŠ è½½é€Ÿåº¦ï¼Œä½†æ˜¯å®ƒé¿å…äº†åœ¨å­—èŠ‚ç è¿è¡Œæ—¶è¿˜éœ€è¦è¿›è¡Œå„ç§æ£€æŸ¥ã€‚ï¼ˆç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼‰</p><p><strong>å…·ä½“è¯´æ˜ï¼š</strong></p><ol><li><p>æ ¼å¼éªŒè¯ï¼šæ˜¯å¦ä»¥é­”æ•° 0xCAFEBABE å¼€å¤´ï¼Œä¸»ç‰ˆæœ¬å’Œå‰¯ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰ Java è™šæ‹Ÿæœºçš„æ”¯æŒèŒƒå›´å†…ï¼Œæ•°æ®ä¸­æ¯ä¸€ä¸ªé¡¹æ˜¯å¦éƒ½<br>æ‹¥æœ‰æ­£ç¡®çš„é•¿åº¦ç­‰ã€‚</p></li><li><p>Java è™šæ‹Ÿæœºä¼šè¿›è¡Œå­—èŠ‚ç çš„è¯­ä¹‰æ£€æŸ¥ï¼Œä½†å‡¡åœ¨è¯­ä¹‰ä¸Šä¸ç¬¦åˆè§„èŒƒçš„ï¼Œè™šæ‹Ÿæœºä¹Ÿä¸ä¼šç»™äºˆéªŒè¯é€šè¿‡ã€‚æ¯”å¦‚ï¼š</p><ul><li>æ˜¯å¦æ‰€æœ‰çš„ç±»éƒ½æœ‰çˆ¶ç±»çš„å­˜åœ¨ï¼ˆåœ¨ Java é‡Œï¼Œé™¤äº† Object å¤–ï¼Œå…¶ä»–ç±»éƒ½åº”è¯¥æœ‰çˆ¶ç±»ï¼‰</li><li>æ˜¯å¦ä¸€äº›è¢«å®šä¹‰ä¸º final çš„æ–¹æ³•æˆ–è€…ç±»è¢«é‡å†™æˆ–ç»§æ‰¿äº†</li><li>éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•æˆ–è€…æ¥å£æ–¹æ³•</li><li>æ˜¯å¦å­˜åœ¨ä¸å…¼å®¹çš„æ–¹æ³•ï¼ˆæ¯”å¦‚æ–¹æ³•çš„ç­¾åé™¤äº†è¿”å›å€¼ä¸åŒï¼Œå…¶ä»–éƒ½ä¸€æ ·ï¼Œè¿™ç§æ–¹æ³•ä¼šè®©è™šæ‹Ÿæœºæ— ä»ä¸‹æ‰‹è°ƒåº¦ï¼›abstract æƒ…å†µä¸‹çš„æ–¹æ³•ï¼Œå°±ä¸èƒ½æ˜¯ final çš„äº†)</li></ul></li><li><p>Java è™šæ‹Ÿæœºè¿˜ä¼š<strong>è¿›è¡Œå­—èŠ‚ç éªŒè¯</strong>ï¼Œå­—èŠ‚ç éªŒè¯<strong>ä¹Ÿæ˜¯éªŒè¯è¿‡ç¨‹ä¸­æœ€ä¸ºå¤æ‚çš„ä¸€ä¸ªè¿‡ç¨‹</strong>ã€‚å®ƒè¯•å›¾é€šè¿‡å¯¹å­—èŠ‚ç æµçš„åˆ†æï¼Œåˆ¤æ–­å­—èŠ‚ç æ˜¯å¦å¯ä»¥è¢«æ­£ç¡®åœ°æ‰§è¡Œã€‚æ¯”å¦‚ï¼š</p><ul><li>åœ¨å­—èŠ‚ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦ä¼šè·³è½¬åˆ°ä¸€æ¡ä¸å­˜åœ¨çš„æŒ‡ä»¤</li><li>å‡½æ•°çš„è°ƒç”¨æ˜¯å¦ä¼ é€’äº†æ­£ç¡®ç±»å‹çš„å‚æ•°</li><li>å˜é‡çš„èµ‹å€¼æ˜¯ä¸æ˜¯ç»™äº†æ­£ç¡®çš„æ•°æ®ç±»å‹ç­‰</li></ul><p>æ ˆæ˜ å°„å¸§( StackMapTable )å°±æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç”¨äºæ£€æµ‹åœ¨ç‰¹å®šçš„å­—èŠ‚ç å¤„ï¼Œå…¶å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆæ˜¯å¦æœ‰ç€æ­£ç¡®çš„æ•°æ®ç±»å‹ã€‚ä½†é—æ†¾çš„æ˜¯ï¼Œ100% å‡†ç¡®åœ°åˆ¤æ–­ä¸€æ®µå­—èŠ‚ç æ˜¯å¦å¯ä»¥è¢«å®‰å…¨æ‰§è¡Œæ˜¯æ— æ³•å®ç°çš„ï¼Œå› æ­¤ï¼Œè¯¥è¿‡ç¨‹åªæ˜¯å°½å¯èƒ½åœ°æ£€æŸ¥å‡ºå¯ä»¥é¢„çŸ¥çš„æ˜æ˜¾çš„é—®é¢˜ã€‚å¦‚æœåœ¨è¿™ä¸ªé˜¶æ®µæ— æ³•é€šè¿‡æ£€æŸ¥ï¼Œè™šæ‹Ÿæœºä¹Ÿä¸ä¼šæ­£ç¡®è£…è½½è¿™ä¸ªç±»ã€‚ä½†æ˜¯ï¼Œå¦‚æœé€šè¿‡äº†è¿™ä¸ªé˜¶æ®µçš„æ£€æŸ¥ï¼Œä¹Ÿä¸èƒ½è¯´æ˜è¿™ä¸ªç±»æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p></li></ol><p>â€‹<strong>åœ¨å‰é¢3æ¬¡æ£€æŸ¥ä¸­ï¼Œå·²ç»æ’é™¤äº†æ–‡ä»¶æ ¼å¼é”™è¯¯ã€è¯­ä¹‰é”™è¯¯ä»¥åŠå­—èŠ‚ç çš„ä¸æ­£ç¡®æ€§ã€‚ä½†æ˜¯ä¾ç„¶ä¸èƒ½ç¡®ä¿ç±»æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</strong></p><ol start="4"><li><p>æ ¡éªŒå™¨è¿˜å°†è¿›è¡Œ<strong>ç¬¦å·å¼•ç”¨çš„éªŒè¯</strong>ã€‚Class æ–‡ä»¶åœ¨å…¶å¸¸é‡æ± ä¼šé€šè¿‡å­—ç¬¦ä¸²è®°å½•è‡ªå·±å°†è¦ä½¿ç”¨çš„å…¶ä»–ç±»æˆ–è€…æ–¹æ³•ã€‚å› æ­¤ï¼Œåœ¨éªŒè¯é˜¶æ®µï¼Œ<strong>è™šæ‹Ÿæœºå°±ä¼šæ£€æŸ¥è¿™äº›ç±»æˆ–è€…æ–¹æ³•ç¡®å®æ˜¯å­˜åœ¨çš„</strong>ï¼Œå¹¶ä¸”å½“å‰ç±»æœ‰æƒé™è®¿é—®è¿™äº›æ•°æ®ï¼Œå¦‚æœä¸€ä¸ªéœ€è¦ä½¿ç”¨ç±»æ— æ³•åœ¨ç³»ç»Ÿä¸­æ‰¾åˆ°ï¼Œåˆ™ä¼šæŠ›å‡º NoClassDefFoundErrorï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æ— æ³•è¢«æ‰¾åˆ°ï¼Œåˆ™ä¼šæŠ›å‡º NoSuchMethodErrorã€‚</p><p>æ­¤é˜¶æ®µåœ¨è§£æç¯èŠ‚æ‰ä¼šæ‰§è¡Œã€‚</p></li></ol><h3 id="2-ç¯èŠ‚2ï¼šé“¾æ¥é˜¶æ®µä¹‹Preparationï¼ˆå‡†å¤‡ï¼‰">2-ç¯èŠ‚2ï¼šé“¾æ¥é˜¶æ®µä¹‹Preparationï¼ˆå‡†å¤‡ï¼‰</h3><h3 id="3-ç¯èŠ‚3ï¼šé“¾æ¥é˜¶æ®µä¹‹Resolutionï¼ˆè§£æï¼‰">3-ç¯èŠ‚3ï¼šé“¾æ¥é˜¶æ®µä¹‹Resolutionï¼ˆè§£æï¼‰</h3><h2 id="04-è¿‡ç¨‹ä¸‰ï¼šInitializationï¼ˆåˆå§‹åŒ–ï¼‰é˜¶æ®µ">04-è¿‡ç¨‹ä¸‰ï¼šInitializationï¼ˆåˆå§‹åŒ–ï¼‰é˜¶æ®µ</h2><h2 id="05-è¿‡ç¨‹å››ï¼šç±»çš„Usingï¼ˆä½¿ç”¨ï¼‰">05-è¿‡ç¨‹å››ï¼šç±»çš„Usingï¼ˆä½¿ç”¨ï¼‰</h2><h2 id="06-è¿‡ç¨‹äº”ï¼šç±»çš„Unloadingï¼ˆå¸è½½ï¼‰">06-è¿‡ç¨‹äº”ï¼šç±»çš„Unloadingï¼ˆå¸è½½ï¼‰</h2>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-Class-02-å­—èŠ‚ç æŒ‡ä»¤é›†ä¸è§£æä¸¾ä¾‹</title>
      <link href="/2024/01/05/jvm-class2/"/>
      <url>/2024/01/05/jvm-class2/</url>
      
        <content type="html"><![CDATA[<h1>å­—èŠ‚ç æŒ‡ä»¤é›†ä¸è§£æä¸¾ä¾‹</h1><h2 id="01-æ¦‚è¿°">01-æ¦‚è¿°</h2><ul><li>Java å­—èŠ‚ç å¯¹äºè™šæ‹Ÿæœºï¼Œå°±å¥½åƒæ±‡ç¼–è¯­è¨€å¯¹äºè®¡ç®—æœºï¼Œå±äºåŸºæœ¬æ‰§è¡ŒæŒ‡ä»¤ã€‚</li><li>Java è™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±<strong>ä¸€ä¸ªå­—èŠ‚é•¿åº¦</strong>çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ•°å­—ï¼ˆç§°ä¸ºæ“ä½œç ï¼ŒOpcode)ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•°ï¼ˆç§°ä¸ºæ“ä½œæ•°ï¼ŒOperands)è€Œæ„æˆã€‚ç”±äºJavaè™šæ‹Ÿæœºé‡‡ç”¨é¢å‘æ“ä½œæ•°æ ˆè€Œä¸æ˜¯å¯„å­˜å™¨çš„ç»“æ„ï¼Œæ‰€ä»¥å¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½ä¸åŒ…å«æ“ä½œæ•°ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œç ã€‚</li><li>ç”±äºé™åˆ¶äº† Java è™šæ‹Ÿæœºæ“ä½œç çš„é•¿åº¦ä¸ºä¸€ä¸ªå­—èŠ‚ï¼ˆå³0~255ï¼‰ï¼Œè¿™æ„å‘³ç€æŒ‡ä»¤é›†çš„æ“ä½œç æ€»æ•°ä¸å¯èƒ½è¶…è¿‡ 256 æ¡ã€‚</li><li>å®˜æ–¹æ–‡æ¡£ï¼šhttps:/docs.oracle.com/javase./specs/jvms/se8/html/jvms-6.html</li><li>ç†Ÿæ‚‰è™šæ‹Ÿæœºçš„æŒ‡ä»¤å¯¹äºåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆã€åç¼–è¯‘ Class æ–‡ä»¶ã€Classæ–‡ä»¶ä¿®è¡¥éƒ½æœ‰ç€éå¸¸é‡è¦çš„ä»·å€¼ã€‚å› æ­¤ï¼Œé˜…è¯»å­—èŠ‚ç ä½œä¸ºäº†è§£ Java è™šæ‹Ÿæœºçš„åŸºç¡€æŠ€èƒ½ï¼Œéœ€è¦ç†Ÿç»ƒæŒæ¡å¸¸è§æŒ‡ä»¤ã€‚</li></ul><p><strong>æ‰§è¡Œæ¨¡å‹</strong></p><p>å¦‚æœä¸è€ƒè™‘å¼‚å¸¸å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆJavaè™šæ‹Ÿæœºçš„è§£é‡Šå™¨å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªä¼ªä»£ç å½“åšæœ€åŸºæœ¬çš„æ‰§è¡Œæ¨¡å‹æ¥ç†è§£</p><pre class="line-numbers language-null" data-language="null"><code class="language-null">do&#123;    è‡ªåŠ¨è®¡ç®—PCå¯„å­˜å™¨çš„å€¼åŠ 1;    æ ¹æ®PCå¯„å­˜å™¨çš„æŒ‡ç¤ºä½ç½®ï¼Œä»å­—èŠ‚ç æµä¸­å–å‡ºæ“ä½œç ;    if(å­—èŠ‚ç å­˜åœ¨æ“ä½œæ•°)ä»å­—èŠ‚ç æµä¸­å–å‡ºæ“ä½œæ•°;    æ‰§è¡Œæ“ä½œç æ‰€å®šä¹‰çš„æ“ä½œ;&#125; while (å­—èŠ‚ç é•¿åº¦ &gt; 0);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å­—èŠ‚ç äºæ•°æ®ç±»å‹</strong></p><p>åœ¨ Java è™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†ä¸­ï¼Œå¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½åŒ…å«äº†å…¶æ“ä½œæ‰€å¯¹åº”çš„æ•°æ®ç±»å‹ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œiload æŒ‡ä»¤ç”¨äºä»å±€éƒ¨å˜é‡è¡¨ä¸­åŠ è½½ int å‹çš„æ•°æ®åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œè€Œ fload æŒ‡ä»¤åŠ è½½çš„åˆ™æ˜¯ float ç±»å‹çš„æ•°æ®ã€‚</p><p>å¯¹äºå¤§éƒ¨åˆ†ä¸æ•°æ®ç±»å‹ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œ<strong>å®ƒä»¬çš„æ“ä½œç åŠ©è®°ç¬¦ä¸­éƒ½æœ‰ç‰¹æ®Šçš„å­—ç¬¦æ¥è¡¨æ˜ä¸“é—¨ä¸ºå“ªç§æ•°æ®ç±»å‹æœåŠ¡</strong>ï¼š</p><ul><li>i ä»£è¡¨å¯¹ intç±»å‹çš„æ•°æ®æ“ä½œï¼Œ</li><li>l ä»£è¡¨ long</li><li>sä»£è¡¨ short</li><li>b ä»£è¡¨ byte</li><li>c ä»£è¡¨ char</li><li>f ä»£è¡¨ float</li><li>d ä»£è¡¨ double</li></ul><p>ä¹Ÿæœ‰ä¸€äº›æŒ‡ä»¤çš„åŠ©è®°ç¬¦ä¸­æ²¡æœ‰æ˜ç¡®åœ°æŒ‡æ˜æ“ä½œç±»å‹çš„å­—æ¯ï¼Œå¦‚ arraylength æŒ‡ä»¤ï¼Œå®ƒæ²¡æœ‰ä»£è¡¨æ•°æ®ç±»å‹çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä½†æ“ä½œæ•°æ°¸è¿œåªèƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å¯¹è±¡ã€‚</p><p>è¿˜æœ‰å¦å¤–ä¸€äº›æŒ‡ä»¤ï¼Œå¦‚æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ goto åˆ™æ˜¯ä¸<strong>æ•°æ®ç±»å‹æ— å…³çš„</strong>ã€‚</p><p>å¤§éƒ¨åˆ†çš„æŒ‡ä»¤éƒ½æ²¡æœ‰æ”¯æŒæ•´æ•°ç±»å‹ byteã€char å’Œ shortï¼Œç”šè‡³æ²¡æœ‰ä»»ä½•æŒ‡ä»¤æ”¯æŒbooleanç±»å‹ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæˆ–è¿è¡ŒæœŸå°† byte å’Œ short ç±»å‹çš„æ•°æ®å¸¦ç¬¦å·æ‰©å±• (Sign-Extend) ä¸ºç›¸åº”çš„ int ç±»å‹æ•°æ®ï¼Œå°† boolean å’Œ char ç±»å‹æ•°æ®é›¶ä½æ‰©å±• (Zero-Extend) ä¸ºç›¸åº”çš„ int ç±»å‹æ•°æ®ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œåœ¨å¤„ç† booleanã€byteã€short å’Œ char ç±»å‹çš„æ•°ç»„æ—¶ï¼Œä¹Ÿä¼šè½¬æ¢ä¸ºä½¿ç”¨å¯¹åº”çš„ int ç±»å‹çš„å­—èŠ‚ç æŒ‡ä»¤æ¥å¤„ç†ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°å¯¹äº booleanã€byteã€short å’Œ char ç±»å‹æ•°æ®çš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä½¿ç”¨ç›¸åº”çš„ int ç±»å‹ä½œä¸ºè¿ç®—ç±»å‹ã€‚</p><h3 id="æŒ‡ä»¤åˆ†ç±»">æŒ‡ä»¤åˆ†ç±»</h3><ul><li>ç”±äºå®Œå…¨ä»‹ç»å’Œå­¦ä¹ è¿™äº›æŒ‡ä»¤éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ä¸ºäº†è®©å¤§å®¶èƒ½æ›´å¿«åœ°ç†Ÿæ‚‰å’Œäº†è§£è¿™äº›åŸºæœ¬æŒ‡ä»¤ï¼Œè¿™é‡Œå°†JVMä¸­çš„å­—èŠ‚ç æŒ‡ä»¤é›†æŒ‰ç”¨é€”å¤§è‡´åˆ†æˆ9ç±»ã€‚<ul><li>åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</li><li>ç®—æœ¯æŒ‡ä»¤</li><li>ç±»å‹è½¬æ¢æŒ‡ä»¤</li><li>å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</li><li>æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</li><li>æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</li><li>æ¯”è¾ƒæ§åˆ¶æŒ‡ä»¤</li><li>å¼‚å¸¸å¤„ç†æŒ‡ä»¤</li><li>åŒæ­¥æ§åˆ¶æŒ‡ä»¤</li></ul></li><li>(è¯´åœ¨å‰é¢) åœ¨åšå€¼ç›¸å…³æ“ä½œæ—¶ï¼š<ul><li>ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥ä»å±€éƒ¨å˜é‡è¡¨ã€å¸¸é‡æ± ã€å †ä¸­å¯¹è±¡ã€æ–¹æ³•è°ƒç”¨ã€ç³»ç»Ÿè°ƒç”¨ä¸­ç­‰å–å¾—æ•°æ®ï¼Œè¿™äº›æ•°æ®ï¼ˆå¯èƒ½æ˜¯å€¼ï¼Œå¯èƒ½æ˜¯å¯¹è±¡çš„å¼•ç”¨)è¢«å‹å…¥æ“ä½œæ•°æ ˆã€‚</li><li>ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥ä»æ“ä½œæ•°æ ˆä¸­å–å‡ºä¸€åˆ°å¤šä¸ªå€¼( pop å¤šæ¬¡)ï¼Œå®Œæˆèµ‹å€¼ã€åŠ å‡ä¹˜é™¤ã€æ–¹æ³•ä¼ å‚ã€ç³»ç»Ÿè°ƒç”¨ç­‰ç­‰æ“ä½œã€‚</li></ul></li></ul><h2 id="02-åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤">02-åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</h2><p><strong>ä½œç”¨</strong></p><p>åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤ç”¨äºå°†æ•°æ®ä»æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆä¹‹é—´æ¥å›ä¼ é€’ã€‚</p><p><strong>å¸¸ç”¨æŒ‡ä»¤</strong></p><pre class="line-numbers language-null" data-language="null"><code class="language-null">1ã€ã€å±€å˜é‡å‹æ ˆæŒ‡ä»¤ã€‘å°†ä¸€ä¸ªå±€éƒ¨å˜é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼šxloadã€xload&lt;n&gt;(å…¶ä¸­xä¸ºiã€lã€fã€dã€aï¼Œn ä¸º 0 åˆ° 3)------------------------------------------------------------------------------2ã€ã€å¸¸é‡å…¥æ ˆæŒ‡ä»¤ã€‘å°†ä¸€ä¸ªå¸¸é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼šbipushã€sipushã€ldcã€ldc_wã€ldc2_wã€aconst_nullã€iconst_mlã€iconst&lt;i&gt;ã€lconst_&lt;l&gt;ã€fconst_&lt;f&gt;ã€dconst&lt;d&gt;-------------------------------------------------------------------------------3ã€ã€å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤ã€‘å°†ä¸€ä¸ªæ•°å€¼ä»æ“ä½œæ•°æ ˆå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ï¼šxstoreã€xstore_&lt;n&gt;ï¼ˆå…¶ä¸­ x ä¸º iã€lã€fã€dã€aï¼Œn ä¸º g åˆ°3)ï¼›xastore(å…¶ä¸­ x ä¸º iã€lã€fã€dã€aã€bã€cã€s)--------------------------------------------------------------------------------4ã€æ‰©å……å±€éƒ¨å˜é‡è¡¨çš„è®¿é—®ç´¢å¼•çš„æŒ‡ä»¤ï¼šwideã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢æ‰€åˆ—ä¸¾çš„æŒ‡ä»¤åŠ©è®°ç¬¦ä¸­ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯ä»¥å°–æ‹¬å·ç»“å°¾çš„ï¼ˆä¾‹å¦‚ <code>iload_&lt;n&gt;</code> )ã€‚è¿™äº›æŒ‡ä»¤åŠ©è®°ç¬¦å®é™…ä¸Šä»£è¡¨äº†ä¸€ç»„æŒ‡ä»¤(ä¾‹å¦‚ <code>iload&lt;n&gt;</code> ä»£è¡¨äº† <code>iload_0</code> ã€<code>iload_1</code>ã€<code>iload_2</code> å’Œ <code>iload_3</code> è¿™å‡ ä¸ªæŒ‡ä»¤)ã€‚è¿™å‡ ç»„æŒ‡ä»¤éƒ½æ˜¯æŸä¸ªå¸¦æœ‰ä¸€ä¸ªæ“ä½œæ•°çš„é€šç”¨æŒ‡ä»¤ï¼ˆä¾‹å¦‚ <code>iload</code> )çš„ç‰¹æ®Šå½¢å¼ï¼Œ<strong>å¯¹äºè¿™è‹¥å¹²ç»„ç‰¹æ®ŠæŒ‡ä»¤æ¥è¯´ï¼Œå®ƒä»¬è¡¨é¢ä¸Šæ²¡æœ‰æ“ä½œæ•°ï¼Œä¸éœ€è¦è¿›è¡Œå–æ“ä½œæ•°çš„åŠ¨ä½œï¼Œä½†æ“ä½œæ•°éƒ½éšå«åœ¨æŒ‡ä»¤ä¸­ã€‚</strong></p><blockquote><p>æ¯”å¦‚:</p><p>iload_0: å°†å±€éƒ¨å˜é‡è¡¨ä¸­ç´¢å¼•ä¸º0ä½ç½®ä¸Šçš„æ•°æ®å‹å…¥æ“ä½œæ•°æ ˆä¸­ã€‚</p><p>iload 0: ä¸ä¸Šæ¡ä¸€æ ·ã€‚</p><p>iload 4: å°†å±€éƒ¨å˜é‡è¡¨ä¸­ç´¢å¼•ä¸º4ä½ç½®ä¸Šçš„æ•°æ®å‹å…¥æ“ä½œæ•°æ ˆä¸­ã€‚</p></blockquote><p>é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬çš„è¯­ä¹‰ä¸åŸç”Ÿçš„é€šç”¨æŒ‡ä»¤å®Œå…¨ä¸€è‡´ï¼ˆä¾‹å¦‚ <code>iload_0</code> çš„è¯­ä¹‰ä¸æ“ä½œæ•°ä¸º 0 æ—¶çš„ <code>iload</code> æŒ‡ä»¤è¯­ä¹‰å®Œå…¨ä¸€è‡´)ã€‚åœ¨å°–æ‹¬å·ä¹‹é—´çš„å­—æ¯æŒ‡å®šäº†æŒ‡ä»¤éšå«æ“ä½œæ•°çš„æ•°æ®ç±»å‹ï¼Œ<code>&lt;n&gt;</code> ä»£è¡¨éè´Ÿçš„æ•´æ•°ï¼Œ<code>&lt;i&gt;</code> ä»£è¡¨æ˜¯ int ç±»å‹æ•°æ®ï¼Œ<code>&lt;l&gt;</code> ä»£è¡¨ long ç±»å‹ï¼Œ<code>&lt;f&gt;</code>ä»£è¡¨ float ç±»å‹ï¼Œ <code>&lt;d&gt;</code> ä»£è¡¨ double ç±»å‹ã€‚æ“ä½œ byte, char, short å’Œ boolean ç±»å‹æ•°æ®æ—¶, ç»å¸¸ç”¨ int ç±»å‹çš„æŒ‡ä»¤æ¥è¡¨ç¤ºã€‚</p><h3 id="å¤ä¹ -å†è°ˆæ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨">å¤ä¹ : å†è°ˆæ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨</h3><p><strong>æ“ä½œæ•°æ ˆ(Operand Stacks)</strong></p><ul><li>æˆ‘ä»¬çŸ¥é“ï¼ŒJava å­—èŠ‚ç æ˜¯ Java è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„æŒ‡ä»¤é›†ã€‚å› æ­¤ï¼Œå®ƒä¸ Java è™šæ‹ŸæœºåŸºäºæ ˆçš„è®¡ç®—æ¨¡å‹æ˜¯å¯†ä¸å¯åˆ†çš„ã€‚</li><li>åœ¨è§£é‡Šæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯å½“ä¸º Java æ–¹æ³•åˆ†é…æ ˆæ¡¢æ—¶ï¼ŒJava è™šæ‹Ÿæœºå¾€å¾€éœ€è¦å¼€è¾Ÿä¸€å—é¢å¤–çš„ç©ºé—´ä½œä¸º<strong>æ“ä½œæ•°æ ˆï¼Œæ¥å­˜æ”¾è®¡ç®—çš„æ“ä½œæ•°ä»¥åŠè¿”å›ç»“æœã€‚</strong></li><li>å…·ä½“æ¥è¯´ä¾¿æ˜¯ï¼šæ‰§è¡Œæ¯ä¸€æ¡æŒ‡ä»¤ä¹‹å‰ï¼ŒJava è™šæ‹Ÿæœºè¦æ±‚è¯¥æŒ‡ä»¤çš„æ“ä½œæ•°å·²è¢«å‹å…¥æ“ä½œæ•°æ ˆä¸­ã€‚åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šå°†è¯¥æŒ‡ä»¤æ‰€éœ€çš„æ“ä½œæ•°å¼¹å‡ºï¼Œå¹¶ä¸”å°†æŒ‡ä»¤çš„ç»“æœé‡æ–°å‹å…¥æ ˆä¸­ã€‚</li></ul><p><img src="./../jvm-class2/image-20240106092421015.png" alt=""></p><blockquote><p>ä»¥åŠ æ³•æŒ‡ä»¤ <code>iadd</code> ä¸ºä¾‹:</p><p>å‡è®¾åœ¨æ‰§è¡Œè¯¥æŒ‡ä»¤å‰, æ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ åˆ†åˆ«ä¸º int å€¼ 1 å’Œ int å€¼ 2, é‚£ä¹ˆ <code>iadd</code> æŒ‡ä»¤å°†å¼¹å‡ºè¿™ä¸¤ä¸ª int, å¹¶å°†æ±‚å¾—çš„å’Œ int å€¼ 3 å‹å…¥æ ˆä¸­</p></blockquote><p><img src="./../jvm-class2/image-20240106092608805.png" alt=""></p><blockquote><p>ç”±äºiadd æŒ‡ä»¤åªæ¶ˆè€—æ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå› æ­¤ï¼Œå¯¹äºç¦»æ ˆé¡¶è·ç¦»ä¸º2çš„å…ƒç´ ï¼Œå³å›¾ä¸­çš„é—®å·ï¼Œiadd æŒ‡ä»¤å¹¶ä¸å…³å¿ƒå®ƒæ˜¯å¦å­˜åœ¨ï¼Œæ›´åŠ ä¸ä¼šå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p></blockquote><p><strong>å±€éƒ¨å˜é‡è¡¨(Local Variables)</strong></p><ul><li>Java æ–¹æ³•æ ˆæ¡¢çš„å¦å¤–ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†åˆ™æ˜¯å±€éƒ¨å˜é‡åŒºï¼Œ<strong>å­—èŠ‚ç ç¨‹åºå¯ä»¥å°†è®¡ç®—çš„ç»“æœç¼“å­˜åœ¨å±€éƒ¨å˜é‡åŒºä¹‹ä¸­</strong>ã€‚</li><li>å®é™…ä¸Šï¼ŒJava è™šæ‹Ÿæœºå°†å±€éƒ¨å˜é‡åŒº<strong>å½“æˆä¸€ä¸ªæ•°ç»„</strong>ï¼Œä¾æ¬¡å­˜æ”¾ this æŒ‡é’ˆï¼ˆä»…éé™æ€æ–¹æ³•ï¼‰ï¼Œæ‰€ä¼ å…¥çš„å‚æ•°ï¼Œä»¥åŠå­—èŠ‚ç ä¸­çš„å±€éƒ¨å˜é‡ã€‚</li><li>å’Œæ“ä½œæ•°æ ˆä¸€æ ·ï¼Œlong ç±»å‹ä»¥åŠ double ç±»å‹çš„å€¼å°†å æ®ä¸¤ä¸ªå•å…ƒï¼Œå…¶ä½™ç±»å‹ä»…å æ®ä¸€ä¸ªå•å…ƒã€‚</li></ul><img src="./../jvm-class2/image-20240106093239190.png" style="zoom:67%;" /><p>ä¸¾ä¾‹:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">,</span> <span class="token keyword">float</span> f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106093419431.png" alt="å¯¹åº”å›¾ç¤º"></p><blockquote><p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å±€éƒ¨å˜é‡è¡¨ã€‚å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p><p>åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p></blockquote><h3 id="1-å±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤">1-å±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤</h3><ul><li><p>å±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤å°†ç»™å®šçš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ•°æ®å‹å…¥æ“ä½œæ•°æ ˆã€‚</p></li><li><p>è¿™ç±»æŒ‡ä»¤å¤§ä½“å¯ä»¥åˆ†ä¸ºï¼š</p></li></ul><blockquote><p><code>xload_&lt;n&gt;</code> (x ä¸º iã€lã€fã€dã€aï¼Œn ä¸º 0 åˆ° 3)<br><code>xload</code> (x ä¸º iã€lã€fã€dã€a)</p></blockquote><blockquote><p>è¯´æ˜ï¼šåœ¨è¿™é‡Œï¼Œx çš„å–å€¼è¡¨ç¤ºæ•°æ®ç±»å‹ã€‚</p><p>æŒ‡ä»¤ <code>xload_n</code> è¡¨ç¤ºå°†ç¬¬ n ä¸ªå±€éƒ¨å˜é‡å‹å…¥æ“ä½œæ•°æ ˆï¼Œæ¯”å¦‚ <code>iload_1</code>ã€<code>fload_0</code>ã€<code>aload_0</code> ç­‰æŒ‡ä»¤ã€‚å…¶ä¸­<code>aload_n</code> è¡¨ç¤ºå°†ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å‹æ ˆã€‚<br>æŒ‡ä»¤ <code>xload</code> é€šè¿‡æŒ‡å®šå‚æ•°çš„å½¢å¼ï¼ŒæŠŠå±€éƒ¨å˜é‡å‹å…¥æ“ä½œæ•°æ ˆï¼Œå½“ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ—¶ï¼Œè¡¨ç¤ºå±€éƒ¨å˜é‡çš„æ•°é‡å¯èƒ½è¶…è¿‡äº†4ä¸ªï¼Œæ¯”å¦‚æŒ‡ä»¤<code>iload</code>ã€<code>fload</code> ç­‰ã€‚</p></blockquote><p><strong>ä»£ç ç¤ºä¾‹:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å±€éƒ¨å˜é‡å‹å…¥æ ˆ</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> <span class="token keyword">boolean</span> flag<span class="token punctuation">,</span> <span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106095818409.png" alt=""></p><h3 id="2-å¸¸é‡å…¥æ ˆæŒ‡ä»¤">2-å¸¸é‡å…¥æ ˆæŒ‡ä»¤</h3><p>å¸¸é‡å…¥æ ˆæŒ‡ä»¤çš„åŠŸèƒ½æ˜¯å°†å¸¸æ•°å‹å…¥æ“ä½œæ•°æ ˆï¼Œæ ¹æ®æ•°æ®ç±»å‹å’Œå…¥æ ˆå†…å®¹çš„ä¸åŒï¼Œåˆå¯ä»¥åˆ†ä¸º <code>cost</code> ç³»åˆ—ã€<code>push</code> ç³»åˆ—å’Œ <code>ldc</code> æŒ‡ä»¤ã€‚</p><ul><li>æŒ‡ä»¤ <code>const</code> ç³»åˆ—ï¼š<ul><li>ç”¨äºå¯¹ç‰¹å®šçš„å¸¸é‡å…¥æ ˆï¼Œå…¥æ ˆçš„å¸¸é‡éšå«åœ¨æŒ‡ä»¤æœ¬èº«é‡Œã€‚æŒ‡ä»¤æœ‰ï¼š<code>iconst_&lt;i&gt;</code> (i ä» -1 åˆ° 5)ã€<code>lconst_&lt;1&gt;</code> (1 ä» 0 åˆ° 1)ã€<code>fconst_&lt;f&gt;</code> (f ä» 0 åˆ° 2)ã€<code>dconst_&lt;d&gt;</code>(d ä» 0 åˆ° 1)ã€<code>aconst_null</code>ã€‚</li><li>æ¯”å¦‚:<br><code>iconst_m1</code> å°† -1 å‹å…¥æ“ä½œæ•°æ ˆ;<br><code>iconst_Ã—</code> (x ä¸º 0 åˆ° 5)å°† x å‹å…¥æ ˆ;<br><code>lconst_0</code>ã€<code>lconst_1</code> åˆ†åˆ«å°†é•¿æ•´æ•° 0 å’Œ 1 å‹å…¥æ ˆ;<br><code>fconst_0</code>ã€<code>fconst_1</code>ã€<code>fconst_2</code> åˆ†åˆ«å°†æµ®ç‚¹æ•° 0ã€1ã€2å‹å…¥æ ˆ;<br><code>dconst_0</code> å’Œ <code>dconst_1</code> åˆ†åˆ«å°† double å‹ 0 å’Œ 1 å‹å…¥æ ˆ;<br><code>aconst_null</code> å°†<code>null</code> å‹å…¥æ“ä½œæ•°æ ˆ;</li><li>ä»æŒ‡ä»¤çš„å‘½åä¸Šä¸éš¾æ‰¾å‡ºè§„å¾‹ï¼ŒæŒ‡ä»¤åŠ©è®°ç¬¦çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ€»æ˜¯å–œæ¬¢è¡¨ç¤ºæ•°æ®ç±»å‹ï¼Œi è¡¨ç¤ºæ•´æ•°ï¼Œl è¡¨ç¤ºé•¿æ•´æ•°ï¼Œf è¡¨ç¤ºæµ®ç‚¹æ•°ï¼Œd è¡¨ç¤ºåŒç²¾åº¦æµ®ç‚¹ï¼Œä¹ æƒ¯ä¸Šç”¨ a è¡¨ç¤ºå¯¹è±¡å¼•ç”¨ã€‚å¦‚æœæŒ‡ä»¤éšå«æ“ä½œçš„å‚æ•°ï¼Œä¼šä»¥ä¸‹åˆ’çº¿å½¢å¼ç»™å‡ºã€‚</li></ul></li><li>æŒ‡ä»¤ <code>push</code> ç³»åˆ—:<ul><li>ä¸»è¦åŒ…æ‹¬ <code>bipush</code> å’Œ <code>sipush</code> ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºæ¥æ”¶æ•°æ®ç±»å‹çš„ä¸åŒï¼Œ<code>bipush</code> æ¥æ”¶ 8 ä½æ•´æ•°ä½œä¸ºå‚æ•°ï¼Œ<code>sipush</code> æ¥æ”¶ 16 ä½æ•´æ•°ï¼Œå®ƒä»¬éƒ½å°†å‚æ•°å‹å…¥æ ˆã€‚</li></ul></li><li>æŒ‡ä»¤ <code>ldc</code> ç³»åˆ—:<ul><li>å¦‚æœä»¥ä¸ŠæŒ‡ä»¤éƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‡èƒ½çš„ ldc æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥æ¥æ”¶ä¸€ä¸ª 8 ä½çš„å‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å‘å¸¸é‡æ± ä¸­çš„ intã€float æˆ–è€… String çš„ç´¢å¼•ï¼Œå°†æŒ‡å®šçš„å†…å®¹å‹å…¥å †æ ˆã€‚</li><li>ç±»ä¼¼çš„è¿˜æœ‰ <code>ldc_w</code> , å®ƒæ¥æ”¶ä¸¤ä¸ª 8 ä½å‚æ•°, èƒ½æ”¯æŒçš„ç´¢å¼•èŒƒå›´å¤§äº <code>ldc</code>ã€‚</li><li>å¦‚æœè¦å‹å…¥çš„å…ƒç´ æ˜¯ long æˆ–è€… double ç±»å‹çš„, åˆ™ä½¿ç”¨ <code>ldc2_w</code> æŒ‡ä»¤, ä½¿ç”¨æ–¹å¼éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</li></ul></li></ul><pre class="line-numbers language-null" data-language="null"><code class="language-null">ä¸¾ä¾‹int i &#x3D; 3;const_3int j &#x3D; 6;bipush 6int k &#x3D; 32768 ldc ç´¢å¼•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>ç±»å‹</th><th>å¸¸æ•°æŒ‡ä»¤</th><th>èŒƒå›´</th></tr></thead><tbody><tr><td>int (boolean, byte, char, short)</td><td>iconst</td><td>[-1, 5]</td></tr><tr><td></td><td>bipush</td><td>[-128, 127]</td></tr><tr><td></td><td>sipush</td><td>[-32768, 32767]</td></tr><tr><td></td><td>ldc</td><td>any int value</td></tr><tr><td>long</td><td>lconst</td><td>0, 1</td></tr><tr><td></td><td>ldc</td><td>any long value</td></tr><tr><td>float</td><td>fconst</td><td>0, 1, 2</td></tr><tr><td></td><td>ldc</td><td>any float value</td></tr><tr><td>double</td><td>dconst</td><td>0, 1</td></tr><tr><td></td><td>ldc</td><td>any double value</td></tr><tr><td>reference</td><td>aconst</td><td>null</td></tr><tr><td></td><td>ldc</td><td>String literal, Class literal</td></tr></tbody></table><p><strong>ä»£ç ç¤ºä¾‹:</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pushCounstLdc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> e <span class="token operator">=</span> <span class="token number">12344567</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106102527127.png" alt=""></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">constLdc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">long</span> a1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> a2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> b1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> b2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> c1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> c2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token class-name">Date</span> d <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106103251827.png" alt=""></p><blockquote><p>æ³¨æ„ï¼šå¸¸é‡å…¥æ ˆæŒ‡ä»¤ä¸­çš„ n å’Œå±€éƒ¨å˜é‡å‹æ ˆæŒ‡ä»¤ä¸­çš„ n ä¸ä¸€æ ·ï¼Œæœ¬æ¬¡çš„ n ä»£è¡¨æ•°å€¼æˆ–è€…å¯¹è±¡ï¼Œè€Œä¸æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­çš„ä¸‹æ ‡</p></blockquote><h3 id="3-å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤">3-å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤</h3><p>å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤ç”¨äºå°†æ“ä½œæ•°æ ˆä¸­æ ˆé¡¶å…ƒç´ å¼¹å‡ºåï¼Œè£…å…¥å±€éƒ¨å˜é‡è¡¨çš„æŒ‡å®šä½ç½®ï¼Œç”¨äºç»™å±€éƒ¨å˜é‡èµ‹å€¼</p><p>è¿™ç±»æŒ‡ä»¤ä¸»è¦ä»¥ store çš„å½¢å¼å­˜åœ¨ï¼Œæ¯”å¦‚ <code>xstore</code> (x ä¸º iã€lã€fã€dã€a)ã€<code>xstore_n</code>(x ä¸º iã€lã€fã€dã€aï¼Œn ä¸º 0 è‡³ 3)ã€‚</p><ul><li>å…¶ä¸­ï¼ŒæŒ‡ä»¤ <code>istore_n</code> å°†ä»æ“ä½œæ•°æ ˆä¸­å¼¹å‡ºä¸€ä¸ªæ•´æ•°ï¼Œå¹¶æŠŠå®ƒèµ‹å€¼ç»™å±€éƒ¨å˜é‡ç´¢å¼• n ä½ç½®ã€‚</li><li>æŒ‡ä»¤<code>xstore</code> ç”±äºæ²¡æœ‰éšå«å‚æ•°ä¿¡æ¯ï¼Œæ•…éœ€è¦æä¾›ä¸€ä¸ª byte ç±»å‹çš„å‚æ•°ç±»æŒ‡å®šç›®æ ‡å±€éƒ¨å˜é‡è¡¨çš„ä½ç½®ã€‚</li></ul><p><strong>è¯´æ˜:</strong></p><ul><li><p><strong>ä¸€èˆ¬è¯´æ¥ï¼Œç±»ä¼¼åƒ stor è¿™æ ·çš„å‘½ä»¤éœ€è¦å¸¦ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æŒ‡æ˜å°†å¼¹å‡ºçš„å…ƒç´ æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨çš„ç¬¬å‡ ä¸ªä½ç½®</strong>ã€‚ä½†æ˜¯ï¼Œä¸ºäº†å°½å¯èƒ½å‹ç¼©æŒ‡ä»¤å¤§å°ï¼Œä½¿ç”¨ä¸“é—¨çš„ <code>istore_1</code> æŒ‡ä»¤è¡¨ç¤ºå°†å¼¹å‡ºçš„å…ƒç´ æ”¾ç½®åœ¨å±€éƒ¨å˜é‡è¡¨ç¬¬ 1 ä¸ªä½ç½®ã€‚ç±»ä¼¼çš„è¿˜æœ‰ <code>istore_0</code>ã€<code>istore_2</code>ã€<code>istore_3</code>ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºä»æ“ä½œæ•°æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå­˜æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨ç¬¬ 0ã€2ã€3 ä¸ªä½ç½®ã€‚</p></li><li><p>ç”±äºå±€éƒ¨å˜é‡è¡¨å‰å‡ ä¸ªä½ç½®æ€»æ˜¯éå¸¸å¸¸ç”¨ï¼Œå› æ­¤<strong>è¿™ç§åšæ³•è™½ç„¶å¢åŠ äº†æŒ‡ä»¤æ•°é‡ï¼Œä½†æ˜¯å¯ä»¥å¤§å¤§å‹ç¼©ç”Ÿæˆçš„å­—èŠ‚ç çš„ä½“ç§¯</strong>ã€‚</p></li><li><p>å¦‚æœå±€éƒ¨å˜é‡è¡¨å¾ˆå¤§ï¼Œéœ€è¦å­˜å‚¨çš„æ§½ä½å¤§äº 3ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>istore</code> æŒ‡ä»¤ï¼Œå¤–åŠ ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥è¡¨ç¤ºéœ€è¦å­˜æ”¾çš„æ§½ä½ä½ç½®ã€‚</p></li></ul><p><strong>ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//3.å‡ºæ ˆè£…å…¥å±€éƒ¨å˜é‡è¡¨æŒ‡ä»¤</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> m <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"dee"</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">10.0F</span><span class="token punctuation">;</span>    d <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106105001697.png" alt=""></p><p><img src="./../jvm-class2/image-20240106105603987.png" alt="æ§½ä½å¤ç”¨"></p><h2 id="03-ç®—æ•°æŒ‡ä»¤">03-ç®—æ•°æŒ‡ä»¤</h2><p><strong>1ã€ä½œç”¨ï¼š</strong></p><p>ç®—æœ¯æŒ‡ä»¤ç”¨äºå¯¹ä¸¤ä¸ªæ“ä½œæ•°æ ˆä¸Šçš„å€¼è¿›è¡ŒæŸç§ç‰¹å®šè¿ç®—ï¼Œå¹¶æŠŠç»“æœé‡æ–°å‹å…¥æ“ä½œæ•°æ ˆã€‚<br><strong>2ã€åˆ†ç±»ï¼š</strong></p><p>å¤§ä½“ä¸Šç®—æœ¯æŒ‡ä»¤å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå¯¹<strong>æ•´å‹æ•°æ®</strong>è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ä¸å¯¹<strong>æµ®ç‚¹ç±»å‹æ•°æ®</strong>è¿›è¡Œè¿ç®—çš„æŒ‡ä»¤ã€‚<br><strong>3ã€byteã€shortã€charå’Œboolean:ç±»å‹è¯´æ˜</strong></p><p>åœ¨æ¯ä¸€å¤§ç±»ä¸­ï¼Œéƒ½æœ‰é’ˆå¯¹ Java è™šæ‹Ÿæœºå…·ä½“æ•°æ®ç±»å‹çš„ä¸“ç”¨ç®—æœ¯æŒ‡ä»¤ã€‚ä½†æ²¡æœ‰ç›´æ¥æ”¯æŒ byteã€shortã€char å’Œ boolean ç±»å‹çš„ç®—æœ¯æŒ‡ä»¤ï¼Œå¯¹äºè¿™äº›æ•°æ®çš„è¿ç®—ï¼Œéƒ½ä½¿ç”¨ int ç±»å‹çš„æŒ‡ä»¤æ¥å¤„ç†ã€‚æ­¤å¤–ï¼Œåœ¨å¤„ç†booleanã€byteã€short å’Œ char ç±»å‹çš„æ•°ç»„æ—¶ï¼Œä¹Ÿä¼šè½¬æ¢ä¸ºä½¿ç”¨å¯¹åº”çš„ int ç±»å‹çš„å­—èŠ‚ç æŒ‡ä»¤æ¥å¤„ç†ã€‚</p><p><strong>Javaè™šæ‹Ÿæœºä¸­çš„å®é™…ç±»å‹ä¸è¿ç®—ç±»å‹</strong></p><table><thead><tr><th>å®é™…ç±»å‹</th><th>è¿ç®—ç±»å‹</th><th>åˆ†ç±»</th></tr></thead><tbody><tr><td>boolean</td><td>int</td><td>ä¸€</td></tr><tr><td>byte</td><td>int</td><td>ä¸€</td></tr><tr><td>char</td><td>int</td><td>ä¸€</td></tr><tr><td>short</td><td>int</td><td>ä¸€</td></tr><tr><td>int</td><td>int</td><td>ä¸€</td></tr><tr><td>float</td><td>float</td><td>ä¸€</td></tr><tr><td>reference</td><td>reference</td><td>ä¸€</td></tr><tr><td>returnAddress</td><td>returnAddress</td><td>ä¸€</td></tr><tr><td>long</td><td>long</td><td>äºŒ</td></tr><tr><td>double</td><td>double</td><td>äºŒ</td></tr></tbody></table><p><strong>4ã€è¿ç®—æ—¶çš„æº¢å‡º</strong></p><p>æ•°æ®è¿ç®—å¯èƒ½ä¼šå¯¼è‡´æº¢å‡ºï¼Œä¾‹å¦‚ä¸¤ä¸ªå¾ˆå¤§çš„æ­£æ•´æ•°ç›¸åŠ ï¼Œç»“æœå¯èƒ½æ˜¯ä¸€ä¸ªè´Ÿæ•°ã€‚å…¶å® Java è™šæ‹Ÿæœºè§„èŒƒå¹¶æ— æ˜ç¡®è§„å®šè¿‡æ•´å‹æ•°æ®æº¢å‡ºçš„å…·ä½“ç»“æœï¼Œä»…è§„å®šäº†åœ¨å¤„ç†æ•´å‹æ•°æ®æ—¶ï¼Œåªæœ‰é™¤æ³•æŒ‡ä»¤ä»¥åŠæ±‚ä½™æŒ‡ä»¤ä¸­å½“å‡ºç°é™¤æ•°ä¸º 0 æ—¶ä¼šå¯¼è‡´è™šæ‹ŸæœºæŠ›å‡ºå¼‚å¸¸ ArithmeticExceptionã€‚<br><strong>5ã€è¿ç®—æ¨¡å¼</strong></p><ul><li>å‘æœ€æ¥è¿‘æ•°èˆå…¥æ¨¡å¼ï¼šJVM è¦æ±‚åœ¨è¿›è¡Œæµ®ç‚¹æ•°è®¡ç®—æ—¶ï¼Œæ‰€æœ‰çš„è¿ç®—ç»“æœéƒ½å¿…é¡»èˆå…¥åˆ°é€‚å½“çš„ç²¾åº¦ï¼Œéç²¾ç¡®ç»“æœå¿…é¡»èˆå…¥ä¸ºå¯è¢«è¡¨ç¤ºçš„æœ€æ¥è¿‘çš„ç²¾ç¡®å€¼ï¼Œå¦‚æœæœ‰ä¸¤ç§å¯è¡¨ç¤ºçš„å½¢å¼ä¸è¯¥å€¼ä¸€æ ·æ¥è¿‘ï¼Œå°†ä¼˜å…ˆé€‰æ‹©æœ€ä½æœ‰æ•ˆä½ä¸ºé›¶çš„;</li><li>å‘é›¶èˆå…¥æ¨¡å¼ï¼šå°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•°æ—¶ï¼Œé‡‡ç”¨è¯¥æ¨¡å¼ï¼Œè¯¥æ¨¡å¼å°†åœ¨ç›®æ ‡æ•°å€¼ç±»å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€æ¥è¿‘ä½†æ˜¯ä¸å¤§äºåŸå€¼çš„æ•°å­—ä½œä¸ºæœ€ç²¾ç¡®çš„èˆå…¥ç»“æœ;</li></ul><p><strong>6ã€NaNå€¼ä½¿ç”¨</strong><br>å½“ä¸€ä¸ªæ“ä½œäº§ç”Ÿæº¢å‡ºæ—¶ï¼Œå°†ä¼šä½¿ç”¨æœ‰ç¬¦å·çš„æ— ç©·å¤§è¡¨ç¤ºï¼Œå¦‚æœæŸä¸ªæ“ä½œç»“æœæ²¡æœ‰æ˜ç¡®çš„æ•°å­¦å®šä¹‰çš„è¯ï¼Œå°†ä¼šä½¿ç”¨ NaN å€¼æ¥è¡¨ç¤ºã€‚è€Œä¸”æ‰€æœ‰ä½¿ç”¨ NaN å€¼ä½œä¸ºæ“ä½œæ•°çš„ç®—æœ¯æ“ä½œï¼Œç»“æœéƒ½ä¼šè¿”å›NaN;</p><p><img src="./../jvm-class2/image-20240106112039355.png" alt=""></p><h3 id="æ‰€æœ‰ç®—æœ¯æŒ‡ä»¤">æ‰€æœ‰ç®—æœ¯æŒ‡ä»¤</h3><pre class="line-numbers language-null" data-language="null"><code class="language-null">åŠ æ³•æŒ‡ä»¤: iaddã€laddã€faddã€daddå‡æ³•æŒ‡ä»¤: isubã€lsubã€fsubã€dsubä¹˜æ³•æŒ‡ä»¤: imulã€lmulã€fmulã€dmulé™¤æ³•æŒ‡ä»¤: idivã€ldivã€fdivã€ddivæ±‚ä½™æŒ‡ä»¤: iremã€lremã€fremã€drem&#x2F;&#x2F;remainder: ä½™æ•°å–åæŒ‡ä»¤: inegã€lnegã€fnegã€dnge&#x2F;&#x2F;negation: å–åè‡ªå¢æŒ‡ä»¤: iinc&#x2F;&#x2F;æ³¨æ„: iinc 1 by 1 æ˜¯æŒ‡å¯¹å±€éƒ¨å˜é‡è¡¨slot[1]çš„æ•°æ®è‡ªå¢, ä¸æ˜¯æ“ä½œæ•°æ ˆä½è¿ç®—æŒ‡ä»¤, åˆå¯åˆ†ä¸º:- ä½ç§»æŒ‡ä»¤: ishlã€ishrã€iushrã€lshlã€lshrã€lushr- æŒ‰ä½æˆ–æŒ‡ä»¤: iorã€lor- æŒ‰ä½ä¸æŒ‡ä»¤: iandã€land- æŒ‰ä½å¼‚æˆ–æŒ‡ä»¤: ixorã€lxoræ¯”è¾ƒæŒ‡ä»¤: dcmpgã€dcmplã€fcmpgã€fcmplã€lcmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä»£ç ä¸¾ä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">float</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> j <span class="token operator">=</span> <span class="token operator">-</span>i<span class="token punctuation">;</span>    i <span class="token operator">=</span> <span class="token operator">-</span>j<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>    i <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">method4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> c<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">method5</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106114334466.png" alt=""></p><p>ğŸ‘**++è¿ç®—ç¬¦**</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token operator">++</span>i<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token operator">++</span>j<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    i <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106120727259.png" alt=""></p><h3 id="æ¯”è¾ƒæŒ‡ä»¤çš„è¯´æ˜">æ¯”è¾ƒæŒ‡ä»¤çš„è¯´æ˜</h3><ul><li>æ¯”è¾ƒæŒ‡ä»¤çš„ä½œç”¨æ˜¯æ¯”è¾ƒæ ˆé¡¶ä¸¤ä¸ªå…ƒç´ çš„å¤§å°ï¼Œå¹¶å°†æ¯”è¾ƒç»“æœå…¥æ ˆã€‚</li><li>æ¯”è¾ƒæŒ‡ä»¤æœ‰ï¼š<code>dcmpg</code>ã€<code>dcmpl</code>ã€<code>fcmpg</code>ã€<code>fcmpl</code>ã€<code>lcmp</code>ã€‚<ul><li>ä¸å‰é¢è®²è§£çš„æŒ‡ä»¤ç±»ä¼¼ï¼Œé¦–å­—ç¬¦ d è¡¨ç¤º double ç±»å‹ï¼Œf è¡¨ç¤º float , l è¡¨ç¤º longã€‚</li></ul></li><li>å¯¹äº double å’Œ float ç±»å‹çš„æ•°å­—ï¼Œç”±äº NaN çš„å­˜åœ¨ï¼Œå„æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„æ¯”è¾ƒæŒ‡ä»¤ã€‚ä»¥ float ä¸ºä¾‹ï¼Œæœ‰ <code>fcmpg</code> å’Œ <code>fcmpl</code> ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºåœ¨æ•°å­—æ¯”è¾ƒæ—¶ï¼Œè‹¥é‡åˆ°NaNå€¼ï¼Œå¤„ç†ç»“æœä¸åŒã€‚</li><li>æŒ‡ä»¤ <code>dcmpl</code> å’Œ <code>dcmpg</code> ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ ¹æ®å…¶å‘½åå¯ä»¥æ¨æµ‹å…¶å«ä¹‰ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚</li><li>æŒ‡ä»¤ <code>lcmp</code> é’ˆå¯¹ long å‹æ•´æ•°ï¼Œç”±äº long å‹æ•´æ•°æ²¡æœ‰ NaN å€¼ï¼Œæ•…æ— éœ€å‡†å¤‡ä¸¤å¥—æŒ‡ä»¤ã€‚</li></ul><p><strong>ä¸¾ä¾‹ï¼š</strong><br>æŒ‡ä»¤ <code>fcmpg</code> å’Œ <code>fcmpl</code> éƒ½ä»æ ˆä¸­å¼¹å‡ºä¸¤ä¸ªæ“ä½œæ•°ï¼Œå¹¶å°†å®ƒä»¬åšæ¯”è¾ƒï¼Œè®¾æ ˆé¡¶çš„å…ƒç´ ä¸º v2ï¼Œæ ˆé¡¶é¡ºä½ç¬¬ 2 ä½çš„å…ƒç´ ä¸º v1(v2åœ¨ä¸Š, v1åœ¨ä¸‹)</p><ul><li>è‹¥ <code>v1 = v2</code>ï¼Œåˆ™å‹å…¥ 0;</li><li>è‹¥ <code>v1 &gt; v2</code> åˆ™å‹å…¥ 1ï¼›</li><li>è‹¥ <code>v1 &lt; v2</code> åˆ™å‹å…¥-1ã€‚<br>ä¸¤ä¸ªæŒ‡ä»¤çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¦‚æœé‡åˆ° NaN å€¼ï¼Œ<code>fcmpg</code> ä¼šå‹å…¥ 1ï¼Œè€Œ <code>Fcmpl</code> ä¼šå‹å…¥ -1ã€‚</li></ul><blockquote><p>æ•°å€¼ç±»å‹çš„æ•°æ®ï¼Œæ‰ä»¥è°ˆå¤§å°ï¼(byte\short\char\int; long\float\double)<br>booleanã€å¼•ç”¨æ•°æ®ç±»å‹ä¸èƒ½æ¯”è¾ƒå¤§å°ã€‚</p><p>æ³¨æ„ï¼šNaN(Not a Number) è¡¨ç¤ºä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ¯”å¦‚ 0.0/0.0 å¾—åˆ°çš„å¯èƒ½æ˜¯1.0ï¼ˆä¸¤ä¸ªæ•°ç›¸ç­‰ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯0.0ï¼ˆ0.0æ˜¯åˆ†å­ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯æ— ç©·å¤§ï¼ˆ0.0æ˜¯åˆ†æ¯ï¼‰ï¼Œæ‰€ä»¥è€å¸ˆç»™å‡ºçš„è§£é‡Šæ˜¯ NaN ä»£è¡¨æ— æ³•ç¡®å®šæ˜¯ä»€ä¹ˆæ•°å­—ï¼Œåªæœ‰ double å’Œ float ç±»å‹ä¸­å¯èƒ½å‡ºç° NaN çš„æƒ…å†µï¼Œè€Œ long ç±»å‹ä¸ä¼šå‡ºç° NaN ï¼Œæ‰€ä»¥åªæœ‰ lcmp ï¼Œè€Œæ²¡æœ‰ lcml</p></blockquote><h2 id="04-ç±»å‹è½¬æ¢æŒ‡ä»¤">04-ç±»å‹è½¬æ¢æŒ‡ä»¤</h2><p><strong>ç±»å‹è½¬æ¢æŒ‡ä»¤è¯´æ˜</strong></p><ol><li>ç±»å‹è½¬æ¢æŒ‡ä»¤å¯ä»¥å°†ä¸¤ç§ä¸åŒçš„æ•°å€¼ç±»å‹è¿›è¡Œç›¸äº’è½¬æ¢ã€‚</li><li>è¿™äº›è½¬æ¢æ“ä½œä¸€èˆ¬ç”¨äºå®ç°ç”¨æˆ·ä»£ç ä¸­çš„æ˜¾å¼ç±»å‹è½¬æ¢æ“ä½œï¼Œæˆ–è€…ç”¨æ¥å¤„ç†å­—èŠ‚ç æŒ‡ä»¤é›†ä¸­æ•°æ®ç±»å‹ç›¸å…³æŒ‡ä»¤æ— æ³•ä¸æ•°æ®ç±»å‹ä¸€ä¸€å¯¹åº”çš„é—®é¢˜ã€‚</li></ol><h3 id="1-å®½åŒ–ç±»å‹è½¬æ¢">1-å®½åŒ–ç±»å‹è½¬æ¢</h3><p><strong>å®½åŒ–ç±»å‹è½¬æ¢(Widening Numeric Conversions)</strong></p><p><strong>1ã€è½¬æ¢è§„åˆ™ï¼š</strong><br>Javaè™šæ‹Ÿæœºç›´æ¥æ”¯æŒä»¥ä¸‹æ•°å€¼çš„å®½åŒ–ç±»å‹è½¬æ¢(widening numeric conversion, å°èŒƒå›´ç±»å‹å‘å¤§èŒƒå›´ç±»å‹çš„å®‰å…¨è½¬æ¢)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸éœ€è¦æŒ‡ä»¤æ‰§è¡Œï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>ä» int ç±»å‹åˆ° longã€float æˆ–è€… double ç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤ä¸ºï¼ši2lã€i2fã€i2d</li><li>ä» long ç±»å‹åˆ°floatã€doubleç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤ä¸ºï¼š12fã€12d</li><li>ä» float ç±»å‹åˆ° double ç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤ä¸ºï¼šf2d</li></ul><blockquote><p>ç®€åŒ–ä¸ºï¼šint --&gt; long --&gt; float --&gt; double</p></blockquote><p><strong>2ã€ç²¾åº¦æŸå¤±é—®é¢˜</strong></p><ol><li><p>å®½åŒ–ç±»å‹è½¬æ¢æ˜¯ä¸ä¼šå› ä¸ºè¶…è¿‡ç›®æ ‡ç±»å‹æœ€å¤§å€¼è€Œä¸¢å¤±ä¿¡æ¯çš„ï¼Œä¾‹å¦‚ï¼Œä» int è½¬æ¢åˆ° long, æˆ–è€…ä» int è½¬æ¢åˆ° double , éƒ½ä¸ä¼šä¸¢å¤±ä»»ä½•ä¿¡æ¯ï¼Œè½¬æ¢å‰åçš„å€¼æ˜¯ç²¾ç¡®ç›¸ç­‰çš„ã€‚</p></li><li><p>ä»intã€long ç±»å‹æ•°å€¼è½¬æ¢åˆ° float , æˆ–è€… long ç±»å‹æ•°å€¼è½¬æ¢åˆ° double æ—¶ï¼Œå°†å¯èƒ½å‘ç”Ÿç²¾åº¦ä¸¢å¤±â€”â€”å¯èƒ½ä¸¢å¤±æ‰å‡ ä¸ªæœ€ä½æœ‰æ•ˆä½ä¸Šçš„å€¼ï¼Œè½¬æ¢åçš„æµ®ç‚¹æ•°å€¼æ˜¯æ ¹æ® IEEE754 æœ€æ¥è¿‘èˆå…¥æ¨¡å¼æ‰€å¾—åˆ°çš„æ­£ç¡®æ•´æ•°å€¼ã€‚</p><p>å°½ç®¡å®½åŒ–ç±»å‹è½¬æ¢å®é™…ä¸Šæ˜¯å¯èƒ½å‘ç”Ÿç²¾åº¦ä¸¢å¤±çš„ï¼Œä½†æ˜¯è¿™ç§è½¬æ¢æ°¸è¿œä¸ä¼šå¯¼è‡´ Java è™šæ‹ŸæœºæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚</p></li></ol><p><strong>3ã€è¡¥å……è¯´æ˜</strong></p><ul><li><p><strong>ä» byteã€char å’Œ short ç±»å‹åˆ° int ç±»å‹çš„å®½åŒ–ç±»å‹è½¬æ¢å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨</strong>çš„ã€‚å¯¹äº byte ç±»å‹è½¬ä¸º int, è™šæ‹Ÿæœºå¹¶æ²¡æœ‰åšå®è´¨æ€§çš„è½¬åŒ–å¤„ç†ï¼Œåªæ˜¯ç®€å•åœ°é€šè¿‡æ“ä½œæ•°æ ˆäº¤æ¢äº†ä¸¤ä¸ªæ•°æ®ã€‚è€Œå°† byte è½¬ä¸º long æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ i2l , å¯ä»¥çœ‹åˆ°åœ¨å†…éƒ¨ byte åœ¨è¿™é‡Œå·²ç»ç­‰åŒäº int ç±»å‹å¤„ç†ï¼Œç±»ä¼¼çš„è¿˜æœ‰ short ç±»å‹ï¼Œè¿™ç§å¤„ç†æ–¹å¼æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p></li><li><p>ä¸€æ–¹é¢å¯ä»¥å‡å°‘å®é™…çš„æ•°æ®ç±»å‹ï¼Œå¦‚æœä¸º short å’Œ byte éƒ½å‡†å¤‡ä¸€å¥—æŒ‡ä»¤ï¼Œé‚£ä¹ˆæŒ‡ä»¤çš„æ•°é‡å°±ä¼šå¤§å¢ï¼Œ<strong>è€Œè™šæ‹Ÿæœºç›®å‰çš„è®¾è®¡ä¸Šï¼Œåªæ„¿æ„ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºæŒ‡ä»¤ï¼Œå› æ­¤æŒ‡ä»¤æ€»æ•°ä¸èƒ½è¶…è¿‡256ä¸ªï¼Œä¸ºäº†èŠ‚çœæŒ‡ä»¤èµ„æºï¼Œå°† short å’Œ byte å½“åš int å¤„ç†ä¹Ÿåœ¨æƒ…ç†ä¹‹ä¸­ã€‚</strong></p></li><li><p>å¦ä¸€æ–¹é¢ï¼Œç”±äºå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½å›ºå®šä¸º32ä½ï¼Œæ— è®ºæ˜¯ byte æˆ–è€… short å­˜å…¥å±€éƒ¨å˜é‡è¡¨ï¼Œéƒ½ä¼šå ç”¨32ä½ç©ºé—´ã€‚ä»è¿™ä¸ªè§’åº¦è¯´ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ç‰¹æ„åŒºåˆ†è¿™å‡ ç§æ•°æ®ç±»å‹ã€‚</p></li></ul><p><strong>ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// é’ˆå¯¹äºå®½åŒ–ç±»å‹è½¬æ¢çš„åŸºæœ¬æµ‹è¯•</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upCast1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> l <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token keyword">float</span> f <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token keyword">double</span> d <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token keyword">float</span> f1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> d1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> d2 <span class="token operator">=</span> f1<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ç²¾åº¦æŸå¤±æ¡ˆä¾‹</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upCast2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">111222333</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> f <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1.23123120 å‡ºç°ç²¾åº¦ä¸¢å¤±</span>    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token number">111222333444555666L</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> d <span class="token operator">=</span> l<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1.11222333444555664E17</span><span class="token punctuation">&#125;</span><span class="token comment">// byte, char, shortç±»å‹åˆ°intç±»å‹çš„å®½åŒ–ç±»å‹è½¬æ¢å®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cpCast3</span><span class="token punctuation">(</span><span class="token keyword">byte</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> b<span class="token punctuation">;</span>    <span class="token keyword">long</span> l <span class="token operator">=</span> b<span class="token punctuation">;</span>    <span class="token keyword">double</span> d <span class="token operator">=</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upCast4</span><span class="token punctuation">(</span><span class="token keyword">short</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> s<span class="token punctuation">;</span>    <span class="token keyword">long</span> l <span class="token operator">=</span> s<span class="token punctuation">;</span>    <span class="token keyword">float</span> f <span class="token operator">=</span> s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106133833047.png" alt=""></p><h3 id="2-çª„åŒ–ç±»å‹è½¬æ¢">2-çª„åŒ–ç±»å‹è½¬æ¢</h3><p><strong>çª„åŒ–ç±»å‹è½¬æ¢(Narrowing Numeric Conversion)</strong><br><strong>1ã€è½¬æ¢è§„åˆ™</strong><br>Javaè™šæ‹Ÿæœºä¹Ÿç›´æ¥æ”¯æŒä»¥ä¸‹çª„åŒ–ç±»å‹è½¬æ¢:</p><ul><li>ä» int ç±»å‹è‡³ byte, short æˆ–è€… char ç±»å‹. å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼ši2bã€i2cã€i2s</li><li>ä» long ç±»å‹åˆ° int ç±»å‹. å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼šl2i</li><li>ä» float ç±»å‹åˆ° int æˆ–è€… long ç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼šf2iã€f2l</li><li>ä» double ç±»å‹åˆ° intã€long æˆ–è€… float ç±»å‹ã€‚å¯¹åº”çš„æŒ‡ä»¤æœ‰ï¼šd2iã€d2lã€d2f</li></ul><p><strong>2ã€ç²¾åº¦æŸå¤±é—®é¢˜</strong></p><p>çª„åŒ–ç±»å‹è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´è½¬æ¢ç»“æœå…·å¤‡ä¸åŒçš„æ­£è´Ÿå·ã€ä¸åŒçš„æ•°é‡çº§ï¼Œå› æ­¤ï¼Œè½¬æ¢è¿‡ç¨‹å¾ˆå¯èƒ½ä¼šå¯¼è‡´æ•°å€¼ä¸¢å¤±ç²¾åº¦</p><p>å°½ç®¡æ•°æ®ç±»å‹çª„åŒ–è½¬æ¢å¯èƒ½ä¼šå‘ç”Ÿä¸Šé™æº¢å‡ºã€ä¸‹é™æº¢å‡ºå’Œç²¾åº¦ä¸¢å¤±ç­‰æƒ…å†µï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ˜ç¡®è§„å®šæ•°å€¼ç±»å‹çš„çª„åŒ–è½¬æ¢æŒ‡ä»¤æ°´è¿œä¸å¯èƒ½å¯¼è‡´è™šæ‹ŸæœºæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</p><blockquote><p>æ³¨æ„ï¼šä»floatã€doubleã€longç­‰ç±»å‹å¾€byteã€shortã€charç±»å‹è½¬æ¢çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæŠŠå‰é¢å‡ ç§ç±»å‹è½¬æ¢æˆintç±»å‹ï¼Œç„¶ååœ¨ä»intç±»å‹è½¬æ¢åˆ°åé¢è¿™å‡ ç§ç±»å‹ï¼Œæ‰€ä»¥intç±»å‹ç›¸ç­‰äºä¸€ç§è¿‡æ¸¡ç±»å‹</p></blockquote><p><strong>3ã€è¡¥å……è¯´æ˜</strong></p><ul><li><p>å½“å°†ä¸€ä¸ªæµ®ç‚¹å€¼çª„åŒ–è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ T (T é™äº int æˆ– long ç±»å‹ä¹‹ä¸€)çš„æ—¶å€™ï¼Œå°†éµå¾ªä»¥ä¸‹è½¬æ¢è§„åˆ™ï¼š</p><ul><li>å¦‚æœæµ®ç‚¹å€¼æ˜¯ NaN, é‚£è½¬æ¢ç»“æœå°±æ˜¯ int æˆ– long ç±»å‹çš„ 0</li><li>å¦‚æœæµ®ç‚¹å€¼ä¸æ˜¯æ— ç©·å¤§çš„è¯ï¼Œæµ®ç‚¹å€¼ä½¿ç”¨ IEEE 754 çš„å‘é›¶èˆå…¥æ¨¡å¼å–æ•´ï¼Œè·å¾—æ•´æ•°å€¼ v ,å¦‚æœ v åœ¨ç›®æ ‡ç±»å‹ T(int æˆ– long) çš„è¡¨ç¤ºèŒƒå›´ä¹‹å†…ï¼Œé‚£è½¬æ¢ç»“æœå°±æ˜¯vã€‚å¦åˆ™ï¼Œå°†æ ¹æ® v çš„ç¬¦å·ï¼Œè½¬æ¢ä¸º T æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§æˆ–è€…æœ€å°æ­£æ•°</li></ul></li><li><p>å½“å°†ä¸€ä¸ª double ç±»å‹çª„åŒ–è½¬æ¢ä¸º float ç±»å‹æ—¶ï¼Œå°†éµå¾ªä»¥ä¸‹è½¬æ¢è§„åˆ™ï¼š</p><p>é€šè¿‡å‘æœ€æ¥è¿‘æ•°èˆå…¥æ¨¡å¼èˆå…¥ä¸€ä¸ªå¯ä»¥ä½¿ç”¨ float ç±»å‹è¡¨ç¤ºçš„æ•°å­—ã€‚æœ€åç»“æœæ ¹æ®ä¸‹é¢è¿™3æ¡è§„åˆ™åˆ¤æ–­ï¼š</p><ul><li>å¦‚æœè½¬æ¢ç»“æœçš„ç»å¯¹å€¼å¤ªå°è€Œæ— æ³•ä½¿ç”¨ float æ¥è¡¨ç¤ºï¼Œå°†è¿”å› float ç±»å‹çš„æ­£è´Ÿé›¶ã€‚</li><li>å¦‚æœè½¬æ¢ç»“æœçš„ç»å¯¹å€¼å¤ªå¤§è€Œæ— æ³•ä½¿ç”¨ float æ¥è¡¨ç¤ºï¼Œå°†è¿”å› float ç±»å‹çš„æ­£è´Ÿæ— ç©·å¤§ã€‚</li><li>å¯¹äº double ç±»å‹çš„ NaN å€¼å°†æŒ‰è§„å®šè½¬æ¢ä¸º float ç±»å‹çš„ NaN å€¼ã€‚</li></ul></li></ul><p><strong>ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downCast5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">double</span> d1 <span class="token operator">=</span> <span class="token class-name">Double<span class="token punctuation">.</span>NaN</span><span class="token punctuation">;</span> <span class="token comment">//0.0 / 0.0</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> d1<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//NaN</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>    <span class="token keyword">double</span> d2 <span class="token operator">=</span>  <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token constant">POSITIVE_INFINITY</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> d2<span class="token punctuation">;</span>    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> d2<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//9223372036854775807</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//9223372036854775807</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2147483647</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2147483647</span>    <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> d1<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//NaN</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="05-å¯¹è±¡çš„åˆ›å»ºäºè®¿é—®æŒ‡ä»¤">05-å¯¹è±¡çš„åˆ›å»ºäºè®¿é—®æŒ‡ä»¤</h2><p>Javaæ˜¯é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œè™šæ‹Ÿæœºå¹³å°ä»å­—èŠ‚ç å±‚é¢å°±å¯¹é¢å‘å¯¹è±¡åšäº†æ·±å±‚æ¬¡çš„æ”¯æŒã€‚æœ‰ä¸€ç³»åˆ—æŒ‡ä»¤ä¸“é—¨ç”¨äºå¯¹è±¡æ“ä½œï¼Œå¯è¿›ä¸€æ­¥ç»†åˆ†ä¸ºåˆ›å»ºæŒ‡ä»¤ã€å­—æ®µè®¿é—®æŒ‡ä»¤ã€æ•°ç»„æ“ä½œæŒ‡ä»¤ã€ç±»å‹æ£€æŸ¥æŒ‡ä»¤ã€‚</p><h3 id="1-åˆ›å»ºæŒ‡ä»¤">1-åˆ›å»ºæŒ‡ä»¤</h3><p>è™½ç„¶ç±»å®ä¾‹å’Œæ•°ç»„éƒ½æ˜¯å¯¹è±¡ï¼Œä½†]avaè™šæ‹Ÿæœºå¯¹ç±»å®ä¾‹å’Œæ•°ç»„çš„åˆ›å»ºä¸æ“ä½œä½¿ç”¨äº†ä¸åŒçš„å­—èŠ‚ç æŒ‡ä»¤ï¼š</p><ol><li>åˆ›å»ºç±»å®ä¾‹çš„æŒ‡ä»¤ï¼š<ul><li>åˆ›å»ºç±»å®ä¾‹çš„æŒ‡ä»¤ï¼š<code>new</code><ul><li>å®ƒæ¥æ”¶ä¸€ä¸ªæ“ä½œæ•°ï¼Œä¸ºæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ï¼Œè¡¨ç¤ºè¦åˆ›å»ºçš„ç±»å‹ï¼Œæ‰§è¡Œå®Œæˆåï¼Œå°†å¯¹è±¡çš„å¼•ç”¨å‹å…¥æ ˆã€‚</li></ul></li></ul></li></ol><p><img src="./../jvm-class2/image-20240106142557664.png" alt="newçš„å­—èŠ‚ç æŒ‡ä»¤"></p><ol start="2"><li>åˆ›å»ºæ•°ç»„çš„æŒ‡ä»¤ï¼š<ul><li>åˆ›å»ºæ•°ç»„çš„æŒ‡ä»¤ï¼š<code>newarray</code>ã€<code>anewarray</code>ã€<code>multianewarray</code><ul><li><code>newarray</code>: åˆ›å»ºåŸºæœ¬ç±»å‹æ•°ç»„</li><li><code>anewarray</code>: åˆ›å»ºå¼•ç”¨ç±»å‹æ•°ç»„</li><li><code>multianewarray</code>: åˆ›å»ºå¤šç»´æ•°ç»„</li></ul></li></ul></li></ol><p><img src="./../jvm-class2/image-20240106143336444.png" alt="new arr"></p><p><img src="./../jvm-class2/image-20240106143421808.png" alt="new multianewarray"></p><p>ä¸Šè¿°åˆ›å»ºæŒ‡ä»¤å¯ä»¥ç”¨äºåˆ›å»ºå¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œç”±äºå¯¹è±¡å’Œæ•°ç»„åœ¨ Java ä¸­çš„å¹¿æ³›ä½¿ç”¨ï¼Œè¿™äº›æŒ‡ä»¤çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿéå¸¸é«˜ã€‚</p><h3 id="2-å­—æ®µè®¿é—®æŒ‡ä»¤">2-å­—æ®µè®¿é—®æŒ‡ä»¤</h3><p>å¯¹è±¡åˆ›å»ºåï¼Œå°±å¯ä»¥é€šè¿‡å¯¹è±¡è®¿é—®æŒ‡ä»¤è·å–å¯¹è±¡å®ä¾‹æˆ–æ•°ç»„å®ä¾‹ä¸­çš„å­—æ®µæˆ–è€…æ•°ç»„å…ƒç´ ã€‚</p><ul><li>è®¿é—®ç±»å­—æ®µ(static å­—æ®µï¼Œæˆ–è€…ç§°ä¸ºç±»å˜é‡)çš„æŒ‡ä»¤ï¼š<ul><li><code>getstatic</code>: å°†å½“å‰ç”¨ static ä¿®é¥°çš„å­—æ®µå‹å…¥æ“ä½œæ•°æ ˆä¸­</li><li><code>putstatic</code>: å°†æ•°æ®å¼¹æ ˆ</li></ul></li><li>è®¿é—®ç±»å®ä¾‹å­—æ®µï¼ˆé static å­—æ®µï¼Œæˆ–è€…ç§°ä¸ºå®ä¾‹å˜é‡ï¼‰çš„æŒ‡ä»¤ï¼š<ul><li><code>getfield</code>: å‹æ ˆ</li><li><code>putfield</code>: å¼¹æ ˆ</li></ul></li></ul><p><strong>ä¸¾ä¾‹ï¼š</strong><br>ä»¥ <code>getstatic</code> æŒ‡ä»¤ä¸ºä¾‹ï¼Œå®ƒå«æœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œä¸ºæŒ‡å‘å¸¸é‡æ± çš„ <code>Fieldref</code> ç´¢å¼•ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è·å– <code>Fieldref</code> æŒ‡å®šçš„<br>å¯¹è±¡æˆ–è€…å€¼ï¼Œå¹¶å°†å…¶å‹å…¥æ“ä½œæ•°æ ˆã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class2/image-20240106144117955.png" alt=""></p><p><img src="./../jvm-class2/image-20240106154017401.png" alt="ç¨å¾®å¤æ‚demo"></p><h3 id="3-æ•°ç»„æ“ä½œæŒ‡ä»¤">3-æ•°ç»„æ“ä½œæŒ‡ä»¤</h3><p>æ•°ç»„æ“ä½œæŒ‡ä»¤ä¸»è¦æœ‰ï¼š<code>xastore</code> å’Œ <code>xaload</code> æŒ‡ä»¤ã€‚å…·ä½“ä¸ºï¼š</p><ul><li>æŠŠä¸€ä¸ªæ•°ç»„å…ƒç´ åŠ è½½åˆ°æ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ï¼š<code>baload</code>ã€<code>caload</code>ã€<code>saload</code>ã€<code>iaload</code>ã€<code>laload</code>ã€<code>faload</code>ã€<code>daload</code>ã€<code>aaload</code></li><li>å°†ä¸€ä¸ªæ“ä½œæ•°æ ˆçš„å€¼å­˜å‚¨åˆ°æ•°ç»„å…ƒç´ ä¸­çš„æŒ‡ä»¤ï¼š<code>bastore</code>ã€<code>castore</code>ã€<code>sastore</code>ã€ <code>iastore</code>ã€<code>lastore</code>ã€<code>fastore</code>ã€<code>dastore</code>ã€<code>aastore</code></li></ul><table><thead><tr><th>æ•°ç»„ç±»å‹</th><th>åŠ è½½æŒ‡ä»¤</th><th>å­˜å‚¨æŒ‡ä»¤</th></tr></thead><tbody><tr><td>byte(boolean)</td><td>baload</td><td>bastore</td></tr><tr><td>char</td><td>caload</td><td>castore</td></tr><tr><td>short</td><td>saload</td><td>sastore</td></tr><tr><td>int</td><td>iaload</td><td>iastore</td></tr><tr><td>long</td><td>laload</td><td>lastore</td></tr><tr><td>float</td><td>faload</td><td>fastore</td></tr><tr><td>double</td><td>daload</td><td>dastore</td></tr><tr><td>reference</td><td>aaload</td><td>aastore</td></tr></tbody></table><ul><li>å–æ•°ç»„é•¿åº¦çš„æŒ‡ä»¤: <code>arraylength</code><ul><li>è¯¥æŒ‡ä»¤å¼¹å‡ºæ ˆé¡¶çš„æ•°ç»„å…ƒç´ ï¼Œè·å–æ•°ç»„çš„é•¿åº¦ï¼Œå°†é•¿åº¦å‹å…¥æ ˆ</li></ul></li></ul><p><strong>è¯´æ˜</strong></p><ul><li>æŒ‡ä»¤ <code>xaload</code> è¡¨ç¤ºå°†æ•°ç»„çš„å…ƒç´ å‹æ ˆï¼Œæ¯”å¦‚ <code>saload</code>ã€<code>caload</code> åˆ†åˆ«è¡¨ç¤ºå‹å…¥ <code>short</code> æ•°ç»„å’Œ <code>char</code> æ•°ç»„ã€‚æŒ‡ä»¤ <code>xaload</code> åœ¨æ‰§è¡Œæ—¶ï¼Œè¦æ±‚æ“ä½œæ•°ä¸­æ ˆé¡¶å…ƒç´ ä¸ºæ•°ç»„ç´¢å¼• i ï¼Œæ ˆé¡¶é¡ºä½ç¬¬ 2 ä¸ªå…ƒç´ ä¸ºæ•°ç»„å¼•ç”¨ a ï¼Œè¯¥æŒ‡ä»¤ä¼šå¼¹å‡ºæ ˆé¡¶è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶å°† a[i] é‡æ–°å‹å…¥æ ˆã€‚</li><li><code>xastore</code> åˆ™ä¸“é—¨é’ˆå¯¹æ•°ç»„æ“ä½œï¼Œä»¥ <code>iastore</code> ä¸ºä¾‹ï¼Œå®ƒç”¨äºç»™ä¸€ä¸ª int æ•°ç»„çš„ç»™å®šç´¢å¼•èµ‹å€¼ã€‚åœ¨ <code>iastore</code> æ‰§è¡Œå‰ï¼Œæ“ä½œæ•°æ ˆé¡¶éœ€è¦ä»¥æ­¤å‡†å¤‡ 3 ä¸ªå…ƒç´ ï¼šå€¼ã€ç´¢å¼•ã€æ•°ç»„å¼•ç”¨ï¼Œ<code>iastore</code> ä¼šå¼¹å‡ºè¿™ 3 ä¸ªå€¼ï¼Œå¹¶å°†å€¼èµ‹ç»™æ•°ç»„ä¸­æŒ‡å®šç´¢å¼•çš„ä½ç½®ã€‚</li></ul><p><img src="./../jvm-class2/image-20240106160141019.png" alt="æ•°ç»„æ“ä½œæŒ‡ä»¤ç¤ºä¾‹"></p><h3 id="4-ç±»å‹æ£€æŸ¥æŒ‡ä»¤">4-ç±»å‹æ£€æŸ¥æŒ‡ä»¤</h3><p>æ£€æŸ¥ç±»å®ä¾‹æˆ–æ•°ç»„ç±»å‹çš„æŒ‡ä»¤ï¼š<code>instanceof</code>ã€<code>checkcast</code>ã€‚</p><ul><li>æŒ‡ä»¤ <code>checkcast</code> ç”¨äºæ£€æŸ¥ç±»å‹å¼ºåˆ¶è½¬æ¢æ˜¯å¦å¯ä»¥è¿›è¡Œã€‚å¦‚æœå¯ä»¥è¿›è¡Œï¼Œé‚£ä¹ˆ <code>checkcast</code> æŒ‡ä»¤ä¸ä¼šæ”¹å˜æ“ä½œæ•°æ ˆï¼Œå¦åˆ™å®ƒä¼šæŠ›å‡º ClassCastException å¼‚å¸¸ã€‚</li><li>æŒ‡ä»¤ <code>instanceof</code> ç”¨æ¥åˆ¤æ–­ç»™å®šå¯¹è±¡æ˜¯å¦æ˜¯æŸä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œå®ƒä¼šå°†åˆ¤æ–­ç»“æœå‹å…¥æ“ä½œæ•°æ ˆã€‚</li></ul><h2 id="06-æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤">06-æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</h2><h3 id="æ–¹æ³•è°ƒç”¨æŒ‡ä»¤">æ–¹æ³•è°ƒç”¨æŒ‡ä»¤</h3><ul><li><code>invokevirtual</code> æŒ‡ä»¤ç”¨äºè°ƒç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹è¿›è¡Œåˆ†æ´¾ï¼ˆè™šæ–¹æ³•åˆ†æ´¾ï¼‰ï¼Œæ”¯æŒå¤šæ€ã€‚è¿™ä¹Ÿæ˜¯ Java è¯­è¨€ä¸­<strong>æœ€å¸¸è§çš„æ–¹æ³•åˆ†æ´¾æ–¹å¼</strong>ã€‚</li><li><code>invokeinterface</code> æŒ‡ä»¤ç”¨äº<strong>è°ƒç”¨æ¥å£æ–¹æ³•</strong>ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶æœç´¢ç”±ç‰¹å®šå¯¹è±¡æ‰€å®ç°çš„è¿™ä¸ªæ¥å£æ–¹æ³•ï¼Œå¹¶æ‰¾å‡ºé€‚åˆçš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚</li></ul><p><img src="./../jvm-class2/image-20240106163409683.png" alt="invokeinterface æŒ‡ä»¤"></p><p><img src="./../jvm-class2/image-20240106182137779.png" alt="static æƒ…å†µä¸‹"></p><ul><li><code>invokespecial</code> æŒ‡ä»¤ç”¨äºè°ƒç”¨ä¸€äº›éœ€è¦ç‰¹æ®Šå¤„ç†çš„å®ä¾‹æ–¹æ³•ï¼ŒåŒ…æ‹¬**å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼ˆæ„é€ å™¨ï¼‰ã€ç§æœ‰æ–¹æ³•å’Œçˆ¶ç±»æ–¹æ³•ã€‚**è¿™äº›æ–¹æ³•éƒ½æ˜¯é™æ€ç±»å‹ç»‘å®šçš„ï¼Œä¸ä¼šåœ¨è°ƒç”¨æ—¶è¿›è¡ŒåŠ¨æ€æ´¾å‘ã€‚</li></ul><p><img src="./../jvm-class2/image-20240106162611730.png" alt="invokespecial æŒ‡ä»¤"></p><ul><li><code>invokestatic</code> æŒ‡ä»¤ç”¨äºè°ƒç”¨å‘½åç±»ä¸­çš„<strong>ç±»ä¸­çš„ç±»æ–¹æ³•(staticæ–¹æ³•)</strong>ã€‚è¿™æ˜¯é™æ€ç»‘å®šçš„ã€‚</li></ul><p><img src="./../jvm-class2/image-20240106162933197.png" alt="invokestatic æŒ‡ä»¤"></p><ul><li><code>invokedynamic</code> è°ƒç”¨åŠ¨æ€ç»‘å®šçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯ JDK1.7 åæ–°åŠ å…¥çš„æŒ‡ä»¤ã€‚ç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œè¯¥æ–¹æ³•ã€‚å‰é¢4æ¡è°ƒç”¨æŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘éƒ½å›ºåŒ–åœ¨ Java è™šæ‹Ÿæœºå†…éƒ¨ï¼Œè€Œ <code>invokedynamic</code> æŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘æ˜¯ç”±ç”¨æˆ·æ‰€è®¾å®šçš„å¼•å¯¼æ–¹æ³•å†³å®šçš„ã€‚</li></ul><h3 id="æ–¹æ³•è¿”å›æŒ‡ä»¤">æ–¹æ³•è¿”å›æŒ‡ä»¤</h3><p>æ–¹æ³•è°ƒç”¨ç»“æŸå‰ï¼Œéœ€è¦è¿›è¡Œè¿”å›ã€‚æ–¹æ³•è¿”å›æŒ‡ä»¤æ˜¯<strong>æ ¹æ®è¿”å›å€¼çš„ç±»å‹åŒºåˆ†</strong>çš„ã€‚</p><ul><li>åŒ…æ‹¬ <code>ireturn</code> (å½“è¿”å›å€¼æ˜¯booleanã€byteã€charã€short å’Œ int ç±»å‹æ—¶ä½¿ç”¨)ã€lreturnã€freturnã€dreturn å’Œ areturn</li><li>å¦å¤–è¿˜æœ‰ä¸€æ¡returnæŒ‡ä»¤ä¾›å£°æ˜ä¸ºvoidçš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ä»¥åŠç±»å’Œæ¥å£çš„ç±»åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨ã€‚</li></ul><table><thead><tr><th>è¿”å›ç±»å‹</th><th>è¿”å›æŒ‡ä»¤</th></tr></thead><tbody><tr><td>void</td><td>return</td></tr><tr><td>int (boolean, byte, char, short)</td><td>ireturn</td></tr><tr><td>long</td><td>lreturn</td></tr><tr><td>float</td><td>freturn</td></tr><tr><td>double</td><td>dreturn</td></tr><tr><td>reference</td><td>areturn</td></tr></tbody></table><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>é€šè¿‡ <code>ireturn</code> æŒ‡ä»¤ï¼Œå°†å½“å‰å‡½æ•°æ“ä½œæ•°æ ˆçš„é¡¶å±‚å…ƒç´ å¼¹å‡ºï¼Œå¹¶å°†è¿™ä¸ªå…ƒç´ å‹å…¥è°ƒç”¨è€…å‡½æ•°çš„æ“ä½œæ•°æ ˆä¸­ï¼ˆå› ä¸ºè°ƒç”¨è€…éå¸¸å…³å¿ƒå‡½æ•°çš„è¿”å›å€¼)ï¼Œæ‰€æœ‰åœ¨å½“å‰å‡½æ•°æ“ä½œæ•°æ ˆä¸­çš„å…¶ä»–å…ƒç´ éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚</p><p>å¦‚æœå½“å‰è¿”å›çš„æ˜¯ synchronized æ–¹æ³•ï¼Œé‚£ä¹ˆè¿˜ä¼šæ‰§è¡Œä¸€ä¸ªéšå«çš„ monitorexit æŒ‡ä»¤ï¼Œé€€å‡ºä¸´ç•ŒåŒºã€‚</p><p>æœ€åï¼Œä¼šä¸¢å¼ƒå½“å‰æ–¹æ³•çš„æ•´ä¸ªå¸§ï¼Œæ¢å¤è°ƒç”¨è€…çš„å¸§ï¼Œå¹¶å°†æ§åˆ¶æƒè½¬äº¤ç»™è°ƒç”¨è€…ã€‚</p><h2 id="07-æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤">07-æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</h2><p>å¦‚åŒæ“ä½œä¸€ä¸ªæ™®é€šæ•°æ®ç»“æ„ä¸­çš„å †æ ˆé‚£æ ·ï¼ŒJVM æä¾›çš„æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤ï¼Œå¯ä»¥ç”¨äºç›´æ¥æ“ä½œæ“ä½œæ•°æ ˆçš„æŒ‡ä»¤ã€‚</p><p>è¿™ç±»æŒ‡ä»¤åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š</p><ul><li>å°†ä¸€ä¸ªæˆ–ä¸¤ä¸ªå…ƒç´ ä»æ ˆé¡¶å¼¹å‡ºï¼Œå¹¶ä¸”ç›´æ¥åºŸå¼ƒï¼š<code>pop</code>, <code>pop2</code> ;</li></ul><p><img src="./../jvm-class2/image-20240106184820442.png" alt="pop å­—èŠ‚ç æŒ‡ä»¤"></p><p><img src="./../jvm-class2/image-20240106184953305.png" alt="pop2 å­—èŠ‚ç æŒ‡ä»¤"></p><ul><li>å¤åˆ¶æ ˆé¡¶ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å€¼å¹¶å°†å¤åˆ¶å€¼æˆ–åŒä»½çš„å¤åˆ¶å€¼é‡æ–°å‹å…¥æ ˆé¡¶ï¼š<code>dup</code>, <code>dup2</code>, <code>dup_x1</code>, <code>dup2_x1</code>, <code>dup_x2</code>, <code>dup2_x2</code> ;</li></ul><p><img src="./../jvm-class2/image-20240106190045604.png" alt="ğŸ‘dup_x2 å­—èŠ‚ç æŒ‡ä»¤"></p><p><img src="./../jvm-class2/image-20240106191239053.png" alt="æµç¨‹ç¤ºä¾‹"></p><ul><li>å°†æ ˆæœ€é¡¶ç«¯çš„ä¸¤ä¸ª Slot æ•°å€¼ä½ç½®äº¤æ¢ï¼š<code>swap</code>ã€‚Java è™šæ‹Ÿæœºæ²¡æœ‰æä¾›äº¤æ¢ä¸¤ä¸ª64ä½æ•°æ®ç±»å‹(longã€double)æ•°å€¼çš„æŒ‡ä»¤ã€‚</li><li>æŒ‡ä»¤ <code>nop</code> ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„æŒ‡ä»¤ï¼Œå®ƒçš„å­—èŠ‚ç ä¸º 0x00ã€‚å’Œæ±‡ç¼–è¯­è¨€ä¸­çš„ <code>nop</code> ä¸€æ ·ï¼Œå®ƒè¡¨ç¤ºä»€ä¹ˆéƒ½ä¸åšã€‚è¿™æ¡æŒ‡ä»¤ä¸€èˆ¬å¯ç”¨äºè°ƒè¯•ã€å ä½ç­‰ã€‚</li></ul><p>è¿™äº›æŒ‡ä»¤å±äºé€šç”¨å‹ï¼Œå¯¹æ ˆçš„å‹å…¥æˆ–è€…å¼¹å‡ºæ— éœ€æŒ‡æ˜æ•°æ®ç±»å‹ã€‚</p><p><strong>è¯´æ˜</strong></p><ul><li>ä¸å¸¦ <code>_x</code> çš„æŒ‡ä»¤æ˜¯å¤åˆ¶æ ˆé¡¶æ•°æ®å¹¶å‹å…¥æ ˆé¡¶ã€‚åŒ…æ‹¬ä¸¤ä¸ªæŒ‡ä»¤ï¼Œ<code>dup</code> å’Œ <code>dup2</code>ã€‚<code>dup</code>çš„ç³»æ•°ä»£è¡¨è¦å¤åˆ¶çš„ Slot ä¸ªæ•°ã€‚<ul><li><code>dup</code> å¼€å¤´çš„æŒ‡ä»¤ç”¨äºå¤åˆ¶ 1 ä¸ª Slot çš„æ•°æ®ã€‚ä¾‹å¦‚ 1 ä¸ª int æˆ– 1 ä¸ª reference ç±»å‹æ•°æ®</li><li><code>dup2</code> å¼€å¤´çš„æŒ‡ä»¤ç”¨äºå¤åˆ¶ 2 ä¸ª Slot çš„æ•°æ®ã€‚ä¾‹å¦‚ 1 ä¸ª long ,æˆ– 2 ä¸ª int ,æˆ– 1 ä¸ª int+1 ä¸ª float ç±»å‹æ•°æ®</li></ul></li><li>å¸¦ <code>_x</code> çš„æŒ‡ä»¤æ˜¯å¤åˆ¶æ ˆé¡¶æ•°æ®å¹¶æ’å…¥æ ˆé¡¶ä»¥ä¸‹çš„æŸä¸ªä½ç½®ã€‚å…±æœ‰ 4 ä¸ªæŒ‡ä»¤ï¼Œ<code>dup_Ã—1</code> , <code>dup2_Ã—1</code>, <code>dup_x2</code>, <code>dup2_x2</code>ã€‚å¯¹äºå¸¦ <code>_x</code> çš„å¤åˆ¶æ’å…¥æŒ‡ä»¤ï¼Œåªè¦å°†æŒ‡ä»¤çš„ <code>dup</code> å’Œ x çš„ç³»æ•°ç›¸åŠ ï¼Œç»“æœå³ä¸ºéœ€è¦æ’å…¥çš„ä½ç½®ã€‚å› æ­¤<ul><li><code>dup_Ã—1</code> æ’å…¥ä½ç½®ï¼š1+1=2ï¼Œå³æ ˆé¡¶ 2 ä¸ª Slot ä¸‹é¢</li><li><code>dup_Ã—2</code> æ’å…¥ä½ç½®ï¼š1+2=3ï¼Œå³æ ˆé¡¶ 3 ä¸ª Slot ä¸‹é¢</li><li><code>dup2_Ã—1</code> æ’å…¥ä½ç½®ï¼š2+1=3ï¼Œå³æ ˆé¡¶ 3 ä¸ª Slot ä¸‹é¢</li><li><code>dup2_Ã—2</code> æ’å…¥ä½ç½®ï¼š2+2=4ï¼Œå³æ ˆé¡¶ 4 ä¸ª Slot ä¸‹é¢</li></ul></li><li><code>pop</code>: å°†æ ˆé¡¶çš„ 1 ä¸ª Slot æ•°å€¼å‡ºæ ˆã€‚ä¾‹å¦‚ 1 ä¸ª short ç±»å‹æ•°å€¼</li><li><code>pop2</code>: å°†æ ˆé¡¶çš„ 2 ä¸ª Slot æ•°å€¼å‡ºæ ˆã€‚ä¾‹å¦‚ 1 ä¸ª double ç±»å‹æ•°å€¼ï¼Œæˆ–è€… 2 ä¸ª int ç±»å‹æ•°å€¼</li></ul><h2 id="08-æ§åˆ¶è½¬ä¹‰æŒ‡ä»¤">08-æ§åˆ¶è½¬ä¹‰æŒ‡ä»¤</h2><p>ç¨‹åºæµç¨‹ç¦»ä¸å¼€æ¡ä»¶æ§åˆ¶ï¼Œä¸ºäº†æ”¯æŒæ¡ä»¶è·³è½¬ï¼Œè™šæ‹Ÿæœºæä¾›äº†å¤§é‡å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸º:</p><ol><li>æ¯”è¾ƒæŒ‡ä»¤</li><li>æ¡ä»¶è·³è½¬æŒ‡ä»¤</li><li>æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤</li><li>å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤</li><li>æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ç­‰</li></ol><h3 id="1-æ¡ä»¶è·³è½¬æŒ‡ä»¤">1-æ¡ä»¶è·³è½¬æŒ‡ä»¤</h3><p>æ¡ä»¶è·³è½¬æŒ‡ä»¤é€šå¸¸å’Œæ¯”è¾ƒæŒ‡ä»¤ç»“åˆä½¿ç”¨ã€‚åœ¨æ¡ä»¶è·³è½¬æŒ‡ä»¤æ‰§è¡Œå‰ï¼Œä¸€èˆ¬å¯ä»¥å…ˆç”¨æ¯”è¾ƒæŒ‡ä»¤è¿›è¡Œæ ˆé¡¶å…ƒç´ çš„å‡†å¤‡ï¼Œç„¶åè¿›è¡Œæ¡ä»¶è·³è½¬ã€‚</p><ul><li><p>æ¡ä»¶è·³è½¬æŒ‡ä»¤æœ‰ï¼š</p><p><code>ifeq</code>ã€<code>iflt</code>ã€<code>ifle</code>ã€<code>ifne</code>ã€<code>ifgt</code>ã€<code>ifge</code>ã€<code>ifnull</code>ã€<code>ifnonnull</code>ã€‚è¿™äº›æŒ‡ä»¤éƒ½æ¥æ”¶ä¸¤ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ï¼Œç”¨äºè®¡ç®—è·³è½¬çš„ä½ç½®(16ä½ç¬¦å·æ•´æ•°ä½œä¸ºå½“å‰ä½ç½®çš„offset)ã€‚</p></li><li><p>å®ƒä»¬çš„ç»Ÿä¸€å«ä¹‰ä¸ºï¼šå¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œæµ‹è¯•å®ƒæ˜¯å¦æ»¡è¶³æŸä¸€æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™è·³è½¬åˆ°ç»™å®šä½ç½®ã€‚</p></li></ul><p><strong>å…·ä½“è¯´æ˜</strong></p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ifeq</code></td><td>å½“æ ˆé¡¶ int ç±»å‹æ•°å€¼ç­‰äº( == ) 0 æ—¶è·³è½¬</td></tr><tr><td><code>ifne</code></td><td>å½“æ ˆé¡¶ int ç±»å‹æ•°å€¼ä¸ç­‰äº( != ) 0 æ—¶è·³è½¬</td></tr><tr><td><code>iflt</code></td><td>å½“æ ˆé¡¶ int ç±»å‹æ•°å€¼å°äº( &lt; ) 0 æ—¶è·³è½¬</td></tr><tr><td><code>ifle</code></td><td>å½“æ ˆé¡¶ int ç±»å‹æ•°å€¼å°äºç­‰äº( &lt;= ) 0 æ—¶è·³è½¬</td></tr><tr><td><code>ifgt</code></td><td>å½“æ ˆé¡¶ int ç±»å‹æ•°å€¼å¤§äº( &gt; ) 0 æ—¶è·³è½¬</td></tr><tr><td><code>ifge</code></td><td>å½“æ ˆé¡¶ int ç±»å‹æ•°å€¼å¤§äºç­‰äº( &gt;= ) 0 æ—¶è·³è½¬</td></tr><tr><td><code>ifnull</code></td><td>ä¸º null æ—¶è·³è½¬</td></tr><tr><td><code>ifnonnull</code></td><td>ä¸ä¸º null æ—¶è·³è½¬</td></tr></tbody></table><p><img src="./../jvm-class2/image-20240106200908309.png" alt="æ§åˆ¶è½¬ç§»æŒ‡ä»¤ å­—èŠ‚ç ç¤ºä¾‹"></p><p><strong>æ³¨æ„</strong></p><ol><li>ä¸å‰é¢è¿ç®—è§„åˆ™ä¸€è‡´ï¼š<ul><li>å¯¹äºbooleanã€byteã€charã€short ç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œï¼Œéƒ½æ˜¯ä½¿ç”¨ int ç±»å‹çš„æ¯”è¾ƒæŒ‡ä»¤å®Œæˆ</li><li>å¯¹äºlongã€floatã€double ç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œï¼Œåˆ™ä¼šå…ˆæ‰§è¡Œç›¸åº”ç±»å‹çš„æ¯”è¾ƒè¿ç®—æŒ‡ä»¤ï¼Œè¿ç®—æŒ‡ä»¤ä¼šè¿”å›ä¸€ä¸ªæ•´å‹å€¼åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œéšåå†æ‰§è¡Œ int ç±»å‹çš„æ¡ä»¶åˆ†æ”¯æ¯”è¾ƒæ“ä½œæ¥å®Œæˆæ•´ä¸ªåˆ†æ”¯è·³è½¬</li></ul></li><li>ç”±äºå„ç±»å‹çš„æ¯”è¾ƒæœ€ç»ˆéƒ½ä¼šè½¬ä¸º int ç±»å‹çš„æ¯”è¾ƒæ“ä½œï¼Œæ‰€ä»¥ Java è™šæ‹Ÿæœºæä¾›çš„ int ç±»å‹çš„æ¡ä»¶åˆ†æ”¯æŒ‡ä»¤æ˜¯æœ€ä¸ºä¸°å¯Œå’Œå¼ºå¤§çš„ã€‚</li></ol><h3 id="2-æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤">2-æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤</h3><p>æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤ç±»ä¼¼äºæ¯”è¾ƒæŒ‡ä»¤å’Œæ¡ä»¶è·³è½¬æŒ‡ä»¤çš„ç»“åˆä½“ï¼Œå®ƒå°†æ¯”è¾ƒå’Œè·³è½¬ä¸¤ä¸ªæ­¥éª¤åˆäºŒä¸ºä¸€ã€‚</p><ul><li><p>è¿™ç±»æŒ‡ä»¤æœ‰ï¼š</p><p><code>if_icmpeq</code>ã€<code>if_icmpne</code>ã€<code>if_icmplt</code>ã€<code>if_icmpgt</code>ã€<code>if_icmple</code>ã€<code>if_icmpge</code>ã€<code>if_acmpeq</code> å’Œ <code>if_acmpne</code></p></li><li><p>å…¶ä¸­æŒ‡ä»¤åŠ©è®°ç¬¦åŠ ä¸Š <code>if_</code> åï¼Œä»¥å­—ç¬¦ â€œiâ€ å¼€å¤´çš„æŒ‡ä»¤é’ˆå¯¹ int å‹æ•´æ•°æ“ä½œï¼ˆä¹ŸåŒ…æ‹¬ short å’Œ byte ç±»å‹ï¼‰ï¼Œä»¥å­—ç¬¦ â€œaâ€ å¼€å¤´çš„æŒ‡ä»¤è¡¨ç¤ºå¯¹è±¡å¼•ç”¨çš„æ¯”è¾ƒã€‚</p></li></ul><p><strong>å…·ä½“è¯´æ˜</strong></p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>if_icmpeq</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤ int ç±»å‹æ•°å€¼å¤§å°, å½“å‰è€…ç­‰äº( == )åè€…æ—¶è·³è½¬</td></tr><tr><td>if_icmpne</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤ int ç±»å‹æ•°å€¼å¤§å°, å½“å‰è€…ä¸ç­‰äº( != )åè€…æ—¶è·³è½¬</td></tr><tr><td>if_icmplt</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤ int ç±»å‹æ•°å€¼å¤§å°, å½“å‰è€…å°äº( &lt; )åè€…æ—¶è·³è½¬</td></tr><tr><td>if_icmple</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤ int ç±»å‹æ•°å€¼å¤§å°, å½“å‰è€…å°äºç­‰äº( &lt;= )åè€…æ—¶è·³è½¬</td></tr><tr><td>if_icmpgt</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤ int ç±»å‹æ•°å€¼å¤§å°, å½“å‰è€…å¤§äº( &gt; )åè€…æ—¶è·³è½¬</td></tr><tr><td>if_icmpge</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤ int ç±»å‹æ•°å€¼å¤§å°, å½“å‰è€…å¤§äºç­‰äº( &gt;= )åè€…æ—¶è·³è½¬</td></tr><tr><td>if_acmpeq</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤å¼•ç”¨ç±»å‹æ•°å€¼, å½“ç»“æœç›¸ç­‰( == )æ—¶è·³è½¬</td></tr><tr><td>if_acmpne</td><td>æ¯”è¾ƒæ ˆé¡¶ä¸¤å¼•ç”¨ç±»å‹æ•°å€¼, å½“ç»“æœä¸ç›¸ç­‰( != )æ—¶è·³è½¬</td></tr></tbody></table><p>è¿™äº›æŒ‡ä»¤éƒ½æ¥æ”¶ä¸¤ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ä½œä¸ºå‚æ•°ï¼Œç”¨äºè®¡ç®—è·³è½¬çš„ä½ç½®ã€‚åŒæ—¶åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œæ ˆé¡¶éœ€è¦å‡†å¤‡ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p><p>æŒ‡ä»¤æ‰§è¡Œå®Œæˆåï¼Œæ ˆé¡¶çš„è¿™ä¸¤ä¸ªå…ƒç´ è¢«æ¸…ç©ºï¼Œä¸”æ²¡æœ‰ä»»ä½•æ•°æ®å…¥æ ˆã€‚<strong>å¦‚æœé¢„è®¾æ¡ä»¶æˆç«‹ï¼Œåˆ™æ‰§è¡Œè·³è½¬ï¼Œå¦åˆ™ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ã€‚</strong></p><p><img src="./../jvm-class2/image-20240106203044098.png" alt="æ¯”è¾ƒæ¡ä»¶è·³è½¬æŒ‡ä»¤ å­—èŠ‚ç ç¤ºä¾‹"></p><h3 id="3-å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬">3-å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬</h3><p>å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤æ˜¯ä¸“ä¸º switch-case è¯­å¥è®¾è®¡çš„ï¼Œä¸»è¦æœ‰ <code>tableswitch</code> å’Œ <code>lookupswitch</code>ã€‚</p><table><thead><tr><th>æŒ‡ä»¤åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>tableswitch</td><td>ç”¨äº switch æ¡ä»¶è·³è½¬, case å€¼è¿ç»­</td></tr><tr><td>lookupswitch</td><td>ç”¨äº switch æ¡ä»¶è·³è½¬, case å€¼ä¸è¿ç»­</td></tr></tbody></table><p>ä»åŠ©è®°ç¬¦ä¸Šçœ‹ï¼Œä¸¤è€…éƒ½æ˜¯ switch è¯­å¥çš„å®ç°ï¼Œå®ƒä»¬çš„åŒºåˆ«ï¼š</p><ul><li><code>tableswitch</code> è¦æ±‚<strong>å¤šä¸ªæ¡ä»¶åˆ†æ”¯å€¼æ˜¯è¿ç»­çš„</strong>ï¼Œå®ƒå†…éƒ¨åªå­˜æ”¾èµ·å§‹å€¼å’Œç»ˆæ­¢å€¼ï¼Œä»¥åŠè‹¥å¹²ä¸ªè·³è½¬åç§»é‡ï¼Œé€šè¿‡ç»™å®šçš„æ“ä½œæ•° index ,å¯ä»¥ç«‹å³å®šä½åˆ°è·³è½¬åç§»é‡ä½ç½®ï¼Œå› æ­¤æ•ˆç‡æ¯”è¾ƒé«˜ã€‚</li><li>æŒ‡ä»¤ <code>lookupswitch</code> å†…éƒ¨<strong>å­˜æ”¾ç€å„ä¸ªç¦»æ•£çš„ case-offset å¯¹</strong>ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½è¦æœç´¢å…¨éƒ¨çš„case-offsetå¯¹ï¼Œæ‰¾åˆ°åŒ¹é…çš„ case å€¼ï¼Œå¹¶æ ¹æ®å¯¹åº”çš„ offset è®¡ç®—è·³è½¬åœ°å€ï¼Œå› æ­¤<strong>æ•ˆç‡è¾ƒä½</strong>ã€‚</li></ul><p>æŒ‡ä»¤ <code>tableswitch</code> çš„ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç”±äº tableswitch çš„ case å€¼æ˜¯è¿ç»­çš„ï¼Œå› æ­¤åªéœ€è¦è®°å½•æœ€ä½å€¼å’Œæœ€é«˜å€¼ï¼Œä»¥åŠæ¯ä¸€é¡¹å¯¹åº”çš„ offset åç§»é‡ï¼Œæ ¹æ®ç»™å®šçš„ index å€¼é€šè¿‡ç®€å•çš„è®¡ç®—å³å¯ç›´æ¥å®šä½åˆ° offsetã€‚</p><p><img src="./../jvm-class2/image-20240106205131253.png" alt=""></p><p>æŒ‡ä»¤ <code>lookupswitch</code> å¤„ç†çš„æ˜¯ç¦»æ•£çš„ case å€¼ï¼Œä½†æ˜¯å‡ºäºæ•ˆç‡è€ƒè™‘ï¼Œ<strong>å°† case-offset å¯¹æŒ‰ç…§ case å€¼å¤§å°æ’åº</strong>ï¼Œç»™å®š index æ—¶ï¼Œéœ€è¦æŸ¥æ‰¾ä¸ index ç›¸ç­‰çš„ caseï¼Œè·å¾—å…¶ offsetï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™è·³è½¬åˆ° defaultã€‚æŒ‡ä»¤ <code>lookupswitch</code> å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="./../jvm-class2/image-20240106205707776.png" alt=""></p><p><img src="./../jvm-class2/image-20240106214520880.png" alt="å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬ intç±»å‹"></p><p><img src="./../jvm-class2/image-20240106214843775.png" alt="å¤šæ¡ä»¶åˆ†æ”¯è·³è½¬ Stringç±»å‹"></p><h3 id="4-æ— æ¡ä»¶è·³è½¬">4-æ— æ¡ä»¶è·³è½¬</h3><p>ç›®å‰ä¸»è¦çš„æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ä¸º <code>goto</code>ã€‚æŒ‡ä»¤ <code>goto</code> æ¥æ”¶ä¸¤ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ï¼Œå…±åŒç»„æˆä¸€ä¸ªå¸¦ç¬¦å·çš„æ•´æ•°ï¼Œ<strong>ç”¨äºæŒ‡å®šæŒ‡ä»¤çš„åç§»é‡ï¼ŒæŒ‡ä»¤æ‰§è¡Œçš„ç›®çš„å°±æ˜¯è·³è½¬åˆ°åç§»é‡ç»™å®šçš„ä½ç½®å¤„ã€‚</strong></p><p>å¦‚æœæŒ‡ä»¤åç§»é‡å¤ªå¤§ï¼Œè¶…è¿‡åŒå­—èŠ‚çš„å¸¦ç¬¦å·æ•´æ•°çš„èŒƒå›´ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æŒ‡ä»¤ <code>goto_w</code>,å®ƒå’Œ <code>goto</code> æœ‰ç›¸åŒçš„ä½œç”¨ï¼Œä½†æ˜¯å®ƒæ¥æ”¶4ä¸ªå­—èŠ‚çš„æ“ä½œæ•°ï¼Œå¯ä»¥è¡¨ç¤ºæ›´å¤§çš„åœ°å€èŒƒå›´ã€‚</p><p>æŒ‡ä»¤ <code>jsr</code>ã€<code>jsr_w</code>ã€<code>ret</code> è™½ç„¶ä¹Ÿæ˜¯æ— æ¡ä»¶è·³è½¬çš„ï¼Œä½†ä¸»è¦ç”¨äº try-finally è¯­å¥ï¼Œä¸”å·±ç»è¢«è™šæ‹Ÿæœºé€æ¸åºŸå¼ƒï¼Œæ•…ä¸åœ¨è¿™é‡Œä»‹ç»è¿™ä¸¤ä¸ªæŒ‡ä»¤ã€‚</p><table><thead><tr><th>æŒ‡ä»¤åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>goto</td><td>æ— æ¡ä»¶è·³è½¬</td></tr><tr><td>goto_w</td><td>æ— æ¡ä»¶è·³è½¬(å®½ç´¢å¼•)</td></tr><tr><td>jsr</td><td>è·³è½¬è‡³æŒ‡å®š16ä½ offset ä½ç½®, å¹¶å°† jsr ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹å…¥æ ˆé¡¶</td></tr><tr><td>jsr_w</td><td>è·³è½¬è‡³æŒ‡å®š32ä½ offset ä½ç½®, å¹¶å°† jsr_w ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹å…¥æ ˆé¡¶</td></tr><tr><td>ret</td><td>è¿”å›è‡³ç”±æŒ‡å®šçš„å±€éƒ¨å˜é‡æ‰€ç»™å‡ºçš„æŒ‡ä»¤ä½ç½®(ä¸€èˆ¬ä¸ jsrã€jsr_w è”åˆä½¿ç”¨)</td></tr></tbody></table><p><img src="./../jvm-class2/image-20240106223005785.png" alt="æ— æ¡ä»¶è·³è½¬ å­—èŠ‚ç ç¤ºä¾‹"></p><p><img src="./../jvm-class2/image-20240106223332201.png" alt="æ— æ¡ä»¶è·³è½¬ å­—èŠ‚ç ç¤ºä¾‹"></p><h2 id="09-å¼‚å¸¸å¤„ç†æŒ‡ä»¤">09-å¼‚å¸¸å¤„ç†æŒ‡ä»¤</h2><h3 id="1-æŠ›å‡ºå¼‚å¸¸æŒ‡ä»¤">1-æŠ›å‡ºå¼‚å¸¸æŒ‡ä»¤</h3><ol><li><p><code>athrow</code> æŒ‡ä»¤</p><p>åœ¨ Java ç¨‹åºä¸­æ˜¾ç¤ºæŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ(throw è¯­å¥)éƒ½æ˜¯ç”± <code>athrow</code> æŒ‡ä»¤æ¥å®ç°</p><p>é™¤äº†ä½¿ç”¨ throw è¯­å¥æ˜¾ç¤ºæŠ›å‡ºå¼‚å¸¸æƒ…å†µä¹‹å¤–ï¼Œ<strong>JVM è§„èŒƒè¿˜è§„å®šäº†è®¸å¤šè¿è¡Œæ—¶å¼‚å¸¸ä¼šåœ¨å…¶ä»–Javaè™šæ‹ŸæœºæŒ‡ä»¤æ£€æµ‹åˆ°å¼‚å¸¸çŠ¶å†µæ—¶è‡ªåŠ¨æŠ›å‡ºã€‚</strong></p><ul><li>ä¾‹å¦‚ï¼Œåœ¨ä¹‹å‰ä»‹ç»çš„æ•´æ•°è¿ç®—æ—¶ï¼Œå½“é™¤æ•°ä¸ºé›¶æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåœ¨ <code>idiv</code> æˆ– <code>ldiv</code> æŒ‡ä»¤ä¸­æŠ›å‡º ArithmeticException å¼‚å¸¸ã€‚</li></ul></li><li><p><strong>æ³¨æ„</strong></p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ“ä½œæ•°æ ˆçš„å‹å…¥å¼¹å‡ºéƒ½æ˜¯ä¸€æ¡æ¡æŒ‡ä»¤å®Œæˆçš„ã€‚å”¯ä¸€çš„ä¾‹å¤–æƒ…å†µæ˜¯<strong>åœ¨æŠ›å¼‚å¸¸æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šæ¸…é™¤æ“ä½œæ•°æ ˆä¸Šçš„æ‰€æœ‰å†…å®¹ï¼Œè€Œåå°†å¼‚å¸¸å®ä¾‹å‹å…¥è°ƒç”¨è€…æ“ä½œæ•°æ ˆä¸Šã€‚</strong></p></li></ol><blockquote><p>å¼‚å¸¸åŠå¼‚å¸¸çš„å¤„ç†:</p><p>è¿‡ç¨‹ä¸€: å¼‚å¸¸å¯¹è±¡çš„ç”Ÿæˆè¿‡ç¨‹ â€”&gt; thorw(æ‰‹åŠ¨ / è‡ªåŠ¨) â€”&gt; æŒ‡ä»¤: <code>athrow</code></p><p>è¿‡ç¨‹äºŒ: å¼‚å¸¸çš„å¤„ç†: æŠ“æŠ›æ¨¡å‹. try-catch-finally â€”&gt; ä½¿ç”¨å¼‚å¸¸è¡¨</p></blockquote><p><img src="./../jvm-class2/image-20240106225108694.png" alt="æŠ›å‡ºå¼‚å¸¸æŒ‡ä»¤"></p><h3 id="2-å¼‚å¸¸å¤„ç†ä¸å¼‚å¸¸è¡¨">2-å¼‚å¸¸å¤„ç†ä¸å¼‚å¸¸è¡¨</h3><p><strong>1ã€å¤„ç†å¼‚å¸¸</strong></p><p>åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œå¤„ç†å¼‚å¸¸(catch è¯­å¥)ä¸æ˜¯ç”±å­—èŠ‚ç æŒ‡ä»¤æ¥å®ç°çš„ï¼ˆæ—©æœŸä½¿ç”¨jsrã€ret æŒ‡ä»¤ï¼‰ï¼Œè€Œæ˜¯<strong>é‡‡ç”¨å¼‚å¸¸è¡¨æ¥å®Œæˆçš„</strong>ã€‚</p><p><strong>2ã€å¼‚å¸¸è¡¨</strong></p><p>å¦‚æœä¸€ä¸ªæ–¹æ³•å®šä¹‰äº†ä¸€ä¸ª try-catch æˆ–è€… try-finally çš„å¼‚å¸¸å¤„ç†ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå¼‚å¸¸è¡¨ã€‚å®ƒåŒ…å«äº†æ¯ä¸ªå¼‚å¸¸å¤„ç†æˆ–è€… finally å—çš„ä¿¡æ¯ã€‚å¼‚å¸¸è¡¨ä¿å­˜äº†æ¯ä¸ªå¼‚å¸¸å¤„ç†ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š</p><ul><li>èµ·å§‹ä½ç½®</li><li>ç»“æŸä½ç½®</li><li>ç¨‹åºè®¡æ•°å™¨è®°å½•çš„ä»£ç å¤„ç†çš„åç§»åœ°å€</li><li>è¢«æ•è·çš„å¼‚å¸¸ç±»åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•</li></ul><p><strong>å½“ä¸€ä¸ªå¼‚å¸¸è¢«æŠ›å‡ºæ—¶ï¼ŒJVM ä¼šåœ¨å½“å‰çš„æ–¹æ³•é‡Œå¯»æ‰¾ä¸€ä¸ªåŒ¹é…çš„å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¼ºåˆ¶ç»“æŸå¹¶å¼¹å‡ºå½“å‰æ ˆå¸§</strong>ï¼Œå¹¶ä¸”å¼‚å¸¸ä¼šé‡æ–°æŠ›ç»™ä¸Šå±‚è°ƒç”¨çš„æ–¹æ³•ï¼ˆåœ¨è°ƒç”¨æ–¹æ³•æ ˆå¸§ï¼‰ã€‚å¦‚æœåœ¨æ‰€æœ‰æ ˆå¸§å¼¹å‡ºå‰ä»ç„¶æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å¼‚å¸¸å¤„ç†ï¼Œè¿™ä¸ªçº¿ç¨‹å°†ç»ˆæ­¢ã€‚å¦‚æœè¿™ä¸ªå¼‚å¸¸åœ¨æœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹é‡ŒæŠ›å‡ºï¼Œå°†ä¼šå¯¼è‡´ JVM è‡ªå·±ç»ˆæ­¢ï¼Œæ¯”å¦‚è¿™ä¸ªçº¿ç¨‹æ˜¯ä¸ª main çº¿ç¨‹ã€‚</p><p><strong>ä¸ç®¡ä»€ä¹ˆæ—¶å€™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœå¼‚å¸¸å¤„ç†æœ€ç»ˆåŒ¹é…äº†æ‰€æœ‰å¼‚å¸¸ç±»å‹ï¼Œä»£ç å°±ä¼šç»§ç»­æ‰§è¡Œ</strong>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ–¹æ³•ç»“æŸåæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œä»ç„¶æ‰§è¡Œ finally å—ï¼Œåœ¨ return å‰ï¼Œå®ƒç›´æ¥è·³åˆ° finally å—æ¥å®Œæˆç›®æ ‡ã€‚</p><p><img src="./../jvm-class2/image-20240106230756279.png" alt="å¼‚å¸¸å¤„ç† å­—èŠ‚ç ç¤ºä¾‹"></p><p><img src="./../jvm-class2/image-20240106232311847.png" alt="æ€è€ƒé¢˜"></p><h2 id="10-åŒæ­¥æ§åˆ¶æŒ‡ä»¤">10-åŒæ­¥æ§åˆ¶æŒ‡ä»¤</h2><p><strong>ç»„æˆ</strong></p><p>Java è™šæ‹Ÿæœºæ”¯æŒä¸¤ç§åŒæ­¥ç»“æ„ï¼š<strong>æ–¹æ³•çº§çš„åŒæ­¥</strong>å’Œ<strong>æ–¹æ³•å†…éƒ¨ä¸€æ®µæŒ‡ä»¤åºåˆ—çš„åŒæ­¥</strong>ï¼Œè¿™ä¸¤ç§åŒæ­¥éƒ½æ˜¯ä½¿ç”¨ monitor æ¥æ”¯æŒçš„ã€‚</p><h3 id="1-æ–¹æ³•çº§çš„åŒæ­¥">1-æ–¹æ³•çº§çš„åŒæ­¥</h3><p>æ–¹æ³•çº§çš„åŒæ­¥ï¼š<strong>æ˜¯éšå¼çš„</strong>ï¼Œå³æ— é¡»é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œä¹‹ä¸­ã€‚è™šæ‹Ÿæœºå¯ä»¥ä»æ–¹æ³•å¸¸é‡æ± çš„æ–¹æ³•è¡¨ç»“æ„ä¸­çš„ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—å¾—çŸ¥ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼›</p><p>å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ˜¯å¦è®¾ç½®ã€‚</p><ul><li>å¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆæŒæœ‰åŒæ­¥é”ï¼Œç„¶åæ‰§è¡Œæ–¹æ³•ã€‚æœ€ååœ¨æ–¹æ³•å®Œæˆï¼ˆæ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆï¼‰æ—¶<strong>é‡Šæ”¾åŒæ­¥é”</strong>ã€‚</li><li>åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œçº¿ç¨‹æŒæœ‰äº†åŒæ­¥é”ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å¾—åŒä¸€ä¸ªé”ã€‚</li><li>å¦‚æœä¸€ä¸ªåŒæ­¥æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨æ— æ³•å¤„ç†æ­¤å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªåŒæ­¥æ–¹æ³•æ‰€æŒæœ‰çš„é”å°†åœ¨å¼‚å¸¸æŠ›åˆ°åŒæ­¥æ–¹æ³•ä¹‹å¤–æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚</li></ul><p><img src="./../jvm-class2/image-20240106233448740.png" alt=""></p><p><strong>è¯´æ˜ï¼š</strong><br>è¿™æ®µä»£ç å’Œæ™®é€šçš„æ— åŒæ­¥æ“ä½œçš„ä»£ç æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œæ²¡æœ‰ä½¿ç”¨ monitorenter å’Œ monitorexit è¿›è¡ŒåŒæ­¥åŒºæ§åˆ¶ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹äºåŒæ­¥æ–¹æ³•è€Œè¨€ï¼Œ<strong>å½“è™šæ‹Ÿæœºé€šè¿‡æ–¹æ³•çš„è®¿é—®æ ‡ç¤ºç¬¦åˆ¤æ–­æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨æ–¹æ³•è°ƒç”¨å‰è¿›è¡ŒåŠ é”</strong>ï¼Œå½“åŒæ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œä¸ç®¡æ–¹æ³•æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œå‡ä¼šç”±è™šæ‹Ÿæœºé‡Šæ”¾è¿™ä¸ªé”ã€‚å› æ­¤ï¼Œå¯¹äºåŒæ­¥æ–¹æ³•è€Œè¨€ï¼Œmonitorenter å’Œ<br>monitorexit æŒ‡ä»¤æ˜¯éšå¼å­˜åœ¨çš„ï¼Œå¹¶æœªç›´æ¥å‡ºç°åœ¨å­—èŠ‚ç ä¸­ã€‚</p><h3 id="2-æ–¹æ³•å†…æŒ‡å®šæŒ‡ä»¤åºåˆ—çš„åŒæ­¥">2-æ–¹æ³•å†…æŒ‡å®šæŒ‡ä»¤åºåˆ—çš„åŒæ­¥</h3><p>åŒæ­¥ä¸€æ®µæŒ‡ä»¤é›†åºåˆ—ï¼šé€šå¸¸æ˜¯ç”± Java ä¸­çš„ synchronized è¯­å¥å—æ¥è¡¨ç¤ºçš„ã€‚JVM çš„æŒ‡ä»¤é›†æœ‰ <code>monitorenter</code> å’Œ <code>monitorexit</code> ä¸¤æ¡æŒ‡ä»¤æ¥æ”¯æŒ <code>synchronized</code> å…³é”®å­—çš„è¯­ä¹‰ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒä½¿ç”¨ <code>monitorenter</code> æŒ‡ä»¤è¯·æ±‚è¿›å…¥ã€‚å¦‚æœå½“å‰å¯¹è±¡çš„ç›‘è§†å™¨è®¡æ•°å™¨ä¸º0ï¼Œåˆ™å®ƒä¼šè¢«å‡†è®¸è¿›å…¥ï¼Œè‹¥ä¸º1ï¼Œåˆ™åˆ¤æ–­æŒæœ‰å½“å‰ç›‘è§†å™¨çš„çº¿ç¨‹æ˜¯å¦ä¸ºè‡ªå·±ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›å…¥ï¼Œå¦åˆ™è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°å¯¹è±¡çš„ç›‘è§†å™¨è®¡æ•°å™¨ä¸º0ï¼Œæ‰ä¼šè¢«å…è®¸è¿›å…¥åŒæ­¥å—ã€‚</p><p>å½“çº¿ç¨‹é€€å‡ºåŒæ­¥å—æ—¶ï¼Œéœ€è¦ä½¿ç”¨ monitorexit å£°æ˜é€€å‡ºã€‚åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç›‘è§†å™¨ä¸ä¹‹ç›¸å…³è”ï¼Œç”¨æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«é”å®šï¼Œå½“ç›‘è§†å™¨è¢«æŒæœ‰åï¼Œå¯¹è±¡å¤„äºé”å®šçŠ¶æ€ã€‚</p><p>æŒ‡ä»¤ monitorenter å’Œ monitorexit åœ¨æ‰§è¡Œæ—¶ï¼Œéƒ½éœ€è¦åœ¨æ“ä½œæ•°æ ˆé¡¶å‹å…¥å¯¹è±¡ï¼Œä¹‹å monitorenter å’Œ monitorexit çš„é”å®šå’Œé‡Šæ”¾éƒ½æ˜¯é’ˆå¯¹è¿™ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨è¿›è¡Œçš„ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†ç›‘è§†å™¨å¦‚ä½•ä¿æŠ¤ä¸´ç•ŒåŒºä»£ç ä¸åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œåªæœ‰å½“çº¿ç¨‹4ç¦»å¼€ä¸´ç•ŒåŒºåï¼Œçº¿ç¨‹1ã€2ã€3æ‰æœ‰å¯èƒ½è¿›å…¥ã€‚</p><p><img src="./../jvm-class2/image-20240106233717918.png" alt=""></p><p><img src="./../jvm-class2/image-20240106234904022.png" alt="æŒ‡å®šæŒ‡ä»¤åºåˆ—åŒæ­¥ å­—èŠ‚ç ç¤ºä¾‹"></p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-Class-01-classæ–‡ä»¶ç»“æ„</title>
      <link href="/2024/01/02/jvm-class1/"/>
      <url>/2024/01/02/jvm-class1/</url>
      
        <content type="html"><![CDATA[<h1>Classæ–‡ä»¶ç»“æ„</h1><h2 id="01-æ¦‚è¿°">01-æ¦‚è¿°</h2><h3 id="å­—èŠ‚ç æ–‡ä»¶çš„è·¨å¹³å°æ€§">å­—èŠ‚ç æ–‡ä»¶çš„è·¨å¹³å°æ€§</h3><p><strong>1. Javaè¯­è¨€: è·¨å¹³å°çš„è¯­è¨€</strong></p><ul><li>å½“Javaæºä»£ç æˆåŠŸç¼–è¯‘æˆå­—èŠ‚ç å, å¦‚æœæƒ³åœ¨ä¸åŒçš„å¹³å°ä¸Šé¢è¿è¡Œ, åˆ™æ— åºå†æ¬¡ç¼–è¯‘</li><li>è¿™ä¸ªåˆæ˜¯ä¸å†é‚£ä¹ˆå¸å¼•äººäº†. Pythonã€PHPã€Perlã€Rubyã€Lispç­‰æœ‰å¼ºå¤§çš„è§£é‡Šå™¨.</li><li>è·¨å¹³å°ä¼¼ä¹å·²ç»æˆä¸ºä¸€é—¨è¯­è¨€å¿…é€‰çš„ç‰¹æ€§</li></ul><p><strong>2. Javaè™šæ‹Ÿæœº: è·¨è¯­è¨€çš„å¹³å°</strong></p><p><strong>Javaè™šæ‹Ÿæœºä¸å’ŒåŒ…æ‹¬Javaåœ¨å†…çš„ä»»ä½•è¯­è¨€ç»‘å®šï¼Œå®ƒåªä¸&quot;Classæ–‡ä»¶&quot;è¿™ç§ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼æ‰€å…³è”</strong>ã€‚æ— è®ºä½¿ç”¨ä½•ç§è¯­è¨€è¿›è¡Œè½¯ä»¶å¼€å‘ï¼Œåªè¦èƒ½å°†æºæ–‡ä»¶ç¼–è¯‘ä¸ºæ­£ç¡®çš„Classæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ç§è¯­è¨€å°±å¯ä»¥åœ¨Javaè™šæ‹Ÿæœºä¸Šæ‰§è¡Œã€‚å¯ä»¥è¯´ï¼Œç»Ÿä¸€è€Œå¼ºå¤§çš„Classæ–‡ä»¶ç»“æ„ï¼Œå°±æ˜¯)avaè™šæ‹Ÿæœºçš„åŸºçŸ³ã€æ¡¥æ¢ã€‚</p><p><img src="./../jvm-class1/image-20240102211419534.png" alt=""></p><ul><li>æ‰€æœ‰çš„JVMå…¨éƒ¨éµå®ˆJavaè™šæ‹Ÿæœºè§„èŒƒï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„JVMç¯å¢ƒéƒ½æ˜¯ä¸€æ ·çš„, è¿™æ ·ä¸€æ¥å­—èŠ‚ç æ–‡ä»¶å¯ä»¥åœ¨å„ç§JVMä¸Šè¿è¡Œã€‚</li></ul><p><strong>3. æƒ³è¦è®©ä¸€ä¸ªJavaç¨‹åºæ­£ç¡®åœ°è¿è¡Œåœ¨JVMä¸­ï¼ŒJavaæºç å°±å¿…é¡»è¦è¢«ç¼–è¯‘ä¸ºç¬¦åˆJVMè§„èŒƒçš„å­—èŠ‚ç ã€‚</strong></p><ul><li>å‰ç«¯ç¼–è¯‘å™¨çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯è´Ÿè´£å°†ç¬¦åˆJavaè¯­æ³•è§„èŒƒçš„Javaä»£ç è½¬æ¢ä¸ºç¬¦åˆJVMè§„èŒƒçš„å­—èŠ‚ç æ–‡ä»¶ã€‚</li><li>javacæ˜¯ä¸€ç§èƒ½å¤Ÿå°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç çš„å‰ç«¯ç¼–è¯‘å™¨ã€‚</li><li>Javacç¼–è¯‘å™¨åœ¨å°†Javaæºç ç¼–è¯‘ä¸ºä¸€ä¸ªæœ‰æ•ˆçš„å­—èŠ‚ç æ–‡ä»¶è¿‡ç¨‹ä¸­ç»å†äº†4ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯<strong>è¯æ³•è§£æã€è¯­æ³•è§£æã€è¯­ä¹‰è§£æä»¥åŠç”Ÿæˆå­—èŠ‚ç </strong>ã€‚</li></ul><p><img src="./../jvm-class1/02.jpg" alt=""></p><p>Oracleçš„JDKè½¯ä»¶åŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹:</p><ul><li>ä¸€éƒ¨åˆ†æ˜¯å°†Javaæºä»£ç ç¼–è¯‘æˆJavaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†çš„ç¼–è¯‘å™¨</li><li>å¦ä¸€éƒ¨åˆ†æ˜¯ç”¨äºå®ç°Javaè™šæ‹Ÿæœºçš„è¿è¡Œæ—¶ç¯å¢ƒ</li></ul><h3 id="Javaçš„å‰ç«¯ç¼–è¯‘å™¨">Javaçš„å‰ç«¯ç¼–è¯‘å™¨</h3><p><img src="./../jvm-class1/03.jpg" alt=""></p><p>å‰ç«¯ç¼–è¯‘å™¨ VS åç«¯ç¼–è¯‘å™¨</p><ul><li>Javaæºä»£ç çš„ç¼–è¯‘ç»“æœæ˜¯å­—èŠ‚ç ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦æœ‰ä¸€ç§ç¼–è¯‘å™¨èƒ½å¤Ÿå°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œæ‰¿æ‹…è¿™ä¸ªé‡è¦è´£ä»»çš„å°±æ˜¯é…ç½®åœ¨pathç¯å¢ƒå˜é‡ä¸­çš„<strong>javacç¼–è¯‘å™¨</strong>ã€‚javacæ˜¯ä¸€ç§èƒ½å¤Ÿå°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç çš„<strong>å‰ç«¯ç¼–è¯‘å™¨</strong>ã€‚</li><li>HotSpot VMå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚å‰ç«¯ç¼–è¯‘å™¨åªèƒ½ä½¿ç”¨javac:æ¥ç¼–è¯‘å­—èŠ‚ç ï¼Œå…¶å®åªè¦ç¼–è¯‘ç»“æœç¬¦åˆJVMè§„èŒƒéƒ½å¯ä»¥è¢«JVMæ‰€è¯†åˆ«å³å¯ã€‚åœ¨Javaçš„å‰ç«¯ç¼–è¯‘å™¨é¢†åŸŸï¼Œé™¤äº†javac, ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§è¢«å¤§å®¶ç»å¸¸ç”¨åˆ°çš„å‰ç«¯ç¼–è¯‘å™¨ï¼Œé‚£å°±æ˜¯å†…ç½®åœ¨Eclipseä¸­çš„ECJ**(Eclipse Compiler for Java)ç¼–è¯‘å™¨**ã€‚å’ŒJavacçš„å…¨é‡å¼ç¼–è¯‘ä¸åŒï¼ŒECJæ˜¯ä¸€ç§å¢é‡å¼ç¼–è¯‘å™¨ã€‚<ul><li>åœ¨Eclipseä¸­ï¼Œå½“å¼€å‘äººå‘˜ç¼–å†™å®Œä»£ç åï¼Œä½¿ç”¨<code>ctrl+S</code>å¿«æ·é”®æ—¶ï¼ŒECJç¼–è¯‘å™¨æ‰€é‡‡å–çš„<strong>ç¼–è¯‘æ–¹æ¡ˆ</strong>æ˜¯æŠŠæœªç¼–è¯‘éƒ¨åˆ†çš„æºç é€è¡Œè¿›è¡Œç¼–è¯‘ï¼Œè€Œéæ¯æ¬¡éƒ½å…¨é‡ç¼–è¯‘ã€‚å› æ­¤ECJçš„ç¼–è¯‘æ•ˆç‡ä¼šæ¯”javacæ›´åŠ è¿…é€Ÿå’Œé«˜æ•ˆï¼Œå½“ç„¶ç¼–è¯‘è´¨é‡å’Œjavacç›¸æ¯”å¤§è‡´è¿˜æ˜¯ä¸€æ ·çš„</li><li>ECJä¸ä»…æ˜¯Eclipseçš„é»˜è®¤å†…ç½®å‰ç«¯ç¼–è¯‘å™¨ï¼Œåœ¨Tomcatä¸­åŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨Ec]ç¼–è¯‘å™¨æ¥ç¼–è¯‘jspæ–‡ä»¶ã€‚ç”±äºECJç¼–è¯‘å™¨æ˜¯é‡‡ç”¨GPLv2çš„å¼€æºåè®®è¿›è¡Œæºä»£ç å…¬å¼€ï¼Œæ‰€ä»¥ï¼Œå¤§å®¶å¯ä»¥ç™»å½•eclipseå®˜ç½‘ä¸‹è½½ECJç¼–è¯‘å™¨çš„æºç è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒIntelli]IDEAä½¿ç”¨javacç¼–è¯‘å™¨ã€‚ï¼ˆè¿˜å¯ä»¥è‡ªå·±è®¾ç½®ä¸ºAspectJç¼–è¯‘å™¨ajc)</li></ul></li><li>å‰ç«¯ç¼–è¯‘å™¨å¹¶ä¸ä¼šç›´æ¥æ¶‰åŠç¼–è¯‘ä¼˜åŒ–ç­‰æ–¹é¢çš„æŠ€æœ¯ï¼Œè€Œæ˜¯å°†è¿™äº›å…·ä½“ä¼˜åŒ–ç»†èŠ‚ç§»äº¤ç»™HotSpotçš„]ITç¼–è¯‘å™¨è´Ÿè´£ã€‚<br>å¤ä¹ ï¼šA0T(é™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead of Time Compiler)</li></ul><h3 id="é€è¿‡å­—èŠ‚ç æŒ‡ä»¤çœ‹ä»£ç ç»†èŠ‚">é€è¿‡å­—èŠ‚ç æŒ‡ä»¤çœ‹ä»£ç ç»†èŠ‚</h3><p><strong>é¢è¯•é¢˜</strong></p><ol><li>ç±»æ–‡ä»¶ç»“æ„æœ‰å‡ ä¸ªéƒ¨åˆ†</li><li>çŸ¥é“å­—èŠ‚ç å—? å­—èŠ‚ç éƒ½æœ‰å“ªäº›? <code>Integer x = 5; int y = 5; æ¯”è¾ƒ x == y</code> éƒ½ç»è¿‡å“ªäº›æ­¥éª¤</li></ol><p><strong>ä»£ç ä¸¾ä¾‹</strong></p><p>demo1</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Integer</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>    <span class="token class-name">Integer</span> i3 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>    <span class="token class-name">Integer</span> i4 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>demo2</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">"helloworld"</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str <span class="token operator">==</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>demo3ğŸ‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Father.x = "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span><span class="token comment">//    float x = 30.1F;</span>    <span class="token keyword">public</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        x <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Son.x = "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SonTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Father</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æˆå‘˜å˜é‡ï¼ˆéé™æ€çš„ï¼‰çš„èµ‹å€¼è¿‡ç¨‹ï¼š</strong></p><ol><li>é»˜è®¤åˆå§‹åŒ–</li><li>æ˜¾å¼åˆå§‹åŒ– /ä»£ç å—ä¸­åˆå§‹åŒ–</li><li>æ„é€ å™¨ä¸­åˆå§‹åŒ–</li><li>æœ‰äº†å¯¹è±¡ä¹‹åï¼Œå¯ä»¥&quot;å¯¹è±¡.å±æ€§&quot;æˆ–&quot;å¯¹è±¡.æ–¹æ³•&quot;<br>çš„æ–¹å¼å¯¹æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼ã€‚</li></ol><p><img src="./../jvm-class1/image-20240102223451407.png" alt=""></p><h2 id="02-è™šæ‹Ÿæœºçš„åŸºçŸ³ï¼šClassæ–‡ä»¶">02-è™šæ‹Ÿæœºçš„åŸºçŸ³ï¼šClassæ–‡ä»¶</h2><p><strong>å­—èŠ‚ç æ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆ?</strong></p><ul><li>æºä»£ç ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åä¾¿ä¼šç”Ÿæˆä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶, å­—èŠ‚ç æ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„ç±»æ–‡ä»¶, å®ƒçš„å†…å®¹æ˜¯JVMçš„æŒ‡ä»¤, è€Œä¸åƒCã€C++ç»ç”±ç¼–è¯‘å™¨ç›´æ¥ç”Ÿæˆ<strong>æœºå™¨ç </strong></li></ul><p><strong>ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤(byte code)?</strong></p><ul><li>Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„<strong>æ“ä½œç </strong>(opcode)ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ¬¡æ“ä½œæ‰€éœ€å‚æ•°çš„<strong>æ“ä½œæ•°</strong>(operand)æ‰€æ„æˆ. è™šæ‹Ÿæœºä¸­è®¸å¤šæŒ‡ä»¤å¹¶ä¸åŒ…å«æ“ä½œæ•°, åªæœ‰ä¸€ä¸ªæ“ä½œç .</li></ul><p>æ¯”å¦‚: æ“ä½œç  (æ“ä½œæ•°)</p><p><img src="./../jvm-class1/image-20240102224120690.png" alt=""></p><p><strong>å¦‚ä½•è§£è¯»ä¾›è™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œçš„äºŒè¿›åˆ¶å­—èŠ‚ç ï¼Ÿ</strong></p><ul><li>ä¸€ä¸ªä¸€ä¸ªäºŒè¿›åˆ¶çš„çœ‹ã€‚è¿™é‡Œç”¨åˆ°çš„æ˜¯Notepad+.+,éœ€è¦å®‰è£…ä¸€ä¸ªHEX-Editoræ’ä»¶ï¼Œæˆ–è€…ä½¿ç”¨Binary Viewer</li><li>ä½¿ç”¨javapæŒ‡ä»¤: jdkè‡ªå¸¦çš„åè§£æå·¥å…·</li><li>ä½¿ç”¨IDEAæ’ä»¶: jclasslib æˆ– jclasslib bytecode viewerå®¢æˆ·ç«¯å·¥å…·</li></ul><h2 id="03-Classæ–‡ä»¶ç»“æ„">03-Classæ–‡ä»¶ç»“æ„</h2><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">å®˜æ–¹æ–‡æ¡£</a></p><p><strong>Classç±»çš„æœ¬è´¨</strong></p><p>ä»»ä½•ä¸€ä¸ªClassæ–‡ä»¶éƒ½å¯¹åº”ç€å”¯ä¸€ä¸€ä¸ªç±»æˆ–æ¥å£çš„å®šä¹‰ä¿¡æ¯ï¼Œä½†åè¿‡æ¥è¯´ï¼ŒClassæ–‡ä»¶å®é™…ä¸Šå®ƒå¹¶ä¸ä¸€å®šä»¥ç£ç›˜æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥8ä½å­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„<strong>äºŒè¿›åˆ¶æµ</strong>ã€‚</p><p><strong>Classæ–‡ä»¶æ ¼å¼</strong></p><p>Classçš„ç»“æ„ä¸åƒXMLç­‰æè¿°è¯­è¨€ï¼Œç”±äºå®ƒæ²¡æœ‰ä»»ä½•åˆ†éš”ç¬¦å·ã€‚æ‰€ä»¥åœ¨å…¶ä¸­çš„æ•°æ®é¡¹ï¼Œæ— è®ºæ˜¯å­—èŠ‚é¡ºåºè¿˜æ˜¯æ•°é‡ï¼Œéƒ½æ˜¯è¢«ä¸¥æ ¼é™å®šçš„ï¼Œå“ªä¸ªå­—èŠ‚ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Œé•¿åº¦æ˜¯å¤šå°‘ï¼Œå…ˆåé¡ºåºå¦‚ä½•ï¼Œéƒ½ä¸å…è®¸æ”¹å˜ã€‚</p><p>Classæ–‡ä»¶æ ¼å¼é‡‡ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„æ–¹å¼è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œè¿™ç§ç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼š<strong>æ— ç¬¦å·æ•°</strong>å’Œ<strong>è¡¨</strong>ã€‚</p><ul><li>æ— ç¬¦å·æ•°å±äºåŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä»¥u1ã€u2ã€u4ã€u8æ¥åˆ†åˆ«ä»£è¡¨1ä¸ªå­—èŠ‚ã€2ä¸ªå­—èŠ‚ã€4ä¸ªå­—èŠ‚å’Œ8ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°ï¼Œæ— ç¬¦å·æ•°å¯ä»¥ç”¨æ¥æè¿°æ•°å­—ã€ç´¢å¼•å¼•ç”¨ã€æ•°é‡å€¼æˆ–è€…æŒ‰ç…§UTF-8ç¼–ç æ„æˆå­—ç¬¦ä¸²å€¼ã€‚</li><li>è¡¨æ˜¯ç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–è€…å…¶ä»–è¡¨ä½œä¸ºæ•°æ®é¡¹æ„æˆçš„å¤åˆæ•°æ®ç±»å‹ï¼Œæ‰€æœ‰è¡¨éƒ½ä¹ æƒ¯æ€§åœ°ä»¥&quot;_ifo&quot;ç»“å°¾ã€‚è¡¨ç”¨äºæè¿°æœ‰å±‚æ¬¡å…³ç³»çš„å¤åˆç»“æ„çš„æ•°æ®ï¼Œæ•´ä¸ªClassæ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ è¡¨ã€‚ç”±äºè¡¨æ²¡æœ‰å›ºå®šé•¿åº¦ï¼Œæ‰€ä»¥é€šå¸¸ä¼šåœ¨å…¶å‰é¢åŠ ä¸Šä¸ªæ•°è¯´æ˜</li></ul><p><strong>ä»£ç ä¸¾ä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> num<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Class æ–‡ä»¶ç»“æ„æ¦‚è¿°</strong></p><p>Classæ–‡ä»¶çš„ç»“æ„å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„, éšç€Javaè™šæ‹Ÿæœºçš„ä¸æ–­å‘å±•, æ€»æ˜¯ä¸å¯é¿å…åœ°å¯¹Classæ–‡ä»¶ç»“æ„åšå‡ºä¸€äº›è°ƒæ•´, ä½†æ˜¯å…¶åŸºæœ¬ç»“æ„å’Œæ¡†æ¶æ˜¯éå¸¸ç¨³å®šçš„.</p><p>Classæ–‡ä»¶çš„æ€»ä½“ç»“æ„å¦‚ä¸‹:</p><ul><li>é­”æ•° magic</li><li>Classæ–‡ä»¶ç‰ˆæœ¬ minor_version + major_version</li><li>å¸¸é‡æ±  constant_pool_count + constant_pool[constant_pool_count-1]</li><li>è®¿é—®æ ‡å¿— access_flags</li><li>ç±»ç´¢å¼•, çˆ¶ç±»ç´¢å¼•, æ¥å£ç´¢å¼•é›†åˆ this_class + super_class + interfaces_count interfaces[interfaces_count]</li><li>å­—æ®µè¡¨é›†åˆ fields_count + fields[fields_count]</li><li>æ–¹æ³•è¡¨é›†åˆ methods_count + methods[methods_count]</li><li>å±æ€§è¡¨é›†åˆ attributes_count + attributes[attributes_count]</li></ul><p><img src="./../jvm-class1/image-20240103221148437.png" alt="The ClassFile Structure"></p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>è¯´æ˜</th><th>é•¿åº¦</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u4</td><td>magic</td><td>é­”æ•°,è¯†åˆ«Classæ–‡ä»¶æ ¼å¼</td><td>4ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>u2</td><td>minor_version</td><td>å‰¯ç‰ˆæœ¬å·(å°ç‰ˆæœ¬)</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>u2</td><td>major_version</td><td>ä¸»ç‰ˆæœ¬å·(å¤§ç‰ˆæœ¬)</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>u2</td><td>constant_pool_count</td><td>å¸¸é‡æ± è®¡æ•°å™¨</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>cp_info</td><td>constant_pool</td><td>å¸¸é‡æ± è¡¨</td><td>nä¸ªå­—èŠ‚</td><td>constant_pool_count-1</td></tr><tr><td>u2</td><td>access_flags</td><td>è®¿é—®æ ‡è¯†</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>u2</td><td>this_class</td><td>ç±»ç´¢å¼•</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>u2</td><td>super_class</td><td>çˆ¶ç±»ç´¢å¼•</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>u2</td><td>interfaces_count</td><td>æ¥å£è®¡æ•°å™¨</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>u2</td><td>interfaces</td><td>æ¥å£ç´¢å¼•é›†åˆ</td><td>2ä¸ªå­—èŠ‚</td><td>interfaces_count</td></tr><tr><td>u2</td><td>fields_count</td><td>å­—æ®µè®¡æ•°å™¨</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>field_info</td><td>fields</td><td>å­—æ®µè¡¨</td><td>nä¸ªå­—èŠ‚</td><td>fields_count</td></tr><tr><td>u2</td><td>methods_count</td><td>æ–¹æ³•è®¡æ•°å™¨</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>method_info</td><td>methods</td><td>æ–¹æ³•è¡¨</td><td>nä¸ªå­—èŠ‚</td><td>methods_count</td></tr><tr><td>u2</td><td>attributes_count</td><td>å±æ€§è®¡æ•°å™¨</td><td>2ä¸ªå­—èŠ‚</td><td>1</td></tr><tr><td>attribute_info</td><td>attributes</td><td>å±æ€§è¡¨</td><td>nä¸ªå­—èŠ‚</td><td>attributes_count</td></tr></tbody></table><h3 id="é­”æ•°-Classæ–‡ä»¶çš„æ ‡å¿—">é­”æ•°: Classæ–‡ä»¶çš„æ ‡å¿—</h3><p><strong>Magic Number(é­”æ•°)</strong></p><ul><li>æ¯ä¸ªClassæ–‡ä»¶å¼€å¤´çš„4ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°ç§°ä¸ºé­”æ•°(Magic Number)</li><li>å®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„æœ‰æ•ˆåˆæ³•çš„Classæ–‡ä»¶ã€‚å³ï¼šé­”æ•°æ˜¯Classæ–‡ä»¶çš„æ ‡è¯†ç¬¦ã€‚</li><li>é­”æ•°å€¼å›ºå®šä¸º0XCAFEBABEã€‚ä¸ä¼šæ”¹å˜ã€‚</li><li>å¦‚æœä¸€ä¸ªClassæ–‡ä»¶ä¸ä»¥0xCAFEBABEå¼€å¤´ï¼Œè™šæ‹Ÿæœºåœ¨è¿›è¡Œæ–‡ä»¶æ ¡éªŒçš„æ—¶å€™å°±ä¼šç›´æ¥æŠ›å‡ºä»¥ä¸‹é”™è¯¯ï¼š</li></ul><blockquote><p>Error: A JNI error has occurred,please check your installation and try again Exception in thread â€œmainâ€ java.lang.ClassFormatError:Incompatible magic value 1885430635 in class file StringTest</p></blockquote><ul><li>ä½¿ç”¨é­”æ•°è€Œä¸æ˜¯æ‰©å±•åæ¥è¿›è¡Œè¯†åˆ«ä¸»è¦æ˜¯åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œå› ä¸ºæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„åœ°æ”¹åŠ¨ã€‚</li></ul><h3 id="Classæ–‡ä»¶ç‰ˆæœ¬å·">Classæ–‡ä»¶ç‰ˆæœ¬å·</h3><ul><li>ç´§æ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ã€‚åŒæ ·ä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ã€‚ç¬¬5ä¸ªå’Œç¬¬6ä¸ªå­—èŠ‚æ‰€ä»£è¡¨çš„å«ä¹‰å°±æ˜¯ç¼–è¯‘çš„å‰¯ç‰ˆæœ¬å·minor_version, è€Œç¬¬7ä¸ªå’Œç¬¬8ä¸ªå­—èŠ‚å°±æ˜¯ç¼–è¯‘çš„ä¸»ç‰ˆæœ¬å·major_versionã€‚</li><li>å®ƒä»¬å…±åŒæ„æˆäº†classæ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·ã€‚è­¬å¦‚æŸä¸ªClassæ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·ä¸ºM,å‰¯ç‰ˆæœ¬å·ä¸ºm,é‚£ä¹ˆè¿™ä¸ªClassæ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·å°±ç¡®å®šä¸ºM.mã€‚</li><li>ç‰ˆæœ¬å·å’ŒJavaç¼–è¯‘å™¨çš„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ï¼š</li></ul><table><thead><tr><th>ä¸»ç‰ˆæœ¬(åè¿›åˆ¶)</th><th>å‰¯ç‰ˆæœ¬(åè¿›åˆ¶)</th><th>ç¼–è¯‘å™¨ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>45</td><td>3</td><td>1.1</td></tr><tr><td>46</td><td>0</td><td>1.2</td></tr><tr><td>47</td><td>0</td><td>1.3</td></tr><tr><td>48</td><td>0</td><td>1.4</td></tr><tr><td>49</td><td>0</td><td>1.5</td></tr><tr><td>50</td><td>0</td><td>1.6</td></tr><tr><td>51</td><td>0</td><td>1.7</td></tr><tr><td>52</td><td>0</td><td>1.8</td></tr><tr><td>53</td><td>0</td><td>1.9</td></tr><tr><td>54</td><td>0</td><td>1.10</td></tr><tr><td>55</td><td>0</td><td>1.11</td></tr></tbody></table><ul><li>Javaçš„ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹çš„ï¼ŒJDK1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸ŠåŠ 1ã€‚</li><li><strong>ä¸åŒç‰ˆæœ¬çš„Javaç¼–è¯‘å™¨ç¼–è¯‘çš„Classæ–‡ä»¶å¯¹åº”çš„ç‰ˆæœ¬æ˜¯ä¸ä¸€æ ·çš„ã€‚ç›®å‰ï¼Œé«˜ç‰ˆæœ¬çš„ä»¬avaè™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œç”±ä½ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶ï¼Œä½†æ˜¯ä½ç‰ˆæœ¬çš„Javaè™šæ‹Ÿæœºä¸èƒ½æ‰§è¡Œç”±é«˜ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶ã€‚å¦åˆ™JVMä¼šæŠ›å‡ºjava.lang.UnsupportedClassVersionErrorå¼‚å¸¸ã€‚ï¼ˆå‘ä¸‹å…¼å®¹ï¼‰</strong></li><li>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯¥é—®é¢˜çš„å‘ç”Ÿã€‚å› æ­¤ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å¼€å‘æ—¶ï¼Œç‰¹åˆ«æ³¨æ„å¼€å‘ç¼–è¯‘çš„<br>JDKç‰ˆæœ¬å’Œç”Ÿäº§ç¯å¢ƒä¸­çš„]DKç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ã€‚<ul><li>è™šæ‹ŸæœºJDKç‰ˆæœ¬ä¸º<code>1.k(k&gt;=2)</code>æ—¶ï¼Œå¯¹åº”çš„Classæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·çš„èŒƒå›´ä¸º<code>45.0-44+k.0</code>(å«ä¸¤ç«¯)ã€‚</li></ul></li></ul><h3 id="å¸¸é‡æ± ï¼šå­˜æ”¾æ‰€æœ‰å¸¸é‡">å¸¸é‡æ± ï¼šå­˜æ”¾æ‰€æœ‰å¸¸é‡</h3><ul><li>å¸¸é‡æ± æ˜¯Classæ–‡ä»¶ä¸­å†…å®¹æœ€ä¸ºä¸°å¯Œçš„åŒºåŸŸä¹‹ä¸€ã€‚å¸¸é‡æ± å¯¹äºClassæ–‡ä»¶ä¸­çš„å­—æ®µå’Œæ–¹æ³•è§£æä¹Ÿæœ‰ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚</li><li>éšç€Javaè™šæ‹Ÿæœºçš„ä¸æ–­å‘å±•ï¼Œå¸¸é‡æ± çš„å†…å®¹ä¹Ÿæ—¥æ¸ä¸°å¯Œã€‚å¯ä»¥è¯´ï¼Œå¸¸é‡æ± æ˜¯æ•´ä¸ªClassæ–‡ä»¶çš„åŸºçŸ³ã€‚</li><li>åœ¨ç‰ˆæœ¬å·ä¹‹åï¼Œç´§è·Ÿç€çš„æ˜¯å¸¸é‡æ± çš„æ•°é‡ï¼Œä»¥åŠè‹¥å¹²ä¸ªå¸¸é‡æ± è¡¨é¡¹ã€‚</li><li>å¸¸é‡æ± ä¸­å¸¸é‡çš„æ•°é‡æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨å¸¸é‡æ± çš„å…¥å£éœ€è¦æ”¾ç½®ä¸€é¡¹u2ç±»å‹çš„æ— ç¬¦å·æ•°ï¼Œä»£è¡¨å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼(constant_pool_count)ã€‚ä¸Javaä¸­è¯­è¨€ä¹ æƒ¯ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™ä¸ªå®¹é‡è®¡æ•°æ˜¯ä»1è€Œä¸æ˜¯0å¼€å§‹çš„ã€‚</li></ul><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2(æ— ç¬¦å·æ•°)</td><td>constant_pool_count</td><td>1</td></tr><tr><td>cp_info(è¡¨)</td><td>constant_pool</td><td>constant_pool_count-1</td></tr></tbody></table><p>ç”±ä¸Šè¡¨å¯è§ï¼ŒClassæ–‡ä»¶ä½¿ç”¨äº†ä¸€ä¸ªå‰ç½®çš„å®¹é‡è®¡æ•°å™¨(constant_pool_count)åŠ è‹¥å¹²ä¸ªè¿ç»­çš„æ•°æ®é¡¹(constant_pool)çš„å½¢å¼æ¥æè¿°å¸¸é‡æ± å†…å®¹ã€‚æˆ‘ä»¬æŠŠè¿™ä¸€ç³»åˆ—è¿ç»­å¸¸é‡æ± æ•°æ®ç§°ä¸ºå¸¸é‡æ± é›†åˆã€‚</p><ul><li><strong>å¸¸é‡æ± è¡¨é¡¹</strong>ä¸­ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æ—¶æœŸç”Ÿæˆçš„å„ç§<strong>å­—é¢é‡</strong>å’Œ<strong>ç¬¦å·å¼•ç”¨</strong>ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ä¸­å­˜æ”¾ã€‚</li></ul><h4 id="å¸¸é‡æ± è®¡æ•°å™¨">å¸¸é‡æ± è®¡æ•°å™¨</h4><p><strong>constant_pool count(å¸¸é‡æ± è®¡æ•°å™¨)</strong></p><ul><li>ç”±äºå¸¸é‡æ± çš„æ•°é‡ä¸å›ºå®šï¼Œæ—¶é•¿æ—¶çŸ­ï¼Œæ‰€ä»¥éœ€è¦æ”¾ç½®ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ã€‚</li><li>å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼(u2ç±»å‹)ï¼šä»1å¼€å§‹ï¼Œè¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰å¤šå°‘é¡¹å¸¸é‡ã€‚å³constant_poo1_count=1è¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰0ä¸ªå¸¸é‡é¡¹</li><li>Demoçš„å€¼ä¸ºï¼š</li></ul><p><img src="./../jvm-class1/image-20240103225157121.png" alt="å­—èŠ‚ç è§£æ"></p><p>å…¶å€¼ä¸º0x0016 = 22ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å®é™…ä¸Šåªæœ‰21é¡¹å¸¸é‡ã€‚ç´¢å¼•ä¸ºèŒƒå›´æ˜¯1-21ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>é€šå¸¸æˆ‘ä»¬å†™ä»£ç æ—¶éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯è¿™é‡Œçš„å¸¸é‡æ± å´æ˜¯ä»1å¼€å§‹ï¼Œå› ä¸ºå®ƒæŠŠç¬¬0é¡¹å¸¸é‡ç©ºå‡ºæ¥äº†ã€‚è¿™æ˜¯ä¸ºäº†æ»¡è¶³åé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹éœ€è¦è¡¨è¾¾â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®â€çš„å«ä¹‰ï¼Œè¿™ç§æƒ…å†µå¯ç”¨ç´¢å¼•å€¼0æ¥è¡¨ç¤ºã€‚</p></blockquote><h4 id="å¸¸é‡æ± è¡¨">å¸¸é‡æ± è¡¨</h4><p><strong>constant_pool [] (å¸¸é‡æ± è¡¨)</strong></p><ul><li>constant_poolæ˜¯ä¸€ç§è¡¨ç»“æ„ï¼Œä»¥1 ~ constant_pool_count - 1ä¸ºç´¢å¼•ã€‚è¡¨æ˜äº†åé¢æœ‰å¤šå°‘ä¸ªå¸¸é‡é¡¹ã€‚</li><li>å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼š<strong>å­—é¢é‡(Literal)<strong>å’Œ</strong>ç¬¦å·å¼•ç”¨(Symbolic References)</strong></li><li>å®ƒåŒ…å«äº†Classæ–‡ä»¶ç»“æ„åŠå…¶å­ç»“æ„ä¸­å¼•ç”¨çš„æ‰€æœ‰å­—ç¬¦ä¸²å¸¸é‡ã€ç±»æˆ–æ¥å£åã€å­—æ®µåå’Œå…¶ä»–å¸¸é‡ã€‚å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹éƒ½å…·å¤‡ç›¸åŒçš„ç‰¹å¾ã€‚ç¬¬1ä¸ªå­—èŠ‚ä½œä¸ºç±»å‹æ ‡è®°ï¼Œç”¨äºç¡®å®šè¯¥é¡¹çš„æ ¼å¼ï¼Œè¿™ä¸ªå­—èŠ‚ç§°ä¸ºtag byte(æ ‡è®°å­—èŠ‚ã€æ ‡ç­¾å­—èŠ‚)ã€‚</li></ul><table><thead><tr><th>ç±»å‹</th><th>æ ‡å¿—(æˆ–æ ‡è¯†)</th><th>0x16</th><th>æè¿°</th></tr></thead><tbody><tr><td>CONSTANT_utf8_info</td><td>1</td><td>01</td><td>UTF-8ç¼–ç çš„å­—ç¬¦ä¸²</td></tr><tr><td>CONSTANT_Integer_info</td><td>3</td><td>03</td><td>æ•´å½¢å­—é¢é‡</td></tr><tr><td>CONSTANT_Float_info</td><td>4</td><td>04</td><td>æµ®ç‚¹å‹å­—é¢é‡</td></tr><tr><td>CONSTANT_Long_info</td><td>5</td><td>05</td><td>é•¿æ•´å‹å­—é¢é‡</td></tr><tr><td>CONSTANT_Double_info</td><td>6</td><td>06</td><td>åŒç²¾åº¦æµ®ç‚¹å‹å­—é¢é‡</td></tr><tr><td>CONSTANT_Class_info</td><td>7</td><td>07</td><td>ç±»æˆ–æ¥å£çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td>CONSTANT_String_info</td><td>8</td><td>08</td><td>å­—ç¬¦ä¸²ç±»å‹å­—é¢é‡</td></tr><tr><td>CONSTANT_Fieldref_info</td><td>9</td><td>09</td><td>å­—æ®µçš„ç¬¦å·å¼•ç”¨</td></tr><tr><td>CONSTANT_Methodref_info</td><td>10</td><td>0a</td><td>ç±»ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td>CONSTANT_InterfaceMethodref_info</td><td>11</td><td>0b</td><td>æ¥å£ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td>CONSTANT_NameAndType_info</td><td>12</td><td>0c</td><td>å­—æ®µæˆ–æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td>CONSTANT_MethodHandle_info</td><td>15</td><td>0f</td><td>è¡¨ç¤ºæ–¹æ³•å¥æŸ„</td></tr><tr><td>CONSTANT_MethodType_info</td><td>16</td><td>10</td><td>æ ‡å¿—æ–¹æ³•ç±»å‹</td></tr><tr><td>CONSTANT_InvokeDynamic_info</td><td>18</td><td>12</td><td>è¡¨ç¤ºä¸€ä¸ªåŠ¨æ€æ–¹æ³•è°ƒç”¨ç‚¹</td></tr></tbody></table><p><strong>å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</strong></p><p>åœ¨å¯¹è¿™äº›å¸¸é‡è§£è¯»å‰ï¼Œæˆ‘ä»¬éœ€è¦ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µã€‚<br>å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡(Literal)å’Œç¬¦å·å¼•ç”¨(Symbolic References)ã€‚å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>å¸¸é‡</th><th>å…·ä½“çš„å¸¸é‡</th><th>ä¸¾ä¾‹</th></tr></thead><tbody><tr><td>å­—é¢é‡</td><td>æ–‡æœ¬å­—ç¬¦ä¸²</td><td>String str = â€œdeeâ€;</td></tr><tr><td></td><td>å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼</td><td>final int NUM = 10;</td></tr><tr><td>ç¬¦å·å¼•ç”¨</td><td>ç±»å’Œæ¥å£çš„å…¨é™å®šå</td><td>cn/saddyfire/test/Demo</td></tr><tr><td></td><td>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</td><td>add</td></tr><tr><td></td><td>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</td><td></td></tr></tbody></table><ul><li>å…¨é™å®šå</li></ul><p><code>cn/saddyfire/test/Demo</code>è¿™ä¸ªå°±æ˜¯ç±»çš„å…¨é™å®šåï¼Œä»…ä»…æ˜¯æŠŠåŒ…åçš„&quot;.â€œæ›¿æ¢æˆâ€/â€œï¼Œä¸ºäº†ä½¿è¿ç»­çš„å¤šä¸ªå…¨é™å®šåä¹‹é—´ä¸äº§ç”Ÿæ··æ·†ï¼Œåœ¨ä½¿ç”¨æ—¶æœ€åä¸€èˆ¬ä¼šåŠ å…¥ä¸€ä¸ªâ€;&quot;è¡¨ç¤ºå…¨é™å®šåç»“æŸã€‚</p><ul><li>ç®€å•åç§°</li></ul><p>ç®€å•åç§°æ˜¯æŒ‡æ²¡æœ‰ç±»å‹å’Œå‚æ•°ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å­—æ®µåç§°ï¼Œä¸Šé¢ä¾‹å­ä¸­çš„ç±»çš„add()æ–¹æ³•å’Œnumå­—æ®µçš„ç®€å•åç§°åˆ†åˆ«æ˜¯addå’Œnumã€‚</p><ul><li>æè¿°ç¬¦</li></ul><p>**æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚**æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹<br>(byteã€charã€doubleã€floatã€intã€longã€shortã€boolean)ä»¥åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹<br>è±¡ç±»å‹åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºï¼Œè¯¦è§ä¸‹è¡¨ï¼š(æ•°æ®ç±»å‹: åŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹)</p><table><thead><tr><th>æ ‡è¯†ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>B</td><td>åŸºæœ¬æ•°æ®ç±»å‹byte</td></tr><tr><td>C</td><td>åŸºæœ¬æ•°æ®ç±»å‹char</td></tr><tr><td>D</td><td>åŸºæœ¬æ•°æ®ç±»å‹double</td></tr><tr><td>F</td><td>åŸºæœ¬æ•°æ®ç±»å‹float</td></tr><tr><td>I</td><td>åŸºæœ¬æ•°æ®ç±»å‹int</td></tr><tr><td>J</td><td>åŸºæœ¬æ•°æ®ç±»å‹long</td></tr><tr><td>S</td><td>åŸºæœ¬æ•°æ®ç±»å‹short</td></tr><tr><td>Z</td><td>åŸºæœ¬æ•°æ®ç±»å‹boolean</td></tr><tr><td>V</td><td>ä»£è¡¨voidç±»å‹</td></tr><tr><td>L</td><td>å¯¹è±¡ç±»å‹, æ¯”å¦‚: Ljava/lang/Object</td></tr><tr><td>[</td><td>æ•°ç»„ç±»å‹, ä»£è¡¨ä¸€ç»´æ•°ç»„. æ¯”å¦‚: <code>double[][][] is [[[D</code></td></tr></tbody></table><p>ç”¨æè¿°ç¬¦æ¥æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ï¼Œåè¿”å›å€¼çš„é¡ºåºæè¿°ï¼Œå‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„å°æ‹¬å·&quot;()&quot;ä¹‹å†…ã€‚å¦‚æ–¹æ³•<br><code>java.lang.String toString()</code>çš„æè¿°ç¬¦ä¸º<code>() Ljava/lang/String;</code>,æ–¹æ³•<code>int abc(int[]x,inty)</code>çš„æè¿°ç¬¦ä¸º<code>([II)I</code>ã€‚</p><blockquote><p><strong>è¡¥å……è¯´æ˜:</strong></p><p>è™šæ‹Ÿæœºåœ¨åŠ æˆªCla55æ–‡ä»¶æ—¶æ‰ä¼šè¿›è¡ŒåŠ¨æ€æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒClassæ–‡ä»¶ä¸­ä¸ä¼šä¿å­˜å„ä¸ªæ–¹æ³•å’Œå­—æ®µçš„æœ€ç»ˆå†…å­˜å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤ï¼Œè¿™äº›å­—æ®µå’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä¸ç»è¿‡è½¬æ¢æ˜¯æ— æ³•ç›´æ¥è¢«è™šæ‹Ÿæœºä½¿ç”¨çš„ã€‚<strong>å½“è™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œéœ€è¦ä»å¸¸é‡æ± ä¸­è·å¾—å¯¹åº”çš„ç¬¦å·å¼•ç”¨ï¼Œå†åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„è§£æé˜¶æ®µå°†å…¶æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œå¹¶è¯‘åˆ°å…·ä½“çš„å†…å­˜åœ°å€ä¸­ã€‚</strong><br>è¿™é‡Œè¯´æ˜ä¸‹ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„åŒºåˆ«ä¸å…³è”ï¼š</p><ul><li>ç¬¦å·å¼•ç”¨ï¼šç¬¦å·å¼•ç”¨ä»¥<strong>ä¸€ç»„ç¬¦å·</strong>æ¥è¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚<strong>ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³</strong>ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·±ç»åŠ è½½åˆ°äº†å†…å­˜ä¸­ã€‚</li><li>ç›´æ¥å¼•ç”¨ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥<strong>æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å‘å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„</strong>ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£è¯´æ˜å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·±ç»å­˜åœ¨äºå†…å­˜ä¹‹ä¸­äº†ã€‚</li></ul></blockquote><h5 id="å¸¸é‡ç±»å‹å’Œç»“æ„">å¸¸é‡ç±»å‹å’Œç»“æ„</h5><ul><li>å¸¸é‡ç±»å‹å’Œç»“æ„</li></ul><p>å¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨, JDK1.7ä¹‹åå…±æœ‰14ç§ä¸é€šçš„è¡¨ç»“æ„æ•°æ®. å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤º</p><p><img src="./../jvm-class1/image-20240104201834430.png" alt=""></p><p><img src="./../jvm-class1/image-20240104211232941.png" alt="å­—èŠ‚ç è§£æ"></p><h4 id="æ€»ç»“">æ€»ç»“</h4><ul><li>è¿™14ç§è¡¨(æˆ–è€…å¸¸é‡é¡¹ç»“æ„)çš„å…±åŒç‚¹æ˜¯: è¡¨å¼€å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ªu1ç±»å‹çš„æ ‡å¿—ä½(tag), ä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡é¡¹ä½¿ç”¨çš„æ˜¯é‚£ç§è¡¨ç»“æ„, å³å“ªç§å¸¸é‡ç±»å‹ã€‚</li><li>åœ¨å¸¸é‡æ± åˆ—è¡¨ä¸­, CONSTANT_Utf8_infoå¸¸é‡é¡¹æ—¶ä¸€ç§ä½¿ç”¨æ”¹è¿›è¿‡çš„UTF-8ç¼–ç æ ¼å¼æ¥å­˜å‚¨è¯¸å¦‚æ–‡å­—å­—ç¬¦ä¸²ã€ç±»æˆ–è€…æ¥å£çš„å…¨é™å®šåã€å­—æ®µæˆ–è€…æ–¹æ³•çš„ç®€å•åç§°ä»¥åŠæè¿°ç¬¦ç­‰å¸¸é‡å­—ç¬¦ä¸²ä¿¡æ¯ã€‚</li><li>è¿™14ç§å¸¸é‡é¡¹ç»“æ„è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå…¶ä¸­13ä¸ªå¸¸é‡é¡¹å ç”¨çš„å­—èŠ‚å›ºå®šï¼Œåªæœ‰CONSTANT_Utf8_infoå ç”¨å­—èŠ‚ä¸å›ºå®šï¼Œå…¶å¤§å°ç”±lengthå†³å®šã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<strong>å› ä¸ºä»å¸¸é‡æ± å­˜æ”¾çš„å†…å®¹å¯çŸ¥ï¼Œå…¶å­˜æ”¾çš„æ˜¯å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œæœ€ç»ˆè¿™äº›å†…å®¹éƒ½ä¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²çš„å¤§å°æ˜¯åœ¨ç¼–å†™ç¨‹åºæ—¶æ‰ç¡®å®š</strong>ï¼Œæ¯”å¦‚ä½ å®šä¹‰ä¸€ä¸ªç±»ï¼Œç±»åå¯ä»¥å–é•¿å–çŸ­ï¼Œæ‰€ä»¥åœ¨æ²¡ç¼–è¯‘å‰ï¼Œå¤§å°ä¸å›ºå®šï¼Œç¼–è¯‘åï¼Œé€šè¿‡utf-8ç¼–ç ï¼Œå°±å¯ä»¥çŸ¥é“å…¶é•¿åº¦ã€‚</li><li>å¸¸é‡æ± ï¼šå¯ä»¥ç†è§£ä¸ºClassæ–‡ä»¶ä¹‹ä¸­çš„èµ„æºä»“åº“ï¼Œå®ƒæ˜¯Classæ–‡ä»¶ç»“æ„ä¸­ä¸å…¶ä»–é¡¹ç›®å…³è”æœ€å¤šçš„æ•°æ®ç±»å‹ï¼ˆåé¢çš„å¾ˆå¤šæ•°æ®ç±»<br>å‹éƒ½ä¼šæŒ‡å‘æ­¤å¤„)ï¼Œä¹Ÿæ˜¯å ç”¨Classæ–‡ä»¶ç©ºé—´æœ€å¤§çš„æ•°æ®é¡¹ç›®ä¹‹ä¸€ã€‚</li><li>å¸¸é‡æ± ä¸­ä¸ºä»€ä¹ˆè¦åŒ…å«è¿™äº›å†…å®¹<ul><li>Javaä»£ç åœ¨è¿›è¡ŒJavacç¼–è¯‘çš„æ—¶å€™ï¼Œå¹¶ä¸åƒCå’ŒC++é‚£æ ·æœ‰&quot;è¿æ¥&quot;è¿™ä¸€æ­¥éª¤ï¼Œè€Œæ˜¯åœ¨è™šæ‹ŸæœºåŠ è½½Classæ–‡ä»¶çš„æ—¶å€™è¿›è¡ŒåŠ¨æ€é“¾æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨Classæ–‡ä»¶ä¸­ä¸ä¼šä¿å­˜å„ä¸ªæ–¹æ³•ã€å­—æ®µçš„æœ€ç»ˆå†…å­˜å¸ƒå±€ä¿¡æ¯ï¼Œå› æ­¤è¿™äº›å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä¸ç»è¿‡è¿è¡ŒæœŸè½¬æ¢çš„è¯æ— æ³•å¾—åˆ°çœŸæ­£çš„å†…å­˜å…¥å£åœ°å€ï¼Œä¹Ÿå°±æ— æ³•ç›´æ¥è¢«è™šæ‹Ÿæœºä½¿ç”¨</strong>ã€‚å½“è™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œéœ€è¦ä»å¸¸é‡æ± è·å¾—å¯¹åº”çš„ç¬¦å·å¼•ç”¨ï¼Œå†åœ¨ç±»åˆ›å»ºæ—¶æˆ–è¿è¡Œæ—¶è§£æã€ç¿»è¯‘åˆ°å…·ä½“çš„å†…å­˜åœ°å€ä¹‹ä¸­ã€‚å…³äºç±»çš„åˆ›å»ºå’ŒåŠ¨æ€é“¾æ¥çš„å†…å®¹ï¼Œåœ¨è™šæ‹Ÿæœºç±»åŠ è½½è¿‡ç¨‹æ—¶å†è¿›è¡Œè¯¦ç»†è®²è§£ã€‚</li></ul></li></ul><h3 id="è®¿é—®æ ‡è¯†">è®¿é—®æ ‡è¯†</h3><p><strong>è®¿é—®æ ‡è¯†(access_flagã€è®¿é—®æ ‡å¿—ã€è®¿é—®æ ‡è®°)</strong></p><ul><li>åœ¨å¸¸é‡æ± åï¼Œç´§è·Ÿç€è®¿é—®æ ‡è®°ã€‚è¯¥æ ‡è®°ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ªClassæ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼›æ˜¯å¦å®šä¹‰ä¸ºpublicç±»å‹ï¼›æ˜¯å¦å®šä¹‰ä¸ºabstractç±»å‹ï¼›å¦‚æœæ˜¯ç±»çš„è¯ï¼Œæ˜¯å¦è¢«å£°æ˜ä¸ºfinalç­‰ã€‚å„ç§è®¿é—®æ ‡è®°å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><table><thead><tr><th>æ ‡å¿—åç§°</th><th>æ ‡å¿—å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>æ ‡å¿—ä¸ºpublicç±»å‹</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>æ ‡å¿—è¢«å£°æ˜ä¸ºfinalï¼Œåªæœ‰ç±»å¯ä»¥è®¾ç½®</td></tr><tr><td>ACC_SUPER</td><td>0x0020</td><td>æ ‡å¿—å…è®¸ä½¿ç”¨invokespecialå­—èŠ‚ç æŒ‡ä»¤çš„æ–°è¯­ä¹‰ï¼ŒJDK1.0.2ä¹‹åç¼–è¯‘å‡ºæ¥çš„ç±»çš„è¿™ä¸ªæ ‡å¿—é»˜è®¤ä¸ºçœŸã€‚ï¼ˆä½¿ç”¨å¢å¼ºçš„æ–¹æ³•è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼‰</td></tr><tr><td>ACC_INTERFACE</td><td>0x0200</td><td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ¥å£</td></tr><tr><td>ACC_ABSTRACT</td><td>0x0400</td><td>æ˜¯å¦ä¸ºabstractç±»å‹ï¼Œå¯¹äºæ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥è¯´ï¼Œæ¬¡æ ‡å¿—å€¼ä¸ºçœŸï¼Œå…¶ä»–ç±»å‹ä¸ºå‡</td></tr><tr><td>ACC_SYNTHETIC</td><td>0x1000</td><td>æ ‡å¿—æ­¤ç±»å¹¶éç”±ç”¨æˆ·ä»£ç äº§ç”Ÿï¼ˆå³ï¼šç”±ç¼–è¯‘å™¨äº§ç”Ÿçš„ç±»ï¼Œæ²¡æœ‰æºç å¯¹åº”ï¼‰</td></tr><tr><td>ACC_ANNOTATION</td><td>0x2000</td><td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæ³¨è§£</td></tr><tr><td>ACC_ENUM</td><td>0x4000</td><td>æ ‡å¿—è¿™æ˜¯ä¸€ä¸ªæšä¸¾</td></tr></tbody></table><ul><li>ç±»çš„è®¿é—®æƒé™é€šå¸¸ä¸ºACC_å¼€å¤´çš„å¸¸é‡ã€‚</li><li>æ¯ä¸€ç§ç±»å‹çš„è¡¨ç¤ºéƒ½æ˜¯é€šè¿‡è®¾ç½®è®¿é—®æ ‡è®°çš„32ä½ä¸­çš„ç‰¹å®šä½æ¥å®ç°çš„ã€‚æ¯”å¦‚ï¼Œè‹¥æ˜¯pub1 ic finalçš„ç±»ï¼Œåˆ™è¯¥æ ‡è®°ä¸ºACC_PUBLIC | ACC_FINAL</li><li>ä½¿ç”¨ ACC_SUPER å¯ä»¥è®©ç±»æ›´å‡†ç¡®åœ°å®šä½åˆ°çˆ¶ç±»çš„æ–¹æ³•<code>super.method()</code>,ç°ä»£ç¼–è¯‘å™¨éƒ½ä¼šè®¾ç½®å¹¶ä¸”ä½¿ç”¨è¿™ä¸ªæ ‡è®°ã€‚</li></ul><p><img src="./../jvm-class1/image-20240104214507444.png" alt="å­—èŠ‚ç è§£æ"></p><p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p><ol><li><p>å¸¦æœ‰ ACC_INTERFACE æ ‡å¿—çš„classæ–‡ä»¶è¡¨ç¤ºçš„æ˜¯æ¥å£è€Œä¸æ˜¯ç±»ï¼Œåä¹‹åˆ™è¡¨ç¤ºçš„æ˜¯ç±»è€Œä¸æ˜¯æ¥å£ã€‚</p><ol><li>å¦‚æœä¸€ä¸ªclassæ–‡ä»¶è¢«è®¾ç½®äº† ACC_INTERFACE æ ‡å¿—ï¼Œé‚£ä¹ˆåŒæ—¶ä¹Ÿå¾—è®¾ç½® ACC_ABSTRACT æ ‡å¿—ã€‚åŒæ—¶å®ƒä¸èƒ½å†è®¾ç½®ACC_FINALã€<br>ACC_SUPER æˆ– ACC_ENUM æ ‡å¿—ã€‚</li><li>å¦‚Iæœæ²¡æœ‰è®¾ç½®ACC INTERFACEæ ‡å¿—ï¼Œé‚£ä¹ˆè¿™ä¸ªclassæ–‡ä»¶å¯ä»¥å…·æœ‰ä¸Šè¡¨ä¸­é™¤ACC_ANNOTATIONå¤–çš„å…¶ä»–æ‰€æœ‰æ ‡å¿—ã€‚å½“ç„¶ï¼Œ ACC_FINAL å’Œ ACC_ABSTRACT è¿™ç±»äº’æ–¥çš„æ ‡å¿—é™¤å¤–ã€‚è¿™ä¸¤ä¸ªæ ‡å¿—ä¸å¾—åŒæ—¶è®¾ç½®ã€‚</li></ol></li><li><p>ACC_SUPER æ ‡å¿—ç”¨äºç¡®å®šç±»æˆ–æ¥å£é‡Œé¢çš„ <em>invokespecial</em> æŒ‡ä»¤ä½¿ç”¨çš„æ˜¯å“ªä¸€ç§æ‰§è¡Œè¯­ä¹‰ã€‚<strong>é’ˆå¯¹é—¨avaè™šæ‹ŸæœºæŒ‡ä»¤é›†çš„ç¼–è¯‘å™¨</strong><br><strong>éƒ½åº”å½“è®¾ç½®è¿™ä¸ªæ ‡å¿—</strong>ã€‚å¯¹äºJava SE 8åŠåç»­ç‰ˆæœ¬æ¥è¯´ï¼Œæ— è®ºclassæ–‡ä»¶ä¸­è¿™ä¸ªæ ‡å¿—çš„å®é™…å€¼æ˜¯ä»€ä¹ˆï¼Œä¹Ÿä¸ç®¡classæ–‡ä»¶çš„ç‰ˆæœ¬<br>å·æ˜¯å¤šå°‘ï¼ŒJavaè™šæ‹Ÿæœºéƒ½è®¤ä¸ºæ¯ä¸ªclassæ–‡ä»¶å‡è®¾ç½®äº† ACC_SUPER æ ‡å¿—ã€‚</p><ol><li>ACC_SUPER æ ‡å¿—æ˜¯ä¸ºäº†å‘åå…¼å®¹ç”±æ—§Javaç¼–è¯‘å™¨æ‰€ç¼–è¯‘çš„ä»£ç è€Œè®¾è®¡çš„ã€‚ç›®å‰çš„ACC SUPERæ ‡å¿—åœ¨ç”±JDK1.0.2ä¹‹å‰çš„<br>ç¼–è¯‘å™¨æ‰€ç”Ÿæˆçš„access_flagsä¸­æ˜¯æ²¡æœ‰ç¡®å®šå«ä¹‰çš„ï¼Œå¦‚æœè®¾ç½®äº†è¯¥æ ‡å¿—ï¼Œé‚£ä¹ˆOracleçš„Javaè™šæ‹Ÿæœºå®ç°ä¼šå°†å…¶å¿½ç•¥ã€‚</li></ol></li><li><p>ACC_SYNTHETIC æ ‡å¿—æ„å‘³ç€è¯¥ç±»æˆ–æ¥å£æ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ï¼Œè€Œä¸æ˜¯ç”±æºä»£ç ç”Ÿæˆçš„ã€‚</p></li><li><p>æ³¨è§£ç±»å‹å¿…é¡»è®¾ç½® ACC_ANNOTATION æ ‡å¿—ã€‚å¦‚æœè®¾ç½®äº† ACC_ANNOTATION æ ‡å¿—ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»è®¾ç½® ACC_INTERFACE æ ‡å¿—ã€‚</p></li><li><p>ACC_ENUM æ ‡å¿—è¡¨æ˜è¯¥ç±»æˆ–å…¶çˆ¶ç±»ä¸ºæšä¸¾ç±»å‹ã€‚</p></li></ol><h3 id="ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ">ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ</h3><ul><li>åœ¨è®¿é—®æ ‡è®°åï¼Œä¼šæŒ‡å®šè¯¥ç±»çš„ç±»åˆ«ã€çˆ¶ç±»ç±»åˆ«ä»¥åŠå®ç°çš„æ¥å£ï¼Œæ ¼å¼å¦‚ä¸‹:</li></ul><table><thead><tr><th>é•¿åº¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>u2</td><td>this_class</td></tr><tr><td>u2</td><td>super_class</td></tr><tr><td>u2</td><td>interfaces_count</td></tr><tr><td>u2</td><td>interfaces[interfaces_count]</td></tr></tbody></table><ul><li>è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»ã€‚<ul><li>ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šå</li><li>çˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚ç”±äº Java è¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº† java.lang.Object ä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº† java.lang.Object å¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º0ã€‚</li><li>æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ implements è¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ª<br>æ¥å£ï¼Œåˆ™åº”å½“æ˜¯ extends è¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</li></ul></li></ul><ol><li>this_class(ç±»ç´¢å¼•)<ul><li>2å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†ç±»çš„å…¨é™å®šåï¼Œå¦‚com/atguigu/java1/Demoã€‚this_classçš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚å¸¸é‡æ± åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„æˆå‘˜å¿…é¡»ä¸ºCONSTANT_Class,_infoç±»å‹ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“è¡¨ç¤ºè¿™ä¸ªClassæ–‡ä»¶æ‰€å®šä¹‰çš„ç±»æˆ–æ¥å£ã€‚</li></ul></li><li>super_class(çˆ¶ç±»ç´¢å¼•)<ul><li>2å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†å½“å‰ç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç»§æ‰¿ä»»ä½•ç±»ï¼Œå…¶é»˜è®¤ç»§æ‰¿çš„æ˜¯java/lang/Objectç±»ã€‚åŒæ—¶ï¼Œç”±äºJavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥å…¶çˆ¶ç±»åªæœ‰ä¸€ä¸ªã€‚</li><li>superclassæŒ‡å‘çš„çˆ¶ç±»ä¸èƒ½æ˜¯finalã€‚</li></ul></li><li>interfaces<ul><li>æŒ‡å‘å¸¸é‡æ± ç´¢å¼•é›†åˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç¬¦å·å¼•ç”¨åˆ°æ‰€æœ‰å·±å®ç°çš„æ¥å£</li><li>ç”±äºä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå› æ­¤éœ€è¦ä»¥æ•°ç»„å½¢å¼ä¿å­˜å¤šä¸ªæ¥å£çš„ç´¢å¼•ï¼Œè¡¨ç¤ºæ¥å£çš„æ¯ä¸ªç´¢å¼•ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„<br>CONSTANT_Class(å½“ç„¶è¿™é‡Œå°±å¿…é¡»æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯ç±»)ã€‚</li></ul><ol><li>interfaces_count (æ¥å£è®¡æ•°å™¨)<ul><li>interfaces_count:é¡¹çš„å€¼è¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£çš„ç›´æ¥è¶…æ¥å£æ•°é‡ã€‚</li></ul></li><li>interfaces[ ] (æ¥å£ç´¢å¼•é›†åˆ)<ul><li>interfaces[] ä¸­æ¯ä¸ªæˆå‘˜çš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„æœ‰æ•ˆç´¢å¼•å€¼ï¼Œå®ƒçš„é•¿åº¦ä¸ºinterfaces_count.ã€‚æ¯ä¸ªæˆå‘˜interfaces[i]å¿…é¡»ä¸º CONSTANT_Class_info ç»“æ„ï¼Œå…¶ä¸­ <code>0 &lt;= i &lt; interfaces_count</code>ã€‚åœ¨ interfaces[ ] ä¸­ï¼Œå„æˆå‘˜æ‰€è¡¨ç¤ºçš„æ¥å£é¡ºåºå’Œå¯¹åº”çš„æºä»£ç ä¸­ç»™å®šçš„æ¥å£é¡ºåºï¼ˆä»å·¦è‡³å³ï¼‰ä¸€æ ·ï¼Œå³ interfaces[0] å¯¹åº”çš„æ˜¯æºä»£ç ä¸­æœ€å·¦è¾¹çš„æ¥å£ã€‚</li></ul></li></ol></li></ol><p><img src="./../jvm-class1/image-20240104230941036.png" alt="å­—èŠ‚ç è§£æ"></p><h3 id="å­—æ®µè¡¨é›†åˆ">å­—æ®µè¡¨é›†åˆ</h3><p><strong>fields</strong></p><ul><li>ç”¨äºæè¿°æ¥å£æˆ–ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚å­—æ®µ(field)åŒ…æ‹¬<strong>ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡</strong>ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨ã€ä»£ç å—å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡(local variables)ã€‚</li><li>å­—æ®µå«ä»€ä¹ˆåå­—ã€å­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œè¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡æ¥æè¿°ã€‚</li><li>å®ƒæŒ‡å‘å¸¸é‡æ± ç´¢å¼•é›†åˆï¼Œå®ƒæè¿°äº†æ¯ä¸ªå­—æ®µçš„å®Œæ•´ä¿¡æ¯ã€‚æ¯”å¦‚**å­—æ®µçš„æ ‡è¯†ç¬¦ã€è®¿é—®ä¿®é¥°ç¬¦(publicã€private æˆ– protected)ã€æ˜¯ç±»å˜é‡è¿˜æ˜¯å®ä¾‹å˜é‡(staticä¿®é¥°ç¬¦)ã€æ˜¯å¦æ˜¯å¸¸é‡(finalä¿®é¥°ç¬¦)**ç­‰ã€‚</li></ul><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>å­—æ®µè¡¨é›†åˆä¸­ä¸ä¼šåˆ—å‡ºä»çˆ¶ç±»æˆ–è€…å®ç°çš„æ¥å£ä¸­ç»§æ‰¿è€Œæ¥çš„å­—æ®µï¼Œä½†æœ‰å¯èƒ½åˆ—å‡ºåŸæœ¬Javaä»£ç ä¹‹ä¸­ä¸å­˜åœ¨çš„å­—æ®µã€‚è­¬å¦‚åœ¨å†…éƒ¨ç±»ä¸­ä¸ºäº†ä¿æŒå¯¹å¤–éƒ¨ç±»çš„è®¿é—®æ€§ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æŒ‡å‘å¤–éƒ¨ç±»å®ä¾‹çš„å­—æ®µã€‚</li><li>åœ¨äº†Javaè¯­è¨€ä¸­å­—æ®µæ˜¯æ— æ³•é‡è½½çš„ï¼Œä¸¤ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ã€ä¿®é¥°ç¬¦ä¸ç®¡æ˜¯å¦ç›¸åŒï¼Œéƒ½å¿…é¡»ä½¿ç”¨ä¸ä¸€æ ·çš„åç§°ï¼Œä½†æ˜¯å¯¹äºå­—èŠ‚ç æ¥è®²ï¼Œå¦‚æœä¸¤ä¸ªå­—æ®µçš„æè¿°ç¬¦ä¸ä¸€è‡´ï¼Œé‚£å­—æ®µé‡åå°±æ˜¯åˆæ³•çš„ã€‚</li></ul><h4 id="fields-count-å­—æ®µè®¡æ•°å™¨">fields_count (å­—æ®µè®¡æ•°å™¨)</h4><ul><li>fields_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶fieldsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚</li><li>fieldsè¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªfield_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºè¯¥ç±»æˆ–æ¥å£æ‰€å£°æ˜çš„æ‰€æœ‰ç±»å­—æ®µæˆ–è€…å®ä¾‹å­—æ®µï¼Œä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨å£°æ˜<br>çš„å˜é‡ï¼Œä¹Ÿä¸åŒ…æ‹¬ä»çˆ¶ç±»æˆ–çˆ¶æ¥å£ç»§æ‰¿çš„é‚£äº›å­—æ®µã€‚</li></ul><h4 id="fields-å­—æ®µè¡¨">fields [ ] (å­—æ®µè¡¨)</h4><ul><li><p>fieldsè¡¨ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªfields_infoç»“æ„çš„æ•°æ®é¡¹ï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£ä¸­æŸä¸ªå­—æ®µçš„å®Œæ•´æè¿°ã€‚</p></li><li><p>ä¸€ä¸ªå­—æ®µçš„ä¿¡æ¯åŒ…æ‹¬å¦‚ä¸‹è¿™äº›ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä¸­ï¼Œ<strong>å„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰ï¼Œè¦ä¹ˆæ²¡æœ‰</strong>ã€‚</p><blockquote><p>ä½œç”¨åŸŸ(publicã€privateã€protectedä¿®é¥°ç¬¦)<br>æ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡(staticä¿®é¥°ç¬¦)<br>å¯å˜æ€§(fina1)<br>å¹¶å‘å¯è§æ€§(volatileä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™)<br>å¯å¦åºåˆ—åŒ–(transientä¿®é¥°ç¬¦)<br>å­—æ®µæ•°æ®ç±»å‹ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡ã€æ•°ç»„ï¼‰<br>å­—æ®µåç§°</p></blockquote></li><li><p>å­—æ®µè¡¨ç»“æ„</p></li></ul><p>å­—æ®µè¡¨ä½œä¸ºä¸€ä¸ªè¡¨ï¼ŒåŒæ ·æœ‰ä»–è‡ªå·±çš„ç»“æ„ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>å«ä¹‰</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>access_flags</td><td>è®¿é—®æ ‡å¿—</td><td>1</td></tr><tr><td>u2</td><td>name_index</td><td>å­—æ®µåç´¢å¼•</td><td>1</td></tr><tr><td>u2</td><td>descriptor_index</td><td>æè¿°ç¬¦ç´¢å¼•</td><td>1</td></tr><tr><td>u2</td><td>attributes_count</td><td>å±æ€§è®¡æ•°å™¨</td><td>1</td></tr><tr><td>attribute_info</td><td>attributes</td><td>å±æ€§é›†åˆ</td><td>attributes_count</td></tr></tbody></table><ul><li>å­—æ®µè¡¨è®¿é—®æ ‡è¯†<ul><li>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå­—æ®µå¯ä»¥è¢«å„ç§å…³é”®å­—å»ä¿®é¥°ï¼Œæ¯”å¦‚ï¼šä½œç”¨åŸŸä¿®é¥°ç¬¦(publicã€privateã€protected)ã€staticä¿®é¥°ç¬¦ã€finalä¿®é¥°ç¬¦ã€volatileä¿®é¥°ç¬¦ç­‰ç­‰ã€‚å› æ­¤ï¼Œå…¶å¯åƒç±»çš„è®¿é—®æ ‡å¿—é‚£æ ·ï¼Œä½¿ç”¨ä¸€äº›æ ‡å¿—æ¥æ ‡è®°å­—æ®µã€‚å­—æ®µçš„è®¿é—®æ ‡å¿—æœ‰å¦‚ä¸‹è¿™äº›:</li></ul></li></ul><table><thead><tr><th>æ ‡å¿—åç§°</th><th>æ ‡å¿—å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>å­—æ®µæ˜¯å¦ä¸ºpublic</td></tr><tr><td>ACC_PRIVATE</td><td>0x0002</td><td>å­—æ®µæ˜¯å¦ä¸ºprivate</td></tr><tr><td>ACC_PROTECTED</td><td>0x0004</td><td>å­—æ®µæ˜¯å¦ä¸ºprotected</td></tr><tr><td>ACC_STATIC</td><td>0x0008</td><td>å­—æ®µæ˜¯å¦ä¸ºstatic</td></tr><tr><td>ACC_FINAL</td><td>0x0010</td><td>å­—æ®µæ˜¯å¦ä¸ºfinal</td></tr><tr><td>ACC_VOLATILE</td><td>0x0040</td><td>å­—æ®µæ˜¯å¦ä¸ºvolatile</td></tr><tr><td>ACC_TRANSTENT</td><td>0x0080</td><td>å­—æ®µæ˜¯å¦ä¸ºtransient</td></tr><tr><td>ACC_SYNCHETIC</td><td>0x1000</td><td>å­—æ®µæ˜¯å¦ä¸ºç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿ</td></tr><tr><td>ACC_ENUM</td><td>0x4000</td><td>å­—æ®µæ˜¯å¦ä¸ºenum</td></tr></tbody></table><ul><li>å­—æ®µåç´¢å¼•</li></ul><p>æ ¹æ®å­—æ®µåç´¢å¼•çš„å€¼, æŸ¥è¯¢å¸¸é‡æ± ä¸­çš„æŒ‡å®šç´¢å¼•é¡¹å³å¯</p><ul><li>æè¿°ç¬¦ç´¢å¼•</li></ul><p>æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹(byte,char,double,float,int,1ong,short,boolean)åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹è±¡åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th>å­—ç¬¦</th><th>ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>B</td><td>byte</td><td>æœ‰ç¬¦å·å­—èŠ‚å‹æ•°</td></tr><tr><td>C</td><td>char</td><td>Unicodeå­—ç¬¦, UTF-16 ç¼–ç </td></tr><tr><td>D</td><td>double</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>F</td><td>float</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>I</td><td>int</td><td>æ•´å‹æ•°</td></tr><tr><td>J</td><td>long</td><td>é•¿æ•´æ•°</td></tr><tr><td>S</td><td>short</td><td>æœ‰ç¬¦å·çŸ­æ•´æ•°</td></tr><tr><td>Z</td><td>boolean</td><td>å¸ƒå°”å€¼ true/false</td></tr><tr><td>L Classname;</td><td>reference</td><td>ä¸€ä¸ªåä¸ºClassnameçš„å®ä¾‹</td></tr><tr><td>[</td><td>reference</td><td>ä¸€ä¸ªä¸€ç»´æ•°ç»„</td></tr></tbody></table><p><img src="./../jvm-class1/image-20240104231010344.png" alt="å­—èŠ‚ç è§£æ"></p><ul><li>å±æ€§è¡¨é›†åˆ</li></ul><p>ä¸€ä¸ªå­—æ®µè¿˜å¯èƒ½æ‹¥æœ‰ä¸€äº›å±æ€§ï¼Œç”¨äºå­˜å‚¨æ›´å¤šçš„é¢å¤–ä¿¡æ¯ã€‚æ¯”å¦‚åˆå§‹åŒ–å€¼ã€ä¸€äº›æ³¨é‡Šä¿¡æ¯ç­‰ã€‚å±æ€§ä¸ªæ•°å­˜æ”¾åœ¨attribute_countä¸­ï¼Œå±æ€§å…·ä½“å†…å®¹å­˜æ”¾åœ¨attributesæ•°ç»„ä¸­ã€‚</p><p>ä»¥å¸¸é‡å±æ€§ä¸ºä¾‹, ç»“æ„ä¸º:</p><pre class="line-numbers language-null" data-language="null"><code class="language-null">ConstantValue_attribute &#123;u2 attribute name_index;u4 attribute_length;u2 constantvalue index;&#125;è¯´æ˜: å¯¹äºå¸¸é‡å±æ€§è€Œè¨€, attribute_lengthå€¼æ’ä¸º2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–¹æ³•è¡¨é›†åˆ">æ–¹æ³•è¡¨é›†åˆ</h3><p>methods: æŒ‡å‘å¸¸é‡æ± æ‰‰å¼•é›†åˆï¼Œå®ƒå®Œæ•´æè¿°äº†æ¯ä¸ªæ–¹æ³•çš„ç­¾åã€‚</p><ul><li>åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ªmethod_infoé¡¹éƒ½å¯¹åº”ç€ä¸€ä¸ªç±»æˆ–è€…æ¥å£ä¸­çš„æ–¹æ³•ä¿¡æ¯ã€‚æ¯”å¦‚æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦(publicã€privateæˆ–protected),æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ä»¥åŠæ–¹æ³•çš„å‚æ•°ä¿¡æ¯ç­‰ã€‚</li><li>å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸æ˜¯æŠ½è±¡çš„æˆ–è€…ä¸æ˜¯nativeçš„ï¼Œé‚£ä¹ˆå­—èŠ‚ç ä¸­ä¼šä½“ç°å‡ºæ¥ã€‚</li><li>ä¸€æ–¹é¢ï¼Œmethodsè¡¨åªæè¿°å½“å‰ç±»æˆ–æ¥å£ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œä¸åŒ…æ‹¬ä»çˆ¶ç±»æˆ–çˆ¶æ¥å£ç»§æ‰¿çš„æ–¹æ³•ã€‚å¦ä¸€æ–¹é¢ï¼Œmethodsè¡¨æœ‰å¯èƒ½<br>ä¼šå‡ºç°ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ çš„æ–¹æ³•ï¼Œæœ€å…¸å‹çš„ä¾¿æ˜¯ç¼–è¯‘å™¨äº§ç”Ÿçš„æ–¹æ³•ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼šç±»ï¼ˆæ¥å£ï¼‰åˆå§‹åŒ–æ–¹æ³•<code>&lt;clinit&gt;()</code>å’Œå®ä¾‹åˆ<br>å§‹åŒ–æ–¹æ³•<code>&lt;init&gt;()</code>)ã€‚</li></ul><p><strong>ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š</strong><br>åœ¨Javaè¯­è¨€ä¸­ï¼Œè¦é‡è½½(Overload)ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†è¦ä¸åŸæ–¹æ³•å…·æœ‰ç›¸åŒçš„ç®€å•åç§°ä¹‹å¤–ï¼Œè¿˜è¦æ±‚å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªä¸åŸæ–¹æ³•ä¸åŒçš„ç‰¹å¾ç­¾åï¼Œç‰¹å¾ç­¾åå°±æ˜¯ä¸€ä¸ªæ–¹æ³•ä¸­å„ä¸ªå‚æ•°åœ¨å¸¸é‡æ± ä¸­çš„å­—æ®µç¬¦å·å¼•ç”¨çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯å› ä¸ºè¿”å›å€¼ä¸ä¼šåŒ…å«åœ¨ç‰¹å¾ç­¾åä¹‹ä¸­ï¼Œå› æ­¤Javaè¯­è¨€é‡Œæ— æ³•ä»…ä»…ä¾é è¿”å›å€¼çš„ä¸åŒæ¥å¯¹ä¸€ä¸ªå·²æœ‰æ–¹æ³•è¿›è¡Œé‡è½½ã€‚ä½†åœ¨Classæ–‡ä»¶æ ¼å¼ä¸­ï¼Œç‰¹å¾ç­¾åçš„èŒƒå›´æ›´å¤§ä¸€äº›ï¼Œåªè¦æè¿°ç¬¦ä¸æ˜¯å®Œå…¨ä¸€è‡´çš„ä¸¤ä¸ªæ–¹æ³•å°±å¯ä»¥å…±å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªæ–¹æ³•æœ‰ç›¸åŒçš„åç§°å’Œç‰¹å¾ç­¾åï¼Œä½†è¿”å›å€¼ä¸åŒï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥åˆæ³•å…±å­˜äºåŒä¸€ä¸ªclassæ–‡ä»¶ä¸­ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡Javaè¯­æ³•è§„èŒƒå¹¶ä¸å…è®¸åœ¨ä¸€ä¸ªç±»æˆ–è€…æ¥å£ä¸­å£°æ˜å¤šä¸ªæ–¹æ³•ç­¾åç›¸åŒçš„æ–¹æ³•ï¼Œä½†æ˜¯å’ŒJavaè¯­æ³•è§„èŒƒç›¸åï¼Œå­—èŠ‚ç æ–‡ä»¶ä¸­å´æ°æ°å…è®¸å­˜æ”¾å¤šä¸ªæ–¹æ³•ç­¾åç›¸åŒçš„æ–¹æ³•ï¼Œå”¯ä¸€çš„æ¡ä»¶å°±æ˜¯è¿™äº›æ–¹æ³•ä¹‹é—´çš„è¿”å›å€¼ä¸èƒ½ç›¸åŒã€‚</p><h4 id="methods-count-æ–¹æ³•è®¡æ•°å™¨">methods_count (æ–¹æ³•è®¡æ•°å™¨)</h4><p>methods_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶methodsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚</p><p>methods è¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ã€‚</p><h4 id="methods-æ–¹æ³•è¡¨">methods [ ] (æ–¹æ³•è¡¨)</h4><ul><li>methodsè¡¨ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£ä¸­æŸä¸ªæ–¹æ³•çš„å®Œæ•´æè¿°ã€‚å¦‚æœæŸä¸ªmethod_infoç»“æ„çš„access_flagsé¡¹æ—¢æ²¡æœ‰è®¾ç½® ACC_NATIVE æ ‡å¿—ä¹Ÿæ²¡æœ‰è®¾ç½® ACC_ABSTRACT æ ‡å¿—ï¼Œé‚£ä¹ˆè¯¥ç»“æ„ä¸­ä¹Ÿåº”åŒ…å«å®ç°è¿™ä¸ªæ–¹æ³•æ‰€ç”¨çš„Javaè™šæ‹ŸæœºæŒ‡ä»¤ã€‚</li><li>method_infoç»“æ„å¯ä»¥è¡¨ç¤ºç±»å’Œæ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•å’Œç±»æˆ–æ¥å£åˆå§‹åŒ–æ–¹æ³•</li><li>æ–¹æ³•è¡¨çš„ç»“æ„å®é™…è·Ÿå­—æ®µè¡¨æ˜¯ä¸€å’©çš„ï¼Œæ–¹æ³•è¡¨ç»“æ„å¦‚ä¸‹ï¼š</li></ul><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>å«ä¹‰</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>u2</td><td>access_flags</td><td>è®¿é—®æ ‡å¿—</td><td>1</td></tr><tr><td>u2</td><td>name_index</td><td>æ–¹æ³•åç´¢å¼•</td><td>1</td></tr><tr><td>u2</td><td>descriptor_index</td><td>æè¿°ç¬¦ç´¢å¼•</td><td>1</td></tr><tr><td>u2</td><td>attributes_count</td><td>å±æ€§è®¡æ•°å™¨</td><td>1</td></tr><tr><td>attribute_info</td><td>attributes</td><td>å±æ€§é›†åˆ</td><td>attributes_count</td></tr></tbody></table><h4 id="æ–¹æ³•è¡¨è®¿é—®æ ‡å¿—">æ–¹æ³•è¡¨è®¿é—®æ ‡å¿—</h4><p>è·Ÿå­—æ®µè¡¨ä¸€æ ·, æ–¹æ³•è¡¨ä¹Ÿæœ‰è®¿é—®æ ‡å¿—, è€Œä¸”ä»–ä»¬çš„æ ‡å¿—æœ‰éƒ¨åˆ†ç›¸åŒ, éƒ¨åˆ†åˆ™ä¸åŒ, æ”¾å‘è¡¨çš„å…·ä½“è®¿é—®æ ‡å¿—å¦‚ä¸‹:</p><table><thead><tr><th>æ ‡å¿—åç§°</th><th>æ ‡å¿—å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ACC_PUBLIC</td><td>0x0001</td><td>public, æ–¹æ³•å¯ä»¥ä»åŒ…å¤–è®¿é—®</td></tr><tr><td>ACC_PRIVATE</td><td>0x0002</td><td>private, æ–¹æ³•åªèƒ½æœ¬ç±»ä¸­è®¿é—®</td></tr><tr><td>ACC_PROTECTED</td><td>0x0004</td><td>protected, æ–¹æ³•åœ¨è‡ªèº«å’Œå­ç±»å¯ä»¥è®¿é—®</td></tr><tr><td>ACC_STATIC</td><td>0x0008</td><td>static, é™æ€æ–¹æ³•</td></tr></tbody></table><p><img src="./../jvm-class1/image-20240104233558080.png" alt="å­—èŠ‚ç è§£æ"></p><h3 id="å±æ€§è¡¨é›†åˆ">å±æ€§è¡¨é›†åˆ</h3><p><strong>å±æ€§è¡¨é›†åˆ(attributes)</strong></p><p>æ–¹æ³•è¡¨é›†åˆä¹‹åçš„å±æ€§è¡¨é›†åˆï¼Œ<strong>æŒ‡çš„æ˜¯Classæ–‡ä»¶æ‰€æºå¸¦çš„è¾…åŠ©ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚è¯¥Classæ–‡ä»¶çš„æºæ–‡ä»¶çš„åç§°ã€‚ä»¥åŠä»»ä½•å¸¦æœ‰RetentionPolicy.CLASS æˆ–è€… RetentionPolicy.RUNTIME çš„æ³¨è§£ã€‚è¿™ç±»ä¿¡æ¯é€šå¸¸è¢«ç”¨äº Java è™šæ‹Ÿæœºçš„éªŒè¯å’Œè¿è¡Œï¼Œä»¥åŠ Java ç¨‹åºçš„è°ƒè¯•ï¼Œ<strong>ä¸€èˆ¬æ— é¡»æ·±å…¥äº†è§£</strong>ã€‚</p><p>æ­¤å¤–ï¼Œå­—æ®µè¡¨ã€æ–¹æ³•è¡¨éƒ½å¯ä»¥æœ‰è‡ªå·±çš„å±æ€§è¡¨ã€‚ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚</p><p>å±æ€§è¡¨é›†åˆçš„é™åˆ¶æ²¡æœ‰é‚£ä¹ˆä¸¥æ ¼ï¼Œä¸å†è¦æ±‚å„ä¸ªå±æ€§è¡¨å…·æœ‰ä¸¥æ ¼çš„é¡ºåºï¼Œå¹¶ä¸”åªè¦ä¸ä¸å·²æœ‰çš„å±æ€§åé‡å¤ï¼Œä»»ä½•äººå®ç°çš„ç¼–è¯‘å™¨<br>éƒ½å¯ä»¥å‘å±æ€§è¡¨ä¸­å†™å…¥è‡ªå·±å®šä¹‰çš„å±æ€§ä¿¡æ¯ï¼Œä½† Java è™šæ‹Ÿæœºè¿è¡Œæ—¶ä¼šå¿½ç•¥æ‰å®ƒä¸è®¤è¯†çš„å±æ€§ã€‚</p><h4 id="attributes-count-å±æ€§è®¡æ•°å™¨">attributes_count (å±æ€§è®¡æ•°å™¨)</h4><p>attributes_count çš„å€¼è¡¨ç¤ºå½“å‰ Class æ–‡ä»¶å±æ€§è¡¨çš„æˆå‘˜ä¸ªæ•°. å±æ€§è¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªattribute_infoç»“æ„</p><h4 id="attributes-å±æ€§è¡¨">attributes [ ] (å±æ€§è¡¨)</h4><p>å±æ€§è¡¨çš„æ¯ä¸ªé¡¹çš„å€¼å¿…é¡»æ˜¯attribute_infoç»“æ„, å±æ€§è¡¨çš„ç»“æ„æ¯”è¾ƒçµæ´», å„ç§ä¸åŒçš„å±æ€§åªè¦æ»¡è¶³ä»¥ä¸‹ç»“æ„å³å¯.</p><ul><li>å±æ€§çš„é€šç”¨æ ¼å¼</li></ul><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td><td>å±æ€§åç´¢å¼•</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td><td>å±æ€§é•¿åº¦</td></tr><tr><td>u1</td><td>info</td><td>attribute_length</td><td>å±æ€§è¡¨</td></tr></tbody></table><ul><li>å±æ€§ç±»å‹</li></ul><p>å±æ€§è¡¨å®é™…ä¸Šå¯ä»¥æœ‰å¾ˆå¤šç±»å‹, ä¸Šé¢çœ‹åˆ°çš„Codeå±æ€§åªæ˜¯å…¶ä¸­ä¸€ç§, Java8é‡Œé¢å®šä¹‰äº†23ä¸­å±æ€§.</p><p>ä¸‹é¢è¿™äº›äº‹è™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„å±æ€§:</p><table><thead><tr><th>å±æ€§åç§°</th><th>ä½¿ç”¨ä½ç½®</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>Code</td><td>æ–¹æ³•è¡¨</td><td>Javaä»£ç ç¼–è¯‘æˆçš„å­—èŠ‚ç æŒ‡ä»¤</td></tr><tr><td>ConstantValue</td><td>å­—æ®µè¡¨</td><td>finalå…³é”®å­—å®šä¹‰çš„å¸¸é‡æ± </td></tr><tr><td>Deprecated</td><td>ç±»ã€æ–¹æ³•ã€å­—æ®µè¡¨</td><td>è¢«å£°æ˜ä¸ºdeprecatedçš„æ–¹æ³•å’Œå­—æ®µ</td></tr><tr><td>Exceptions</td><td>æ–¹æ³•è¡¨</td><td>æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸</td></tr><tr><td>EnclosingMethod</td><td>ç±»æ–‡ä»¶</td><td>ä»…å½“ä¸€ä¸ªç±»ä¸ºå±€éƒ¨ç±»æˆ–è€…åŒ¿åç±»æ˜¯æ‰èƒ½æ‹¥æœ‰è¿™ä¸ªå±æ€§, è¿™ä¸ªå±æ€§ç”¨äºæ ‡è¯†è¿™ä¸ªç±»æ‰€åœ¨çš„å¤–åœˆæ–¹æ³•</td></tr><tr><td>InnerClass</td><td>ç±»æ–‡ä»¶</td><td>å†…éƒ¨ç±»åˆ—è¡¨</td></tr><tr><td>LineNumberTable</td><td>Codeå±æ€§</td><td>Javaæºç çš„è¡Œå·ä¸å­—èŠ‚ç æŒ‡ä»¤çš„å¯¹åº”å…³ç³»</td></tr><tr><td>LocalVariableTable</td><td>Codeå±æ€§</td><td>æ–¹æ³•çš„å±€éƒ¨å˜é‡æè¿°</td></tr><tr><td>StackMapTable</td><td>Codeå±æ€§</td><td>JDK1.6ä¸­æ–°å¢çš„å±æ€§, ä¾›æ–°çš„ç±»å‹æ£€æŸ¥æ£€éªŒå™¨æ£€æŸ¥å’Œå¤„ç†ç›®æ ‡æ–¹æ³•çš„å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æœ‰æ‰€éœ€è¦çš„ç±»æ˜¯å¦åŒ¹é…</td></tr><tr><td>Signature</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td>ç”¨äºæ”¯æŒæ³›å‹æƒ…å†µä¸‹çš„æ–¹æ³•ç­¾å</td></tr><tr><td>SourceFile</td><td>ç±»æ–‡ä»¶</td><td>è®°å½•æºæ–‡ä»¶åç§°</td></tr><tr><td>SourceDebugExtension</td><td>ç±»æ–‡ä»¶</td><td>ç”¨äºå­˜å‚¨é¢å¤–çš„è°ƒè¯•ä¿¡æ¯</td></tr><tr><td>Synthetic</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td>æ ‡å¿—æ–¹æ³•æˆ–å­—æ®µä¸ºç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„</td></tr><tr><td>LocalVariableTypeTable</td><td>ç±»</td><td>ä½¿ç”¨ç‰¹å¾ç­¾åä»£æ›¿æè¿°ç¬¦, æ˜¯ä¸ºäº†å¼•å…¥æ³›å‹è¯­æ³•ä¹‹åèƒ½æè¿°æ³›å‹å‚æ•°åŒ–ç±»å‹è€Œæ·»åŠ </td></tr><tr><td>RuntimeVisibleAnnotations</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td>ä¸ºåŠ¨æ€æ³¨è§£æä¾›æ”¯æŒ</td></tr><tr><td>RuntimeInvisibleAnotations</td><td>ç±»ã€æ–¹æ³•è¡¨ã€å­—æ®µè¡¨</td><td>ç”¨äºæŒ‡æ˜å“ªäº›æ³¨è§£æ˜¯è¿è¡Œæ—¶ä¸å¯è§çš„</td></tr><tr><td>RuntimeVisibleParameterAnnotation</td><td>æ–¹æ³•è¡¨</td><td>ä½œç”¨ä¸RuntimeVisibleAnnotationså±æ€§ç±»ä¼¼, åªä¸è¿‡ä½œç”¨å¯¹è±¡ä¸ºæ–¹æ³•</td></tr><tr><td>RuntimeInvisibleParameterAnnotation</td><td>æ–¹æ³•è¡¨</td><td>ä½œç”¨ä¸RuntimeInvisibleAnotationså±æ€§ç±»ä¼¼, ä½œç”¨å¯¹è±¡å“ªä¸ªä¸ºæ–¹æ³•å‚æ•°</td></tr><tr><td>AnnotationDefault</td><td>æ–¹æ³•è¡¨</td><td>ç”¨äºè®°å½•æ³¨è§£ç±»å…ƒç´ çš„é»˜è®¤å€¼</td></tr><tr><td>BootstrapMethods</td><td>ç±»æ–‡ä»¶</td><td>ç”¨äºä¿å­˜invokeddynamicæŒ‡ä»¤å¼•ç”¨çš„å¼•å¯¼æ–¹å¼é™å®šç¬¦</td></tr></tbody></table><p>éƒ¨åˆ†å±æ€§è¯¦è§£</p><ol><li>ConstantValue å±æ€§<br>ConstantValue å±æ€§è¡¨ç¤ºä¸€ä¸ªå¸¸é‡å­—æ®µçš„å€¼, ä½äº field_info ç»“æ„çš„å±æ€§è¡¨ä¸­</li></ol><pre class="line-numbers language-null" data-language="null"><code class="language-null">ConstantValue_attribute &#123;u2 attribute_name_index;u4 attribute_length;u2 constantvalue_index; &#x2F;&#x2F; å­—æ®µå€¼åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•, å¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹ç»™å‡ºè¯¥å±æ€§è¡¨ç¤ºçš„å¸¸é‡å€¼ (ä¾‹å¦‚, å€¼æ˜¯longå‹çš„, åœ¨å¸¸é‡æ± ä¸­ä¾¿æ˜¯ CONSTANT_Long)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>Deprecated å±æ€§<br>Deprecated å±æ€§æ˜¯åœ¨ JDK1.1 ä¸ºäº†æ”¯æŒæ³¨è§£ä¸­çš„å…³é”®è¯<code>@deprecated</code> è€Œå¼•å…¥çš„</li></ol><pre class="line-numbers language-null" data-language="null"><code class="language-null">Deprecated_attribute &#123;u2 attribute_name_index;u4 attribute_length;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li><p>Code å±æ€§<br>Code å±æ€§å°±æ˜¯å­˜æ”¾æ–¹æ³•ä½“é‡Œé¢çš„ä»£ç . ä½†æ˜¯, å¹¶éæ‰€æœ‰æ–¹æ³•è¡¨éƒ½æœ‰ Code å±æ€§. åƒæ¥å£æˆ–è€…æŠ½è±¡æ–¹æ³•, ä»–ä»¬æ²¡æœ‰å…·ä½“çš„æ–¹æ³•ä½“, å› æ­¤ä¹Ÿå°±ä¸ä¼šæœ‰ Code å±æ€§äº†.</p><p>Code å±æ€§è¡¨çš„ç»“æ„, å¦‚ä¸‹å›¾:</p></li></ol><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>u2</td><td>attrubute_name_index</td><td>1</td><td>å±æ€§åç´¢å¼•</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td><td>å±æ€§é•¿åº¦</td></tr><tr><td>u2</td><td>max_stack</td><td>1</td><td>æ“ä½œæ•°æ ˆæ·±åº¦çš„æœ€å¤§å€¼</td></tr><tr><td>u2</td><td>max_locals</td><td>1</td><td>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å­˜ç»­ç©ºé—´</td></tr><tr><td>u4</td><td>code_length</td><td>1</td><td>å­—èŠ‚ç æŒ‡ä»¤çš„é•¿åº¦</td></tr><tr><td>u1</td><td>code</td><td>code_length</td><td>å­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤</td></tr><tr><td>u2</td><td>exception_table_length</td><td>1</td><td>å¼‚å¸¸è¡¨é•¿åº¦</td></tr><tr><td>exception_info</td><td>exception_table</td><td>exception_length</td><td>å¼‚å¸¸è¡¨</td></tr><tr><td>u2</td><td>attributes_count</td><td>1</td><td>å±æ€§é›†åˆè®¡æ•°å™¨</td></tr><tr><td>attribute_info</td><td>attributes</td><td>attributes_count</td><td>å±æ€§é›†åˆ</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°: Code å±æ€§è¡¨çš„å‰ä¸¤é¡¹è·Ÿå±æ€§è¡¨æ˜¯ä¸€è‡´çš„, å³ Code å±æ€§è¡¨éµå¾ªå±æ€§è¡¨çš„ç»“æ„, åé¢é‚£äº›åˆ™æ˜¯ä»–è‡ªå·±å®šä¹‰çš„ç»“æ„</p><ol start="4"><li><p>InnerClasses å±æ€§<br>ä¸ºäº†æ–¹ä¾¿è¯´æ˜ç‰¹åˆ«å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºç±»æˆ–æ¥å£çš„ Class æ ¼å¼ä¸º C ã€‚å¦‚æœ C çš„å¸¸é‡æ± ä¸­åŒ…å«æŸä¸ªCONSTANT_Class_infoæˆå‘˜ï¼Œä¸”è¿™ä¸ªæˆå‘˜æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£ä¸å±äºä»»ä½•ä¸€ä¸ªåŒ…ï¼Œé‚£ä¹ˆ C çš„ ClassFile ç»“æ„çš„å±æ€§è¡¨ä¸­å°±å¿…é¡»å«æœ‰å¯¹åº”çš„ InnerClasses å±æ€§ã€‚InnerClasses å±æ€§æ˜¯åœ¨ JDK1.1 ä¸­ä¸ºäº†æ”¯æŒå†…éƒ¨ç±»å’Œå†…éƒ¨æ¥å£è€Œå¼•å…¥çš„ï¼Œä½äºClassFileç»“æ„çš„å±æ€§è¡¨ã€‚</p></li><li><p>LineNumberTable å±æ€§</p><p>LineNumberTable å±æ€§æ˜¯å¯é€‰å˜é•¿å±æ€§, ä½äº Code ç»“æ„çš„å±æ€§è¡¨</p><p>LineNumberTable å±æ€§æ˜¯**ç”¨æ¥æè¿° Java æºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ä¹‹é—´çš„å¯¹åº”å…³ç³». **è¿™ä¸ªå±æ€§å¯ä»¥ç”¨æ¥åœ¨è°ƒè¯•çš„æ—¶å€™å®šä½ä»£ç æ‰§è¡Œè¡Œçš„è¡Œæ•°</p><ul><li><p>start_pc, å³å­—èŠ‚ç è¡Œå·; line_number, å³ Java æºä»£ç è¡Œå·</p><p>åœ¨ Code å±æ€§çš„å±æ€§è¡¨ä¸­, LineNumberTable å±æ€§å¯ä»¥æŒ‰ç…§è®¤æ„é¡ºåºå‡ºç°, æ­¤å¤–, å¤šä¸ªLineNumberTable å±æ€§å¯ä»¥å…±åŒè¡¨ç¤ºä¸€ä¸ªè¡Œå·åœ¨æºæ–‡ä»¶ä¸­è¡¨ç¤ºçš„å†…å®¹, å³ LineNumberTable å±æ€§ä¸éœ€è¦ä¸æºæ–‡ä»¶çš„è¡Œä¸€ä¸€å¯¹åº”</p></li></ul></li></ol><p>â€‹LineNuberTableå±æ€§è¡¨ç»“æ„</p><pre class="line-numbers language-null" data-language="null"><code class="language-null">LineNumberTable_attribute &#123;u2 attribute_name_inex;u4 attribute_length;u2 line_number_table_length:&#123;u2 start_pc;u2 line_number;&#125; line_number_table[line_number_table_length]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6"><li><p>LocalVariableTable å±æ€§</p><p>LocalVariableTable æ˜¯å¯é€‰å˜é•¿å±æ€§, ä½äº Code å±æ€§çš„å±æ€§è¡¨ä¸­. å®ƒè¢«è°ƒè¯•å™¨<strong>ç”¨äºç¡®å®šæ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡çš„è€Œä¿¡æ¯</strong></p><p>åœ¨ Code å±æ€§çš„å±æ€§è¡¨ä¸­, LocalVariableTable å±æ€§å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå‡ºç°. Code å±æ€§ä¸­çš„æ¯ä¸ªå±€éƒ¨å˜é‡æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª LocalVariableTable å±æ€§</p><ul><li><code>start pc + length</code> è¡¨ç¤ºè¿™ä¸ªå˜é‡åœ¨å­—èŠ‚ç ä¸­çš„ç”Ÿå‘½å‘¨æœŸèµ·å§‹å’Œç»“æŸçš„åç§»ä½ç½® (thiså£°æ˜å‘¨æœŸä»å¤´ 0 åˆ°ç»“å°¾ 10)</li><li>index å°±æ˜¯è¿™ä¸ªå˜é‡åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½ (æ§½ä½å¯å¤ç”¨)</li><li>name å°±æ˜¯å˜é‡åç§°</li><li>Descriptor è¡¨ç¤ºå±€éƒ¨å˜é‡ç±»å‹æè¿°</li></ul><p>LocalVariabletable å±æ€§è¡¨ç»“æ„:</p></li></ol><pre class="line-numbers language-null" data-language="null"><code class="language-null">LocalVariabletable_atribute &#123;u2 attribute_name_index;u4 attribute_length;u2 local_variable_table_length:&#123;u2 start_pc;u2 length;u2 name_index;u2 descriptor_index;u2 index;&#125; local_variable_table[local_variable_table_length];&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="7"><li><p>Signature å±æ€§</p><p>Signature å±æ€§æ˜¯å¯é€‰çš„å®šé•¿å±æ€§, ä½äº ClassFile, field_info æˆ– method_info ç»“æ„çš„å±æ€§è¡¨ä¸­. åœ¨ Java è¯­è¨€ä¸­, ä»»ä½•ç±»ã€æ¥å£ã€åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ (Type Variables) æˆ–å‚æ•°åŒ–ç±»å‹ (Parameterized Types), åˆ™ Signature å±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯.</p></li><li><p>SourceFile å±æ€§</p><p>SourceFile å±æ€§ç»“æ„</p></li></ol><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>æ•°é‡</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>u2</td><td>attribute_name_index</td><td>1</td><td>å±æ€§åç´¢å¼•</td></tr><tr><td>u4</td><td>attribute_length</td><td>1</td><td>å±æ€§é•¿åº¦</td></tr><tr><td>u2</td><td>sourcefile_index</td><td>1</td><td>æºæ–‡ä»¶ç´¢å¼•</td></tr></tbody></table><ol start="9"><li><p>å…¶ä»–å±æ€§</p><p>Java è™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„å±æ€§æœ‰20å¤šä¸ª, è¿™é‡Œä¸ä¸€ä¸€ä»‹ç», é€šè¿‡ä¸Šé¢å‡ ä¸ªå±æ€§çš„ä»‹ç», åªè¦é¢†ä¼šå…¶ç²¾é«“, å…¶ä»–å±æ€§çš„è§£è¯»ä¹Ÿæ˜¯æ˜“å¦‚åæŒ</p></li></ol><h3 id="å°ç»“">å°ç»“</h3><p>æœ¬ç« ä¸»è¦ä»‹ç»äº†c1assæ–‡ä»¶çš„åŸºæœ¬æ ¼å¼ã€‚</p><p>éšç€Javaå¹³å°çš„ä¸æ–­å‘å±•ï¼Œåœ¨å°†æ¥ï¼Œc1assæ–‡ä»¶çš„å†…å®¹ä¹Ÿä¸€å®šä¼šåšè¿›ä¸€æ­¥çš„æ‰©å……ï¼Œä½†æ˜¯å…¶åŸºæœ¬çš„æ ¼å¼å’Œç»“æ„ä¸ä¼šåšé‡å¤§è°ƒæ•´ã€‚</p><p>ä»Javaè™šæ‹Ÿæœºçš„è§’åº¦çœ‹ï¼Œé€šè¿‡Classæ–‡ä»¶ï¼Œå¯ä»¥è®©æ›´å¤šçš„è®¡ç®—æœºè¯­è¨€æ”¯æŒJavaè™šæ‹Ÿæœºå¹³å°ã€‚å› æ­¤ï¼ŒClassæ–‡ä»¶ç»“æ„ä¸ä»…ä»…<br>æ˜¯Javaè™šæ‹Ÿæœºçš„æ‰§è¡Œå…¥å£ï¼Œæ›´æ˜¯Javaç”Ÿæ€åœˆçš„åŸºç¡€å’Œæ ¸å¿ƒã€‚</p><h2 id="04-ä½¿ç”¨javapæŒ‡ä»¤è§£æClassæ–‡ä»¶">04-ä½¿ç”¨javapæŒ‡ä»¤è§£æClassæ–‡ä»¶</h2><p><strong>è§£æå­—èŠ‚ç çš„ä½œç”¨</strong></p><ul><li><p>é€šè¿‡åç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥çš„äº†è§£jvaä»£ç çš„å·¥ä½œæœºåˆ¶ã€‚ä½†æ˜¯ï¼Œè‡ªå·±åˆ†æç±»æ–‡ä»¶ç»“æ„å¤ªéº»çƒ¦äº†ï¼é™¤äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„jclasslib å·¥å…·ä¹‹å¤–ï¼Œoracle å®˜æ–¹ä¹Ÿæä¾›äº†å·¥å…·ï¼šjavapã€‚</p></li><li><p>javap æ˜¯ jdk è‡ªå¸¦çš„åè§£æå·¥å…·ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯æ ¹æ® class å­—èŠ‚ç æ–‡ä»¶ï¼Œåè§£æå‡ºå½“å‰ç±»å¯¹åº”çš„ code åŒºï¼ˆå­—èŠ‚ç æŒ‡ä»¤ï¼‰å±€éƒ¨å˜é‡è¡¨ã€å¼‚å¸¸è¡¨å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ç­‰ä¿¡æ¯ã€‚</p></li><li><p>é€šè¿‡å±€éƒ¨å˜é‡è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´ã€æ‰€åœ¨æ§½ä½ç­‰ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥çœ‹åˆ°æ§½ä½å¤ç”¨ç­‰ä¿¡æ¯ã€‚</p></li></ul><p><strong><code>javac -g</code> æ“ä½œ</strong></p><ul><li><p>è§£æå­—èŠ‚ç æ–‡ä»¶å¾—åˆ°çš„ä¿¡æ¯ä¸­ï¼Œæœ‰äº›ä¿¡æ¯ï¼ˆå¦‚å±€éƒ¨å˜é‡è¡¨ã€æŒ‡ä»¤å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ä¸­æ–¹æ³•çš„å‚æ•°åç§°ç­‰<br>ç­‰)éœ€è¦åœ¨ä½¿ç”¨ javac ç¼–è¯‘æˆ class æ–‡ä»¶æ—¶ï¼ŒæŒ‡å®šå‚æ•°æ‰èƒ½è¾“å‡ºã€‚</p></li><li><p>æ¯”å¦‚ï¼Œä½ ç›´æ¥ javac xx.javaï¼Œå°±ä¸ä¼šåœ¨ç”Ÿæˆå¯¹åº”çš„å±€éƒ¨å˜é‡è¡¨ç­‰ä¿¡æ¯ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>javac -g xx.java</code> å°±å¯ä»¥ç”Ÿæˆ<br>æ‰€æœ‰ç›¸å…³ä¿¡æ¯äº†ã€‚å¦‚æœä½ ä½¿ç”¨çš„ eclipse æˆ– IDEAï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œeclipseã€IDEAåœ¨ç¼–è¯‘æ—¶ä¼šå¸®ä½ ç”Ÿæˆå±€éƒ¨å˜é‡è¡¨ã€æŒ‡ä»¤å’Œä»£ç è¡Œç§»é‡æ˜ å°„è¡¨ç­‰ä¿¡æ¯çš„ã€‚</p></li></ul><p><strong>javap çš„ç”¨æ³•</strong></p><p><code>javap &lt;option&gt; &lt;classes&gt;</code></p><p>å…¶ä¸­, classes å°±æ˜¯è¦åç¼–è¯‘çš„classæ–‡ä»¶.</p><p>å‚æ•°ä»‹ç»:</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>-version</td><td>ç‰ˆæœ¬ä¿¡æ¯, å…¶å®æ˜¯å½“å‰ javap æ‰€åœ¨ jdk çš„ç‰ˆæœ¬ä¿¡æ¯, ä¸æ˜¯ class åœ¨å“ªä¸ª jdk ä¸‹ç”Ÿæˆçš„</td></tr><tr><td>-public</td><td>ä»…æ˜¾ç¤ºå…¬å…±ç±»å’Œæˆå‘˜</td></tr><tr><td>-protected</td><td>æ˜¾ç¤ºå—ä¿æŠ¤çš„/å…¬å…±ç±»å’Œæˆå‘˜</td></tr><tr><td>-p -private (å¸¸ç”¨)</td><td>æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜</td></tr><tr><td>-package</td><td>æ˜¾ç¤ºç¨‹åºåŒ…/å—ä¿æŠ¤çš„/å…¬å…±ç±» å’Œæˆå‘˜(é»˜è®¤)</td></tr><tr><td>-sysinfo</td><td>æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„ç±»çš„ç³»ç»Ÿä¿¡æ¯(è·¯å¾„, å¤§å°, æ—¥æœŸ, MD5 æ•£åˆ—, æºæ–‡ä»¶å)</td></tr><tr><td>-constants</td><td>æ˜¾ç¤ºé™æ€æœ€ç»ˆå¸¸é‡</td></tr><tr><td>-s</td><td>è¾“å‡ºå†…éƒ¨ç±»å‹ç­¾å</td></tr><tr><td>-l</td><td>è¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨</td></tr><tr><td>-c</td><td>å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼–</td></tr><tr><td>-v -verbose (å¸¸ç”¨)</td><td>è¾“å‡ºé™„åŠ ä¿¡æ¯(åŒ…æ‹¬è¡Œå·ã€æœ¬åœ°å˜é‡è¡¨ã€åæ±‡ç¼–ç­‰è¯¦ç»†ä¿¡æ¯)</td></tr></tbody></table><p><strong>ä»£ç ä¸¾ä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavapTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>    <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>    <span class="token keyword">protected</span>  <span class="token keyword">char</span> gender<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> info<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">COUNTS</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"www.saddyfire.cn"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#123;</span>        info <span class="token operator">=</span> <span class="token string">"java"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">JavapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">JavapTest</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> flag<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">methodPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">char</span> <span class="token function">showGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> gender<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-class1/image-20240105232801444.png" alt="javapè¯´æ˜-1"></p><p><img src="./../jvm-class1/image-20240105232949979.png" alt="javapè¯´æ˜-2"></p><p><img src="./../jvm-class1/image-20240105233645915.png" alt="javapè¯´æ˜-3"></p><p><strong>æ€»ç»“</strong></p><ol><li>é€šè¿‡javaptå‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªjavaç±»åæ±‡ç¼–å¾—åˆ°çš„Class.æ–‡ä»¶ç‰ˆæœ¬å·ã€å¸¸é‡æ± ã€è®¿é—®æ ‡è¯†ã€å˜é‡è¡¨ã€æŒ‡ä»¤ä»£ç è¡Œå·è¡¨ç­‰ç­‰ä¿¡æ¯ã€‚ä¸æ˜¾ç¤ºç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆã€<code>&lt;c1iTit&gt;()</code>ã€<code>&lt;init&gt;()</code> ç­‰ç»“æ„</li><li>é€šè¿‡å¯¹å‰é¢ä¾‹å­ä»£ç åæ±‡ç¼–æ–‡ä»¶çš„ç®€å•åˆ†æï¼Œå¯ä»¥å‘ç°ï¼Œä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œé€šå¸¸ä¼šæ¶‰åŠä¸‹é¢å‡ å—å†…å­˜çš„æ“ä½œï¼š<ol><li>javaæ ˆä¸­ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€‚</li><li>javaå †ã€‚é€šè¿‡å¯¹è±¡çš„åœ°å€å¼•ç”¨å»æ“ä½œã€‚</li><li>å¸¸é‡æ± ã€‚</li><li>å…¶ä»–å¦‚å¸§æ•°æ®åŒºã€æ–¹æ³•åŒºçš„å‰©ä½™éƒ¨åˆ†ç­‰æƒ…å†µï¼Œæµ‹è¯•ä¸­æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ã€‚</li></ol></li><li>å¹³å¸¸ï¼Œæˆ‘ä»¬æ¯”è¾ƒå…³æ³¨çš„æ˜¯ java ç±»ä¸­æ¯ä¸ªæ–¹æ³•çš„åæ±‡ç¼–ä¸­çš„æŒ‡ä»¤æ“ä½œè¿‡ç¨‹ï¼Œè¿™äº›æŒ‡ä»¤éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡<br>æ¡£æŸ¥çœ‹æ¯ä¸ªæŒ‡ä»¤çš„å«ä¹‰ï¼Œå¾ˆç®€å•ï¼š<br><a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-12-åƒåœ¾å›æ”¶å™¨</title>
      <link href="/2023/12/27/jvm-sgg12/"/>
      <url>/2023/12/27/jvm-sgg12/</url>
      
        <content type="html"><![CDATA[<h1>åƒåœ¾å›æ”¶å™¨</h1><h2 id="GC-åˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡">GC åˆ†ç±»ä¸æ€§èƒ½æŒ‡æ ‡</h2><ul><li><p>åƒåœ¾æ”¶é›†å™¨æ²¡æœ‰åœ¨è§„èŒƒä¸­è¿›è¡Œè¿‡å¤šçš„è§„å®šï¼Œå¯ä»¥ç”±ä¸åŒçš„å‚å•†ã€ä¸åŒç‰ˆæœ¬çš„JVMæ¥å®ç°ã€‚</p></li><li><p>ç”±äºJDKçš„ç‰ˆæœ¬å¤„äºé«˜é€Ÿè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå› æ­¤Javaå‘å±•è‡³ä»Šå·²ç»è¡ç”Ÿäº†ä¼—å¤šçš„GCç‰ˆæœ¬ã€‚</p></li><li><p>ä»ä¸åŒè§’åº¦åˆ†æåƒåœ¾æ”¶é›†å™¨ï¼Œå¯ä»¥å°†GCåˆ†ä¸ºä¸åŒçš„ç±»å‹ã€‚</p></li></ul><p><strong>Javaä¸åŒç‰ˆæœ¬æ–°ç‰¹æ€§</strong></p><ul><li>è¯­æ³•å±‚é¢ï¼šLambdaè¡¨è¾¾å¼ã€switchã€è‡ªåŠ¨æ‹†ç®±è£…ç®±ã€enumã€æ³›å‹</li><li>APIå±‚é¢ï¼šStream APIã€æ–°çš„æ—¥æœŸæ—¶é—´ã€Optionalã€Stringã€é›†åˆæ¡†æ¶</li><li>åº•å±‚ä¼˜åŒ–ï¼šJVMä¼˜åŒ–ã€GCçš„å˜åŒ–ã€å…ƒç©ºé—´ã€é™æ€åŸŸã€å­—ç¬¦ä¸²å¸¸é‡æ± ç­‰</li></ul><h3 id="åƒåœ¾å›æ”¶å™¨åˆ†ç±»">åƒåœ¾å›æ”¶å™¨åˆ†ç±»</h3><p><strong>æŒ‰çº¿ç¨‹æ•°åˆ†ï¼ˆåƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼‰ï¼Œå¯ä»¥åˆ†ä¸ºä¸²è¡Œåƒåœ¾å›æ”¶å™¨å’Œå¹¶è¡Œåƒåœ¾å›æ”¶å™¨ã€‚</strong></p><p><img src="./../jvm-sgg12/image-20231228202447472.png" alt=""></p><ul><li><p>ä¸²è¡Œå›æ”¶æŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶é—´æ®µå†…åªå…è®¸æœ‰ä¸€ä¸ªCPUç”¨äºæ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼Œæ­¤æ—¶å·¥ä½œçº¿ç¨‹è¢«æš‚åœï¼Œç›´è‡³åƒåœ¾æ”¶é›†å·¥ä½œç»“æŸã€‚</p><ul><li><p>åœ¨è¯¸å¦‚å•CPUå¤„ç†å™¨æˆ–è€…è¾ƒå°çš„åº”ç”¨å†…å­˜ç­‰ç¡¬ä»¶å¹³å°ä¸æ˜¯ç‰¹åˆ«ä¼˜è¶Šçš„åœºåˆï¼Œä¸²è¡Œå›æ”¶å™¨çš„æ€§èƒ½è¡¨ç°å¯ä»¥è¶…è¿‡å¹¶è¡Œå›æ”¶å™¨å’Œå¹¶å‘å›æ”¶å™¨ã€‚æ‰€ä»¥ï¼Œ<strong>ä¸²è¡Œå›æ”¶é»˜è®¤è¢«åº”ç”¨åœ¨å®¢æˆ·ç«¯çš„Clientæ¨¡å¼ä¸‹çš„JVMä¸­</strong></p></li><li><p>åœ¨å¹¶å‘èƒ½åŠ›æ¯”è¾ƒå¼ºçš„CPUä¸Šï¼Œå¹¶è¡Œå›æ”¶å™¨äº§ç”Ÿçš„åœé¡¿æ—¶é—´è¦çŸ­äºä¸²è¡Œå›æ”¶å™¨</p></li></ul></li><li><p>å’Œä¸²è¡Œå›æ”¶ç›¸åï¼Œå¹¶è¡Œæ”¶é›†å¯ä»¥è¿ç”¨å¤šä¸ªCPUåŒæ—¶æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œå› æ­¤æå‡äº†åº”ç”¨çš„ååé‡ï¼Œä¸è¿‡å¹¶è¡Œå›æ”¶ä»ç„¶ä¸ä¸²è¡Œå›æ”¶ä¸€æ ·ï¼Œé‡‡ç”¨ç‹¬å å¼ï¼Œä½¿ç”¨äº†&quot;Stop-the-Worl&quot;æœºåˆ¶ã€‚</p></li></ul><p><strong>æŒ‰ç…§<em>å·¥ä½œæ¨¡å¼</em>åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºå¹¶å‘å¼åƒåœ¾å›æ”¶å™¨å’Œç‹¬å å¼åƒåœ¾å›æ”¶å™¨</strong></p><ul><li>å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œä»¥å°½å¯èƒ½å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´ã€‚</li><li>ç‹¬å å¼åƒåœ¾å›æ”¶å™¨ï¼ˆStop the Worldï¼‰ä¸€æ—¦è¿è¡Œï¼Œå°±åœæ­¢åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾å›æ”¶è¿‡ç¨‹å®Œå…¨ç»“æŸã€‚</li></ul><p><img src="./../jvm-sgg12/image-20231228202849855.png" alt=""></p><p><strong>æŒ‰<em>ç¢ç‰‡å¤„ç†æ–¹å¼</em>åˆ†ï¼Œå¯åˆ†ä¸ºå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨å’Œéå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ã€‚</strong></p><ul><li>å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶å®Œæˆåï¼Œå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œæ¶ˆé™¤å›æ”¶åçš„ç¢ç‰‡ã€‚<ul><li>å†åˆ†é…å¯¹è±¡ç©ºé—´ä½¿ç”¨: æŒ‡é’ˆç¢°æ’</li></ul></li><li>éå‹ç¼©å¼çš„åƒåœ¾å›æ”¶å™¨ä¸è¿›è¡Œè¿™æ­¥æ“ä½œï¼Œ<ul><li>åˆ†é…å¯¹è±¡ç©ºé—´ä½¿ç”¨: ç©ºé—²åˆ—è¡¨</li></ul></li></ul><p><strong>æŒ‰<em>å·¥ä½œçš„å†…å­˜åŒºé—´</em>åˆ†ï¼Œåˆå¯åˆ†ä¸ºå¹´è½»ä»£åƒåœ¾å›æ”¶å™¨å’Œè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚</strong></p><h3 id="è¯„ä¼°-GC-çš„æ€§èƒ½æŒ‡æ ‡">è¯„ä¼° GC çš„æ€§èƒ½æŒ‡æ ‡</h3><ul><li><p><strong>ååé‡ï¼šè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹</strong></p><ul><li>ï¼ˆæ€»è¿è¡Œæ—¶é—´ = ç¨‹åºçš„è¿è¡Œæ—¶é—´ + å†…å­˜å›æ”¶çš„æ—¶é—´ï¼‰a/(a+b)</li></ul></li><li><p>åƒåœ¾æ”¶é›†å¼€é”€ï¼šååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€‚b/(a+b)</p></li><li><p><strong>æš‚åœæ—¶é—´ï¼šæ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´ã€‚</strong></p></li><li><p>æ”¶é›†é¢‘ç‡ï¼šç›¸å¯¹äºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼Œæ”¶é›†æ“ä½œå‘ç”Ÿçš„é¢‘ç‡ã€‚</p></li><li><p><strong>å†…å­˜å ç”¨ï¼šJavaå †åŒºæ‰€å çš„å†…å­˜å¤§å°ã€‚</strong></p></li><li><p>å¿«é€Ÿï¼šä¸€ä¸ªå¯¹è±¡ä»è¯ç”Ÿåˆ°è¢«å›æ”¶æ‰€ç»å†çš„æ—¶é—´ã€‚</p></li><li><p>&lt;ååé‡ã€æš‚åœæ—¶é—´ã€å†…å­˜å ç”¨&gt;è¿™ä¸‰è€…å…±åŒæ„æˆä¸€ä¸ªâ€œä¸å¯èƒ½ä¸‰è§’â€ã€‚ä¸‰è€…æ€»ä½“çš„è¡¨ç°ä¼šéšç€æŠ€æœ¯è¿›æ­¥è€Œè¶Šæ¥è¶Šå¥½ã€‚ä¸€æ¬¾ä¼˜ç§€çš„æ”¶é›†å™¨é€šå¸¸æœ€å¤šåŒæ—¶æ»¡è¶³å…¶ä¸­çš„ä¸¤é¡¹ã€‚</p></li><li><p>è¿™ä¸‰é¡¹é‡Œï¼Œæš‚åœæ—¶é—´çš„é‡è¦æ€§æ—¥ç›Šå‡¸æ˜¾ã€‚å› ä¸ºéšç€ç¡¬ä»¶å‘å±•ï¼Œå†…å­˜å ç”¨å¤šäº›è¶Šæ¥è¶Šèƒ½å®¹å¿ï¼Œç¡¬ä»¶æ€§èƒ½çš„æå‡ä¹Ÿæœ‰åŠ©äºé™ä½æ”¶é›†å™¨è¿è¡Œæ—¶å¯¹åº”ç”¨ç¨‹åºçš„å½±å“ï¼Œå³æé«˜äº†ååé‡ã€‚è€Œå†…å­˜çš„æ‰©å¤§ï¼Œå¯¹å»¶è¿Ÿåè€Œå¸¦æ¥è´Ÿé¢æ•ˆæœã€‚</p></li><li><p>ç®€å•æ¥è¯´ï¼Œä¸»è¦æŠ“ä½ä¸¤ç‚¹ï¼š</p><ul><li>ååé‡</li><li>æš‚åœæ—¶é—´</li></ul></li></ul><h3 id="ååé‡-throughput">ååé‡(throughput)</h3><ul><li>ååé‡å°±æ˜¯CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰<ul><li>æ¯”å¦‚ï¼šè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚</li></ul></li><li>è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºèƒ½å®¹å¿è¾ƒé«˜çš„æš‚åœæ—¶é—´ï¼Œå› æ­¤ï¼Œé«˜ååé‡çš„åº”ç”¨ç¨‹åºæœ‰æ›´é•¿çš„æ—¶é—´åŸºå‡†ï¼Œå¿«é€Ÿå“åº”æ˜¯ä¸å¿…è€ƒè™‘çš„</li><li>ååé‡ä¼˜å…ˆï¼Œæ„å‘³ç€åœ¨å•ä½æ—¶é—´å†…ï¼ŒSTWçš„æ—¶é—´æœ€çŸ­ï¼š0.2+0.2=0.4</li></ul><p><img src="./../jvm-sgg12/image-20231228204813437.png" alt=""></p><h3 id="æš‚åœæ—¶é—´ï¼ˆpause-timeï¼‰">æš‚åœæ—¶é—´ï¼ˆpause timeï¼‰</h3><ul><li>â€œæš‚åœæ—¶é—´â€æ˜¯æŒ‡ä¸€ä¸ªæ—¶é—´æ®µå†…åº”ç”¨ç¨‹åºçº¿ç¨‹æš‚åœï¼Œè®©GCçº¿ç¨‹æ‰§è¡Œçš„çŠ¶æ€ã€‚<ul><li>ä¾‹å¦‚ï¼ŒGCæœŸé—´100æ¯«ç§’çš„æš‚åœæ—¶é—´æ„å‘³ç€åœ¨è¿™100æ¯«ç§’æœŸé—´å†…æ²¡æœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹æ˜¯æ´»åŠ¨çš„</li></ul></li><li>æš‚åœæ—¶é—´ä¼˜å…ˆï¼Œæ„å‘³ç€å°½å¯èƒ½è®©å•æ¬¡STWçš„æ—¶é—´æœ€çŸ­ï¼š0.1+0.1 + 0.1+ 0.1+ 0.1=0.5ï¼Œä½†æ˜¯æ€»çš„GCæ—¶é—´å¯èƒ½ä¼šé•¿</li></ul><p><img src="./../jvm-sgg12/image-20231228204946960.png" alt=""></p><h3 id="ååé‡-vs-æš‚åœæ—¶é—´">ååé‡ vs æš‚åœæ—¶é—´</h3><ul><li><p><strong>é«˜ååé‡è¾ƒå¥½</strong>å› ä¸ºè¿™ä¼šè®©åº”ç”¨ç¨‹åºçš„æœ€ç»ˆç”¨æˆ·æ„Ÿè§‰åªæœ‰åº”ç”¨ç¨‹åºçº¿ç¨‹åœ¨åšâ€œç”Ÿäº§æ€§â€å·¥ä½œã€‚ç›´è§‰ä¸Šï¼Œååé‡è¶Šé«˜ç¨‹åºè¿è¡Œè¶Šå¿«ã€‚</p></li><li><p>ä½æš‚åœæ—¶é—´ï¼ˆä½å»¶è¿Ÿï¼‰è¾ƒå¥½ï¼Œæ˜¯ä»æœ€ç»ˆç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œä¸ç®¡æ˜¯GCè¿˜æ˜¯å…¶ä»–åŸå› å¯¼è‡´ä¸€ä¸ªåº”ç”¨è¢«æŒ‚èµ·å§‹ç»ˆæ˜¯ä¸å¥½çš„ã€‚è¿™å–å†³äºåº”ç”¨ç¨‹åºçš„ç±»å‹ï¼Œæœ‰æ—¶å€™ç”šè‡³çŸ­æš‚çš„200æ¯«ç§’æš‚åœéƒ½å¯èƒ½æ‰“æ–­ç»ˆç«¯ç”¨æˆ·ä½“éªŒã€‚å› æ­¤ï¼Œå…·æœ‰è¾ƒä½çš„æš‚åœæ—¶é—´æ˜¯éå¸¸é‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªäº¤äº’å¼åº”ç”¨ç¨‹åºï¼ˆå°±æ˜¯å’Œç”¨æˆ·äº¤äº’æ¯”è¾ƒå¤šçš„åœºæ™¯ï¼‰ã€‚</p></li><li><p>ä¸å¹¸çš„æ˜¯â€é«˜ååé‡â€å’Œâ€ä½æš‚åœæ—¶é—´â€æ˜¯ä¸€å¯¹ç›¸äº’ç«äº‰çš„ç›®æ ‡ï¼ˆçŸ›ç›¾ï¼‰ã€‚</p><ul><li>å› ä¸ºå¦‚æœé€‰æ‹©ä»¥ååé‡ä¼˜å…ˆï¼Œé‚£ä¹ˆ<strong>å¿…ç„¶éœ€è¦é™ä½å†…å­˜å›æ”¶çš„æ‰§è¡Œé¢‘ç‡</strong>ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´GCéœ€è¦æ›´é•¿çš„æš‚åœæ—¶é—´æ¥æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</li><li>ç›¸åçš„ï¼Œå¦‚æœé€‰æ‹©ä»¥ä½å»¶è¿Ÿä¼˜å…ˆä¸ºåŸåˆ™ï¼Œé‚£ä¹ˆä¸ºäº†é™ä½æ¯æ¬¡æ‰§è¡Œå†…å­˜å›æ”¶æ—¶çš„æš‚åœæ—¶é—´ï¼Œä¹Ÿåªèƒ½é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜å›æ”¶ï¼Œä½†è¿™åˆå¼•èµ·äº†å¹´è½»ä»£å†…å­˜çš„ç¼©å‡å’Œå¯¼è‡´ç¨‹åºååé‡çš„ä¸‹é™ã€‚</li></ul></li><li><p>åœ¨è®¾è®¡ï¼ˆæˆ–ä½¿ç”¨ï¼‰GCç®—æ³•æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®å®šæˆ‘ä»¬çš„ç›®æ ‡ï¼šä¸€ä¸ªGCç®—æ³•åªå¯èƒ½é’ˆå¯¹ä¸¤ä¸ªç›®æ ‡ä¹‹ä¸€ï¼ˆå³åªä¸“æ³¨äºè¾ƒå¤§ååé‡æˆ–æœ€å°æš‚åœæ—¶é—´ï¼‰ï¼Œæˆ–å°è¯•æ‰¾åˆ°ä¸€ä¸ªäºŒè€…çš„æŠ˜è¡·ã€‚</p></li><li><p>ç°åœ¨æ ‡å‡†ï¼š<strong>åœ¨æœ€å¤§ååé‡ä¼˜å…ˆçš„æƒ…å†µä¸‹ï¼Œé™ä½åœé¡¿æ—¶é—´</strong></p></li></ul><h2 id="ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°">ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</h2><ul><li>åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯Javaçš„æ‹›ç‰Œèƒ½åŠ›ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚è¿™å½“ç„¶ä¹Ÿæ˜¯é¢è¯•çš„çƒ­ç‚¹ã€‚</li><li>é‚£ä¹ˆï¼ŒJavaå¸¸è§çš„åƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Ÿ(é¢è¯•)</li></ul><h3 id="åƒåœ¾æ”¶é›†å™¨å‘å±•å²">åƒåœ¾æ”¶é›†å™¨å‘å±•å²</h3><p>æœ‰äº†è™šæ‹Ÿæœºï¼Œå°±ä¸€å®šéœ€è¦æ”¶é›†åƒåœ¾çš„æœºåˆ¶ï¼Œè¿™å°±æ˜¯Garbage Collectionï¼Œå¯¹åº”çš„äº§å“æˆ‘ä»¬ç§°ä¸ºGarbage Collectorã€‚</p><ul><li>1999å¹´éšJDK1.3.1ä¸€èµ·æ¥çš„æ˜¯ä¸²è¡Œæ–¹å¼çš„Serial GCï¼Œå®ƒæ˜¯ç¬¬ä¸€æ¬¾GCã€‚ParNewåƒåœ¾æ”¶é›†å™¨æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</li><li>2002å¹´2æœˆ26æ—¥ï¼ŒParallel GCå’ŒConcurrent Mark Sweep GCè·ŸéšJDK1.4.2ä¸€èµ·å‘å¸ƒÂ·</li><li>Parallel GCåœ¨JDK6ä¹‹åæˆä¸ºHotSpoté»˜è®¤GCã€‚</li><li>2012å¹´ï¼Œåœ¨JDK1.7u4ç‰ˆæœ¬ä¸­ï¼ŒG1å¯ç”¨ã€‚</li><li>2017å¹´ï¼ŒJDK9ä¸­G1å˜æˆé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä»¥æ›¿ä»£CMSã€‚</li><li>2018å¹´3æœˆï¼ŒJDK10ä¸­G1åƒåœ¾å›æ”¶å™¨çš„å¹¶è¡Œå®Œæ•´åƒåœ¾å›æ”¶ï¼Œå®ç°å¹¶è¡Œæ€§æ¥æ”¹å–„æœ€åæƒ…å†µä¸‹çš„å»¶è¿Ÿã€‚</li><li>2018å¹´9æœˆï¼ŒJDK11å‘å¸ƒã€‚å¼•å…¥Epsilon åƒåœ¾å›æ”¶å™¨ï¼Œåˆè¢«ç§°ä¸º &quot;No-Op(æ— æ“ä½œ)â€œ å›æ”¶å™¨ã€‚åŒæ—¶ï¼Œå¼•å…¥ZGCï¼šå¯ä¼¸ç¼©çš„ä½å»¶è¿Ÿåƒåœ¾å›æ”¶å™¨ï¼ˆExperimentalï¼‰</li><li>2019å¹´3æœˆï¼ŒJDK12å‘å¸ƒã€‚å¢å¼ºG1ï¼Œè‡ªåŠ¨è¿”å›æœªç”¨å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚åŒæ—¶ï¼Œå¼•å…¥Shenandoah GCï¼šä½åœé¡¿æ—¶é—´çš„GCï¼ˆExperimentalï¼‰ã€‚</li><li>2019å¹´9æœˆï¼ŒJDK13å‘å¸ƒã€‚å¢å¼ºZGCï¼Œè‡ªåŠ¨è¿”å›æœªç”¨å †å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚</li><li>2020å¹´3æœˆï¼ŒJDK14å‘å¸ƒã€‚åˆ é™¤CMSåƒåœ¾å›æ”¶å™¨ã€‚æ‰©å±•ZGCåœ¨macOSå’ŒWindowsä¸Šçš„åº”ç”¨</li></ul><h3 id="7æ¬¾ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨">7æ¬¾ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨</h3><ul><li>ä¸²è¡Œå›æ”¶å™¨ï¼šSerialã€Serial old</li><li>å¹¶è¡Œå›æ”¶å™¨ï¼šParNewã€Parallel Scavengeã€Parallel old</li><li>å¹¶å‘å›æ”¶å™¨ï¼šCMSã€G1</li></ul><p><img src="./../jvm-sgg12/image-20231228210058640.png" alt=""></p><p><img src="./../jvm-sgg12/image-20231228210155372.png" alt="7æ¬¾ç»å…¸å›æ”¶å™¨ä¸åƒåœ¾åˆ†ä»£ä¹‹é—´çš„å…³ç³»ğŸ‘"></p><ul><li><p>æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼šSerialã€ParNewã€Parallel Scavengeï¼›</p></li><li><p>è€å¹´ä»£æ”¶é›†å™¨ï¼šSerial oldã€Parallel oldã€CMSï¼›</p></li><li><p>æ•´å †æ”¶é›†å™¨ï¼šG1ï¼›</p></li></ul><p><img src="./../jvm-sgg12/image-20231228210348873.png" alt="åƒåœ¾å›æ”¶å™¨çš„ç»„åˆå…³ç³»ğŸ‘"></p><ol><li>ä¸¤ä¸ªæ”¶é›†å™¨é—´æœ‰è¿çº¿ï¼Œè¡¨æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ï¼š<ul><li>Serial/Serial old</li><li>Serial/CMS    ï¼ˆJDK9åºŸå¼ƒï¼‰</li><li>ParNew/Serial Old ï¼ˆJDK9åºŸå¼ƒï¼‰</li><li>ParNew/CMS</li><li>Parallel Scavenge/Serial Old  ï¼ˆé¢„è®¡åºŸå¼ƒï¼‰</li><li>Parallel Scavenge/Parallel Old</li><li>G1</li></ul></li><li>å…¶ä¸­Serial Oldä½œä¸ºCMSå‡ºç°&quot;Concurrent Mode Failure&quot;å¤±è´¥çš„åå¤‡é¢„æ¡ˆã€‚</li><li>ï¼ˆçº¢è‰²è™šçº¿ï¼‰ç”±äºç»´æŠ¤å’Œå…¼å®¹æ€§æµ‹è¯•çš„æˆæœ¬ï¼Œåœ¨JDK 8æ—¶å°†Serial+CMSã€ParNew+Serial Oldè¿™ä¸¤ä¸ªç»„åˆå£°æ˜ä¸ºåºŸå¼ƒï¼ˆJEP173ï¼‰ï¼Œå¹¶åœ¨JDK9ä¸­å®Œå…¨å–æ¶ˆäº†è¿™äº›ç»„åˆçš„æ”¯æŒï¼ˆJEP214ï¼‰ï¼Œå³ï¼šç§»é™¤ã€‚</li><li>ï¼ˆç»¿è‰²è™šçº¿ï¼‰JDK14ä¸­ï¼šå¼ƒç”¨Parallel Scavengeå’ŒSerial Old GCç»„åˆï¼ˆJEP366ï¼‰</li><li>ï¼ˆé’è‰²è™šçº¿ï¼‰JDK14ä¸­ï¼šåˆ é™¤CMSåƒåœ¾å›æ”¶å™¨ï¼ˆJEP363ï¼‰</li></ol><ul><li>ä¸ºä»€ä¹ˆè¦æœ‰å¾ˆå¤šæ”¶é›†å™¨ï¼Œä¸€ä¸ªä¸å¤Ÿå—ï¼Ÿå› ä¸ºJavaçš„ä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œç§»åŠ¨ç«¯ï¼ŒæœåŠ¡å™¨ç­‰ã€‚æ‰€ä»¥å°±éœ€è¦é’ˆå¯¹ä¸åŒçš„åœºæ™¯ï¼Œæä¾›ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ï¼Œæé«˜åƒåœ¾æ”¶é›†çš„æ€§èƒ½ã€‚</li><li>è™½ç„¶æˆ‘ä»¬ä¼šå¯¹å„ä¸ªæ”¶é›†å™¨è¿›è¡Œæ¯”è¾ƒï¼Œä½†å¹¶éä¸ºäº†æŒ‘é€‰ä¸€ä¸ªæœ€å¥½çš„æ”¶é›†å™¨å‡ºæ¥ã€‚æ²¡æœ‰ä¸€ç§æ”¾ä¹‹å››æµ·çš†å‡†ã€ä»»ä½•åœºæ™¯ä¸‹éƒ½é€‚ç”¨çš„å®Œç¾æ”¶é›†å™¨å­˜åœ¨ï¼Œæ›´åŠ æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†å™¨ã€‚æ‰€ä»¥<strong>æˆ‘ä»¬é€‰æ‹©çš„åªæ˜¯å¯¹å…·ä½“åº”ç”¨æœ€åˆé€‚çš„æ”¶é›†å™¨</strong>ã€‚</li></ul><h3 id="æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨">æŸ¥çœ‹é»˜è®¤åƒåœ¾æ”¶é›†å™¨</h3><ul><li><p><code>-XX:+PrintCommandLineFlags</code>ï¼šæŸ¥çœ‹å‘½ä»¤è¡Œç›¸å…³å‚æ•°ï¼ˆåŒ…å«ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼‰</p></li><li><p>ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼š<code>jinfo -flag</code> ç›¸å…³åƒåœ¾å›æ”¶å™¨å‚æ•° è¿›ç¨‹ID</p></li></ul><p><strong>JDK8</strong></p><p><code>-XX:+PrintCommandLineFlags</code></p><p><img src="./../jvm-sgg12/image-20231229150948063.png" alt=""></p><p><strong>å‘½ä»¤è¡ŒæŸ¥çœ‹</strong></p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">jpsjinfo -flag UseParallelGC è¿›ç¨‹idjinfo -flag UseParallelOldGC è¿›ç¨‹id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg12/image-20231229151217018.png" alt=""></p><h2 id="Serial-å›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶">Serial å›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶</h2><ul><li><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚JDK1.3ä¹‹å‰å›æ”¶æ–°ç”Ÿä»£å”¯ä¸€çš„é€‰æ‹©ã€‚</p></li><li><p>Serialæ”¶é›†å™¨ä½œä¸ºHotSpotä¸­Clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ã€‚</p></li><li><p><strong>Serialæ”¶é›†å™¨é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€ä¸²è¡Œå›æ”¶å’Œ&quot;Stop-the-World&quot;æœºåˆ¶çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</strong></p></li><li><p>é™¤äº†å¹´è½»ä»£ä¹‹å¤–ï¼ŒSerialæ”¶é›†å™¨è¿˜æä¾›ç”¨äºæ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„Serial Oldæ”¶é›†å™¨ã€‚<strong>Serial Oldæ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†ä¸²è¡Œå›æ”¶å’Œ&quot;Stop the World&quot;æœºåˆ¶ï¼Œåªä¸è¿‡å†…å­˜å›æ”¶ç®—æ³•ä½¿ç”¨çš„æ˜¯æ ‡è®°-å‹ç¼©ç®—æ³•ã€‚</strong></p><ul><li>Serial Oldæ˜¯è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹é»˜è®¤çš„è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨</li><li>Serial Oldåœ¨Serveræ¨¡å¼ä¸‹ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼šâ‘ ä¸æ–°ç”Ÿä»£çš„Parallel Scavengeé…åˆä½¿ç”¨ â‘¡ä½œä¸ºè€å¹´ä»£CMSæ”¶é›†å™¨çš„åå¤‡åƒåœ¾æ”¶é›†æ–¹æ¡ˆ</li></ul></li></ul><p><img src="./../jvm-sgg12/image-20231229151604228.png" alt=""></p><p>è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œ&quot;å•çº¿ç¨‹&quot;çš„æ„ä¹‰ï¼šå®ƒ<strong>åªä¼šä½¿ç”¨ä¸€ä¸ªCPUï¼ˆä¸²è¡Œï¼‰æˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œ</strong>ã€‚æ›´é‡è¦çš„æ˜¯åœ¨å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œ<strong>å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹</strong>ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸï¼ˆStop The Worldï¼‰</p><p><strong>Serial å›æ”¶å™¨çš„ä¼˜åŠ¿</strong></p><ul><li>ä¼˜åŠ¿ï¼š<strong>ç®€å•è€Œé«˜æ•ˆ</strong>ï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚<ul><li>è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li></ul></li><li>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯ç”¨å†…å­˜ä¸€èˆ¬ä¸å¤§ï¼ˆå‡ åMBè‡³ä¸€ä¸¤ç™¾MBï¼‰ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼ˆå‡ åmsè‡³ä¸€ç™¾å¤šmsï¼‰ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚</li><li>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œä½¿ç”¨<code>-XX:+UseSerialGC</code>å‚æ•°å¯ä»¥æŒ‡å®šå¹´è½»ä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ã€‚<ul><li>ç­‰ä»·äºæ–°ç”Ÿä»£ç”¨Serial GCï¼Œä¸”è€å¹´ä»£ç”¨Serial Old GC</li></ul></li></ul><p><strong>æ€»ç»“</strong></p><ul><li>è¿™ç§åƒåœ¾æ”¶é›†å™¨å¤§å®¶äº†è§£ï¼Œç°åœ¨å·²ç»ä¸ç”¨ä¸²è¡Œçš„äº†ã€‚è€Œä¸”åœ¨é™å®šå•æ ¸CPUæ‰å¯ä»¥ç”¨ã€‚ç°åœ¨éƒ½ä¸æ˜¯å•æ ¸çš„äº†ã€‚</li><li>å¯¹äºäº¤äº’è¾ƒå¼ºçš„åº”ç”¨è€Œè¨€ï¼Œè¿™ç§åƒåœ¾æ”¶é›†å™¨æ˜¯ä¸èƒ½æ¥å—çš„ã€‚ä¸€èˆ¬åœ¨Java Webåº”ç”¨ç¨‹åºä¸­æ˜¯ä¸ä¼šé‡‡ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨çš„ã€‚</li></ul><h2 id="ParNew-å›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶">ParNew å›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶</h2><ul><li>å¦‚æœè¯´Serial GCæ˜¯å¹´è½»ä»£ä¸­çš„å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ï¼Œé‚£ä¹ˆParNewæ”¶é›†å™¨åˆ™æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚<ul><li>Paræ˜¯Parallelçš„ç¼©å†™ï¼ŒNewï¼šåªèƒ½å¤„ç†æ–°ç”Ÿä»£</li></ul></li><li>ParNew æ”¶é›†å™¨é™¤äº†é‡‡ç”¨<strong>å¹¶è¡Œå›æ”¶</strong>çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶å¤–ï¼Œä¸¤æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹‹é—´å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ParNewæ”¶é›†å™¨åœ¨å¹´è½»ä»£ä¸­åŒæ ·ä¹Ÿæ˜¯**é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€â€œStop-the-Worldâ€**æœºåˆ¶ã€‚</li><li>ParNew æ˜¯å¾ˆå¤šJVMè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹æ–°ç”Ÿä»£çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚</li></ul><p><img src="./../jvm-sgg12/image-20231229152324645.png" alt=""></p><ul><li>å¯¹äºæ–°ç”Ÿä»£ï¼Œå›æ”¶æ¬¡æ•°é¢‘ç¹ï¼Œä½¿ç”¨å¹¶è¡Œæ–¹å¼é«˜æ•ˆã€‚</li><li>å¯¹äºè€å¹´ä»£ï¼Œå›æ”¶æ¬¡æ•°å°‘ï¼Œä½¿ç”¨ä¸²è¡Œæ–¹å¼èŠ‚çœèµ„æºã€‚ï¼ˆCPUå¹¶è¡Œéœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œä¸²è¡Œå¯ä»¥çœå»åˆ‡æ¢çº¿ç¨‹çš„èµ„æºï¼‰</li></ul><p><strong>ParNew å›æ”¶å™¨ä¸ Serial å›æ”¶å™¨æ¯”è¾ƒ</strong></p><blockquote><p>Qï¼šç”±äºParNewæ”¶é›†å™¨åŸºäºå¹¶è¡Œå›æ”¶ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥æ–­å®šParNewæ”¶é›†å™¨çš„å›æ”¶æ•ˆç‡åœ¨ä»»ä½•åœºæ™¯ä¸‹éƒ½ä¼šæ¯”Serialæ”¶é›†å™¨æ›´é«˜æ•ˆï¼Ÿ</p><p>Aï¼š<strong>ä¸èƒ½</strong></p></blockquote><ul><li>ParNewæ”¶é›†å™¨è¿è¡Œåœ¨å¤šCPUçš„ç¯å¢ƒä¸‹ï¼Œç”±äºå¯ä»¥å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸å¿ƒç­‰ç‰©ç†ç¡¬ä»¶èµ„æºä¼˜åŠ¿ï¼Œå¯ä»¥æ›´å¿«é€Ÿåœ°å®Œæˆåƒåœ¾æ”¶é›†ï¼Œæå‡ç¨‹åºçš„ååé‡ã€‚</li><li>ä½†æ˜¯<strong>åœ¨å•ä¸ªCPUçš„ç¯å¢ƒä¸‹ï¼ŒParNewæ”¶é›†å™¨ä¸æ¯”Serialæ”¶é›†å™¨æ›´é«˜æ•ˆ</strong>ã€‚è™½ç„¶Serialæ”¶é›†å™¨æ˜¯åŸºäºä¸²è¡Œå›æ”¶ï¼Œä½†æ˜¯ç”±äºCPUä¸éœ€è¦é¢‘ç¹åœ°åšä»»åŠ¡åˆ‡æ¢ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆé¿å…å¤šçº¿ç¨‹äº¤äº’è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€äº›é¢å¤–å¼€é”€ã€‚</li><li>é™¤Serialå¤–ï¼Œç›®å‰åªæœ‰ParNew GCèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œ</li></ul><p><strong>è®¾ç½® ParNew åƒåœ¾å›æ”¶å™¨</strong></p><ul><li>åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹<code>-XX:+UseParNewGC</code>æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ParNewæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚å®ƒè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œä¸å½±å“è€å¹´ä»£ã€‚</li><li><code>-XX:ParallelGCThreads</code>é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤å¼€å¯å’ŒCPUæ•°æ®ç›¸åŒçš„çº¿ç¨‹æ•°ã€‚</li></ul><h2 id="Parallel-å›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ">Parallel å›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ</h2><ul><li><p>HotSpotçš„å¹´è½»ä»£ä¸­é™¤äº†æ‹¥æœ‰ParNewæ”¶é›†å™¨æ˜¯åŸºäºå¹¶è¡Œå›æ”¶çš„ä»¥å¤–ï¼ŒParallel Scavengeæ”¶é›†å™¨åŒæ ·ä¹Ÿé‡‡ç”¨äº†å¤åˆ¶ç®—æ³•ã€å¹¶è¡Œå›æ”¶å’Œ&quot;Stop the World&quot;æœºåˆ¶ã€‚</p></li><li><p>é‚£ä¹ˆParallelæ”¶é›†å™¨çš„å‡ºç°æ˜¯å¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p><ul><li>å’ŒParNewæ”¶é›†å™¨ä¸åŒï¼ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ª<strong>å¯æ§åˆ¶çš„ååé‡</strong>ï¼ˆThroughputï¼‰ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºååé‡ä¼˜å…ˆçš„åƒåœ¾æ”¶é›†å™¨ã€‚</li><li>è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯Parallel Scavengeä¸ParNewä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚ï¼ˆåŠ¨æ€è°ƒæ•´å†…å­˜åˆ†é…æƒ…å†µï¼Œä»¥è¾¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„ååé‡æˆ–ä½å»¶è¿Ÿï¼‰</li></ul></li><li><p>é«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œ<strong>ä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</strong>ã€‚å› æ­¤ï¼Œå¸¸è§åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚<strong>ä¾‹å¦‚ï¼Œé‚£äº›æ‰§è¡Œæ‰¹é‡å¤„ç†ã€è®¢å•å¤„ç†ã€å·¥èµ„æ”¯ä»˜ã€ç§‘å­¦è®¡ç®—çš„åº”ç”¨ç¨‹åºã€‚</strong></p></li><li><p>Parallelæ”¶é›†å™¨åœ¨JDK1.6æ—¶æä¾›äº†ç”¨äºæ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†çš„Parallel Oldæ”¶é›†å™¨ï¼Œç”¨æ¥ä»£æ›¿è€å¹´ä»£çš„Serial Oldæ”¶é›†å™¨ã€‚</p></li><li><p>Parallel Oldæ”¶é›†å™¨é‡‡ç”¨äº†<strong>æ ‡è®°-å‹ç¼©ç®—æ³•</strong>ï¼Œä½†åŒæ ·ä¹Ÿæ˜¯åŸºäº<strong>å¹¶è¡Œå›æ”¶å’Œ&quot;Stop-the-World&quot;æœºåˆ¶ã€‚</strong></p></li></ul><p><img src="./../jvm-sgg12/image-20231229153901516.png" alt=""></p><ul><li>åœ¨ç¨‹åºååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯ä¸­ï¼ŒParallelæ”¶é›†å™¨å’ŒParallel Oldæ”¶é›†å™¨çš„ç»„åˆï¼Œåœ¨serveræ¨¡å¼ä¸‹çš„å†…å­˜å›æ”¶æ€§èƒ½å¾ˆä¸é”™ã€‚</li><li><strong>åœ¨Java8ä¸­ï¼Œé»˜è®¤æ˜¯æ­¤åƒåœ¾æ”¶é›†å™¨ã€‚</strong></li></ul><h4 id="Parallel-å‚æ•°è®¾ç½®">Parallel å‚æ•°è®¾ç½®</h4><ul><li><p><code>-XX:+UseParallelGC</code> æ‰‹åŠ¨æŒ‡å®šå¹´è½»ä»£ä½¿ç”¨Parallelå¹¶è¡Œæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚</p></li><li><p><code>-XX:+UseParallelOldGC</code>ï¼šæ‰‹åŠ¨æŒ‡å®šè€å¹´ä»£éƒ½æ˜¯ä½¿ç”¨å¹¶è¡Œå›æ”¶æ”¶é›†å™¨ã€‚</p><ul><li><p>åˆ†åˆ«é€‚ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£</p></li><li><p>ä¸Šé¢ä¸¤ä¸ªå‚æ•°åˆ†åˆ«é€‚ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚é»˜è®¤jdk8æ˜¯å¼€å¯çš„ã€‚é»˜è®¤å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè¢«å¼€å¯ã€‚ï¼ˆäº’ç›¸æ¿€æ´»ï¼‰</p></li></ul></li><li><p><code>-XX:ParallelGCThreads</code>ï¼šè®¾ç½®å¹´è½»ä»£å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚ä¸€èˆ¬åœ°ï¼Œæœ€å¥½ä¸CPUæ•°é‡ç›¸ç­‰ï¼Œä»¥é¿å…è¿‡å¤šçš„çº¿ç¨‹æ•°å½±å“åƒåœ¾æ”¶é›†æ€§èƒ½ã€‚</p><ul><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“CPUæ•°é‡å°äº8ä¸ªï¼ŒParallelGCThreadsçš„å€¼ç­‰äºCPUæ•°é‡ã€‚</p></li><li><p>å½“CPUæ•°é‡å¤§äº8ä¸ªï¼ŒParallelGCThreadsçš„å€¼ç­‰äº3+[5*CPU_Count]/8]</p></li></ul></li><li><p><code>-XX:MaxGCPauseMillis</code> è®¾ç½®åƒåœ¾æ”¶é›†å™¨æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆå³STWçš„æ—¶é—´ï¼‰ã€‚å•ä½æ˜¯æ¯«ç§’ã€‚</p><ul><li><p>ä¸ºäº†å°½å¯èƒ½åœ°æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨XX:MaxGCPauseMillis ä»¥å†…ï¼Œæ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ä¼šè°ƒæ•´Javaå †å¤§å°æˆ–è€…å…¶ä»–ä¸€äº›å‚æ•°ã€‚</p></li><li><p>å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­ä½“éªŒè¶Šå¥½ã€‚ä½†æ˜¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬æ³¨é‡é«˜å¹¶å‘ï¼Œæ•´ä½“çš„ååé‡ã€‚æ‰€ä»¥æœåŠ¡å™¨ç«¯é€‚åˆParallelï¼Œè¿›è¡Œæ§åˆ¶ã€‚</p></li><li><p><strong>è¯¥å‚æ•°ä½¿ç”¨éœ€è°¨æ…</strong>ã€‚</p></li></ul></li><li><p><code>-XX:GCTimeRatio</code>åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹ï¼Œå³ç­‰äº 1 / (N+1) ï¼Œç”¨äºè¡¡é‡ååé‡çš„å¤§å°ã€‚</p><ul><li><p>å–å€¼èŒƒå›´(0, 100)ã€‚é»˜è®¤å€¼99ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶æ—¶é—´å æ¯”ä¸è¶…è¿‡1ã€‚</p></li><li><p>ä¸å‰ä¸€ä¸ª-XX:MaxGCPauseMilliså‚æ•°æœ‰ä¸€å®šçŸ›ç›¾æ€§ï¼ŒSTWæš‚åœæ—¶é—´è¶Šé•¿ï¼ŒRadioå‚æ•°å°±å®¹æ˜“è¶…è¿‡è®¾å®šçš„æ¯”ä¾‹ã€‚</p></li></ul></li><li><p><code>-XX:+UseAdaptiveSizePolicy</code> è®¾ç½®Parallel Scavengeæ”¶é›†å™¨å…·æœ‰<strong>è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong></p><ul><li><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¹´è½»ä»£çš„å¤§å°ã€Edenå’ŒSurvivorçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°ä¼šè¢«è‡ªåŠ¨è°ƒæ•´ï¼Œå·²è¾¾åˆ°åœ¨å †å¤§å°ã€ååé‡å’Œåœé¡¿æ—¶é—´ä¹‹é—´çš„å¹³è¡¡ç‚¹ã€‚</p></li><li><p>åœ¨æ‰‹åŠ¨è°ƒä¼˜æ¯”è¾ƒå›°éš¾çš„åœºåˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§è‡ªé€‚åº”çš„æ–¹å¼ï¼Œä»…æŒ‡å®šè™šæ‹Ÿæœºçš„æœ€å¤§å †ã€ç›®æ ‡çš„ååé‡ï¼ˆGCTimeRatioï¼‰å’Œåœé¡¿æ—¶é—´ï¼ˆMaxGCPauseMillisï¼‰ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å®Œæˆè°ƒä¼˜å·¥ä½œã€‚</p></li></ul></li></ul><h2 id="CMS-å›æ”¶å™¨ï¼šä½å»¶è¿Ÿ">CMS å›æ”¶å™¨ï¼šä½å»¶è¿Ÿ</h2><ul><li><p>åœ¨JDK1.5æ—¶æœŸï¼ŒHotspotæ¨å‡ºäº†ä¸€æ¬¾åœ¨**å¼ºäº¤äº’åº”ç”¨ä¸­ï¼ˆå°±æ˜¯å’Œç”¨æˆ·æ‰“äº¤é“çš„å¼•ç”¨ï¼‰**å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSï¼ˆConcurrent-Mark-Sweepï¼‰æ”¶é›†å™¨ï¼Œ<strong>è¿™æ¬¾æ”¶é›†å™¨æ˜¯HotSpotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œã€‚</strong></p></li><li><p>CMSæ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ã€‚åœé¡¿æ—¶é—´è¶ŠçŸ­ï¼ˆä½å»¶è¿Ÿï¼‰å°±è¶Šé€‚åˆä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚</p><ul><li>ç›®å‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„Javaåº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€…B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šï¼Œè¿™ç±»åº”ç”¨å°¤å…¶é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œä»¥ç»™ç”¨æˆ·å¸¦æ¥è¾ƒå¥½çš„ä½“éªŒã€‚CMSæ”¶é›†å™¨å°±éå¸¸ç¬¦åˆè¿™ç±»åº”ç”¨çš„éœ€æ±‚ã€‚</li></ul></li><li><p>CMSçš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨<strong>æ ‡è®°-æ¸…é™¤</strong>ç®—æ³•ï¼Œå¹¶ä¸”ä¹Ÿä¼š&quot;Stop-the-World&quot;</p></li><li><p>ä¸å¹¸çš„æ˜¯ï¼ŒCMSä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œå´æ— æ³•ä¸JDK1.4.0ä¸­å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨Parallel Scavengeé…åˆå·¥ä½œï¼ˆå› ä¸ºå®ç°çš„æ¡†æ¶ä¸ä¸€æ ·ï¼Œæ²¡åŠæ³•å…¼å®¹ä½¿ç”¨ï¼‰ï¼Œæ‰€ä»¥åœ¨JDK1.5ä¸­ä½¿ç”¨CMSæ¥æ”¶é›†è€å¹´ä»£çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹©ParNewæˆ–è€…Serialæ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªã€‚</p></li><li><p>åœ¨G1å‡ºç°ä¹‹å‰ï¼ŒCMSä½¿ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ã€‚ä¸€ç›´åˆ°ä»Šå¤©ï¼Œä»ç„¶æœ‰å¾ˆå¤šç³»ç»Ÿä½¿ç”¨CMS GCã€‚</p></li></ul><h3 id="CMSçš„å·¥ä½œåŸç†">CMSçš„å·¥ä½œåŸç†</h3><p><img src="./../jvm-sgg12/image-20240101201308269.png" alt=""></p><p>CMSæ•´ä¸ªè¿‡ç¨‹æ¯”ä¹‹å‰çš„æ”¶é›†å™¨è¦å¤æ‚ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º4ä¸ªä¸»è¦é˜¶æ®µï¼Œå³åˆå§‹æ ‡è®°é˜¶æ®µã€å¹¶å‘æ ‡è®°é˜¶æ®µã€é‡æ–°æ ‡è®°é˜¶æ®µå’Œå¹¶å‘æ¸…é™¤é˜¶æ®µã€‚(æ¶‰åŠSTWçš„é˜¶æ®µä¸»è¦æ˜¯ï¼šåˆå§‹æ ‡è®° å’Œ é‡æ–°æ ‡è®°)</p><ul><li>åˆå§‹æ ‡è®°ï¼ˆInitial-Markï¼‰é˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½å°†ä¼šå› ä¸º&quot;Stop-the-World&quot;æœºåˆ¶è€Œå‡ºç°çŸ­æš‚çš„æš‚åœï¼Œ<strong>è¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡ä»…ä»…åªæ˜¯æ ‡è®°å‡ºGC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡</strong>ã€‚ä¸€æ—¦æ ‡è®°å®Œæˆä¹‹åå°±ä¼šæ¢å¤ä¹‹å‰è¢«æš‚åœçš„æ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚ç”±äºç›´æ¥å…³è”å¯¹è±¡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™é‡Œçš„<strong>é€Ÿåº¦éå¸¸å¿«</strong>ã€‚</li><li>å¹¶å‘æ ‡è®°ï¼ˆConcurrent-Markï¼‰é˜¶æ®µï¼šä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯<strong>ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹</strong>ï¼Œ<strong>å¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œ</strong>ã€‚</li><li>é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰é˜¶æ®µï¼šç”±äºåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µä¸­ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹ä¼šå’Œåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œï¼Œ**å› æ­¤ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œ**è¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œå¹¶ä¸”ä¹Ÿä¼šå¯¼è‡´&quot;Stop-the-World&quot;çš„å‘ç”Ÿï¼Œä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚</li><li>å¹¶å‘æ¸…é™¤ï¼ˆConcurrent-Sweepï¼‰é˜¶æ®µï¼šæ­¤é˜¶æ®µ<strong>æ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´</strong>ã€‚ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„</li></ul><h3 id="CMSåˆ†æ">CMSåˆ†æ</h3><ul><li>å°½ç®¡CMSæ”¶é›†å™¨é‡‡ç”¨çš„æ˜¯å¹¶å‘å›æ”¶ï¼ˆéç‹¬å å¼ï¼‰ï¼Œ<strong>ä½†æ˜¯åœ¨å…¶åˆå§‹åŒ–æ ‡è®°å’Œå†æ¬¡æ ‡è®°è¿™ä¸¤ä¸ªé˜¶æ®µä¸­ä»ç„¶éœ€è¦æ‰§è¡Œâ€œStop-the-Worldâ€æœºåˆ¶</strong>æš‚åœç¨‹åºä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œä¸è¿‡æš‚åœæ—¶é—´å¹¶ä¸ä¼šå¤ªé•¿ï¼Œå› æ­¤å¯ä»¥è¯´æ˜ç›®å‰æ‰€æœ‰çš„åƒåœ¾æ”¶é›†å™¨éƒ½åšä¸åˆ°å®Œå…¨ä¸éœ€è¦â€œStop-the-Worldâ€ï¼Œåªæ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­æš‚åœæ—¶é—´ã€‚</li><li><strong>ç”±äºæœ€è€—è´¹æ—¶é—´çš„å¹¶å‘æ ‡è®°ä¸å¹¶å‘æ¸…é™¤é˜¶æ®µéƒ½ä¸éœ€è¦æš‚åœå·¥ä½œï¼Œæ‰€ä»¥æ•´ä½“çš„å›æ”¶æ˜¯ä½åœé¡¿çš„</strong>ã€‚</li><li>å¦å¤–ï¼Œç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹æ²¡æœ‰ä¸­æ–­ï¼Œæ‰€ä»¥<strong>åœ¨CMSå›æ”¶è¿‡ç¨‹ä¸­ï¼Œè¿˜åº”è¯¥ç¡®ä¿åº”ç”¨ç¨‹åºç”¨æˆ·çº¿ç¨‹æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ç”¨</strong>ã€‚å› æ­¤ï¼ŒCMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œ<strong>è€Œæ˜¯å½“å †å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°æŸä¸€é˜ˆå€¼æ—¶ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶</strong>ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨CMSå·¥ä½œè¿‡ç¨‹ä¸­ä¾ç„¶æœ‰è¶³å¤Ÿçš„ç©ºé—´æ”¯æŒåº”ç”¨ç¨‹åºè¿è¡Œã€‚è¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºéœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡**â€œConcurrent Mode Failureâ€** å¤±è´¥ï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šä¸´æ—¶å¯ç”¨Serial oldæ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚</li><li>CMSæ”¶é›†å™¨çš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨çš„æ˜¯<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡æ‰§è¡Œå®Œå†…å­˜å›æ”¶åï¼Œç”±äºè¢«æ‰§è¡Œå†…å­˜å›æ”¶çš„æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ææœ‰å¯èƒ½æ˜¯ä¸è¿ç»­çš„ä¸€äº›å†…å­˜å—ï¼Œ<strong>ä¸å¯é¿å…åœ°å°†ä¼šäº§ç”Ÿä¸€äº›å†…å­˜ç¢ç‰‡</strong>ã€‚é‚£ä¹ˆCMSåœ¨ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œå°†æ— æ³•ä½¿ç”¨æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰æŠ€æœ¯ï¼Œè€Œåªèƒ½å¤Ÿé€‰æ‹©ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰æ‰§è¡Œå†…å­˜åˆ†é…ã€‚</li></ul><p><img src="./../jvm-sgg12/image-20240101201947523.png" alt=""></p><p><strong>ä¸ºä»€ä¹ˆ CMS ä¸é‡‡ç”¨æ ‡è®°-å‹ç¼©ç®—æ³•å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆå…¶å®å¾ˆç®€ç­”ï¼Œå› ä¸ºå½“å¹¶å‘æ¸…é™¤çš„æ—¶å€™ï¼Œç”¨Compactæ•´ç†å†…å­˜çš„è¯ï¼ŒåŸæ¥çš„ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨çš„å†…å­˜è¿˜æ€ä¹ˆç”¨å‘¢ï¼Ÿè¦ä¿è¯ç”¨æˆ·çº¿ç¨‹èƒ½ç»§ç»­æ‰§è¡Œï¼Œå‰æçš„å®ƒè¿è¡Œçš„èµ„æºä¸å—å½±å“å˜›ã€‚Mark Compactæ›´é€‚åˆ&quot;stop the world&quot;è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨</p><h3 id="CMS-çš„ä¼˜ç‚¹ä¸å¼Šç«¯">CMS çš„ä¼˜ç‚¹ä¸å¼Šç«¯</h3><p><strong>ä¼˜ç‚¹</strong></p><ol><li>å¹¶å‘æ”¶é›†</li><li>ä½å»¶è¿Ÿ</li></ol><p><strong>å¼Šç«¯</strong></p><ol><li><strong>ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</strong>ï¼Œå¯¼è‡´å¹¶å‘æ¸…é™¤åï¼Œç”¨æˆ·çº¿ç¨‹å¯ç”¨çš„ç©ºé—´ä¸è¶³ã€‚åœ¨æ— æ³•åˆ†é…å¤§å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä¸å¾—ä¸æå‰è§¦å‘Full GCã€‚</li><li><strong>CMSæ”¶é›†å™¨å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ</strong>ã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·åœé¡¿ï¼Œä½†æ˜¯ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚</li><li><strong>CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾</strong>ã€‚å¯èƒ½å‡ºç°â€œConcurrent Mode Failure&quot;å¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡Full GCçš„äº§ç”Ÿã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç”±äºç¨‹åºçš„å·¥ä½œçº¿ç¨‹å’Œåƒåœ¾æ”¶é›†çº¿ç¨‹æ˜¯åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œçš„ï¼Œ**é‚£ä¹ˆåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå¦‚æœäº§ç”Ÿæ–°çš„åƒåœ¾å¯¹è±¡ï¼ŒCMSå°†æ— æ³•å¯¹è¿™äº›åƒåœ¾å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œæœ€ç»ˆä¼šå¯¼è‡´è¿™äº›æ–°äº§ç”Ÿçš„åƒåœ¾å¯¹è±¡æ²¡æœ‰è¢«åŠæ—¶å›æ”¶ï¼Œ**ä»è€Œåªèƒ½åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡ŒGCæ—¶é‡Šæ”¾è¿™äº›ä¹‹å‰æœªè¢«å›æ”¶çš„å†…å­˜ç©ºé—´ã€‚</li></ol><h3 id="CMS-å‚æ•°é…ç½®">CMS å‚æ•°é…ç½®</h3><h2 id="G1-å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼">G1 å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼</h2><ul><li><p><code>-XX:+UseConcMarkSweepGC</code>ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨CMSæ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚</p><p>å¼€å¯è¯¥å‚æ•°åä¼šè‡ªåŠ¨å°†<code>-XX:+UseParNewGC</code>æ‰“å¼€ã€‚å³ï¼šParNewï¼ˆYoungåŒºï¼‰+CMSï¼ˆOldåŒºï¼‰+Serial Oldï¼ˆOldåŒºå¤‡é€‰æ–¹æ¡ˆï¼‰çš„ç»„åˆã€‚</p></li><li><p><code>-XX:CMSInitiatingOccupanyFraction</code>ï¼šè®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡çš„é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¯¥é˜ˆå€¼ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶ã€‚</p><ul><li><p>JDK5åŠä»¥å‰ç‰ˆæœ¬çš„é»˜è®¤å€¼ä¸º68ï¼Œå³å½“è€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨ç‡è¾¾åˆ°68%æ—¶ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡CMSå›æ”¶ã€‚JDK6åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º92%</p></li><li><p>å¦‚æœå†…å­˜å¢é•¿ç¼“æ…¢ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸€ä¸ªç¨å¤§çš„å€¼ï¼Œå¤§çš„é˜€å€¼å¯ä»¥æœ‰æ•ˆé™ä½CMSçš„è§¦å‘é¢‘ç‡ï¼Œå‡å°‘è€å¹´ä»£å›æ”¶çš„æ¬¡æ•°å¯ä»¥è¾ƒä¸ºæ˜æ˜¾åœ°æ”¹å–„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚åä¹‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨ç‡å¢é•¿å¾ˆå¿«ï¼Œåˆ™åº”è¯¥é™ä½è¿™ä¸ªé˜ˆå€¼ï¼Œä»¥é¿å…é¢‘ç¹è§¦å‘è€å¹´ä»£ä¸²è¡Œæ”¶é›†å™¨ã€‚å› æ­¤é€šè¿‡è¯¥é€‰é¡¹ä¾¿å¯ä»¥æœ‰æ•ˆé™ä½Full GCçš„æ‰§è¡Œæ¬¡æ•°ã€‚</p></li></ul></li></ul><h2 id="åƒåœ¾å›æ”¶å™¨æ€»ç»“">åƒåœ¾å›æ”¶å™¨æ€»ç»“</h2><h2 id=""></h2>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-11-åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</title>
      <link href="/2023/12/26/jvm-sgg11/"/>
      <url>/2023/12/26/jvm-sgg11/</url>
      
        <content type="html"><![CDATA[<h1>åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</h1><h2 id="1-System-gc-çš„ç†è§£">1-System.gc()çš„ç†è§£</h2><ul><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡<code>System.gc()</code>æˆ–è€…<code>Runtime.getRuntime().gc()</code> çš„è°ƒç”¨ï¼Œ<strong>ä¼šæ˜¾å¼è§¦å‘Full GC</strong>ï¼ŒåŒæ—¶å¯¹è€å¹´ä»£å’Œæ–°ç”Ÿä»£è¿›è¡Œå›æ”¶ï¼Œå°è¯•é‡Šæ”¾è¢«ä¸¢å¼ƒå¯¹è±¡å ç”¨çš„å†…å­˜ã€‚</p></li><li><p>ç„¶è€Œ<code>System.gc()</code>è°ƒç”¨é™„å¸¦ä¸€ä¸ªå…è´£å£°æ˜ï¼Œæ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨(ä¸èƒ½ç¡®ä¿ç«‹å³ç”Ÿæ•ˆ)</p></li><li><p>JVMå®ç°è€…å¯ä»¥é€šè¿‡<code>System.gc()</code>è°ƒç”¨æ¥å†³å®šJVMçš„GCè¡Œä¸ºã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶åº”è¯¥æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œ**æ— é¡»æ‰‹åŠ¨è§¦å‘ï¼Œå¦åˆ™å°±å¤ªè¿‡äºéº»çƒ¦äº†ã€‚**åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ€§èƒ½åŸºå‡†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œä¹‹é—´è°ƒç”¨<code>System.gc()</code></p></li></ul><h3 id="æ‰‹åŠ¨GC-demo">æ‰‹åŠ¨GC demo</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// -XX:+PrintGCDetails</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalVarGC</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//10MB</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        buffer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">localvarGC5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">localvarGC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">LocalVarGC</span> local <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalVarGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//é€šè¿‡åœ¨mainæ–¹æ³•è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•</span>        local<span class="token punctuation">.</span><span class="token function">localvarGC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg11/image-20231227203849177.png" alt="æƒ…å†µ1"></p><p><img src="./../jvm-sgg11/image-20231227204128068.png" alt="æƒ…å†µ2"></p><p><img src="./../jvm-sgg11/image-20231227204605184.png" alt="æƒ…å†µä¸‰"></p><p><img src="./../jvm-sgg11/image-20231227205040175.png" alt="æƒ…å†µä¸‰åˆ†æ"></p><p><img src="./../jvm-sgg11/image-20231227205533911.png" alt="æƒ…å†µå››"></p><p><img src="./../jvm-sgg11/image-20231227205838709.png" alt="æƒ…å†µäº”"></p><h2 id="2-å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼">2-å†…å­˜æº¢å‡ºä¸å†…å­˜æ³„æ¼</h2><ul><li>å†…å­˜æº¢å‡ºç›¸å¯¹äºå†…å­˜æ³„æ¼æ¥è¯´ï¼Œå°½ç®¡æ›´å®¹æ˜“è¢«ç†è§£ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œå†…å­˜æº¢å‡ºä¹Ÿæ˜¯å¼•å‘ç¨‹åºå´©æºƒçš„ç½ªé­ç¥¸é¦–ä¹‹ä¸€ã€‚</li><li>ç”±äº GC ä¸€ç›´åœ¨å‘å±•ï¼Œæ‰€æœ‰ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤éåº”ç”¨ç¨‹åºå ç”¨çš„å†…å­˜å¢é•¿é€Ÿåº¦éå¸¸å¿«ï¼Œé€ æˆåƒåœ¾å›æ”¶å·²ç»è·Ÿä¸ä¸Šå†…å­˜æ¶ˆè€—çš„é€Ÿåº¦ï¼Œå¦åˆ™ä¸å¤ªå®¹æ˜“å‡ºç° OOM çš„æƒ…å†µã€‚</li><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒGCä¼šè¿›è¡Œå„ç§å¹´é¾„æ®µçš„åƒåœ¾å›æ”¶ï¼Œå®åœ¨ä¸è¡Œäº†å°±æ”¾å¤§æ‹›ï¼Œæ¥ä¸€æ¬¡ç‹¬å å¼çš„ Full GC æ“ä½œï¼Œè¿™æ—¶å€™ä¼šå›æ”¶å¤§é‡çš„å†…å­˜ï¼Œä¾›åº”ç”¨ç¨‹åºç»§ç»­ä½¿ç”¨ã€‚</li><li>Javadocä¸­å¯¹OutofMemoryErrorçš„è§£é‡Šæ˜¯ï¼Œæ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œå¹¶ä¸”åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜ã€‚</li></ul><h3 id="å†…å­˜æº¢å‡º-OOM">å†…å­˜æº¢å‡º(OOM)</h3><p>é¦–å…ˆè¯´æ²¡æœ‰ç©ºé—²å†…å­˜çš„æƒ…å†µï¼šè¯´æ˜Javaè™šæ‹Ÿæœºçš„å †å†…å­˜ä¸å¤Ÿã€‚åŸå› æœ‰äºŒï¼š</p><ol><li><strong>Javaè™šæ‹Ÿæœºçš„å †å†…å­˜è®¾ç½®ä¸å¤Ÿ</strong><ul><li>æ¯”å¦‚ï¼šå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼›ä¹Ÿå¾ˆæœ‰å¯èƒ½å°±æ˜¯å †çš„å¤§å°ä¸åˆç†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å¤„ç†æ¯”è¾ƒå¯è§‚çš„æ•°æ®é‡ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾å¼æŒ‡å®šJVMå †å¤§å°æˆ–è€…æŒ‡å®šæ•°å€¼åå°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°-Xms ã€-Xmxæ¥è°ƒæ•´ã€‚</li></ul></li><li><strong>ä»£ç ä¸­åˆ›å»ºäº†å¤§é‡å¤§å¯¹è±¡ï¼Œå¹¶ä¸”é•¿æ—¶é—´ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨æ”¶é›†</strong>ï¼ˆå­˜åœ¨è¢«å¼•ç”¨ï¼‰<ul><li>å¯¹äºè€ç‰ˆæœ¬çš„ Oracle JDKï¼Œå› ä¸ºæ°¸ä¹…ä»£çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”JVMå¯¹æ°¸ä¹…ä»£åƒåœ¾å›æ”¶ï¼ˆå¦‚ï¼Œå¸¸é‡æ± å›æ”¶ã€å¸è½½ä¸å†éœ€è¦çš„ç±»å‹ï¼‰éå¸¸ä¸ç§¯æï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä¸æ–­æ·»åŠ æ–°ç±»å‹çš„æ—¶å€™ï¼Œæ°¸ä¹…ä»£å‡ºç° OutOfMemoryError ä¹Ÿéå¸¸å¤šè§ã€‚å°¤å…¶æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨å¤§é‡åŠ¨æ€ç±»å‹ç”Ÿæˆçš„åœºåˆï¼›ç±»ä¼¼ intern å­—ç¬¦ä¸²ç¼“å­˜å ç”¨å¤ªå¤šç©ºé—´ï¼Œä¹Ÿä¼šå¯¼è‡´ OOM é—®é¢˜ã€‚å¯¹åº”çš„å¼‚å¸¸ä¿¡æ¯ï¼Œä¼šæ ‡è®°å‡ºæ¥å’Œæ°¸ä¹…ä»£ç›¸å…³ï¼šâ€œjava.lang.OutOfMemoryError:PermGen space&quot;ã€‚</li><li>éšç€å…ƒæ•°æ®åŒºçš„å¼•å…¥ï¼Œæ–¹æ³•åŒºå†…å­˜å·²ç»ä¸å†é‚£ä¹ˆçª˜è¿«ï¼Œæ‰€ä»¥ç›¸åº”çš„OOMæœ‰æ‰€æ”¹è§‚ï¼Œå‡ºç°OOMï¼Œå¼‚å¸¸ä¿¡æ¯åˆ™å˜æˆäº†ï¼šâ€œjava.lang.OutofMemoryError:Metaspace&quot;ã€‚ç›´æ¥å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´ OOMã€‚</li></ul></li></ol><ul><li>è¿™é‡Œé¢éšå«ç€ä¸€å±‚æ„æ€æ˜¯ï¼Œåœ¨æŠ›å‡º OutofMemoryError ä¹‹å‰ï¼Œé€šå¸¸åƒåœ¾æ”¶é›†å™¨ä¼šè¢«è§¦å‘ï¼Œå°½å…¶æ‰€èƒ½å»æ¸…ç†å‡ºç©ºé—´ã€‚<ul><li>ä¾‹å¦‚ï¼šåœ¨å¼•ç”¨æœºåˆ¶åˆ†æä¸­ï¼Œæ¶‰åŠåˆ°JVMä¼šå»å°è¯•<strong>å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡</strong>ç­‰ã€‚</li><li>åœ¨ java.nio.Bits.reserveMemory() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬èƒ½æ¸…æ¥šçš„çœ‹åˆ°ï¼ŒSystem.gc() ä¼šè¢«è°ƒç”¨ï¼Œä»¥æ¸…ç†ç©ºé—´ã€‚</li></ul></li><li>å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šè¢«è§¦å‘çš„<ul><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å»åˆ†é…ä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œç±»ä¼¼ä¸€ä¸ªè¶…å¤§æ•°ç»„è¶…è¿‡å †çš„æœ€å¤§å€¼ï¼ŒJVM å¯ä»¥åˆ¤æ–­å‡ºåƒåœ¾æ”¶é›†å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥æŠ›å‡º OutofMemoryErrorã€‚</li></ul></li></ul><h3 id="å†…å­˜æ³„æ¼">å†…å­˜æ³„æ¼</h3><p>(Memory Leak)</p><ul><li><p>ä¹Ÿç§°ä½œâ€œå­˜å‚¨æ¸—æ¼â€ã€‚<em>ä¸¥æ ¼æ¥è¯´</em>ï¼Œ<strong>åªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯GCåˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚</strong></p></li><li><p>ä½†å®é™…æƒ…å†µå¾ˆå¤šæ—¶å€™ä¸€äº›ä¸å¤ªå¥½çš„å®è·µï¼ˆæˆ–ç–å¿½ï¼‰ä¼šå¯¼è‡´å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¾ˆé•¿ç”šè‡³å¯¼è‡´OOMï¼Œä¹Ÿå¯ä»¥å«åš<strong>å®½æ³›æ„ä¹‰ä¸Šçš„&quot;å†…å­˜æ³„æ¼&quot;</strong>ã€‚</p></li><li><p>å°½ç®¡å†…å­˜æ³„æ¼å¹¶ä¸ä¼šç«‹åˆ»å¼•èµ·ç¨‹åºå´©æºƒï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œç¨‹åºä¸­çš„å¯ç”¨å†…å­˜å°±ä¼šè¢«é€æ­¥èš•é£Ÿï¼Œç›´è‡³è€—å°½æ‰€æœ‰å†…å­˜ï¼Œæœ€ç»ˆå‡ºç° OutofMemory å¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p></li><li><p>æ³¨æ„ï¼Œè¿™é‡Œçš„å­˜å‚¨ç©ºé—´å¹¶ä¸æ˜¯æŒ‡ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯æŒ‡è™šæ‹Ÿå†…å­˜å¤§å°ï¼Œè¿™ä¸ªè™šæ‹Ÿå†…å­˜å¤§å°å–å†³äºç£ç›˜äº¤æ¢åŒºè®¾å®šçš„å¤§å°ã€‚</p></li></ul><p><img src="./../jvm-sgg11/image-20231227210814042.png" alt=""></p><h4 id="å†…å­˜æ³„æ¼å¸¸è§ä¸¾ä¾‹ğŸ‘">å†…å­˜æ³„æ¼å¸¸è§ä¸¾ä¾‹ğŸ‘</h4><ol><li>å•ä¾‹æ¨¡å¼</li></ol><p>å•ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç¨‹åºæ˜¯ä¸€æ ·é•¿çš„ï¼Œæ‰€ä»¥åœ¨å•ä¾‹ç¨‹åºä¸­ï¼Œå¦‚æœæŒæœ‰å¯¹å¤–éƒ¨å¯¹è±¡çš„å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ï¼Œåˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼çš„äº§ç”Ÿã€‚</p><ol start="2"><li>ä¸€äº›æä¾› close() çš„èµ„æºæœªå…³é—­å¯¼è‡´å†…å­˜æ³„æ¼</li></ol><p>æ•°æ®åº“è¿æ¥ dataSourse.getConnection()ï¼Œç½‘ç»œè¿æ¥ socket å’Œ io è¿æ¥å¿…é¡»æ‰‹åŠ¨ closeï¼Œå¦åˆ™æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ã€‚</p><h2 id="3-Stop-The-World">3-Stop The World</h2><ul><li><p>Stop-the-Worldï¼Œç®€ç§° STWï¼ŒæŒ‡çš„æ˜¯ GC äº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿåº”ç”¨ç¨‹åºçš„åœé¡¿ã€‚<strong>åœé¡¿äº§ç”Ÿæ—¶æ•´ä¸ªåº”ç”¨ç¨‹åºçº¿ç¨‹éƒ½ä¼šè¢«æš‚åœï¼Œæ²¡æœ‰ä»»ä½•å“åº”</strong>ï¼Œæœ‰ç‚¹åƒå¡æ­»çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªåœé¡¿ç§°ä¸º STWã€‚</p><ul><li>å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­æšä¸¾æ ¹èŠ‚ç‚¹ï¼ˆGC Rootsï¼‰ä¼šå¯¼è‡´æ‰€æœ‰Javaæ‰§è¡Œçº¿ç¨‹åœé¡¿ï¼Œä¸ºä»€ä¹ˆéœ€è¦åœé¡¿æ‰€æœ‰ Java æ‰§è¡Œçº¿ç¨‹å‘¢ï¼Ÿ<ul><li><p>åˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œ</p></li><li><p>ä¸€è‡´æ€§æŒ‡æ•´ä¸ªåˆ†ææœŸé—´æ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Š</p></li><li><p><strong>å¦‚æœå‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœçš„å‡†ç¡®æ€§æ— æ³•ä¿è¯</strong></p></li></ul></li></ul></li><li><p>è¢« STW ä¸­æ–­çš„åº”ç”¨ç¨‹åºçº¿ç¨‹ä¼šåœ¨å®Œæˆ GC ä¹‹åæ¢å¤ï¼Œé¢‘ç¹ä¸­æ–­ä¼šè®©ç”¨æˆ·æ„Ÿè§‰åƒæ˜¯ç½‘é€Ÿä¸å¿«é€ æˆç”µå½±å¡å¸¦ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‡å°‘ STW çš„å‘ç”Ÿã€‚</p></li><li><p>STWäº‹ä»¶å’Œé‡‡ç”¨å“ªæ¬¾ GC æ— å…³ï¼Œæ‰€æœ‰çš„ GC éƒ½æœ‰è¿™ä¸ªäº‹ä»¶ã€‚</p></li><li><p>å“ªæ€•æ˜¯G1ä¹Ÿä¸èƒ½å®Œå…¨é¿å… Stop-the-world æƒ…å†µå‘ç”Ÿï¼Œåªèƒ½è¯´åƒåœ¾å›æ”¶å™¨è¶Šæ¥è¶Šä¼˜ç§€ï¼Œå›æ”¶æ•ˆç‡è¶Šæ¥è¶Šé«˜ï¼Œå°½å¯èƒ½åœ°ç¼©çŸ­äº†æš‚åœæ—¶é—´ã€‚</p></li><li><p>STW æ˜¯ JVM åœ¨<strong>åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆ</strong>çš„ã€‚åœ¨ç”¨æˆ·ä¸å¯è§çš„æƒ…å†µä¸‹ï¼ŒæŠŠç”¨æˆ·æ­£å¸¸çš„å·¥ä½œçº¿ç¨‹å…¨éƒ¨åœæ‰ã€‚</p></li><li><p>å¼€å‘ä¸­ä¸è¦ç”¨ System.gc() ï¼Œè¿™ä¼šå¯¼è‡´ Stop-the-World çš„å‘ç”Ÿã€‚</p></li></ul><h2 id="4-åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘">4-åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘</h2><p><strong>å¹¶å‘(Concurrent)</strong></p><ul><li>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ˜¯æŒ‡<strong>ä¸€ä¸ªæ—¶é—´æ®µ</strong>ä¸­æœ‰å‡ ä¸ªç¨‹åºéƒ½å¤„äºå·²å¯åŠ¨è¿è¡Œåˆ°è¿è¡Œå®Œæ¯•ä¹‹é—´ï¼Œä¸”è¿™å‡ ä¸ªç¨‹åºéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå¤„ç†å™¨ä¸Šè¿è¡Œ</li><li>å¹¶å‘ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œåŒæ—¶è¿›è¡Œâ€ï¼Œåªæ˜¯ CPU æŠŠä¸€ä¸ªæ—¶é—´æ®µåˆ’åˆ†æˆå‡ ä¸ªæ—¶é—´ç‰‡æ®µï¼ˆæ—¶é—´åŒºé—´ï¼‰ï¼Œç„¶ååœ¨è¿™å‡ ä¸ªæ—¶é—´åŒºé—´ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚ç”±äº CPU å¤„ç†çš„é€Ÿåº¦éå¸¸å¿«ï¼Œåªè¦æ—¶é—´é—´éš”å¤„ç†å¾—å½“ï¼Œå³å¯è®©ç”¨æˆ·æ„Ÿè§‰æ˜¯å¤šä¸ªåº”ç”¨ç¨‹åºåŒæ—¶åœ¨è¿›è¡Œ</li></ul><p><img src="./../jvm-sgg11/image-20231227212116970.png" alt=""></p><p><strong>å¹¶è¡Œ(Parallel)</strong></p><ul><li><p>å½“ç³»ç»Ÿæœ‰ä¸€ä¸ªä»¥ä¸Š CPU æ—¶ï¼Œå½“ä¸€ä¸ª CPU æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå¦ä¸€ä¸ª CPU å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸¤ä¸ªè¿›ç¨‹äº’ä¸æŠ¢å  CPU èµ„æºï¼Œå¯ä»¥<strong>åŒæ—¶</strong>è¿›è¡Œï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¹¶è¡Œï¼ˆParallelï¼‰</p></li><li><p>å…¶å®å†³å®šå¹¶è¡Œçš„å› ç´ ä¸æ˜¯ CPU çš„æ•°é‡ï¼Œè€Œæ˜¯ CPU çš„æ ¸å¿ƒæ•°é‡ï¼Œæ¯”å¦‚ä¸€ä¸ª CPU å¤šä¸ªæ ¸ä¹Ÿå¯ä»¥å¹¶è¡Œ</p></li><li><p>é€‚åˆç§‘å­¦è®¡ç®—ï¼Œåå°å¤„ç†ç­‰å¼±äº¤äº’åœºæ™¯</p></li></ul><p><img src="./../jvm-sgg11/image-20231227212342306.png" alt=""></p><p><strong>å¹¶è¡Œ VS å¹¶å‘</strong></p><ul><li>å¹¶å‘ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªäº‹æƒ…ï¼Œåœ¨åŒä¸€æ—¶é—´æ®µå†…åŒæ—¶å‘ç”Ÿäº†ã€‚</li><li>å¹¶è¡Œï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªäº‹æƒ…ï¼Œåœ¨åŒä¸€æ—¶é—´ç‚¹ä¸Šï¼ˆæˆ–è€…è¯´åŒä¸€æ—¶åˆ»ï¼‰åŒæ—¶å‘ç”Ÿäº†ã€‚</li><li>å¹¶å‘çš„å¤šä¸ªä»»åŠ¡ä¹‹é—´æ˜¯äº’ç›¸æŠ¢å èµ„æºçš„ã€‚å¹¶è¡Œçš„å¤šä¸ªä»»åŠ¡ä¹‹é—´æ˜¯ä¸äº’ç›¸æŠ¢å èµ„æºçš„ã€‚</li><li>åªæœ‰åœ¨å¤š CPU æˆ–è€…ä¸€ä¸ª CPU å¤šæ ¸çš„æƒ…å†µä¸­ï¼Œæ‰ä¼šå‘ç”Ÿå¹¶è¡Œã€‚å¦åˆ™ï¼Œçœ‹ä¼¼åŒæ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼Œå…¶å®éƒ½æ˜¯å¹¶å‘æ‰§è¡Œçš„ã€‚</li></ul><h3 id="åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ">åƒåœ¾å›æ”¶çš„å¹¶å‘ä¸å¹¶è¡Œ</h3><ul><li>å¹¶è¡Œï¼ˆParallelï¼‰ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€ã€‚<ul><li>å¦‚ParNewã€Parallel Scavengeã€Parallel Old</li></ul></li><li>ä¸²è¡Œï¼ˆSerialï¼‰<ul><li>ç›¸è¾ƒäºå¹¶è¡Œçš„æ¦‚å¿µï¼Œå•çº¿ç¨‹æ‰§è¡Œã€‚</li><li>å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåˆ™ç¨‹åºæš‚åœï¼Œå¯åŠ¨JVMåƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆå•çº¿ç¨‹ï¼‰</li></ul></li></ul><p><img src="./../jvm-sgg11/image-20231227212625189.png" alt=""></p><p>å¹¶å‘å’Œå¹¶è¡Œï¼Œåœ¨è°ˆè®ºåƒåœ¾æ”¶é›†å™¨çš„ä¸Šä¸‹æ–‡è¯­å¢ƒä¸­ï¼Œå®ƒä»¬å¯ä»¥è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡<strong>ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œ</strong>ï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ä¸ä¼šåœé¡¿ç”¨æˆ·ç¨‹åºçš„è¿è¡Œã€‚<ul><li>æ¯”å¦‚ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºçº¿ç¨‹è¿è¡Œäºå¦ä¸€ä¸ªCPUä¸Šï¼›</li></ul></li><li>å…¸å‹åƒåœ¾å›æ”¶å™¨ï¼šCMSã€G1</li></ul><p><img src="./../jvm-sgg11/image-20231227212740412.png" alt=""></p><h2 id="5-å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ">5-å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ</h2><p><strong>å®‰å…¨ç‚¹ï¼ˆSafepointï¼‰</strong></p><ul><li>ç¨‹åºæ‰§è¡Œæ—¶å¹¶éåœ¨æ‰€æœ‰åœ°æ–¹éƒ½èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œåªæœ‰åœ¨ç‰¹å®šçš„ä½ç½®æ‰èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œè¿™äº›ä½ç½®ç§°ä¸ºâ€œå®‰å…¨ç‚¹ï¼ˆSafepointï¼‰â€ã€‚</li><li>Safe Point çš„é€‰æ‹©å¾ˆé‡è¦ï¼Œ<strong>å¦‚æœå¤ªå°‘å¯èƒ½å¯¼è‡´GCç­‰å¾…çš„æ—¶é—´å¤ªé•¿ï¼Œå¦‚æœå¤ªé¢‘ç¹å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶çš„æ€§èƒ½é—®é¢˜</strong>ã€‚å¤§éƒ¨åˆ†æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´éƒ½éå¸¸çŸ­æš‚ï¼Œé€šå¸¸ä¼šæ ¹æ®â€œ<strong>æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾</strong>â€ä¸ºæ ‡å‡†ã€‚æ¯”å¦‚ï¼šé€‰æ‹©ä¸€äº›æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æŒ‡ä»¤ä½œä¸º Safe Pointï¼Œ<strong>å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬å’Œå¼‚å¸¸è·³è½¬ç­‰</strong>ã€‚</li></ul><p><strong>å¦‚ä½•åœ¨ GC å‘ç”Ÿæ—¶ï¼Œæ£€æŸ¥æ‰€æœ‰çº¿ç¨‹éƒ½è·‘åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹åœé¡¿ä¸‹æ¥å‘¢ï¼Ÿ</strong></p><ul><li><strong>æŠ¢å…ˆå¼ä¸­æ–­</strong>ï¼šï¼ˆç›®å‰æ²¡æœ‰è™šæ‹Ÿæœºé‡‡ç”¨äº†ï¼‰é¦–å…ˆä¸­æ–­æ‰€æœ‰çº¿ç¨‹ã€‚å¦‚æœè¿˜æœ‰çº¿ç¨‹ä¸åœ¨å®‰å…¨ç‚¹ï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©çº¿ç¨‹è·‘åˆ°å®‰å…¨ç‚¹ã€‚</li><li><strong>ä¸»åŠ¨å¼ä¸­æ–­</strong>ï¼šè®¾ç½®ä¸€ä¸ªä¸­æ–­æ ‡å¿—ï¼Œå„ä¸ªçº¿ç¨‹è¿è¡Œåˆ° Safe Point çš„æ—¶å€™<strong>ä¸»åŠ¨è½®è¯¢</strong>è¿™ä¸ªæ ‡å¿—ï¼Œå¦‚æœä¸­æ–­æ ‡å¿—ä¸ºçœŸï¼Œåˆ™å°†è‡ªå·±è¿›è¡Œä¸­æ–­æŒ‚èµ·ã€‚</li></ul><p><strong>å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰</strong></p><ul><li>Safepoint æœºåˆ¶ä¿è¯äº†ç¨‹åºæ‰§è¡Œæ—¶ï¼Œåœ¨ä¸å¤ªé•¿çš„æ—¶é—´å†…å°±ä¼šé‡åˆ°å¯è¿›å…¥GCçš„Safepointã€‚ä½†æ˜¯ï¼Œç¨‹åºâ€œä¸æ‰§è¡Œâ€çš„æ—¶å€™å‘¢ï¼Ÿ</li><li>ä¾‹å¦‚çº¿ç¨‹å¤„äº Sleep çŠ¶æ€æˆ– Blocked çŠ¶æ€ï¼Œè¿™æ—¶å€™çº¿ç¨‹æ— æ³•å“åº” JVM çš„ä¸­æ–­è¯·æ±‚ï¼Œâ€œèµ°â€åˆ°å®‰å…¨ç‚¹å»ä¸­æ–­æŒ‚èµ·ï¼ŒJVM ä¹Ÿä¸å¤ªå¯èƒ½ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå°±éœ€è¦å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰æ¥è§£å†³ã€‚</li><li><strong>å®‰å…¨åŒºåŸŸæ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç ç‰‡æ®µä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä¸­çš„ä»»ä½•ä½ç½®å¼€å§‹ GC éƒ½æ˜¯å®‰å…¨çš„</strong>ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ Safe Region çœ‹åšæ˜¯è¢«æ‰©å±•äº†çš„ Safepointã€‚</li></ul><p><strong>å®‰å…¨åŒºåŸŸçš„æ‰§è¡Œæµç¨‹</strong></p><ol><li>å½“çº¿ç¨‹è¿è¡Œåˆ° Safe Region çš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†å·²ç»è¿›å…¥äº† Safe Regionï¼Œå¦‚æœè¿™æ®µæ—¶é—´å†…å‘ç”Ÿ GCï¼ŒJVM ä¼šå¿½ç•¥æ ‡è¯†ä¸º Safe Region çŠ¶æ€çš„çº¿ç¨‹</li><li>å½“çº¿ç¨‹å³å°†ç¦»å¼€ Safe Region æ—¶ï¼Œä¼šæ£€æŸ¥JVMæ˜¯å¦å·²ç»å®Œæˆæ ¹èŠ‚ç‚¹æšä¸¾ï¼ˆå³GC Rootsçš„æšä¸¾ï¼‰ï¼Œå¦‚æœå®Œæˆäº†ï¼Œåˆ™ç»§ç»­è¿è¡Œï¼Œå¦åˆ™çº¿ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€ Safe Region çš„ä¿¡å·ä¸ºæ­¢ï¼›</li></ol><h2 id="6-å¼•ç”¨-å¼ºè½¯å¼±è™š">6-å¼•ç”¨(å¼ºè½¯å¼±è™š)</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><ul><li><p>æˆ‘ä»¬å¸Œæœ›èƒ½æè¿°è¿™æ ·ä¸€ç±»å¯¹è±¡ï¼šå½“å†…å­˜ç©ºé—´è¿˜è¶³å¤Ÿæ—¶ï¼Œåˆ™èƒ½ä¿ç•™åœ¨å†…å­˜ä¸­ï¼›å¦‚æœå†…å­˜ç©ºé—´åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†åè¿˜æ˜¯å¾ˆç´§å¼ ï¼Œåˆ™å¯ä»¥æŠ›å¼ƒè¿™äº›å¯¹è±¡ã€‚</p></li><li><p>æ—¢åé—¨åˆéå¸¸é«˜é¢‘çš„é¢è¯•é¢˜ï¼šå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…·ä½“ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>åœ¨ JDK1.2 ç‰ˆä¹‹åï¼ŒJava å¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºï¼š</p><ul><li>å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</li><li>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</li><li>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</li><li>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</li><li><strong>è¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±</strong></li></ul></li><li><p>é™¤å¼ºå¼•ç”¨å¤–ï¼Œå…¶ä»– 3 ç§å¼•ç”¨å‡å¯ä»¥åœ¨ java.lang.ref åŒ…ä¸­æ‰¾åˆ°å®ƒä»¬çš„èº«å½±ã€‚å¦‚ä¸‹å›¾ï¼Œæ˜¾ç¤ºäº†è¿™ 3 ç§å¼•ç”¨ç±»å‹å¯¹åº”çš„ç±»ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p></li></ul><p>Reference å­ç±»ä¸­åªæœ‰ç»ˆç»“å™¨å¼•ç”¨æ˜¯åŒ…å†…å¯è§çš„ï¼Œå…¶ä»–3ç§å¼•ç”¨ç±»å‹å‡ä¸ºpublicï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨</p><ul><li><p><strong>å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</strong>ï¼šæœ€ä¼ ç»Ÿçš„â€œå¼•ç”¨â€çš„å®šä¹‰ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œå³ç±»ä¼¼<code>object obj=new Object()</code>è¿™ç§å¼•ç”¨å…³ç³»ã€‚æ— è®ºä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å®å¯æŠ¥ OOMï¼Œä¹Ÿä¸ä¼š GC å¼ºå¼•ç”¨*(æ­»ä¹Ÿä¸å›æ”¶)*</p></li><li><p><strong>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</strong>ï¼šåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—å…¥å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ã€‚å¦‚æœè¿™æ¬¡å›æ”¶åè¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚<em>(å†…å­˜ä¸è¶³å³å›æ”¶)</em></p></li><li><p><strong>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong>ï¼šè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚<em>(å‘ç°å³å›æ”¶)</em></p></li><li><p><strong>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</strong>ï¼šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å¾—ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„<strong>å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥</strong>ã€‚</p></li></ul><h3 id="å¼ºå¼•ç”¨â€“ä¸å›æ”¶">å¼ºå¼•ç”¨â€“ä¸å›æ”¶</h3><ul><li><p>åœ¨ Java ç¨‹åºä¸­ï¼Œæœ€å¸¸è§çš„å¼•ç”¨ç±»å‹æ˜¯å¼ºå¼•ç”¨ï¼ˆæ™®é€šç³»ç»Ÿ 99% ä»¥ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œ<strong>ä¹Ÿæ˜¯é»˜è®¤çš„å¼•ç”¨ç±»å‹</strong>ã€‚</p></li><li><p>å½“åœ¨ Java è¯­è¨€ä¸­ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å°±æˆä¸ºæŒ‡å‘è¯¥å¯¹è±¡çš„ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</p></li><li><p>**åªè¦å¼ºå¼•ç”¨çš„å¯¹è±¡æ˜¯<a href="/2023/12/24/jvm-sgg10/#ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡?">å¯è§¦åŠçš„</a>ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚**åªè¦å¼ºå¼•ç”¨çš„å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œjvm å®å¯æŠ¥ OOMï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨ã€‚</p></li><li><p>å¯¹äºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å…³ç³»ï¼Œåªè¦è¶…è¿‡äº†å¼•ç”¨çš„ä½œç”¨åŸŸæˆ–è€…æ˜¾å¼åœ°å°†ç›¸åº”ï¼ˆå¼ºï¼‰å¼•ç”¨èµ‹å€¼ä¸º nullï¼Œå°±æ˜¯å¯ä»¥å½“åšåƒåœ¾è¢«æ”¶é›†äº†ï¼Œå½“ç„¶å…·ä½“å›æ”¶æ—¶æœºè¿˜æ˜¯è¦çœ‹åƒåœ¾æ”¶é›†ç­–ç•¥ã€‚</p></li><li><p>ç›¸å¯¹çš„ï¼Œè½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨çš„å¯¹è±¡æ˜¯è½¯å¯è§¦åŠã€å¼±å¯è§¦åŠå’Œè™šå¯è§¦åŠçš„ï¼Œåœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œéƒ½æ˜¯å¯ä»¥è¢«å›æ”¶çš„ã€‚æ‰€ä»¥ï¼Œ<strong>å¼ºå¼•ç”¨æ˜¯é€ æˆJavaå†…å­˜æ³„æ¼çš„ä¸»è¦åŸå› ä¹‹ä¸€</strong>ã€‚</p></li></ul><p><strong>æ€»ç»“</strong></p><p>å¼ºå¼•ç”¨å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><p>å¼ºå¼•ç”¨å¯ä»¥ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚</p></li><li><p>å¼ºå¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œè™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OOM å¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨æ‰€æŒ‡å‘å¯¹è±¡ã€‚</p></li><li><p>å¼ºå¼•ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p></li></ul><h3 id="è½¯å¼•ç”¨â€“å†…å­˜ä¸è¶³å³å›æ”¶">è½¯å¼•ç”¨â€“å†…å­˜ä¸è¶³å³å›æ”¶</h3><ul><li><p>è½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†éå¿…éœ€çš„å¯¹è±¡ã€‚<strong>åªè¢«è½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶</strong>ï¼Œå¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ç¬¬ä¸€æ¬¡å›æ”¶æ˜¯ä¸å¯è¾¾çš„å¯¹è±¡</p></li><li><p>è½¯å¼•ç”¨é€šå¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ã€‚æ¯”å¦‚ï¼š<strong>é«˜é€Ÿç¼“å­˜</strong>å°±æœ‰ç”¨åˆ°è½¯å¼•ç”¨ã€‚å¦‚æœè¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œå°±å¯ä»¥æš‚æ—¶ä¿ç•™ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶æ¸…ç†æ‰ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ç¼“å­˜çš„åŒæ—¶ï¼Œä¸ä¼šè€—å°½å†…å­˜ã€‚</p></li><li><p>åƒåœ¾å›æ”¶å™¨åœ¨æŸä¸ªæ—¶åˆ»å†³å®šå›æ”¶è½¯å¯è¾¾çš„å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šæ¸…ç†è½¯å¼•ç”¨ï¼Œå¹¶å¯é€‰åœ°æŠŠå¼•ç”¨å­˜æ”¾åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReference Queueï¼‰ã€‚</p></li><li><p>ç±»ä¼¼å¼±å¼•ç”¨ï¼Œåªä¸è¿‡ Java è™šæ‹Ÿæœºä¼šå°½é‡è®©è½¯å¼•ç”¨çš„å­˜æ´»æ—¶é—´é•¿ä¸€äº›ï¼Œè¿«ä¸å¾—å·²æ‰æ¸…ç†ã€‚</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å£°æ˜å¼ºå¼•ç”¨</span><span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//é”€æ¯å¼ºå¼•ç”¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>demo</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// -Xmx10m -XX:+PrintGCDetails</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SoftReferenceTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"[id="</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">", name="</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"] "</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ›å»ºå¯¹è±¡ï¼Œå»ºç«‹è½¯å¼•ç”¨</span>        <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> userSoftRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"dee"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä»è½¯å¼•ç”¨ä¸­é‡æ–°è·å¾—å¼ºå¼•ç”¨å¯¹è±¡</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userSoftRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---ç›®å‰å†…å­˜è¿˜ä¸ç´§å¼ ---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"After GC:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åƒåœ¾å›æ”¶ä¹‹åè·å¾—è½¯å¼•ç”¨ä¸­çš„å¯¹è±¡</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userSoftRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”±äºå †ç©ºé—´å†…å­˜è¶³å¤Ÿï¼Œæ‰€æœ‰ä¸ä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯è¾¾å¯¹è±¡ã€‚</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---ä¸‹é¢å¼€å§‹å†…å­˜ç´§å¼ äº†---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//è®©ç³»ç»Ÿè®¤ä¸ºå†…å­˜èµ„æºç´§å¼ ã€ä¸å¤Ÿ</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">7168</span> <span class="token operator">-</span> <span class="token number">710</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// heap=10M old=6.6M</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//å†æ¬¡ä»è½¯å¼•ç”¨ä¸­è·å–æ•°æ®</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userSoftRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åœ¨æŠ¥OOMä¹‹å‰ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯è¾¾å¯¹è±¡ã€‚</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>f<img src="./../jvm-sgg11/image-20231227223328325.png" alt="æ•°ç»„å¤§å°è®¾ç½®æ€è·¯"></p><h3 id="å¼±å¼•ç”¨â€“å‘ç°å³å›æ”¶">å¼±å¼•ç”¨â€“å‘ç°å³å›æ”¶</h3><ul><li><p>å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°é‚£äº›éå¿…éœ€å¯¹è±¡ï¼Œ<strong>åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¸ºæ­¢ã€‚åœ¨ç³»ç»Ÿ GC æ—¶ï¼Œåªè¦å‘ç°å¼±å¼•ç”¨ï¼Œä¸ç®¡ç³»ç»Ÿå †ç©ºé—´ä½¿ç”¨æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡</strong>ã€‚</p></li><li><p>ä½†æ˜¯ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨çš„çº¿ç¨‹é€šå¸¸ä¼˜å…ˆçº§å¾ˆä½ï¼Œå› æ­¤ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾ˆå¿«åœ°å‘ç°æŒæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>å¼±å¼•ç”¨å¯¹è±¡å¯ä»¥å­˜åœ¨è¾ƒé•¿çš„æ—¶é—´</strong>ã€‚</p></li><li><p>å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨ä¸€æ ·ï¼Œåœ¨æ„é€ å¼±å¼•ç”¨æ—¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œå½“å¼±å¼•ç”¨å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå°±ä¼šåŠ å…¥æŒ‡å®šçš„å¼•ç”¨é˜Ÿåˆ—ï¼Œé€šè¿‡è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p></li><li><p><strong>è½¯å¼•ç”¨ã€å¼±å¼•ç”¨éƒ½éå¸¸é€‚åˆæ¥ä¿å­˜é‚£äº›å¯æœ‰å¯æ— çš„ç¼“å­˜æ•°æ®</strong>ã€‚å¦‚æœè¿™ä¹ˆåšï¼Œå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®ä¼šè¢«å›æ”¶ï¼Œä¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è€Œå½“å†…å­˜èµ„æºå……è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®åˆå¯ä»¥å­˜åœ¨ç›¸å½“é•¿çš„æ—¶é—´ï¼Œä»è€Œèµ·åˆ°åŠ é€Ÿç³»ç»Ÿçš„ä½œç”¨ã€‚</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å£°æ˜å¼ºå¼•ç”¨</span><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//é”€æ¯å¼ºå¼•ç”¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¼±å¼•ç”¨å¯¹è±¡ä¸è½¯å¼•ç”¨å¯¹è±¡çš„æœ€å¤§ä¸åŒ</strong>å°±åœ¨äºï¼Œå½“GCåœ¨è¿›è¡Œå›æ”¶æ—¶ï¼Œéœ€è¦é€šè¿‡ç®—æ³•æ£€æŸ¥æ˜¯å¦å›æ”¶è½¯å¼•ç”¨å¯¹è±¡ï¼Œè€Œå¯¹äºå¼±å¼•ç”¨å¯¹è±¡ï¼ŒGCæ€»æ˜¯è¿›è¡Œå›æ”¶ã€‚<strong>å¼±å¼•ç”¨å¯¹è±¡æ›´å®¹æ˜“ã€æ›´å¿«è¢« GC å›æ”¶</strong>ã€‚</p><p><strong>é¢è¯•é¢˜ï¼šä½ å¼€å‘ä¸­ä½¿ç”¨è¿‡WeakHashMapå—ï¼Ÿ</strong></p><h3 id="è™šå¼•ç”¨â€“å¯¹è±¡å›æ”¶è·Ÿè¸ª">è™šå¼•ç”¨â€“å¯¹è±¡å›æ”¶è·Ÿè¸ª</h3><ul><li><p>ä¹Ÿç§°ä¸º&quot;å¹½çµå¼•ç”¨&quot;æˆ–è€…&quot;å¹»å½±å¼•ç”¨&quot;ï¼Œæ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹ä¸­æœ€å¼±çš„ä¸€ä¸ª</p></li><li><p>ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå’Œæ²¡æœ‰å¼•ç”¨å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéšæ—¶éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p></li><li><p>å®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å½“è¯•å›¾é€šè¿‡è™šå¼•ç”¨çš„ get() æ–¹æ³•å–å¾—å¯¹è±¡æ—¶ï¼Œæ€»æ˜¯ null ã€‚<strong>å³é€šè¿‡è™šå¼•ç”¨æ— æ³•è·å–åˆ°æˆ‘ä»¬çš„æ•°æ®</strong></p></li><li><p><strong>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åœ¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼šèƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</strong></p></li><li><p>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚è™šå¼•ç”¨åœ¨åˆ›å»ºæ—¶å¿…é¡»æä¾›ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä½œä¸ºå‚æ•°ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡åï¼Œå°†è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p></li><li><p>ç”±äºè™šå¼•ç”¨å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æ—¶é—´ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥å°†ä¸€äº›èµ„æºé‡Šæ”¾æ“ä½œæ”¾ç½®åœ¨è™šå¼•ç”¨ä¸­æ‰§è¡Œå’Œè®°å½•ã€‚</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å£°æ˜å¼ºå¼•ç”¨</span><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å£°æ˜å¼•ç”¨é˜Ÿåˆ—</span><span class="token class-name">ReferenceQueue</span> phantomQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å£°æ˜è™šå¼•ç”¨ï¼ˆè¿˜éœ€è¦ä¼ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼‰</span><span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> phantomQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è™šå¼•ç”¨ä»£ç ç¤ºä¾‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhantomReferenceTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PhantomReferenceTest</span> obj<span class="token punctuation">;</span><span class="token comment">//å½“å‰ç±»å¯¹è±¡çš„å£°æ˜</span>    <span class="token keyword">static</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">></span></span> phantomQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//å¼•ç”¨é˜Ÿåˆ—</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CheckRefQueue</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>phantomQueue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">></span></span> objt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        objt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> phantomQueue<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>objt <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿½è¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼šPhantomReferenceTestå®ä¾‹è¢«GCäº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span> <span class="token comment">//finalize()æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨å½“å‰ç±»çš„finalize()æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheckRefQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼šå½“ç¨‹åºä¸­æ²¡æœ‰éå®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°±æ‰§è¡Œç»“æŸã€‚</span>        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phantomQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ„é€ äº† PhantomReferenceTest å¯¹è±¡çš„è™šå¼•ç”¨ï¼Œå¹¶æŒ‡å®šäº†å¼•ç”¨é˜Ÿåˆ—</span>        <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PhantomReferenceTest</span><span class="token punctuation">></span></span> phantomRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> phantomQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//ä¸å¯è·å–è™šå¼•ç”¨ä¸­çš„å¯¹è±¡</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phantomRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¬¬ 1 æ¬¡ gc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å°†å¼ºå¼•ç”¨å»é™¤</span>            obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token comment">//ç¬¬ä¸€æ¬¡è¿›è¡ŒGC,ç”±äºå¯¹è±¡å¯å¤æ´»ï¼ŒGCæ— æ³•å›æ”¶è¯¥å¯¹è±¡</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj æ˜¯ null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj å¯ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¬¬ 2 æ¬¡ gc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸€æ—¦å°†objå¯¹è±¡å›æ”¶ï¼Œå°±ä¼šå°†æ­¤è™šå¼•ç”¨å­˜æ”¾åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj æ˜¯ null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj å¯ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg11/image-20231227230831048.png" alt="åˆ†æå›¾"></p><h2 id="7-ç»ˆç»“å™¨å¼•ç”¨-äº†è§£">7-ç»ˆç»“å™¨å¼•ç”¨(äº†è§£)</h2><p><strong>(Final reference)</strong></p><ul><li><p>å®ƒç”¨äºå®ç°å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºç»ˆç»“å™¨å¼•ç”¨</p></li><li><p>æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œå…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨</p></li><li><p>åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿã€‚ç”± Finalizer çº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡è°ƒç”¨å®ƒçš„ finalize() æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡GCæ—¶æ‰å›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-10-åƒåœ¾å›æ”¶æ¦‚è¿°å’Œç›¸å…³ç®—æ³•</title>
      <link href="/2023/12/24/jvm-sgg10/"/>
      <url>/2023/12/24/jvm-sgg10/</url>
      
        <content type="html"><![CDATA[<h1>åƒåœ¾å›æ”¶æ¦‚è¿°å’Œç›¸å…³ç®—æ³•</h1><img src="./../jvm-sgg10/image-20231224183056294.png" style="zoom: 50%;" /><img src="./../jvm-sgg10/image-20231224184307909.png" style="zoom: 50%;" /><ul><li><p>åƒåœ¾æ”¶é›†ï¼Œä¸æ˜¯ Java è¯­è¨€çš„ä¼´ç”Ÿäº§ç‰©ã€‚æ—©åœ¨1960å¹´ï¼Œç¬¬ä¸€é—¨å¼€å§‹ä½¿ç”¨å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯çš„Lispè¯­è¨€è¯ç”Ÿã€‚</p></li><li><p>å…³äºåƒåœ¾æ”¶é›†æœ‰ä¸‰ä¸ªç»å…¸é—®é¢˜ï¼š</p><ul><li>å“ªäº›å†…å­˜éœ€è¦å›æ”¶ï¼Ÿ</li><li>ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿ</li><li>å¦‚ä½•å›æ”¶ï¼Ÿ</li></ul></li><li><p>åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯Javaçš„æ‹›ç‰Œèƒ½åŠ›ï¼Œ<strong>æå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡</strong>ã€‚å¦‚ä»Šï¼Œåƒåœ¾æ”¶é›†å‡ ä¹æˆä¸ºç°ä»£è¯­è¨€çš„æ ‡é…ï¼Œå³ä½¿ç»è¿‡å¦‚æ­¤é•¿æ—¶é—´çš„å‘å±•ï¼ŒJava çš„åƒåœ¾æ”¶é›†æœºåˆ¶ä»ç„¶åœ¨ä¸æ–­çš„æ¼”è¿›ä¸­ï¼Œä¸åŒå¤§å°çš„è®¾å¤‡ã€ä¸åŒç‰¹å¾çš„åº”ç”¨åœºæ™¯ï¼Œå¯¹åƒåœ¾æ”¶é›†æå‡ºäº†æ–°çš„æŒ‘æˆ˜ï¼Œè¿™å½“ç„¶ä¹Ÿæ˜¯<strong>é¢è¯•çš„çƒ­ç‚¹</strong>ã€‚</p></li></ul><p><strong>å¸¸è§é¢è¯•é¢˜</strong></p><ul><li>ä½ çŸ¥é“å“ªå‡ ç§åƒåœ¾å›æ”¶å™¨ï¼Œå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œé‡ç‚¹è®²ä¸€ä¸‹ CMS å’Œ G1ï¼Ÿ</li><li>JVM GC ç®—æ³•æœ‰å“ªäº›ï¼Œç›®å‰çš„ JDK ç‰ˆæœ¬é‡‡ç”¨ä»€ä¹ˆå›æ”¶ç®—æ³•ï¼Ÿ</li><li>G1 å›æ”¶å™¨è®²ä¸‹å›æ”¶è¿‡ç¨‹ GC æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰ GCï¼Ÿ</li><li>GC çš„ä¸¤ç§åˆ¤å®šæ–¹æ³•ï¼ŸCMS æ”¶é›†å™¨ä¸ G1 æ”¶é›†å™¨çš„ç‰¹ç‚¹</li><li>è¯´ä¸€ä¸‹ GC ç®—æ³•ï¼Œåˆ†ä»£å›æ”¶è¯´ä¸‹</li><li>åƒåœ¾æ”¶é›†ç­–ç•¥å’Œç®—æ³•</li><li>JVM GC åŸç†ï¼ŒJVM æ€ä¹ˆå›æ”¶å†…å­˜</li><li>CMS ç‰¹ç‚¹ï¼Œåƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œä»–ä»¬å…±åŒçš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Java çš„åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å“ªäº›ï¼Œè¯´ä¸‹ G1 çš„åº”ç”¨åœºæ™¯ï¼Œå¹³æ—¶ä½ æ˜¯å¦‚ä½•æ­é…ä½¿ç”¨åƒåœ¾å›æ”¶å™¨çš„</li><li>ä½ çŸ¥é“å“ªå‡ ç§åƒåœ¾æ”¶é›†å™¨ï¼Œå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œé‡ç‚¹è®²ä¸‹ CMS å’Œ G1</li><li>åŒ…æ‹¬åŸç†ï¼Œæµç¨‹ï¼Œä¼˜ç¼ºç‚¹ã€‚åƒåœ¾å›æ”¶ç®—æ³•çš„å®ç°åŸç†</li><li>è®²ä¸€è®²åƒåœ¾å›æ”¶ç®—æ³•ã€‚</li><li>ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘åƒåœ¾å›æ”¶ï¼Ÿ</li><li>å¦‚ä½•é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Ÿ</li><li>JVM æœ‰å“ªä¸‰ç§åƒåœ¾å›æ”¶å™¨ï¼Ÿ</li><li>å¸¸è§çš„åƒåœ¾å›æ”¶å™¨ç®—æ³•æœ‰å“ªäº›ï¼Œå„æœ‰ä»€ä¹ˆä¼˜åŠ£ï¼Ÿ</li><li>System.gc() å’Œ Runtime.gc() ä¼šåšä»€ä¹ˆäº‹æƒ…ï¼Ÿ</li><li>Java GC æœºåˆ¶ï¼ŸGC Roots æœ‰å“ªäº›ï¼Ÿ</li><li>Java å¯¹è±¡çš„å›æ”¶æ–¹å¼ï¼Œå›æ”¶ç®—æ³•ã€‚</li><li>CMS å’Œ G1 äº†è§£ä¹ˆï¼ŒCMS è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œè¯´ä¸€ä¸‹å›æ”¶çš„è¿‡ç¨‹ã€‚</li><li>CMS å›æ”¶åœé¡¿äº†å‡ æ¬¡ï¼Œä¸ºä»€ä¹ˆè¦åœé¡¿ä¸¤æ¬¡?</li></ul><h2 id="1-æ¦‚è¿°">1-æ¦‚è¿°</h2><p><strong>ä»€ä¹ˆæ˜¯åƒåœ¾</strong></p><ul><li>åƒåœ¾æ˜¯æŒ‡<strong>åœ¨è¿è¡Œç¨‹åºä¸­æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡</strong>ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯éœ€è¦è¢«å›æ”¶çš„åƒåœ¾ã€‚</li><li>å¤–æ–‡ï¼šAn object is considered garbage when it can no longer be reached from any pointer in the running program.</li><li>å¦‚æœä¸åŠæ—¶å¯¹å†…å­˜ä¸­çš„åƒåœ¾è¿›è¡Œæ¸…ç†ï¼Œé‚£ä¹ˆï¼Œè¿™äº›åƒåœ¾å¯¹è±¡æ‰€å çš„å†…å­˜ç©ºé—´ä¼šä¸€ç›´ä¿ç•™åˆ°åº”ç”¨ç¨‹åºç»“æŸï¼Œè¢«ä¿ç•™çš„ç©ºé—´æ— æ³•è¢«å…¶ä»–å¯¹è±¡ä½¿ç”¨ã€‚ç”šè‡³å¯èƒ½<strong>å¯¼è‡´å†…å­˜æº¢å‡º</strong>ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ GC</strong></p><ul><li><p>å¯¹äºé«˜çº§è¯­è¨€æ¥è¯´ï¼Œä¸€ä¸ªåŸºæœ¬è®¤çŸ¥æ˜¯å¦‚æœä¸è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œ<strong>å†…å­˜è¿Ÿæ—©éƒ½ä¼šè¢«æ¶ˆè€—å®Œ</strong>ï¼Œå› ä¸ºä¸æ–­åœ°åˆ†é…å†…å­˜ç©ºé—´è€Œä¸è¿›è¡Œå›æ”¶ï¼Œå°±å¥½åƒä¸åœåœ°ç”Ÿäº§ç”Ÿæ´»åƒåœ¾è€Œä»æ¥ä¸æ‰“æ‰«ä¸€æ ·ã€‚</p></li><li><p>é™¤äº†é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶ä¹Ÿå¯ä»¥æ¸…é™¤å†…å­˜é‡Œçš„è®°å½•ç¢ç‰‡ã€‚ç¢ç‰‡æ•´ç†å°†æ‰€å ç”¨çš„å †å†…å­˜ç§»åˆ°å †çš„ä¸€ç«¯ï¼Œ<strong>ä»¥ä¾¿ JVM å°†æ•´ç†å‡ºçš„å†…å­˜åˆ†é…ç»™æ–°çš„å¯¹è±¡</strong>ã€‚</p></li><li><p>éšç€åº”ç”¨ç¨‹åºæ‰€åº”ä»˜çš„ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ã€å¤æ‚ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œ<strong>æ²¡æœ‰ GC å°±ä¸èƒ½ä¿è¯åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿›è¡Œ</strong>ã€‚è€Œç»å¸¸é€ æˆ STW çš„ GCåˆè·Ÿä¸ä¸Šå®é™…çš„éœ€æ±‚ï¼Œæ‰€ä»¥æ‰ä¼šä¸æ–­åœ°å°è¯•å¯¹GCè¿›è¡Œä¼˜åŒ–ã€‚</p></li></ul><p><strong>æ—©æœŸåƒåœ¾å›æ”¶</strong></p><ul><li>åœ¨æ—©æœŸçš„ C/C++ æ—¶ä»£ï¼Œåƒåœ¾å›æ”¶åŸºæœ¬ä¸Šæ˜¯æ‰‹å·¥è¿›è¡Œçš„ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ new å…³é”®å­—è¿›è¡Œå†…å­˜ç”³è¯·ï¼Œå¹¶ä½¿ç”¨ delete å…³é”®å­—è¿›è¡Œå†…å­˜é‡Šæ”¾ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c">MibBridge <span class="token operator">*</span> pBridge<span class="token operator">=</span> new <span class="token function">cmBaseGroupBridge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œä½¿ç”¨Deleteé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å å†…å­˜åŒºåŸŸ</span><span class="token keyword">if</span><span class="token punctuation">(</span>pBridge<span class="token operator">-></span><span class="token function">Register</span><span class="token punctuation">(</span>kDestroy<span class="token punctuation">)</span><span class="token operator">!=</span>NO ERROR<span class="token punctuation">)</span>    delete pBridge<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿™ç§æ–¹å¼å¯ä»¥çµæ´»æ§åˆ¶å†…å­˜é‡Šæ”¾çš„æ—¶é—´ï¼Œä½†æ˜¯ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥<strong>é¢‘ç¹ç”³è¯·å’Œé‡Šæ”¾å†…å­˜çš„ç®¡ç†è´Ÿæ‹…</strong>ã€‚å€˜è‹¥æœ‰ä¸€å¤„å†…å­˜åŒºé—´ç”±äºç¨‹åºå‘˜ç¼–ç çš„é—®é¢˜å¿˜è®°è¢«å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿ<strong>å†…å­˜æ³„æ¼</strong>ï¼Œåƒåœ¾å¯¹è±¡æ°¸è¿œæ— æ³•è¢«æ¸…é™¤ï¼Œéšç€ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„ä¸æ–­å¢é•¿ï¼Œåƒåœ¾å¯¹è±¡æ‰€è€—å†…å­˜å¯èƒ½æŒç»­ä¸Šå‡ï¼Œç›´åˆ°å‡ºç°å†…å­˜æº¢å‡ºå¹¶é€ æˆ<strong>åº”ç”¨ç¨‹åºå´©æºƒ</strong>ã€‚</li><li>æœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œä¸Šè¿°ä»£ç ææœ‰å¯èƒ½å˜æˆè¿™æ ·</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c">MibBridge <span class="token operator">*</span> pBridge<span class="token operator">=</span>new <span class="token function">cmBaseGroupBridge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>pBridge<span class="token operator">-></span><span class="token function">Register</span><span class="token punctuation">(</span>kDestroy<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ç°åœ¨ï¼Œé™¤äº† Java ä»¥å¤–ï¼ŒC#ã€Pythonã€Ruby ç­‰è¯­è¨€éƒ½ä½¿ç”¨äº†è‡ªåŠ¨åƒåœ¾å›æ”¶çš„æ€æƒ³ï¼Œä¹Ÿæ˜¯æœªæ¥å‘å±•è¶‹åŠ¿ï¼Œå¯ä»¥è¯´è¿™ç§è‡ªåŠ¨åŒ–çš„å†…å­˜åˆ†é…å’Œæ¥åŠå›æ”¶æ–¹å¼å·²ç»æˆä¸ºäº†ç°ä»£å¼€å‘è¯­è¨€å¿…å¤‡çš„æ ‡å‡†ã€‚</li></ul><p><strong>Java åƒåœ¾å›æ”¶æœºåˆ¶</strong></p><p><strong>å®˜ç½‘ä»‹ç»</strong>ï¼š<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html</a></p><ul><li><p>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œæ— éœ€å¼€å‘äººå‘˜æ‰‹åŠ¨å‚ä¸å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼Œè¿™æ ·<strong>é™ä½å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„é£é™©</strong></p><ul><li>æ²¡æœ‰åƒåœ¾å›æ”¶å™¨ï¼Œjava ä¹Ÿä¼šå’Œ cpp ä¸€æ ·ï¼Œå„ç§æ‚¬å‚æŒ‡é’ˆï¼Œé‡æŒ‡é’ˆï¼Œæ³„éœ²é—®é¢˜è®©ä½ å¤´ç–¼ä¸å·²ã€‚</li></ul></li><li><p>è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå°†ç¨‹åºå‘˜ä»ç¹é‡çš„å†…å­˜ç®¡ç†ä¸­é‡Šæ”¾å‡ºæ¥ï¼Œå¯ä»¥<strong>æ›´ä¸“å¿ƒåœ°ä¸“æ³¨äºä¸šåŠ¡å¼€å‘</strong></p></li></ul><p><strong>è‡ªåŠ¨å†…å­˜ç®¡ç†çš„æ‹…å¿§</strong></p><ul><li>å¯¹äº Java å¼€å‘äººå‘˜è€Œè¨€ï¼Œè‡ªåŠ¨å†…å­˜ç®¡ç†å°±åƒæ˜¯ä¸€ä¸ªé»‘åŒ£å­ï¼Œå¦‚æœè¿‡åº¦ä¾èµ–äº&quot;è‡ªåŠ¨&quot;ï¼Œé‚£ä¹ˆè¿™å°†ä¼šæ˜¯ä¸€åœºç¾éš¾ï¼Œæœ€ä¸¥é‡çš„å°±ä¼š<strong>å¼±åŒ– Java å¼€å‘äººå‘˜åœ¨ç¨‹åºå‡ºç°å†…å­˜æº¢å‡ºæ—¶å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›</strong>ã€‚</li><li>æ­¤æ—¶ï¼Œäº†è§£ JVM çš„è‡ªåŠ¨å†…å­˜åˆ†é…å’Œå†…å­˜å›æ”¶åŸç†å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œåªæœ‰åœ¨çœŸæ­£äº†è§£ JVM æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜åï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåœ¨é‡è§ OutofMemoryError æ—¶ï¼Œå¿«é€Ÿåœ°æ ¹æ®é”™è¯¯å¼‚å¸¸æ—¥å¿—å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜ã€‚</li><li>å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼é—®é¢˜æ—¶ï¼Œå½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘é‡çš„ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¯¹è¿™äº›â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯<strong>å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚</strong>ã€‚</li></ul><p><strong>å…³å¿ƒåŒºåŸŸ</strong></p><ul><li><p>åƒåœ¾æ”¶é›†å™¨å¯ä»¥å¯¹å¹´è½»ä»£å›æ”¶ï¼Œä¹Ÿå¯ä»¥å¯¹è€å¹´ä»£å›æ”¶ï¼Œç”šè‡³æ˜¯å…¨æ ˆå’Œæ–¹æ³•åŒºçš„å›æ”¶ï¼Œ</p><ul><li>å…¶ä¸­ï¼Œ<strong>Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨çš„å·¥ä½œé‡ç‚¹</strong></li></ul></li><li><p>ä»æ¬¡æ•°ä¸Šè®²ï¼š</p><ul><li><p>é¢‘ç¹æ”¶é›† Young åŒº</p></li><li><p>è¾ƒå°‘æ”¶é›† Old åŒº</p></li><li><p>åŸºæœ¬ä¸æ”¶é›† Perm åŒºï¼ˆå…ƒç©ºé—´ï¼‰</p></li></ul></li></ul><h2 id="2-æ ‡è®°é˜¶æ®µ-å¼•ç”¨åŸºæ•°ç®—æ³•">2-æ ‡è®°é˜¶æ®µ: å¼•ç”¨åŸºæ•°ç®—æ³•</h2><h3 id="å¯¹è±¡å­˜æ´»åˆ¤æ–­">å¯¹è±¡å­˜æ´»åˆ¤æ–­</h3><ul><li>åœ¨å †é‡Œå­˜æ”¾ç€å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡å®ä¾‹ï¼Œåœ¨ GC æ‰§è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆ<strong>éœ€è¦åŒºåˆ†å‡ºå†…å­˜ä¸­å“ªäº›æ˜¯å­˜æ´»å¯¹è±¡ï¼Œå“ªäº›æ˜¯å·²ç»æ­»äº¡çš„å¯¹è±¡ã€‚<strong>åªæœ‰è¢«æ ‡è®°ä¸ºå·±ç»æ­»äº¡çš„å¯¹è±¡ï¼ŒGC æ‰ä¼šåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œé‡Šæ”¾æ‰å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç§°ä¸º</strong>åƒåœ¾æ ‡è®°é˜¶æ®µ</strong>ã€‚</li><li>é‚£ä¹ˆåœ¨ JVM ä¸­ç©¶ç«Ÿæ˜¯å¦‚ä½•æ ‡è®°ä¸€ä¸ªæ­»äº¡å¯¹è±¡å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å·²ç»ä¸å†è¢«ä»»ä½•çš„å­˜æ´»å¯¹è±¡ç»§ç»­å¼•ç”¨æ—¶ï¼Œå°±å¯ä»¥å®£åˆ¤ä¸ºå·²ç»æ­»äº¡ã€‚</li><li>åˆ¤æ–­å¯¹è±¡å­˜æ´»ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š<strong>å¼•ç”¨è®¡æ•°ç®—æ³•</strong>å’Œ<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ã€‚</li></ul><h3 id="æ–¹å¼ä¸€-å¼•ç”¨è®¡æ•°ç®—æ³•">æ–¹å¼ä¸€: å¼•ç”¨è®¡æ•°ç®—æ³•</h3><ul><li><p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countingï¼‰æ¯”è¾ƒç®€å•ï¼Œå¯¹æ¯ä¸ªå¯¹è±¡ä¿å­˜ä¸€ä¸ªæ•´å‹çš„<strong>å¼•ç”¨è®¡æ•°å™¨å±æ€§ã€‚ç”¨äºè®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µ</strong>ã€‚</p></li><li><p>å¯¹äºä¸€ä¸ªå¯¹è±¡Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº† Aï¼Œåˆ™ A çš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ  1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡ 1ã€‚åªè¦å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ä¸º 0ï¼Œå³è¡¨ç¤ºå¯¹è±¡ A ä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå¯è¿›è¡Œå›æ”¶ã€‚</p></li><li><p>ä¼˜ç‚¹ï¼š<strong>å®ç°ç®€å•ï¼Œåƒåœ¾å¯¹è±¡ä¾¿äºè¾¨è¯†ï¼›åˆ¤å®šæ•ˆç‡é«˜ï¼Œå›æ”¶æ²¡æœ‰å»¶è¿Ÿæ€§</strong>ã€‚</p></li><li><p>ç¼ºç‚¹ï¼š</p><ul><li><p>å®ƒéœ€è¦å•ç‹¬çš„å­—æ®µå­˜å‚¨è®¡æ•°å™¨ï¼Œè¿™æ ·çš„åšæ³•å¢åŠ äº†<strong>å­˜å‚¨ç©ºé—´çš„å¼€é”€</strong>ã€‚</p></li><li><p>æ¯æ¬¡èµ‹å€¼éƒ½éœ€è¦æ›´æ–°è®¡æ•°å™¨ï¼Œä¼´éšç€åŠ æ³•å’Œå‡æ³•æ“ä½œï¼Œè¿™å¢åŠ äº†<strong>æ—¶é—´å¼€é”€</strong>ã€‚</p></li><li><p>å¼•ç”¨è®¡æ•°å™¨æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå³<strong>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</strong>çš„æƒ…å†µã€‚è¿™æ˜¯ä¸€æ¡<strong>è‡´å‘½ç¼ºé™·</strong>ï¼Œå¯¼è‡´åœ¨ Java çš„åƒåœ¾å›æ”¶å™¨ä¸­æ²¡æœ‰ä½¿ç”¨è¿™ç±»ç®—æ³•ã€‚</p></li></ul></li></ul><p><img src="./../jvm-sgg10/image-20231224192541616.png" alt="å¾ªç¯å¼•ç”¨"></p><p><strong>å°ç»“</strong></p><ul><li>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œæ˜¯å¾ˆå¤šè¯­è¨€çš„èµ„æºå›æ”¶é€‰æ‹©ï¼Œä¾‹å¦‚å› äººå·¥æ™ºèƒ½è€Œæ›´åŠ ç«çƒ­çš„ Pythonï¼Œå®ƒæ›´æ˜¯åŒæ—¶æ”¯æŒå¼•ç”¨è®¡æ•°å’Œåƒåœ¾æ”¶é›†æœºåˆ¶ã€‚</li><li>å…·ä½“å“ªç§æœ€ä¼˜æ˜¯è¦çœ‹åœºæ™¯çš„ï¼Œä¸šç•Œæœ‰å¤§è§„æ¨¡å®è·µä¸­ä»…ä¿ç•™å¼•ç”¨è®¡æ•°æœºåˆ¶ï¼Œä»¥æé«˜ååé‡çš„å°è¯•ã€‚</li><li>Java å¹¶æ²¡æœ‰é€‰æ‹©å¼•ç”¨è®¡æ•°ï¼Œæ˜¯å› ä¸ºå…¶å­˜åœ¨ä¸€ä¸ªåŸºæœ¬çš„éš¾é¢˜ï¼Œä¹Ÿå°±æ˜¯å¾ˆéš¾å¤„ç†å¾ªç¯å¼•ç”¨å…³ç³»ã€‚</li><li>Python å¦‚ä½•è§£å†³å¾ªç¯å¼•ç”¨ï¼Ÿ<ul><li>æ‰‹åŠ¨è§£é™¤ï¼šå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨åˆé€‚çš„æ—¶æœºï¼Œè§£é™¤å¼•ç”¨å…³ç³»ã€‚</li><li>ä½¿ç”¨å¼±å¼•ç”¨ weakrefï¼Œweakref æ˜¯ Python æä¾›çš„æ ‡å‡†åº“ï¼Œæ—¨åœ¨è§£å†³å¾ªç¯å¼•ç”¨ã€‚</li></ul></li></ul><h2 id="3-æ ‡è®°é˜¶æ®µ-å¯è¾¾æ€§åˆ†æç®—æ³•">3-æ ‡è®°é˜¶æ®µ: å¯è¾¾æ€§åˆ†æç®—æ³•</h2><blockquote><p>æ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†</p></blockquote><ul><li>ç›¸å¯¹äºå¼•ç”¨è®¡æ•°ç®—æ³•è€Œè¨€ï¼Œå¯è¾¾æ€§åˆ†æç®—æ³•ä¸ä»…åŒæ ·å…·å¤‡å®ç°ç®€å•å’Œæ‰§è¡Œé«˜æ•ˆç­‰ç‰¹ç‚¹ï¼Œæ›´é‡è¦çš„æ˜¯è¯¥ç®—æ³•å¯ä»¥æœ‰æ•ˆåœ°<strong>è§£å†³åœ¨å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼çš„å‘ç”Ÿ</strong>ã€‚</li><li>ç›¸è¾ƒäºå¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œè¿™é‡Œçš„å¯è¾¾æ€§åˆ†æå°±æ˜¯ Javaã€C# é€‰æ‹©çš„ã€‚è¿™ç§ç±»å‹çš„åƒåœ¾æ”¶é›†é€šå¸¸ä¹Ÿå«ä½œ<strong>è¿½è¸ªæ€§åƒåœ¾æ”¶é›†</strong>ï¼ˆTracing Garbage Collectionï¼‰</li></ul><h3 id="å®ç°æ€è·¯">å®ç°æ€è·¯</h3><ul><li>æ‰€è°“&quot;GCRoots&quot;æ ¹é›†åˆå°±æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨</li><li>å…¶åŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š</li></ul><ol><li>å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä»¥æ ¹å¯¹è±¡é›†åˆï¼ˆGCRootsï¼‰ä¸ºèµ·å§‹ç‚¹ï¼ŒæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„æ–¹å¼<strong>æœç´¢è¢«æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„ç›®æ ‡å¯¹è±¡æ˜¯å¦å¯è¾¾ã€‚</strong></li><li>ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åï¼Œå†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡éƒ½ä¼šè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–é—´æ¥è¿æ¥ç€ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸º<strong>å¼•ç”¨é“¾</strong>ï¼ˆReference Chainï¼‰</li><li>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™æ˜¯ä¸å¯è¾¾çš„ï¼Œå°±æ„å‘³ç€è¯¥å¯¹è±¡å·±ç»æ­»äº¡ï¼Œå¯ä»¥æ ‡è®°ä¸ºåƒåœ¾å¯¹è±¡ã€‚</li><li>åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–è€…é—´æ¥è¿æ¥çš„å¯¹è±¡æ‰æ˜¯å­˜æ´»å¯¹è±¡ã€‚</li></ol><p><img src="./../jvm-sgg10/image-20231224193322411.png" alt=""></p><h3 id="GC-Roots">GC Roots</h3><p><strong>åœ¨ Java è¯­è¨€ä¸­, GC Roots åŒ…æ‹¬ä¸€ä¸‹å‡ ç±»å…ƒç´ (é¢è¯•)</strong></p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡<ul><li>æ¯”å¦‚ï¼šå„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚</li></ul></li><li>æœ¬åœ°æ–¹æ³•æ ˆå†… JNIï¼ˆé€šå¸¸è¯´çš„æœ¬åœ°æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡<ul><li>æ¯”å¦‚ï¼šJava ç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li></ul></li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡<ul><li>æ¯”å¦‚ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆStringTableï¼‰é‡Œçš„å¼•ç”¨</li></ul></li><li>æ‰€æœ‰è¢«åŒæ­¥é” synchronized æŒæœ‰çš„å¯¹è±¡</li><li>Java è™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ã€‚<ul><li>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„ Class å¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆå¦‚ï¼šNullPointerExceptionã€OutofMemoryErrorï¼‰ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li></ul></li><li>åæ˜  Java è™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„ JMXBeanã€JVMTI ä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</li></ul><p><img src="./../jvm-sgg10/image-20231225202329883.png" alt=""></p><ul><li>é™¤äº†è¿™äº›å›ºå®šçš„ GC Roots é›†åˆä»¥å¤–ï¼Œæ ¹æ®ç”¨æˆ·æ‰€é€‰ç”¨çš„åƒåœ¾æ”¶é›†å™¨ä»¥åŠå½“å‰å›æ”¶çš„å†…å­˜åŒºåŸŸä¸åŒï¼Œè¿˜å¯ä»¥æœ‰å…¶ä»–å¯¹è±¡&quot;ä¸´æ—¶æ€§&quot;åœ°åŠ å…¥ï¼Œå…±åŒæ„æˆå®Œæ•´ GC Roots é›†åˆã€‚æ¯”å¦‚ï¼š<strong>åˆ†ä»£æ”¶é›†</strong>å’Œå±€éƒ¨å›æ”¶ï¼ˆPartialGCï¼‰ã€‚<ul><li>å¦‚æœåªé’ˆå¯¹ Java å †ä¸­çš„æŸä¸€å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆæ¯”å¦‚ï¼šå…¸å‹çš„åªé’ˆå¯¹æ–°ç”Ÿä»£ï¼‰ï¼Œå¿…é¡»è€ƒè™‘åˆ°å†…å­˜åŒºåŸŸæ˜¯è™šæ‹Ÿæœºè‡ªå·±çš„å®ç°ç»†èŠ‚ï¼Œæ›´ä¸æ˜¯å­¤ç«‹å°é—­çš„ï¼Œè¿™ä¸ªåŒºåŸŸçš„å¯¹è±¡å®Œå…¨æœ‰å¯èƒ½è¢«å…¶ä»–åŒºåŸŸçš„å¯¹è±¡æ‰€å¼•ç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€å¹¶å°†å…³è”çš„åŒºåŸŸå¯¹è±¡ä¹ŸåŠ å…¥ GC Roots é›†åˆä¸­å»è€ƒè™‘ï¼Œæ‰èƒ½ä¿è¯å¯è¾¾æ€§åˆ†æçš„å‡†ç¡®æ€§ã€‚</li></ul></li></ul><h3 id="GC-Rootåˆ¤æ–­æŠ€å·§">GC Rootåˆ¤æ–­æŠ€å·§</h3><p>ç”±äº Root é‡‡ç”¨æ ˆæ–¹å¼å­˜æ”¾å˜é‡å’ŒæŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒä¿å­˜äº†å †å†…å­˜é‡Œé¢çš„å¯¹è±¡ï¼Œä½†æ˜¯è‡ªå·±åˆä¸å­˜æ”¾åœ¨å †å†…å­˜é‡Œé¢ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ª Rootã€‚</p><h3 id="æ³¨æ„">æ³¨æ„</h3><ul><li>å¦‚æœè¦ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å†…å­˜æ˜¯å¦å¯å›æ”¶ï¼Œé‚£ä¹ˆåˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œã€‚è¿™ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœçš„å‡†ç¡®æ€§å°±æ— æ³•ä¿è¯ã€‚</li><li>è¿™ç‚¹ä¹Ÿæ˜¯å¯¼è‡´ GC è¿›è¡Œæ—¶å¿…é¡»&quot;Stop The World&quot;çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚<ul><li>å³ä½¿æ˜¯å·ç§°ï¼ˆå‡ ä¹ï¼‰ä¸ä¼šå‘ç”Ÿåœé¡¿çš„ CMS æ”¶é›†å™¨ä¸­ï¼Œ<strong>æšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„</strong>ã€‚</li></ul></li></ul><h2 id="4-å¯¹è±¡çš„finalizationæœºåˆ¶">4-å¯¹è±¡çš„finalizationæœºåˆ¶</h2><ul><li><p>Java è¯­è¨€æä¾›äº†å¯¹è±¡ç»ˆæ­¢ï¼ˆfinalizationï¼‰æœºåˆ¶æ¥å…è®¸å¼€å‘äººå‘˜æä¾›<strong>å¯¹è±¡è¢«é”€æ¯ä¹‹å‰çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘</strong>ã€‚</p></li><li><p>å½“åƒåœ¾å›æ”¶å™¨å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå³ï¼šåƒåœ¾å›æ”¶æ­¤å¯¹è±¡ä¹‹å‰ï¼Œæ€»ä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ finalize() æ–¹æ³•ã€‚</p></li><li><p>finalize() æ–¹æ³•å…è®¸åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼Œ<strong>ç”¨äºåœ¨å¯¹è±¡è¢«å›æ”¶æ—¶è¿›è¡Œèµ„æºé‡Šæ”¾</strong>ã€‚é€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾å’Œæ¸…ç†çš„å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ã€å¥—æ¥å­—å’Œæ•°æ®åº“è¿æ¥ç­‰ã€‚</p></li></ul><p><strong>ä¸è¦ä¸»åŠ¨è°ƒç”¨finalize()</strong></p><ul><li><p>æ°¸è¿œä¸è¦ä¸»åŠ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œåº”è¯¥äº¤ç»™åƒåœ¾å›æ”¶æœºåˆ¶è°ƒç”¨ã€‚ç†ç”±åŒ…æ‹¬ä¸‹é¢ä¸‰ç‚¹ï¼š</p><ul><li><p>åœ¨ finalize() æ—¶å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡å¤æ´»ã€‚</p></li><li><p>finalize() æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ˜¯æ²¡æœ‰ä¿éšœçš„ï¼Œå®ƒå®Œå…¨ç”±GCçº¿ç¨‹å†³å®šï¼Œæç«¯æƒ…å†µä¸‹ï¼Œè‹¥ä¸å‘ç”Ÿ GCï¼Œåˆ™ finalize() æ–¹æ³•å°†æ²¡æœ‰æ‰§è¡Œæœºä¼šã€‚</p></li><li><p>ä¸€ä¸ªç³Ÿç³•çš„ finalize() ä¼šä¸¥é‡å½±å“ GC çš„æ€§èƒ½ã€‚æ¯”å¦‚ finalize æ˜¯ä¸ªæ­»å¾ªç¯</p></li></ul></li><li><p>ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œfinalize() æ–¹æ³•ä¸ C++ ä¸­çš„ææ„å‡½æ•°æ¯”è¾ƒç›¸ä¼¼ï¼Œä½†æ˜¯ Java é‡‡ç”¨çš„æ˜¯åŸºäºåƒåœ¾å›æ”¶å™¨çš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæ‰€ä»¥finalize() æ–¹æ³•åœ¨<strong>æœ¬è´¨ä¸Šä¸åŒäº C++ ä¸­çš„ææ„å‡½æ•°</strong>ã€‚</p></li><li><p>ç”±äº finalize() æ–¹æ³•çš„å­˜åœ¨, <strong>è™šæ‹Ÿæœºç§çš„å¯¹è±¡ä¸€èˆ¬å¤„äºä¸‰ç§å¯èƒ½çš„çŠ¶æ€</strong>, æ¥ä¸‹é¢</p></li></ul><h3 id="ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡">ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡?</h3><ul><li><p>å¦‚æœä»æ‰€æœ‰çš„æ ¹èŠ‚ç‚¹éƒ½æ— æ³•è®¿é—®åˆ°æŸä¸ªå¯¹è±¡ï¼Œè¯´æ˜å¯¹è±¡å·±ç»ä¸å†ä½¿ç”¨äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ­¤å¯¹è±¡éœ€è¦è¢«å›æ”¶ã€‚ä½†äº‹å®ä¸Šï¼Œä¹Ÿå¹¶éæ˜¯&quot;éæ­»ä¸å¯&quot;çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µã€‚<strong>ä¸€ä¸ªæ— æ³•è§¦åŠçš„å¯¹è±¡æœ‰å¯èƒ½åœ¨æŸä¸€ä¸ªæ¡ä»¶ä¸‹&quot;å¤æ´»&quot;è‡ªå·±</strong>ï¼Œå¦‚æœè¿™æ ·ï¼Œé‚£ä¹ˆå¯¹å®ƒç«‹å³è¿›è¡Œå›æ”¶å°±æ˜¯ä¸åˆç†çš„ã€‚ä¸ºæ­¤ï¼Œå®šä¹‰è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ã€‚å¦‚ä¸‹ï¼š(<em>é¢è¯•</em>)</p><ul><li><p><strong>å¯è§¦åŠçš„</strong>ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯ä»¥åˆ°è¾¾è¿™ä¸ªå¯¹è±¡ã€‚</p></li><li><p><strong>å¯å¤æ´»çš„</strong>ï¼šå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«é‡Šæ”¾ï¼Œä½†æ˜¯å¯¹è±¡æœ‰å¯èƒ½åœ¨ finalize() ä¸­å¤æ´»ã€‚</p></li><li><p><strong>ä¸å¯è§¦åŠçš„</strong>ï¼šå¯¹è±¡çš„ finalize() è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰å¤æ´»ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ä¸å¯è§¦åŠçŠ¶æ€ã€‚ä¸å¯è§¦åŠçš„å¯¹è±¡ä¸å¯èƒ½è¢«å¤æ´»ï¼Œ<strong>å› ä¸º finalize() åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</strong>ã€‚</p></li></ul></li><li><p>ä»¥ä¸Š 3 ç§çŠ¶æ€ä¸­ï¼Œæ˜¯ç”±äº finalize() æ–¹æ³•çš„å­˜åœ¨ï¼Œè¿›è¡Œçš„åŒºåˆ†ã€‚åªæœ‰åœ¨å¯¹è±¡ä¸å¯è§¦åŠæ—¶æ‰å¯ä»¥è¢«å›æ”¶ã€‚</p></li></ul><h3 id="å…·ä½“è¿‡ç¨‹">å…·ä½“è¿‡ç¨‹</h3><p>åˆ¤å®šä¸€ä¸ªå¯¹è±¡ objA æ˜¯å¦å¯å›æ”¶ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</p><ol><li>å¦‚æœå¯¹è±¡ objA åˆ° GC Roots æ²¡æœ‰å¼•ç”¨é“¾ï¼Œåˆ™è¿›è¡Œç¬¬ä¸€æ¬¡æ ‡è®°ã€‚</li><li>è¿›è¡Œç­›é€‰ï¼Œåˆ¤æ–­æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize() æ–¹æ³•<ol><li>å¦‚æœå¯¹è±¡ objA æ²¡æœ‰é‡å†™ finalize() æ–¹æ³•ï¼Œæˆ–è€… finalize() æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œåˆ™è™šæ‹Ÿæœºè§†ä¸º&quot;æ²¡æœ‰å¿…è¦æ‰§è¡Œ&quot;ï¼ŒobjA è¢«åˆ¤å®šä¸ºä¸å¯è§¦åŠçš„ã€‚</li><li>å¦‚æœå¯¹è±¡ objA é‡å†™äº† finalize() æ–¹æ³•ï¼Œä¸”è¿˜æœªæ‰§è¡Œè¿‡ï¼Œé‚£ä¹ˆ objA ä¼šè¢«æ’å…¥åˆ° F-Queue é˜Ÿåˆ—ä¸­ï¼Œç”±ä¸€ä¸ªè™šæ‹Ÿæœºè‡ªåŠ¨åˆ›å»ºçš„ã€ä½ä¼˜å…ˆçº§çš„ Finalizer çº¿ç¨‹è§¦å‘å…¶ finalize()æ–¹æ³•æ‰§è¡Œã€‚</li><li><strong>finalize() æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡çš„æœ€åæœºä¼š</strong>ï¼Œç¨å GC ä¼šå¯¹ F-Queue é˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ã€‚<em>å¦‚æœ objA åœ¨ finalize() æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†è”ç³»</em>ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶ï¼ŒobjA ä¼šè¢«ç§»å‡º&quot;å³å°†å›æ”¶&quot;é›†åˆã€‚ä¹‹åï¼Œå¯¹è±¡ä¼šå†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œfinalize() æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œå¯¹è±¡ä¼šç›´æ¥å˜æˆä¸å¯è§¦åŠçš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¯¹è±¡çš„ finalize() æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li></ol></li></ol><p><strong>demo</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CanReliveObj</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CanReliveObj</span> obj<span class="token punctuation">;</span><span class="token comment">//ç±»å˜é‡ï¼Œå±äº GC Root</span>    <span class="token comment">//æ­¤æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨å½“å‰ç±»é‡å†™çš„finalize()æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token comment">//å½“å‰å¾…å›æ”¶çš„å¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä¸€ä¸ªå¯¹è±¡objå»ºç«‹äº†è”ç³»</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanReliveObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¯¹è±¡ç¬¬ä¸€æ¬¡æˆåŠŸæ‹¯æ•‘è‡ªå·±</span>            obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨åƒåœ¾å›æ”¶å™¨</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¬¬1æ¬¡ gc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å› ä¸ºFinalizerçº¿ç¨‹ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ2ç§’ï¼Œä»¥ç­‰å¾…å®ƒ</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj is dead"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj is still alive"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¬¬2æ¬¡ gc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ä¸‹é¢è¿™æ®µä»£ç ä¸ä¸Šé¢çš„å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯è¿™æ¬¡è‡ªæ•‘å´å¤±è´¥äº†</span>            obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å› ä¸ºFinalizerçº¿ç¨‹ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ2ç§’ï¼Œä»¥ç­‰å¾…å®ƒ</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj is dead"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj is still alive"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-MATä¸JProfilerçš„GC-Rootsæº¯æº">5-MATä¸JProfilerçš„GC Rootsæº¯æº</h2><p>å®˜ç½‘: <a href="http://www.eclipse.org/mat/">http://www.eclipse.org/mat/</a></p><ul><li>MAT æ˜¯ Memory Analyzer çš„ç®€ç§°ï¼Œå®ƒæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ Java å †å†…å­˜åˆ†æå™¨ã€‚ç”¨äºæŸ¥æ‰¾å†…å­˜æ³„æ¼ä»¥åŠæŸ¥çœ‹å†…å­˜æ¶ˆè€—æƒ…å†µã€‚</li><li>MAT æ˜¯åŸºäº Eclipse å¼€å‘çš„ï¼Œæ˜¯ä¸€æ¬¾å…è´¹çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚</li></ul><h3 id="è·å–-dump-æ–‡ä»¶æ–¹å¼">è·å– dump æ–‡ä»¶æ–¹å¼</h3><p><strong>æ–¹å¼ä¸€: å‘½ä»¤è¡Œä½¿ç”¨ jmap</strong></p><p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨ JVisualVM</strong></p><ul><li>æ•è·çš„ heap dump æ–‡ä»¶æ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå…³é—­ JVisualVM åè‡ªåŠ¨åˆ é™¤ï¼Œè‹¥è¦ä¿ç•™ï¼Œéœ€è¦å°†å…¶å¦å­˜ä¸ºæ–‡ä»¶ã€‚å¯é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ•è·heap dumpï¼š</li><li>ä½¿ç”¨MATæ‰“å¼€</li></ul><h3 id="JProfiler-GC-Rootsæº¯æº">JProfiler GC Rootsæº¯æº</h3><p>ç•¥</p><h3 id="Jprofiler-åˆ†æ-OOM">Jprofiler åˆ†æ OOM</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Jprofileråˆ†æOOM demo * -Xms8m -Xmx8m -XX:+HeapDumpOnOutOfMemoryError  è¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯å½“ç¨‹åºå‡ºç°OOMçš„æ—¶å€™å°±ä¼šåœ¨å½“å‰å·¥ç¨‹ç›®å½•ç”Ÿæˆä¸€ä¸ªdumpæ–‡ä»¶ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOOM</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//1MB</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HeapOOM</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HeapOOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                count<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"count = "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-æ¸…é™¤é˜¶æ®µ-æ ‡è®°-æ¸…é™¤ç®—æ³•">6-æ¸…é™¤é˜¶æ®µ: æ ‡è®°-æ¸…é™¤ç®—æ³•</h2><p><strong>(Mark - Sweep)</strong></p><h3 id="åƒåœ¾æ¸…é™¤é˜¶æ®µ">åƒåœ¾æ¸…é™¤é˜¶æ®µ</h3><ul><li><p>å½“æˆåŠŸåŒºåˆ†å‡ºå†…å­˜ä¸­å­˜æ´»å¯¹è±¡å’Œæ­»äº¡å¯¹è±¡åï¼ŒGCæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œé‡Šæ”¾æ‰æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä»¥ä¾¿æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚</p></li><li><p>ç›®å‰åœ¨JVMä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‰ç§åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯</p><ul><li><p>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</p></li><li><p>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</p></li><li><p>æ ‡è®°-å‹ç¼©ç®—æ³•ï¼ˆMark-Compactï¼‰</p></li></ul></li></ul><p><strong>èƒŒæ™¯</strong></p><p>æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰æ˜¯ä¸€ç§éå¸¸åŸºç¡€å’Œå¸¸è§çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œè¯¥ç®—æ³•è¢« J.McCarthy ç­‰äººåœ¨1960å¹´æå‡ºå¹¶å¹¶åº”ç”¨äº Lisp è¯­è¨€ã€‚</p><p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p><p>å½“å †ä¸­çš„æœ‰æ•ˆå†…å­˜ç©ºé—´ï¼ˆavailable memoryï¼‰è¢«è€—å°½çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢æ•´ä¸ªç¨‹åºï¼ˆä¹Ÿè¢«ç§°ä¸ºstop the worldï¼‰ï¼Œç„¶åè¿›è¡Œä¸¤é¡¹å·¥ä½œï¼Œç¬¬ä¸€é¡¹åˆ™æ˜¯æ ‡è®°ï¼Œç¬¬äºŒé¡¹åˆ™æ˜¯æ¸…é™¤</p><ul><li><p>æ ‡è®°ï¼šCollector ä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„ Header ä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ã€‚</p><ul><li>æ³¨æ„ï¼šæ ‡è®°çš„æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å¯è¾¾å¯¹è±¡ï¼Œå¹¶éæ ‡è®°çš„æ˜¯å³å°†è¢«æ¸…é™¤çš„åƒåœ¾å¯¹è±¡</li></ul></li><li><p>æ¸…é™¤ï¼šCollector å¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§çš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡åœ¨å…¶ Header ä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™å°†å…¶å›æ”¶</p></li></ul><p><img src="./../jvm-sgg10/image-20231225221123465.png" alt=""></p><p><strong>ç¼ºç‚¹</strong></p><ul><li><p>æ•ˆç‡ä¸ç®—é«˜( éœ€è¦è¿›è¡Œ 2 æ¬¡éå†, ç¬¬äºŒæ¬¡æ˜¯å…¨è¡¨)</p></li><li><p>åœ¨è¿›è¡Œ GC çš„æ—¶å€™ï¼Œéœ€è¦åœæ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®</p></li><li><p>è¿™ç§æ–¹å¼æ¸…ç†å‡ºæ¥çš„ç©ºé—²å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œäº§ç”Ÿå†…ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨</p></li></ul><p><strong>æ³¨æ„ï¼šä½•ä¸ºæ¸…é™¤ï¼Ÿ</strong></p><p>è¿™é‡Œæ‰€è°“çš„æ¸…é™¤å¹¶ä¸æ˜¯çœŸçš„ç½®ç©ºï¼Œè€Œæ˜¯æŠŠéœ€è¦æ¸…é™¤çš„å¯¹è±¡åœ°å€ä¿å­˜åœ¨ç©ºé—²çš„åœ°å€åˆ—è¡¨é‡Œã€‚ä¸‹æ¬¡æœ‰æ–°å¯¹è±¡éœ€è¦åŠ è½½æ—¶ï¼Œåˆ¤æ–­åƒåœ¾çš„ä½ç½®ç©ºé—´æ˜¯å¦å¤Ÿï¼Œå¦‚æœå¤Ÿï¼Œå°±å­˜æ”¾ï¼ˆä¹Ÿå°±æ˜¯è¦†ç›–åŸæœ‰çš„åœ°å€ï¼‰ã€‚</p><p>å…³äºç©ºé—²åˆ—è¡¨æ˜¯åœ¨ä¸ºå¯¹è±¡åˆ†é…å†…å­˜çš„æ—¶å€™æè¿‡ï¼š(<a href="/2023/12/21/jvm-sgg7/#1-å¯¹è±¡çš„å®ä¾‹åŒ–">é“¾æ¥</a>)</p><ol><li>å¦‚æœå†…å­˜è§„æ•´<ul><li>é‡‡ç”¨æŒ‡é’ˆç¢°æ’çš„æ–¹å¼è¿›è¡Œå†…å­˜åˆ†é…</li></ul></li><li>å¦‚æœå†…å­˜ä¸è§„æ•´<ul><li>è™šæ‹Ÿæœºéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨</li><li>é‡‡ç”¨ç©ºé—²åˆ—è¡¨åˆ†é…å†…å­˜</li></ul></li></ol><h2 id="7-æ¸…é™¤é˜¶æ®µ-å¤åˆ¶ç®—æ³•">7-æ¸…é™¤é˜¶æ®µ: å¤åˆ¶ç®—æ³•</h2><p><strong>(Copying)</strong></p><p><strong>èƒŒæ™¯</strong></p><p>ä¸ºäº†è§£å†³æ ‡è®°-æ¸…é™¤ç®—æ³•åœ¨åƒåœ¾æ”¶é›†æ•ˆç‡æ–¹é¢çš„ç¼ºé™·ï¼ŒM.L.Minsky äº1963å¹´å‘è¡¨äº†è‘—åçš„è®ºæ–‡ï¼Œâ€œä½¿ç”¨åŒå­˜å‚¨åŒºçš„Lispè¯­è¨€åƒåœ¾æ”¶é›†å™¨CA LISP Garbage Collector Algorithm Using Serial Secondary Storageï¼‰â€ã€‚M.L.Minsky åœ¨è¯¥è®ºæ–‡ä¸­æè¿°çš„ç®—æ³•è¢«äººä»¬ç§°ä¸ºå¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•ï¼Œå®ƒä¹Ÿè¢« M.L.Minsky æœ¬äººæˆåŠŸåœ°å¼•å…¥åˆ°äº†  Lisp è¯­è¨€çš„ä¸€ä¸ªå®ç°ç‰ˆæœ¬ä¸­ã€‚</p><p><strong>æ ¸å¿ƒæ€æƒ³</strong></p><p>å°†æ´»ç€çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶å°†æ­£åœ¨ä½¿ç”¨çš„å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œä¹‹åæ¸…é™¤æ­£åœ¨ä½¿ç”¨çš„å†…å­˜å—ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜çš„è§’è‰²ï¼Œæœ€åå®Œæˆåƒåœ¾å›æ”¶</p><p><img src="./../jvm-sgg10/image-20231225221827337.png" alt=""></p><p>æ–°ç”Ÿä»£é‡Œé¢å°±ç”¨åˆ°äº†å¤åˆ¶ç®—æ³•ï¼ŒEdenåŒºå’ŒS0åŒºå­˜æ´»å¯¹è±¡æ•´ä½“å¤åˆ¶åˆ°S1åŒº</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆ</li><li>å¤åˆ¶è¿‡å»ä»¥åä¿è¯ç©ºé—´çš„è¿ç»­æ€§ï¼Œä¸ä¼šå‡ºç°â€œç¢ç‰‡â€é—®é¢˜ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>æ­¤ç®—æ³•çš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå°±æ˜¯éœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€‚</li><li>å¯¹äº G1 è¿™ç§åˆ†æ‹†æˆä¸ºå¤§é‡ region çš„ GCï¼Œå¤åˆ¶è€Œä¸æ˜¯ç§»åŠ¨ï¼Œæ„å‘³ç€ GC éœ€è¦ç»´æŠ¤ region ä¹‹é—´å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œä¸ç®¡æ˜¯å†…å­˜å ç”¨æˆ–è€…æ—¶é—´å¼€é”€ä¹Ÿä¸å°(<a href="/2023/12/21/jvm-sgg7/#3-å¯¹è±¡çš„è®¿é—®å®šä½">é“¾æ¥</a>&gt;)</li></ul><p><strong>ç‰¹åˆ«çš„(åº”ç”¨åœºæ™¯)</strong></p><ul><li>å¦‚æœç³»ç»Ÿä¸­çš„åƒåœ¾å¯¹è±¡å¾ˆå¤š. å¤åˆ¶ç®—æ³•éœ€è¦å¤åˆ¶çš„å­˜æ´»å¯¹è±¡æ•°é‡å¹¶ä¸ä¼šå¤ªå¤§ï¼Œæˆ–è€…è¯´éå¸¸ä½æ‰è¡Œ</li><li>è€å¹´ä»£å¤§é‡çš„å¯¹è±¡å­˜æ´»ï¼Œé‚£ä¹ˆå¤åˆ¶çš„å¯¹è±¡å°†ä¼šæœ‰å¾ˆå¤šï¼Œæ•ˆç‡ä¼šå¾ˆä½</li><li>åœ¨æ–°ç”Ÿä»£ï¼Œå¯¹å¸¸è§„åº”ç”¨çš„åƒåœ¾å›æ”¶ï¼Œä¸€æ¬¡é€šå¸¸å¯ä»¥å›æ”¶ 70% - 99%  çš„å†…å­˜ç©ºé—´ã€‚å›æ”¶æ€§ä»·æ¯”å¾ˆé«˜ã€‚æ‰€ä»¥ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½æ˜¯ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ã€‚</li></ul><p><img src="./../jvm-sgg10/image-20231225222857467.png" alt=""></p><h2 id="8-æ¸…é™¤é˜¶æ®µ-æ ‡è®°-å‹ç¼©ç®—æ³•">8-æ¸…é™¤é˜¶æ®µ: æ ‡è®°-å‹ç¼©ç®—æ³•</h2><p><strong>ï¼ˆæ ‡è®°-æ•´ç†ã€Mark - Compactï¼‰</strong></p><p><strong>èƒŒæ™¯</strong></p><ul><li><p>å¤åˆ¶ç®—æ³•çš„é«˜æ•ˆæ€§æ˜¯å»ºç«‹åœ¨å­˜æ´»å¯¹è±¡å°‘ã€åƒåœ¾å¯¹è±¡å¤šçš„å‰æä¸‹çš„ã€‚è¿™ç§æƒ…å†µåœ¨æ–°ç”Ÿä»£ç»å¸¸å‘ç”Ÿï¼Œä½†æ˜¯åœ¨è€å¹´ä»£ï¼Œæ›´å¸¸è§çš„æƒ…å†µæ˜¯å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯å­˜æ´»å¯¹è±¡ã€‚å¦‚æœä¾ç„¶ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œç”±äºå­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå¤åˆ¶çš„æˆæœ¬ä¹Ÿå°†å¾ˆé«˜ã€‚å› æ­¤ï¼Œ<strong>åŸºäºè€å¹´ä»£åƒåœ¾å›æ”¶çš„ç‰¹æ€§ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„ç®—æ³•ã€‚</strong></p></li><li><p>æ ‡è®°-æ¸…é™¤ç®—æ³•çš„ç¡®å¯ä»¥åº”ç”¨åœ¨è€å¹´ä»£ä¸­ï¼Œä½†æ˜¯è¯¥ç®—æ³•ä¸ä»…æ‰§è¡Œæ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”åœ¨æ‰§è¡Œå®Œå†…å­˜å›æ”¶åè¿˜ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥ JVM çš„è®¾è®¡è€…éœ€è¦åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ”¹è¿›ã€‚æ ‡è®°-å‹ç¼©ï¼ˆMark-Compactï¼‰ç®—æ³•ç”±æ­¤è¯ç”Ÿã€‚</p></li><li><p>1970 å¹´å‰åï¼ŒG.L.Steeleã€C.J.Chene å’Œ D.s.Wise ç­‰ç ”ç©¶è€…å‘å¸ƒæ ‡è®°-å‹ç¼©ç®—æ³•ã€‚åœ¨è®¸å¤šç°ä»£çš„åƒåœ¾æ”¶é›†å™¨ä¸­ï¼Œäººä»¬éƒ½ä½¿ç”¨äº†æ ‡è®°-å‹ç¼©ç®—æ³•æˆ–å…¶æ”¹è¿›ç‰ˆæœ¬ã€‚</p></li></ul><p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p><ul><li>ç¬¬ä¸€é˜¶æ®µå’Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨å¯¹è±¡</li><li>ç¬¬äºŒé˜¶æ®µå°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰é¡ºåºæ’æ”¾ã€‚</li><li>ä¹‹åï¼Œæ¸…ç†è¾¹ç•Œå¤–æ‰€æœ‰çš„ç©ºé—´ã€‚</li></ul><p><img src="./../jvm-sgg10/image-20231225223121910.png" alt=""></p><p><strong>æ ‡è®°-å‹ç¼©ç®—æ³• <em>VS</em> æ ‡è®°-æ¸…é™¤ç®—æ³•</strong></p><ul><li><p>æ ‡è®°-å‹ç¼©ç®—æ³•çš„æœ€ç»ˆæ•ˆæœç­‰åŒäºæ ‡è®°-æ¸…é™¤ç®—æ³•æ‰§è¡Œå®Œæˆåï¼Œå†è¿›è¡Œä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç§°ä¸º<strong>æ ‡è®°-æ¸…é™¤-å‹ç¼©ï¼ˆMark-Sweep-Compactï¼‰ç®—æ³•</strong>ã€‚</p></li><li><p>äºŒè€…çš„æœ¬è´¨å·®å¼‚åœ¨äºæ ‡è®°-æ¸…é™¤ç®—æ³•æ˜¯ä¸€ç§<strong>éç§»åŠ¨å¼çš„å›æ”¶ç®—æ³•</strong>ï¼Œæ ‡è®°-å‹ç¼©æ˜¯<strong>ç§»åŠ¨å¼çš„</strong>ã€‚æ˜¯å¦ç§»åŠ¨å›æ”¶åçš„å­˜æ´»å¯¹è±¡æ˜¯ä¸€é¡¹ä¼˜ç¼ºç‚¹å¹¶å­˜çš„é£é™©å†³ç­–ã€‚</p></li><li><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ‡è®°çš„å­˜æ´»å¯¹è±¡å°†ä¼šè¢«æ•´ç†ï¼ŒæŒ‰ç…§å†…å­˜åœ°å€ä¾æ¬¡æ’åˆ—ï¼Œè€Œæœªè¢«æ ‡è®°çš„å†…å­˜ä¼šè¢«æ¸…ç†æ‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVM åªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ï¼Œè¿™æ¯”ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨æ˜¾ç„¶å°‘äº†è®¸å¤šå¼€é”€ã€‚</p></li></ul><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æ¶ˆé™¤äº†æ ‡è®°-æ¸…é™¤ç®—æ³•å½“ä¸­ï¼Œå†…å­˜åŒºåŸŸåˆ†æ•£çš„ç¼ºç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVM åªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ã€‚</li><li>æ¶ˆé™¤äº†å¤åˆ¶ç®—æ³•å½“ä¸­ï¼Œå†…å­˜å‡åŠçš„é«˜é¢ä»£ä»·ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>ä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•è¦ä½äºå¤åˆ¶ç®—æ³•ã€‚</li><li>ç§»åŠ¨å¯¹è±¡çš„åŒæ—¶ï¼Œå¦‚æœå¯¹è±¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œåˆ™è¿˜éœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ï¼ˆå› ä¸º HotSpot è™šæ‹Ÿæœºé‡‡ç”¨çš„ä¸æ˜¯å¥æŸ„æ± çš„æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥æŒ‡é’ˆï¼‰</li><li>ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å…¨ç¨‹æš‚åœç”¨æˆ·åº”ç”¨ç¨‹åºã€‚å³ï¼šSTW</li></ul><h2 id="9-åƒåœ¾æ¸…é™¤é˜¶æ®µå°ç»“">9-åƒåœ¾æ¸…é™¤é˜¶æ®µå°ç»“</h2><h3 id="å¯¹æ¯”ä¸‰ç§ç®—æ³•">å¯¹æ¯”ä¸‰ç§ç®—æ³•</h3><table><thead><tr><th></th><th>Mark-Sweep</th><th>Mark-Compact</th><th>Copying</th></tr></thead><tbody><tr><td><strong>é€Ÿç‡</strong></td><td>ä¸­ç­‰</td><td>æœ€æ…¢</td><td>æœ€å¿«</td></tr><tr><td><strong>ç©ºé—´å¼€é”€</strong></td><td>å°‘ï¼ˆä½†ä¼šå †ç§¯ç¢ç‰‡ï¼‰</td><td>å°‘ï¼ˆä¸å †ç§¯ç¢ç‰‡ï¼‰</td><td>é€šå¸¸éœ€è¦æ´»å¯¹è±¡çš„2å€ç©ºé—´ï¼ˆä¸å †ç§¯ç¢ç‰‡ï¼‰</td></tr><tr><td><strong>ç§»åŠ¨å¯¹è±¡</strong></td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table><ul><li>æ•ˆç‡ä¸Šæ¥è¯´ï¼Œå¤åˆ¶ç®—æ³•æ˜¯å½“ä¹‹æ— æ„§çš„è€å¤§ï¼Œä½†æ˜¯å´æµªè´¹äº†å¤ªå¤šå†…å­˜ã€‚</li><li>è€Œä¸ºäº†å°½é‡å…¼é¡¾ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼Œ<em>æ ‡è®°-æ•´ç†ç®—æ³•</em>ç›¸å¯¹æ¥è¯´æ›´å¹³æ»‘ä¸€äº›ï¼Œä½†æ˜¯æ•ˆç‡ä¸Šä¸å°½å¦‚äººæ„ï¼Œå®ƒæ¯”<em>å¤åˆ¶ç®—æ³•</em>å¤šäº†ä¸€ä¸ªæ ‡è®°çš„é˜¶æ®µï¼Œæ¯”<em>æ ‡è®°-æ¸…é™¤</em>å¤šäº†ä¸€ä¸ªæ•´ç†å†…å­˜çš„é˜¶æ®µã€‚</li></ul><h2 id="10-åˆ†ä»£æ”¶é›†ç®—æ³•">10-åˆ†ä»£æ”¶é›†ç®—æ³•</h2><ul><li><p>å‰é¢æ‰€æœ‰è¿™äº›ç®—æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸€ç§ç®—æ³•å¯ä»¥å®Œå…¨æ›¿ä»£å…¶ä»–ç®—æ³•ï¼Œå®ƒä»¬éƒ½å…·æœ‰è‡ªå·±ç‹¬ç‰¹çš„ä¼˜åŠ¿å’Œç‰¹ç‚¹ã€‚åˆ†ä»£æ”¶é›†ç®—æ³•åº”è¿è€Œç”Ÿã€‚</p></li><li><p>åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼š**ä¸åŒçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¯ä»¥é‡‡å–ä¸åŒçš„æ”¶é›†æ–¹å¼ï¼Œä»¥ä¾¿æé«˜å›æ”¶æ•ˆç‡ã€‚**ä¸€èˆ¬æ˜¯æŠŠ Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•ï¼Œä»¥æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚</p></li><li><p>åœ¨Javaç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„å¯¹è±¡ï¼Œå…¶ä¸­æœ‰äº›å¯¹è±¡æ˜¯ä¸ä¸šåŠ¡ä¿¡æ¯ç›¸å…³:</p><ul><li>æ¯”å¦‚<strong>Http è¯·æ±‚ä¸­çš„ Session å¯¹è±¡ã€çº¿ç¨‹ã€Socket è¿æ¥</strong>ï¼Œè¿™ç±»å¯¹è±¡è·Ÿä¸šåŠ¡ç›´æ¥æŒ‚é’©ï¼Œå› æ­¤ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿ã€‚</li><li>ä½†æ˜¯è¿˜æœ‰ä¸€äº›å¯¹è±¡ï¼Œä¸»è¦æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶å˜é‡ï¼Œè¿™äº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¼šæ¯”è¾ƒçŸ­ï¼Œæ¯”å¦‚ï¼š<strong>String å¯¹è±¡</strong>ï¼Œç”±äºå…¶ä¸å˜ç±»çš„ç‰¹æ€§ï¼Œç³»ç»Ÿä¼šäº§ç”Ÿå¤§é‡çš„è¿™äº›å¯¹è±¡ï¼Œæœ‰äº›å¯¹è±¡ç”šè‡³åªç”¨ä¸€æ¬¡å³å¯å›æ”¶ã€‚</li></ul></li></ul><p><strong>ç›®å‰å‡ ä¹æ‰€æœ‰çš„ GC éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†(Generational Collecting)ç®—æ³•æ‰§è¡Œåƒåœ¾å›æ”¶çš„</strong></p><p><strong>å¹´è½»ä»£ï¼ˆYoung Genï¼‰</strong></p><ul><li>å¹´è½»ä»£ç‰¹ç‚¹ï¼šåŒºåŸŸç›¸å¯¹è€å¹´ä»£è¾ƒå°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ã€å­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ã€‚</li><li>è¿™ç§æƒ…å†µå¤åˆ¶ç®—æ³•çš„å›æ”¶æ•´ç†ï¼Œé€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚å¤åˆ¶ç®—æ³•çš„æ•ˆç‡åªå’Œå½“å‰å­˜æ´»å¯¹è±¡å¤§å°æœ‰å…³ï¼Œå› æ­¤å¾ˆé€‚ç”¨äºå¹´è½»ä»£çš„å›æ”¶ã€‚è€Œå¤åˆ¶ç®—æ³•å†…å­˜åˆ©ç”¨ç‡ä¸é«˜çš„é—®é¢˜ï¼Œé€šè¿‡ hotspot ä¸­çš„ä¸¤ä¸ª survivor çš„è®¾è®¡å¾—åˆ°ç¼“è§£ã€‚</li></ul><p><strong>è€å¹´ä»£ï¼ˆTenured Genï¼‰</strong></p><ul><li>è€å¹´ä»£ç‰¹ç‚¹ï¼šåŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ã€å­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠå¹´è½»ä»£é¢‘ç¹ã€‚</li><li>è¿™ç§æƒ…å†µå­˜åœ¨å¤§é‡å­˜æ´»ç‡é«˜çš„å¯¹è±¡ï¼Œå¤åˆ¶ç®—æ³•æ˜æ˜¾å˜å¾—ä¸åˆé€‚ã€‚ä¸€èˆ¬æ˜¯ç”±æ ‡è®°-æ¸…é™¤æˆ–è€…æ˜¯æ ‡è®°-æ¸…é™¤ä¸æ ‡è®°-æ•´ç†çš„æ··åˆå®ç°ã€‚<ul><li><p>Mark é˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°é‡æˆæ­£æ¯”ã€‚</p></li><li><p>Sweep é˜¶æ®µçš„å¼€é”€ä¸æ‰€ç®¡ç†åŒºåŸŸçš„å¤§å°æˆæ­£ç›¸å…³ã€‚</p></li><li><p>Compact é˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°æ®æˆæ­£æ¯”ã€‚</p></li></ul></li></ul><p><strong>ä»¥HotSpotä¸­çš„CMSå›æ”¶å™¨ä¸ºä¾‹</strong></p><ul><li>CMS æ˜¯åŸºäº Mark-Sweep å®ç°çš„ï¼Œå¯¹äºå¯¹è±¡çš„å›æ”¶æ•ˆç‡å¾ˆé«˜ã€‚å¯¹äºç¢ç‰‡é—®é¢˜ï¼ŒCMS é‡‡ç”¨åŸºäº Mark-Compact ç®—æ³•çš„ Serial Old å›æ”¶å™¨ä½œä¸ºè¡¥å¿æªæ–½ï¼šå½“å†…å­˜å›æ”¶ä¸ä½³ï¼ˆç¢ç‰‡å¯¼è‡´çš„ Concurrent Mode Failure æ—¶ï¼‰ï¼Œå°†é‡‡ç”¨ Serial Old æ‰§è¡Œ Full GC ä»¥è¾¾åˆ°å¯¹è€å¹´ä»£å†…å­˜çš„æ•´ç†ã€‚</li><li>åˆ†ä»£çš„æ€æƒ³è¢«ç°æœ‰çš„è™šæ‹Ÿæœºå¹¿æ³›ä½¿ç”¨ã€‚å‡ ä¹æ‰€æœ‰çš„åƒåœ¾å›æ”¶å™¨éƒ½åŒºåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£</li></ul><h2 id="11-å¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•">11-å¢é‡æ”¶é›†ç®—æ³•ã€åˆ†åŒºç®—æ³•</h2><h3 id="å¢é‡æ”¶é›†ç®—æ³•">å¢é‡æ”¶é›†ç®—æ³•</h3><p>ä¸Šè¿°ç°æœ‰çš„ç®—æ³•ï¼Œåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è½¯ä»¶å°†å¤„äºä¸€ç§ Stop the World çš„çŠ¶æ€ã€‚åœ¨<strong>Stop the World</strong>çŠ¶æ€ä¸‹ï¼Œåº”ç”¨ç¨‹åºæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šæŒ‚èµ·ï¼Œæš‚åœä¸€åˆ‡æ­£å¸¸çš„å·¥ä½œï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆã€‚å¦‚æœåƒåœ¾å›æ”¶æ—¶é—´è¿‡é•¿ï¼Œåº”ç”¨ç¨‹åºä¼šè¢«æŒ‚èµ·å¾ˆä¹…ï¼Œå°†ä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒæˆ–è€…ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³å¯¹å®æ—¶åƒåœ¾æ”¶é›†ç®—æ³•çš„ç ”ç©¶ç›´æ¥å¯¼è‡´äº†å¢é‡æ”¶é›†ï¼ˆIncremental Collectingï¼‰ç®—æ³•çš„è¯ç”Ÿã€‚</p><p><strong>åŸºæœ¬æ€æƒ³</strong></p><ul><li>å¦‚æœä¸€æ¬¡æ€§å°†æ‰€æœ‰çš„åƒåœ¾è¿›è¡Œå¤„ç†ï¼Œéœ€è¦é€ æˆç³»ç»Ÿé•¿æ—¶é—´çš„åœé¡¿ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®©åƒåœ¾æ”¶é›†çº¿ç¨‹å’Œåº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿æ‰§è¡Œã€‚<strong>æ¯æ¬¡ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹åªæ”¶é›†ä¸€å°ç‰‡åŒºåŸŸçš„å†…å­˜ç©ºé—´ï¼Œæ¥ç€åˆ‡æ¢åˆ°åº”ç”¨ç¨‹åºçº¿ç¨‹ã€‚ä¾æ¬¡åå¤ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚</strong></li><li>æ€»çš„æ¥è¯´ï¼Œå¢é‡æ”¶é›†ç®—æ³•çš„åŸºç¡€ä»æ˜¯ä¼ ç»Ÿçš„æ ‡è®°-æ¸…é™¤å’Œå¤åˆ¶ç®—æ³•ã€‚å¢é‡æ”¶é›†ç®—æ³•é€šè¿‡<strong>å¯¹çº¿ç¨‹é—´å†²çªçš„å¦¥å–„å¤„ç†ï¼Œå…è®¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä»¥åˆ†é˜¶æ®µçš„æ–¹å¼å®Œæˆæ ‡è®°ã€æ¸…ç†æˆ–å¤åˆ¶å·¥ä½œ</strong></li></ul><p><strong>ç¼ºç‚¹</strong></p><p>ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç”±äºåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé—´æ–­æ€§åœ°è¿˜æ‰§è¡Œäº†åº”ç”¨ç¨‹åºä»£ç ï¼Œæ‰€ä»¥èƒ½å‡å°‘ç³»ç»Ÿçš„åœé¡¿æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå› ä¸ºçº¿ç¨‹åˆ‡æ¢å’Œä¸Šä¸‹æ–‡è½¬æ¢çš„æ¶ˆè€—ï¼Œä¼šä½¿å¾—åƒåœ¾å›æ”¶çš„æ€»ä½“æˆæœ¬ä¸Šå‡ï¼Œ<strong>é€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™</strong>ã€‚</p><h3 id="åˆ†åŒºç®—æ³•">åˆ†åŒºç®—æ³•</h3><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç›¸åŒæ¡ä»¶ä¸‹ï¼Œå †ç©ºé—´è¶Šå¤§ï¼Œä¸€æ¬¡ GC æ—¶æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œæœ‰å…³ GC äº§ç”Ÿçš„åœé¡¿ä¹Ÿè¶Šé•¿ã€‚ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶ GC äº§ç”Ÿçš„åœé¡¿æ—¶é—´ï¼Œå°†ä¸€å—å¤§çš„å†…å­˜åŒºåŸŸåˆ†å‰²æˆå¤šä¸ªå°å—ï¼Œæ ¹æ®ç›®æ ‡çš„åœé¡¿æ—¶é—´ï¼Œæ¯æ¬¡åˆç†åœ°å›æ”¶è‹¥å¹²ä¸ªå°åŒºé—´ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå †ç©ºé—´ï¼Œä»è€Œå‡å°‘ä¸€æ¬¡ GC æ‰€äº§ç”Ÿçš„åœé¡¿ã€‚</li><li>åˆ†ä»£ç®—æ³•å°†æŒ‰ç…§å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé•¿çŸ­åˆ’åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åŒºç®—æ³•å°†æ•´ä¸ªå †ç©ºé—´åˆ’åˆ†æˆè¿ç»­çš„ä¸åŒå°åŒºé—´ã€‚</li><li>æ¯ä¸€ä¸ªå°åŒºé—´éƒ½ç‹¬ç«‹ä½¿ç”¨ï¼Œç‹¬ç«‹å›æ”¶ã€‚è¿™ç§ç®—æ³•çš„å¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ã€‚</li></ul><p><img src="./../jvm-sgg10/image-20231225225240658.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-09-StringTable</title>
      <link href="/2023/12/23/jvm-sgg9/"/>
      <url>/2023/12/23/jvm-sgg9/</url>
      
        <content type="html"><![CDATA[<h1>StringTable</h1><h2 id="1-Stringçš„åŸºæœ¬ç‰¹æ€§">1-Stringçš„åŸºæœ¬ç‰¹æ€§</h2><ul><li>Stringï¼šå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€å¯¹ â€œâ€ å¼•èµ·æ¥è¡¨ç¤º</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>  <span class="token comment">// å­—é¢é‡çš„å®šä¹‰æ–¹å¼</span><span class="token class-name">String</span> s2 <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// new å¯¹è±¡çš„æ–¹å¼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>String è¢«å£°æ˜ä¸º final çš„ï¼Œä¸å¯è¢«ç»§æ‰¿</li><li>String å®ç°äº† Serializable æ¥å£ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²æ˜¯æ”¯æŒåºåˆ—åŒ–çš„ã€‚å®ç°äº† Comparable æ¥å£ï¼šè¡¨ç¤º String å¯ä»¥æ¯”è¾ƒå¤§å°</li><li>String åœ¨ jdk8 åŠä»¥å‰å†…éƒ¨å®šä¹‰äº† <code>final char value[]</code> ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ã€‚JDK9 æ—¶æ”¹ä¸º <code>byte[]</code></li></ul><h3 id="Stringå­˜å‚¨ç»“æ„å˜æ›´">Stringå­˜å‚¨ç»“æ„å˜æ›´</h3><p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="http://openjdk.java.net/jeps/254">http://openjdk.java.net/jeps/254</a></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// &lt;=jdk8</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">char</span> value<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// >=jdk9</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>String ç±»çš„å½“å‰å®ç°å°†å­—ç¬¦å­˜å‚¨åœ¨ char æ•°ç»„ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚(16ä½)ã€‚</li><li>ä»è®¸å¤šä¸åŒçš„åº”ç”¨ç¨‹åºæ”¶é›†çš„æ•°æ®è¡¨æ˜ï¼Œå­—ç¬¦ä¸²æ˜¯å †ä½¿ç”¨çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œè€Œä¸”å¤§å¤šæ•°å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å«æ‹‰ä¸å­—ç¬¦ï¼ˆLatin-1ï¼‰ã€‚è¿™äº›å­—ç¬¦åªéœ€è¦ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å¯¹è±¡çš„å†…éƒ¨ char æ•°ç»„ä¸­æœ‰ä¸€åŠçš„ç©ºé—´å°†ä¸ä¼šä½¿ç”¨ï¼Œäº§ç”Ÿäº†å¤§é‡æµªè´¹ã€‚</li><li>ä¹‹å‰ String ç±»ä½¿ç”¨ UTF-16 çš„ char[] æ•°ç»„å­˜å‚¨ï¼Œç°åœ¨æ”¹ä¸º byte[] æ•°ç»„å¤–åŠ ä¸€ä¸ªç¼–ç æ ‡è¯†å­˜å‚¨ã€‚è¯¥ç¼–ç è¡¨ç¤ºå¦‚æœä½ çš„å­—ç¬¦æ˜¯ ISO-8859-1 æˆ–è€… Latin-1ï¼Œé‚£ä¹ˆåªéœ€è¦ä¸€ä¸ªå­—èŠ‚å­˜ã€‚å¦‚æœä½ æ˜¯å…¶å®ƒå­—ç¬¦é›†ï¼Œæ¯”å¦‚ UTF-8ï¼Œä½ ä»ç„¶ç”¨ä¸¤ä¸ªå­—èŠ‚å­˜</li></ul><p><strong>ç»“è®ºï¼š</strong></p><ul><li><p>String å†ä¹Ÿä¸ç”¨ char[] æ¥å­˜å‚¨äº†ï¼Œæ”¹æˆäº† byte [] åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´</p></li><li><p>åŒæ—¶åŸºäº String çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ StringBuffer å’Œ StringBuilder ä¹ŸåŒæ ·åšäº†ä¿®æ”¹</p></li></ul><h3 id="åŸºæœ¬ç‰¹æ€§">åŸºæœ¬ç‰¹æ€§</h3><p><strong>Stringï¼šä»£è¡¨ä¸å¯å˜çš„å­—ç¬¦åºåˆ—ã€‚ç®€ç§°ï¼šä¸å¯å˜æ€§ã€‚</strong></p><ul><li>å½“å¯¹å­—ç¬¦ä¸²é‡æ–°èµ‹å€¼æ—¶ï¼Œéœ€è¦é‡å†™æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span><span class="token comment">//å­—é¢é‡å®šä¹‰çš„æ–¹å¼ï¼Œ"abc"å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>    s1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ¤æ–­åœ°å€ï¼štrue  --> false</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abc</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å½“å¯¹ç°æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>    s2 <span class="token operator">+=</span> <span class="token string">"def"</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abcdef</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abc</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å½“è°ƒç”¨ String çš„ replace() æ–¹æ³•ä¿®æ”¹æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„ value è¿›è¡Œèµ‹å€¼ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token char">'m'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abc</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mbc</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é¢è¯•é¢˜</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringExer</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"good"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ch <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'t'</span><span class="token punctuation">,</span> <span class="token char">'e'</span><span class="token punctuation">,</span> <span class="token char">'s'</span><span class="token punctuation">,</span> <span class="token char">'t'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        str <span class="token operator">=</span> <span class="token string">"test ok"</span><span class="token punctuation">;</span>        ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'b'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">StringExer</span> ex<span class="token punctuation">;</span>        ex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringExer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ex<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>str<span class="token punctuation">,</span> ex<span class="token punctuation">.</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//good</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//best</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224125537544.png" alt="å­—èŠ‚ç "></p><p><img src="./../jvm-sgg9/image-20231224130452060.png" alt="castoreæ“ä½œè§„èŒƒ"></p><p>é€šè¿‡å­—èŠ‚ç å¯ä»¥çœ‹åˆ°, str æ—¶ä»…ä»…æ˜¯å½“å‰æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨ä¸­, å¹¶æ²¡æœ‰é’ˆå¯¹å¼•ç”¨æ•°æ®ç±»å‹åšä¿®æ”¹çš„åŠ¨ä½œ. è€Œæ•°ç»„åˆ™æ˜¯é‡‡ç”¨äº† <code>castore</code> æ“ä½œ(å…·ä½“ç»†èŠ‚è¯´æ˜ç»“åˆè§„èŒƒ), åˆ‡å®åœ°å¯¹å¼•ç”¨æ•°æ®ç±»åšæ“ä½œ.</p><p><strong>é€šè¿‡å­—é¢é‡çš„æ–¹å¼ï¼ˆåŒºåˆ«äºnewï¼‰ç»™ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²å€¼å£°æ˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚</strong></p><p><strong>å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²çš„</strong></p><ul><li>Stringçš„String Poolï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„Hashtableï¼Œé»˜è®¤å€¼å¤§å°é•¿åº¦æ˜¯ 1009ã€‚å¦‚æœæ”¾è¿› String Pool çš„ String éå¸¸å¤šï¼Œå°±ä¼šé€ æˆHashå†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´é“¾è¡¨ä¼šå¾ˆé•¿ï¼Œè€Œé“¾è¡¨é•¿äº†åç›´æ¥ä¼šé€ æˆçš„å½±å“å°±æ˜¯å½“è°ƒç”¨ String.intern() æ–¹æ³•æ—¶æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ã€‚</li><li>ä½¿ç”¨ <code>-XX:StringTablesize</code> å¯è®¾ç½® StringTable çš„é•¿åº¦</li><li>åœ¨ JDK6 ä¸­ StringTable æ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯ <strong>1009</strong> çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœå¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²è¿‡å¤šå°±ä¼šå¯¼è‡´æ•ˆç‡ä¸‹é™å¾ˆå¿«ï¼ŒStringTablesize è®¾ç½®æ²¡æœ‰è¦æ±‚</li><li>åœ¨ JDK7ä¸­ï¼ŒStringTable çš„é•¿åº¦é»˜è®¤å€¼æ˜¯ <strong>60013</strong>ï¼ŒStringTablesize è®¾ç½®æ²¡æœ‰è¦æ±‚</li><li>åœ¨ JDK8 ä¸­ï¼ŒStringTable çš„é•¿åº¦é»˜è®¤å€¼æ˜¯ 60013ï¼ŒStringTable å¯ä»¥è®¾ç½®çš„æœ€å°å€¼ä¸º 1009</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jps <span class="token comment">#æŸ¥çœ‹javaè¿›ç¨‹</span>jinfo <span class="token parameter variable">-flag</span> StringTableSize <span class="token number">5432</span> <span class="token comment">#æŸ¥çœ‹å¤§å°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="2-Stringçš„å†…å­˜åˆ†é…">2-Stringçš„å†…å­˜åˆ†é…</h2><ul><li><p>åœ¨ Java è¯­è¨€ä¸­æœ‰ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹Stringã€‚è¿™äº›ç±»å‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼Œéƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µã€‚</p></li><li><p>å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ª Java ç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ã€‚8 ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„ï¼Œ<strong>String ç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§</strong>ã€‚</p><ul><li><p>ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„ String å¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚</p><ul><li>æ¯”å¦‚ï¼š<code>String info=&quot;hello&quot;;</code></li></ul></li><li><p>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„ String å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ String æä¾›çš„ intern() æ–¹æ³•ã€‚è¿™ä¸ªåé¢é‡ç‚¹è°ˆ</p></li></ul></li><li><p>Java 6 åŠä»¥å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£</p></li><li><p>Java 7 ä¸­ Oracleçš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜ï¼Œå³å°†å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½ç½®è°ƒæ•´åˆ° Java å †å†…</p><ul><li>æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œå’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†ã€‚</li><li>å­—ç¬¦ä¸²å¸¸é‡æ± æ¦‚å¿µåŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨ Java 7 ä¸­ä½¿ç”¨ String.intern()ã€‚</li></ul></li><li><p>Java8 å…ƒç©ºé—´ï¼Œå­—ç¬¦ä¸²å¸¸é‡åœ¨å †</p></li></ul><p><img src="./../jvm-sgg9/image-20231224131222406.png" alt="JDK6 StringTableä½ç½®"></p><p><img src="./../jvm-sgg9/image-20231224131302224.png" alt="JDK7 StringTableä½ç½®"></p><p><strong>StringTableä¸ºä»€ä¹ˆè¦è°ƒæ•´?</strong></p><p><strong>å®˜æ–¹æ–‡æ¡£</strong>:<a href="https://www.oracle.com/java/technologies/javase/jdk7-relnotes.html#jdk7changes">https://www.oracle.com/java/technologies/javase/jdk7-relnotes.html#jdk7changes</a></p><ol><li><p>permSize é»˜è®¤æ¯”è¾ƒå°</p></li><li><p>æ°¸ä¹…ä»£åƒåœ¾å›æ”¶é¢‘ç‡ä½, å¤§é‡çš„å­—ç¬¦ä¸²æ— æ³•åŠæ—¶å›æ”¶å®¹æ˜“è¿›è¡Œ Full GC äº§ç”Ÿ STW æˆ–è€…å®¹æ˜“äº§ç”Ÿ OOM</p></li></ol><p><strong>å®ä¾‹demo</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * jdk6ä¸­ï¼š * -XX:PermSize=6m -XX:MaxPermSize=6m -Xms6m -Xmx6m * * jdk8ä¸­ï¼š * -XX:MetaspaceSize=6m -XX:MaxMetaspaceSize=6m -Xms6m -Xmx6m */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringTest3</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä½¿ç”¨Setä¿æŒç€å¸¸é‡æ± å¼•ç”¨ï¼Œé¿å…full gcå›æ”¶å¸¸é‡æ± è¡Œä¸º</span>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åœ¨shortå¯ä»¥å–å€¼çš„èŒƒå›´å†…è¶³ä»¥è®©6MBçš„PermSizeæˆ–heapäº§ç”ŸOOMäº†ã€‚</span>        <span class="token keyword">short</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>JKD8 æŠ¥é”™(ç”±æ­¤ä¹Ÿå¯è§ Java8 å…ƒç©ºé—´ï¼Œå­—ç¬¦ä¸²å¸¸é‡åœ¨å †)</p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">Exception in thread "main" java.lang.OutOfMemoryError: Java heap spaceat java.util.HashMap.resize(HashMap.java:703)at java.util.HashMap.putVal(HashMap.java:662)at java.util.HashMap.put(HashMap.java:611)at java.util.HashSet.add(HashSet.java:219)at com.atguigu.java.StringTest3.main(StringTest3.java:22)Process finished with exit code 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-Stringçš„åŸºæœ¬æ“ä½œ">3-Stringçš„åŸºæœ¬æ“ä½œ</h2><h3 id="demo1">demo1</h3><p>Java è¯­è¨€è§„èŒƒé‡Œè¦æ±‚å®Œå…¨ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œåº”è¯¥åŒ…å«åŒæ ·çš„ Unicode å­—ç¬¦åºåˆ—ï¼ˆåŒ…å«åŒä¸€ä»½ç ç‚¹åºåˆ—çš„å¸¸é‡ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯æŒ‡å‘åŒä¸€ä¸ª String å®ä¾‹ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringTest4</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„æ–­ç‚¹, è§‚å¯Ÿå†…å­˜ä¸­Stringæ•°é‡</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ­¤å¤„æ–­ç‚¹, è§‚å¯Ÿå†…å­˜ä¸­Stringæ•°é‡, åŠ äº†ä¸€ä¸ª, æœ‰ä¸€ä¸ªæ¢è¡Œç¬¦çš„å¢åŠ </span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ­¤å¤„æ–­ç‚¹, è§‚å¯Ÿå†…å­˜ä¸­Stringæ•°é‡, åŠ äº†ä¸€ä¸ª</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ­¤å¤„æ–­ç‚¹, è§‚å¯Ÿå†…å­˜ä¸­Stringæ•°é‡, ä¸"1"ç›¸æ¯”å¢åŠ äº†9ä¸ª, è¯´æ˜å¢åŠ äº†1-9çš„å­—ç¬¦ä¸²</span>        <span class="token comment">//å¦‚ä¸‹çš„å­—ç¬¦ä¸²"1" åˆ° "10"ä¸ä¼šå†æ¬¡åŠ è½½</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="demo2">demo2</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Memory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Memory</span> mem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mem<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> param<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> str <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224133754427.png" alt="å¼•ç”¨å›¾è§£"></p><h2 id="4-å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ">4-å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</h2><ol><li>å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</li><li>å¸¸é‡æ± ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒå†…å®¹çš„å˜é‡</li><li>æ‹¼æ¥å‰åï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­ã€‚å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯ StringBuilder</li><li>å¦‚æœæ‹¼æ¥çš„ç»“æœè°ƒç”¨ intern() æ–¹æ³•ï¼Œæ ¹æ®è¯¥å­—ç¬¦ä¸²æ˜¯å¦åœ¨å¸¸é‡æ± ä¸­å­˜åœ¨ï¼Œåˆ†ä¸ºï¼š<ul><li>å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²åœ¨å¸¸é‡æ± ä¸­çš„åœ°å€</li><li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä»½ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡çš„åœ°å€</li></ul></li></ol><h3 id="demo1-2">demo1</h3><p><strong>å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">+</span> <span class="token string">"b"</span> <span class="token operator">+</span> <span class="token string">"c"</span><span class="token punctuation">;</span><span class="token comment">//ç¼–è¯‘æœŸä¼˜åŒ–ï¼šç­‰åŒäº"abc"</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span> <span class="token comment">//"abc"ä¸€å®šæ˜¯æ”¾åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå°†æ­¤åœ°å€èµ‹ç»™s2</span>    <span class="token comment">/*         * æœ€ç»ˆ.javaç¼–è¯‘æˆ.class,å†æ‰§è¡Œ.class         * String s1 = "abc";         * String s2 = "abc"         */</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224135711521.png" alt="å­—èŠ‚ç "></p><h3 id="demo2-2">demo2</h3><p><strong>æ‹¼æ¥å‰åï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"javaEE"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">"javaEEhadoop"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"javaEE"</span> <span class="token operator">+</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span><span class="token comment">//ç¼–è¯‘æœŸä¼˜åŒ–</span>    <span class="token comment">//å¦‚æœæ‹¼æ¥ç¬¦å·çš„å‰åå‡ºç°äº†å˜é‡ï¼Œåˆ™ç›¸å½“äºåœ¨å †ç©ºé—´ä¸­new String()ï¼Œå…·ä½“çš„å†…å®¹ä¸ºæ‹¼æ¥çš„ç»“æœï¼šjavaEEhadoop</span>    <span class="token class-name">String</span> s5 <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s6 <span class="token operator">=</span> <span class="token string">"javaEE"</span> <span class="token operator">+</span> s2<span class="token punctuation">;</span>    <span class="token class-name">String</span> s7 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s5 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s5 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s6 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>    <span class="token comment">//intern():åˆ¤æ–­å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨javaEEhadoopå€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›å¸¸é‡æ± ä¸­javaEEhadoopçš„åœ°å€ï¼›</span>    <span class="token comment">//å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸å­˜åœ¨javaEEhadoopï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­åŠ è½½ä¸€ä»½javaEEhadoopï¼Œå¹¶è¿”å›æ¬¡å¯¹è±¡çš„åœ°å€ã€‚</span>    <span class="token class-name">String</span> s8 <span class="token operator">=</span> s6<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å­—ç¬¦ä¸²æ‹¼æ¥åº•å±‚ç»†èŠ‚">å­—ç¬¦ä¸²æ‹¼æ¥åº•å±‚ç»†èŠ‚</h3><p><strong>ç»†èŠ‚ä¸€</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">"ab"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span><span class="token comment">//</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224142009016.png" alt="å­—èŠ‚ç åˆ†æ"></p><p><strong>ç»†èŠ‚äºŒ</strong></p><p>å­—ç¬¦ä¸²æ‹¼æ¥ä¸ä¸€å®šä½¿ç”¨çš„éƒ½æ˜¯ StringBuilder</p><ul><li>å¦‚æœæ‹¼æ¥ç¬¦å·å·¦å³ä¸¤è¾¹éƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æˆ–å¸¸é‡å¼•ç”¨, åˆ™ä»ç„¶ä½¿ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–, å³é StringBuilder çš„æ–¹å¼</li><li>é’ˆå¯¹äº final ä¿®é¥°ç±»ã€æ–¹æ³•ã€åŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹çš„é‡çš„ç»“æ„æ—¶, èƒ½ä½¿ç”¨ä¸Š final çš„æ—¶å€™å»ºè®®ä½¿ç”¨ä¸Š</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">"ab"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224142649419.png" alt="å­—èŠ‚ç åˆ†æ"></p><p><strong>é’ˆå¯¹ä¸Šè¿°ç»ƒä¹ é¢˜</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"javaEEhadoop"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"javaEE"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> s2 <span class="token operator">+</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"javaEE"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s5 <span class="token operator">=</span> s4 <span class="token operator">+</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ‹¼æ¥æ“ä½œä¸ append æ“ä½œçš„æ•ˆç‡å¯¹æ¯”</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">method1</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//6150</span>    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"+æ‹¼æ¥èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> s2 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">method2</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>    <span class="token keyword">long</span> e2 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"appendæ‹¼æ¥èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e2 <span class="token operator">-</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token keyword">int</span> highLevel<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> src <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> highLevel<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        src <span class="token operator">=</span> src <span class="token operator">+</span> <span class="token string">"a"</span><span class="token punctuation">;</span><span class="token comment">//æ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªStringBuilderã€String</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token keyword">int</span> highLevel<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//åªéœ€è¦åˆ›å»ºä¸€ä¸ªStringBuilder</span>    <span class="token class-name">StringBuilder</span> src <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> highLevel<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        src<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç›¸å·®äº† 2000 å¤šå€</li><li><strong>StringBuilder çš„ append() æ–¹å¼</strong>: è‡ªå§‹è‡³ç»ˆåªåˆ›å»ºè¿‡ä¸€ä¸ªStringBuilder å¯¹è±¡; <strong>String å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼</strong>: åˆ›å»ºè¿‡å¤šä¸ªStringBuilder å’Œ String çš„å¯¹è±¡</li><li><strong>String å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼</strong>: å†…å­˜ä¸­ç”±äºåˆ›å»ºäº†è¾ƒå¤šçš„ StringBuilder å’Œ String å¯¹è±¡, å†…å­˜å ç”¨æ›´å¤§; å¦‚æœè¿›è¡Œ GC, éœ€è¦èŠ±è´¹é¢å¤–çš„æ—¶é—´</li><li>åœ¨å®é™…å¼€å‘ä¸­, å¦‚æœåŸºæœ¬ç¡®å®šå‰å‰ååæ·»åŠ çš„å­—ç¬¦ä¸²é•¿åº¦ä¸é«˜äºæŸä¸ªé™å®šå€¼ highLevel çš„æƒ…å†µä¸‹, å»ºè®®ä½¿ç”¨æ„é€ å™¨å®ä¾‹åŒ–<code>StringBuilder s = new StringBuilder(highLevel);</code> å°½é‡é¿å…åº•å±‚ä¸æ–­è¿›è¡Œæ‰©å®¹çš„æƒ…å†µ</li></ul><h2 id="5-intern-çš„ä½¿ç”¨">5-intern()çš„ä½¿ç”¨</h2><ul><li><p>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„ String å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ String æä¾›çš„ intern æ–¹æ³•ï¼šintern æ–¹æ³•ä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥è¯¢å½“å‰å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å°±ä¼šå°†å½“å‰å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ä¸­ã€‚</p><ul><li>æ¯”å¦‚ï¼š<code>String myInfo = new string(&quot;hello&quot;).intern();</code></li></ul></li><li><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ä»»æ„å­—ç¬¦ä¸²ä¸Šè°ƒç”¨ String.intern() æ–¹æ³•ï¼Œé‚£ä¹ˆå…¶è¿”å›ç»“æœæ‰€æŒ‡å‘çš„é‚£ä¸ªç±»å®ä¾‹ï¼Œå¿…é¡»å’Œç›´æ¥ä»¥å¸¸é‡å½¢å¼å‡ºç°çš„å­—ç¬¦ä¸²å®ä¾‹å®Œå…¨ç›¸åŒã€‚å› æ­¤ï¼Œä¸‹åˆ—è¡¨è¾¾å¼çš„å€¼å¿…å®šæ˜¯ true</p></li></ul><h3 id="demo1-3">demo1</h3><p><strong>new String(â€œabâ€) ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡?</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224150618810.png" alt="å­—èŠ‚ç åˆ†æ"></p><h3 id="demo2-3">demo2</h3><p><strong>new String(â€œaâ€) + new String(â€œbâ€); åˆ›å»ºå‡ ä¸ªå¯¹è±¡</strong></p><p><img src="./../jvm-sgg9/image-20231224151955499.png" alt="å­—èŠ‚ç åˆ†æ"></p><p><img src="./../jvm-sgg9/image-20231224152411037.png" alt="StringBuilder.toString() å­—èŠ‚ç "></p><h3 id="demo3">demo3</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    s<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤æ—¶å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»æœ‰ "1" äº†</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›¸å½“äºnew String("11")</span>    <span class="token comment">// æ­¤æ—¶å¸¸é‡æ± ä¸­ä¸å­˜åœ¨ "11"</span>    s3<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆ"11", å¦‚ä½•ç†è§£: jdk6:åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡"11", ä¹Ÿå°±æœ‰æ–°çš„åœ°å€, ä½†æ˜¯jdk7ä¹‹åä¸­å­—ç¬¦ä¸²å¸¸é‡æ± è®°å½•çš„æ˜¯newå‡ºæ¥çš„åœ°å€å€¼, å¹¶æ²¡æœ‰åˆ›å»º"11"</span>    <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"11"</span><span class="token punctuation">;</span> <span class="token comment">// s4å˜é‡è®°å½•çš„åœ°å€: ä½¿ç”¨çš„æ˜¯ä¸Šä¸€è¡Œä»£ç æ‰§è¡Œæ—¶, åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆçš„ "11" çš„åœ°å€</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224155937081.png" alt=""></p><p><img src="./../jvm-sgg9/image-20231224160228520.png" alt="jdk7ä¸‹çš„æµç¨‹"></p><h3 id="æ‹“å±•é—®é¢˜">æ‹“å±•é—®é¢˜</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"11"</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆå¯¹è±¡"11"</span>    s3<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®é™…æ²¡å¹²å•¥</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ€»ç»“">æ€»ç»“</h3><ul><li>JDK1.6 ä¸­, å°†è¿™ä¸ªå­—ç¬¦å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± <ul><li>å¦‚æœä¸²æ± æœ‰, åˆ™å¹¶ä¸ä¼šæ”¾å…¥. è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€</li><li>å¦‚æœæ²¡æœ‰, åˆ™ä¼šæŠŠ<strong>æ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½</strong>, æ”¾å…¥ä¸²æ± , å¹¶è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡åœ°å€</li></ul></li><li>JDK1.7 èµ·, å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± <ul><li>å¦‚æœä¸²æ± ä¸­æœ‰, åˆ™å¹¶ä¸ä¼šæ”¾å…¥. è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€</li><li>å¦‚æœæ²¡æœ‰, åˆ™ä¼šæŠŠ<strong>å¯¹è±¡çš„å¼•ç”¨åœ°å€å¤åˆ¶ä¸€ä»½</strong>, æ”¾å…¥ä¸²æ± , å¹¶è¿”å›ä¼ æ± ä¸­çš„å¼•ç”¨åœ°å€</li></ul></li></ul><h3 id="è¡¥å……ç»ƒä¹ ">è¡¥å……ç»ƒä¹ </h3><p><strong>demo1</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2 <span class="token operator">==</span> <span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åœŸå‘³è§£æ(JDK8)</strong></p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">line3: s(newå †åœ°å€å€¼,@h1, æ³¨æ„!!æ­¤å¤„ä¸ä¼šåœ¨ä¸²æ± ç”Ÿæˆ)line4: s2(ä¸²æ± æ²¡æœ‰, è¿”å›@st1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>demo2</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//        String s1 = new String("a") + new String("b");</span>    s1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"ab"</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åœŸå‘³è§£æ(JDK8)</strong></p><pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">====æƒ…å†µ1line3: s1(ä¸²æ± ç”Ÿæˆ@st1, è¿”å›@h1)line5: æ— æ•ˆline6: s2(è¿”å›@st1)line7: false====æƒ…å†µ2line4: s1(è¿”å›@h1)line5: ä¸²æ± æ— ,åˆ™ç”Ÿæˆ @st1 æŒ‡å‘ @h, å³@hline6: s2(è¿”å›@h)line7: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>demo3(è‡ªæµ‹)</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> x <span class="token operator">=</span> <span class="token string">"ab"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2 <span class="token operator">==</span> <span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="intern-çš„æ•ˆç‡æµ‹è¯•ï¼ˆç©ºé—´è§’åº¦ï¼‰">intern() çš„æ•ˆç‡æµ‹è¯•ï¼ˆç©ºé—´è§’åº¦ï¼‰</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAX_COUNT</span> <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token constant">MAX_COUNT</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">MAX_COUNT</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i <span class="token operator">%</span> data<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å†™æ³•1</span><span class="token comment">//            arr[i] = new String(String.valueOf(data[i % data.length])).intern(); // å†™æ³•2</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg9/image-20231224175840946.png" alt="å†™æ³•1çš„å†…å­˜æƒ…å†µ"></p><p><img src="./../jvm-sgg9/image-20231224175910290.png" alt="å†™æ³•2çš„å†…å­˜æƒ…å†µ"></p><p><strong>å¯¹äºç¨‹åºä¸­å¤§é‡å­˜åœ¨çš„å­—ç¬¦ä¸², å°¤å…¶å…¶ä¸­å­˜åœ¨å¾ˆå¤šé‡å¤å­—ç¬¦ä¸²æ—¶, ä½¿ç”¨intern() å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´</strong></p><p><strong>ç¬¬ä¸€ç§æ–¹å¼</strong></p><p><code>arr[i] = new String(String.valueOf(data[i % data.length])); </code></p><p>åœ¨å †ä¸­ç¡®å®åˆ›å»ºäº† 1000W ä¸ªå¯¹è±¡, å¹¶ä¸”å­˜æ”¾åœ¨æ•°ç»„ä¸­, ä¹Ÿä¸ä¼šè¢«å›æ”¶</p><p><strong>ç¬¬äºŒç§æ–¹å¼</strong></p><p><code>arr[i] = new String(String.valueOf(data[i % data.length])).intern();</code></p><p>è¿”å›ç»™æ•°ç»„çš„æ˜¯ä¸²æ± ä¸­çš„å¼•ç”¨åœ°å€, å› æ­¤å³ä½¿newçš„å¯¹è±¡ä¹Ÿå¯ä»¥å³ä½¿è¢«é”€æ¯</p><p><em>å¤§çš„ç½‘ç«™å¹³å°, éœ€è¦å†…å­˜ä¸­å­˜å‚¨å¤§é‡çš„å­—ç¬¦ä¸². æ¯”å¦‚ç¤¾äº¤ç½‘ç«™, å¾ˆå¤šäººéƒ½å­˜å‚¨: åŒ—äº¬å¸‚ã€æµ·æ·€åŒºç­‰ä¿¡æ¯. è¿™æ—¶å€™å¦‚æœå­—ç¬¦ä¸²éƒ½è°ƒç”¨ intern() æ–¹æ³•, å°±ä¼šæ˜æ˜¾é™ä½å†…å­˜çš„å¤§å°</em></p><h2 id="6-StringTableçš„åƒåœ¾å›æ”¶">6-StringTableçš„åƒåœ¾å›æ”¶</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Stringçš„åƒåœ¾å›æ”¶: * -Xms15m -Xmx15m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringGCTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸æ–­è°ƒæ•´<code>j</code>å¤§å°, è§‚å¯ŸGCæƒ…å†µ</p><h2 id="7-G1ä¸­çš„Stringå»é‡æ“ä½œ">7-G1ä¸­çš„Stringå»é‡æ“ä½œ</h2><p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="http://openjdk.java.net/jeps/192">http://openjdk.java.net/jeps/192</a></p><ul><li>èƒŒæ™¯ï¼šå¯¹è®¸å¤š Java åº”ç”¨ï¼ˆæœ‰å¤§çš„ä¹Ÿæœ‰å°çš„ï¼‰åšçš„æµ‹è¯•å¾—å‡ºä»¥ä¸‹ç»“æœï¼š<ul><li>å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢ String å¯¹è±¡å äº†25%</li><li>å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢é‡å¤çš„ String å¯¹è±¡æœ‰13.5%</li><li>String å¯¹è±¡çš„å¹³å‡é•¿åº¦æ˜¯45</li></ul></li><li>è®¸å¤šå¤§è§„æ¨¡çš„ Java åº”ç”¨çš„ç“¶é¢ˆåœ¨äºå†…å­˜ï¼Œæµ‹è¯•è¡¨æ˜ï¼Œåœ¨è¿™äº›ç±»å‹çš„åº”ç”¨é‡Œé¢ï¼ŒJava å †ä¸­å­˜æ´»çš„æ•°æ®é›†åˆå·®ä¸å¤š25%æ˜¯ String å¯¹è±¡ã€‚æ›´è¿›ä¸€æ­¥ï¼Œè¿™é‡Œé¢å·®ä¸å¤šä¸€åŠ String å¯¹è±¡æ˜¯é‡å¤çš„ï¼Œé‡å¤çš„æ„æ€æ˜¯è¯´ï¼š<code>str1.equals(str2)= true</code>ã€‚å †ä¸Šå­˜åœ¨é‡å¤çš„ String å¯¹è±¡å¿…ç„¶æ˜¯ä¸€ç§å†…å­˜çš„æµªè´¹ã€‚è¿™ä¸ªé¡¹ç›®å°†åœ¨ G1 åƒåœ¾æ”¶é›†å™¨ä¸­å®ç°è‡ªåŠ¨æŒç»­å¯¹é‡å¤çš„ String å¯¹è±¡è¿›è¡Œå»é‡ï¼Œè¿™æ ·å°±èƒ½é¿å…æµªè´¹å†…å­˜ã€‚</li></ul><p><strong>å®ç°</strong></p><ul><li>å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œçš„æ—¶å€™ï¼Œä¼šè®¿é—®å †ä¸Šå­˜æ´»çš„å¯¹è±¡ã€‚<strong>å¯¹æ¯ä¸€ä¸ªè®¿é—®çš„å¯¹è±¡éƒ½ä¼šæ£€æŸ¥æ˜¯å¦æ˜¯å€™é€‰çš„è¦å»é‡çš„ String å¯¹è±¡</strong>ã€‚</li><li>å¦‚æœæ˜¯ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…åç»­çš„å¤„ç†ã€‚ä¸€ä¸ªå»é‡çš„çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œå¤„ç†è¿™ä¸ªé˜Ÿåˆ—ã€‚å¤„ç†é˜Ÿåˆ—çš„ä¸€ä¸ªå…ƒç´ æ„å‘³ç€ä»é˜Ÿåˆ—åˆ é™¤è¿™ä¸ªå…ƒç´ ï¼Œç„¶åå°è¯•å»é‡å®ƒå¼•ç”¨çš„ String å¯¹è±¡ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ª Hashtable æ¥è®°å½•æ‰€æœ‰çš„è¢« String å¯¹è±¡ä½¿ç”¨çš„ä¸é‡å¤çš„ char æ•°ç»„ã€‚å½“å»é‡çš„æ—¶å€™ï¼Œä¼šæŸ¥è¿™ä¸ª Hashtableï¼Œæ¥çœ‹å †ä¸Šæ˜¯å¦å·²ç»å­˜åœ¨ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„ char æ•°ç»„ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼ŒString å¯¹è±¡ä¼šè¢«è°ƒæ•´å¼•ç”¨é‚£ä¸ªæ•°ç»„ï¼Œé‡Šæ”¾å¯¹åŸæ¥çš„æ•°ç»„çš„å¼•ç”¨ï¼Œæœ€ç»ˆä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶æ‰ã€‚</li><li>å¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œchar æ•°ç»„ä¼šè¢«æ’å…¥åˆ° Hashtableï¼Œè¿™æ ·ä»¥åçš„æ—¶å€™å°±å¯ä»¥å…±äº«è¿™ä¸ªæ•°ç»„äº†ã€‚</li></ul><p><strong>å‘½ä»¤è¡Œé€‰é¡¹</strong></p><ul><li>UseStringDeduplication(bool) ï¼šå¼€å¯ String å»é‡ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚</li><li>PrintStringDeduplicationStatistics(bool) ï¼šæ‰“å°è¯¦ç»†çš„å»é‡ç»Ÿè®¡ä¿¡æ¯</li><li>stringDeduplicationAgeThreshold(uintx) ï¼šè¾¾åˆ°è¿™ä¸ªå¹´é¾„çš„ String å¯¹è±¡è¢«è®¤ä¸ºæ˜¯å»é‡çš„å€™é€‰å¯¹è±¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-08-æ‰§è¡Œå¼•æ“</title>
      <link href="/2023/12/22/jvm-sgg8/"/>
      <url>/2023/12/22/jvm-sgg8/</url>
      
        <content type="html"><![CDATA[<h1>æ‰§è¡Œå¼•æ“</h1><p><img src="./../jvm-sgg8/image-20231222214407590.png" alt="Hotspot JVM"></p><h2 id="1-æ‰§è¡Œå¼•æ“æ¦‚è¿°">1-æ‰§è¡Œå¼•æ“æ¦‚è¿°</h2><p><img src="./../jvm-sgg8/image-20231222214725500.png" alt=""></p><ul><li>æ‰§è¡Œå¼•æ“æ˜¯ Java è™šæ‹Ÿæœºæ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚</li><li>&quot;è™šæ‹Ÿæœº&quot;æ˜¯ä¸€ä¸ªç›¸å¯¹äº&quot;ç‰©ç†æœº  &quot;çš„æ¦‚å¿µï¼Œè¿™ä¸¤ç§æœºå™¨éƒ½æœ‰ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œå…¶åŒºåˆ«æ˜¯ç‰©ç†æœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç›´æ¥å»ºç«‹åœ¨å¤„ç†å™¨ã€ç¼“å­˜ã€æŒ‡ä»¤é›†å’Œæ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„ï¼Œè€Œ<strong>è™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“åˆ™æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„</strong>ï¼Œå› æ­¤å¯ä»¥ä¸å—ç‰©ç†æ¡ä»¶åˆ¶çº¦åœ°å®šåˆ¶æŒ‡ä»¤é›†ä¸æ‰§è¡Œå¼•æ“çš„ç»“æ„ä½“ç³»ï¼Œ<strong>èƒ½å¤Ÿæ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶ç›´æ¥æ”¯æŒçš„æŒ‡ä»¤é›†æ ¼å¼</strong>ã€‚</li><li>JVM çš„ä¸»è¦ä»»åŠ¡æ˜¯è´Ÿè´£<strong>è£…è½½å­—èŠ‚ç åˆ°å…¶å†…éƒ¨</strong>ï¼Œä½†å­—èŠ‚ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œå› ä¸ºå­—èŠ‚ç æŒ‡ä»¤å¹¶éç­‰ä»·äºæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œå®ƒå†…éƒ¨åŒ…å«çš„ä»…ä»…åªæ˜¯ä¸€äº›èƒ½å¤Ÿè¢« JVM æ‰€è¯†åˆ«çš„å­—èŠ‚ç æŒ‡ä»¤ã€ç¬¦å·è¡¨ï¼Œä»¥åŠå…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚</li><li>é‚£ä¹ˆï¼Œå¦‚æœæƒ³è¦è®©ä¸€ä¸ªJavaç¨‹åºè¿è¡Œèµ·æ¥ï¼Œæ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰çš„ä»»åŠ¡å°±æ˜¯<strong>å°†å­—èŠ‚ç æŒ‡ä»¤è§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰å¯ä»¥</strong>ã€‚ç®€å•æ¥è¯´ï¼ŒJVM ä¸­çš„æ‰§è¡Œå¼•æ“å……å½“äº†å°†é«˜çº§è¯­è¨€ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€çš„è¯‘è€…ã€‚</li></ul><p><img src="./../jvm-sgg8/image-20231222215051218.png" alt=""></p><h3 id="æ‰§è¡Œå¼•æ“å·¥ä½œè¿‡ç¨‹">æ‰§è¡Œå¼•æ“å·¥ä½œè¿‡ç¨‹</h3><ol><li>æ‰§è¡Œå¼•æ“åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ç©¶ç«Ÿéœ€è¦æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤å®Œå…¨ä¾èµ–äº PC å¯„å­˜å™¨ã€‚</li><li>æ¯å½“æ‰§è¡Œå®Œä¸€é¡¹æŒ‡ä»¤æ“ä½œåï¼ŒPC å¯„å­˜å™¨å°±ä¼šæ›´æ–°ä¸‹ä¸€æ¡éœ€è¦è¢«æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚</li><li>å½“ç„¶æ–¹æ³•åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œå¼•æ“æœ‰å¯èƒ½ä¼šé€šè¿‡å­˜å‚¨åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„å¯¹è±¡å¼•ç”¨å‡†ç¡®å®šä½åˆ°å­˜å‚¨åœ¨ Java å †åŒºä¸­çš„å¯¹è±¡å®ä¾‹ä¿¡æ¯ï¼Œä»¥åŠé€šè¿‡å¯¹è±¡å¤´ä¸­çš„å…ƒæ•°æ®æŒ‡é’ˆå®šä½åˆ°ç›®æ ‡å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚</li><li>ä»å¤–è§‚ä¸Šæ¥çœ‹ï¼Œæ‰€æœ‰çš„ Java è™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“è¾“å…¥ã€å¤„ç†ã€è¾“å‡ºéƒ½æ˜¯ä¸€è‡´çš„ï¼šè¾“å…¥çš„æ˜¯å­—èŠ‚ç äºŒè¿›åˆ¶æµï¼Œå¤„ç†è¿‡ç¨‹æ˜¯å­—èŠ‚ç è§£ææ‰§è¡Œã€å³æ—¶ç¼–è¯‘çš„ç­‰æ•ˆè¿‡ç¨‹ï¼Œè¾“å‡ºçš„æ˜¯æ‰§è¡Œè¿‡ç¨‹ã€‚</li></ol><p><img src="./../jvm-sgg8/image-20231222215308603.png" alt=""></p><h2 id="2-Javaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹">2-Javaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹</h2><p>å¤§éƒ¨åˆ†çš„ç¨‹åºä»£ç è½¬æ¢æˆç‰©ç†æœºçš„ç›®æ ‡ä»£ç æˆ–è™šæ‹Ÿæœºèƒ½æ‰§è¡Œçš„æŒ‡ä»¤é›†ä¹‹å‰ï¼Œéƒ½éœ€è¦ç»è¿‡ä¸‹å›¾ä¸­çš„å„ä¸ªæ­¥éª¤ï¼š</p><p><img src="./../jvm-sgg8/image-20231222215634884.png" alt=""></p><ul><li>å‰é¢æ©™è‰²éƒ¨åˆ†æ˜¯ç¼–è¯‘ç”Ÿæˆç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶çš„è¿‡ç¨‹ï¼ˆjavac ç¼–è¯‘å™¨æ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ç¼–è¯‘å™¨ï¼‰ï¼Œå’Œ JVM æ²¡æœ‰å…³ç³»ã€‚</li><li>åé¢ç»¿è‰²ï¼ˆè§£é‡Šæ‰§è¡Œï¼‰å’Œè“è‰²ï¼ˆå³æ—¶ç¼–è¯‘ï¼‰æ‰æ˜¯JVMéœ€è¦è€ƒè™‘çš„è¿‡ç¨‹</li></ul><p>javac ç¼–è¯‘å™¨ï¼ˆå‰ç«¯ç¼–è¯‘å™¨ï¼‰æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="./../jvm-sgg8/image-20231222215830776.png" alt=""></p><p>Javaå­—èŠ‚ç çš„æ‰§è¡Œæ˜¯ç”±JVMæ‰§è¡Œå¼•æ“æ¥å®Œæˆï¼Œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º</p><p><img src="./../jvm-sgg8/image-20231222215938424.png" alt=""></p><p><strong>é—®é¢˜: ä»€ä¹ˆæ˜¯è§£é‡Šå™¨ï¼Ÿä»€ä¹ˆæ˜¯JITç¼–è¯‘å™¨ï¼Ÿ</strong></p><ul><li>è§£é‡Šå™¨ï¼šå½“ Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶ä¼šæ ¹æ®é¢„å®šä¹‰çš„è§„èŒƒ<strong>å¯¹å­—èŠ‚ç é‡‡ç”¨é€è¡Œè§£é‡Šçš„æ–¹å¼æ‰§è¡Œ</strong>ï¼Œå°†æ¯æ¡å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹&quot;ç¿»è¯‘&quot;ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚</li><li>JITï¼ˆJust In Time Compilerï¼‰ç¼–è¯‘å™¨ï¼šå°±æ˜¯è™šæ‹Ÿæœºå°†æºä»£ç <strong>ä¸€æ¬¡æ€§ç›´æ¥</strong>ç¼–è¯‘æˆå’Œæœ¬åœ°æœºå™¨å¹³å°ç›¸å…³çš„æœºå™¨è¯­è¨€ï¼Œ<strong>ä½†å¹¶ä¸æ˜¯é©¬ä¸Šæ‰§è¡Œ</strong>ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆ Java æ˜¯åŠç¼–è¯‘åŠè§£é‡Šå‹è¯­è¨€ï¼Ÿ</strong></p><ul><li>JDK1.0 æ—¶ä»£ï¼Œå°† Java è¯­è¨€å®šä½ä¸ºâ€œè§£é‡Šæ‰§è¡Œâ€è¿˜æ˜¯æ¯”è¾ƒå‡†ç¡®çš„ã€‚å†åæ¥ï¼ŒJava ä¹Ÿå‘å±•å‡ºå¯ä»¥ç›´æ¥ç”Ÿæˆæœ¬åœ°ä»£ç çš„ç¼–è¯‘å™¨ã€‚</li><li>ç°åœ¨ JVM åœ¨æ‰§è¡Œ Java ä»£ç çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ä¼šå°†è§£é‡Šæ‰§è¡Œä¸ç¼–è¯‘æ‰§è¡ŒäºŒè€…ç»“åˆèµ·æ¥è¿›è¡Œã€‚</li><li>JIT ç¼–è¯‘å™¨å°†å­—èŠ‚ç ç¿»è¯‘æˆæœ¬åœ°ä»£ç åï¼Œå°±å¯ä»¥åšä¸€ä¸ªç¼“å­˜æ“ä½œï¼Œå­˜å‚¨åœ¨æ–¹æ³•åŒºçš„ JIT ä»£ç ç¼“å­˜ä¸­ï¼ˆæ‰§è¡Œæ•ˆç‡æ›´é«˜äº†ï¼‰ï¼Œå¹¶ä¸”åœ¨ç¿»è¯‘æˆæœ¬åœ°ä»£ç çš„è¿‡ç¨‹ä¸­å¯ä»¥åšä¼˜åŒ–ã€‚</li></ul><h2 id="3-æœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€">3-æœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€</h2><p><img src="./../jvm-sgg8/image-20231223114549438.png" alt=""></p><h3 id="æœºå™¨ç ">æœºå™¨ç </h3><ul><li>å„ç§ç”¨äºŒè¿›åˆ¶ç¼–ç æ–¹å¼è¡¨ç¤ºçš„æŒ‡ä»¤ï¼Œå«åšæœºå™¨æŒ‡ä»¤ç ã€‚å¼€å§‹ï¼Œäººä»¬å°±ç”¨å®ƒé‡‡ç¼–å†™ç¨‹åºï¼Œè¿™å°±æ˜¯æœºå™¨è¯­è¨€ã€‚</li><li>æœºå™¨è¯­è¨€è™½ç„¶èƒ½å¤Ÿè¢«è®¡ç®—æœºç†è§£å’Œæ¥å—ï¼Œä½†å’Œäººä»¬çš„è¯­è¨€å·®åˆ«å¤ªå¤§ï¼Œä¸æ˜“è¢«äººä»¬ç†è§£å’Œè®°å¿†ï¼Œå¹¶ä¸”ç”¨å®ƒç¼–ç¨‹å®¹æ˜“å‡ºå·®é”™ã€‚</li><li>ç”¨å®ƒç¼–å†™çš„ç¨‹åºä¸€ç»è¾“å…¥è®¡ç®—æœºï¼ŒCPU ç›´æ¥è¯»å–è¿è¡Œï¼Œå› æ­¤å’Œå…¶ä»–è¯­è¨€ç¼–çš„ç¨‹åºç›¸æ¯”ï¼Œæ‰§è¡Œé€Ÿåº¦æœ€å¿«ã€‚</li><li>æœºå™¨æŒ‡ä»¤ä¸ CPU ç´§å¯†ç›¸å…³ï¼Œæ‰€ä»¥ä¸åŒç§ç±»çš„ CPU æ‰€å¯¹åº”çš„æœºå™¨æŒ‡ä»¤ä¹Ÿå°±ä¸åŒã€‚</li></ul><h3 id="æŒ‡ä»¤ä¸æŒ‡ä»¤é›†">æŒ‡ä»¤ä¸æŒ‡ä»¤é›†</h3><p><strong>æŒ‡ä»¤</strong></p><ul><li><p>ç”±äºæœºå™¨ç æ˜¯ç”± 0 å’Œ 1ç»„æˆçš„äºŒè¿›åˆ¶åºåˆ—ï¼Œå¯è¯»æ€§å®åœ¨å¤ªå·®ï¼Œäºæ˜¯äººä»¬å‘æ˜äº†æŒ‡ä»¤ã€‚</p></li><li><p>æŒ‡ä»¤å°±æ˜¯æŠŠæœºå™¨ç ä¸­ç‰¹å®šçš„ 0 å’Œ 1 åºåˆ—ï¼Œç®€åŒ–æˆå¯¹åº”çš„æŒ‡ä»¤ï¼ˆä¸€èˆ¬ä¸ºè‹±æ–‡ç®€å†™ï¼Œå¦‚ <code>mov</code>ï¼Œ<code>inc</code> ç­‰ï¼‰ï¼Œå¯è¯»æ€§ç¨å¥½</p></li><li><p>ç”±äºä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œæ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œå¯¹åº”çš„æœºå™¨ç å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥ä¸åŒçš„ç¡¬ä»¶å¹³å°çš„åŒä¸€ç§æŒ‡ä»¤ï¼ˆæ¯”å¦‚ <code>mov</code>ï¼‰ï¼Œå¯¹åº”çš„æœºå™¨ç ä¹Ÿå¯èƒ½ä¸åŒã€‚</p></li></ul><p><strong>æŒ‡ä»¤é›†</strong></p><ul><li><p>ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œå„è‡ªæ”¯æŒçš„æŒ‡ä»¤ï¼Œæ˜¯æœ‰å·®åˆ«çš„ã€‚å› æ­¤æ¯ä¸ªå¹³å°æ‰€æ”¯æŒçš„æŒ‡ä»¤ï¼Œç§°ä¹‹ä¸ºå¯¹åº”å¹³å°çš„æŒ‡ä»¤é›†ã€‚å¦‚å¸¸è§çš„</p><ul><li><p>x86 æŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ˜¯ x86 æ¶æ„çš„å¹³å°</p></li><li><p>ARM æŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ˜¯ ARM æ¶æ„çš„å¹³å°</p></li></ul></li></ul><h3 id="æ±‡ç¼–è¯­è¨€">æ±‡ç¼–è¯­è¨€</h3><ul><li>ç”±äºæŒ‡ä»¤çš„å¯è¯»æ€§è¿˜æ˜¯å¤ªå·®ï¼Œäºæ˜¯äººä»¬åˆå‘æ˜äº†æ±‡ç¼–è¯­è¨€ã€‚</li><li>åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œç”¨<strong>åŠ©è®°ç¬¦</strong>ï¼ˆMnemonicsï¼‰ä»£æ›¿<strong>æœºå™¨æŒ‡ä»¤çš„æ“ä½œç </strong>ï¼Œç”¨<strong>åœ°å€ç¬¦å·ï¼ˆSymbolï¼‰æˆ–æ ‡å·ï¼ˆLabelï¼‰ä»£æ›¿æŒ‡ä»¤æˆ–æ“ä½œæ•°çš„åœ°å€</strong>ã€‚</li><li>åœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œæ±‡ç¼–è¯­è¨€å¯¹åº”ç€ä¸åŒçš„æœºå™¨è¯­è¨€æŒ‡ä»¤é›†ï¼Œé€šè¿‡æ±‡ç¼–è¿‡ç¨‹è½¬æ¢æˆæœºå™¨æŒ‡ä»¤ã€‚<ul><li>ç”±äºè®¡ç®—æœºåªè®¤è¯†æŒ‡ä»¤ç ï¼Œæ‰€ä»¥ç”¨<strong>æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ç¨‹åºè¿˜å¿…é¡»ç¿»è¯‘ï¼ˆæ±‡ç¼–ï¼‰æˆæœºå™¨æŒ‡ä»¤ç </strong>ï¼Œè®¡ç®—æœºæ‰èƒ½è¯†åˆ«å’Œæ‰§è¡Œã€‚</li></ul></li></ul><h3 id="é«˜çº§è¯­è¨€">é«˜çº§è¯­è¨€</h3><ul><li>ä¸ºäº†ä½¿è®¡ç®—æœºç”¨æˆ·ç¼–ç¨‹åºæ›´å®¹æ˜“äº›ï¼Œåæ¥å°±å‡ºç°äº†å„ç§é«˜çº§è®¡ç®—æœºè¯­è¨€ã€‚é«˜çº§è¯­è¨€æ¯”æœºå™¨è¯­è¨€ã€æ±‡ç¼–è¯­è¨€<strong>æ›´æ¥è¿‘äººçš„è¯­è¨€</strong></li><li>å½“è®¡ç®—æœºæ‰§è¡Œé«˜çº§è¯­è¨€ç¼–å†™çš„ç¨‹åºæ—¶ï¼Œ<strong>ä»ç„¶éœ€è¦æŠŠç¨‹åºè§£é‡Šå’Œç¼–è¯‘æˆæœºå™¨çš„æŒ‡ä»¤ç </strong>ã€‚å®Œæˆè¿™ä¸ªè¿‡ç¨‹çš„ç¨‹åºå°±å«åšè§£é‡Šç¨‹åºæˆ–ç¼–è¯‘ç¨‹åºã€‚</li></ul><p><img src="./../jvm-sgg8/image-20231223115206862.png" alt=""></p><h3 id="å­—èŠ‚ç ">å­—èŠ‚ç </h3><ul><li><p>å­—èŠ‚ç æ˜¯ä¸€ç§<strong>ä¸­é—´çŠ¶æ€ï¼ˆä¸­é—´ç ï¼‰çš„äºŒè¿›åˆ¶ä»£ç </strong>ï¼ˆæ–‡ä»¶ï¼‰ï¼Œå®ƒæ¯”æœºå™¨ç æ›´æŠ½è±¡ï¼Œéœ€è¦ç›´è¯‘å™¨è½¬è¯‘åæ‰èƒ½æˆä¸ºæœºå™¨ç </p></li><li><p>å­—èŠ‚ç ä¸»è¦ä¸ºäº†å®ç°ç‰¹å®šè½¯ä»¶è¿è¡Œå’Œè½¯ä»¶ç¯å¢ƒã€<strong>ä¸ç¡¬ä»¶ç¯å¢ƒæ— å…³</strong>ã€‚</p></li><li><p>å­—èŠ‚ç çš„å®ç°æ–¹å¼æ˜¯é€šè¿‡ç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºå™¨ã€‚ç¼–è¯‘å™¨å°†æºç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œç‰¹å®šå¹³å°ä¸Šçš„è™šæ‹Ÿæœºå™¨å°†å­—èŠ‚ç è½¬è¯‘ä¸ºå¯ä»¥ç›´æ¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p></li><li><p>å­—èŠ‚ç å…¸å‹çš„åº”ç”¨ä¸ºï¼šJava bytecode</p></li></ul><p><img src="./../jvm-sgg8/image-20231223115607640.png" alt=""></p><h3 id="Cã€C-æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹">Cã€C++æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹</h3><p><strong>ç¼–è¯‘è¿‡ç¨‹åˆå¯ä»¥åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œæ±‡ç¼–ã€‚</strong></p><ul><li>ç¼–è¯‘è¿‡ç¨‹ï¼šæ˜¯è¯»å–æºç¨‹åºï¼ˆå­—ç¬¦æµï¼‰ï¼Œå¯¹ä¹‹è¿›è¡Œè¯æ³•å’Œè¯­æ³•çš„åˆ†æï¼Œå°†é«˜çº§è¯­è¨€æŒ‡ä»¤è½¬æ¢ä¸ºåŠŸèƒ½ç­‰æ•ˆçš„æ±‡ç¼–ä»£ç </li><li>æ±‡ç¼–è¿‡ç¨‹ï¼šå®é™…ä¸ŠæŒ‡æŠŠæ±‡ç¼–è¯­è¨€ä»£ç ç¿»è¯‘æˆç›®æ ‡æœºå™¨æŒ‡ä»¤çš„è¿‡ç¨‹ã€‚</li></ul><p><img src="./../jvm-sgg8/image-20231223115420640.png" alt=""></p><h2 id="4-è§£é‡Šå™¨">4-è§£é‡Šå™¨</h2><ul><li>JVMè®¾è®¡è€…ä»¬çš„åˆè¡·ä»…ä»…åªæ˜¯å•çº¯åœ°<strong>ä¸ºäº†æ»¡è¶³Javaç¨‹åºå®ç°è·¨å¹³å°ç‰¹æ€§</strong>ï¼Œå› æ­¤é¿å…é‡‡ç”¨é™æ€ç¼–è¯‘çš„æ–¹å¼ç”±é«˜çº§è¯­è¨€ç›´æ¥ç”Ÿæˆæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œä»è€Œè¯ç”Ÿäº†å®ç°è§£é‡Šå™¨åœ¨è¿è¡Œæ—¶é‡‡ç”¨é€è¡Œè§£é‡Šå­—èŠ‚ç æ‰§è¡Œç¨‹åºçš„æƒ³æ³•ï¼ˆä¹Ÿå°±æ˜¯äº§ç”Ÿäº†ä¸€ä¸ªä¸­é—´äº§å“<strong>å­—èŠ‚ç </strong>ï¼‰ã€‚</li></ul><p><img src="./../jvm-sgg8/image-20231223115704426.png" alt=""></p><h3 id="è§£é‡Šå™¨å·¥ä½œæœºåˆ¶-æˆ–å·¥ä½œä»»åŠ¡">è§£é‡Šå™¨å·¥ä½œæœºåˆ¶(æˆ–å·¥ä½œä»»åŠ¡)</h3><ul><li>è§£é‡Šå™¨çœŸæ­£æ„ä¹‰ä¸Šæ‰€æ‰¿æ‹…çš„è§’è‰²å°±æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶â€œç¿»è¯‘è€…â€ï¼Œå°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹â€œç¿»è¯‘â€ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚</li><li>å½“ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤è¢«è§£é‡Šæ‰§è¡Œå®Œæˆåï¼Œæ¥ç€å†æ ¹æ® PC å¯„å­˜å™¨ä¸­è®°å½•çš„ä¸‹ä¸€æ¡éœ€è¦è¢«æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤æ‰§è¡Œè§£é‡Šæ“ä½œã€‚</li></ul><h3 id="è§£é‡Šå™¨åˆ†ç±»">è§£é‡Šå™¨åˆ†ç±»</h3><ul><li>åœ¨ Java çš„å‘å±•å†å²é‡Œï¼Œä¸€å…±æœ‰ä¸¤å¥—è§£é‡Šæ‰§è¡Œå™¨ï¼Œå³å¤è€çš„<strong>å­—èŠ‚ç è§£é‡Šå™¨</strong>ã€ç°åœ¨æ™®éä½¿ç”¨çš„<strong>æ¨¡æ¿è§£é‡Šå™¨</strong>ã€‚<ul><li>å­—èŠ‚ç è§£é‡Šå™¨åœ¨æ‰§è¡Œæ—¶é€šè¿‡<strong>çº¯è½¯ä»¶ä»£ç </strong>æ¨¡æ‹Ÿå­—èŠ‚ç çš„æ‰§è¡Œï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚</li><li>è€Œæ¨¡æ¿è§£é‡Šå™¨å°†<strong>æ¯ä¸€æ¡å­—èŠ‚ç å’Œä¸€ä¸ªæ¨¡æ¿å‡½æ•°ç›¸å…³è”</strong>ï¼Œæ¨¡æ¿å‡½æ•°ä¸­ç›´æ¥äº§ç”Ÿè¿™æ¡å­—èŠ‚ç æ‰§è¡Œæ—¶çš„æœºå™¨ç ï¼Œä»è€Œå¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜äº†è§£é‡Šå™¨çš„æ€§èƒ½ã€‚</li><li>åœ¨ HotSpot VM ä¸­ï¼Œè§£é‡Šå™¨ä¸»è¦ç”± Interpreter æ¨¡å—å’Œ Code æ¨¡å—æ„æˆã€‚<ul><li>Interpreter æ¨¡å—ï¼šå®ç°äº†è§£é‡Šå™¨çš„æ ¸å¿ƒåŠŸèƒ½</li><li>Code æ¨¡å—ï¼šç”¨äºç®¡ç† HotSpot VM åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤</li></ul></li></ul></li></ul><h3 id="è§£é‡Šå™¨ç°çŠ¶">è§£é‡Šå™¨ç°çŠ¶</h3><ul><li><p>ç”±äºè§£é‡Šå™¨åœ¨è®¾è®¡å’Œå®ç°ä¸Šéå¸¸ç®€å•ï¼Œå› æ­¤é™¤äº†Javaè¯­è¨€ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šé«˜çº§è¯­è¨€åŒæ ·ä¹Ÿæ˜¯åŸºäºè§£é‡Šå™¨æ‰§è¡Œçš„ï¼Œæ¯”å¦‚ Pythonã€Perlã€Ruby ç­‰ã€‚ä½†æ˜¯åœ¨ä»Šå¤©ï¼Œ<strong>åŸºäºè§£é‡Šå™¨æ‰§è¡Œå·²ç»æ²¦è½ä¸ºä½æ•ˆçš„ä»£åè¯</strong>ï¼Œå¹¶ä¸”æ—¶å¸¸è¢«ä¸€äº› C/C++ ç¨‹åºå‘˜æ‰€è°ƒä¾ƒã€‚</p></li><li><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJVM å¹³å°æ”¯æŒä¸€ç§å«ä½œå³æ—¶ç¼–è¯‘çš„æŠ€æœ¯ã€‚å³æ—¶ç¼–è¯‘çš„ç›®çš„æ˜¯é¿å…å‡½æ•°è¢«è§£é‡Šæ‰§è¡Œï¼Œè€Œæ˜¯<strong>å°†æ•´ä¸ªå‡½æ•°ä½“ç¼–è¯‘æˆä¸ºæœºå™¨ç ï¼Œæ¯æ¬¡å‡½æ•°æ‰§è¡Œæ—¶ï¼Œåªæ‰§è¡Œç¼–è¯‘åçš„æœºå™¨ç å³å¯</strong>ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä½¿æ‰§è¡Œæ•ˆç‡å¤§å¹…åº¦æå‡ã€‚</p></li><li><p>ä¸è¿‡æ— è®ºå¦‚ä½•ï¼ŒåŸºäºè§£é‡Šå™¨çš„æ‰§è¡Œæ¨¡å¼ä»ç„¶ä¸ºä¸­é—´è¯­è¨€çš„å‘å±•åšå‡ºäº†ä¸å¯ç£¨ç­çš„è´¡çŒ®ã€‚</p></li></ul><h2 id="5-JITç¼–è¯‘å™¨">5-JITç¼–è¯‘å™¨</h2><ul><li><p>ç¬¬ä¸€ç§æ˜¯å°†æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶ååœ¨è¿è¡Œæ—¶é€šè¿‡è§£é‡Šå™¨å°†å­—èŠ‚ç æ–‡ä»¶è½¬ä¸ºæœºå™¨ç æ‰§è¡Œ</p></li><li><p>ç¬¬äºŒç§æ˜¯ç¼–è¯‘æ‰§è¡Œï¼ˆç›´æ¥ç¼–è¯‘æˆæœºå™¨ç ï¼‰ã€‚ç°ä»£è™šæ‹Ÿæœºä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œä¼šä½¿ç”¨å³æ—¶ç¼–è¯‘æŠ€æœ¯ï¼ˆJITï¼ŒJust In Timeï¼‰å°†æ–¹æ³•ç¼–è¯‘æˆæœºå™¨ç åå†æ‰§è¡Œ</p></li><li><p>HotSpot VM æ˜¯ç›®å‰å¸‚é¢ä¸Šé«˜æ€§èƒ½è™šæ‹Ÿæœºçš„ä»£è¡¨ä½œä¹‹ä¸€ã€‚<strong>å®ƒé‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„</strong>ã€‚åœ¨Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨å’Œå³æ—¶ç¼–è¯‘å™¨èƒ½å¤Ÿç›¸äº’åä½œï¼Œå„è‡ªå–é•¿è¡¥çŸ­ï¼Œå°½åŠ›å»é€‰æ‹©æœ€åˆé€‚çš„æ–¹å¼æ¥æƒè¡¡ç¼–è¯‘æœ¬åœ°ä»£ç çš„æ—¶é—´å’Œç›´æ¥è§£é‡Šæ‰§è¡Œä»£ç çš„æ—¶é—´ã€‚</p></li><li><p>åœ¨ä»Šå¤©ï¼ŒJava ç¨‹åºçš„è¿è¡Œæ€§èƒ½æ—©å·²è„±èƒæ¢éª¨ï¼Œå·²ç»è¾¾åˆ°äº†å¯ä»¥å’Œ C/C++ ç¨‹åºä¸€è¾ƒé«˜ä¸‹çš„åœ°æ­¥ã€‚</p></li></ul><h3 id="ä¿ç•™è§£é‡Šå™¨çš„åŸå› ">ä¿ç•™è§£é‡Šå™¨çš„åŸå› </h3><p><strong>é—®é¢˜</strong></p><ul><li>æ—¢ç„¶ HotSpot VM ä¸­å·²ç»å†…ç½® JIT ç¼–è¯‘å™¨äº†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜éœ€è¦å†ä½¿ç”¨è§£é‡Šå™¨æ¥â€œæ‹–ç´¯â€ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½å‘¢ï¼Ÿæ¯”å¦‚ JRockit VM å†…éƒ¨å°±ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå­—èŠ‚ç å…¨éƒ¨éƒ½ä¾é å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åæ‰§è¡Œã€‚</li><li>JRockit è™šæ‹Ÿæœºæ˜¯ç æ‰äº†è§£é‡Šå™¨ï¼Œä¹Ÿå°±æ˜¯åªé‡‡åŠæ—¶ç¼–è¯‘å™¨ã€‚é‚£æ˜¯å› ä¸ºå‘¢ JRockit åªéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸€èˆ¬å·²ç»æœ‰æ—¶é—´è®©ä»–è¿›è¡ŒæŒ‡ä»¤ç¼–è¯‘çš„è¿‡ç¨‹äº†ï¼Œå¯¹äºå“åº”æ¥è¯´è¦æ±‚ä¸é«˜ï¼Œç­‰åŠæ—¶ç¼–è¯‘å™¨çš„ç¼–è¯‘å®Œæˆåï¼Œå°±ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½</li></ul><p><strong>é¦–å…ˆæ˜ç¡®</strong></p><ul><li>å½“ç¨‹åºå¯åŠ¨åï¼Œè§£é‡Šå™¨å¯ä»¥é©¬ä¸Šå‘æŒ¥ä½œç”¨ï¼Œ<strong>å“åº”é€Ÿåº¦å¿«</strong>ï¼Œçœå»ç¼–è¯‘çš„æ—¶é—´ï¼Œç«‹å³æ‰§è¡Œã€‚</li><li>ç¼–è¯‘å™¨è¦æƒ³å‘æŒ¥ä½œç”¨ï¼ŒæŠŠä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œ<strong>éœ€è¦ä¸€å®šçš„æ‰§è¡Œæ—¶é—´</strong>ï¼Œä½†ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç åï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚</li></ul><p><strong>æ‰€ä»¥</strong></p><ul><li>å°½ç®¡ JRockit VM ä¸­ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ä¼šéå¸¸é«˜æ•ˆï¼Œä½†ç¨‹åºåœ¨å¯åŠ¨æ—¶å¿…ç„¶éœ€è¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´æ¥è¿›è¡Œç¼–è¯‘ã€‚å¯¹äºæœåŠ¡ç«¯åº”ç”¨æ¥è¯´ï¼Œå¯åŠ¨æ—¶é—´å¹¶éæ˜¯å…³æ³¨é‡ç‚¹ï¼Œä½†å¯¹äºé‚£äº›çœ‹ä¸­å¯åŠ¨æ—¶é—´çš„åº”ç”¨åœºæ™¯è€Œè¨€ï¼Œæˆ–è®¸å°±éœ€è¦é‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„æ¥æ¢å–ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚</li><li>åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œåœ¨ Java è™šæ‹Ÿå™¨å¯åŠ¨æ—¶ï¼Œè§£é‡Šå™¨å¯ä»¥é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œè€Œä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨å…¨éƒ¨ç¼–è¯‘å®Œæˆåå†æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥çœå»è®¸å¤šä¸å¿…è¦çš„ç¼–è¯‘æ—¶é—´ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç¼–è¯‘å™¨å‘æŒ¥ä½œç”¨ï¼ŒæŠŠè¶Šæ¥è¶Šå¤šçš„ä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œè·å¾—æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚</li><li>åŒæ—¶ï¼Œè§£é‡Šæ‰§è¡Œåœ¨ç¼–è¯‘å™¨è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ä¸æˆç«‹çš„æ—¶å€™ï¼Œä½œä¸ºç¼–è¯‘å™¨çš„&quot;é€ƒç”Ÿé—¨&quot;ï¼ˆåå¤‡æ–¹æ¡ˆï¼‰ã€‚</li></ul><h3 id="HotSpot-JVMçš„æ‰§è¡Œæ–¹å¼">HotSpot JVMçš„æ‰§è¡Œæ–¹å¼</h3><p>å½“è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™ï¼Œ<strong>è§£é‡Šå™¨å¯ä»¥é¦–å…ˆå‘æŒ¥ä½œç”¨</strong>ï¼Œè€Œä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨å…¨éƒ¨ç¼–è¯‘å®Œæˆå†æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥<strong>çœå»è®¸å¤šä¸å¿…è¦çš„ç¼–è¯‘æ—¶é—´</strong>ã€‚éšç€ç¨‹åºè¿è¡Œæ—¶é—´çš„æ¨ç§»ï¼Œå³æ—¶ç¼–è¯‘å™¨é€æ¸å‘æŒ¥ä½œç”¨ï¼Œæ ¹æ®çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ï¼Œ<strong>å°†æœ‰ä»·å€¼çš„å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤</strong>ï¼Œä»¥æ¢å–æ›´é«˜çš„ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚</p><p><strong>æ¡ˆä¾‹</strong></p><ul><li>æ³¨æ„è§£é‡Šæ‰§è¡Œä¸ç¼–è¯‘æ‰§è¡Œåœ¨çº¿ä¸Šç¯å¢ƒå¾®å¦™çš„è¾©è¯å…³ç³»ã€‚<strong>æœºå™¨åœ¨çƒ­æœºçŠ¶æ€ï¼ˆå·²ç»è¿è¡Œäº†ä¸€æ®µæ—¶é—´å«çƒ­æœºçŠ¶æ€ï¼‰å¯ä»¥æ‰¿å—çš„è´Ÿè½½è¦å¤§äºå†·æœºçŠ¶æ€ï¼ˆåˆšå¯åŠ¨çš„æ—¶å€™å«å†·æœºçŠ¶æ€ï¼‰</strong>ã€‚å¦‚æœä»¥çƒ­æœºçŠ¶æ€æ—¶çš„æµé‡è¿›è¡Œåˆ‡æµï¼Œå¯èƒ½ä½¿å¤„äºå†·æœºçŠ¶æ€çš„æœåŠ¡å™¨å› æ— æ³•æ‰¿è½½æµé‡è€Œå‡æ­»ã€‚</li><li>åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œä»¥åˆ†æ‰¹çš„æ–¹å¼è¿›è¡Œå‘å¸ƒï¼Œæ ¹æ®æœºå™¨æ•°é‡åˆ’åˆ†æˆå¤šä¸ªæ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡çš„æœºå™¨æ•°è‡³å¤šå åˆ°æ•´ä¸ªé›†ç¾¤çš„1/8ã€‚æ›¾ç»æœ‰è¿™æ ·çš„æ•…éšœæ¡ˆä¾‹ï¼šæŸç¨‹åºå‘˜åœ¨å‘å¸ƒå¹³å°è¿›è¡Œåˆ†æ‰¹å‘å¸ƒï¼Œåœ¨è¾“å…¥å‘å¸ƒæ€»æ‰¹æ•°æ—¶ï¼Œè¯¯å¡«å†™æˆåˆ†ä¸ºä¸¤æ‰¹å‘å¸ƒã€‚å¦‚æœæ˜¯çƒ­æœºçŠ¶æ€ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸€åŠçš„æœºå™¨å¯ä»¥å‹‰å¼ºæ‰¿è½½æµé‡ï¼Œä½†ç”±äºåˆšå¯åŠ¨çš„JVMå‡æ˜¯è§£é‡Šæ‰§è¡Œï¼Œè¿˜æ²¡æœ‰è¿›è¡Œçƒ­ç‚¹ä»£ç ç»Ÿè®¡å’ŒJITåŠ¨æ€ç¼–è¯‘ï¼Œå¯¼è‡´æœºå™¨å¯åŠ¨ä¹‹åï¼Œå½“å‰1/2å‘å¸ƒæˆåŠŸçš„æœåŠ¡å™¨é©¬ä¸Šå…¨éƒ¨å®•æœºï¼Œæ­¤æ•…éšœè¯´æ˜äº†JITçš„å­˜åœ¨ã€‚â€”<strong>é˜¿é‡Œå›¢é˜Ÿ</strong></li></ul><p><img src="./../jvm-sgg8/image-20231223124258929.png" alt=""></p><h3 id="JITç¼–è¯‘å™¨ç›¸å…³æ¦‚å¿µ">JITç¼–è¯‘å™¨ç›¸å…³æ¦‚å¿µ</h3><ul><li>Java è¯­è¨€çš„â€œç¼–è¯‘æœŸâ€å…¶å®æ˜¯ä¸€æ®µâ€œä¸ç¡®å®šâ€çš„æ“ä½œè¿‡ç¨‹ï¼Œå› ä¸ºå®ƒå¯èƒ½æ˜¯æŒ‡ä¸€ä¸ª<strong>å‰ç«¯ç¼–è¯‘å™¨</strong>ï¼ˆå…¶å®å«&quot;ç¼–è¯‘å™¨çš„å‰ç«¯&quot;æ›´å‡†ç¡®ä¸€äº›ï¼‰å§  <strong>.java</strong> æ–‡ä»¶è½¬å˜æˆ <strong>.class</strong> æ–‡ä»¶çš„è¿‡ç¨‹ã€‚</li><li>ä¹Ÿå¯èƒ½æ˜¯æŒ‡è™šæ‹Ÿæœºçš„<strong>åç«¯è¿è¡ŒæœŸç¼–è¯‘å™¨</strong>ï¼ˆ <strong>JIT ç¼–è¯‘å™¨</strong>ï¼ŒJust In Time Compilerï¼‰æŠŠå­—èŠ‚ç è½¬å˜æˆæœºå™¨ç çš„è¿‡ç¨‹ã€‚</li><li>è¿˜å¯èƒ½æ˜¯æŒ‡ä½¿ç”¨<strong>é™æ€æå‰ç¼–è¯‘å™¨</strong>ï¼ˆAOT ç¼–è¯‘å™¨ï¼ŒAhead of Time Compilerï¼‰ç›´æ¥æŠŠ .java æ–‡ä»¶ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ä»£ç çš„è¿‡ç¨‹ã€‚ï¼ˆå¯èƒ½æ˜¯åç»­å‘å±•çš„è¶‹åŠ¿ï¼‰</li></ul><p><strong>å…¸å‹çš„ç¼–è¯‘å™¨ï¼š</strong></p><ul><li>å‰ç«¯ç¼–è¯‘å™¨ï¼šSun çš„ javacã€Eclipse JDT ä¸­çš„å¢é‡å¼ç¼–è¯‘å™¨ï¼ˆECJï¼‰ã€‚</li><li>JIT ç¼–è¯‘å™¨ï¼šHotSpot VM çš„ C1ã€C2 ç¼–è¯‘å™¨ã€‚</li><li>AOT ç¼–è¯‘å™¨ï¼šGNU Compiler for the Javaï¼ˆGCJï¼‰ã€Excelsior JETã€‚</li></ul><h3 id="ä»€ä¹ˆæ—¶å€™ä¼šé€‰æ‹©JIT">ä»€ä¹ˆæ—¶å€™ä¼šé€‰æ‹©JIT</h3><ul><li>å½“ç„¶æ˜¯å¦éœ€è¦å¯åŠ¨JITç¼–è¯‘å™¨å°†å­—èŠ‚ç ç›´æ¥ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œåˆ™éœ€è¦æ ¹æ®ä»£ç è¢«è°ƒç”¨<strong>æ‰§è¡Œçš„é¢‘ç‡</strong>è€Œå®šã€‚</li><li>å…³äºé‚£äº›éœ€è¦è¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç çš„å­—èŠ‚ç ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸º**â€œçƒ­ç‚¹ä»£ç â€<strong>ï¼ŒJITç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ä¼šé’ˆå¯¹é‚£äº›é¢‘ç¹è¢«è°ƒç”¨çš„â€œçƒ­ç‚¹ä»£ç â€åšå‡º</strong>æ·±åº¦ä¼˜åŒ–**ï¼Œå°†å…¶ç›´æ¥ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œä»¥æ­¤æå‡Javaç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚</li></ul><h4 id="çƒ­ç‚¹ä»£ç åŠæ¢æµ‹æ–¹å¼">çƒ­ç‚¹ä»£ç åŠæ¢æµ‹æ–¹å¼</h4><ul><li><p><strong>ä¸€ä¸ªè¢«å¤šæ¬¡è°ƒç”¨çš„æ–¹æ³•ï¼Œæˆ–è€…æ˜¯ä¸€-ä¸ªæ–¹æ³•ä½“å†…éƒ¨å¾ªç¯æ¬¡æ•°è¾ƒå¤šçš„å¾ªç¯ä½“éƒ½å¯ä»¥è¢«ç§°ä¹‹ä¸º&quot;çƒ­ç‚¹ä»£ç &quot;</strong>ï¼Œå› æ­¤éƒ½å¯ä»¥é€šè¿‡JITç¼–è¯‘å™¨ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤ã€‚ç”±äºè¿™ç§ç¼–è¯‘æ–¹å¼å‘ç”Ÿåœ¨æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¹‹ä¸ºæ ˆä¸Šæ›¿æ¢ï¼Œæˆ–ç®€ç§°ä¸º <strong>OSR (On StackReplacement)ç¼–è¯‘</strong>ã€‚</p></li><li><p>ä¸€ä¸ªæ–¹æ³•ç©¶ç«Ÿè¦<strong>è¢«è°ƒç”¨å¤šå°‘æ¬¡</strong>ï¼Œæˆ–è€…ä¸€ä¸ªå¾ªç¯ä½“ç©¶ç«Ÿéœ€è¦æ‰§è¡Œå¤šå°‘æ¬¡å¾ªç¯æ‰å¯ä»¥è¾¾åˆ°è¿™ä¸ªæ ‡å‡†ï¼Ÿå¿…ç„¶éœ€è¦ä¸€ä¸ªæ˜ç¡®çš„é˜ˆå€¼ï¼ŒJITç¼–è¯‘å™¨æ‰ä¼šå°†è¿™äº›&quot;çƒ­ç‚¹ä»£ç &quot;ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚è¿™é‡Œä¸»è¦ä¾é çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ã€‚</p></li><li><p><strong>ç›®å‰ HotSpot VM æ‰€é‡‡ç”¨çš„çƒ­ç‚¹æ¢æµ‹æ–¹å¼æ˜¯åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹</strong>ã€‚</p></li><li><p>é‡‡ç”¨åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼ŒHotSpot VM å°†ä¼šä¸ºæ¯ä¸€ä¸ªæ–¹æ³•éƒ½å»ºç«‹ 2 ä¸ªä¸åŒç±»å‹çš„è®¡æ•°å™¨ï¼Œåˆ†åˆ«ä¸ºæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼ˆInvocation Counterï¼‰å’Œå›è¾¹è®¡æ•°å™¨ï¼ˆBack Edge Counterï¼‰ã€‚</p><ul><li><p>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ç”¨äºç»Ÿè®¡æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°</p></li><li><p>å›è¾¹è®¡æ•°å™¨åˆ™ç”¨äºç»Ÿè®¡å¾ªç¯ä½“æ‰§è¡Œçš„å¾ªç¯æ¬¡æ•°</p></li></ul></li></ul><h4 id="æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨">æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨</h4><ul><li><p>è¿™ä¸ªè®¡æ•°å™¨å°±ç”¨äºç»Ÿè®¡æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°ï¼Œå®ƒçš„é»˜è®¤é˜€å€¼åœ¨ Client æ¨¡å¼ä¸‹æ˜¯ 1500 æ¬¡ï¼Œåœ¨ Server æ¨¡å¼ä¸‹æ˜¯ 10000 æ¬¡ã€‚è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šè§¦å‘JITç¼–è¯‘ã€‚</p></li><li><p>è¿™ä¸ªé˜€å€¼å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•° <code>-XX:CompileThreshold</code> æ¥äººä¸ºè®¾å®šã€‚</p></li><li><p>å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦å­˜åœ¨è¢«JITç¼–è¯‘è¿‡çš„ç‰ˆæœ¬</p><ul><li><p>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ç¼–è¯‘åçš„æœ¬åœ°ä»£ç æ¥æ‰§è¡Œ</p></li><li><p>å¦‚æœä¸å­˜åœ¨å·²è¢«ç¼–è¯‘è¿‡çš„ç‰ˆæœ¬ï¼Œåˆ™å°†æ­¤æ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å€¼åŠ 1ï¼Œç„¶ååˆ¤æ–­æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ä¸å›è¾¹è®¡æ•°å™¨å€¼ä¹‹å’Œæ˜¯å¦è¶…è¿‡æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨çš„é˜€å€¼ã€‚</p><ul><li>å¦‚æœå·²è¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°†ä¼šå‘å³æ—¶ç¼–è¯‘å™¨æäº¤ä¸€ä¸ªè¯¥æ–¹æ³•çš„ä»£ç ç¼–è¯‘è¯·æ±‚ã€‚</li><li>å¦‚æœæœªè¶…è¿‡é˜ˆå€¼ï¼Œåˆ™ä½¿ç”¨è§£é‡Šå™¨å¯¹å­—èŠ‚ç æ–‡ä»¶è§£é‡Šæ‰§è¡Œ</li></ul></li></ul></li></ul><p><img src="./../jvm-sgg8/image-20231223131454247.png" alt=""></p><h4 id="çƒ­åº¦è¡°å‡">çƒ­åº¦è¡°å‡</h4><ul><li>å¦‚æœä¸åšä»»ä½•è®¾ç½®ï¼Œæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ç»Ÿè®¡çš„å¹¶ä¸æ˜¯æ–¹æ³•è¢«è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ‰§è¡Œé¢‘ç‡ï¼Œå³<strong>ä¸€æ®µæ—¶é—´ä¹‹å†…æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°</strong>ã€‚å½“è¶…è¿‡<strong>ä¸€å®šçš„æ—¶é—´é™åº¦</strong>ï¼Œå¦‚æœæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ä»ç„¶ä¸è¶³ä»¥è®©å®ƒæäº¤ç»™å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œé‚£è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å°±ä¼šè¢«<strong>å‡å°‘ä¸€åŠ</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨çƒ­åº¦çš„<strong>è¡°å‡</strong>ï¼ˆCounter Decayï¼‰ï¼Œè€Œè¿™æ®µæ—¶é—´å°±ç§°ä¸ºæ­¤æ–¹æ³•ç»Ÿè®¡çš„<strong>åŠè¡°å‘¨æœŸï¼ˆCounter Half Life Timeï¼‰</strong>ï¼ˆåŠè¡°å‘¨æœŸæ˜¯åŒ–å­¦ä¸­çš„æ¦‚å¿µï¼Œæ¯”å¦‚å‡ºåœŸçš„æ–‡ç‰©é€šè¿‡æŸ¥çœ‹ C60 æ¥è·å¾—æ–‡ç‰©çš„å¹´é¾„ï¼‰</li><li>è¿›è¡Œçƒ­åº¦è¡°å‡çš„åŠ¨ä½œæ˜¯åœ¨è™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶é¡ºä¾¿è¿›è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•° <code>-XX:-UseCounterDecay </code> æ¥å…³é—­çƒ­åº¦è¡°å‡ï¼Œè®©æ–¹æ³•è®¡æ•°å™¨ç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè¿™æ ·çš„è¯ï¼Œåªè¦ç³»ç»Ÿè¿è¡Œæ—¶é—´è¶³å¤Ÿé•¿ï¼Œç»å¤§éƒ¨åˆ†æ–¹æ³•éƒ½ä¼šè¢«ç¼–è¯‘æˆæœ¬åœ°ä»£ç ã€‚</li><li>å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨ <code>-XX:CounterHalfLifeTime</code> å‚æ•°è®¾ç½®åŠè¡°å‘¨æœŸçš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚</li></ul><h4 id="å›è¾¹è®¡æ•°å™¨">å›è¾¹è®¡æ•°å™¨</h4><p>å®ƒçš„ä½œç”¨æ˜¯ç»Ÿè®¡ä¸€ä¸ªæ–¹æ³•ä¸­<strong>å¾ªç¯ä½“ä»£ç æ‰§è¡Œçš„æ¬¡æ•°</strong>ï¼Œåœ¨å­—èŠ‚ç ä¸­é‡åˆ°æ§åˆ¶æµå‘åè·³è½¬çš„æŒ‡ä»¤ç§°ä¸ºâ€œå›è¾¹â€ï¼ˆBack Edgeï¼‰ã€‚æ˜¾ç„¶ï¼Œå»ºç«‹å›è¾¹è®¡æ•°å™¨ç»Ÿè®¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§¦å‘ OSR ç¼–è¯‘ã€‚</p><p><img src="./../jvm-sgg8/image-20231223131927975.png" alt=""></p><h3 id="HotSpotVMå¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•">HotSpotVMå¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•</h3><p>ç¼ºçœæƒ…å†µä¸‹ HotSpot VM æ˜¯é‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ï¼Œå½“ç„¶å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼Œé€šè¿‡å‘½ä»¤æ˜¾å¼åœ°ä¸ºJavaè™šæ‹ŸæœºæŒ‡å®šåœ¨è¿è¡Œæ—¶åˆ°åº•æ˜¯å®Œå…¨é‡‡ç”¨è§£é‡Šå™¨æ‰§è¡Œï¼Œè¿˜æ˜¯å®Œå…¨é‡‡ç”¨å³æ—¶ç¼–è¯‘å™¨æ‰§è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>-Xintï¼šå®Œå…¨é‡‡ç”¨è§£é‡Šå™¨æ¨¡å¼æ‰§è¡Œç¨‹åºï¼›</li><li>-Xcompï¼šå®Œå…¨é‡‡ç”¨å³æ—¶ç¼–è¯‘å™¨æ¨¡å¼æ‰§è¡Œç¨‹åºã€‚å¦‚æœå³æ—¶ç¼–è¯‘å‡ºç°é—®é¢˜ï¼Œè§£é‡Šå™¨ä¼šä»‹å…¥æ‰§è¡Œ</li><li>-Xmixedï¼šé‡‡ç”¨è§£é‡Šå™¨+å³æ—¶ç¼–è¯‘å™¨çš„æ··åˆæ¨¡å¼å…±åŒæ‰§è¡Œç¨‹åºã€‚</li></ul><p><img src="./../jvm-sgg8/image-20231223132121784.png" alt=""></p><p><strong>demo</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æµ‹è¯•è§£é‡Šå™¨æ¨¡å¼å’ŒJITç¼–è¯‘æ¨¡å¼ *  -Xint  : 6520ms *  -Xcomp : 950ms *  -Xmixed : 936ms */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IntCompTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">testPrimeNumber</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testPrimeNumber</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//è®¡ç®—100ä»¥å†…çš„è´¨æ•°</span>            label<span class="token operator">:</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>j <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>k <span class="token operator">&lt;=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>j <span class="token operator">%</span> k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token keyword">continue</span> label<span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">//System.out.println(j);</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="HotSpotVM-JIT-åˆ†ç±»">HotSpotVM JIT åˆ†ç±»</h3><p>åœ¨ HotSpot VM ä¸­å†…åµŒæœ‰ä¸¤ä¸ªJITç¼–è¯‘å™¨ï¼Œåˆ†åˆ«ä¸º Client Compiler å’Œ Server Compilerï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ç®€ç§°ä¸º C1 ç¼–è¯‘å™¨ å’Œ C2 ç¼–è¯‘å™¨ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ˜¾å¼æŒ‡å®šJavaè™šæ‹Ÿæœºåœ¨è¿è¡Œæ—¶åˆ°åº•ä½¿ç”¨å“ªä¸€ç§å³æ—¶ç¼–è¯‘å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><code>-client</code>ï¼šæŒ‡å®š Java è™šæ‹Ÿæœºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹ï¼Œå¹¶ä½¿ç”¨C1ç¼–è¯‘å™¨<ul><li>C1 ç¼–è¯‘å™¨ä¼šå¯¹å­—èŠ‚ç <strong>è¿›è¡Œç®€å•å’Œå¯é çš„ä¼˜åŒ–ï¼Œè€—æ—¶çŸ­</strong>ï¼Œä»¥è¾¾åˆ°æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦ã€‚</li></ul></li><li><code>-server</code>ï¼šæŒ‡å®š Java è™šæ‹Ÿæœºè¿è¡Œåœ¨ server æ¨¡å¼ä¸‹ï¼Œå¹¶ä½¿ç”¨ C2 ç¼–è¯‘å™¨<ul><li>C2 è¿›è¡Œ<strong>è€—æ—¶è¾ƒé•¿çš„ä¼˜åŒ–ï¼Œä»¥åŠæ¿€è¿›ä¼˜åŒ–</strong>ï¼Œä½†ä¼˜åŒ–çš„ä»£ç æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚ï¼ˆä½¿ç”¨ C++ï¼‰</li></ul></li></ul><h3 id="C1å’ŒC2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥">C1å’ŒC2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥</h3><ul><li>åœ¨ä¸åŒçš„ç¼–è¯‘å™¨ä¸Šæœ‰ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ï¼ŒC1 ç¼–è¯‘å™¨ä¸Šä¸»è¦æœ‰æ–¹æ³•å†…è”ï¼Œå»è™šæ‹ŸåŒ–ã€å…ƒä½™æ¶ˆé™¤ã€‚<ul><li>æ–¹æ³•å†…è”ï¼šå°†å¼•ç”¨çš„å‡½æ•°ä»£ç ç¼–è¯‘åˆ°å¼•ç”¨ç‚¹å¤„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ ˆå¸§çš„ç”Ÿæˆï¼Œå‡å°‘å‚æ•°ä¼ é€’ä»¥åŠè·³è½¬è¿‡ç¨‹</li><li>å»è™šæ‹ŸåŒ–ï¼šå¯¹å”¯ä¸€çš„å®ç°æ¨Šè¿›è¡Œå†…è”</li><li>å†—ä½™æ¶ˆé™¤ï¼šåœ¨è¿è¡ŒæœŸé—´æŠŠä¸€äº›ä¸ä¼šæ‰§è¡Œçš„ä»£ç æŠ˜å æ‰</li></ul></li><li>C2 çš„ä¼˜åŒ–ä¸»è¦æ˜¯åœ¨å…¨å±€å±‚é¢ï¼Œé€ƒé€¸åˆ†ææ˜¯ä¼˜åŒ–çš„åŸºç¡€ã€‚åŸºäºé€ƒé€¸åˆ†æåœ¨ C2 ä¸Šæœ‰å¦‚ä¸‹å‡ ç§ä¼˜åŒ–ï¼š<ul><li>æ ‡é‡æ›¿æ¢ï¼šç”¨æ ‡é‡å€¼ä»£æ›¿èšåˆå¯¹è±¡çš„å±æ€§å€¼</li><li>æ ˆä¸Šåˆ†é…ï¼šå¯¹äºæœªé€ƒé€¸çš„å¯¹è±¡åˆ†é…å¯¹è±¡åœ¨æ ˆè€Œä¸æ˜¯å †</li><li>åŒæ­¥æ¶ˆé™¤ï¼šæ¸…é™¤åŒæ­¥æ“ä½œï¼Œé€šå¸¸æŒ‡ synchronized</li></ul></li></ul><p><strong>åˆ†å±‚ç¼–è¯‘ç­–ç•¥</strong></p><ul><li>åˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ç­–ç•¥ï¼šç¨‹åºè§£é‡Šæ‰§è¡Œï¼ˆä¸å¼€å¯æ€§èƒ½ç›‘æ§ï¼‰å¯ä»¥è§¦å‘ C1 ç¼–è¯‘ï¼Œå°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ï¼Œå¯ä»¥è¿›è¡Œç®€å•ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šæ€§èƒ½ç›‘æ§ï¼ŒC2 ç¼–è¯‘ä¼šæ ¹æ®æ€§èƒ½ç›‘æ§ä¿¡æ¯è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ã€‚</li><li>ä¸è¿‡åœ¨ Java7 ç‰ˆæœ¬ä¹‹åï¼Œä¸€æ—¦å¼€å‘äººå‘˜åœ¨ç¨‹åºä¸­æ˜¾å¼æŒ‡å®šå‘½ä»¤ <code>-server</code> æ—¶ï¼Œé»˜è®¤å°†ä¼šå¼€å¯åˆ†å±‚ç¼–è¯‘ç­–ç•¥ï¼Œç”± C1 ç¼–è¯‘å™¨å’Œ C2 ç¼–è¯‘å™¨ç›¸äº’åä½œå…±åŒæ¥æ‰§è¡Œç¼–è¯‘ä»»åŠ¡ã€‚</li></ul><p><strong>æ€»ç»“</strong></p><ul><li>ä¸€èˆ¬æ¥è®²ï¼ŒJIT ç¼–è¯‘å‡ºæ¥çš„æœºå™¨ç æ€§èƒ½æ¯”è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œçš„æ€§èƒ½é«˜</li><li>C2 ç¼–è¯‘å™¨å¯åŠ¨æ—¶é•¿æ¯” C1 æ…¢ï¼Œç³»ç»Ÿç¨³å®šæ‰§è¡Œä»¥åï¼ŒC2 ç¼–è¯‘å™¨æ‰§è¡Œé€Ÿåº¦è¿œå¿«äº C1 ç¼–è¯‘å™¨</li></ul><h3 id="è¡¥å……">è¡¥å……</h3><h4 id="Graal-ç¼–è¯‘å™¨">Graal ç¼–è¯‘å™¨</h4><ul><li><p>è‡ª JDK10 èµ·ï¼ŒHotSpot åˆåŠ å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å³æ—¶ç¼–è¯‘å™¨ï¼šGraal ç¼–è¯‘å™¨</p></li><li><p>ç¼–è¯‘æ•ˆæœçŸ­çŸ­å‡ å¹´æ—¶é—´å°±è¿½å¹³äº† G2 ç¼–è¯‘å™¨ï¼Œæœªæ¥å¯æœŸï¼ˆå¯¹åº”è¿˜å‡ºç°äº† Graal è™šæ‹Ÿæœºï¼Œæ˜¯æœ‰å¯èƒ½æ›¿ä»£ Hotspot çš„è™šæ‹Ÿæœºçš„ï¼‰</p></li><li><p>ç›®å‰ï¼Œå¸¦ç€&quot;å®éªŒçŠ¶æ€&quot;æ ‡ç­¾ï¼Œéœ€è¦ä½¿ç”¨å¼€å…³å‚æ•°å»æ¿€æ´»æ‰èƒ½ä½¿ç”¨</p><p><code>-XX:+UnlockExperimentalvMOptions</code> <code>- XX:+UseJVMCICompiler</code></p></li></ul><h4 id="AOTç¼–è¯‘å™¨">AOTç¼–è¯‘å™¨</h4><ul><li><p>jdk9 å¼•å…¥äº† AOT ç¼–è¯‘å™¨ï¼ˆé™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead of Time Compilerï¼‰</p></li><li><p>Java 9 å¼•å…¥äº†å®éªŒæ€§ AOT ç¼–è¯‘å·¥å…· jaotcã€‚å®ƒå€ŸåŠ©äº† Graal ç¼–è¯‘å™¨ï¼Œå°†æ‰€è¾“å…¥çš„ Java ç±»æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜æ”¾è‡³ç”Ÿæˆçš„åŠ¨æ€å…±äº«åº“ä¹‹ä¸­ã€‚</p></li><li><p>æ‰€è°“ AOT ç¼–è¯‘ï¼Œæ˜¯ä¸å³æ—¶ç¼–è¯‘ç›¸å¯¹ç«‹çš„ä¸€ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå³æ—¶ç¼–è¯‘æŒ‡çš„æ˜¯<strong>åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­</strong>ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºå¯åœ¨ç¡¬ä»¶ä¸Šç›´æ¥è¿è¡Œçš„æœºå™¨ç ï¼Œå¹¶éƒ¨ç½²è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„è¿‡ç¨‹ã€‚è€Œ AOT ç¼–è¯‘æŒ‡çš„åˆ™æ˜¯ï¼Œ<strong>åœ¨ç¨‹åºè¿è¡Œä¹‹å‰</strong>ï¼Œä¾¿å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç çš„è¿‡ç¨‹ã€‚</p><p>.java -&gt; .class -&gt; (ä½¿ç”¨jaotc) -&gt; .so</p></li></ul><p><strong>AOT å¥½å¤„</strong></p><ul><li>Java è™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚</li><li>ä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘ Java åº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€ çš„ä¸è‰¯ä½“éªŒ</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>ç ´åäº† Java â€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªä¸åŒçš„ç¡¬ä»¶ï¼ŒOS ç¼–è¯‘å¯¹åº”çš„å‘è¡ŒåŒ…</li><li>é™ä½äº† Java é“¾æ¥è¿‡ç¨‹çš„åŠ¨æ€æ€§ï¼ŒåŠ è½½çš„ä»£ç åœ¨ç¼–è¯‘å™¨å°±å¿…é¡»å…¨éƒ¨å·²çŸ¥ã€‚</li><li>è¿˜éœ€è¦ç»§ç»­ä¼˜åŒ–ä¸­ï¼Œæœ€åˆåªæ”¯æŒ Linux X64 java base</li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-07-å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½</title>
      <link href="/2023/12/21/jvm-sgg7/"/>
      <url>/2023/12/21/jvm-sgg7/</url>
      
        <content type="html"><![CDATA[<h1>å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½</h1><h2 id="1-å¯¹è±¡çš„å®ä¾‹åŒ–">1-å¯¹è±¡çš„å®ä¾‹åŒ–</h2><ul><li>å¯¹è±¡åœ¨ JVM ä¸­æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ</li><li>å¯¹è±¡å¤´ä¿¡æ¯é‡Œé¢æœ‰å“ªäº›ä¸œè¥¿ï¼Ÿ</li><li>Java å¯¹è±¡å¤´é‡Œæœ‰ä»€ä¹ˆ</li></ul><div class="markmap-container" style="height:height">  <svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;å¯¹è±¡çš„å®ä¾‹åŒ–&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;åˆ›å»ºå¯¹è±¡çš„æ–¹å¼&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;new&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;æœ€å¸¸è§æ–¹å¼&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;å˜å½¢1: Xxxçš„é™æ€æ–¹æ³•&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;å˜å½¢2: XxxBuilder/XxxFactoryçš„é™æ€æ–¹æ³•&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;&lt;code&gt;Class&lt;/code&gt;çš„&lt;code&gt;newInstance()&lt;/code&gt;: åå°„æ–¹å¼, åªèƒ½è°ƒç”¨ç©ºå‚çš„æ„é€ å™¨, æƒé™å¿…é¡»æ—¶public&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;&lt;code&gt;Constructor&lt;/code&gt;çš„&lt;code&gt;newInstance(Xxx)&lt;/code&gt;: åå°„æ–¹å¼, å¯ä»¥è°ƒç”¨ç©ºå‚ã€å¸¦å‚çš„æ„é€ å™¨, æƒé™æ²¡æœ‰è¦æ±‚&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;ä½¿ç”¨&lt;code&gt;clone()&lt;/code&gt;: ä¸é€‚ç”¨ä»»ä½•æ„é€ å™¨, å½“å‰ç±»éœ€è¦å®ç°Cloneableæ¥å£, å®ç°&lt;code&gt;clone()&lt;/code&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;ä½¿ç”¨ååºåˆ—åŒ–: ä»æ–‡ä»¶ã€ç½‘ç»œä¸­è·å–ä¸€ä¸ªå¯¹è±¡çš„äºŒè¿›åˆ¶æµ&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;ç¬¬ä¸‰æ–¹åº“&lt;code&gt;Objenesis&lt;/code&gt;&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;åˆ›å»ºå¯¹è±¡çš„æ­¥éª¤&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;1ã€&lt;a href=\&quot;#åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–\&quot;&gt;åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–&lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;2ã€&lt;a href=\&quot;#ä¸ºå¯¹è±¡åˆ†é…å†…å­˜\&quot;&gt;ä¸ºå¯¹è±¡åˆ†é…å†…å­˜&lt;/a&gt;&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;å¦‚æœå†…å­˜è§„æ•´&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;&lt;a href=\&quot;#æŒ‡é’ˆç¢°æ’\&quot;&gt;æŒ‡é’ˆç¢°æ’&lt;/a&gt;&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;å¦‚æœå†…å­˜ä¸è§„æ•´&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;è™šæ‹Ÿæœºéœ€è¦ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;&lt;a href=\&quot;#ç©ºé—²åˆ—è¡¨åˆ†é…\&quot;&gt;ç©ºé—²åˆ—è¡¨åˆ†é…&lt;/a&gt;&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[20,21]},&quot;v&quot;:&quot;&lt;a href=\&quot;#è¯´æ˜\&quot;&gt;è¯´æ˜&lt;/a&gt;&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;3ã€å¤„ç†å¹¶å‘å®‰å…¨é—®é¢˜&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[22,23]},&quot;v&quot;:&quot;é‡‡ç”¨&lt;code&gt;CAS&lt;/code&gt;é…ä¸Šå¤±è´¥é‡è¯•ä¿è¯æ›´æ–°çš„åŸå­æ€§&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;æ¯ä¸ªçº¿ç¨‹é¢„å…ˆåˆ†é…ä¸€å—TLAB&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[24,25]},&quot;v&quot;:&quot;é€šè¿‡&lt;code&gt;-XX:+/-UseTLAB&lt;/code&gt;å‚æ•°æ¥è®¾å®š(JDK8é»˜è®¤ä½¿ç”¨)&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[25,26]},&quot;v&quot;:&quot;4ã€åˆå§‹åŒ–åˆ†é…åˆ°çš„ç©ºé—´&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[26,27]},&quot;v&quot;:&quot;æ‰€æœ‰å±æ€§è®¾ç½®é»˜è®¤å€¼, ä¿è¯å¯¹è±¡å®ä¾‹å­—æ®µåœ¨ä¸èµ‹å€¼æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[27,28]},&quot;v&quot;:&quot;5ã€&lt;a href=\&quot;#è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´\&quot;&gt;è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´&lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[28,29]},&quot;v&quot;:&quot;6ã€&lt;a href=\&quot;#æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–\&quot;&gt;æ‰§è¡Œ&lt;code&gt;init&lt;/code&gt;æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–&lt;/a&gt;&quot;}]}]}"></svg></div><h6 id="åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–"><strong>åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–</strong></h6><ul><li><p>è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤ï¼Œé¦–å…ˆå»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°èƒ½å¦åœ¨Metaspaceçš„å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œè§£æå’Œåˆå§‹åŒ–ã€‚ï¼ˆå³åˆ¤æ–­ç±»å…ƒä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼‰ã€‚</p></li><li><p>å¦‚æœè¯¥ç±»æ²¡æœ‰åŠ è½½ï¼Œé‚£ä¹ˆåœ¨åŒäº²å§”æ´¾æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨ä»¥ClassLoader + åŒ…å + ç±»åä¸ºkeyè¿›è¡ŒæŸ¥æ‰¾å¯¹åº”çš„.classæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ï¼Œåˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œç±»åŠ è½½ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡ã€‚</p></li></ul><h6 id="ä¸ºå¯¹è±¡åˆ†é…å†…å­˜"><strong>ä¸ºå¯¹è±¡åˆ†é…å†…å­˜</strong></h6><p>é¦–å…ˆè®¡ç®—å¯¹è±¡å ç”¨ç©ºé—´çš„å¤§å°ï¼Œæ¥ç€åœ¨å †ä¸­åˆ’åˆ†ä¸€å—å†…å­˜ç»™æ–°å¯¹è±¡ã€‚å¦‚æœå®ä¾‹æˆå‘˜å˜é‡æ˜¯å¼•ç”¨å˜é‡ï¼Œä»…åˆ†é…å¼•ç”¨å˜é‡ç©ºé—´å³å¯ï¼Œå³4ä¸ªå­—èŠ‚å¤§å°</p><h6 id="æŒ‡é’ˆç¢°æ’"><strong>æŒ‡é’ˆç¢°æ’</strong></h6><ul><li>å¦‚æœå†…å­˜æ˜¯è§„æ•´çš„ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†é‡‡ç”¨çš„æ˜¯æŒ‡é’ˆç¢°æ’æ³•ï¼ˆBump The Pointï¼‰æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚</li><li>æ„æ€æ˜¯æ‰€æœ‰ç”¨è¿‡çš„å†…å­˜åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾å¦å¤–ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œåˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠæŒ‡é’ˆå¾€ç©ºé—²å†…å­˜é‚£è¾¹æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ç½¢äº†ã€‚</li><li>å¦‚æœåƒåœ¾æ”¶é›†å™¨é€‰æ‹©çš„æ˜¯ Serial ï¼ŒParNew è¿™ç§åŸºäºå‹ç¼©ç®—æ³•çš„ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨è¿™ç§åˆ†é…æ–¹å¼ã€‚ä¸€èˆ¬ä½¿ç”¨å¸¦ Compactï¼ˆæ•´ç†ï¼‰è¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œä½¿ç”¨æŒ‡é’ˆç¢°æ’ã€‚</li><li>æ ‡è®°å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•ä¼šæ•´ç†å†…å­˜ç¢ç‰‡ï¼Œå †å†…å­˜ä¸€å­˜å¯¹è±¡ï¼Œå¦ä¸€è¾¹ä¸ºç©ºé—²åŒºåŸŸ</li></ul><h6 id="ç©ºé—²åˆ—è¡¨åˆ†é…"><strong>ç©ºé—²åˆ—è¡¨åˆ†é…</strong></h6><ul><li>å¦‚æœå†…å­˜ä¸æ˜¯è§„æ•´çš„ï¼Œå·²ä½¿ç”¨çš„å†…å­˜å’Œæœªä½¿ç”¨çš„å†…å­˜ç›¸äº’äº¤é”™ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†é‡‡ç”¨çš„æ˜¯ç©ºé—²åˆ—è¡¨æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚</li><li>æ„æ€æ˜¯è™šæ‹Ÿæœºç»´æŠ¤äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œå†åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„å†…å®¹ã€‚è¿™ç§åˆ†é…æ–¹å¼æˆä¸ºäº† <strong>ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰</strong></li><li>CMS æ ‡è®°æ¸…é™¤ç®—æ³•æ¸…ç†è¿‡åçš„å †å†…å­˜ï¼Œå°±ä¼šå­˜åœ¨å¾ˆå¤šå†…å­˜ç¢ç‰‡ã€‚</li></ul><h6 id="è¯´æ˜"><strong>è¯´æ˜</strong></h6><ul><li>é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´æ‰€å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š</li></ul><h6 id="è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´"><strong>è®¾ç½®å¯¹è±¡çš„å¯¹è±¡å¤´</strong></h6><p>å°†å¯¹è±¡çš„æ‰€å±ç±»(å³ç±»çš„å…ƒæ•°æ®ä¿¡æ¯)ã€å¯¹è±¡çš„HashCodeå’Œå¯¹è±¡çš„GCä¿¡æ¯ã€é”ä¿¡æ¯ç­‰æ•°æ®å­˜å‚¨åœ¨å¯¹è±¡çš„å¯¹è±¡å¤´. è¿™ä¸ªè¿‡ç¨‹çš„å…·ä½“è®¾ç½®æ–¹å¼å–å†³äºJVMå®ç°.</p><h6 id="æ‰§è¡Œ-init-æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–"><strong>æ‰§è¡Œ init æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–</strong></h6><ul><li>åœ¨ Java ç¨‹åºçš„è§†è§’çœ‹æ¥ï¼Œåˆå§‹åŒ–æ‰æ­£å¼å¼€å§‹ã€‚åˆå§‹åŒ–æˆå‘˜å˜é‡ï¼Œæ‰§è¡Œå®ä¾‹åŒ–ä»£ç å—ï¼Œè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¹¶æŠŠå †å†…å¯¹è±¡çš„é¦–åœ°å€èµ‹å€¼ç»™å¼•ç”¨å˜é‡</li><li>å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼ˆç”±å­—èŠ‚ç ä¸­è·Ÿéš <code>invokespecial</code> æŒ‡ä»¤æ‰€å†³å®šï¼‰ï¼Œ<code>new</code> æŒ‡ä»¤ä¹‹åä¼šæ¥ç€å°±æ˜¯æ‰§è¡Œ <code>init</code> æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œæˆåˆ›å»ºå‡ºæ¥ã€‚</li></ul><h2 id="2-å¯¹è±¡çš„å†…å­˜å¸ƒå±€">2-å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h2><div class="markmap-container" style="height:height">  <svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;å†…éƒ¨å¸ƒå±€&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;å¯¹è±¡å¤´(Header)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;åŒ…å«ä¸¤éƒ¨åˆ†&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;è¿è¡Œæ—¶å…ƒæ•°æ®(Mark Word)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;å“ˆå¸Œå€¼(HashCode)&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;GCåˆ†ä»£å¹´é¾„&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;é”çŠ¶æ€æ ‡å¿—&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;çº¿ç¨‹æŒæœ‰çš„é”&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;åå‘çº¿ç¨‹ID&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;åå‘æ—¶é—´æˆ³&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;ç±»å‹æŒ‡é’ˆ&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;æŒ‡å‘ç±»å…ƒæ•°æ®InstanceKlass, ç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;è¯´æ˜: å¦‚æœæ˜¯æ•°ç»„, è¿˜éœ€è®°å½•æ•°ç»„çš„é•¿åº¦&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;å®ä¾‹æ•°æ®(Instance Data)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;è¯´æ˜&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;å®ƒæ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯, åŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ(åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ)&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;è§„åˆ™&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;ç›¸åŒå®½åº¦çš„å­—æ®µæ€»æ˜¯è¢«åˆ†é…åœ¨ä¸€èµ·&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;çˆ¶ç±»ä¸­å®šä¹‰çš„å˜é‡ä¼šå‡ºç°åœ¨å­ç±»ä¹‹å‰&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[20,21]},&quot;v&quot;:&quot;å¦‚æœCompactFieldså‚æ•°ä¸ºtrue(é»˜è®¤ä¸ºtrue): å­ç±»çš„å®…å˜é‡å¯èƒ½æ’å…¥åˆ°çˆ¶ç±»å˜é‡çš„ç©ºéš™&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;å¯¹é½å¡«å……(Padding)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[22,23]},&quot;v&quot;:&quot;ä¸æ˜¯å¿…é¡»çš„, ä¹Ÿæ²¡ç‰¹åˆ«å«ä¹‰, ä»…ä»…èµ·åˆ°å ä½ç¬¦çš„ä½œç”¨&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;å°ç»“&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[24,25]},&quot;v&quot;:&quot;&lt;a href=\&quot;#å†…å­˜å¸ƒå±€å›¾\&quot;&gt;å†…å­˜å¸ƒå±€å›¾&lt;/a&gt;&quot;}]}]}"></svg></div><p>ä»£ç ç¤ºä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token class-name">Account</span> acct<span class="token punctuation">;</span>    <span class="token punctuation">&#123;</span>        name <span class="token operator">=</span> <span class="token string">"åŒ¿åå®¢æˆ·"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        acct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Customer</span> cust <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="å†…å­˜å¸ƒå±€å›¾"><img src="./../jvm-sgg7/image-20231222200603079.png" alt="å†…å­˜å¸ƒå±€å›¾"></h6><h2 id="3-å¯¹è±¡çš„è®¿é—®å®šä½">3-å¯¹è±¡çš„è®¿é—®å®šä½</h2><blockquote><p>JVM æ˜¯å¦‚ä½•é€šè¿‡æ ˆå¸§ä¸­çš„å¯¹è±¡å¼•ç”¨è®¿é—®åˆ°å…¶å†…éƒ¨çš„å¯¹è±¡å®ä¾‹å‘¢ï¼Ÿ</p></blockquote><div class="markmap-container" style="height:height">  <svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;å¯¹è±¡è®¿é—®å®šä½&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;&lt;a href=\&quot;#å¯¹è±¡è®¿é—®å®šä½\&quot;&gt;å›¾ç¤º&lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;å¸¸è§å¯¹è±¡çš„ç›®çš„æ˜¯ä¸ºäº†ä½¿ç”¨å®ƒ&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;JVMæ˜¯å¦‚ä½•é€šè¿‡æ ˆå¸§ä¸­çš„å¯¹è±¡å¼•ç”¨è®¿é—®åˆ°å…¶ä»–å†…éƒ¨çš„å¯¹è±¡å®ä¾‹çš„å‘¢?&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;å®šä½, é€šè¿‡æ ˆä¸Šreferenceè®¿é—®&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;å¯¹è±¡è®¿é—®ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;è®¿é—®å¥æŸ„&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;&lt;a href=\&quot;#è®¿é—®å¥æŸ„\&quot;&gt;å›¾ç¤º&lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;å® ç°&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;å¥½å¤„&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;referenceä¸­å­˜å‚¨ç¨³å®šå¥æŸ„åœ°å€ï¼Œå¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡å¾ˆæ™®éï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­å®ä¾‹æ•°æ®æŒ‡é’ˆå³å¯ï¼Œreferenceæœ¬èº«ä¸éœ€è¦è¢«ä¿®æ”¹&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;ç›´æ¥æŒ‡é’ˆ(Hotspoté‡‡ç”¨)&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;&lt;a href=\&quot;#ç›´æ¥æŒ‡é’ˆ\&quot;&gt;å›¾ç¤º&lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;å®ç°&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;å¥½å¤„&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;ç›´æ¥æŒ‡é’ˆæ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­çš„å¼•ç”¨ï¼Œç›´æ¥æŒ‡å‘å †ä¸­çš„å®ä¾‹ï¼Œåœ¨å¯¹è±¡å®ä¾‹ä¸­æœ‰ç±»å‹æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯æ–¹æ³•åŒºä¸­çš„å¯¹è±¡ç±»å‹æ•°æ®&quot;}]}]}]}]}"></svg></div><h6 id="å¯¹è±¡è®¿é—®å®šä½"><img src="./../jvm-sgg7/image-20231222203611227.png" alt="å¯¹è±¡è®¿é—®å®šä½"></h6><h6 id="è®¿é—®å¥æŸ„"><img src="./../jvm-sgg7/image-20231222204209752.png" alt="è®¿é—®å¥æŸ„"></h6><h6 id="ç›´æ¥æŒ‡é’ˆ"><img src="./../jvm-sgg7/image-20231222204438850.png" alt="ç›´æ¥æŒ‡é’ˆ"></h6><h1>ç›´æ¥å†…å­˜</h1><h2 id="æ¦‚è¿°">æ¦‚è¿°</h2><h3 id="ç›´æ¥å†…å­˜">ç›´æ¥å†…å­˜</h3><p><strong>(Direct Memory)</strong></p><ul><li><p>ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚</p></li><li><p>ç›´æ¥å†…å­˜æ˜¯åœ¨Javaå †å¤–çš„ã€ç›´æ¥å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜åŒºé—´ã€‚</p></li><li><p>æ¥æºäº NIOï¼Œé€šè¿‡å­˜åœ¨å †ä¸­çš„ DirectByteBuffer æ“ä½œ Native å†…å­˜</p></li><li><p>é€šå¸¸ï¼Œè®¿é—®ç›´æ¥å†…å­˜çš„é€Ÿåº¦ä¼šä¼˜äº Java å †ã€‚å³è¯»å†™æ€§èƒ½é«˜ã€‚</p><ul><li>å› æ­¤å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œè¯»å†™é¢‘ç¹çš„åœºåˆå¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨ç›´æ¥å†…å­˜ã€‚</li><li>Java çš„ NIO åº“å…è®¸ Java ç¨‹åºä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒº</li></ul></li></ul><h3 id="NIO-ä¸-BIO">NIO ä¸ BIO</h3><p><strong>éç›´æ¥ç¼“å­˜åŒº(BIO)</strong></p><ul><li>è¯»å†™æ–‡ä»¶, éœ€è¦ä¸ç£ç›˜äº¤äº’, éœ€è¦ç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€. åœ¨å†…æ ¸æ€æ—¶, éœ€è¦å†…å­˜å¦‚ä¸‹å›¾çš„æ“ä½œ</li><li>ä½¿ç”¨IO, è¿™é‡Œéœ€è¦ä¸¤ä»½å†…å­˜å­˜å‚¨é‡å¤æ•°æ®, æ•ˆç‡ä½</li></ul><p><img src="./../jvm-sgg7/image-20231222210605746.png" alt=""></p><p><strong>ç›´æ¥ç¼“å†²åŒº(NIO)</strong></p><ul><li>ä½¿ç”¨ NIO æ—¶, å¦‚ä¸‹å›¾. æ“ä½œç³»ç»Ÿåˆ’å‡ºçš„ç›´æ¥ç¼“å­˜åŒºå¯ä»¥è¢« Java ä»£ç ç›´æ¥è®¿é—®, åªæœ‰ä¸€ä»½. NIO é€‚åˆå †å¤§æ–‡ä»¶çš„è¯»å†™æ“ä½œ</li></ul><p><img src="./../jvm-sgg7/image-20231222211252472.png" alt=""></p><h3 id="ç›´æ¥å†…å­˜ä¸OOM">ç›´æ¥å†…å­˜ä¸OOM</h3><ul><li><p>ç›´æ¥å†…å­˜ä¹Ÿå¯èƒ½å¯¼è‡´ OutofMemoryError å¼‚å¸¸</p></li><li><p>ç”±äºç›´æ¥å†…å­˜åœ¨Javaå †å¤–ï¼Œå› æ­¤å®ƒçš„å¤§å°ä¸ä¼šç›´æ¥å—é™äº -Xmx æŒ‡å®šçš„æœ€å¤§å †å¤§å°ï¼Œä½†æ˜¯ç³»ç»Ÿå†…å­˜æ˜¯æœ‰é™çš„ï¼ŒJava å †å’Œç›´æ¥å†…å­˜çš„æ€»å’Œä¾ç„¶å—é™äºæ“ä½œç³»ç»Ÿèƒ½ç»™å‡ºçš„æœ€å¤§å†…å­˜ã€‚</p></li><li><p>ç›´æ¥å†…å­˜çš„ç¼ºç‚¹ä¸ºï¼š</p><ul><li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜</li><li>ä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†</li></ul></li><li><p>ç›´æ¥å†…å­˜å¤§å°å¯ä»¥é€šè¿‡ MaxDirectMemorySize è®¾ç½®</p></li><li><p>å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸å †çš„æœ€å¤§å€¼ -Xmx å‚æ•°å€¼ä¸€è‡´</p></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æœ¬åœ°å†…å­˜çš„OOM:  OutOfMemoryError: Direct buffer memory * */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BufferTest2</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BUFFER</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">//20MB</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token constant">BUFFER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                count<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg7/image-20231222212504204.png" alt=""></p><p><strong>ç®€å•ç†è§£</strong></p><p>Java process memory = Java heap + native memory</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NIO </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-06-æ–¹æ³•åŒº</title>
      <link href="/2023/12/19/jvm-sgg6/"/>
      <url>/2023/12/19/jvm-sgg6/</url>
      
        <content type="html"><![CDATA[<h1>æ–¹æ³•åŒº</h1><h2 id="1-æ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»">1-æ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»</h2><p><img src="../jvm-sgg6/001.png" alt="è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„å›¾"></p><p><img src="../jvm-sgg6/002.png" alt="çº¿ç¨‹å…±äº«ä¸å¦çš„è§’åº¦"></p><p><img src="./../jvm-sgg6/003.png" alt="ä¸‰è€…é—´çš„ç›¸äº’å…³ç³»"></p><h2 id="2-æ–¹æ³•åŒºçš„ç†è§£">2-æ–¹æ³•åŒºçš„ç†è§£</h2><h3 id="æ–¹æ³•åŒºåœ¨å“ªé‡Œ">æ–¹æ³•åŒºåœ¨å“ªé‡Œ?</h3><ul><li>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®è¯´æ˜ï¼šå°½ç®¡æ‰€æœ‰çš„æ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šæ˜¯å±äºå †çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸€äº›ç®€å•çš„å®ç°å¯èƒ½ä¸ä¼šé€‰æ‹©å»è¿›è¡Œåƒåœ¾æ”¶é›†æˆ–è€…è¿›è¡Œå‹ç¼©ã€‚ä½†å¯¹äº HotSpotJVM è€Œè¨€ï¼Œæ–¹æ³•åŒºè¿˜æœ‰ä¸€ä¸ªåˆ«åå«åšNon-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„å°±æ˜¯è¦å’Œå †åˆ†å¼€ã€‚</li><li>æ‰€ä»¥ï¼Œ<strong>æ–¹æ³•åŒºå¯ä»¥çœ‹ä½œæ˜¯ä¸€å—ç‹¬ç«‹äº Java å †çš„å†…å­˜ç©ºé—´</strong>ã€‚</li></ul><p><img src="./../jvm-sgg6/004.png" alt=""></p><h3 id="æ–¹æ³•åŒºçš„åŸºæœ¬ç†è§£">æ–¹æ³•åŒºçš„åŸºæœ¬ç†è§£</h3><p><strong>æ–¹æ³•åŒºä¸»è¦å­˜æ”¾çš„æ˜¯ Classï¼Œè€Œå †ä¸­ä¸»è¦å­˜æ”¾çš„æ˜¯å®ä¾‹åŒ–çš„å¯¹è±¡</strong></p><ul><li>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸ Java å †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚å¤šä¸ªçº¿ç¨‹åŒæ—¶åŠ è½½ç»Ÿä¸€ä¸ªç±»æ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åŠ è½½è¯¥ç±»ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½ç­‰ç­‰å¾…è¯¥çº¿ç¨‹åŠ è½½å®Œæ¯•ï¼Œç„¶åç›´æ¥ä½¿ç”¨è¯¥ç±»ï¼Œå³ç±»åªèƒ½åŠ è½½ä¸€æ¬¡ã€‚</li><li>æ–¹æ³•åŒºåœ¨ JVM å¯åŠ¨çš„æ—¶å€™è¢«åˆ›å»ºï¼Œå¹¶ä¸”å®ƒçš„å®é™…çš„ç‰©ç†å†…å­˜ç©ºé—´ä¸­å’Œ Java å †åŒºä¸€æ ·éƒ½å¯ä»¥æ˜¯ä¸è¿ç»­çš„ã€‚</li><li>æ–¹æ³•åŒºçš„å¤§å°ï¼Œè·Ÿå †ç©ºé—´ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‰©å±•ã€‚</li><li>æ–¹æ³•åŒºçš„å¤§å°å†³å®šäº†ç³»ç»Ÿå¯ä»¥ä¿å­˜å¤šå°‘ä¸ªç±»ï¼Œå¦‚æœç³»ç»Ÿå®šä¹‰äº†å¤ªå¤šçš„ç±»ï¼Œå¯¼è‡´æ–¹æ³•åŒºæº¢å‡ºï¼Œè™šæ‹ŸæœºåŒæ ·ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºé”™è¯¯ï¼š<code>java.lang.OutofMemoryError:PermGen space</code>æˆ–è€…<code>java.lang.OutOfMemoryError:Metaspace</code><ul><li>åŠ è½½å¤§é‡çš„ç¬¬ä¸‰æ–¹çš„jaråŒ…</li><li>Tomcat éƒ¨ç½²çš„å·¥ç¨‹è¿‡å¤šï¼ˆ30~50ä¸ªï¼‰</li><li>å¤§é‡åŠ¨æ€çš„ç”Ÿæˆåå°„ç±»</li></ul></li><li>å…³é—­ JVM å°±ä¼šé‡Šæ”¾è¿™ä¸ªåŒºåŸŸçš„å†…å­˜ã€‚</li></ul><h3 id="æ–¹æ³•åŒºè§‚å¯Ÿç¤ºä¾‹">æ–¹æ³•åŒºè§‚å¯Ÿç¤ºä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodAreaDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"end..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg6/005.png" alt=""></p><h3 id="HotSpotæ–¹æ³•åŒºæ¼”è¿›">HotSpotæ–¹æ³•åŒºæ¼”è¿›</h3><ul><li>åœ¨ JDK7 åŠä»¥å‰ï¼Œä¹ æƒ¯ä¸ŠæŠŠæ–¹æ³•åŒºï¼Œç§°ä¸ºæ°¸ä¹…ä»£ã€‚JDK8 å¼€å§‹ï¼Œä½¿ç”¨å…ƒç©ºé—´å–ä»£äº†æ°¸ä¹…ä»£ã€‚æˆ‘ä»¬å¯ä»¥å°†æ–¹æ³•åŒºç±»æ¯”ä¸º Java ä¸­çš„æ¥å£ï¼Œå°†æ°¸ä¹…ä»£æˆ–å…ƒç©ºé—´ç±»æ¯”ä¸º Java ä¸­å…·ä½“çš„å®ç°ç±»</li><li>æœ¬è´¨ä¸Šï¼Œæ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£å¹¶ä¸ç­‰ä»·ã€‚ä»…æ˜¯å¯¹ Hotspot è€Œè¨€çš„å¯ä»¥çœ‹ä½œç­‰ä»·ã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹å¦‚ä½•å®ç°æ–¹æ³•åŒºï¼Œä¸åšç»Ÿä¸€è¦æ±‚ã€‚ä¾‹å¦‚ï¼šBEAJRockit / IBM J9 ä¸­ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µã€‚<ul><li>ç°åœ¨æ¥çœ‹ï¼Œå½“å¹´ä½¿ç”¨æ°¸ä¹…ä»£ï¼Œä¸æ˜¯å¥½çš„ ideaã€‚å¯¼è‡´ Java ç¨‹åºæ›´å®¹æ˜“ OOMï¼ˆè¶…è¿‡-XX:MaxPermsizeä¸Šé™ï¼‰</li></ul></li></ul><p><img src="./../jvm-sgg6/006.png" alt=""></p><ul><li>è€Œåˆ°äº† JDK8ï¼Œç»ˆäºå®Œå…¨åºŸå¼ƒäº†æ°¸ä¹…ä»£çš„æ¦‚å¿µï¼Œæ”¹ç”¨ä¸ JRockitã€J9 ä¸€æ ·åœ¨æœ¬åœ°å†…å­˜ä¸­å®ç°çš„å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰æ¥ä»£æ›¿</li></ul><p><img src="./../jvm-sgg6/007.png" alt=""></p><ul><li>å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ JVM è§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚ä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š<strong>å…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜</strong>ã€‚</li><li>æ°¸ä¹…ä»£ã€å…ƒç©ºé—´äºŒè€…å¹¶ä¸åªæ˜¯åå­—å˜äº†ï¼Œå†…éƒ¨ç»“æ„ä¹Ÿè°ƒæ•´äº†</li><li>æ ¹æ®ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹çš„è§„å®šï¼Œå¦‚æœæ–¹æ³•åŒºæ— æ³•æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡º OOM å¼‚å¸¸</li></ul><h2 id="3-è®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM">3-è®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM</h2><h3 id="JDK8åŠä»¥å-å…ƒç©ºé—´">JDK8åŠä»¥å(å…ƒç©ºé—´)</h3><ul><li><p>å…ƒæ•°æ®åŒºå¤§å°å¯ä»¥ä½¿ç”¨å‚æ•° <code>-XX:MetaspaceSize</code> å’Œ <code>-XX:MaxMetaspaceSize</code> æŒ‡å®š</p></li><li><p>é»˜è®¤å€¼ä¾èµ–äºå¹³å°ï¼ŒWindows ä¸‹ï¼Œ<code>-XX:MetaspaceSize</code> çº¦ä¸º21Mï¼Œ<code>-XX:MaxMetaspaceSize</code>çš„å€¼æ˜¯-1ï¼Œå³æ²¡æœ‰é™åˆ¶ã€‚</p></li><li><p>ä¸æ°¸ä¹…ä»£ä¸åŒï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰çš„å¯ç”¨ç³»ç»Ÿå†…å­˜ã€‚å¦‚æœå…ƒæ•°æ®åŒºå‘ç”Ÿæº¢å‡ºï¼Œè™šæ‹Ÿæœºä¸€æ ·ä¼šæŠ›å‡ºå¼‚å¸¸ OutOfMemoryError:Metaspace</p></li><li><p><code>-XX:MetaspaceSize</code>ï¼šè®¾ç½®åˆå§‹çš„å…ƒç©ºé—´å¤§å°ã€‚å¯¹äºä¸€ä¸ª 64ä½ çš„æœåŠ¡å™¨ç«¯ JVM æ¥è¯´ï¼Œå…¶é»˜è®¤çš„ <code>-XX:MetaspaceSize</code>å€¼ä¸º21MBã€‚è¿™å°±æ˜¯åˆå§‹çš„é«˜æ°´ä½çº¿ï¼Œä¸€æ—¦è§¦åŠè¿™ä¸ªæ°´ä½çº¿ï¼ŒFull GC å°†ä¼šè¢«è§¦å‘å¹¶å¸è½½æ²¡ç”¨çš„ç±»ï¼ˆå³è¿™äº›ç±»å¯¹åº”çš„ç±»åŠ è½½å™¨ä¸å†å­˜æ´»ï¼‰ï¼Œç„¶åè¿™ä¸ªé«˜æ°´ä½çº¿å°†ä¼šé‡ç½®ã€‚æ–°çš„é«˜æ°´ä½çº¿çš„å€¼å–å†³äº GC åé‡Šæ”¾äº†å¤šå°‘å…ƒç©ºé—´ã€‚å¦‚æœé‡Šæ”¾çš„ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…è¿‡ MaxMetaspaceSize æ—¶ï¼Œé€‚å½“æé«˜è¯¥å€¼ã€‚å¦‚æœé‡Šæ”¾ç©ºé—´è¿‡å¤šï¼Œåˆ™é€‚å½“é™ä½è¯¥å€¼ã€‚</p></li><li><p>å¦‚æœåˆå§‹åŒ–çš„é«˜æ°´ä½çº¿è®¾ç½®è¿‡ä½ï¼Œä¸Šè¿°é«˜æ°´ä½çº¿è°ƒæ•´æƒ…å†µä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ã€‚é€šè¿‡åƒåœ¾å›æ”¶å™¨çš„æ—¥å¿—å¯ä»¥è§‚å¯Ÿåˆ° Full GC å¤šæ¬¡è°ƒç”¨ã€‚ä¸ºäº†é¿å…é¢‘ç¹åœ°GCï¼Œå»ºè®®å°†<code>-XX:MetaspaceSize</code>è®¾ç½®ä¸ºä¸€ä¸ªç›¸å¯¹è¾ƒé«˜çš„å€¼ã€‚</p></li><li><p>ä¸¾ä¾‹: <code>-XX:MetaspaceSize=10m -XX:MaxMetaspaceSize=10m</code></p></li></ul><h3 id="æ–¹æ³•åŒºOOM">æ–¹æ³•åŒºOOM</h3><p><strong>Demo</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * jdk6/7ä¸­ï¼š * -XX:PermSize=10m -XX:MaxPermSize=10m * * jdk8ä¸­ï¼š * -XX:MetaspaceSize=10m -XX:MaxMetaspaceSize=10m * * OOMTest ç±»ç»§æ‰¿ ClassLoader ç±»ï¼Œè·å¾— defineClass() æ–¹æ³•ï¼Œå¯è‡ªå·±è¿›è¡Œç±»çš„åŠ è½½ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OOMTest</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">OOMTest</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OOMTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//åˆ›å»ºClassWriterå¯¹è±¡ï¼Œç”¨äºç”Ÿæˆç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç </span>                <span class="token class-name">ClassWriter</span> classWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//æŒ‡æ˜ç‰ˆæœ¬å·ï¼Œä¿®é¥°ç¬¦ï¼Œç±»åï¼ŒåŒ…åï¼Œçˆ¶ç±»ï¼Œæ¥å£</span>                classWriter<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token constant">V1_8</span><span class="token punctuation">,</span> <span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token string">"Class"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è¿”å›byte[]</span>                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> code <span class="token operator">=</span> classWriter<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//ç±»çš„åŠ è½½</span>                test<span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token string">"Class"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> code<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Classå¯¹è±¡</span>                j<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¦‚ä½•è§£å†³OOM">å¦‚ä½•è§£å†³OOM</h3><ul><li>è¦è§£å†³ <strong>OOM</strong> å¼‚å¸¸æˆ– <strong>heap space</strong> çš„å¼‚å¸¸ï¼Œä¸€èˆ¬çš„æ‰‹æ®µæ˜¯é¦–å…ˆé€šè¿‡å†…å­˜æ˜ åƒåˆ†æå·¥å…·ï¼ˆå¦‚ <strong>Ecipse Memory Analyzer</strong>ï¼‰å¯¹dumpå‡ºæ¥çš„å †è½¬å‚¨å¿«ç…§è¿›è¡Œåˆ†æï¼Œé‡ç‚¹æ˜¯ç¡®è®¤å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦æ˜¯å¿…è¦çš„ï¼Œä¹Ÿå°±æ˜¯è¦å…ˆåˆ†æ¸…æ¥šåˆ°åº•æ˜¯å‡ºç°äº†å†…å­˜æ³„æ¼ï¼ˆ<strong>Memory Leak</strong>ï¼‰è¿˜æ˜¯å†…å­˜æº¢å‡ºï¼ˆ<strong>Memory Overflow</strong>ï¼‰</li><li>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œå¯è¿›ä¸€æ­¥é€šè¿‡å·¥å…·æŸ¥çœ‹æ³„æ¼å¯¹è±¡åˆ° <strong>GC Roots</strong> çš„å¼•ç”¨é“¾ã€‚äºæ˜¯å°±èƒ½æ‰¾åˆ°æ³„æ¼å¯¹è±¡æ˜¯é€šè¿‡æ€æ ·çš„è·¯å¾„ä¸ <strong>GC Roots</strong> ç›¸å…³è”å¹¶å¯¼è‡´åƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨å›æ”¶å®ƒä»¬çš„ã€‚æŒæ¡äº†æ³„æ¼å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ï¼Œä»¥åŠ <strong>GC Roots</strong> å¼•ç”¨é“¾çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥æ¯”è¾ƒå‡†ç¡®åœ°å®šä½å‡ºæ³„æ¼ä»£ç çš„ä½ç½®ã€‚</li><li>å¦‚æœä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å†…å­˜ä¸­çš„å¯¹è±¡ç¡®å®éƒ½è¿˜å¿…é¡»å­˜æ´»ç€ï¼Œé‚£å°±åº”å½“æ£€æŸ¥è™šæ‹Ÿæœºçš„å †å‚æ•°ï¼ˆ-Xmxä¸-Xmsï¼‰ï¼Œä¸æœºå™¨ç‰©ç†å†…å­˜å¯¹æ¯”çœ‹æ˜¯å¦è¿˜å¯ä»¥è°ƒå¤§ï¼Œä»ä»£ç ä¸Šæ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¿‡é•¿ã€æŒæœ‰çŠ¶æ€æ—¶é—´è¿‡é•¿çš„æƒ…å†µï¼Œå°è¯•å‡å°‘ç¨‹åºè¿è¡ŒæœŸçš„å†…å­˜æ¶ˆè€—ã€‚</li></ul><h2 id="4-æ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„">4-æ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„</h2><p><img src="./../jvm-sgg6/008.png" alt=""></p><p>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ä¹¦ä¸­å¯¹æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰å­˜å‚¨å†…å®¹æè¿°å¦‚ä¸‹ï¼šå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜</strong>ç­‰ã€‚</p><p><img src="./../jvm-sgg6/009.png" alt=""></p><h3 id="ç±»å‹ä¿¡æ¯">ç±»å‹ä¿¡æ¯</h3><p>å¯¹æ¯ä¸ªåŠ è½½çš„ç±»å‹ï¼ˆç±» classã€æ¥å£ interfaceã€æšä¸¾ enumã€æ³¨è§£annotationï¼‰ï¼ŒJVM å¿…é¡»åœ¨æ–¹æ³•åŒºä¸­å­˜å‚¨ä»¥ä¸‹ç±»å‹ä¿¡æ¯ï¼š</p><ul><li>è¿™ä¸ªç±»å‹çš„å®Œæ•´æœ‰æ•ˆåç§°ï¼ˆå…¨å=åŒ…å.ç±»åï¼‰</li><li>è¿™ä¸ªç±»å‹ç›´æ¥çˆ¶ç±»çš„å®Œæ•´æœ‰æ•ˆåï¼ˆå¯¹äº interface æˆ–æ˜¯java.lang.Objectï¼Œéƒ½æ²¡æœ‰çˆ¶ç±»ï¼‰</li><li>è¿™ä¸ªç±»å‹çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œabstractï¼Œfinal çš„æŸä¸ªå­é›†ï¼‰</li><li>è¿™ä¸ªç±»å‹ç›´æ¥æ¥å£çš„ä¸€ä¸ªæœ‰åºåˆ—è¡¨</li></ul><p><img src="./../jvm-sgg6/011.png" alt=""></p><h3 id="åŸŸ-Field-ä¿¡æ¯">åŸŸ(Field)ä¿¡æ¯</h3><blockquote><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æˆå‘˜å˜é‡ï¼ŒåŸŸä¿¡æ¯æ˜¯æ¯”è¾ƒå®˜æ–¹çš„ç§°å‘¼</p></blockquote><ul><li>JVM å¿…é¡»åœ¨æ–¹æ³•åŒºä¸­ä¿å­˜ç±»å‹çš„æ‰€æœ‰åŸŸçš„ç›¸å…³ä¿¡æ¯ä»¥åŠåŸŸçš„å£°æ˜é¡ºåºã€‚</li><li>åŸŸçš„ç›¸å…³ä¿¡æ¯åŒ…æ‹¬ï¼šåŸŸåç§°ï¼ŒåŸŸç±»å‹ï¼ŒåŸŸä¿®é¥°ç¬¦ï¼ˆpublicï¼Œprivateï¼Œprotectedï¼Œstaticï¼Œfinalï¼Œvolatileï¼Œtransient çš„æŸä¸ªå­é›†ï¼‰</li></ul><h3 id="æ–¹æ³•-Method-ä¿¡æ¯">æ–¹æ³•(Method)ä¿¡æ¯</h3><p>JVM å¿…é¡»ä¿å­˜æ‰€æœ‰æ–¹æ³•çš„ä»¥ä¸‹ä¿¡æ¯ï¼ŒåŒåŸŸä¿¡æ¯ä¸€æ ·åŒ…æ‹¬å£°æ˜é¡ºåºï¼š</p><ul><li>æ–¹æ³•åç§°</li><li>æ–¹æ³•çš„è¿”å›ç±»å‹ï¼ˆåŒ…æ‹¬ void è¿”å›ç±»å‹ï¼‰ï¼Œvoid åœ¨ Java ä¸­å¯¹åº”çš„ä¸º void.class</li><li>æ–¹æ³•å‚æ•°çš„æ•°é‡å’Œç±»å‹ï¼ˆæŒ‰é¡ºåºï¼‰</li><li>æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œprivateï¼Œprotectedï¼Œstaticï¼Œfinalï¼Œsynchronizedï¼Œnativeï¼Œabstractçš„ä¸€ä¸ªå­é›†ï¼‰</li><li>æ–¹æ³•çš„å­—èŠ‚ç ï¼ˆbytecodesï¼‰ã€æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨åŠå¤§å°ï¼ˆabstract å’Œ nativeæ–¹æ³•é™¤å¤–ï¼‰</li><li>å¼‚å¸¸è¡¨ï¼ˆabstract å’Œ nativeæ–¹æ³•é™¤å¤–ï¼‰ï¼Œå¼‚å¸¸è¡¨è®°å½•æ¯ä¸ªå¼‚å¸¸å¤„ç†çš„å¼€å§‹ä½ç½®ã€ç»“æŸä½ç½®ã€ä»£ç å¤„ç†åœ¨ç¨‹åºè®¡æ•°å™¨ä¸­çš„åç§»åœ°å€ã€è¢«æ•è·çš„å¼‚å¸¸ç±»çš„å¸¸é‡æ± ç´¢å¼•</li></ul><p><img src="./../jvm-sgg6/010.png" alt=""></p><p><img src="./../jvm-sgg6/012.png" alt="é™æ€æ–¹æ³•åŠå¼‚å¸¸è¡¨"></p><h3 id="demo">demo</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * &lt;p>Description: æµ‹è¯•æ–¹æ³•åŒºå†…éƒ¨æ„æˆ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodInnerStrucTest</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å±æ€§</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"æµ‹è¯•æ–¹æ³•çš„å†…éƒ¨ç»“æ„"</span><span class="token punctuation">;</span>    <span class="token comment">//æ„é€ å™¨</span>    <span class="token comment">//æ–¹æ³•</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"count = "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token keyword">int</span> cal<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>            result <span class="token operator">=</span> value <span class="token operator">/</span> cal<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">String</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>javap -v -p MethodInnerStrucTest &gt; test.txt</code></p><ul><li><code>-p </code>æ˜¯ä¸ºäº†æŸ¥çœ‹ <code>private</code> æƒé™ç±»å‹çš„å­—æ®µæˆ–æ–¹æ³•</li></ul><h3 id="non-final-ç±»å‹çš„ç±»å˜é‡">non-final ç±»å‹çš„ç±»å˜é‡</h3><blockquote><p>é™æ€æ–¹æ³•å¯¹è±¡ä¸º null ä¾æ—§å¯ä»¥è®¿é—®</p></blockquote><p><img src="./../jvm-sgg6/014.png" alt="static final"></p><p><img src="./../jvm-sgg6/015.png" alt="final"></p><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± ">è¿è¡Œæ—¶å¸¸é‡æ± </h3><p><img src="./../jvm-sgg6/016.png" alt=""></p><ul><li>æ–¹æ³•åŒºï¼Œå†…éƒ¨åŒ…å«äº†è¿è¡Œæ—¶å¸¸é‡æ± <ul><li>ç±»æ–‡ä»¶é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½åˆ°æ–¹æ³•åŒºå, å­—èŠ‚ç ä¸­çš„å¸¸é‡æ± ä¾¿ç§°ä¸ºè¿è¡Œæ—¶å¸¸é‡æ± </li></ul></li><li>å­—èŠ‚ç æ–‡ä»¶ï¼Œå†…éƒ¨åŒ…å«äº†å¸¸é‡æ± ã€‚ï¼ˆä¹‹å‰çš„å­—èŠ‚ç æ–‡ä»¶ä¸­å·²ç»çœ‹åˆ°äº†å¾ˆå¤š Constant pool çš„ä¸œè¥¿ï¼Œè¿™ä¸ªå°±æ˜¯å¸¸é‡æ± ï¼‰</li><li>è¦å¼„æ¸…æ¥šæ–¹æ³•åŒºï¼Œéœ€è¦ç†è§£æ¸…æ¥š ClassFileï¼Œå› ä¸ºåŠ è½½ç±»çš„ä¿¡æ¯éƒ½åœ¨æ–¹æ³•åŒºã€‚</li><li>è¦å¼„æ¸…æ¥šæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œéœ€è¦ç†è§£æ¸…æ¥š ClassFile ä¸­çš„å¸¸é‡æ± ã€‚</li></ul><h4 id="å¸¸é‡æ± ">å¸¸é‡æ± </h4><p><img src="./../jvm-sgg6/017.png" alt=""></p><ul><li>ä¸€ä¸ªæœ‰æ•ˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­é™¤äº†åŒ…å«ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ã€å­—æ®µã€æ–¹æ³•ä»¥åŠæ¥å£ç­‰æè¿°ç¬¦ä¿¡æ¯å¤–ã€‚è¿˜åŒ…å«ä¸€é¡¹ä¿¡æ¯å°±æ˜¯<strong>å¸¸é‡æ± è¡¨</strong>ï¼ˆ<strong>Constant Pool Table</strong>ï¼‰ï¼ŒåŒ…æ‹¬å„ç§å­—é¢é‡å’Œå¯¹ç±»å‹ã€åŸŸå’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨</li></ul><p><strong>ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ?</strong></p><p>ä¸€ä¸ªjavaæºæ–‡ä»¶ä¸­çš„ç±»ã€æ¥å£ï¼Œç¼–è¯‘åäº§ç”Ÿä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ã€‚è€ŒJavaä¸­çš„å­—èŠ‚ç éœ€è¦æ•°æ®æ”¯æŒï¼Œé€šå¸¸è¿™ç§æ•°æ®ä¼šå¾ˆå¤§ä»¥è‡³äºä¸èƒ½ç›´æ¥å­˜åˆ°å­—èŠ‚ç é‡Œï¼Œæ¢å¦ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥å­˜åˆ°å¸¸é‡æ± ã€‚è¿™ä¸ªå­—èŠ‚ç åŒ…å«äº†æŒ‡å‘å¸¸é‡æ± çš„å¼•ç”¨ã€‚åœ¨åŠ¨æ€é“¾æ¥çš„æ—¶å€™ä¼šç”¨åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¹‹å‰æœ‰ä»‹ç»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleClass</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è™½ç„¶ä¸Šè¿°ä»£ç åªæœ‰194å­—èŠ‚ï¼Œä½†æ˜¯é‡Œé¢å´ä½¿ç”¨äº†Stringã€Systemã€PrintStream åŠ Object ç­‰ç»“æ„ã€‚</li><li>æ¯”å¦‚è¯´æˆ‘ä»¬è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰ 6 ä¸ªåœ°æ–¹ç”¨åˆ°äº† â€œhelloâ€ è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœä¸ç”¨å¸¸é‡æ± ï¼Œå°±éœ€è¦åœ¨ 6 ä¸ªåœ°æ–¹å…¨å†™ä¸€éï¼Œé€ æˆè‡ƒè‚¿ã€‚æˆ‘ä»¬å¯ä»¥å°† â€œhelloâ€ ç­‰æ‰€éœ€ç”¨åˆ°çš„ç»“æ„ä¿¡æ¯è®°å½•åœ¨å¸¸é‡æ± ä¸­ï¼Œå¹¶é€šè¿‡<strong>å¼•ç”¨çš„æ–¹å¼</strong>ï¼Œæ¥åŠ è½½ã€è°ƒç”¨æ‰€éœ€çš„ç»“æ„</li><li>è¿™é‡Œçš„ä»£ç é‡å…¶å®å¾ˆå°‘äº†ï¼Œå¦‚æœä»£ç å¤šçš„è¯ï¼Œå¼•ç”¨çš„ç»“æ„å°†ä¼šæ›´å¤šï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°å¸¸é‡æ± äº†ã€‚</li></ul><p><strong>å¸¸é‡æ± ä¸­æœ‰ä»€ä¹ˆ?</strong></p><p>å‡ ç§åœ¨å¸¸é‡æ± å†…å­˜å‚¨çš„æ•°æ®ç±»å‹åŒ…æ‹¬:</p><ul><li>æ•°é‡å€¼</li><li>å­—ç¬¦ä¸²å€¼</li><li>ç±»å¼•ç”¨</li><li>å­—æ®µå¼•ç”¨</li><li>æ–¹æ³•å¼•ç”¨</li></ul><p><strong>å°ç»“</strong></p><p>å¸¸é‡æ± ã€å¯ä»¥çœ‹åšæ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ç±»å‹ã€‚</p><h4 id="è¿è¡Œæ—¶å¸¸é‡æ± -2">è¿è¡Œæ—¶å¸¸é‡æ± </h4><ul><li><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆ<strong>Runtime Constant Pool</strong>ï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚</p></li><li><p>å¸¸é‡æ± è¡¨ï¼ˆ<strong>Constant Pool Table</strong>ï¼‰æ˜¯Classå­—èŠ‚ç æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œ<strong>ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨</strong>ï¼Œ<strong>è¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­</strong>ã€‚ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± å°±æ˜¯å¸¸é‡æ± åœ¨ç¨‹åºè¿è¡Œæ—¶çš„ç§°å‘¼ï¼‰</p></li><li><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œåœ¨åŠ è½½ç±»å’Œæ¥å£åˆ°è™šæ‹Ÿæœºåï¼Œå°±ä¼šåˆ›å»ºå¯¹åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p></li><li><p>JVM ä¸ºæ¯ä¸ªå·²åŠ è½½çš„ç±»å‹ï¼ˆç±»æˆ–æ¥å£ï¼‰éƒ½ç»´æŠ¤ä¸€ä¸ªå¸¸é‡æ± ã€‚æ± ä¸­çš„æ•°æ®é¡¹åƒæ•°ç»„é¡¹ä¸€æ ·ï¼Œæ˜¯é€šè¿‡ç´¢å¼•è®¿é—®çš„ã€‚</p></li><li><p>è¿è¡Œæ—¶å¸¸é‡æ± ä¸­åŒ…å«å¤šç§ä¸åŒçš„å¸¸é‡ï¼ŒåŒ…æ‹¬ç¼–è¯‘æœŸå°±å·²ç»æ˜ç¡®çš„æ•°å€¼å­—é¢é‡ï¼Œä¹ŸåŒ…æ‹¬åˆ°è¿è¡ŒæœŸè§£æåæ‰èƒ½å¤Ÿè·å¾—çš„æ–¹æ³•æˆ–è€…å­—æ®µå¼•ç”¨ã€‚<strong>æ­¤æ—¶ä¸å†æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·åœ°å€äº†ï¼Œè¿™é‡Œæ¢ä¸ºçœŸå®åœ°å€</strong>ã€‚</p><ul><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œç›¸å¯¹äº Class æ–‡ä»¶å¸¸é‡æ± çš„å¦ä¸€é‡è¦ç‰¹å¾æ˜¯ï¼š<strong>å…·å¤‡åŠ¨æ€æ€§</strong>ã€‚</li><li>æ¯”å¦‚ <code>String.intern()</code></li></ul></li><li><p>è¿è¡Œæ—¶å¸¸é‡æ± ç±»ä¼¼äºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­çš„ç¬¦å·è¡¨ï¼ˆsymbol tableï¼‰ï¼Œä½†æ˜¯å®ƒæ‰€åŒ…å«çš„æ•°æ®å´æ¯”ç¬¦å·è¡¨è¦æ›´åŠ ä¸°å¯Œä¸€äº›ã€‚</p></li><li><p>å½“åˆ›å»ºç±»æˆ–æ¥å£çš„è¿è¡Œæ—¶å¸¸é‡æ± æ—¶ï¼Œå¦‚æœæ„é€ è¿è¡Œæ—¶å¸¸é‡æ± æ‰€éœ€çš„å†…å­˜ç©ºé—´è¶…è¿‡äº†æ–¹æ³•åŒºæ‰€èƒ½æä¾›çš„æœ€å¤§å€¼ï¼Œåˆ™ JVM ä¼šæŠ› OutofMemoryError å¼‚å¸¸ã€‚</p></li></ul><h2 id="5-æ–¹æ³•åŒºä½¿ç”¨ä¸¾ä¾‹">5-æ–¹æ³•åŒºä½¿ç”¨ä¸¾ä¾‹</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodAreaDemo2</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> x <span class="token operator">/</span> y<span class="token punctuation">;</span>        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="./../jvm-sgg6/image-20231221202927474.png" alt="javap -v -p"></p><p><strong>æ­¥éª¤ç»†èŠ‚</strong></p><p><img src="./../jvm-sgg6/image-20231221203207231.png" alt="01"></p><p><img src="./../jvm-sgg6/image-20231221203455458.png" alt="02"></p><p><img src="./../jvm-sgg6/image-20231221203629464.png" alt="03"></p><p><img src="./../jvm-sgg6/image-20231221203906528.png" alt="03"></p><p><img src="./../jvm-sgg6/image-20231221204133859.png" alt="04"></p><p><img src="./../jvm-sgg6/image-20231221204427032.png" alt="05"></p><p><img src="./../jvm-sgg6/image-20231221204728860.png" alt="06"></p><p><img src="./../jvm-sgg6/image-20231221204953042.png" alt="07"></p><p><img src="./../jvm-sgg6/image-20231221210754104.png" alt="08"></p><p><img src="./../jvm-sgg6/image-20231221210316645.png" alt="09"></p><p><img src="./../jvm-sgg6/image-20231221210219422.png" alt="10"></p><p><img src="./../jvm-sgg6/image-20231221211132589.png" alt="11"></p><h2 id="6-æ–¹æ³•åŒºæ¼”è¿›ç»†èŠ‚">6-æ–¹æ³•åŒºæ¼”è¿›ç»†èŠ‚</h2><h3 id="æ°¸ä¹…ä»£æ¼”è¿›è¿‡ç¨‹">æ°¸ä¹…ä»£æ¼”è¿›è¿‡ç¨‹</h3><ol><li><p>é¦–å…ˆæ˜ç¡®ï¼š<strong>åªæœ‰ Hotspot æ‰æœ‰æ°¸ä¹…ä»£</strong>ã€‚BEA JRockitã€IBMJ9ç­‰æ¥è¯´ï¼Œæ˜¯ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µçš„ã€‚åŸåˆ™ä¸Šå¦‚ä½•å®ç°æ–¹æ³•åŒºå±äºè™šæ‹Ÿæœºå®ç°ç»†èŠ‚ï¼Œä¸å—ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ç®¡æŸï¼Œå¹¶ä¸è¦æ±‚ç»Ÿä¸€</p></li><li><p>Hotspot ä¸­æ–¹æ³•åŒºçš„å˜åŒ–ï¼š</p></li></ol><table><thead><tr><th>JDK1.6åŠä»¥å‰</th><th>æœ‰æ°¸ä¹…ä»£ï¼ˆpermanent generationï¼‰ï¼Œé™æ€å˜é‡å­˜å‚¨åœ¨æ°¸ä¹…ä»£ä¸Š</th></tr></thead><tbody><tr><td>JDK1.7</td><td>æœ‰æ°¸ä¹…ä»£ï¼Œä½†å·²ç»é€æ­¥ â€œå»æ°¸ä¹…ä»£â€ï¼Œ<strong>å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œé™æ€å˜é‡ç§»é™¤ï¼Œä¿å­˜åœ¨å †ä¸­</strong></td></tr><tr><td>JDK1.8</td><td>æ— æ°¸ä¹…ä»£ï¼Œç±»å‹ä¿¡æ¯ï¼Œå­—æ®µï¼Œæ–¹æ³•ï¼Œå¸¸é‡ä¿å­˜åœ¨æœ¬åœ°å†…å­˜çš„å…ƒç©ºé—´ï¼Œä½†å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ä»ç„¶åœ¨å †ä¸­ã€‚</td></tr></tbody></table><p><img src="./../jvm-sgg6/image-20231221211816995.png" alt="JDK6"></p><p><img src="./../jvm-sgg6/image-20231221211917267.png" alt="JDK7"></p><p><img src="./../jvm-sgg6/image-20231221211959637.png" alt="JDK8"></p><h3 id="æ°¸ä¹…ä»£ä¸ºä»€ä¹ˆè¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ">æ°¸ä¹…ä»£ä¸ºä»€ä¹ˆè¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ</h3><blockquote><p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="http://openjdk.java.net/jeps/122">http://openjdk.java.net/jeps/122</a></p></blockquote><ul><li>éšç€ Java8 çš„åˆ°æ¥ï¼ŒHotSpot VM ä¸­å†ä¹Ÿè§ä¸åˆ°æ°¸ä¹…ä»£äº†ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ä¹Ÿæ¶ˆå¤±äº†ã€‚è¿™äº›æ•°æ®è¢«ç§»åˆ°äº†ä¸€ä¸ªä¸å †ä¸ç›¸è¿çš„æœ¬åœ°å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸå«åšå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‚</li><li>ç”±äºç±»çš„å…ƒæ•°æ®åˆ†é…åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œå…ƒç©ºé—´çš„æœ€å¤§å¯åˆ†é…ç©ºé—´å°±æ˜¯ç³»ç»Ÿå¯ç”¨å†…å­˜ç©ºé—´ã€‚</li><li>è¿™é¡¹æ”¹åŠ¨æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼ŒåŸå› æœ‰ï¼š<ol><li>ä¸ºæ°¸ä¹…ä»£è®¾ç½®ç©ºé—´å¤§å°æ˜¯å¾ˆéš¾ç¡®å®šçš„ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¦‚æœåŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼Œå®¹æ˜“äº§ç”ŸPermåŒºçš„OOMã€‚æ¯”å¦‚æŸä¸ªå®é™…Webå·¥ç¨‹ä¸­ï¼Œå› ä¸ºåŠŸèƒ½ç‚¹æ¯”è¾ƒå¤šï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦ä¸æ–­åŠ¨æ€åŠ è½½å¾ˆå¤šç±»ï¼Œç»å¸¸å‡ºç°è‡´å‘½é”™è¯¯ã€‚<code>Exception in thread 'dubbo client x.x connector' java.lang.OutOfMemoryError:PermGen space</code>è€Œå…ƒç©ºé—´å’Œæ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚ å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚</li><li>å¯¹æ°¸ä¹…ä»£è¿›è¡Œè°ƒä¼˜æ˜¯å¾ˆå›°éš¾çš„ã€‚æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šå¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ç”¨çš„ç±»å‹ï¼Œæ–¹æ³•åŒºçš„è°ƒä¼˜ä¸»è¦æ˜¯ä¸ºäº†é™ä½ <strong>Full GC</strong></li></ol></li></ul><h3 id="ä¸¤ä¸ªé—®é¢˜">ä¸¤ä¸ªé—®é¢˜</h3><h4 id="å­—ç¬¦ä¸²å¸¸é‡æ± -StringTable-ä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ">å­—ç¬¦ä¸²å¸¸é‡æ±  StringTable ä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ</h4><ul><li><p>JDK7 ä¸­å°† StringTable æ”¾åˆ°äº†å †ç©ºé—´ä¸­ã€‚å› ä¸ºæ°¸ä¹…ä»£çš„å›æ”¶æ•ˆç‡å¾ˆä½ï¼Œåœ¨ Full GC çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œæ°¸ä¹…ä»£çš„åƒåœ¾å›æ”¶ï¼Œè€Œ Full GC æ˜¯è€å¹´ä»£çš„ç©ºé—´ä¸è¶³ã€æ°¸ä¹…ä»£ä¸è¶³æ—¶æ‰ä¼šè§¦å‘ã€‚</p></li><li><p>è¿™å°±å¯¼è‡´ StringTable å›æ”¶æ•ˆç‡ä¸é«˜ï¼Œè€Œæˆ‘ä»¬å¼€å‘ä¸­ä¼šæœ‰å¤§é‡çš„å­—ç¬¦ä¸²è¢«åˆ›å»ºï¼Œå›æ”¶æ•ˆç‡ä½ï¼Œå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜ä¸è¶³ã€‚æ”¾åˆ°å †é‡Œï¼Œèƒ½åŠæ—¶å›æ”¶å†…å­˜ã€‚</p></li></ul><h4 id="é™æ€å˜é‡æ”¾åœ¨å“ª">é™æ€å˜é‡æ”¾åœ¨å“ª</h4><p><strong>demo1</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * jdk7ï¼š * -Xms200m -Xmx200m -XX:PermSize=300m -XX:MaxPermSize=300m -XX:+PrintGCDetails * jdk 8ï¼š * -Xms200m -Xmx200m -XX:MetaspaceSize=300m -XX:MaxMetaspaceSize=300m -XX:+PrintGCDetails */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticFieldTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//100MB</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StaticFieldTest</span><span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç»“è®º</strong></p><ol><li>é™æ€å¼•ç”¨å¯¹åº”çš„å¯¹è±¡å®ä½“ (ä¹Ÿå°±æ˜¯è¿™ä¸ª new byte[1024 * 1024 * 100]) å§‹ç»ˆéƒ½å­˜åœ¨å †ç©ºé—´</li><li>åªæ˜¯é‚£ä¸ªå˜é‡(ç›¸å½“äºä¸‹é¢çš„ arr å˜é‡å)åœ¨ JDK6, JDK7, JDK8 å­˜æ”¾ä½ç½®ä¸­æœ‰æ‰€å˜åŒ–</li></ol><p><strong>demo2</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­çš„æ¡ˆä¾‹ï¼š * staticObjã€instanceObjã€localObjå­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticObjTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">static</span> <span class="token class-name">ObjectHolder</span> staticObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectHolder</span> instanceObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ObjectHolder</span> localObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ObjectHolder</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticObjTest<span class="token punctuation">.</span>Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        test<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç»“è®º</strong></p><ul><li><p><code>staticObj</code> <strong>é™æ€æˆå‘˜å˜é‡</strong>éšç€ <code>Test</code> çš„ç±»ä¿¡æ¯å­˜æ”¾åœ¨æ–¹æ³•åŒº,</p></li><li><p><code>instanceObj</code> <strong>æˆå‘˜å˜é‡</strong>éšç€ <code>Teset</code> çš„å¯¹è±¡ç¤ºä¾‹å­˜æ”¾åœ¨Javaå †,</p></li><li><p><code>localObject</code> <strong>æ–¹æ³•å˜é‡</strong>åˆ™æ˜¯å­˜æ”¾åœ¨ <code>foo()</code> æ–¹æ³•æ ˆçš„å±€éƒ¨å˜é‡è¡¨ä¸­.</p></li><li><p>ä¸‰ä¸ªå¯¹è±¡çš„æ•°æ®åœ¨å†…å­˜ä¸­çš„åœ°å€éƒ½è½åœ¨EdenåŒºèŒƒå›´å†…ï¼Œæ‰€ä»¥ç»“è®ºï¼š<strong>åªè¦æ˜¯å¯¹è±¡å®ä¾‹å¿…ç„¶ä¼šåœ¨ Java å †ä¸­åˆ†é…</strong>ã€‚</p></li></ul><p>ä»ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹æ‰€å®šä¹‰çš„æ¦‚å¿µæ¨¡å‹æ¥çœ‹ï¼Œæ‰€æœ‰ Class ç›¸å…³çš„ä¿¡æ¯éƒ½åº”è¯¥å­˜æ”¾åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œä½†æ–¹æ³•åŒºè¯¥å¦‚ä½•å®ç°ï¼Œã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹å¹¶æœªåšå‡ºè§„å®šï¼Œè¿™å°±æˆäº†ä¸€ä»¶å…è®¸ä¸åŒè™šæ‹Ÿæœºè‡ªå·±çµæ´»æŠŠæ¡çš„äº‹æƒ…ã€‚<strong>JDK7 åŠå…¶ä»¥åç‰ˆæœ¬çš„ HotSpot è™šæ‹Ÿæœºé€‰æ‹©æŠŠé™æ€å˜é‡ä¸ç±»å‹åœ¨ Java è¯­è¨€ä¸€ç«¯çš„æ˜ å°„ Class å¯¹è±¡å­˜æ”¾åœ¨ä¸€èµ·ï¼Œå­˜å‚¨äº Java å †ä¹‹ä¸­</strong></p><h2 id="7-æ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶">7-æ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶</h2><ul><li><p>æœ‰äº›äººè®¤ä¸ºæ–¹æ³•åŒºï¼ˆå¦‚ Hotspot è™šæ‹Ÿæœºä¸­çš„å…ƒç©ºé—´æˆ–è€…æ°¸ä¹…ä»£ï¼‰æ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†è¡Œä¸ºçš„ï¼Œå…¶å®ä¸ç„¶ã€‚ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹æ–¹æ³•åŒºçš„çº¦æŸæ˜¯éå¸¸å®½æ¾çš„ï¼Œæåˆ°è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºåœ¨æ–¹æ³•åŒºä¸­å®ç°åƒåœ¾æ”¶é›†ã€‚äº‹å®ä¸Šä¹Ÿç¡®å®æœ‰æœªå®ç°æˆ–æœªèƒ½å®Œæ•´å®ç°æ–¹æ³•åŒº<strong>ç±»å‹å¸è½½</strong>çš„æ”¶é›†å™¨å­˜åœ¨ï¼ˆå¦‚ JDK11 æ—¶æœŸçš„ ZGC æ”¶é›†å™¨å°±ä¸æ”¯æŒç±»å¸è½½ï¼‰ã€‚</p></li><li><p>ä¸€èˆ¬æ¥è¯´è¿™ä¸ªåŒºåŸŸçš„å›æ”¶æ•ˆæœæ¯”è¾ƒéš¾ä»¤äººæ»¡æ„ï¼Œå°¤å…¶æ˜¯ç±»å‹çš„å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶æœ‰æ—¶åˆç¡®å®æ˜¯å¿…è¦çš„ã€‚ä»¥å‰ sun å…¬å¸çš„ Bug åˆ—è¡¨ä¸­ï¼Œæ›¾å‡ºç°è¿‡çš„è‹¥å¹²ä¸ªä¸¥é‡çš„ Bug å°±æ˜¯ç”±äºä½ç‰ˆæœ¬çš„ HotSpot è™šæ‹Ÿæœºå¯¹æ­¤åŒºåŸŸæœªå®Œå…¨å›æ”¶è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p></li><li><p>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼š<strong>å¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹</strong>ã€‚</p></li></ul><h3 id="æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†">æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†</h3><ul><li><p>å…ˆæ¥è¯´è¯´æ–¹æ³•åŒºå†…å¸¸é‡æ± ä¹‹ä¸­ä¸»è¦å­˜æ”¾çš„ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚å­—é¢é‡æ¯”è¾ƒæ¥è¿‘Javaè¯­è¨€å±‚æ¬¡çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚è€Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š</p><ul><li>ç±»å’Œæ¥å£çš„å…¨é™å®šå</li><li>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</li><li>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</li></ul></li><li><p>HotSpot è™šæ‹Ÿæœºå¯¹å¸¸é‡æ± çš„å›æ”¶ç­–ç•¥æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œåªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå°±å¯ä»¥è¢«å›æ”¶ã€‚</p></li><li><p>å›æ”¶åºŸå¼ƒå¸¸é‡ä¸å›æ”¶ Java å †ä¸­çš„å¯¹è±¡éå¸¸ç±»ä¼¼ã€‚ï¼ˆå…³äºå¸¸é‡çš„å›æ”¶æ¯”è¾ƒç®€å•ï¼Œé‡ç‚¹æ˜¯ç±»çš„å›æ”¶ï¼‰</p></li></ul><p>ä¸‹é¢ä¹Ÿç§°ä½œ<strong>ç±»å¸è½½</strong></p><ul><li><p>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦â€œåºŸå¼ƒâ€è¿˜æ˜¯ç›¸å¯¹ç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»å‹æ˜¯å¦å±äºâ€œä¸å†è¢«ä½¿ç”¨çš„ç±»â€çš„æ¡ä»¶å°±æ¯”è¾ƒè‹›åˆ»äº†ã€‚éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š</p><ul><li><p>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶ä»»ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹ã€‚</p></li><li><p>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶ï¼Œè¿™ä¸ªæ¡ä»¶é™¤éæ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„å¯æ›¿æ¢ç±»åŠ è½½å™¨çš„åœºæ™¯ï¼Œå¦‚ OSGiã€JSP çš„é‡åŠ è½½ç­‰ï¼Œå¦åˆ™é€šå¸¸æ˜¯å¾ˆéš¾è¾¾æˆçš„ã€‚</p></li><li><p>è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</p></li></ul></li><li><p>Java è™šæ‹Ÿæœºè¢«å…è®¸å¯¹æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œè¢«å…è®¸â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ï¼Œæ²¡æœ‰å¼•ç”¨äº†å°±å¿…ç„¶ä¼šå›æ”¶ã€‚å…³äºæ˜¯å¦è¦å¯¹ç±»å‹è¿›è¡Œå›æ”¶ï¼ŒHotSpot è™šæ‹Ÿæœºæä¾›äº† <code>-Xnoclassgc</code> å‚æ•°è¿›è¡Œæ§åˆ¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>-verbose:class</code> ä»¥åŠ <code>-XXï¼š+TraceClass-Loading</code>ã€<code>-XXï¼š+TraceClassUnLoading</code> æŸ¥çœ‹ç±»åŠ è½½å’Œå¸è½½ä¿¡æ¯</p></li><li><p>åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLib ç­‰å­—èŠ‚ç æ¡†æ¶ï¼ŒåŠ¨æ€ç”Ÿæˆ JSP ä»¥åŠ OSGi è¿™ç±»é¢‘ç¹è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„åœºæ™¯ä¸­ï¼Œ<u>é€šå¸¸éƒ½éœ€è¦ Java è™šæ‹Ÿæœºå…·å¤‡ç±»å‹å¸è½½çš„èƒ½åŠ›ï¼Œä»¥ä¿è¯ä¸ä¼šå¯¹æ–¹æ³•åŒºé€ æˆè¿‡å¤§çš„å†…å­˜å‹åŠ›ã€‚</u></p></li></ul><h2 id="8-æ€»ç»“">8-æ€»ç»“</h2><p><img src="./../jvm-sgg6/image-20231221221657282.png" alt=""></p><h3 id="å¸¸è§é¢è¯•é¢˜">å¸¸è§é¢è¯•é¢˜</h3><ul><li>è¯´ä¸€ä¸‹ JVM å†…å­˜æ¨¡å‹å§ï¼Œæœ‰å“ªäº›åŒºï¼Ÿåˆ†åˆ«å¹²ä»€ä¹ˆçš„ï¼Ÿ</li><li>Java8 çš„å†…å­˜åˆ†ä»£æ”¹è¿›</li><li>JVM å†…å­˜åˆ†å“ªå‡ ä¸ªåŒºï¼Œæ¯ä¸ªåŒºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>JVM å†…å­˜åˆ†å¸ƒ/å†…å­˜ç»“æ„ï¼Ÿæ ˆå’Œå †çš„åŒºåˆ«ï¼Ÿå †çš„ç»“æ„ï¼Ÿä¸ºä»€ä¹ˆä¸¤ä¸ª survivor åŒºï¼Ÿ</li><li>Eden å’Œ survior çš„æ¯”ä¾‹åˆ†é…</li><li>JVM å†…å­˜åˆ†åŒºï¼Œä¸ºä»€ä¹ˆè¦æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£</li><li>Java çš„å†…å­˜åˆ†åŒº</li><li>è®²è®² JVM è¿è¡Œæ—¶æ•°æ®åº“åŒº</li><li>ä»€ä¹ˆæ—¶å€™å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ï¼Ÿ</li><li>JVM çš„å†…å­˜ç»“æ„ï¼ŒEden å’Œ Survivor æ¯”ä¾‹ã€‚</li><li>JVM å†…å­˜ä¸ºä»€ä¹ˆè¦åˆ†æˆæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ï¼ŒæŒä¹…ä»£ã€‚æ–°ç”Ÿä»£ä¸­ä¸ºä»€ä¹ˆè¦åˆ†ä¸º Eden å’Œ Survivorã€‚</li><li>ä¸€é¢ï¼šJVM å†…å­˜æ¨¡å‹ä»¥åŠåˆ†åŒºï¼Œéœ€è¦è¯¦ç»†åˆ°æ¯ä¸ªåŒºæ”¾ä»€ä¹ˆã€‚</li><li>ä¸€é¢ï¼šJVM çš„å†…å­˜æ¨¡å‹ï¼ŒJava8 åšäº†ä»€ä¹ˆæ”¹</li><li>JVM å†…å­˜åˆ†å“ªå‡ ä¸ªåŒºï¼Œæ¯ä¸ªåŒºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Java å†…å­˜åˆ†é…</li><li>JVM çš„æ°¸ä¹…ä»£ä¸­ä¼šå‘ç”Ÿåƒåœ¾å›æ”¶å—ï¼Ÿ</li><li>ä¸€é¢ï¼šJVM å†…å­˜åˆ†åŒºï¼Œä¸ºä»€ä¹ˆè¦æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ</li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-materyä¸»é¢˜ä¼˜åŒ–</title>
      <link href="/2023/12/19/hexo-update/"/>
      <url>/2023/12/19/hexo-update/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›®å½•æ»šåŠ¨">ç›®å½•æ»šåŠ¨</h2><blockquote><p>é»˜è®¤æƒ…å†µä¸‹materyä¸»é¢˜, æ–‡ç« ä¸­å½“ç›®å½•è¿‡å¤š, è¶…å‡ºé¡µé¢åä¾¿æ— æ³•å±•ç¤ºå¤šä½™ç›®å½•, è§£å†³æ–¹æ¡ˆå¦‚ä¸‹. (è¯¥æ–¹æ¡ˆå–è‡ªgithub issuesä¸­, åªèƒ½åšç®€å•æ»šåŠ¨)</p></blockquote><ol><li><p>å…¨å±€æœç´¢<code>#toc-content &#123;</code></p><p>æˆ–è€…ç›´æ¥æ‰¾åˆ°ç›®å½•<code>/themes/xxx/source/css/post.css</code></p></li><li><p>æ›´æ”¹å¦‚ä¸‹ä»£ç </p></li></ol><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">#toc-content</span> <span class="token punctuation">&#123;</span>    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*â€»â€»â€»â€»æ”¹æˆâ€»â€»â€»â€»*/</span><span class="token selector">#toc-content</span> <span class="token punctuation">&#123;</span>    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>    <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100vh - 250px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ»šåŠ¨æ¡é¢œè‰²è°ƒæ•´">æ»šåŠ¨æ¡é¢œè‰²è°ƒæ•´</h2><blockquote><p>åŸæ»šåŠ¨æ¡é¢œè‰²æ˜¯æš–çº¢è‰²è°ƒ, ç°æ”¹ä¸ºå†·è“è‰²è°ƒ</p></blockquote><h3 id="ä¸»é¢˜æ–‡ä»¶">ä¸»é¢˜æ–‡ä»¶</h3><p><code>/themes/xxx/source/css/post.css</code></p><ul><li>åˆ†åˆ«æœç´¢</li></ul><p>â€‹<code>::-webkit-scrollbar-thumb</code></p><p>â€‹<code>::-webkit-scrollbar-track</code></p><ul><li>æ”¹ä¸º: <code>background-color: #18bfd0;</code></li></ul><h3 id="æš—è‰²æ–‡ä»¶">æš—è‰²æ–‡ä»¶</h3><p><code>/themes/xxx/source/css/dark.css</code></p><ul><li><p>æœç´¢<code>body.DarkMode .progress-bar</code></p></li><li><p>æ”¹ä¸º <code>background: linear-gradient(to right, #2fb0e5 0%, #2ce0cb 100%);</code></p></li></ul><h2 id="åŒºå—é¢œè‰²è°ƒæ•´">åŒºå—é¢œè‰²è°ƒæ•´</h2><blockquote><p>åŒºå—ç”±äºåœ¨ä¸»é¢˜æºç åŒ…ä¸­å·²ç»æœ‰ç›¸å…³å®šä¹‰, å› æ­¤éœ€è¦é’ˆå¯¹æºç åŒ…è¿›è¡Œè°ƒæ•´</p></blockquote><h3 id="æºç æ–‡ä»¶">æºç æ–‡ä»¶</h3><p><code>themes/xxx/source/libs/materialize/materialize.min.css</code></p><ul><li><p>åˆ é™¤</p><p><code>border-left:5px solid #ee6e73&#125;</code></p></li></ul><h3 id="ä¸»é¢˜æ–‡ä»¶-2">ä¸»é¢˜æ–‡ä»¶</h3><p><code>themes/xxx/source/css/matery.css</code></p><ul><li><p>æœç´¢ <code>blockquote &#123;</code></p></li><li><p>æ”¹ä¸º</p></li></ul><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">blockquote</span> <span class="token punctuation">&#123;</span>    <span class="token property">border-left</span><span class="token punctuation">:</span> 3px solid #67767c <span class="token important">!important</span><span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem 0.8rem 0.2rem 0.8rem<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>94 163 157 / 10%<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">text-align</span><span class="token punctuation">:</span> justify<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤œé—´æ–‡ä»¶">å¤œé—´æ–‡ä»¶</h3><p><code>themes/xxx/source/css/dark.css</code></p><ul><li>æœç´¢ <code>body.DarkMode blockquote &#123;</code></li><li>æ”¹ä¸º(æ­¤å¤„è‰²è°ƒæœªè°ƒæ•´, ä¾æ—§æ˜¯æš–çº¢è‰²è°ƒ</li></ul><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body.DarkMode blockquote</span> <span class="token punctuation">&#123;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> #666 <span class="token important">!important</span><span class="token punctuation">;</span>    <span class="token property">border-left</span><span class="token punctuation">:</span> 3px solid #d72f0f <span class="token important">!important</span><span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.6<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">text-align</span><span class="token punctuation">:</span> justify<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç›®å½•é¢œè‰²">ç›®å½•é¢œè‰²</h2><h3 id="æ–‡ä»¶">æ–‡ä»¶</h3><p><code>themes/xxx/source/css/post.css</code></p><ul><li><p>æœç´¢<code>#toc-content .toc-link:hover &#123;</code></p></li><li><p>å°†æ‚¬åœé¢œè‰²æ”¹ä¸º <code>color: #009cff;</code></p></li><li><p>æœç´¢<code>#toc-content .is-active-link &#123;</code></p></li><li><p>å°†æ¿€æ´»é¢œè‰²æ”¹ä¸º <code>color: #009cff</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-05-å †</title>
      <link href="/2023/12/18/jvm-sgg5/"/>
      <url>/2023/12/18/jvm-sgg5/</url>
      
        <content type="html"><![CDATA[<h1>å †</h1><h2 id="1-å †çš„æ ¸å¿ƒæ¦‚è¿°">1-å †çš„æ ¸å¿ƒæ¦‚è¿°</h2><p><img src="../jvm-sgg5/001.png" alt=""></p><ul><li><p>ä¸€ä¸ª JVM å®ä¾‹åªå­˜åœ¨ä¸€ä¸ªå †å†…å­˜ï¼Œå †ä¹Ÿæ˜¯ Java å†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸã€‚</p></li><li><p>Java å †åŒºåœ¨ JVM å¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»ºï¼Œå…¶ç©ºé—´å¤§å°ä¹Ÿå°±ç¡®å®šäº†ï¼Œå †æ˜¯ JVM ç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜ç©ºé—´.</p><ul><li>å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒèŠ‚çš„ã€‚</li></ul></li><li><p>ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šï¼Œå †å¯ä»¥å¤„äº<strong>ç‰©ç†ä¸Šä¸è¿ç»­</strong>çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨<strong>é€»è¾‘ä¸Š</strong>å®ƒåº”è¯¥è¢«è§†ä¸º<strong>è¿ç»­çš„</strong>ã€‚</p></li><li><p>æ‰€æœ‰çš„çº¿ç¨‹å…±äº« Java å †ï¼Œåœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼Œ<strong>TLAB</strong>ï¼‰ã€‚</p></li><li><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¯¹Javaå †çš„æè¿°æ˜¯ï¼š<strong>æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åº”å½“åœ¨è¿è¡Œæ—¶åˆ†é…åœ¨å †ä¸Š</strong>ã€‚ï¼ˆThe heap is the run-time data area from which memory for all class instances and arrays is allocatedï¼‰</p><ul><li>ä»å®é™…ä½¿ç”¨è§’åº¦çœ‹ï¼šâ€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨å †åˆ†é…å†…å­˜ï¼Œä½†å¹¶éå…¨éƒ¨ã€‚å› ä¸ºè¿˜æœ‰ä¸€äº›å¯¹è±¡æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼ˆé€ƒé€¸åˆ†æï¼Œæ ‡é‡æ›¿æ¢ï¼‰</li></ul></li><li><p>æ•°ç»„å’Œå¯¹è±¡å¯èƒ½æ°¸è¿œä¸ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼ˆ<strong>ä¸ä¸€å®š</strong>ï¼‰ï¼Œå› ä¸ºæ ˆå¸§ä¸­ä¿å­˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘å¯¹è±¡æˆ–è€…æ•°ç»„åœ¨å †ä¸­çš„ä½ç½®ã€‚</p></li><li><p>åœ¨æ–¹æ³•ç»“æŸåï¼Œå †ä¸­çš„å¯¹è±¡ä¸ä¼šé©¬ä¸Šè¢«ç§»é™¤ï¼Œä»…ä»…åœ¨åƒåœ¾æ”¶é›†çš„æ—¶å€™æ‰ä¼šè¢«ç§»é™¤ã€‚</p><ul><li>ä¹Ÿå°±æ˜¯è§¦å‘äº† GC çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œå›æ”¶</li><li>å¦‚æœå †ä¸­å¯¹è±¡é©¬ä¸Šè¢«å›æ”¶ï¼Œé‚£ä¹ˆç”¨æˆ·çº¿ç¨‹å°±ä¼šæ”¶åˆ°å½±å“ï¼Œå› ä¸ºæœ‰ stop the word</li></ul></li><li><p>å †ï¼Œæ˜¯ GCï¼ˆGarbage Collectionï¼Œåƒåœ¾æ”¶é›†å™¨ï¼‰æ‰§è¡Œåƒåœ¾å›æ”¶çš„é‡ç‚¹åŒºåŸŸã€‚</p></li></ul><p><img src="../jvm-sgg5/002.png" alt=""></p><p><img src="../jvm-sgg5/003.png" alt="å­—èŠ‚ç newå¯¹è±¡"></p><p><img src="../jvm-sgg5/004.png" alt="Java7ä¹‹å‰å †å†…å­˜é€»è¾‘éƒ¨åˆ†"></p><p><img src="../jvm-sgg5/005.png" alt="Java8åŠä¹‹åå †å†…å­˜é€»è¾‘éƒ¨åˆ†"></p><p><img src="../jvm-sgg5/006.png" alt=""></p><p><strong>JDK7å †ç©ºé—´å†…éƒ¨ç»“æ„</strong></p><p><img src="../jvm-sgg5/007.png" alt=""></p><p><img src="../jvm-sgg5/008.png" alt="JDK8å †ç©ºé—´å†…éƒ¨ç»“æ„"></p><p><strong>JDK7-8çš„å˜åŒ–</strong></p><p><img src="../jvm-sgg5/009.png" alt=""></p><h2 id="2-è®¾ç½®å †å†…å­˜å¤§å°ä¸-OOM">2-è®¾ç½®å †å†…å­˜å¤§å°ä¸ OOM</h2><ul><li><p>Java å †åŒºç”¨äºå­˜å‚¨Javaå¯¹è±¡å®ä¾‹ï¼Œé‚£ä¹ˆå †çš„å¤§å°åœ¨JVMå¯åŠ¨æ—¶å°±å·²ç»è®¾å®šå¥½äº†ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡é€‰é¡¹&quot;-Xms&quot;å’Œ&quot;-Xmx&quot;æ¥è¿›è¡Œè®¾ç½®ã€‚</p><ul><li><code>-Xms</code>ç”¨äºè¡¨ç¤ºå †åŒºçš„èµ·å§‹å†…å­˜ï¼Œç­‰ä»·äº<code>-XX:InitialHeapSize</code></li><li><code>-Xmx</code>åˆ™ç”¨äºè¡¨ç¤ºå †åŒºçš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äº<code>-XX:MaxHeapSize</code></li></ul></li><li><p>ä¸€æ—¦å †åŒºä¸­çš„å†…å­˜å¤§å°è¶…è¿‡<code>-Xmx</code>æ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°†ä¼šæŠ›å‡º OutofMemoryError å¼‚å¸¸ã€‚</p></li><li><p>é€šå¸¸ä¼šå°† -Xms å’Œ -Xmx ä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒçš„å€¼, å…¶ç›®çš„<strong>æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ Java åƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—çš„å †åŒºçš„å¤§å°, ä»è€Œæé«˜æ€§èƒ½</strong></p></li><li><p>é»˜è®¤æƒ…å†µä¸‹:</p><ul><li>åˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°/64</li><li>æœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°/4</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapSpaceInitial</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¿”å›Javaè™šæ‹Ÿæœºä¸­çš„å †å†…å­˜æ€»é‡</span>        <span class="token keyword">long</span> initialMemory <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">;</span>        <span class="token comment">//è¿”å›Javaè™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å †å†…å­˜é‡</span>        <span class="token keyword">long</span> maxMemory <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-Xms : "</span> <span class="token operator">+</span> initialMemory <span class="token operator">+</span> <span class="token string">"M"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-Xmx : "</span> <span class="token operator">+</span> maxMemory <span class="token operator">+</span> <span class="token string">"M"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š"</span> <span class="token operator">+</span> initialMemory <span class="token operator">*</span> <span class="token number">64.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"G"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š"</span> <span class="token operator">+</span> maxMemory <span class="token operator">*</span> <span class="token number">4.0</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"G"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é—®é¢˜: ä¸ºä»€ä¹ˆè®¾ç½®çš„å†…å­˜å®é™…ä¼šåå°</strong></p><p><code>java -Xmx100m -Xms100m xxx.java</code></p><h3 id="æŸ¥çœ‹Javaå†…å­˜å‘½ä»¤">æŸ¥çœ‹Javaå†…å­˜å‘½ä»¤</h3><p><img src="../jvm-sgg5/010.png" alt=""></p><ul><li><code>jps</code> æŸ¥çœ‹Javaè¿›ç¨‹</li><li><code>jstat -gc è¿›ç¨‹id</code> æŸ¥çœ‹æŸè¿›ç¨‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li></ul><pre class="line-numbers language-none"><code class="language-none">SOC: S0åŒºæ€»å…±å®¹é‡S1C: S1åŒºæ€»å…±å®¹é‡S0U: S0åŒºä½¿ç”¨çš„é‡S0U: S1åŒºä½¿ç”¨çš„é‡EC: ä¼Šç”¸å›­åŒºæ€»å…±å®¹é‡EU: ä¼Šç”¸å›­åŒºä½¿ç”¨çš„é‡OC: è€å¹´ä»£æ€»å…±å®¹é‡OU: è€å¹´ä»£ä½¿ç”¨çš„é‡YGC: young GCçš„æ¬¡æ•°FGC: full GCçš„æ¬¡æ•°é—®é¢˜ç­”: åœ¨ä»£ç ä¸­å¾—åˆ°çš„æ˜¯s0&#x2F;s1 + E, å¹¶ä¸æ˜¯S0+S1+E<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>-XX:+PrintGCDetails</code> ç¨‹åºæ‰§è¡Œå®Œä¹‹åæ‰“å°å†…å­˜æƒ…å†µ</li></ul><h3 id="OOM">OOM</h3><p>demo</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OOMTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Picture</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Picture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Picture</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pixels<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Picture</span><span class="token punctuation">(</span><span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pixels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è®¾ç½®è™šæ‹Ÿæœºå‚æ•° <code>-Xms600m -Xmx600m</code></li></ul><p><strong>æŠ½æ ·å™¨æŸ¥çœ‹</strong></p><p><img src="../jvm-sgg5/011.png" alt=""></p><h2 id="3-å¹´è½»ä»£ä¸è€å¹´ä»£">3-å¹´è½»ä»£ä¸è€å¹´ä»£</h2><ul><li>å­˜å‚¨åœ¨ JVM ä¸­çš„ Java å¯¹è±¡å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ç±»ï¼š<ul><li>ä¸€ç±»æ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„ç¬æ—¶å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡çš„åˆ›å»ºå’Œæ¶ˆäº¡éƒ½éå¸¸è¿…é€Ÿ</li><li>å¦å¤–ä¸€ç±»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå´éå¸¸é•¿ï¼Œåœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹è¿˜èƒ½å¤Ÿä¸ JVM çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´</li></ul></li><li>Java å †åŒºè¿›ä¸€æ­¥ç»†åˆ†çš„è¯ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoungGenï¼‰å’Œè€å¹´ä»£ï¼ˆOldGenï¼‰</li><li>å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥åˆ’åˆ†ä¸º Eden ç©ºé—´ã€Survivor0 ç©ºé—´å’Œ Survivor1 ç©ºé—´ï¼ˆæœ‰æ—¶ä¹Ÿå«åš from åŒºã€to åŒºï¼‰</li></ul><p><img src="../jvm-sgg5/012.png" alt="å †ç©ºé—´ç»“æ„"></p><p><img src="../jvm-sgg5/013.png" alt=""></p><ul><li><p>é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”</p><ul><li><p>é»˜è®¤<code>-XX:NewRatio=2</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 2ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„ 1/3</p></li><li><p>å¯ä»¥ä¿®æ”¹<code>-XX:NewRatio=4</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 4ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„ 1/5</p></li></ul></li><li><p>åœ¨ HotSpot ä¸­ï¼ŒEdenç©ºé—´å’Œå¦å¤–ä¸¤ä¸ª survivor ç©ºé—´ç¼ºçœæ‰€å çš„æ¯”ä¾‹æ˜¯ 8 : 1 : 1</p></li></ul><blockquote><p>è¡¥å……: ä½†æ˜¯é€šè¿‡<code>jstat -gc</code> å‘ç°æ˜¯6:1:1, è¿™æ˜¯å› ä¸ºæœ‰ä¸ªè‡ªé€‚åº”ç­–ç•¥, é€šè¿‡ <code>-XX:-UseAdaptiveSizePolicy</code> å¯å…³é—­</p></blockquote><ul><li><p>å½“ç„¶å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹ <code>-XX:SurvivorRatio</code> è°ƒæ•´è¿™ä¸ªç©ºé—´æ¯”ä¾‹ã€‚æ¯”å¦‚ <code>-XX:SurvivorRatio=8</code></p></li><li><p>å‡ ä¹æ‰€æœ‰çš„ Java å¯¹è±¡éƒ½æ˜¯åœ¨ Eden åŒºè¢« new å‡ºæ¥çš„ã€‚</p></li><li><p>ç»å¤§éƒ¨åˆ†çš„ Java å¯¹è±¡çš„é”€æ¯éƒ½åœ¨æ–°ç”Ÿä»£è¿›è¡Œäº†ï¼ˆæœ‰äº›å¤§çš„å¯¹è±¡åœ¨ Eden åŒºæ— æ³•å­˜å‚¨æ—¶å€™ï¼Œå°†ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼‰ï¼ŒIBM å…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­ 80% çš„å¯¹è±¡éƒ½æ˜¯&quot;æœç”Ÿå¤•æ­»&quot;çš„ã€‚</p></li><li><p>å¯ä»¥ä½¿ç”¨é€‰é¡¹ <code>-Xmn</code> è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å†…å­˜å¤§å°ï¼Œä½†è¿™ä¸ªå‚æ•°ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚</p></li></ul><h2 id="4-å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹">4-å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹</h2><blockquote><p>ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ˜¯ä¸€ä»¶éå¸¸ä¸¥è°¨å’Œå¤æ‚çš„ä»»åŠ¡ï¼ŒJVM çš„è®¾è®¡è€…ä»¬ä¸ä»…éœ€è¦è€ƒè™‘å†…å­˜å¦‚ä½•åˆ†é…ã€åœ¨å“ªé‡Œåˆ†é…ç­‰é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºå†…å­˜åˆ†é…ç®—æ³•ä¸å†…å­˜å›æ”¶ç®—æ³•å¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥è¿˜éœ€è¦è€ƒè™‘ GC æ‰§è¡Œå®Œå†…å­˜å›æ”¶åæ˜¯å¦ä¼šåœ¨å†…å­˜ç©ºé—´ä¸­äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p></blockquote><h3 id="å…·ä½“è¿‡ç¨‹">å…·ä½“è¿‡ç¨‹</h3><ol><li>new çš„å¯¹è±¡å…ˆæ”¾ä¼Šç”¸å›­åŒºã€‚æ­¤åŒºæœ‰å¤§å°é™åˆ¶ã€‚</li><li>å½“ä¼Šç”¸å›­çš„ç©ºé—´å¡«æ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVM çš„åƒåœ¾å›æ”¶å™¨å°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinorGCï¼‰ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­çš„ä¸å†è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ã€‚å†åŠ è½½æ–°çš„å¯¹è±¡æ”¾åˆ°ä¼Šç”¸å›­åŒºã€‚</li><li>ç„¶åå°†ä¼Šç”¸å›­ä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€…0åŒºã€‚</li></ol><p><img src="../jvm-sgg5/014.png" alt="æ¸…é™¤çº¢è‰²,å‰©ä½™æ”¾å…¥S0"></p><ol start="4"><li>å¦‚æœå†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€…0åŒºçš„ï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€…1åŒºã€‚</li></ol><p><img src="../jvm-sgg5/015.png" alt="æ¸…é™¤çº¢è‰²,S0æ”¾ç½®S1"></p><ol start="5"><li>å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾å›å¹¸å­˜è€…0åŒºï¼Œæ¥ç€å†å»å¹¸å­˜è€… 1 åŒºã€‚</li></ol><p><img src="../jvm-sgg5/016.png" alt="ç»§ç»­å›åˆ°S0"></p><ol start="5"><li>å•¥æ—¶å€™èƒ½å»å…»è€åŒºå‘¢ï¼Ÿå¯ä»¥è®¾ç½®æ¬¡æ•°ã€‚é»˜è®¤æ˜¯ 15 æ¬¡ã€‚å¯ä»¥è®¾ç½®æ–°ç”ŸåŒºè¿›å…¥å…»è€åŒºçš„å¹´é¾„é™åˆ¶ï¼Œè®¾ç½® JVM å‚æ•°ï¼š<code>-XX:MaxTenuringThreshold=N</code> è¿›è¡Œè®¾ç½®</li></ol><p><img src="../jvm-sgg5/017.png" alt="å½“æ¬¡æ•°è¾¾åˆ°15æ¬¡åæ™‹å‡è‡³è€å¹´ä»£"></p><ol start="7"><li><p>åœ¨å…»è€åŒºï¼Œç›¸å¯¹æ‚ é—²ã€‚å½“å…»è€åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œå†æ¬¡è§¦å‘ GCï¼šMajor GCï¼Œè¿›è¡Œå…»è€åŒºçš„å†…å­˜æ¸…ç†</p></li><li><p>è‹¥å…»è€åŒºæ‰§è¡Œäº† Major GC ä¹‹åï¼Œå‘ç°ä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”Ÿ OOM å¼‚å¸¸ã€‚</p></li></ol><h3 id="æ€»ç»“">æ€»ç»“</h3><ul><li>é’ˆå¯¹å¹¸å­˜è€… S0, S1 åŒºçš„æ€»ç»“: å¤åˆ¶ä¹‹åæœ‰äº¤æ¢, è°ç©ºè°æ˜¯ to.</li><li>å…³äºåƒåœ¾å›æ”¶: é¢‘ç¹åœ¨æ–°ç”ŸåŒºæ”¶é›†, å¾ˆå°‘åœ¨å…»è€åŒºæ”¶é›†, å‡ ä¹ä¸åœ¨æ°¸ä¹…åŒº/å…ƒç©ºé—´æ”¶é›†.</li></ul><h3 id="ç‰¹æ®Šæƒ…å†µè¯´æ˜">ç‰¹æ®Šæƒ…å†µè¯´æ˜</h3><p><img src="../jvm-sgg5/018.png" alt=""></p><ul><li>å¦‚æœæ¥äº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå…ˆçœ‹çœ‹ Eden æ˜¯å¦æ”¾çš„ä¸‹ï¼Ÿ<ul><li>å¦‚æœ Eden æ”¾å¾—ä¸‹ï¼Œåˆ™ç›´æ¥æ”¾åˆ° Eden åŒº</li><li>å¦‚æœ Eden æ”¾ä¸ä¸‹ï¼Œåˆ™è§¦å‘ YGC ï¼Œæ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œçœ‹çœ‹è¿˜èƒ½ä¸èƒ½æ”¾ä¸‹ï¼Ÿ</li></ul></li><li>å°†å¯¹è±¡æ”¾åˆ°è€å¹´åŒºåˆæœ‰ä¸¤ç§æƒ…å†µï¼š<ul><li>å¦‚æœ Eden æ‰§è¡Œäº† YGC è¿˜æ˜¯æ— æ³•æ”¾ä¸ä¸‹è¯¥å¯¹è±¡ï¼Œé‚£æ²¡å¾—åŠæ³•ï¼Œåªèƒ½è¯´æ˜æ˜¯è¶…å¤§å¯¹è±¡ï¼Œåªèƒ½ç›´æ¥æ”¾åˆ°è€å¹´ä»£</li><li>é‚£ä¸‡ä¸€è€å¹´ä»£éƒ½æ”¾ä¸ä¸‹ï¼Œåˆ™å…ˆè§¦å‘ FullGC ï¼Œå†çœ‹çœ‹èƒ½ä¸èƒ½æ”¾ä¸‹ï¼Œæ”¾å¾—ä¸‹æœ€å¥½ï¼Œä½†å¦‚æœè¿˜æ˜¯æ”¾ä¸ä¸‹ï¼Œé‚£åªèƒ½æŠ¥ OOM</li></ul></li><li>å¦‚æœ Eden åŒºæ»¡äº†ï¼Œå°†å¯¹è±¡å¾€å¹¸å­˜åŒºæ‹·è´æ—¶ï¼Œå‘ç°å¹¸å­˜åŒºæ”¾ä¸ä¸‹å•¦ï¼Œé‚£åªèƒ½ä¾¿å®œäº†æŸäº›æ–°å¯¹è±¡ï¼Œè®©ä»–ä»¬ç›´æ¥æ™‹å‡è‡³è€å¹´åŒº</li></ul><h2 id="5-GC-Minor-Major-Full">5-GC(Minor/Major/Full)</h2><ul><li>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJVM çš„è°ƒä¼˜çš„ä¸€ä¸ªç¯èŠ‚ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†ï¼Œæˆ‘ä»¬éœ€è¦å°½é‡çš„é¿å…åƒåœ¾å›æ”¶ï¼Œå› ä¸ºåœ¨åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå®¹æ˜“å‡ºç° STWï¼ˆStop the Worldï¼‰çš„é—®é¢˜ï¼Œ<strong>è€Œ Major GC å’Œ Full GCå‡ºç°STWçš„æ—¶é—´ï¼Œæ˜¯Minor GCçš„10å€ä»¥ä¸Š</strong></li><li>JVM åœ¨è¿›è¡Œ GC æ—¶ï¼Œå¹¶éæ¯æ¬¡éƒ½å¯¹ä¸Šé¢ä¸‰ä¸ªå†…å­˜åŒºåŸŸä¸€èµ·å›æ”¶çš„ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å›æ”¶çš„éƒ½æ˜¯æŒ‡æ–°ç”Ÿä»£ã€‚é’ˆå¯¹ Hotspot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC æŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç§ç±»å‹ï¼šä¸€ç§æ˜¯éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ï¼Œä¸€ç§æ˜¯æ•´å †æ”¶é›†ï¼ˆFullGCï¼‰</li><li>éƒ¨åˆ†æ”¶é›†ï¼šä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ª Java å †çš„åƒåœ¾æ”¶é›†ã€‚å…¶ä¸­åˆåˆ†ä¸ºï¼š<ul><li><strong>æ–°ç”Ÿä»£æ”¶é›†</strong>ï¼ˆMinor GC/Young GCï¼‰ï¼šåªæ˜¯æ–°ç”Ÿä»£ï¼ˆEdenï¼Œs0ï¼Œs1ï¼‰çš„åƒåœ¾æ”¶é›†</li><li><strong>è€å¹´ä»£æ”¶é›†</strong>ï¼ˆMajor GC/Old GCï¼‰ï¼šåªæ˜¯è€å¹´ä»£çš„åœ¾æ”¶é›†ã€‚</li><li>ç›®å‰ï¼Œåªæœ‰ CMS GC ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚</li><li>æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™ Major GC ä¼šå’Œ Full GC æ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰ï¼Œåªæœ‰ G1 GC ä¼šæœ‰è¿™ç§è¡Œä¸º</li></ul></li><li><strong>æ•´å †æ”¶é›†</strong>ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li></ul><h3 id="Young-Minor-GC">Young/Minor GC</h3><h4 id="æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶">æœ€ç®€å•çš„åˆ†ä»£å¼GCç­–ç•¥çš„è§¦å‘æ¡ä»¶</h4><p><strong>å¹´è½»ä»£ GCï¼ˆMinor GCï¼‰è§¦å‘æœºåˆ¶</strong></p><ul><li><p>å½“å¹´è½»ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘ Minor GCï¼Œè¿™é‡Œçš„å¹´è½»ä»£æ»¡æŒ‡çš„æ˜¯ Eden ä»£æ»¡ã€‚Survivor æ»¡ä¸ä¼šä¸»åŠ¨å¼•å‘ GCï¼Œåœ¨ Eden åŒºæ»¡çš„æ—¶å€™ï¼Œä¼šé¡ºå¸¦è§¦å‘ s0 åŒºçš„ GCï¼Œä¹Ÿå°±æ˜¯è¢«åŠ¨è§¦å‘ GCï¼ˆæ¯æ¬¡ Minor GC ä¼šæ¸…ç†å¹´è½»ä»£çš„å†…å­˜ï¼‰</p></li><li><p>å› ä¸º Java å¯¹è±¡<strong>å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­</strong>çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ Minor GC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚è¿™ä¸€å®šä¹‰æ—¢æ¸…æ™°åˆæ˜“äºç†è§£ã€‚</p></li><li><p>Minor GC ä¼šå¼•å‘ STWï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œ</p></li></ul><p><img src="../jvm-sgg5/019.png" alt=""></p><h3 id="Major-GC">Major GC</h3><ul><li><p>æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå¯¹è±¡ä»è€å¹´ä»£æ¶ˆå¤±æ—¶ï¼Œæˆ‘ä»¬è¯´ <code>Major GC</code> æˆ– <code>Full GC</code> å‘ç”Ÿäº†</p></li><li><p>å‡ºç°äº†<code>Major GC</code>ï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ <code>Minor GC</code>ã€‚ï¼ˆä½†éç»å¯¹çš„ï¼Œåœ¨ Parallel Scavenge æ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡Œ <code>Major GC</code> çš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ï¼‰</p><ul><li>ä¹Ÿå°±æ˜¯åœ¨è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘ <code>Minor GC</code>ï¼Œå¦‚æœä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™è§¦å‘ <code>Major GC</code></li></ul></li><li><p><code>Major GC</code> çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” Minor GC æ…¢10å€ä»¥ä¸Šï¼ŒSTW çš„æ—¶é—´æ›´é•¿ã€‚</p></li><li><p>å¦‚æœ <code>Major GC</code> åï¼Œå†…å­˜è¿˜ä¸è¶³ï¼Œå°±æŠ¥ OOM äº†</p></li></ul><h3 id="Full-GC">Full GC</h3><ul><li>è°ƒç”¨ System.gc() æ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡Œ FullGCï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œ</li><li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li><li>æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li><li>é€šè¿‡ Minor GC åè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li><li>ç”±EdenåŒºã€survivor space0ï¼ˆFrom Spaceï¼‰åŒºå‘ survivor space1ï¼ˆTo Spaceï¼‰åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äº To Space å¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°</li></ul><blockquote><p>è¯´æ˜: Full GC æ˜¯å¼€å‘æˆ–è°ƒä¼˜ä¸­å°½é‡è¦é¿å…çš„. è¿™æ ·æš‚æ—¶æ—¶é—´ä¼šçŸ­ä¸€äº›.</p></blockquote><h3 id="æ—¥å¿—åˆ†æDemo">æ—¥å¿—åˆ†æDemo</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æµ‹è¯•MinorGC ã€ MajorGCã€FullGC * -Xms9m -Xmx9m -XX:+PrintGCDetails * @author dee */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GCTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">"atguigu.com"</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>                a <span class="token operator">=</span> a <span class="token operator">+</span> a<span class="token punctuation">;</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            t<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"éå†æ¬¡æ•°ä¸ºï¼š"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="../jvm-sgg5/020.png" alt="æ—¥å¿—åˆ†æ"></p><h2 id="6-å †ç©ºé—´åˆ†ä»£æ€æƒ³">6-å †ç©ºé—´åˆ†ä»£æ€æƒ³</h2><blockquote><p>ä¸ºä»€ä¹ˆè¦æŠŠ Java å †åˆ†ä»£ï¼Ÿä¸åˆ†ä»£å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†å—ï¼Ÿ</p></blockquote><ul><li><p>ç»ç ”ç©¶ï¼Œä¸åŒå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸åŒã€‚70%-99% çš„å¯¹è±¡æ˜¯ä¸´æ—¶å¯¹è±¡ã€‚</p><ul><li>æ–°ç”Ÿä»£ï¼šæœ‰ Edenã€ä¸¤å—å¤§å°ç›¸åŒçš„ survivorï¼ˆåˆç§°ä¸º from/to æˆ– s0/s1ï¼‰æ„æˆï¼Œto æ€»ä¸ºç©ºã€‚</li><li>è€å¹´ä»£ï¼šå­˜æ”¾æ–°ç”Ÿä»£ä¸­ç»å†å¤šæ¬¡ GC ä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</li></ul></li><li><p>å…¶å®ä¸åˆ†ä»£å®Œå…¨å¯ä»¥ï¼Œåˆ†ä»£çš„å”¯ä¸€ç†ç”±å°±æ˜¯ä¼˜åŒ– GC æ€§èƒ½. å¦‚æœæ²¡æœ‰åˆ†ä»£ï¼Œé‚£æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ä¸€å—ï¼Œå°±å¦‚åŒæŠŠä¸€ä¸ªå­¦æ ¡çš„äººéƒ½å…³åœ¨ä¸€ä¸ªæ•™å®¤ã€‚GC çš„æ—¶å€™è¦æ‰¾åˆ°å“ªäº›å¯¹è±¡æ²¡ç”¨ï¼Œè¿™æ ·å°±ä¼šå¯¹å †çš„æ‰€æœ‰åŒºåŸŸè¿›è¡Œæ‰«æã€‚ï¼ˆæ€§èƒ½ä½ï¼‰</p><p>è€Œå¾ˆå¤šå¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œå¦‚æœåˆ†ä»£çš„è¯ï¼ŒæŠŠæ–°åˆ›å»ºçš„å¯¹è±¡æ”¾åˆ°æŸä¸€åœ°æ–¹ï¼Œå½“ GC çš„æ—¶å€™å…ˆæŠŠè¿™å—å­˜å‚¨â€œæœç”Ÿå¤•æ­»â€å¯¹è±¡çš„åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè¿™æ ·å°±ä¼šè…¾å‡ºå¾ˆå¤§çš„ç©ºé—´å‡ºæ¥ã€‚ï¼ˆå¤šå›æ”¶æ–°ç”Ÿä»£ï¼Œå°‘å›æ”¶è€å¹´ä»£ï¼Œæ€§èƒ½ä¼šæé«˜å¾ˆå¤šï¼‰</p></li></ul><h2 id="7-å¯¹è±¡å†…å­˜åˆ†é…ç­–ç•¥">7-å¯¹è±¡å†…å­˜åˆ†é…ç­–ç•¥</h2><blockquote><p>åˆç§° å¯¹è±¡æå‡(Promotion)è§„åˆ™</p></blockquote><ul><li>å¦‚æœå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡ <code>Minor GC</code> åä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢« Survivor å®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ° Survivor ç©ºé—´ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º 1ã€‚</li><li>å¯¹è±¡åœ¨ Survivor åŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ <code>Minor GC</code>ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼Œå…¶å®æ¯ä¸ª JVMã€æ¯ä¸ª GC éƒ½æœ‰æ‰€ä¸åŒï¼‰æ—¶ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£</li><li>å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜€å€¼ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹ <code>-XX:MaxTenuringThreshold</code> æ¥è®¾ç½®</li></ul><p><strong>é’ˆå¯¹ä¸åŒå¹´é¾„æ®µçš„å¯¹è±¡åˆ†é…åŸåˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p><ul><li><strong>ä¼˜å…ˆåˆ†é…åˆ° Eden</strong><ul><li>å¼€å‘ä¸­æ¯”è¾ƒé•¿çš„<strong>å­—ç¬¦ä¸²</strong>æˆ–è€…<strong>æ•°ç»„</strong>ï¼Œä¼šç›´æ¥å­˜åœ¨è€å¹´ä»£ï¼Œä½†æ˜¯å› ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå¤§å¯¹è±¡å¯èƒ½ä¹Ÿå¾ˆå¿«è¢«å›æ”¶ï¼Œä½†æ˜¯å› ä¸ºè€å¹´ä»£è§¦å‘ Major GC çš„æ¬¡æ•°æ¯” Minor GC è¦æ›´å°‘ï¼Œå› æ­¤å¯èƒ½å›æ”¶èµ·æ¥å°±ä¼šæ¯”è¾ƒæ…¢</li></ul></li><li><strong>å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</strong><ul><li>å°½é‡é¿å…ç¨‹åºä¸­å‡ºç°è¿‡å¤šçš„å¤§å¯¹è±¡</li></ul></li><li><strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡åˆ†é…åˆ°è€å¹´ä»£</strong></li><li><strong>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­</strong><ul><li>å¦‚æœ Survivor åŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ° <code>MaxTenuringThreshold</code> ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</li></ul></li><li><strong>ç©ºé—´åˆ†é…æ‹…ä¿</strong><ul><li><code>-XX:HandlePromotionFailure</code></li></ul></li></ul><h2 id="8-TLABä¸ºå¯¹è±¡åˆ†é…å†…å­˜">8-TLABä¸ºå¯¹è±¡åˆ†é…å†…å­˜</h2><h3 id="ä¸ºä»€ä¹ˆæœ‰-TLAB">ä¸ºä»€ä¹ˆæœ‰ TLAB</h3><p>(Thread Local Allocation Buffer)</p><ul><li>å †åŒºæ˜¯çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åˆ°å †åŒºä¸­çš„å…±äº«æ•°æ®</li><li>ç”±äºå¯¹è±¡å®ä¾‹çš„åˆ›å»ºåœ¨ JVM ä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä»å †åŒºä¸­åˆ’åˆ†å†…å­˜ç©ºé—´æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</li><li>ä¸ºé¿å…å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€åœ°å€ï¼Œéœ€è¦ä½¿ç”¨<strong>åŠ é”ç­‰æœºåˆ¶</strong>ï¼Œè¿›è€Œå½±å“åˆ†é…é€Ÿåº¦ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯TLAB">ä»€ä¹ˆæ˜¯TLAB</h3><ul><li>ä»å†…å­˜æ¨¡å‹è€Œä¸æ˜¯åƒåœ¾æ”¶é›†çš„è§’åº¦ï¼Œå¯¹ Eden åŒºåŸŸç»§ç»­è¿›è¡Œåˆ’åˆ†ï¼Œ<strong>JVM ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªç§æœ‰ç¼“å­˜åŒºåŸŸï¼Œå®ƒåŒ…å«åœ¨ Eden ç©ºé—´å†…</strong>ã€‚</li><li>å¤šçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œä½¿ç”¨ TLAB å¯ä»¥é¿å…ä¸€ç³»åˆ—çš„éçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿæå‡å†…å­˜åˆ†é…çš„ååé‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ç§å†…å­˜åˆ†é…æ–¹å¼ç§°ä¹‹ä¸º<strong>å¿«é€Ÿåˆ†é…ç­–ç•¥</strong>ã€‚</li><li>æ®æˆ‘æ‰€çŸ¥æ‰€æœ‰ OpenJDK è¡ç”Ÿå‡ºæ¥çš„ JVM éƒ½æä¾›äº† TLAB çš„è®¾è®¡ã€‚</li></ul><p><img src="../jvm-sgg5/021.png" alt=""></p><ul><li><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª TLAB ç©ºé—´</p><p>å½“ä¸€ä¸ªçº¿ç¨‹çš„ TLAB å­˜æ»¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…¬å…±åŒºåŸŸï¼ˆè“è‰²ï¼‰çš„</p></li></ul><h3 id="TLABå†è¯´æ˜">TLABå†è¯´æ˜</h3><ul><li><p>å°½ç®¡ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½èƒ½å¤Ÿåœ¨TLABä¸­æˆåŠŸåˆ†é…å†…å­˜ï¼Œä½† <strong>JVMç¡®å®æ˜¯å°† TLAB ä½œä¸ºå†…å­˜åˆ†é…çš„é¦–é€‰</strong>ã€‚</p></li><li><p>åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹â€œ<strong>-XX:UseTLAB</strong>â€è®¾ç½®æ˜¯å¦å¼€å¯ TLAB ç©ºé—´ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒTLAB ç©ºé—´çš„å†…å­˜éå¸¸å°ï¼Œä»…å æœ‰æ•´ä¸ª Eden ç©ºé—´çš„ 1%ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰é¡¹ <code>-XX:TLABWasteTargetPercent</code> è®¾ç½® TLAB ç©ºé—´æ‰€å ç”¨ Eden ç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ã€‚</p></li><li><p>ä¸€æ—¦å¯¹è±¡åœ¨ TLAB ç©ºé—´åˆ†é…å†…å­˜å¤±è´¥æ—¶ï¼ŒJVM å°±ä¼šå°è¯•ç€é€šè¿‡<strong>ä½¿ç”¨åŠ é”æœºåˆ¶ç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§</strong>ï¼Œä»è€Œç›´æ¥åœ¨ Eden ç©ºé—´ä¸­åˆ†é…å†…å­˜ã€‚</p></li></ul><p><img src="../jvm-sgg5/022.png" alt="TLABåˆ†é…è¿‡ç¨‹"></p><h2 id="9-å †ç©ºé—´å¸¸ç”¨å‚æ•°è®¾ç½®">9-å †ç©ºé—´å¸¸ç”¨å‚æ•°è®¾ç½®</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-XX:+PrintFlagsInitial</span>  æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼<span class="token parameter variable">-XX:+PrintFlagsFinal</span>  ï¼šæŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆå¯èƒ½ä¼šå­˜åœ¨ä¿®æ”¹ï¼Œä¸å†æ˜¯åˆå§‹å€¼ï¼‰jpsï¼šæŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„è¿›ç¨‹idjinfo <span class="token parameter variable">-flag</span> SurvivorRatio è¿›ç¨‹id<span class="token parameter variable">-Xms</span>  åˆå§‹å †ç©ºé—´å†…å­˜<span class="token punctuation">(</span>é»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/64<span class="token punctuation">)</span><span class="token parameter variable">-Xmx</span>  æœ€å¤§å †ç©ºé—´å†…å­˜<span class="token punctuation">(</span>é»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/4<span class="token punctuation">)</span><span class="token parameter variable">-Xmn</span>  è®¾ç½®æ–°ç”Ÿä»£çš„å¤§å°<span class="token punctuation">(</span>åˆå§‹å€¼åŠæœ€å¤§å€¼<span class="token punctuation">)</span><span class="token parameter variable">-XX:NewRatio</span>  é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”<span class="token parameter variable">-XX:SurvivorRatio</span>  è®¾ç½®æ–°ç”Ÿä»£ä¸­Edenå’ŒS0/S1ç©ºé—´çš„æ¯”ä¾‹<span class="token parameter variable">-XX:MaxTenuringThreshold</span>  è®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„<span class="token parameter variable">-XX:+PrintGCDetails</span>  è¾“å‡ºè¯¦ç»†çš„GCå¤„ç†æ—¥å¿—<span class="token parameter variable">-XX:+PrintGC</span>  æ‰“å°gcç®€è¦ä¿¡æ¯<span class="token parameter variable">-verbose:gc</span>  æ‰“å°gcç®€è¦ä¿¡æ¯<span class="token parameter variable">-XX:HandlePromotionFailure</span>  æ˜¯å¦è®¾ç½®ç©ºé—´åˆ†é…æ‹…ä¿<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç©ºé—´åˆ†é…æ‹…ä¿">ç©ºé—´åˆ†é…æ‹…ä¿</h3><p>åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ã€‚</p><ul><li>å¦‚æœå¤§äºï¼Œåˆ™æ­¤æ¬¡ Minor GC æ˜¯å®‰å…¨çš„</li><li>å¦‚æœå°äºï¼Œåˆ™è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ <code>-XX:HandlePromotionFailure</code> è®¾ç½®å€¼æ˜¯å¦å…æ‹…ä¿å¤±è´¥<ul><li>å¦‚æœ HandlePromotionFailure=trueï¼Œé‚£ä¹ˆä¼šç»§ç»­æ£€æŸ¥<strong>è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°</strong><ul><li>å¦‚æœå¤§äºï¼Œåˆ™å°è¯•è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œä½†è¿™æ¬¡ Minor GC ä¾ç„¶æ˜¯æœ‰é£é™©çš„</li><li>å¦‚æœå°äºï¼Œåˆ™è¿›è¡Œä¸€æ¬¡ Full GC</li></ul></li><li>å¦‚æœ HandlePromotionFailure=falseï¼Œåˆ™è¿›è¡Œä¸€æ¬¡ Full GC</li></ul></li></ul><ul><li>åœ¨ JDK6 Update 24 ä¹‹åï¼Œ<code>HandlePromotionFailure</code>å‚æ•°ä¸ä¼šå†å½±å“åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´åˆ†é…æ‹…ä¿ç­–ç•¥ï¼Œè§‚å¯Ÿ openJDK ä¸­çš„æºç å˜åŒ–ï¼Œè™½ç„¶æºç ä¸­è¿˜å®šä¹‰äº† <code>HandlePromotionFailure</code> å‚æ•°ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­å·²ç»ä¸ä¼šå†ä½¿ç”¨å®ƒã€‚</li><li>JDK6 Update 24 ä¹‹åçš„è§„åˆ™å˜ä¸º<strong>åªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°æˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°å°±ä¼šè¿›è¡Œ Minor GC</strong>, å¦åˆ™å°†è¿›è¡Œ Full GC. å³ <code>HandlePromotionFailure=true</code></li></ul><h2 id="10-å¯¹è±¡å­˜å‚¨æ ˆä¸Šåˆ†é…â€“é€ƒé€¸åˆ†æ">10-å¯¹è±¡å­˜å‚¨æ ˆä¸Šåˆ†é…â€“é€ƒé€¸åˆ†æ</h2><ul><li>éšç€JITç¼–è¯‘æœŸçš„å‘å±•ä¸<strong>é€ƒé€¸åˆ†ææŠ€æœ¯</strong>é€æ¸æˆç†Ÿï¼Œ<strong>æ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢</strong>ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆ&quot;ç»å¯¹&quot;äº†ã€‚</li><li>åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡æ˜¯åœ¨ Java å †ä¸­åˆ†é…å†…å­˜çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®éçš„å¸¸è¯†ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œé‚£å°±æ˜¯<strong>å¦‚æœç»è¿‡é€ƒé€¸åˆ†æ(Escape Analysis)åå‘ç°ï¼Œä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…</strong>ã€‚è¿™æ ·å°±æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œä¹Ÿæ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„å †å¤–å­˜å‚¨æŠ€æœ¯ã€‚<ul><li>æ­¤å¤–ï¼Œå‰é¢æåˆ°çš„åŸºäº OpenJDK æ·±åº¦å®šåˆ¶çš„ TaoBao VMï¼Œå…¶ä¸­åˆ›æ–°çš„ GCIHï¼ˆGC invisible heapï¼‰æŠ€æœ¯å®ç° off-heapï¼Œå°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„Javaå¯¹è±¡ä» heap ä¸­ç§»è‡³ heap å¤–ï¼Œå¹¶ä¸” GC ä¸èƒ½ç®¡ç† GCIH å†…éƒ¨çš„ Java å¯¹è±¡ï¼Œä»¥æ­¤è¾¾åˆ°é™ä½ GC çš„å›æ”¶é¢‘ç‡å’Œæå‡ GC çš„å›æ”¶æ•ˆç‡çš„ç›®çš„ã€‚</li></ul></li></ul><h3 id="é€ƒé€¸åˆ†ææ¦‚è¿°">é€ƒé€¸åˆ†ææ¦‚è¿°</h3><ul><li>å¦‚ä½•å°†å †ä¸Šçš„å¯¹è±¡åˆ†é…åˆ°æ ˆï¼Œéœ€è¦ä½¿ç”¨é€ƒé€¸åˆ†ææ‰‹æ®µã€‚</li><li>è¿™æ˜¯ä¸€ç§å¯ä»¥æœ‰æ•ˆå‡å°‘ Java ç¨‹åºä¸­åŒæ­¥è´Ÿè½½å’Œå†…å­˜å †åˆ†é…å‹åŠ›çš„è·¨å‡½æ•°å…¨å±€æ•°æ®æµåˆ†æç®—æ³•ã€‚</li><li>é€šè¿‡é€ƒé€¸åˆ†æï¼ŒJava Hotspot ç¼–è¯‘å™¨èƒ½å¤Ÿåˆ†æå‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡çš„å¼•ç”¨çš„ä½¿ç”¨èŒƒå›´ä»è€Œå†³å®šæ˜¯å¦è¦å°†è¿™ä¸ªå¯¹è±¡åˆ†é…åˆ°å †ä¸Šã€‚</li><li>é€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼š<ul><li>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå¯¹è±¡åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å‘ç”Ÿé€ƒé€¸ã€‚</li><li>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå®ƒè¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œåˆ™è®¤ä¸ºå‘ç”Ÿé€ƒé€¸ã€‚ä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ä¸­ã€‚</li></ul></li></ul><h3 id="é€ƒé€¸åˆ†æä¸¾ä¾‹">é€ƒé€¸åˆ†æä¸¾ä¾‹</h3><ul><li>æ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥åˆ†é…åˆ°æ ˆï¼ˆæ— çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰ä¸Šï¼Œéšç€æ–¹æ³•æ‰§è¡Œçš„ç»“æŸï¼Œæ ˆç©ºé—´å°±è¢«ç§»é™¤ï¼ˆä¹Ÿå°±æ— éœ€ GCï¼‰</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ­¤æ–¹æ³•å†… v çš„ä½œç”¨ç©ºé—´åªåœ¨æ–¹æ³•å†…éƒ¨, å› æ­¤å¯ä»¥å°†ä»–æ”¾åœ¨æ ˆä¸­</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">my_method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">V</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">V</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// use v</span>    <span class="token comment">// ....</span>    v <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä»£ç ä¼˜åŒ–æ¡ˆä¾‹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StringBuffer</span> <span class="token function">createStringBuffer</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> sb<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæƒ³è¦ StringBuffer sb ä¸é€ƒå‡ºæ–¹æ³•, å¯ä»¥æ”¹å†™å¦‚ä¸‹:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createStringBuffer</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ¤æ–­é€ƒé€¸åˆ†ææ¡ˆä¾‹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * é€ƒé€¸åˆ†æ * *  å¦‚ä½•å¿«é€Ÿçš„åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†é€ƒé€¸åˆ†æï¼Œå¤§å®¶å°±çœ‹newçš„å¯¹è±¡å®ä½“æ˜¯å¦æœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ã€‚ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EscapeAnalysis</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">EscapeAnalysis</span> obj<span class="token punctuation">;</span>    <span class="token comment">/*    æ–¹æ³•è¿”å›EscapeAnalysiså¯¹è±¡ï¼Œå‘ç”Ÿé€ƒé€¸     */</span>    <span class="token keyword">public</span> <span class="token class-name">EscapeAnalysis</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">EscapeAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> obj<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*    ä¸ºæˆå‘˜å±æ€§èµ‹å€¼ï¼Œå‘ç”Ÿé€ƒé€¸     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EscapeAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//æ€è€ƒï¼šå¦‚æœå½“å‰çš„objå¼•ç”¨å£°æ˜ä¸ºstaticçš„ï¼Ÿä»ç„¶ä¼šå‘ç”Ÿé€ƒé€¸ã€‚</span>    <span class="token comment">/*    å¯¹è±¡çš„ä½œç”¨åŸŸä»…åœ¨å½“å‰æ–¹æ³•ä¸­æœ‰æ•ˆï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">useEscapeAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">EscapeAnalysis</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EscapeAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*    å¼•ç”¨æˆå‘˜å˜é‡çš„å€¼ï¼Œå‘ç”Ÿé€ƒé€¸     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">useEscapeAnalysis1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">EscapeAnalysis</span> e <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//getInstance().xxx()åŒæ ·ä¼šå‘ç”Ÿé€ƒé€¸</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»£ç ä¼˜åŒ–">ä»£ç ä¼˜åŒ–</h3><p>ä½¿ç”¨é€ƒé€¸åˆ†æ, ç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç åšå¦‚ä¸‹ä¼˜åŒ–:</p><ul><li><strong>æ ˆä¸Šåˆ†é…</strong>: å°†å †åˆ†é…è½¬åŒ–ä¸ºæ ˆåˆ†é…. å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨å­ç¨‹åºä¸­è¢«åˆ†é…, è¦ä½¿æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆæ°¸è¿œä¸ä¼šå‘ç”Ÿé€ƒé€¸, å¯¹è±¡å¯èƒ½æ˜¯æ ˆä¸Šåˆ†é…çš„å€™é€‰, è€Œä¸æ˜¯å †ä¸Šåˆ†é…</li><li><strong>åŒæ­¥çœç•¥</strong>: å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å‘ç°åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå¯¹è±¡çš„æ“ä½œå¯ä»¥ä¸è€ƒè™‘åŒæ­¥.</li><li><strong>åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢</strong>: æœ‰çš„å¯¹è±¡å¯èƒ½ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªè¿ç»­çš„å†…å­˜ç»“æ„å­˜åœ¨ä¹Ÿå¯ä»¥è¢«è®¿é—®åˆ°, é‚£ä¹ˆå¯¹è±¡çš„éƒ¨åˆ†(æˆ–å…¨éƒ¨)å¯ä»¥ä¸å­˜å‚¨åœ¨å†…å­˜, è€Œæ˜¯å­˜å‚¨åœ¨ CPU å¯„å­˜å™¨ä¸­.</li></ul><h4 id="æ ˆä¸Šåˆ†é…">æ ˆä¸Šåˆ†é…</h4><ul><li>JITç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´æ ¹æ®é€ƒé€¸åˆ†æçš„ç»“æœï¼Œå‘ç°å¦‚æœä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…ã€‚åˆ†é…å®Œæˆåï¼Œç»§ç»­åœ¨è°ƒç”¨æ ˆå†…æ‰§è¡Œï¼Œæœ€åçº¿ç¨‹ç»“æŸï¼Œæ ˆç©ºé—´è¢«å›æ”¶ï¼Œå±€éƒ¨å˜é‡å¯¹è±¡ä¹Ÿè¢«å›æ”¶ã€‚è¿™æ ·å°±æ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚</li><li>å¸¸è§çš„æ ˆä¸Šåˆ†é…çš„åœºæ™¯<ul><li>åœ¨é€ƒé€¸åˆ†æä¸­ï¼Œå·²ç»è¯´æ˜äº†ï¼Œåˆ†åˆ«æ˜¯ç»™æˆå‘˜å˜é‡èµ‹å€¼ã€æ–¹æ³•è¿”å›å€¼ã€å®ä¾‹å¼•ç”¨ä¼ é€’ã€‚</li></ul></li></ul><h4 id="åŒæ­¥çœç•¥ï¼ˆåŒæ­¥æ¶ˆé™¤ï¼‰">åŒæ­¥çœç•¥ï¼ˆåŒæ­¥æ¶ˆé™¤ï¼‰</h4><ul><li><p>çº¿ç¨‹åŒæ­¥çš„ä»£ä»·æ˜¯ç›¸å½“é«˜çš„ï¼ŒåŒæ­¥çš„åæœæ˜¯é™ä½å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚</p></li><li><p>åœ¨åŠ¨æ€ç¼–è¯‘åŒæ­¥å—çš„æ—¶å€™ï¼ŒJITç¼–è¯‘å™¨å¯ä»¥å€ŸåŠ©é€ƒé€¸åˆ†ææ¥<strong>åˆ¤æ–­åŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å¦åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®è€Œæ²¡æœ‰è¢«å‘å¸ƒåˆ°å…¶ä»–çº¿ç¨‹</strong>ã€‚</p></li><li><p>å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆJITç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªåŒæ­¥å—çš„æ—¶å€™å°±ä¼šå–æ¶ˆå¯¹è¿™éƒ¨åˆ†ä»£ç çš„åŒæ­¥ã€‚è¿™æ ·å°±èƒ½å¤§å¤§æé«˜å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚è¿™ä¸ª<strong>å–æ¶ˆåŒæ­¥çš„è¿‡ç¨‹å°±å«åŒæ­¥çœç•¥ï¼Œä¹Ÿå«é”æ¶ˆé™¤</strong>ã€‚</p></li></ul><h4 id="æ ‡é‡æ›¿æ¢">æ ‡é‡æ›¿æ¢</h4><ul><li><p>æ ‡é‡ï¼ˆscalarï¼‰æ˜¯æŒ‡ä¸€ä¸ªæ— æ³•å†åˆ†è§£æˆæ›´å°çš„æ•°æ®çš„æ•°æ®ã€‚Javaä¸­çš„åŸå§‹æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ã€‚</p></li><li><p>ç›¸å¯¹çš„ï¼Œé‚£äº›è¿˜å¯ä»¥åˆ†è§£çš„æ•°æ®å«åš<strong>èšåˆé‡ï¼ˆAggregateï¼‰</strong>ï¼ŒJavaä¸­çš„å¯¹è±¡å°±æ˜¯èšåˆé‡ï¼Œå› ä¸ºä»–å¯ä»¥åˆ†è§£æˆå…¶ä»–èšåˆé‡å’Œæ ‡é‡ã€‚</p></li><li><p>åœ¨ JIT é˜¶æ®µï¼Œå¦‚æœç»è¿‡é€ƒé€¸åˆ†æï¼Œå‘ç°ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å¤–ç•Œè®¿é—®çš„è¯ï¼Œé‚£ä¹ˆç»è¿‡ JIT ä¼˜åŒ–ï¼Œå°±ä¼šæŠŠè¿™ä¸ªå¯¹è±¡æ‹†è§£æˆè‹¥å¹²ä¸ªå…¶ä¸­åŒ…å«çš„è‹¥å¹²ä¸ªæˆå‘˜å˜é‡æ¥ä»£æ›¿ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ ‡é‡æ›¿æ¢ã€‚</p></li></ul><p><strong>demo</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"point.x"</span> <span class="token operator">+</span> point<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">";point.y"</span> <span class="token operator">+</span> point<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> y<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šä»£ç ï¼Œç»è¿‡æ ‡é‡æ›¿æ¢åï¼Œå°±ä¼šå˜æˆ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"point.x = "</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">"; point.y="</span> <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯ä»¥çœ‹åˆ°ï¼ŒPointè¿™ä¸ªèšåˆé‡ç»è¿‡é€ƒé€¸åˆ†æåï¼Œå‘ç°ä»–å¹¶æ²¡æœ‰é€ƒé€¸ï¼Œå°±è¢«æ›¿æ¢æˆä¸¤ä¸ªèšåˆé‡äº†ã€‚</li><li>é‚£ä¹ˆæ ‡é‡æ›¿æ¢æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå°±æ˜¯å¯ä»¥å¤§å¤§å‡å°‘å †å†…å­˜çš„å ç”¨ã€‚å› ä¸ºä¸€æ—¦ä¸éœ€è¦åˆ›å»ºå¯¹è±¡äº†ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦åˆ†é…å †å†…å­˜äº†ã€‚</li><li>æ ‡é‡æ›¿æ¢ä¸ºæ ˆä¸Šåˆ†é…æä¾›äº†å¾ˆå¥½çš„åŸºç¡€ã€‚</li></ul><p><strong>æ ‡é‡æ›¿æ¢å‚æ•°è®¾ç½®</strong></p><p>å‚æ•° <code>-XX:+ElimilnateAllocations</code>ï¼šå¼€å¯äº†æ ‡é‡æ›¿æ¢ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰ï¼Œå…è®¸å°†å¯¹è±¡æ‰“æ•£åˆ†é…åœ¨æ ˆä¸Šã€‚</p><p><code>-server -Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:+EliminateAllocations</code></p><p>è¿™é‡Œè®¾ç½®å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>å‚æ•° <code>-server</code>ï¼šå¯åŠ¨ Server æ¨¡å¼ï¼Œå› ä¸ºåœ¨ Server æ¨¡å¼ä¸‹ï¼Œæ‰å¯ä»¥å¯ç”¨é€ƒé€¸åˆ†æã€‚</li><li>å‚æ•° <code>-XX:+DoEscapeAnalysis</code>ï¼šå¯ç”¨é€ƒé€¸åˆ†æ</li><li>å‚æ•° <code>-Xmx10m</code>ï¼šæŒ‡å®šäº†å †ç©ºé—´æœ€å¤§ä¸º10MB</li><li>å‚æ•° <code>-XX:+PrintGC</code>ï¼šå°†æ‰“å°GCæ—¥å¿—ã€‚</li><li>å‚æ•° <code>-XX:+EliminateAllocations</code>ï¼šå¼€å¯äº†æ ‡é‡æ›¿æ¢ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰ï¼Œå…è®¸å°†å¯¹è±¡æ‰“æ•£åˆ†é…åœ¨æ ˆä¸Šï¼Œæ¯”å¦‚å¯¹è±¡æ‹¥æœ‰ id å’Œ nameä¸¤ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—æ®µå°†ä¼šè¢«è§†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å±€éƒ¨å˜é‡è¿›è¡Œåˆ†é…</li></ul><h4 id="é€ƒé€¸åˆ†æçš„ä¸è¶³">é€ƒé€¸åˆ†æçš„ä¸è¶³</h4><ul><li>å…³äºé€ƒé€¸åˆ†æçš„è®ºæ–‡åœ¨ 1999 å¹´å°±å·²ç»å‘è¡¨äº†ï¼Œä½†ç›´åˆ° JDK1.6 æ‰æœ‰å®ç°ï¼Œè€Œä¸”è¿™é¡¹æŠ€æœ¯åˆ°å¦‚ä»Šä¹Ÿå¹¶ä¸æ˜¯ååˆ†æˆç†Ÿçš„ã€‚</li><li>å…¶æ ¹æœ¬åŸå› å°±æ˜¯æ— æ³•ä¿è¯é€ƒé€¸åˆ†æçš„æ€§èƒ½æ¶ˆè€—ä¸€å®šèƒ½é«˜äºä»–çš„æ¶ˆè€—ã€‚è™½ç„¶ç»è¿‡é€ƒé€¸åˆ†æå¯ä»¥åšæ ‡é‡æ›¿æ¢ã€æ ˆä¸Šåˆ†é…ã€å’Œé”æ¶ˆé™¤ã€‚ä½†æ˜¯é€ƒé€¸åˆ†æè‡ªèº«ä¹Ÿæ˜¯éœ€è¦è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„åˆ†æçš„ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„è¿‡ç¨‹ã€‚</li><li>ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œå°±æ˜¯ç»è¿‡é€ƒé€¸åˆ†æä¹‹åï¼Œå‘ç°æ²¡æœ‰ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸é€ƒé€¸çš„ã€‚é‚£è¿™ä¸ªé€ƒé€¸åˆ†æçš„è¿‡ç¨‹å°±ç™½ç™½æµªè´¹æ‰äº†ã€‚</li><li>è™½ç„¶è¿™é¡¹æŠ€æœ¯å¹¶ä¸ååˆ†æˆç†Ÿï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯å³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ä¸­ä¸€ä¸ªååˆ†é‡è¦çš„æ‰‹æ®µã€‚</li><li>æ³¨æ„åˆ°æœ‰ä¸€äº›è§‚ç‚¹ï¼Œè®¤ä¸ºé€šè¿‡é€ƒé€¸åˆ†æï¼ŒJVM ä¼šåœ¨æ ˆä¸Šåˆ†é…é‚£äº›ä¸ä¼šé€ƒé€¸çš„å¯¹è±¡ï¼Œè¿™åœ¨ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å–å†³äº JVM è®¾è®¡è€…çš„é€‰æ‹©ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œ<strong>Oracle Hotspot JVM ä¸­å¹¶æœªè¿™ä¹ˆåš</strong>ï¼ˆåˆšåˆšæ¼”ç¤ºçš„æ•ˆæœï¼Œæ˜¯å› ä¸ºHotSpotå®ç°äº†æ ‡é‡æ›¿æ¢ï¼‰ï¼Œè¿™ä¸€ç‚¹åœ¨é€ƒé€¸åˆ†æç›¸å…³çš„æ–‡æ¡£é‡Œå·²ç»è¯´æ˜ï¼Œ<strong>æ‰€ä»¥å¯ä»¥æ˜ç¡®åœ¨ HotSpot è™šæ‹Ÿæœºä¸Šï¼Œæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ›å»ºåœ¨å †ä¸Š</strong>ã€‚</li><li>ç›®å‰å¾ˆå¤šä¹¦ç±è¿˜æ˜¯åŸºäº JDK7 ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒJDKå·²ç»å‘ç”Ÿäº†å¾ˆå¤§å˜åŒ–ï¼Œintern å­—ç¬¦ä¸²çš„ç¼“å­˜å’Œé™æ€å˜é‡æ›¾ç»éƒ½è¢«åˆ†é…åœ¨æ°¸ä¹…ä»£ä¸Šï¼Œè€Œæ°¸ä¹…ä»£å·²ç»è¢«å…ƒæ•°æ®åŒºå–ä»£ã€‚ä½†æ˜¯ <strong>intern å­—ç¬¦ä¸²ç¼“å­˜å’Œé™æ€å˜é‡å¹¶ä¸æ˜¯è¢«è½¬ç§»åˆ°å…ƒæ•°æ®åŒºï¼Œè€Œæ˜¯ç›´æ¥åœ¨å †ä¸Šåˆ†é…</strong>ï¼Œ<strong>æ‰€ä»¥è¿™ä¸€ç‚¹åŒæ ·ç¬¦åˆå‰é¢ä¸€ç‚¹çš„ç»“è®ºï¼šå¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ†é…åœ¨å †ä¸Š</strong>ã€‚</li></ul><h2 id="11-å°ç»“">11-å°ç»“</h2><ul><li><p>å¹´è½»ä»£æ˜¯å¯¹è±¡çš„è¯ç”Ÿã€æˆé•¿ã€æ¶ˆäº¡çš„åŒºåŸŸï¼Œä¸€ä¸ªå¯¹è±¡åœ¨è¿™é‡Œäº§ç”Ÿã€åº”ç”¨ï¼Œæœ€åè¢«åƒåœ¾å›æ”¶å™¨æ”¶é›†ã€ç»“æŸç”Ÿå‘½</p></li><li><p>è€å¹´ä»£æ”¾ç½®é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œé€šå¸¸éƒ½æ˜¯ä» Survivor åŒºåŸŸç­›é€‰æ‹·è´è¿‡æ¥çš„ Java å¯¹è±¡</p></li><li><p>å½“ç„¶ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬çŸ¥é“æ™®é€šçš„å¯¹è±¡å¯èƒ½ä¼šè¢«åˆ†é…åœ¨ TLAB ä¸Š</p></li><li><p>å¦‚æœå¯¹è±¡è¾ƒå¤§ï¼Œæ— æ³•åˆ†é…åœ¨ TLAB ä¸Šï¼Œåˆ™ JVM ä¼šè¯•å›¾ç›´æ¥åˆ†é…åœ¨ Eden å…¶ä»–ä½ç½®ä¸Š</p></li><li><p>å¦‚æœå¯¹è±¡å¤ªå¤§ï¼Œå®Œå…¨æ— æ³•åœ¨æ–°ç”Ÿä»£æ‰¾åˆ°è¶³å¤Ÿé•¿çš„è¿ç»­ç©ºé—²ç©ºé—´ï¼Œ JVM å°±ä¼šç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</p></li><li><p>å½“ GC åªå‘ç”Ÿåœ¨å¹´è½»ä»£ä¸­ï¼Œå›æ”¶å¹´è½»ä»£å¯¹è±¡çš„è¡Œä¸ºè¢«ç§°ä¸º Minor GC</p></li><li><p>å½“ GC å‘ç”Ÿåœ¨è€å¹´ä»£æ—¶åˆ™è¢«ç§°ä¸º Major GC æˆ–è€… Full GC</p></li><li><p>ä¸€èˆ¬çš„ï¼ŒMinor GC çš„å‘ç”Ÿé¢‘ç‡è¦æ¯” Major GC é«˜å¾ˆå¤šï¼Œå³è€å¹´ä»£ä¸­åƒåœ¾å›æ”¶å‘ç”Ÿçš„é¢‘ç‡å°†å¤§å¤§ä½äºå¹´è½»ä»£</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>â„¹ï¸JVM-04-è™šæ‹Ÿæœºæ ˆ</title>
      <link href="/2023/12/16/jvm-sgg4/"/>
      <url>/2023/12/16/jvm-sgg4/</url>
      
        <content type="html"><![CDATA[<h1>è™šæ‹Ÿæœºæ ˆ</h1><h2 id="1-è™šæ‹Ÿæœºæ ˆæ¦‚è¿°">1-è™šæ‹Ÿæœºæ ˆæ¦‚è¿°</h2><h3 id="èƒŒæ™¯">èƒŒæ™¯</h3><ul><li><p>ç”±äºè·¨å¹³å°æ€§çš„è®¾è®¡ï¼ŒJava çš„æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„ã€‚ä¸åŒå¹³å° CPU æ¶æ„ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½è®¾è®¡ä¸ºåŸºäºå¯„å­˜å™¨çš„ã€å¦‚æœè®¾è®¡æˆåŸºäºå¯„å­˜å™¨çš„ï¼Œè€¦åˆåº¦é«˜ï¼Œæ€§èƒ½ä¼šæœ‰æ‰€æå‡ï¼Œå› ä¸ºå¯ä»¥å¯¹å…·ä½“çš„ CPU æ¶æ„è¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯è·¨å¹³å°æ€§å¤§å¤§é™ä½ã€‘ã€‚</p></li><li><p><strong>ä¼˜ç‚¹æ˜¯è·¨å¹³å°ï¼ŒæŒ‡ä»¤é›†å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½ä¸‹é™ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½éœ€è¦æ›´å¤šçš„æŒ‡ä»¤ã€‚</strong></p></li></ul><h3 id="å†…å­˜ä¸­çš„æ ˆä¸å †">å†…å­˜ä¸­çš„æ ˆä¸å †</h3><p><strong>æ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œå †æ˜¯å­˜å‚¨çš„å•ä½ã€‚</strong></p><p>å³ï¼šæ ˆè§£å†³ç¨‹åºçš„è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œæˆ–è€…è¯´å¦‚ä½•å¤„ç†æ•°æ®ã€‚å †è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ï¼Œæ”¾åœ¨å“ª</p><p><img src="../jvm-sgg4/001.png" alt=""></p><h3 id="è™šæ‹Ÿæœºæ ˆåŸºæœ¬å†…å®¹">è™šæ‹Ÿæœºæ ˆåŸºæœ¬å†…å®¹</h3><h4 id="Javaè™šæ‹Ÿæœºæ ˆæ˜¯ä»€ä¹ˆï¼Ÿ">Javaè™šæ‹Ÿæœºæ ˆæ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰ï¼Œæ—©æœŸä¹Ÿå«Javaæ ˆã€‚æ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œå…¶å†…éƒ¨ä¿å­˜ä¸€ä¸ªä¸ªçš„æ ˆå¸§ï¼ˆStack Frameï¼‰ï¼Œ<strong>å¯¹åº”ç€ä¸€æ¬¡æ¬¡çš„ Java æ–¹æ³•è°ƒç”¨</strong>ï¼Œæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„</li></ul><p><img src="../jvm-sgg4/002.png" alt=""></p><h4 id="ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ</h4><p>ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ç»“æŸäº†ï¼Œè¯¥è™šæ‹Ÿæœºæ ˆä¹Ÿé”€æ¯äº†</p><h4 id="ä½œç”¨">ä½œç”¨</h4><p>ä¸»ç®¡ Java ç¨‹åºçš„è¿è¡Œ, å®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡(8 ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡çš„å¼•ç”¨åœ°å€)ã€éƒ¨åˆ†ç»“æœ, å¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›.</p><ul><li>å±€éƒ¨å˜é‡ vs æˆå‘˜å˜é‡æ¥è¯´çš„ï¼ˆæˆ–å±æ€§ï¼‰</li><li>åŸºæœ¬æ•°æ®ç±»å‹å˜é‡ vs å¼•ç”¨ç±»å‹å˜é‡ï¼ˆç±»ã€æ•°ç»„ã€æ¥å£ï¼‰</li></ul><h4 id="æ ˆçš„ç‰¹ç‚¹-ä¼˜ç‚¹">æ ˆçš„ç‰¹ç‚¹(ä¼˜ç‚¹)</h4><ul><li><p>æ ˆæ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„åˆ†é…å­˜å‚¨æ–¹å¼ï¼Œè®¿é—®é€Ÿåº¦ä»…æ¬¡äºç¨‹åºè®¡æ•°å™¨ã€‚</p></li><li><p>JVM ç›´æ¥å¯¹ Java æ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼š</p><ul><li>æ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€<strong>è¿›æ ˆ</strong>ï¼ˆå…¥æ ˆã€å‹æ ˆï¼‰</li><li>æ‰§è¡Œç»“æŸåçš„<strong>å‡ºæ ˆ</strong>å·¥ä½œ</li></ul></li><li><p>å¯¹äºæ ˆæ¥è¯´ä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜</p><ul><li>æ ˆä¸éœ€è¦ GCï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨ OOM</li></ul></li></ul><img src="../jvm-sgg4/003.png" style="zoom:50%;" /><h4 id="é¢è¯•-æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸">é¢è¯•: æ ˆä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸</h4><p>Java è™šæ‹Ÿæœºè§„èŒƒå…è®¸ Java æ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„ã€‚</p><ul><li>å¦‚æœé‡‡ç”¨å›ºå®šå¤§å°çš„ Java è™šæ‹Ÿæœºæ ˆï¼Œé‚£æ¯ä¸€ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡Javaè™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª<strong>StackoverflowError</strong> å¼‚å¸¸ã€‚</li><li>å¦‚æœ Java è™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ Java è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <strong>OutofMemoryError</strong> å¼‚å¸¸ã€‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-Xss1m</span><span class="token parameter variable">-Xss1024k</span><span class="token parameter variable">-Xss1048576</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="è®¾ç½®æ ˆå†…å­˜ä»£é”€">è®¾ç½®æ ˆå†…å­˜ä»£é”€</h4><p><a href="https://docs.oracle.com/en/java/javase/11/tools/java.html">Oracleå®˜æ–¹æ–‡æ¡£</a></p><p>ä½¿ç”¨å‚æ•° <code>-Xss</code> (MaxStackSize)é€‰é¡¹æ¥è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦ã€‚</p><h2 id="2-æ ˆçš„å­˜å‚¨å•ä½">2-æ ˆçš„å­˜å‚¨å•ä½</h2><h3 id="æ ˆä¸­å­˜å‚¨ä»€ä¹ˆ">æ ˆä¸­å­˜å‚¨ä»€ä¹ˆ?</h3><ul><li><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œæ ˆä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥<strong>æ ˆå¸§</strong>(Stack Frame)çš„æ ¼å¼å­˜åœ¨</p></li><li><p>åœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªå¯¹åº”ä¸€ä¸ªæ ˆå¸§(Stack Frame)</p></li><li><p>æ ˆå¸§æ˜¯ä¸€ä¸ªå†…å­˜åŒºå—ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç»´ç³»ç€æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ•°æ®ä¿¡æ¯</p></li></ul><h3 id="æ ˆè¿è¡ŒåŸç†">æ ˆè¿è¡ŒåŸç†</h3><ul><li><p>JVM ç›´æ¥å¯¹Javaæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯å¯¹æ ˆå¸§çš„<strong>å‹æ ˆå’Œå‡ºæ ˆ</strong>ï¼Œ<u>éµå¾ªå…ˆè¿›åå‡ºï¼ˆåè¿›å…ˆå‡ºï¼‰åŸåˆ™</u></p></li><li><p>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆæ ˆé¡¶æ ˆå¸§ï¼‰æ˜¯æœ‰æ•ˆçš„ã€‚è¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸º<strong>å½“å‰æ ˆå¸§(Current Frame)</strong>, ä¸å½“å‰æ ˆå¸§ç›¸å¯¹åº”çš„æ–¹æ³•å°±æ˜¯<strong>å½“å‰æ–¹æ³•(Current Method)</strong>ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯<strong>å½“å‰ç±»(Current Class)</strong></p></li><li><p>æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œã€‚</p></li><li><p>å¦‚æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„æ–°çš„æ ˆå¸§ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œæˆä¸ºæ–°çš„å½“å‰å¸§ã€‚</p></li></ul><p><img src="../jvm-sgg4/004.png" alt=""></p><ul><li><p><strong>ä¸åŒçº¿ç¨‹ä¸­æ‰€åŒ…å«çš„æ ˆå¸§æ˜¯ä¸å…è®¸å­˜åœ¨ç›¸äº’å¼•ç”¨çš„</strong>ï¼Œå³ä¸å¯èƒ½åœ¨ä¸€ä¸ªæ ˆå¸§ä¹‹ä¸­å¼•ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¸§ã€‚</p></li><li><p>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ä¹‹é™…ï¼Œå½“å‰æ ˆå¸§ä¼šä¼ å›æ­¤æ–¹æ³•çš„æ‰§è¡Œç»“æœç»™å‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¥ç€ï¼Œè™šæ‹Ÿæœºä¼šä¸¢å¼ƒå½“å‰æ ˆå¸§ï¼Œä½¿å¾—å‰ä¸€ä¸ªæ ˆå¸§é‡æ–°æˆä¸ºå½“å‰æ ˆå¸§ã€‚</p></li><li><p>Java æ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ã€‚<u>ä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨ return æŒ‡ä»¤ã€‚å¦ä¸€ç§æ˜¯æ–¹æ³•æ‰§è¡Œä¸­å‡ºç°æœªæ•è·å¤„ç†çš„å¼‚å¸¸ï¼Œä»¥æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼ç»“æŸã€‚ä½†ä¸ç®¡ä½¿ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚</u></p></li></ul><h3 id="æ ˆå¸§çš„å†…éƒ¨ç»“æ„">æ ˆå¸§çš„å†…éƒ¨ç»“æ„</h3><p>æ¯ä¸ªæ ˆå¸§ä¸­å­˜å‚¨ç€ï¼š</p><ul><li><p><strong>å±€éƒ¨å˜é‡è¡¨(Local Variables)</strong></p></li><li><p><strong>æ“ä½œæ•°æ ˆ(Operand Stack)(æˆ–è¡¨è¾¾å¼æ ˆ)</strong></p></li><li><p>åŠ¨æ€é“¾æ¥(Dynamic Linking)(æˆ–æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨)</p></li><li><p>æ–¹æ³•è¿”å›åœ°å€(Return Address)(æˆ–æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–è€…å¼‚å¸¸é€€å‡ºçš„å®šä¹‰)</p></li><li><p>ä¸€äº›é™„åŠ ä¿¡æ¯</p></li></ul><p><img src="../jvm-sgg4/005.png" alt=""></p><p><img src="../jvm-sgg4/006.png" alt=""></p><h2 id="3-å±€éƒ¨å˜é‡è¡¨ğŸ‘">3-å±€éƒ¨å˜é‡è¡¨ğŸ‘</h2><h3 id="æ¦‚å¿µ">æ¦‚å¿µ</h3><ul><li><p>å±€éƒ¨å˜é‡è¡¨(<code>Local Variables</code>)ä¹Ÿè¢«ç§°ä¹‹ä¸ºå±€éƒ¨å˜é‡æ•°ç»„æˆ–æœ¬åœ°å˜é‡è¡¨</p></li><li><p><strong>å®šä¹‰ä¸ºä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡</strong>ï¼Œè¿™äº›æ•°æ®ç±»å‹åŒ…æ‹¬å„ç±»åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œä»¥åŠ returnAddress è¿”å›å€¼ç±»å‹ã€‚</p></li></ul><h3 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h3><ul><li><p>ç”±äºå±€éƒ¨å˜é‡è¡¨æ˜¯å»ºç«‹åœ¨çº¿ç¨‹çš„æ ˆä¸Šï¼Œæ˜¯çº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼Œå› æ­¤<strong>ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜</strong></p></li><li><p><u>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å®¹é‡å¤§å°æ˜¯åœ¨ç¼–è¯‘æœŸç¡®å®šä¸‹æ¥çš„</u>ï¼Œå¹¶ä¿å­˜åœ¨æ–¹æ³•çš„ Code å±æ€§çš„ <strong>maximum local variables</strong> æ•°æ®é¡¹ä¸­ã€‚åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°çš„ã€‚</p></li></ul><p><img src="../jvm-sgg4/007.png" alt=""></p><ul><li><p>**æ–¹æ³•åµŒå¥—è°ƒç”¨çš„æ¬¡æ•°ç”±æ ˆçš„å¤§å°å†³å®šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ ˆè¶Šå¤§ï¼Œæ–¹æ³•åµŒå¥—è°ƒç”¨æ¬¡æ•°è¶Šå¤šã€‚**å¯¹ä¸€ä¸ªå‡½æ•°è€Œè¨€ï¼Œå®ƒçš„å‚æ•°å’Œå±€éƒ¨å˜é‡è¶Šå¤šï¼Œä½¿å¾—å±€éƒ¨å˜é‡è¡¨è†¨èƒ€ï¼Œå®ƒçš„æ ˆå¸§å°±è¶Šå¤§ï¼Œä»¥æ»¡è¶³æ–¹æ³•è°ƒç”¨æ‰€éœ€ä¼ é€’çš„ä¿¡æ¯å¢å¤§çš„éœ€æ±‚ã€‚è¿›è€Œå‡½æ•°è°ƒç”¨å°±ä¼šå ç”¨æ›´å¤šçš„æ ˆç©ºé—´ï¼Œå¯¼è‡´å…¶åµŒå¥—è°ƒç”¨æ¬¡æ•°å°±ä¼šå‡å°‘ã€‚</p></li><li><p>**å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡åªåœ¨å½“å‰æ–¹æ³•è°ƒç”¨ä¸­æœ‰æ•ˆã€‚**åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºé€šè¿‡ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆå‚æ•°å€¼åˆ°å‚æ•°å˜é‡åˆ—è¡¨çš„ä¼ é€’è¿‡ç¨‹ã€‚<strong>å½“æ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéšç€æ–¹æ³•æ ˆå¸§çš„é”€æ¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚</strong></p></li></ul><h3 id="æ¡ˆä¾‹è¯´æ˜â­">æ¡ˆä¾‹è¯´æ˜â­</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalVariablesTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">LocalVariablesTest</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalVariablesTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        test<span class="token punctuation">.</span><span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="../jvm-sgg4/008.png" alt=""></p><h3 id="å…³äºSlotçš„ç†è§£">å…³äºSlotçš„ç†è§£</h3><ul><li><p>å‚æ•°å€¼çš„å­˜æ”¾æ€»æ˜¯ä»å±€éƒ¨å˜é‡æ•°ç»„ç´¢å¼• 0 çš„ä½ç½®å¼€å§‹, åˆ°æ•°ç»„é•¿åº¦ -1 çš„ç´¢å¼•ç»“æŸ</p></li><li><p>å±€éƒ¨å˜é‡è¡¨ï¼Œ<strong>æœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯Slotï¼ˆå˜é‡æ§½ï¼‰</strong></p></li><li><p>å±€éƒ¨å˜é‡è¡¨ä¸­å­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹(8ç§), å¼•ç”¨ç±»å‹(reference), returnAddress ç±»å‹çš„å˜é‡</p></li><li><p>åœ¨å±€éƒ¨å˜é‡è¡¨é‡Œ, <strong>32 ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ª slot</strong>(åŒ…æ‹¬returnAddressç±»å‹), <strong>64 ä½çš„ç±»å‹å ç”¨ä¸¤ä¸ª slot</strong>(long å’Œ double)</p><ul><li><p>byteã€shortã€char åœ¨å‚¨å­˜å‰è¢«è½¬æ¢ä¸º int, boolean ä¹Ÿè¢«è½¬æ¢ä¸º int, 0 è¡¨ç¤º false, é 0 è¡¨ç¤º true</p></li><li><p>long å’Œ double åˆ™å æ®ä¸¤ä¸ª Slot</p></li></ul></li><li><p>JVM ä¼šä¸ºå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ª Slot éƒ½åˆ†é…ä¸€ä¸ªè®¿é—®ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªç´¢å¼•å³å¯æˆåŠŸè®¿é—®åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­æŒ‡å®šçš„å±€éƒ¨å˜é‡å€¼</p></li><li><p>å½“ä¸€ä¸ªå®ä¾‹æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒçš„æ–¹æ³•å‚æ•°å’Œæ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡å°†ä¼š<strong>æŒ‰ç…§é¡ºåºè¢«å¤åˆ¶</strong>åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªslotä¸Š</p></li><li><p><strong>å¦‚æœéœ€è¦è®¿é—®å±€éƒ¨å˜é‡è¡¨ä¸­ä¸€ä¸ª 64bit çš„å±€éƒ¨å˜é‡å€¼æ—¶, åªéœ€è¦ä½¿ç”¨å‰ä¸€ä¸ªç´¢å¼•å³å¯</strong>. (æ¯”å¦‚: è®¿é—® long æˆ– double ç±»å‹å˜é‡)</p></li><li><p>å¦‚æœå½“å‰å¸§æ˜¯ç”±æ„é€ æ–¹æ³•æˆ–è€…å®ä¾‹æ–¹æ³•åˆ›å»ºçš„, é‚£ä¹ˆ<strong>è¯¥å¯¹è±¡å¼•ç”¨this å°†ä¼šå­˜æ”¾åœ¨ index ä¸º 0 çš„ Slot å¤„</strong>, å…¶ä½™çš„å‚æ•°æŒ‰ç…§å‚æ•°è¡¨é¡ºåºç»§ç»­æ’åˆ—. (this ä¹Ÿç›¸å½“äºä¸€ä¸ªå˜é‡)â—</p></li></ul><p><img src="../jvm-sgg4/010.png" alt="éé™æ€æ–¹æ³•Slot"></p><img src="../jvm-sgg4/009.png" alt="å„ä¸ªæ•°æ®ç±»å‹å æ®Slotå¤§å°" style="zoom:50%;" /><h3 id="Slotçš„é‡å¤åˆ©ç”¨ğŸ”–">Slotçš„é‡å¤åˆ©ç”¨ğŸ”–</h3><p><strong>æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½æ˜¯å¯ä»¥é‡ç”¨çš„</strong>ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¿‡äº†å…¶ä½œç”¨åŸŸï¼Œé‚£ä¹ˆåœ¨å…¶ä½œç”¨åŸŸä¹‹åç”³æ˜æ–°çš„å±€éƒ¨å˜é‡å˜å°±å¾ˆæœ‰å¯èƒ½ä¼šå¤ç”¨è¿‡æœŸå±€éƒ¨å˜é‡çš„æ§½ä½ï¼Œä»è€Œ<strong>è¾¾åˆ°èŠ‚çœèµ„æºçš„ç›®çš„</strong></p><p><img src="../jvm-sgg4/011.png" alt=""></p><h3 id="ä¸¾ä¾‹-é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”ğŸ”–">ä¸¾ä¾‹: é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”ğŸ”–</h3><p>å˜é‡çš„åˆ†ç±»</p><blockquote><p>æŒ‰ç…§æ•°æ®ç±»å‹:</p><ol><li>åŸºæœ¬æ•°æ®ç±»å‹</li><li>å¼•ç”¨æ•°æ®ç±»å‹</li></ol><p>æŒ‰ç…§åœ¨ç±»ä¸­å£°æ˜çš„ä½ç½®:</p><ol><li><p>æˆå‘˜å˜é‡: åœ¨ä½¿ç”¨å‰, ç»è¿‡é»˜è®¤åˆå§‹åŒ–èµ‹å€¼</p><ul><li><p>ç±»å˜é‡(static): linking çš„ prepare é˜¶æ®µ: ç»™ç±»å˜é‡é»˜è®¤èµ‹å€¼ &gt;&gt;&gt;  initial é˜¶æ®µï¼šç»™ç±»å˜é‡æ˜¾å¼èµ‹å€¼å³é™æ€ä»£ç å—èµ‹å€¼</p></li><li><p>å®ä¾‹å˜é‡: éšç€å¯¹è±¡çš„åˆ›å»º, ä¼šåœ¨å †ç©ºé—´ä¸­åˆ†é…å®ä¾‹å˜é‡ç©ºé—´, å¹¶è¿›è¡Œé»˜è®¤èµ‹å€¼</p></li></ul></li><li><p>å±€éƒ¨å˜é‡: åœ¨ä½¿ç”¨å‰, å¿…é¡»è¦è¿›è¡Œæ˜¾ç¤ºèµ‹å€¼çš„! å¦åˆ™ç¼–è¯‘ä¸é€šè¿‡</p></li></ol></blockquote><h3 id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜</h3><ul><li><p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å‰é¢æåˆ°çš„å±€éƒ¨å˜é‡è¡¨ã€‚åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p></li><li><p><strong>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</strong>(å¯è¾¾æ€§åˆ†æ)</p></li></ul><h2 id="4-æ“ä½œæ•°æ ˆ-ç†è®º">4-æ“ä½œæ•°æ ˆ(ç†è®º)</h2><p>(Operand Stack)</p><ul><li><p>æ¯ä¸€ä¸ªç‹¬ç«‹çš„æ ˆå¸§é™¤äº†åŒ…å«å±€éƒ¨å˜é‡è¡¨ä»¥å¤–, è¿˜åŒ…å«ä¸€ä¸ª<strong>åè¿›å…ˆå‡º</strong>(Last-In-First-Out)çš„ æ“ä½œæ•°æ ˆ, ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º<strong>è¡¨è¾¾å¼æ ˆ</strong>(Expression Stack)</p></li><li><p>æ“ä½œæ•°æ ˆï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­, <strong>æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¾€æ ˆä¸­å†™å…¥æ•°æ®æˆ–æå–æ•°æ®</strong>, å³å…¥æ ˆ(push)/å‡ºæ ˆ(pop)</p><ul><li><p>æŸäº›å­—èŠ‚ç æŒ‡ä»¤å°†å€¼å‹å…¥æ“ä½œæ•°æ ˆ, å…¶ä½™çš„å­—èŠ‚ç æŒ‡ä»¤å°†æ“ä½œæ•°å–å‡ºæ ˆ. ä½¿ç”¨å®ƒä»¬åå†æŠŠç»“æœå‹å…¥æ ˆ</p></li><li><p>æ¯”å¦‚: æ‰§è¡Œå¤åˆ¶ã€äº¤æ¢ã€æ±‚å’Œç­‰æ“ä½œ</p></li></ul></li></ul><p><img src="../jvm-sgg4/012.png" alt=""></p><h3 id="ä½œç”¨-2">ä½œç”¨</h3><ul><li><p>æ“ä½œæ•°æ ˆï¼Œ<strong>ä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´</strong>ã€‚</p></li><li><p>æ“ä½œæ•°æ ˆå°±æ˜¯ JVM æ‰§è¡Œå¼•æ“çš„ä¸€ä¸ªå·¥ä½œåŒºï¼Œå½“ä¸€ä¸ªæ–¹æ³•åˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„æ ˆå¸§ä¹Ÿä¼šéšä¹‹è¢«åˆ›å»ºå‡ºæ¥ï¼Œ<strong>è¿™æ—¶æ–¹æ³•çš„æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„</strong>ã€‚</p></li><li><p>æ¯ä¸€ä¸ªæ“ä½œæ•°æ ˆéƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ˆæ·±åº¦ç”¨äºå­˜å‚¨æ•°å€¼ï¼Œå…¶æ‰€éœ€çš„æœ€å¤§æ·±åº¦åœ¨ç¼–è¯‘æœŸå°±å®šä¹‰å¥½äº†ï¼Œä¿å­˜åœ¨æ–¹æ³•çš„ Code å±æ€§ä¸­ï¼Œä¸º <strong>maxstack</strong> çš„å€¼ã€‚</p></li><li><p>æ ˆä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯å¯ä»¥ä»»æ„çš„Javaæ•°æ®ç±»å‹</p><ul><li><p>32bit çš„ç±»å‹å ç”¨ä¸€ä¸ªæ ˆå•ä½æ·±åº¦</p></li><li><p>64bit çš„ç±»å‹å ç”¨ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦</p></li></ul></li><li><p>æ“ä½œæ•°æ ˆ<strong>å¹¶éé‡‡ç”¨è®¿é—®ç´¢å¼•çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®è®¿é—®</strong>çš„ï¼Œè€Œæ˜¯åªèƒ½é€šè¿‡æ ‡å‡†çš„å…¥æ ˆ(push)å’Œå‡ºæ ˆ(pop)æ“ä½œæ¥å®Œæˆä¸€æ¬¡æ•°æ®è®¿é—®</p></li><li><p><strong>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•å¸¦æœ‰è¿”å›å€¼çš„è¯ï¼Œå…¶è¿”å›å€¼å°†ä¼šè¢«å‹å…¥å½“å‰æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­</strong>ï¼Œå¹¶æ›´æ–° PC å¯„å­˜å™¨ä¸­ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚(å›¾4-2)</p></li><li><p>æ“ä½œæ•°æ ˆä¸­å…ƒç´ çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å­—èŠ‚ç æŒ‡ä»¤çš„åºåˆ—ä¸¥æ ¼åŒ¹é…ï¼Œè¿™ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å™¨æœŸé—´è¿›è¡ŒéªŒè¯ï¼ŒåŒæ—¶åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„ç±»æ£€éªŒé˜¶æ®µçš„æ•°æ®æµåˆ†æé˜¶æ®µè¦å†æ¬¡éªŒè¯ã€‚</p></li><li><p>å¦å¤–ï¼Œ<strong>æˆ‘ä»¬è¯´ Java è™šæ‹Ÿæœºçš„è§£é‡Šå¼•æ“æ˜¯åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“ï¼Œå…¶ä¸­çš„æ ˆæŒ‡çš„å°±æ˜¯æ“ä½œæ•°æ ˆ</strong>ã€‚</p></li></ul><h2 id="5-æ“ä½œæ•°æ ˆ-ä»£ç è¿½è¸ª-â—">5-æ“ä½œæ•°æ ˆ(ä»£ç è¿½è¸ª)â—</h2><p>ç¤ºä¾‹ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAddOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//byte, short, char, boolean: éƒ½ä»¥intå‹æ¥ä¿å­˜</span>    <span class="token keyword">byte</span> i <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> k <span class="token operator">=</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="../jvm-sgg4/013.png" alt="å›¾4-1"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> k <span class="token operator">=</span> m <span class="token operator">+</span> n<span class="token punctuation">;</span>    <span class="token keyword">return</span> k<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//è·å–ä¸Šä¸€ä¸ªFrame Stackè¿”å›çš„ç»“æœ, å¹¶ä¿å­˜åœ¨æ“ä½œæ•°æ ˆä¸­</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="../jvm-sgg4/014.png" alt="å›¾4-2"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**  * i++ å’Œ ++içš„åŒºåˆ«  */</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//ç¬¬1ç±»</span>    <span class="token keyword">int</span> i1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    i1<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token operator">++</span>i2<span class="token punctuation">;</span>    <span class="token comment">//ç¬¬2ç±»</span>    <span class="token keyword">int</span> i3<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i4 <span class="token operator">=</span> i3<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i5 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i6 <span class="token operator">=</span> <span class="token operator">++</span>i5<span class="token punctuation">;</span>    <span class="token comment">//ç¬¬3ç±»</span>    <span class="token keyword">int</span> i7 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    i7 <span class="token operator">=</span> i7<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i8 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    i8 <span class="token operator">=</span> <span class="token operator">++</span>i8<span class="token punctuation">;</span>    <span class="token comment">//ç¬¬4ç±»é—®é¢˜</span>    <span class="token keyword">int</span> i9 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i10 <span class="token operator">=</span> i9<span class="token operator">++</span> <span class="token operator">+</span> <span class="token operator">++</span>i9<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="../jvm-sgg4/015.png" alt="i++æ“ä½œ"></p><h2 id="6-æ ˆé¡¶ç¼“å­˜æŠ€æœ¯-äº†è§£">6-æ ˆé¡¶ç¼“å­˜æŠ€æœ¯(äº†è§£)</h2><blockquote><p>Top Of Stack Cashing</p></blockquote><ul><li>å‰é¢æè¿‡ï¼ŒåŸºäºæ ˆå¼æ¶æ„çš„è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„é›¶åœ°å€æŒ‡ä»¤æ›´åŠ ç´§å‡‘ï¼Œä½†å®Œæˆä¸€é¡¹æ“ä½œçš„æ—¶å€™å¿…ç„¶éœ€è¦ä½¿ç”¨æ›´å¤šçš„å…¥æ ˆå’Œå‡ºæ ˆæŒ‡ä»¤ï¼Œè¿™åŒæ—¶ä¹Ÿå°±æ„å‘³ç€å°†éœ€è¦æ›´å¤šçš„æŒ‡ä»¤åˆ†æ´¾(instruction dispatch)æ¬¡æ•°(ä¹Ÿå°±æ˜¯ä½ ä¼šå‘ç°æŒ‡ä»¤å¾ˆå¤š)å’Œå¯¼è‡´å†…å­˜è¯»/å†™æ¬¡æ•°å¤šï¼Œæ•ˆç‡ä¸é«˜ã€‚</li><li>ç”±äºæ“ä½œæ•°æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜è¯»/å†™æ“ä½œå¿…ç„¶ä¼šå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHotSpot JVM çš„è®¾è®¡è€…ä»¬æå‡ºäº†æ ˆé¡¶ç¼“å­˜ï¼ˆTosï¼ŒTop-of-Stack Cashingï¼‰æŠ€æœ¯ï¼Œ<strong>å°†æ ˆé¡¶å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç†CPUçš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»/å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ã€‚</strong></li></ul><h2 id="7-åŠ¨æ€é“¾æ¥">7-åŠ¨æ€é“¾æ¥</h2><ul><li>æ¯ä¸€ä¸ªæ ˆå¸§å†…éƒ¨éƒ½åŒ…å«<strong>ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨</strong>. åŒ…å«è¿™ä¸ªå¼•ç”¨çš„ç›®çš„å°±æ˜¯<strong>ä¸ºäº†æ”¯æŒå½“å‰æ–¹æ³•çš„ä»£ç èƒ½å¤Ÿå®ç°åŠ¨æ€é“¾æ¥</strong><code>(Dynamic Linking)</code>, æ¯”å¦‚: invokedynamic æŒ‡ä»¤</li><li>åœ¨Javaæºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰ä¿å­˜åœ¨classæ–‡ä»¶çš„å¸¸é‡æ± é‡Œã€‚æ¯”å¦‚ï¼šæè¿°ä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å¦å¤–çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œå°±æ˜¯é€šè¿‡å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆ<strong>åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨</strong></li></ul><p><img src="../jvm-sgg4/016.png" alt=""></p><h2 id="8-æ–¹æ³•çš„è°ƒç”¨-è§£æä¸åˆ†æ´¾">8-æ–¹æ³•çš„è°ƒç”¨: è§£æä¸åˆ†æ´¾</h2><p>åœ¨ JVM ä¸­ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ä¸æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ç›¸å…³</p><ul><li><strong>é™æ€é“¾æ¥</strong>ï¼š</li></ul><p>å½“ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶è¢«è£…è½½è¿›JVMå†…éƒ¨æ—¶ï¼Œå¦‚æœè¢«è°ƒç”¨çš„<strong>ç›®æ ‡æ–¹æ³•åœ¨ç¼–è¯‘æœŸå¯çŸ¥</strong>ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹å°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºé™æ€é“¾æ¥</p><ul><li><strong>åŠ¨æ€é“¾æ¥</strong>ï¼š</li></ul><p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸå°†è°ƒç”¨çš„æ–¹æ³•çš„ç¬¦å·è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç”±äºè¿™ç§å¼•ç”¨è½¬æ¢è¿‡ç¨‹å…·å¤‡åŠ¨æ€æ€§ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¹‹ä¸ºåŠ¨æ€é“¾æ¥ã€‚</p><h3 id="æ—©æœŸç»‘å®šä¸æ™šæœŸç»‘å®š">æ—©æœŸç»‘å®šä¸æ™šæœŸç»‘å®š</h3><p>é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥å¯¹åº”çš„æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ä¸ºï¼šæ—©æœŸç»‘å®š(Early Binding)å’Œæ™šæœŸç»‘å®š(Late Binding)ã€‚<strong>ç»‘å®šæ˜¯ä¸€ä¸ªå­—æ®µã€æ–¹æ³•æˆ–è€…ç±»åœ¨ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</strong>ï¼Œè¿™ä»…ä»…å‘ç”Ÿä¸€æ¬¡ã€‚</p><ul><li><strong>æ—©æœŸç»‘å®š</strong></li></ul><p>æ—©æœŸç»‘å®šå°±æ˜¯æŒ‡è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•å¦‚æœåœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ï¼Œå³å¯å°†è¿™ä¸ªæ–¹æ³•ä¸æ‰€å±çš„ç±»å‹è¿›è¡Œç»‘å®šï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”±äºæ˜ç¡®äº†è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ç©¶ç«Ÿæ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤ä¹Ÿå°±<strong>å¯ä»¥ä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹å¼å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</strong>ã€‚</p><ul><li><strong>æ™šæœŸç»‘å®š</strong></li></ul><p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œ<strong>åªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ç±»å‹ç»‘å®šç›¸å…³çš„æ–¹æ³•</strong>ï¼Œè¿™ç§ç»‘å®šæ–¹å¼ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºæ™šæœŸç»‘å®šã€‚</p><h3 id="å¤šæ€ä¸ç»‘å®š">å¤šæ€ä¸ç»‘å®š</h3><ul><li><p>éšç€é«˜çº§è¯­è¨€çš„æ¨ªç©ºå‡ºä¸–ï¼Œç±»ä¼¼äº Java ä¸€æ ·çš„åŸºäºé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€å¦‚ä»Šè¶Šæ¥è¶Šå¤šï¼Œå°½ç®¡è¿™ç±»ç¼–ç¨‹è¯­è¨€åœ¨è¯­æ³•é£æ ¼ä¸Šå­˜åœ¨ä¸€å®šçš„å·®åˆ«ï¼Œä½†æ˜¯å®ƒä»¬å½¼æ­¤ä¹‹é—´å§‹ç»ˆä¿æŒç€ä¸€ä¸ªå…±æ€§ï¼Œé‚£å°±æ˜¯éƒ½æ”¯æŒå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ç­‰é¢å‘å¯¹è±¡ç‰¹æ€§ï¼Œæ—¢ç„¶è¿™ä¸€ç±»çš„ç¼–ç¨‹è¯­è¨€å…·å¤‡å¤šæ€ç‰¹æ€§ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±å…·å¤‡æ—©æœŸç»‘å®šå’Œæ™šæœŸç»‘å®šä¸¤ç§ç»‘å®šæ–¹å¼ã€‚</p></li><li><p>Java ä¸­ä»»ä½•ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•å…¶å®éƒ½å…·å¤‡è™šå‡½æ•°çš„ç‰¹å¾ï¼Œå®ƒä»¬ç›¸å½“äº C++ è¯­è¨€ä¸­çš„è™šå‡½æ•°ï¼ˆC++ ä¸­åˆ™éœ€è¦ä½¿ç”¨å…³é”®å­— virtual æ¥æ˜¾å¼å®šä¹‰ï¼‰ã€‚å¦‚æœåœ¨ Java ç¨‹åºä¸­ä¸å¸Œæœ›æŸä¸ªæ–¹æ³•æ‹¥æœ‰è™šå‡½æ•°çš„ç‰¹å¾æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å…³é”®å­— final æ¥æ ‡è®°è¿™ä¸ªæ–¹æ³•ã€‚</p></li></ul><h4 id="éè™šæ–¹æ³•">éè™šæ–¹æ³•</h4><ul><li>å¦‚æœæ–¹æ³•åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å…·ä½“çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨è¿è¡Œæ—¶æ˜¯ä¸å¯å˜çš„ã€‚è¿™æ ·çš„æ–¹æ³•ç§°ä¸º<strong>éè™šæ–¹æ³•</strong>ã€‚</li><li>é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€final æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³•éƒ½æ˜¯éè™šæ–¹æ³•ã€‚</li><li>å…¶ä»–æ–¹æ³•ç§°ä¸ºè™šæ–¹æ³•ã€‚</li></ul><h4 id="è™šæ‹Ÿæœºä¸­è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤">è™šæ‹Ÿæœºä¸­è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤</h4><ul><li><p>**æ™®é€šæŒ‡ä»¤: **</p><ol><li><p>invokestatic: è°ƒç”¨é™æ€æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</p></li><li><p>invokespecial: è°ƒç”¨<code>&lt;init&gt;</code>æ–¹æ³•ã€ç§æœ‰åŠçˆ¶ç±»æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</p></li><li><p>invokevirtual: è°ƒç”¨æ‰€æœ‰è™šæ–¹æ³•</p></li><li><p>invokeinterface: è°ƒç”¨æ¥å£æ–¹æ³•</p></li></ol></li><li><p><strong>åŠ¨æ€è°ƒç”¨æŒ‡ä»¤</strong><br>5. invokedynamicï¼šåŠ¨æ€è§£æå‡ºéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œ</p></li></ul><p>å‰å››æ¡æŒ‡ä»¤å›ºåŒ–åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œæ–¹æ³•çš„è°ƒç”¨æ‰§è¡Œä¸å¯äººä¸ºå¹²é¢„ã€‚è€ŒinvokedynamicæŒ‡ä»¤åˆ™æ”¯æŒç”±ç”¨æˆ·ç¡®å®šæ–¹æ³•ç‰ˆæœ¬ã€‚å…¶ä¸­ <strong>invokestatic æŒ‡ä»¤å’Œ invokespecial æŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ï¼Œå…¶ä½™çš„ï¼ˆfinalä¿®é¥°çš„é™¤å¤–ï¼‰ç§°ä¸ºè™šæ–¹æ³•</strong>ã€‚</p><h4 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//invokestatic å­çˆ¶ç±»æ–¹æ³•ç¡®å®š,éè™šæ–¹æ³•</span>    <span class="token function">showStatic</span><span class="token punctuation">(</span><span class="token string">"atguigu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//invokestatic å­çˆ¶ç±»æ–¹æ³•ç¡®å®š,éè™šæ–¹æ³•</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">showStatic</span><span class="token punctuation">(</span><span class="token string">"good!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//invokespecial éè™šæ–¹æ³•</span>    <span class="token function">showPrivate</span><span class="token punctuation">(</span><span class="token string">"hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//invokespecial éè™šæ–¹æ³•</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">showCommon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//invokevirtual</span>    <span class="token function">showFinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å› ä¸ºæ­¤æ–¹æ³•å£°æ˜æœ‰finalï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ï¼Œæ‰€ä»¥ä¹Ÿè®¤ä¸ºæ­¤æ–¹æ³•æ˜¯éè™šæ–¹æ³•ã€‚</span>    <span class="token comment">//è™šæ–¹æ³•å¦‚ä¸‹ï¼š</span>    <span class="token comment">// invokevirtual  æ²¡æœ‰æ˜¾ç¤ºçš„åŠ super.ï¼Œç¼–è¯‘å™¨è®¤ä¸ºä½ å¯èƒ½è°ƒç”¨å­ç±»çš„showCommon(å³ä½¿sonå­ç±»æ²¡æœ‰é‡å†™ï¼Œä¹Ÿä¼šè®¤ä¸º)ï¼Œæ‰€ä»¥ç¼–è¯‘æœŸé—´ç¡®å®šä¸ä¸‹æ¥ï¼Œå°±æ˜¯è™šæ–¹æ³•ã€‚</span>    <span class="token function">showCommon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">MethodInterface</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">//invokeinterface</span>    in<span class="token punctuation">.</span><span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å…³äº-invokedynamic-æŒ‡ä»¤">å…³äº invokedynamic æŒ‡ä»¤</h4><ul><li><p>JVM å­—èŠ‚ç æŒ‡ä»¤é›†ä¸€ç›´æ¯”è¾ƒç¨³å®šï¼Œä¸€ç›´åˆ° Java7 ä¸­æ‰å¢åŠ äº†ä¸€ä¸ª invokedynamic æŒ‡ä»¤ï¼Œè¿™æ˜¯ <strong>Java ä¸ºäº†å®ç°ã€åŠ¨æ€ç±»å‹è¯­è¨€ã€‘æ”¯æŒè€Œåšçš„ä¸€ç§æ”¹è¿›</strong>ã€‚</p></li><li><p>ä½†æ˜¯åœ¨ Java7 ä¸­å¹¶æ²¡æœ‰æä¾›ç›´æ¥ç”Ÿæˆ invokedynamic æŒ‡ä»¤çš„æ–¹æ³•ï¼Œéœ€è¦å€ŸåŠ©ASMè¿™ç§åº•å±‚å­—èŠ‚ç å·¥å…·æ¥äº§ç”Ÿ invokedynamic æŒ‡ä»¤ã€‚<strong>ç›´åˆ° Java8 çš„ Lambda è¡¨è¾¾å¼çš„å‡ºç°ï¼Œinvokedynamic æŒ‡ä»¤çš„ç”Ÿæˆï¼Œåœ¨ Java ä¸­æ‰æœ‰äº†ç›´æ¥çš„ç”Ÿæˆæ–¹å¼</strong>ã€‚</p></li><li><p>Java7 ä¸­å¢åŠ çš„åŠ¨æ€è¯­è¨€ç±»å‹æ”¯æŒçš„æœ¬è´¨æ˜¯å¯¹ Java è™šæ‹Ÿæœºè§„èŒƒçš„ä¿®æ”¹ï¼Œè€Œä¸æ˜¯å¯¹ Java è¯­è¨€è§„åˆ™çš„ä¿®æ”¹ï¼Œè¿™ä¸€å—ç›¸å¯¹æ¥è®²æ¯”è¾ƒå¤æ‚ï¼Œå¢åŠ äº†è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•è°ƒç”¨ï¼Œæœ€ç›´æ¥çš„å—ç›Šè€…å°±æ˜¯è¿è¡Œåœ¨ Java å¹³å°çš„åŠ¨æ€è¯­è¨€çš„ç¼–è¯‘å™¨ã€‚</p></li></ul><p>åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€</p><ul><li>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äº<strong>å¯¹ç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨ç¼–è¯‘æœŸè¿˜æ˜¯åœ¨è¿è¡ŒæœŸ</strong>ï¼Œæ»¡è¶³å‰è€…å°±æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œåä¹‹æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ã€‚</li><li>è¯´çš„å†ç›´ç™½ä¸€ç‚¹å°±æ˜¯ï¼Œ<strong>é™æ€ç±»å‹è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡è‡ªèº«çš„ç±»å‹ä¿¡æ¯ï¼›åŠ¨æ€ç±»å‹è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡å€¼çš„ç±»å‹ä¿¡æ¯</strong>, å˜é‡æ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œå˜é‡å€¼æ‰æœ‰ç±»å‹ä¿¡æ¯ï¼Œè¿™æ˜¯åŠ¨æ€è¯­è¨€çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ã€‚</li></ul><pre class="line-numbers language-null" data-language="null"><code class="language-null">Javaï¼šString info &#x3D; &quot;mogu blog&quot;;     (Javaæ˜¯é™æ€ç±»å‹è¯­è¨€çš„ï¼Œä¼šå…ˆç¼–è¯‘å°±è¿›è¡Œç±»å‹æ£€æŸ¥)JSï¼švar name &#x3D; &quot;shkstart&quot;;    var name &#x3D; 10;ï¼ˆè¿è¡Œæ—¶æ‰è¿›è¡Œæ£€æŸ¥ï¼‰Python: info &#x3D; 130.5 (è¿è¡Œæ—¶æ‰æ£€æŸ¥)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="æ–¹æ³•é‡å†™çš„æœ¬è´¨">æ–¹æ³•é‡å†™çš„æœ¬è´¨</h3><ol><li>æ‰¾åˆ°æ“ä½œæ•°æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æ‰§è¡Œçš„å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè®°ä½œ Cã€‚</li><li>å¦‚æœåœ¨ç±»å‹ C ä¸­æ‰¾åˆ°ä¸å¸¸é‡ä¸­çš„æè¿°ç¬¦åˆç®€å•åç§°éƒ½ç›¸ç¬¦çš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œè®¿é—®æƒé™æ ¡éªŒã€‚<ul><li>å¦‚æœé€šè¿‡åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ç»“æŸ</li><li>å¦‚æœä¸é€šè¿‡ï¼Œåˆ™è¿”å›<code>java.lang.IllegalAccessError </code>å¼‚å¸¸</li></ul></li><li>å¦åˆ™ï¼ŒæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šä¾æ¬¡å¯¹Cçš„å„ä¸ªçˆ¶ç±»è¿›è¡Œç¬¬2æ­¥çš„æœç´¢å’ŒéªŒè¯è¿‡ç¨‹ã€‚</li><li>å¦‚æœå§‹ç»ˆæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåˆ™æŠ›å‡º<code>java.lang.AbstractMethodError</code>å¼‚å¸¸ã€‚</li></ol><p><strong>IllegalAccessErrorä»‹ç»</strong></p><p>ç¨‹åºè¯•å›¾è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå±æ€§æˆ–è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œä½ æ²¡æœ‰æƒé™è®¿é—®ã€‚ä¸€èˆ¬çš„ï¼Œè¿™ä¸ªä¼šå¼•èµ·ç¼–è¯‘å™¨å¼‚å¸¸ã€‚è¿™ä¸ªé”™è¯¯å¦‚æœå‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œå°±è¯´æ˜ä¸€ä¸ªç±»å‘ç”Ÿäº†ä¸å…¼å®¹çš„æ”¹å˜ã€‚</p><h3 id="è™šæ–¹æ³•è¡¨">è™šæ–¹æ³•è¡¨</h3><ul><li><p>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œä¼šå¾ˆé¢‘ç¹çš„ä½¿ç”¨åˆ°<strong>åŠ¨æ€åˆ†æ´¾</strong>ï¼Œå¦‚æœåœ¨æ¯æ¬¡åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ä¸­éƒ½è¦é‡æ–°åœ¨ç±»çš„æ–¹æ³•å…ƒæ•°æ®ä¸­æœç´¢åˆé€‚çš„ç›®æ ‡çš„è¯å°±å¯èƒ½å½±å“åˆ°æ‰§è¡Œæ•ˆç‡ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œ<strong>JVMé‡‡ç”¨åœ¨ç±»çš„æ–¹æ³•åŒºå»ºç«‹ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼ˆvirtual method tableï¼‰æ¥å®ç°ï¼Œéè™šæ–¹æ³•ä¸ä¼šå‡ºç°åœ¨è¡¨ä¸­ã€‚ä½¿ç”¨ç´¢å¼•è¡¨æ¥ä»£æ›¿æŸ¥æ‰¾</strong>ã€‚ã€ä¸Šé¢åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœå­ç±»æ‰¾ä¸åˆ°ï¼Œè¿˜è¦ä»ä¸‹å¾€ä¸Šæ‰¾å…¶çˆ¶ç±»ï¼Œéå¸¸è€—æ—¶ã€‘</p></li><li><p>æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼Œè¡¨ä¸­å­˜æ”¾ç€å„ä¸ªæ–¹æ³•çš„å®é™…å…¥å£ã€‚</p></li><li><p>è™šæ–¹æ³•è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºçš„å‘¢ï¼Ÿè™šæ–¹æ³•è¡¨ä¼šåœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µè¢«åˆ›å»ºå¹¶å¼€å§‹åˆå§‹åŒ–ï¼Œç±»çš„å˜é‡åˆå§‹å€¼å‡†å¤‡å®Œæˆä¹‹åï¼ŒJVMä¼šæŠŠè¯¥ç±»çš„è™šæ–¹æ³•è¡¨ä¹Ÿåˆå§‹åŒ–å®Œæ¯•ã€‚</p></li></ul><p><strong>ä¸¾ä¾‹</strong></p><p><img src="../jvm-sgg4/017.png" alt=""></p><h2 id="9-æ–¹æ³•è¿”å›åœ°å€">9-æ–¹æ³•è¿”å›åœ°å€</h2><blockquote><p>(return address)</p></blockquote><ul><li><p>å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„pcå¯„å­˜å™¨çš„å€¼ã€‚</p></li><li><p>ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ­£å¸¸æ‰§è¡Œå®Œæˆ</li><li>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</li></ul></li><li><p>æ— è®ºé€šè¿‡å“ªç§æ–¹å¼é€€å‡ºï¼Œåœ¨æ–¹æ³•é€€å‡ºåéƒ½è¿”å›åˆ°è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ã€‚æ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œ<strong>è°ƒç”¨è€…çš„pcè®¡æ•°å™¨çš„å€¼ä½œä¸ºè¿”å›åœ°å€ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</strong>ã€‚è€Œé€šè¿‡å¼‚å¸¸é€€å‡ºçš„ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸è¡¨æ¥ç¡®å®šï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚</p></li><li><p>æœ¬è´¨ä¸Šï¼Œæ–¹æ³•çš„é€€å‡ºå°±æ˜¯å½“å‰æ ˆå¸§å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œéœ€è¦æ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å°†è¿”å›å€¼å‹å…¥è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆã€è®¾ç½® PC å¯„å­˜å™¨å€¼ç­‰ï¼Œè®©è°ƒç”¨è€…æ–¹æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p></li><li><p>æ­£å¸¸å®Œæˆå‡ºå£å’Œå¼‚å¸¸å®Œæˆå‡ºå£çš„åŒºåˆ«åœ¨äºï¼šé€šè¿‡å¼‚å¸¸å®Œæˆå‡ºå£é€€å‡ºçš„ä¸ä¼šç»™ä»–çš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•çš„è¿”å›å€¼ã€‚</p></li></ul><p>å½“ä¸€ä¸ªæ–¹æ³•å¼€å§‹æ‰§è¡Œåï¼Œåªæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€€å‡ºè¿™ä¸ªæ–¹æ³•</p><p><strong>æ­£å¸¸é€€å‡º</strong></p><ol><li>æ‰§è¡Œå¼•æ“é‡åˆ°ä»»æ„ä¸€ä¸ªæ–¹æ³•è¿”å›çš„å­—èŠ‚ç æŒ‡ä»¤ï¼ˆreturnï¼‰ï¼Œä¼šæœ‰è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼Œç®€ç§°<strong>æ­£å¸¸å®Œæˆå‡ºå£</strong>ï¼›</li></ol><ul><li>ä¸€ä¸ªæ–¹æ³•åœ¨æ­£å¸¸è°ƒç”¨å®Œæˆä¹‹åï¼Œç©¶ç«Ÿéœ€è¦ä½¿ç”¨å“ªä¸€ä¸ªè¿”å›æŒ‡ä»¤ï¼Œè¿˜éœ€è¦æ ¹æ®æ–¹æ³•è¿”å›å€¼çš„å®é™…æ•°æ®ç±»å‹è€Œå®šã€‚</li><li>åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè¿”å›æŒ‡ä»¤åŒ…å«ï¼š<ul><li><p>ireturnï¼šå½“è¿”å›å€¼æ˜¯booleanï¼Œbyteï¼Œcharï¼Œshortå’Œintç±»å‹æ—¶ä½¿ç”¨</p></li><li><p>lreturnï¼šLongç±»å‹</p></li><li><p>freturnï¼šFloatç±»å‹</p></li><li><p>dreturnï¼šDoubleç±»å‹</p></li><li><p>areturnï¼šå¼•ç”¨ç±»å‹</p></li><li><p>returnï¼šè¿”å›å€¼ç±»å‹ä¸º void çš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç±»å’Œæ¥å£çš„åˆå§‹åŒ–æ–¹æ³•</p></li></ul></li></ul><p><strong>å¼‚å¸¸é€€å‡º</strong></p><ol start="2"><li><p>åœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸ï¼ˆExceptionï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ²¡æœ‰åœ¨æ–¹æ³•å†…è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯åªè¦åœ¨æœ¬æ–¹æ³•çš„å¼‚å¸¸è¡¨ä¸­æ²¡æœ‰æœç´¢åˆ°åŒ¹é…çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºï¼Œç®€ç§°<strong>å¼‚å¸¸å®Œæˆå‡ºå£</strong>ã€‚</p><p>æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºå¼‚å¸¸æ—¶çš„å¼‚å¸¸å¤„ç†ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªå¼‚å¸¸å¤„ç†è¡¨ï¼Œæ–¹ä¾¿åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™æ‰¾åˆ°å¤„ç†å¼‚å¸¸çš„ä»£ç </p></li></ol><p><img src="../jvm-sgg4/018.png" alt="å¼‚å¸¸è¡¨"></p><h2 id="10-ä¸€äº›é™„åŠ ä¿¡æ¯-å¯é€‰">10-ä¸€äº›é™„åŠ ä¿¡æ¯(å¯é€‰)</h2><p>(å¯é€‰)æ ˆå¸§ä¸­è¿˜å…è®¸æºå¸¦ä¸Javaè™šæ‹Ÿæœºå®ç°ç›¸å…³çš„ä¸€äº›é™„åŠ ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šå¯¹ç¨‹åºè°ƒè¯•æä¾›æ”¯æŒçš„ä¿¡æ¯ã€‚</p><h2 id="11-æ ˆçš„ç›¸å…³é¢è¯•é¢˜">11-æ ˆçš„ç›¸å…³é¢è¯•é¢˜</h2><h3 id="ä¸¾ä¾‹æ ˆæº¢å‡ºçš„æƒ…å†µï¼Ÿ">ä¸¾ä¾‹æ ˆæº¢å‡ºçš„æƒ…å†µï¼Ÿ</h3><p>SOFï¼ˆStackOverflowErrorï¼‰ï¼Œæ ˆå¤§å°åˆ†ä¸ºå›ºå®šçš„ï¼Œå’ŒåŠ¨æ€å˜åŒ–ã€‚å¦‚æœæ˜¯å›ºå®šçš„å°±å¯èƒ½å‡ºç° StackOverflowErrorã€‚å¦‚æœæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå†…å­˜ä¸è¶³æ—¶å°±å¯èƒ½å‡ºç° OOM</p><h3 id="è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºä¹ˆï¼Ÿ">è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºä¹ˆï¼Ÿ</h3><p>ä¸èƒ½ä¿è¯ä¸æº¢å‡ºï¼Œåªèƒ½ä¿è¯ SOF å‡ºç°çš„å‡ ç‡å°</p><h3 id="åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ">åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ</h3><p>ä¸æ˜¯ï¼Œä¸€å®šæ—¶é—´å†…é™ä½äº† OOM æ¦‚ç‡ï¼Œä½†æ˜¯ä¼šæŒ¤å å…¶å®ƒçš„çº¿ç¨‹ç©ºé—´ï¼Œå› ä¸ºæ•´ä¸ªè™šæ‹Ÿæœºçš„å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„</p><h3 id="åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆï¼Ÿ">åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆï¼Ÿ</h3><p>ä¸ä¼š</p><table><thead><tr><th>ä½ç½®</th><th>æ˜¯å¦æœ‰Error</th><th>æ˜¯å¦å­˜åœ¨GC</th></tr></thead><tbody><tr><td>PCè®¡æ•°å™¨</td><td>æ— </td><td>ä¸å­˜åœ¨</td></tr><tr><td>è™šæ‹Ÿæœºæ ˆ</td><td>æœ‰ï¼ŒSOF</td><td>ä¸å­˜åœ¨</td></tr><tr><td>æœ¬åœ°æ–¹æ³•æ ˆ(åœ¨HotSpotçš„å®ç°ä¸­å’Œè™šæ‹Ÿæœºæ ˆä¸€æ ·)</td><td></td><td></td></tr><tr><td>å †</td><td>æœ‰ï¼ŒOOM</td><td>å­˜åœ¨</td></tr><tr><td>æ–¹æ³•åŒº</td><td>æœ‰</td><td>å­˜åœ¨</td></tr></tbody></table><h3 id="æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ">æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3><p><strong>å…·ä½“é—®é¢˜å…·ä½“åˆ†æ</strong></p><ul><li>å¦‚æœåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰å¯ä»¥æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™å¿…æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹æ“ä½œæ­¤æ•°æ®ï¼Œåˆ™æ­¤æ•°æ®æ˜¯å…±äº«æ•°æ®ã€‚å¦‚æœä¸è€ƒè™‘åŒæ­¥æœºåˆ¶çš„è¯ï¼Œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * @author Dee * @date 2023/12/17 * &lt;p>Description: çº¿ç¨‹å®‰å…¨demo */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringBuilderTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token comment">//s1çš„å£°æ˜æ–¹å¼æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆåªåœ¨æ–¹æ³•å†…éƒ¨ç”¨äº†ï¼‰</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//StringBuilder:çº¿ç¨‹ä¸å®‰å…¨</span>        <span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//...</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//sBuilderçš„æ“ä½œè¿‡ç¨‹ï¼šæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ˆä½œä¸ºå‚æ•°ä¼ è¿›æ¥ï¼Œå¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹æ“ä½œï¼‰</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> sBuilder<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        sBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//...</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//s1çš„æ“ä½œï¼šæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ˆæœ‰è¿”å›å€¼ï¼Œå¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹æ“ä½œï¼‰</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StringBuilder</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s1<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//s1çš„æ“ä½œï¼šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆs1è‡ªå·±æ¶ˆäº¡äº†ï¼Œæœ€åè¿”å›çš„åªæ˜¯s1.toStringçš„ä¸€ä¸ªæ–°å¯¹è±¡ï¼‰</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">method4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            s<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            s<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">method2</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-03-è¿è¡Œæ—¶æ•°æ®åŒºæ¦‚è¿°åŠç¨‹åºè®¡æ•°å™¨</title>
      <link href="/2023/12/16/jvm-sgg3/"/>
      <url>/2023/12/16/jvm-sgg3/</url>
      
        <content type="html"><![CDATA[<h1>è¿è¡Œæ—¶æ•°æ®åŒºæ¦‚è¿°åŠçº¿ç¨‹</h1><h2 id="1-è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„">1-è¿è¡Œæ—¶æ•°æ®åŒºç»“æ„</h2><p><img src="../jvm-sgg3/001.png" alt=""></p><p>å½“æˆ‘ä»¬é€šè¿‡å‰é¢çš„ï¼šç±»çš„åŠ è½½ --&gt; éªŒè¯ --&gt; å‡†å¤‡ --&gt; è§£æ â€“&gt; åˆå§‹åŒ–ï¼Œè¿™å‡ ä¸ªé˜¶æ®µå®Œæˆåï¼Œå°±ä¼šç”¨åˆ°æ‰§è¡Œå¼•æ“å¯¹æˆ‘ä»¬çš„ç±»è¿›è¡Œä½¿ç”¨ï¼ŒåŒæ—¶æ‰§è¡Œå¼•æ“å°†ä¼šä½¿ç”¨åˆ°æˆ‘ä»¬è¿è¡Œæ—¶æ•°æ®åŒº</p><p><img src="../jvm-sgg3/002.png" alt=""></p><h3 id="å†…å­˜">å†…å­˜</h3><ol><li><p>å†…å­˜æ˜¯éå¸¸é‡è¦çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯ç¡¬ç›˜å’Œ CPU çš„ä¸­é—´ä»“åº“åŠæ¡¥æ¢ï¼Œæ‰¿è½½ç€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å®æ—¶è¿è¡Œã€‚JVM å†…å­˜å¸ƒå±€è§„å®šäº† Java åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ã€åˆ†é…ã€ç®¡ç†çš„ç­–ç•¥ï¼Œä¿è¯äº†JVMçš„é«˜æ•ˆç¨³å®šè¿è¡Œã€‚<strong>ä¸åŒçš„ JVM å¯¹äºå†…å­˜çš„åˆ’åˆ†æ–¹å¼å’Œç®¡ç†æœºåˆ¶å­˜åœ¨ç€éƒ¨åˆ†å·®å¼‚</strong>ã€‚ç»“åˆ JVM è™šæ‹Ÿæœºè§„èŒƒï¼Œæ¥æ¢è®¨ä¸€ä¸‹ç»å…¸çš„ JVM å†…å­˜å¸ƒå±€ã€‚</p></li><li><p>æˆ‘ä»¬é€šè¿‡ç£ç›˜æˆ–è€…ç½‘ç»œ IO å¾—åˆ°çš„æ•°æ®ï¼Œéƒ½éœ€è¦å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶å CPU ä»å†…å­˜ä¸­è·å–æ•°æ®è¿›è¡Œè¯»å–ï¼Œä¹Ÿå°±æ˜¯è¯´å†…å­˜å……å½“äº† CPU å’Œç£ç›˜ä¹‹é—´çš„æ¡¥æ¢</p></li></ol><p><img src="../jvm-sgg3/004.png" alt="é˜¿é‡Œå·´å·´æ‰‹å†ŒJDK8"></p><h3 id="çº¿ç¨‹é—´çš„å†…å­˜ç©ºé—´">çº¿ç¨‹é—´çš„å†…å­˜ç©ºé—´</h3><p>Java è™šæ‹Ÿæœºå®šä¹‰äº†è‹¥å¹²ç§ç¨‹åºè¿è¡ŒæœŸé—´ä¼šä½¿ç”¨åˆ°çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼šå…¶ä¸­æœ‰ä¸€äº›ä¼šéšç€è™šæ‹Ÿæœºå¯åŠ¨è€Œåˆ›å»ºï¼Œéšç€è™šæ‹Ÿæœºé€€å‡ºè€Œé”€æ¯ã€‚å¦å¤–ä¸€äº›åˆ™æ˜¯ä¸çº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ï¼Œè¿™äº›ä¸çº¿ç¨‹å¯¹åº”çš„æ•°æ®åŒºåŸŸä¼šéšç€çº¿ç¨‹å¼€å§‹å’Œç»“æŸè€Œåˆ›å»ºå’Œé”€æ¯ã€‚</p><p>ç°è‰²çš„ä¸ºå•ç‹¬çº¿ç¨‹ç§æœ‰çš„ï¼Œçº¢è‰²çš„ä¸ºå¤šä¸ªçº¿ç¨‹å…±äº«çš„ã€‚å³ï¼š</p><ul><li>çº¿ç¨‹ç‹¬æœ‰ï¼šç‹¬ç«‹åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€æ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</li><li>çº¿ç¨‹é—´å…±äº«ï¼šå †ã€å †å¤–å†…å­˜ï¼ˆæ°¸ä¹…ä»£æˆ–å…ƒç©ºé—´ã€ä»£ç ç¼“å­˜ï¼‰</li></ul><img src="../jvm-sgg3/005.png" style="zoom: 70%;" /><h2 id="2-çº¿ç¨‹">2-çº¿ç¨‹</h2><ul><li><p>çº¿ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºé‡Œçš„è¿è¡Œå•å…ƒã€‚JVMå…è®¸ä¸€ä¸ªåº”ç”¨æœ‰å¤šä¸ªçº¿ç¨‹å¹¶è¡Œçš„æ‰§è¡Œ</p></li><li><p><strong>åœ¨ Hotspot JVM é‡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¸æ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ç›´æ¥æ˜ å°„</strong></p><ul><li>å½“ä¸€ä¸ª Java çº¿ç¨‹å‡†å¤‡å¥½æ‰§è¡Œä»¥åï¼Œæ­¤æ—¶ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ä¹ŸåŒæ—¶åˆ›å»ºã€‚Java çº¿ç¨‹æ‰§è¡Œç»ˆæ­¢åï¼Œæœ¬åœ°çº¿ç¨‹ä¹Ÿä¼šå›æ”¶</li></ul></li><li><p>æ“ä½œç³»ç»Ÿè´Ÿè´£å°†çº¿ç¨‹å®‰æ’è°ƒåº¦åˆ°ä»»ä½•ä¸€ä¸ªå¯ç”¨çš„ CPU ä¸Šã€‚ä¸€æ—¦æœ¬åœ°çº¿ç¨‹åˆå§‹åŒ–æˆåŠŸï¼Œå®ƒå°±ä¼šè°ƒç”¨ Java çº¿ç¨‹ä¸­çš„ run() æ–¹æ³•</p></li></ul><h3 id="JVMç³»ç»Ÿçº¿ç¨‹">JVMç³»ç»Ÿçº¿ç¨‹</h3><ul><li><p>å¦‚æœä½ ä½¿ç”¨ jconsole æˆ–è€…æ˜¯ä»»ä½•ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œéƒ½èƒ½çœ‹åˆ°åœ¨åå°æœ‰è®¸å¤šçº¿ç¨‹åœ¨è¿è¡Œã€‚è¿™äº›åå°çº¿ç¨‹ä¸åŒ…æ‹¬è°ƒç”¨<code>public static void main(String[])</code>çš„ main çº¿ç¨‹ä»¥åŠæ‰€æœ‰è¿™ä¸ª main çº¿ç¨‹è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ã€‚</p></li><li><p>è¿™äº›ä¸»è¦çš„åå°ç³»ç»Ÿçº¿ç¨‹åœ¨ Hotspot JVM é‡Œä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><p><strong>è™šæ‹Ÿæœºçº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹çš„æ“ä½œæ˜¯éœ€è¦ JVM è¾¾åˆ°å®‰å…¨ç‚¹æ‰ä¼šå‡ºç°ã€‚è¿™äº›æ“ä½œå¿…é¡»åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å‘ç”Ÿçš„åŸå› æ˜¯ä»–ä»¬éƒ½éœ€è¦ JVM è¾¾åˆ°å®‰å…¨ç‚¹ï¼Œè¿™æ ·å †æ‰ä¸ä¼šå˜åŒ–ã€‚è¿™ç§çº¿ç¨‹çš„æ‰§è¡Œç±»å‹æ‹¬&quot;stop-the-world&quot;çš„åƒåœ¾æ”¶é›†ï¼Œçº¿ç¨‹æ ˆæ”¶é›†ï¼Œçº¿ç¨‹æŒ‚èµ·ä»¥åŠåå‘é”æ’¤é”€</p></li><li><p><strong>å‘¨æœŸä»»åŠ¡çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹æ˜¯æ—¶é—´å‘¨æœŸäº‹ä»¶çš„ä½“ç°ï¼ˆæ¯”å¦‚ä¸­æ–­ï¼‰ï¼Œä»–ä»¬ä¸€èˆ¬ç”¨äºå‘¨æœŸæ€§æ“ä½œçš„è°ƒåº¦æ‰§è¡Œ</p></li><li><p><strong>GCçº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹å¯¹åœ¨ JVM é‡Œä¸åŒç§ç±»çš„åƒåœ¾æ”¶é›†è¡Œä¸ºæä¾›äº†æ”¯æŒ</p></li><li><p><strong>ç¼–è¯‘çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹åœ¨è¿è¡Œæ—¶ä¼šå°†å­—èŠ‚ç ç¼–è¯‘æˆåˆ°æœ¬åœ°ä»£ç </p></li><li><p><strong>ä¿¡å·è°ƒåº¦çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹æ¥æ”¶ä¿¡å·å¹¶å‘é€ç»™ JVMï¼Œåœ¨å®ƒå†…éƒ¨é€šè¿‡è°ƒç”¨é€‚å½“çš„æ–¹æ³•è¿›è¡Œå¤„ç†</p></li></ul></li></ul><h1>ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)</h1><h2 id="PC-Registerä»‹ç»">PC Registerä»‹ç»</h2><p><img src="../jvm-sgg3/006.png" alt=""></p><p>JVM ä¸­çš„ç¨‹åºè®¡æ•°å¯„å­˜å™¨ï¼ˆProgram Counter Registerï¼‰ä¸­ï¼ŒRegister çš„å‘½åæºäº CPU çš„å¯„å­˜å™¨ï¼Œ<strong>å¯„å­˜å™¨å­˜å‚¨æŒ‡ä»¤ç›¸å…³çš„ç°åœºä¿¡æ¯</strong>ã€‚CPU åªæœ‰æŠŠæ•°æ®è£…è½½åˆ°å¯„å­˜å™¨æ‰èƒ½å¤Ÿè¿è¡Œã€‚</p><p>è¿™é‡Œï¼Œå¹¶éæ˜¯å¹¿ä¹‰ä¸Šæ‰€æŒ‡çš„ç‰©ç†å¯„å­˜å™¨ï¼Œæˆ–è®¸å°†å…¶ç¿»è¯‘ä¸º PC è®¡æ•°å™¨ï¼ˆæˆ–æŒ‡ä»¤è®¡æ•°å™¨ï¼‰ä¼šæ›´åŠ è´´åˆ‡ï¼ˆä¹Ÿç§°ä¸ºç¨‹åºé’©å­ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿä¸å®¹æ˜“å¼•èµ·ä¸€äº›ä¸å¿…è¦çš„è¯¯ä¼šã€‚<strong>JVM ä¸­çš„PCå¯„å­˜å™¨æ˜¯å¯¹ç‰©ç† PC å¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ</strong>ã€‚</p><h2 id="ä½œç”¨">ä½œç”¨</h2><p>PC å¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ã€‚ç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå¹¶æ‰§è¡Œè¯¥æŒ‡ä»¤ã€‚</p><p><img src="../jvm-sgg3/007.png" alt=""></p><ul><li><p>å®ƒæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®°ã€‚ä¹Ÿæ˜¯è¿è¡Œé€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸã€‚</p></li><li><p>åœ¨ JVM è§„èŒƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</p></li><li><p>ä»»ä½•æ—¶é—´ä¸€ä¸ªçº¿ç¨‹éƒ½åªæœ‰ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<strong>å½“å‰æ–¹æ³•</strong>ã€‚ç¨‹åºè®¡æ•°å™¨ä¼šå­˜å‚¨å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„Javaæ–¹æ³•çš„JVMæŒ‡ä»¤åœ°å€ï¼›æˆ–è€…ï¼Œå¦‚æœæ˜¯åœ¨æ‰§è¡Œ native æ–¹æ³•ï¼Œåˆ™æ˜¯æœªæŒ‡å®šå€¼ï¼ˆundefnedï¼‰ã€‚</p></li><li><p>å®ƒæ˜¯<strong>ç¨‹åºæ§åˆ¶æµ</strong>çš„æŒ‡ç¤ºå™¨ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p></li><li><p>å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p></li><li><p>å®ƒæ˜¯<strong>å”¯ä¸€ä¸€ä¸ª</strong>åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½• OutofMemoryError æƒ…å†µçš„åŒºåŸŸã€‚</p></li></ul><h2 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h2><p><img src="../jvm-sgg3/008.png" alt="PCå¯„å­˜å™¨ä¸¾ä¾‹"></p><h2 id="ä¸¤ä¸ªå¸¸è§é—®é¢˜">ä¸¤ä¸ªå¸¸è§é—®é¢˜</h2><p>ä½¿ç”¨ PC å¯„å­˜å™¨å­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤åœ°å€æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆä½¿ç”¨ PC å¯„å­˜å™¨æ¥è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œåœ°å€å‘¢ï¼Ÿ</p><blockquote><p>å› ä¸º CPU éœ€è¦ä¸åœçš„åˆ‡æ¢å„ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶å€™åˆ‡æ¢å›æ¥ä»¥åï¼Œå°±å¾—çŸ¥é“æ¥ç€ä»å“ªå¼€å§‹ç»§ç»­æ‰§è¡Œ</p><p>JVM çš„å­—èŠ‚ç è§£é‡Šå™¨å°±éœ€è¦é€šè¿‡æ”¹å˜ PC å¯„å­˜å™¨çš„å€¼æ¥æ˜ç¡®ä¸‹ä¸€æ¡åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤</p></blockquote><p><img src="../jvm-sgg3/009.png" alt=""></p><p>PC å¯„å­˜å™¨ä¸ºä»€ä¹ˆè¢«è®¾å®šä¸ºç§æœ‰çš„ï¼Ÿ</p><blockquote><ul><li><p>æˆ‘ä»¬éƒ½çŸ¥é“æ‰€è°“çš„å¤šçº¿ç¨‹åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´æ®µå†…åªä¼šæ‰§è¡Œå…¶ä¸­æŸä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•ï¼ŒCPU ä¼šä¸åœåœ°åšä»»åŠ¡åˆ‡æ¢ï¼Œè¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«æ— å·®å‘¢ï¼Ÿ<strong>ä¸ºäº†èƒ½å¤Ÿå‡†ç¡®åœ°è®°å½•å„ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å½“å‰å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæœ€å¥½çš„åŠæ³•è‡ªç„¶æ˜¯ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ª PC å¯„å­˜å™¨</strong>ï¼Œè¿™æ ·ä¸€æ¥å„ä¸ªçº¿ç¨‹ä¹‹é—´ä¾¿å¯ä»¥è¿›è¡Œç‹¬ç«‹è®¡ç®—ï¼Œä»è€Œä¸ä¼šå‡ºç°ç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚</p></li><li><p>ç”±äº CPU æ—¶é—´ç‰‡è½®é™åˆ¶ï¼Œä¼—å¤šçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨æˆ–è€…å¤šæ ¸å¤„ç†å™¨ä¸­çš„ä¸€ä¸ªå†…æ ¸ï¼Œåªä¼šæ‰§è¡ŒæŸä¸ªçº¿ç¨‹ä¸­çš„ä¸€æ¡æŒ‡ä»¤ã€‚</p></li><li><p>è¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«æ— å·®å‘¢ï¼Ÿæ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºåï¼Œéƒ½ä¼šäº§ç”Ÿè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆå¸§ï¼Œç¨‹åºè®¡æ•°å™¨åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€‚</p></li></ul></blockquote><h2 id="CPU-æ—¶é—´ç‰‡">CPU æ—¶é—´ç‰‡</h2><ul><li><p>CPU æ—¶é—´ç‰‡å³ CPU åˆ†é…ç»™å„ä¸ªç¨‹åºçš„æ—¶é—´ï¼Œæ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ã€‚</p></li><li><p>åœ¨å®è§‚ä¸Šï¼šæˆ‘ä»¬å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªç¨‹åºå¹¶è¡Œä¸æ‚–ï¼ŒåŒæ—¶è¿è¡Œã€‚</p></li><li><p>ä½†åœ¨å¾®è§‚ä¸Šï¼šç”±äºåªæœ‰ä¸€ä¸ª CPUï¼Œä¸€æ¬¡åªèƒ½å¤„ç†ç¨‹åºè¦æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ä½•å¤„ç†å…¬å¹³ï¼Œä¸€ç§æ–¹æ³•å°±æ˜¯å¼•å…¥æ—¶é—´ç‰‡ï¼Œ<strong>æ¯ä¸ªç¨‹åºè½®æµæ‰§è¡Œ</strong>ã€‚</p></li></ul><img src="../jvm-sgg3/010.png" alt="å¹¶å‘ä¸å¹¶è¡Œ" style="zoom:33%;" />]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-02-ç±»åŠ è½½å­ç³»ç»Ÿ</title>
      <link href="/2023/12/16/jvm-sgg2/"/>
      <url>/2023/12/16/jvm-sgg2/</url>
      
        <content type="html"><![CDATA[<h1>ç±»åŠ è½½å­ç³»ç»Ÿ</h1><h2 id="1-å†…å­˜ç»“æ„æ¦‚è¿°">1-å†…å­˜ç»“æ„æ¦‚è¿°</h2><p>ç®€å›¾</p><p><img src="../jvm-sgg2/001.png" alt=""></p><p>è¯¦å›¾</p><p><img src="../jvm-sgg2/002.png" alt=""></p><p>æ³¨æ„ï¼šæ–¹æ³•åŒºåªæœ‰ HotSpot è™šæ‹Ÿæœºæœ‰ï¼ŒJ9ï¼ŒJRockit éƒ½æ²¡æœ‰</p><p>å¦‚æœè‡ªå·±æƒ³æ‰‹å†™ä¸€ä¸ª Java è™šæ‹Ÿæœºçš„è¯ï¼Œä¸»è¦è€ƒè™‘å“ªäº›ç»“æ„å‘¢ï¼Ÿ</p><ol><li>ç±»åŠ è½½å™¨</li><li>æ‰§è¡Œå¼•æ“</li></ol><h3 id="ç±»åŠ è½½å™¨å­ç³»ç»Ÿ">ç±»åŠ è½½å™¨å­ç³»ç»Ÿ</h3><ol><li><p>ç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç½‘ç»œä¸­åŠ è½½Classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†ã€‚</p></li><li><p>ClassLoader åªè´Ÿè´£ class æ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”± Execution Engine å†³å®šã€‚</p></li><li><p><strong>åŠ è½½çš„ç±»ä¿¡æ¯å­˜æ”¾äºä¸€å—ç§°ä¸ºæ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´</strong>ã€‚é™¤äº†ç±»çš„ä¿¡æ¯å¤–ï¼Œæ–¹æ³•åŒºä¸­è¿˜ä¼šå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ä¿¡æ¯ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬å­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—å¸¸é‡ï¼ˆè¿™éƒ¨åˆ†å¸¸é‡ä¿¡æ¯æ˜¯Classæ–‡ä»¶ä¸­å¸¸é‡æ± éƒ¨åˆ†çš„å†…å­˜æ˜ å°„ï¼‰</p></li></ol><p><img src="../jvm-sgg2/003.png" alt=""></p><h3 id="ç±»åŠ è½½å™¨ClassLoaderè§’è‰²">ç±»åŠ è½½å™¨ClassLoaderè§’è‰²</h3><ol><li>class file å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºè®¾è®¡å¸ˆç”»åœ¨çº¸ä¸Šçš„æ¨¡æ¿ï¼Œè€Œæœ€ç»ˆè¿™ä¸ªæ¨¡æ¿åœ¨æ‰§è¡Œçš„æ—¶å€™æ˜¯è¦åŠ è½½åˆ°JVMå½“ä¸­æ¥æ ¹æ®è¿™ä¸ªæ–‡ä»¶å®ä¾‹åŒ–å‡ºnä¸ªä¸€æ¨¡ä¸€æ ·çš„å®ä¾‹ã€‚</li><li>class file åŠ è½½åˆ° JVM ä¸­ï¼Œè¢«ç§°ä¸º DNA å…ƒæ•°æ®æ¨¡æ¿ï¼ˆåœ¨ä¸‹å›¾ä¸­å°±æ˜¯å†…å­˜ä¸­çš„Car Classï¼‰ï¼Œæ”¾åœ¨æ–¹æ³•åŒºã€‚</li><li>åœ¨ .class æ–‡ä»¶ â€“&gt; JVM â€“&gt; æœ€ç»ˆæˆä¸ºå…ƒæ•°æ®æ¨¡æ¿ï¼Œæ­¤è¿‡ç¨‹å°±è¦ä¸€ä¸ªè¿è¾“å·¥å…·ï¼ˆç±»è£…è½½å™¨Class Loaderï¼‰ï¼Œæ‰®æ¼”ä¸€ä¸ªå¿«é€’å‘˜çš„è§’è‰²ã€‚</li></ol><p><img src="../jvm-sgg2/004.png" alt=""></p><h2 id="2-ç±»åŠ è½½è¿‡ç¨‹">2-ç±»åŠ è½½è¿‡ç¨‹</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloLoader</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°¢è°¢ClassLoaderåŠ è½½æˆ‘...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä½ çš„å¤§æ©å¤§å¾·ï¼Œæˆ‘ä¸‹è¾ˆå­å†æŠ¥ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®ƒçš„åŠ è½½è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢?</p><ul><li>æ‰§è¡Œ main() æ–¹æ³•ï¼ˆé™æ€æ–¹æ³•ï¼‰å°±éœ€è¦å…ˆåŠ è½½mainæ–¹æ³•æ‰€åœ¨ç±» HelloLoader</li><li>åŠ è½½æˆåŠŸï¼Œåˆ™è¿›è¡Œé“¾æ¥ã€åˆå§‹åŒ–ç­‰æ“ä½œã€‚å®Œæˆåè°ƒç”¨ HelloLoader ç±»ä¸­çš„é™æ€æ–¹æ³• main</li><li>åŠ è½½å¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸</li></ul><p><img src="../jvm-sgg2/005.png" alt=""></p><p>å®Œæ•´çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="../jvm-sgg2/006.png" alt=""></p><h3 id="åŠ è½½-Loading-é˜¶æ®µ">åŠ è½½(Loading)é˜¶æ®µ</h3><p><strong>åŠ è½½ï¼š</strong></p><ol><li><p>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</p></li><li><p>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</p></li><li><p><strong>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Class å¯¹è±¡</strong>ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£</p></li></ol><p><strong>åŠ è½½classæ–‡ä»¶çš„æ–¹å¼ï¼š</strong></p><ol><li>ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½</li><li>é€šè¿‡ç½‘ç»œè·å–ï¼Œå…¸å‹åœºæ™¯ï¼šWeb Applet</li><li>ä» zip å‹ç¼©åŒ…ä¸­è¯»å–ï¼Œæˆä¸ºæ—¥å jarã€war æ ¼å¼çš„åŸºç¡€</li><li>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯ï¼šåŠ¨æ€ä»£ç†æŠ€æœ¯</li><li>ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œå…¸å‹åœºæ™¯ï¼šJSP åº”ç”¨ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå– .class æ–‡ä»¶ï¼Œæ¯”è¾ƒå°‘è§</li><li>ä»åŠ å¯†æ–‡ä»¶ä¸­è·å–ï¼Œå…¸å‹çš„é˜² Class æ–‡ä»¶è¢«åç¼–è¯‘çš„ä¿æŠ¤æªæ–½</li></ol><h3 id="é“¾æ¥-Linking-é˜¶æ®µ">é“¾æ¥(Linking)é˜¶æ®µ</h3><h4 id="éªŒè¯-Verify">éªŒè¯(Verify)</h4><ol><li>ç›®çš„åœ¨äºç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œä¿è¯è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨</li><li>ä¸»è¦åŒ…æ‹¬å››ç§éªŒè¯ï¼Œæ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œå…ƒæ•°æ®éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯ï¼Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</li></ol><h4 id="å‡†å¤‡-Prepare">å‡†å¤‡(Prepare)</h4><ol><li>ä¸ºç±»å˜é‡ï¼ˆstaticå˜é‡ï¼‰åˆ†é…å†…å­˜å¹¶ä¸”è®¾ç½®è¯¥ç±»å˜é‡çš„é»˜è®¤åˆå§‹å€¼ï¼Œå³é›¶å€¼</li><li><strong>è¿™é‡Œä¸åŒ…å«ç”¨ final ä¿®é¥°çš„ staticï¼Œå› ä¸º final åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…å¥½äº†é»˜è®¤å€¼ï¼Œå‡†å¤‡é˜¶æ®µä¼šæ˜¾å¼åˆå§‹åŒ–</strong></li><li><strong>æ³¨æ„ï¼šè¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–</strong>ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ° Java å †ä¸­</li></ol><h4 id="è§£æ-Resolve">è§£æ(Resolve)</h4><ol><li><p><strong>å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</strong></p></li><li><p>äº‹å®ä¸Šï¼Œè§£ææ“ä½œå¾€å¾€ä¼šä¼´éšç€JVMåœ¨æ‰§è¡Œå®Œåˆå§‹åŒ–ä¹‹åå†æ‰§è¡Œ</p></li><li><p>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ã€‚ç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨ã€Šjavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„ class æ–‡ä»¶æ ¼å¼ä¸­ã€‚ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„</p></li><li><p>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ç­‰ã€‚å¯¹åº”å¸¸é‡æ± ä¸­çš„ <code>CONSTANT_Class_info</code>ã€<code>CONSTANT Fieldref_info</code>ã€<code>CONSTANT_Methodref_info</code> ç­‰</p></li></ol><h3 id="åˆå§‹åŒ–-Initialization-é˜¶æ®µ">åˆå§‹åŒ–(Initialization)é˜¶æ®µ</h3><ol><li><p><strong>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•<code>&lt;clinit&gt;()</code>çš„è¿‡ç¨‹</strong></p></li><li><p>æ­¤æ–¹æ³•ä¸éœ€å®šä¹‰ï¼Œæ˜¯ javac ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰<strong>ç±»å˜é‡</strong>çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶è€Œæ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å½“æˆ‘ä»¬ä»£ç ä¸­åŒ…å« static å˜é‡çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰ clinit æ–¹æ³•</strong><img src="../jvm-sgg2/007.png" alt=""></p></li><li><p><code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸­çš„æŒ‡ä»¤æŒ‰è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œ</p><p><img src="../jvm-sgg2/008.png" alt=""></p></li><li><p><code>&lt;clinit&gt;()</code>ä¸åŒäºç±»çš„æ„é€ å™¨ã€‚ï¼ˆå…³è”ï¼šæ„é€ å™¨æ˜¯è™šæ‹Ÿæœºè§†è§’ä¸‹çš„<code>&lt;init&gt;()</code>ï¼‰</p><p><img src="../jvm-sgg2/009.png" alt=""></p></li><li><p>è‹¥è¯¥ç±»å…·æœ‰çˆ¶ç±»ï¼ŒJVM ä¼šä¿è¯å­ç±»çš„<code>&lt;clinit&gt;()</code>æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>å·²ç»æ‰§è¡Œå®Œæ¯•</p><p><img src="../jvm-sgg2/010.png" alt=""></p></li><li><p>è™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸‹è¢«åŒæ­¥åŠ é”</p><p><img src="../jvm-sgg2/011.png" alt=""></p></li></ol><h2 id="3-ç±»åŠ è½½å™¨çš„åˆ†ç±»">3-ç±»åŠ è½½å™¨çš„åˆ†ç±»</h2><ul><li><p>JVM ä¸¥æ ¼æ¥è®²æ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ ã€‚åˆ†åˆ«ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰å’Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆUser-Defined ClassLoaderï¼‰</p></li><li><p>ä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯ç¨‹åºä¸­ç”±å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ä¸€ç±»ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒå´æ²¡æœ‰è¿™ä¹ˆå®šä¹‰ï¼Œè€Œæ˜¯<strong>å°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></p></li><li><p>æ— è®ºç±»åŠ è½½å™¨çš„ç±»å‹å¦‚ä½•åˆ’åˆ†ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬æœ€å¸¸è§çš„ç±»åŠ è½½å™¨å§‹ç»ˆåªæœ‰3ä¸ªï¼Œå¦‚ä¸‹æ‰€ç¤º</p></li></ul><p><img src="../jvm-sgg2/012.png" alt=""></p><p><img src="../jvm-sgg2/013.png" alt=""></p><h3 id="è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨">è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨</h3><h4 id="å¯åŠ¨ç±»åŠ è½½å™¨">å¯åŠ¨ç±»åŠ è½½å™¨</h4><blockquote><p><strong>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBootstrap ClassLoaderï¼‰</strong></p></blockquote><ol><li>è¿™ä¸ªç±»åŠ è½½ä½¿ç”¨ C/C++ è¯­è¨€å®ç°çš„ï¼ŒåµŒå¥—åœ¨JVMå†…éƒ¨</li><li>å®ƒç”¨æ¥åŠ è½½Javaçš„æ ¸å¿ƒåº“ï¼ˆJAVA_HOME/jre/lib/rt.jarã€resources.jar æˆ– sun.boot.class.path è·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ï¼Œç”¨äºæä¾›JVMè‡ªèº«éœ€è¦çš„ç±»</li><li>å¹¶ä¸ç»§æ‰¿è‡ª java.lang.ClassLoaderï¼Œæ²¡æœ‰çˆ¶åŠ è½½å™¨</li><li>åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶ä½œä¸ºä»–ä»¬çš„çˆ¶ç±»åŠ è½½å™¨</li><li>å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrap å¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸º javaã€javaxã€sun ç­‰å¼€å¤´çš„ç±»</li></ol><h4 id="æ‰©å±•ç±»åŠ è½½å™¨">æ‰©å±•ç±»åŠ è½½å™¨</h4><blockquote><p><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</strong></p></blockquote><ol><li>Java è¯­è¨€ç¼–å†™ï¼Œç”± sun.misc.Launcher$ExtClassLoader å®ç°</li><li>æ´¾ç”Ÿäº ClassLoader ç±»</li><li>çˆ¶ç±»åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨</li><li>ä» java.ext.dirs ç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä» JDK çš„å®‰è£…ç›®å½•çš„ jre/lib/ext å­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰ä¸‹åŠ è½½ç±»åº“ã€‚å¦‚æœç”¨æˆ·åˆ›å»ºçš„ JAR æ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½</li></ol><h4 id="ç³»ç»Ÿç±»åŠ è½½å™¨">ç³»ç»Ÿç±»åŠ è½½å™¨</h4><blockquote><p><strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆä¹Ÿç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰</strong></p></blockquote><ol><li>Java è¯­è¨€ç¼–å†™ï¼Œç”± sun.misc.LaunchersAppClassLoader å®ç°</li><li>æ´¾ç”Ÿäº ClassLoader ç±»</li><li>çˆ¶ç±»åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨</li><li>å®ƒè´Ÿè´£åŠ è½½ç¯å¢ƒå˜é‡ classpath æˆ–ç³»ç»Ÿå±æ€§ java.class.path æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“</li><li>è¯¥ç±»åŠ è½½æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒJava åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½</li><li>é€šè¿‡ classLoader.getSystemclassLoader() æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨</li></ol><p><img src="../jvm-sgg2/014.png" alt=""></p><h3 id="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨">ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h3><h4 id="ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ">ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ</h4><ol><li>éš”ç¦»åŠ è½½ç±»ï¼ˆæ¯”å¦‚è¯´æˆ‘å‡è®¾ç°åœ¨ Spring æ¡†æ¶ï¼Œå’Œ RocketMQ æœ‰åŒ…åè·¯å¾„å®Œå…¨ä¸€æ ·çš„ç±»ï¼Œç±»åä¹Ÿä¸€æ ·ï¼Œè¿™ä¸ªæ—¶å€™ç±»å°±å†²çªäº†ã€‚ä¸è¿‡ä¸€èˆ¬çš„ä¸»æµæ¡†æ¶å’Œä¸­é—´ä»¶éƒ½ä¼šè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå®ç°ä¸åŒçš„æ¡†æ¶ï¼Œä¸­é—´ä»·ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼‰</li><li>ä¿®æ”¹ç±»åŠ è½½çš„æ–¹å¼</li><li>æ‰©å±•åŠ è½½æºï¼ˆè¿˜å¯ä»¥è€ƒè™‘ä»æ•°æ®åº“ä¸­åŠ è½½ç±»ï¼Œè·¯ç”±å™¨ç­‰ç­‰ä¸åŒçš„åœ°æ–¹ï¼‰</li><li>é˜²æ­¢æºç æ³„æ¼ï¼ˆå¯¹å­—èŠ‚ç æ–‡ä»¶è¿›è¡Œè§£å¯†ï¼Œè‡ªå·±ç”¨çš„æ—¶å€™é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å¯¹å…¶è¿›è¡Œè§£å¯†ï¼‰</li></ol><h4 id="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤">ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤</h4><ol><li>å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±»java.lang.ClassLoaderç±»çš„æ–¹å¼ï¼Œå®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä»¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚</li><li>åœ¨JDK1.2ä¹‹å‰ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œæ€»ä¼šå»ç»§æ‰¿ClassLoaderç±»å¹¶é‡å†™loadClass()æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½ç±»ï¼Œä½†æ˜¯åœ¨JDK1.2ä¹‹åå·²ä¸å†å»ºè®®ç”¨æˆ·å»è¦†ç›–loadClass()æ–¹æ³•ï¼Œè€Œæ˜¯å»ºè®®æŠŠè‡ªå®šä¹‰çš„ç±»åŠ è½½é€»è¾‘å†™åœ¨findclass()æ–¹æ³•ä¸­</li><li>åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¤ªè¿‡äºå¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿URIClassLoaderç±»ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…è‡ªå·±å»ç¼–å†™findclass()æ–¹æ³•åŠå…¶è·å–å­—èŠ‚ç æµçš„æ–¹å¼ï¼Œä½¿è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¼–å†™æ›´åŠ ç®€æ´ã€‚</li></ol><h3 id="å…³äºClassLoader">å…³äºClassLoader</h3><p>ClassLoader ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶åæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½ç»§æ‰¿è‡ªClassLoaderï¼ˆä¸åŒ…æ‹¬å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰</p><p><img src="../jvm-sgg2/015.png" alt=""></p><p>sun.misc.Launcher å®ƒæ˜¯ä¸€ä¸ª Java è™šæ‹Ÿæœºçš„å…¥å£åº”ç”¨</p><p><img src="../jvm-sgg2/016.png" alt=""></p><h4 id="è·å–ClassLoaderé€”å¾„">è·å–ClassLoaderé€”å¾„</h4><p><img src="../jvm-sgg2/017.png" alt=""></p><h2 id="4-åŒäº²å§”æ´¾æœºåˆ¶">4-åŒäº²å§”æ´¾æœºåˆ¶</h2><blockquote><p>Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯<strong>æŒ‰éœ€åŠ è½½</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦ä½¿ç”¨è¯¥ç±»æ—¶æ‰ä¼šå°†å®ƒçš„ class æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç”Ÿæˆ class å¯¹è±¡ã€‚è€Œä¸”åŠ è½½æŸä¸ªç±»çš„ class æ–‡ä»¶æ—¶ï¼ŒJava è™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³æŠŠè¯·æ±‚äº¤ç”±çˆ¶ç±»å¤„ç†ï¼Œå®ƒæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼</p></blockquote><h3 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†:</h3><ol><li>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼›</li><li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼›</li><li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚</li><li>çˆ¶ç±»åŠ è½½å™¨ä¸€å±‚ä¸€å±‚å¾€ä¸‹åˆ†é…ä»»åŠ¡ï¼Œå¦‚æœå­ç±»åŠ è½½å™¨èƒ½åŠ è½½ï¼Œåˆ™åŠ è½½æ­¤ç±»ï¼Œå¦‚æœå°†åŠ è½½ä»»åŠ¡åˆ†é…è‡³ç³»ç»Ÿç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½æ­¤ç±»ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li></ol><p><img src="../jvm-sgg2/018.png" alt=""></p><p><img src="../jvm-sgg2/019.png" alt=""></p><h3 id="åŒäº²å§”æ´¾æœºåˆ¶ä¼˜åŠ¿">åŒäº²å§”æ´¾æœºåˆ¶ä¼˜åŠ¿</h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒåŒäº²æœºåˆ¶å¯ä»¥</p><ul><li><p>é¿å…ç±»çš„é‡å¤åŠ è½½</p></li><li><p>ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹</p><ul><li><p>è‡ªå®šä¹‰ç±»ï¼šè‡ªå®šä¹‰ java.lang.String æ²¡æœ‰è¢«åŠ è½½ã€‚</p></li><li><p>è‡ªå®šä¹‰ç±»ï¼šjava.lang.ShkStartï¼ˆæŠ¥é”™ï¼šé˜»æ­¢åˆ›å»º java.langå¼€å¤´çš„ç±»ï¼‰</p></li></ul></li></ul><h3 id="æ²™ç®±å®‰å…¨æœºåˆ¶">æ²™ç®±å®‰å…¨æœºåˆ¶</h3><ol><li>è‡ªå®šä¹‰ String ç±»æ—¶ï¼šåœ¨åŠ è½½è‡ªå®šä¹‰ String ç±»çš„æ—¶å€™ä¼šç‡å…ˆä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šå…ˆåŠ è½½jdkè‡ªå¸¦çš„æ–‡ä»¶ï¼ˆrt.jaråŒ…ä¸­java.lang.String.classï¼‰ï¼ŒæŠ¥é”™ä¿¡æ¯è¯´æ²¡æœ‰ main æ–¹æ³•ï¼Œå°±æ˜¯å› ä¸ºåŠ è½½çš„æ˜¯ rt.jar åŒ…ä¸­çš„ String ç±»ã€‚</li><li>è¿™æ ·å¯ä»¥ä¿è¯å¯¹ Java æ ¸å¿ƒæºä»£ç çš„ä¿æŠ¤ï¼Œè¿™å°±æ˜¯æ²™ç®±å®‰å…¨æœºåˆ¶ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-01-JVMä¸Javaä½“ç³»ç»“æ„</title>
      <link href="/2023/12/15/jvm-sgg1/"/>
      <url>/2023/12/15/jvm-sgg1/</url>
      
        <content type="html"><![CDATA[<h2 id="JVMå’ŒJavaä½“ç³»æ¶æ„">JVMå’ŒJavaä½“ç³»æ¶æ„</h2><h3 id="å‰è¨€">å‰è¨€</h3><ol><li>è¿è¡Œç€çš„çº¿ä¸Šç³»ç»Ÿçªç„¶å¡æ­»ï¼Œç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œç”šè‡³ç›´æ¥ OOMï¼</li><li>æƒ³è§£å†³çº¿ä¸Š JVM GC é—®é¢˜ï¼Œä½†å´æ— ä»ä¸‹æ‰‹ã€‚</li><li>æ–°é¡¹ç›®ä¸Šçº¿ï¼Œå¯¹å„ç§ JVM å‚æ•°è®¾ç½®ä¸€è„¸èŒ«ç„¶ï¼Œç›´æ¥é»˜è®¤å§ç„¶åå°±JJäº†ã€‚</li><li>æ¯æ¬¡é¢è¯•ä¹‹å‰éƒ½è¦é‡æ–°èƒŒä¸€éJVMçš„ä¸€äº›åŸç†æ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œç„¶è€Œé¢è¯•å®˜å´ç»å¸¸é—®ä½ åœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•è°ƒä¼˜ VM å‚æ•°ï¼Œå¦‚ä½•è§£å†³ GCã€OOM ç­‰é—®é¢˜ï¼Œä¸€è„¸æ‡µé€¼ã€‚</li></ol><img src="../jvm-sgg1/0001.png" style="zoom:33%;" /><p>å¤§éƒ¨åˆ† Java å¼€å‘äººå‘˜ï¼Œé™¤äº†ä¼šåœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°ä¸Javaå¹³å°ç›¸å…³çš„å„ç§é«˜ç²¾å°–æŠ€æœ¯ï¼Œå¯¹äº Java æŠ€æœ¯çš„æ ¸å¿ƒ Java è™šæ‹Ÿæœºäº†è§£ç”šå°‘ã€‚</p><h3 id="å¼€å‘äººå‘˜å¦‚ä½•çœ‹å¾…ä¸Šå±‚æ¡†æ¶">å¼€å‘äººå‘˜å¦‚ä½•çœ‹å¾…ä¸Šå±‚æ¡†æ¶</h3><ol><li>å¦‚æœæˆ‘ä»¬æŠŠæ ¸å¿ƒç±»åº“çš„ API æ¯”åšæ•°å­¦å…¬å¼çš„è¯ï¼Œé‚£ä¹ˆ Java è™šæ‹Ÿæœºçš„çŸ¥è¯†å°±å¥½æ¯”å…¬å¼çš„æ¨å¯¼è¿‡ç¨‹ã€‚</li></ol><img src="../jvm-sgg1/0002.png" style="zoom:33%;" /><ol start="2"><li>è®¡ç®—æœºç³»ç»Ÿä½“ç³»å¯¹æˆ‘ä»¬æ¥è¯´è¶Šæ¥è¶Šè¿œï¼Œåœ¨ä¸äº†è§£åº•å±‚å®ç°æ–¹å¼çš„å‰æä¸‹ï¼Œé€šè¿‡é«˜çº§è¯­è¨€å¾ˆå®¹æ˜“ç¼–å†™ç¨‹åºä»£ç ã€‚ä½†äº‹å®ä¸Šè®¡ç®—æœºå¹¶ä¸è®¤è¯†é«˜çº§è¯­è¨€ã€‚</li></ol><h3 id="æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å­¦ä¹ JVM">æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å­¦ä¹ JVM</h3><ol><li>é¢è¯•çš„éœ€è¦ï¼ˆBATJã€TMDï¼ŒPKQ ç­‰é¢è¯•éƒ½çˆ±é—®ï¼‰</li><li>ä¸­é«˜çº§ç¨‹åºå‘˜å¿…å¤‡æŠ€èƒ½</li><li>é¡¹ç›®ç®¡ç†ã€è°ƒä¼˜çš„éœ€è¦</li><li>è¿½æ±‚æå®¢çš„ç²¾ç¥ï¼Œ</li></ol><ul><li>æ¯”å¦‚ï¼šåƒåœ¾å›æ”¶ç®—æ³•ã€JITã€åº•å±‚åŸç†</li></ul><h3 id="Java-VS-C">Java VS C++</h3><ol><li>åƒåœ¾æ”¶é›†æœºåˆ¶ä¸ºæˆ‘ä»¬æ‰“ç†äº†å¾ˆå¤šç¹ççš„å·¥ä½œï¼Œå¤§å¤§æé«˜äº†å¼€å‘çš„æ•ˆç‡ï¼Œä½†æ˜¯ï¼Œåƒåœ¾æ”¶é›†ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæ‡‚å¾— JVM å†…éƒ¨çš„å†…å­˜ç»“æ„ã€å·¥ä½œæœºåˆ¶ï¼Œæ˜¯è®¾è®¡é«˜æ‰©å±•æ€§åº”ç”¨å’Œè¯Šæ–­è¿è¡Œæ—¶é—®é¢˜çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯ Java å·¥ç¨‹å¸ˆè¿›é˜¶çš„å¿…å¤‡èƒ½åŠ›ã€‚</li><li>C++ è¯­è¨€éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥åˆ†é…å†…å­˜å’Œå›æ”¶å†…å­˜ï¼Œå¯¹äºé«˜æ‰‹æ¥è¯´å¯èƒ½æ›´åŠ èˆ’æœï¼Œä½†æ˜¯å¯¹äºæ™®é€šå¼€å‘è€…ï¼Œå¦‚æœæŠ€æœ¯å®åŠ›ä¸å¤Ÿï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚è€Œ Java å…¨éƒ¨äº¤ç»™ JVM è¿›è¡Œå†…å­˜åˆ†é…å’Œå›æ”¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§è¶‹åŠ¿ï¼Œå‡å°‘ç¨‹åºå‘˜çš„å·¥ä½œé‡ã€‚</li></ol><img src="../jvm-sgg1/0003.png" style="zoom:33%;" /><h3 id="æ¨èåŠå‚è€ƒä¹¦ç±">æ¨èåŠå‚è€ƒä¹¦ç±</h3><p><strong>å®˜æ–¹æ–‡æ¡£</strong></p><p><strong>è‹±æ–‡æ–‡æ¡£è§„èŒƒ</strong>ï¼š<a href="https://docs.oracle.com/javase/specs/index.html">https://docs.oracle.com/javase/specs/index.html</a></p><img src="../jvm-sgg1/0004.png" style="zoom:33%;" /><p><strong>ä¸­æ–‡ä¹¦ç±ï¼š</strong></p><img src="../jvm-sgg1/0005.png" style="zoom:33%;" /><blockquote><p>å‘¨å¿—æ˜è€å¸ˆçš„è¿™æœ¬ä¹¦<strong>éå¸¸æ¨èçœ‹</strong>ï¼Œä¸è¿‡åªæ¨èçœ‹ç¬¬ä¸‰ç‰ˆï¼Œç¬¬ä¸‰ç‰ˆè¾ƒç¬¬äºŒç‰ˆæ›´æ–°äº†å¾ˆå¤šï¼Œä¸ªäººè§‰å¾—æ²¡å¿…è¦å†çœ‹ç¬¬äºŒç‰ˆã€‚</p></blockquote><img src="../jvm-sgg1/0006.png" style="zoom:33%;" /><img src="../jvm-sgg1/0007.png" style="zoom:33%;" /><h3 id="Javaç”Ÿæ€åœˆ">Javaç”Ÿæ€åœˆ</h3><p>Java æ˜¯ç›®å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„è½¯ä»¶å¼€å‘å¹³å°ä¹‹ä¸€ã€‚éšç€ Java ä»¥åŠ Java ç¤¾åŒºçš„ä¸æ–­å£®å¤§ Java ä¹Ÿæ—©å·²ä¸å†æ˜¯ç®€ç®€å•å•çš„ä¸€é—¨è®¡ç®—æœºè¯­è¨€äº†ï¼Œå®ƒæ›´æ˜¯ä¸€ä¸ªå¹³å°ã€ä¸€ç§æ–‡åŒ–ã€ä¸€ä¸ªç¤¾åŒºã€‚</p><ol><li>ä½œä¸ºä¸€ä¸ªå¹³å°ï¼ŒJava è™šæ‹Ÿæœºæ‰®æ¼”ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨<ul><li>Groovyã€Scalaã€JRubyã€Kotlin ç­‰éƒ½æ˜¯ Java å¹³å°çš„ä¸€éƒ¨åˆ†</li></ul></li><li>ä½œä¸ºä¸€ç§æ–‡åŒ–ï¼ŒJava å‡ ä¹æˆä¸ºäº†â€œå¼€æºâ€çš„ä»£åè¯ã€‚<ul><li>ç¬¬ä¸‰æ–¹å¼€æºè½¯ä»¶å’Œæ¡†æ¶ã€‚å¦‚ Tomcatã€Strutsï¼ŒMyBatisï¼ŒSpring ç­‰ã€‚</li><li>å°±è¿ JDK å’Œ JVM è‡ªèº«ä¹Ÿæœ‰ä¸å°‘å¼€æºçš„å®ç°ï¼Œå¦‚ openJDKã€Harmonyã€‚</li></ul></li><li>ä½œä¸ºä¸€ä¸ªç¤¾åŒºï¼ŒJava æ‹¥æœ‰å…¨ä¸–ç•Œæœ€å¤šçš„æŠ€æœ¯æ‹¥æŠ¤è€…å’Œå¼€æºç¤¾åŒºæ”¯æŒï¼Œæœ‰æ•°ä¸æ¸…çš„è®ºå›å’Œèµ„æ–™ã€‚ä»æ¡Œé¢åº”ç”¨è½¯ä»¶ã€åµŒå…¥å¼å¼€å‘åˆ°ä¼ä¸šçº§åº”ç”¨ã€åå°æœåŠ¡å™¨ã€ä¸­é—´ä»¶ï¼Œéƒ½å¯ä»¥çœ‹åˆ° Java çš„èº«å½±ã€‚å…¶åº”ç”¨å½¢å¼ä¹‹å¤æ‚ã€å‚ä¸äººæ•°ä¹‹ä¼—å¤šä¹Ÿä»¤äººå’‹èˆŒã€‚</li></ol><h3 id="Java-è·¨å¹³å°çš„è¯­è¨€">Java-è·¨å¹³å°çš„è¯­è¨€</h3><img src="../jvm-sgg1/0009.png" style="zoom:33%;" /><h3 id="JVM-è·¨è¯­è¨€çš„å¹³å°">JVM-è·¨è¯­è¨€çš„å¹³å°</h3><img src="../jvm-sgg1/0010.png" style="zoom:33%;" /><ol><li>éšç€ Java7 çš„æ­£å¼å‘å¸ƒï¼ŒJava è™šæ‹Ÿæœºçš„è®¾è®¡è€…ä»¬é€šè¿‡ JSR-292 è§„èŒƒåŸºæœ¬å®ç°åœ¨ Java è™šæ‹Ÿæœºå¹³å°ä¸Šè¿è¡Œé Java è¯­è¨€ç¼–å†™çš„ç¨‹åºã€‚</li><li>Java è™šæ‹Ÿæœºæ ¹æœ¬ä¸å…³å¿ƒè¿è¡Œåœ¨å…¶å†…éƒ¨çš„ç¨‹åºåˆ°åº•æ˜¯ä½¿ç”¨ä½•ç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå®ƒåªå…³å¿ƒâ€œå­—èŠ‚ç â€æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ Java è™šæ‹Ÿæœºæ‹¥æœ‰è¯­è¨€æ— å…³æ€§ï¼Œå¹¶ä¸ä¼šå•çº¯åœ°ä¸ Java è¯­è¨€â€œç»ˆèº«ç»‘å®šâ€ï¼Œåªè¦å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ç¼–è¯‘ç»“æœæ»¡è¶³å¹¶åŒ…å« Java è™šæ‹Ÿæœºçš„å†…éƒ¨æŒ‡ä»¤é›†ã€ç¬¦å·è¡¨ä»¥åŠå…¶ä»–çš„è¾…åŠ©ä¿¡æ¯ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå°±èƒ½å¤Ÿè¢«è™šæ‹Ÿæœºæ‰€è¯†åˆ«å¹¶è£…è½½è¿è¡Œã€‚</li></ol><ul><li>Java ä¸æ˜¯æœ€å¼ºå¤§çš„è¯­è¨€ï¼Œä½†æ˜¯ JVM æ˜¯æœ€å¼ºå¤§çš„è™šæ‹Ÿæœº</li></ul><ol><li><p>æˆ‘ä»¬å¹³æ—¶è¯´çš„ Java å­—èŠ‚ç ï¼ŒæŒ‡çš„æ˜¯ç”¨ Java è¯­è¨€ç¼–è¯‘æˆçš„å­—èŠ‚ç ã€‚å‡†ç¡®çš„è¯´ä»»ä½•èƒ½åœ¨ JVM å¹³å°ä¸Šæ‰§è¡Œçš„å­—èŠ‚ç æ ¼å¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥åº”è¯¥ç»Ÿç§°ä¸ºï¼šJVM å­—èŠ‚ç ã€‚</p></li><li><p>ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥ç¼–è¯‘å‡ºç›¸åŒçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå­—èŠ‚ç æ–‡ä»¶ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„ JVM ä¸Šè¿è¡Œã€‚</p></li><li><p>Java è™šæ‹Ÿæœºä¸ Java è¯­è¨€å¹¶æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œå®ƒåªä¸ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼â€”â€”Class æ–‡ä»¶æ ¼å¼æ‰€å…³è”ï¼ŒClass æ–‡ä»¶ä¸­åŒ…å«äº† Java è™šæ‹ŸæœºæŒ‡ä»¤é›†ï¼ˆæˆ–è€…ç§°ä¸ºå­—èŠ‚ç ã€Bytecodesï¼‰å’Œç¬¦å·è¡¨ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚</p></li></ol><h3 id="å¤šè¯­è¨€æ··åˆç¼–ç¨‹">å¤šè¯­è¨€æ··åˆç¼–ç¨‹</h3><ol><li><p>Java å¹³å°ä¸Šçš„å¤šè¯­è¨€æ··åˆç¼–ç¨‹æ­£æˆä¸ºä¸»æµï¼Œé€šè¿‡ç‰¹å®šé¢†åŸŸçš„è¯­è¨€å»è§£å†³ç‰¹å®šé¢†åŸŸçš„é—®é¢˜æ˜¯å½“å‰è½¯ä»¶å¼€å‘åº”å¯¹æ—¥è¶‹å¤æ‚çš„é¡¹ç›®éœ€æ±‚çš„ä¸€ä¸ªæ–¹å‘ã€‚</p></li><li><p>è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¹‹ä¸­ï¼Œå¹¶è¡Œå¤„ç†ç”¨ Clojure è¯­è¨€ç¼–å†™ï¼Œå±•ç¤ºå±‚ä½¿ç”¨ JRuby/Railsï¼Œä¸­é—´å±‚åˆ™æ˜¯ Javaï¼Œæ¯ä¸ªåº”ç”¨å±‚éƒ½å°†ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æ¥å®Œæˆï¼Œè€Œä¸”ï¼Œæ¥å£å¯¹æ¯ä¸€å±‚çš„å¼€å‘è€…éƒ½æ˜¯é€æ˜çš„ï¼Œå„ç§è¯­è¨€ä¹‹é—´çš„äº¤äº’ä¸å­˜åœ¨ä»»ä½•å›°éš¾ï¼Œå°±åƒä½¿ç”¨è‡ªå·±è¯­è¨€çš„åŸç”Ÿ API ä¸€æ ·æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä»¬æœ€ç»ˆéƒ½è¿è¡Œåœ¨ä¸€ä¸ªè™šæ‹Ÿæœºä¹‹ä¸Šã€‚</p></li><li><p>å¯¹è¿™äº›è¿è¡Œäº Java è™šæ‹Ÿæœºä¹‹ä¸Šã€Java ä¹‹å¤–çš„è¯­è¨€ï¼Œæ¥è‡ªç³»ç»Ÿçº§çš„ã€åº•å±‚çš„æ”¯æŒæ­£åœ¨è¿…é€Ÿå¢å¼ºï¼Œä»¥ JSR-292 ä¸ºæ ¸å¿ƒçš„ä¸€ç³»åˆ—é¡¹ç›®å’ŒåŠŸèƒ½æ”¹è¿›ï¼ˆå¦‚ DaVinci Machine é¡¹ç›®ã€Nashorn å¼•æ“ã€InvokeDynamic æŒ‡ä»¤ã€java.lang.invoke åŒ…ç­‰ï¼‰ï¼Œæ¨åŠ¨ Java è™šæ‹Ÿæœºä»â€œJava è¯­è¨€çš„è™šæ‹Ÿæœºâ€å‘ â€œå¤šè¯­è¨€è™šæ‹Ÿæœºâ€çš„æ–¹å‘å‘å±•ã€‚</p></li></ol><h3 id="å¦‚ä½•çœŸæ­£ææ‡‚JVMï¼Ÿ">å¦‚ä½•çœŸæ­£ææ‡‚JVMï¼Ÿ</h3><p>Java è™šæ‹Ÿæœºéå¸¸å¤æ‚ï¼Œè¦æƒ³çœŸæ­£ç†è§£å®ƒçš„å·¥ä½œåŸç†ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯è‡ªå·±åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ªï¼</p><img src="../jvm-sgg1/0011.png" style="zoom: 30%;" /><h3 id="Javaå‘å±•é‡å¤§äº‹ä»¶">Javaå‘å±•é‡å¤§äº‹ä»¶</h3><ul><li>1990å¹´ï¼Œåœ¨ Sun è®¡ç®—æœºå…¬å¸ä¸­ï¼Œç”± Patrick Naughtonã€MikeSheridan åŠ James Gosling é¢†å¯¼çš„å°ç»„ Green Teamï¼Œå¼€å‘å‡ºçš„æ–°çš„ç¨‹åºè¯­è¨€ï¼Œå‘½åä¸º Oakï¼ŒåæœŸå‘½åä¸º Java</li><li>1995å¹´ï¼ŒSun æ­£å¼å‘å¸ƒ Java å’Œ HotJava äº§å“ï¼ŒJava é¦–æ¬¡å…¬å¼€äº®ç›¸ã€‚</li><li>1996å¹´1æœˆ23æ—¥ Sun Microsystems å‘å¸ƒäº†JDK 1.0ã€‚</li><li>1998å¹´ï¼ŒJDK1.2 ç‰ˆæœ¬å‘å¸ƒã€‚åŒæ—¶ï¼ŒSun å‘å¸ƒäº† JSP/Servletã€EJB è§„èŒƒï¼Œä»¥åŠå°† Java åˆ†æˆäº† J2EEã€J2SE å’Œ J2MEã€‚è¿™è¡¨æ˜äº† Java å¼€å§‹å‘ä¼ä¸šã€æ¡Œé¢åº”ç”¨å’Œç§»åŠ¨è®¾å¤‡åº”ç”¨ 3 å¤§é¢†åŸŸæŒºè¿›ã€‚</li><li>2000å¹´ï¼ŒJDK1.3å‘å¸ƒï¼ŒJava HotSpot Virtual Machine æ­£å¼å‘å¸ƒï¼Œæˆä¸º Java çš„é»˜è®¤è™šæ‹Ÿæœºã€‚</li><li>2002å¹´ï¼ŒJDK1.4 å‘å¸ƒï¼Œå¤è€çš„ Classic è™šæ‹Ÿæœºé€€å‡ºå†å²èˆå°ã€‚</li><li>2003å¹´å¹´åº•ï¼ŒJava å¹³å°çš„ scala æ­£å¼å‘å¸ƒï¼ŒåŒå¹´ Groovy ä¹ŸåŠ å…¥äº† Java é˜µè¥ã€‚</li><li>2004å¹´ï¼ŒJDK1.5 å‘å¸ƒã€‚åŒæ—¶ JDK1.5 æ”¹åä¸º JavaSE5.0ã€‚</li><li>2006å¹´ï¼ŒJDK6 å‘å¸ƒã€‚åŒå¹´ï¼ŒJava å¼€æºå¹¶å»ºç«‹äº† OpenJDKã€‚é¡ºç†æˆç« ï¼ŒHotspot è™šæ‹Ÿæœºä¹Ÿæˆä¸ºäº† OpenJDK ä¸­çš„é»˜è®¤è™šæ‹Ÿæœºã€‚</li><li>2007å¹´ï¼ŒJava å¹³å°è¿æ¥äº†æ–°ä¼™ä¼´ Clojureã€‚</li><li>2008å¹´ï¼ŒOracle æ”¶è´­äº† BEAï¼Œå¾—åˆ°äº† JRockit è™šæ‹Ÿæœºã€‚</li><li>2009å¹´ï¼ŒTwitter å®£å¸ƒæŠŠåå°å¤§éƒ¨åˆ†ç¨‹åºä» Ruby è¿ç§»åˆ° Scalaï¼Œè¿™æ˜¯ Java å¹³å°çš„åˆä¸€æ¬¡å¤§è§„æ¨¡åº”ç”¨ã€‚</li><li>2010å¹´ï¼ŒOracle æ”¶è´­äº† Sunï¼Œè·å¾— Java å•†æ ‡å’Œæœ€çœŸä»·å€¼çš„HotSpotè™šæ‹Ÿæœºã€‚æ­¤æ—¶ï¼ŒOracle æ‹¥æœ‰å¸‚åœºå ç”¨ç‡æœ€é«˜çš„ä¸¤æ¬¾è™šæ‹ŸæœºHotSpot å’Œ JRockitï¼Œå¹¶è®¡åˆ’åœ¨æœªæ¥å¯¹å®ƒä»¬è¿›è¡Œæ•´åˆï¼šHotRockitã€‚JCP ç»„ç»‡ç®¡ç† Java è¯­è¨€</li><li>2011å¹´ï¼ŒJDK7 å‘å¸ƒã€‚åœ¨ JDK1.7u4 ä¸­ï¼Œæ­£å¼å¯ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶å™¨ G1ã€‚</li><li><strong>2017å¹´ï¼ŒJDK9å‘å¸ƒã€‚å°†G1è®¾ç½®ä¸ºé»˜è®¤GCï¼Œæ›¿ä»£CMS</strong></li><li>åŒå¹´ï¼ŒIBM çš„ J9 å¼€æºï¼Œå½¢æˆäº†ç°åœ¨çš„ Open J9 ç¤¾åŒº</li><li>2018å¹´ï¼ŒAndroid çš„ Java ä¾µæƒæ¡ˆåˆ¤å†³ï¼ŒGoogle èµ”å¿ Oracle è®¡ 88äº¿ç¾å…ƒ</li><li>åŒå¹´ï¼ŒOracle å®£å‘Š JavagE æˆä¸ºå†å²åè¯ JDBCã€JMSã€Servlet èµ äºˆ Eclipse åŸºé‡‘ä¼š</li><li><strong>åŒå¹´ï¼ŒJDK11 å‘å¸ƒï¼ŒLTS ç‰ˆæœ¬çš„ JDKï¼Œå‘å¸ƒé©å‘½æ€§çš„ ZGCï¼Œè°ƒæ•´ JDK æˆæƒè®¸å¯</strong></li><li>2019å¹´ï¼ŒJDK12 å‘å¸ƒï¼ŒåŠ å…¥ RedHat é¢†å¯¼å¼€å‘çš„ Shenandoah GC</li></ul><h3 id="Open-JDKå’ŒOracle-JDK">Open JDKå’ŒOracle JDK</h3><img src="../jvm-sgg1/0012.png" style="zoom:33%;" /><ul><li>åœ¨ JDK11 ä¹‹å‰ï¼ŒOracle JDK ä¸­è¿˜ä¼šå­˜åœ¨ä¸€äº› Open JDK ä¸­æ²¡æœ‰çš„ï¼Œé—­æºçš„åŠŸèƒ½ã€‚ä½†åœ¨ JDK11 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º Open JDK å’Œ Oracle JDK ä»£ç å®è´¨ä¸Šå·²ç»è¾¾åˆ°å®Œå…¨ä¸€è‡´çš„ç¨‹åº¦äº†ã€‚</li><li>ä¸»è¦çš„åŒºåˆ«å°±æ˜¯ä¸¤è€…æ›´æ–°å‘¨æœŸä¸ä¸€æ ·</li></ul><h3 id="è™šæ‹Ÿæœº">è™šæ‹Ÿæœº</h3><h4 id="è™šæ‹Ÿæœºæ¦‚å¿µ">è™šæ‹Ÿæœºæ¦‚å¿µ</h4><ul><li><p>æ‰€è°“è™šæ‹Ÿæœºï¼ˆVirtual Machineï¼‰ï¼Œå°±æ˜¯ä¸€å°è™šæ‹Ÿçš„è®¡ç®—æœºã€‚å®ƒæ˜¯ä¸€æ¬¾è½¯ä»¶ï¼Œç”¨æ¥æ‰§è¡Œä¸€ç³»åˆ—è™šæ‹Ÿè®¡ç®—æœºæŒ‡ä»¤ã€‚å¤§ä½“ä¸Šï¼Œè™šæ‹Ÿæœºå¯ä»¥åˆ†ä¸ºç³»ç»Ÿè™šæ‹Ÿæœºå’Œç¨‹åºè™šæ‹Ÿæœºã€‚</p><ul><li>å¤§åé¼é¼çš„ Virtual Boxï¼ŒVMware å°±å±äºç³»ç»Ÿè™šæ‹Ÿæœºï¼Œå®ƒä»¬å®Œå…¨æ˜¯å¯¹ç‰©ç†è®¡ç®—æœºç¡¬ä»¶çš„ä»¿çœŸ(æ¨¡æ‹Ÿ)ï¼Œæä¾›äº†ä¸€ä¸ªå¯è¿è¡Œå®Œæ•´æ“ä½œç³»ç»Ÿçš„è½¯ä»¶å¹³å°ã€‚</li></ul><ul><li>ç¨‹åºè™šæ‹Ÿæœºçš„å…¸å‹ä»£è¡¨å°±æ˜¯ Java è™šæ‹Ÿæœºï¼Œå®ƒä¸“é—¨ä¸ºæ‰§è¡Œå•ä¸ªè®¡ç®—æœºç¨‹åºè€Œè®¾è®¡ï¼Œåœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„æŒ‡ä»¤æˆ‘ä»¬ç§°ä¸º Java å­—èŠ‚ç æŒ‡ä»¤ã€‚</li></ul></li><li><p>æ— è®ºæ˜¯ç³»ç»Ÿè™šæ‹Ÿæœºè¿˜æ˜¯ç¨‹åºè™šæ‹Ÿæœºï¼Œåœ¨ä¸Šé¢è¿è¡Œçš„è½¯ä»¶éƒ½è¢«é™åˆ¶äºè™šæ‹Ÿæœºæä¾›çš„èµ„æºä¸­ã€‚</p></li></ul><h4 id="Javaè™šæ‹Ÿæœº">Javaè™šæ‹Ÿæœº</h4><ol><li>Java è™šæ‹Ÿæœºæ˜¯ä¸€å°æ‰§è¡Œ Java å­—èŠ‚ç çš„è™šæ‹Ÿè®¡ç®—æœºï¼Œå®ƒæ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œæœºåˆ¶ï¼Œå…¶è¿è¡Œçš„ Java å­—èŠ‚ç ä¹Ÿæœªå¿…ç”± Java è¯­è¨€ç¼–è¯‘è€Œæˆã€‚</li><li>JVM å¹³å°çš„å„ç§è¯­è¨€å¯ä»¥å…±äº« Java è™šæ‹Ÿæœºå¸¦æ¥çš„è·¨å¹³å°æ€§ã€ä¼˜ç§€çš„åƒåœ¾å›å™¨ï¼Œä»¥åŠå¯é çš„å³æ—¶ç¼–è¯‘å™¨ã€‚</li><li><strong>JavaæŠ€æœ¯çš„æ ¸å¿ƒå°±æ˜¯Javaè™šæ‹Ÿæœº</strong>ï¼ˆJVMï¼ŒJava Virtual Machineï¼‰ï¼Œå› ä¸ºæ‰€æœ‰çš„Javaç¨‹åºéƒ½è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºå†…éƒ¨ã€‚</li></ol><p><strong>ä½œç”¨ï¼š</strong></p><p>Java è™šæ‹Ÿæœºå°±æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼Œè´Ÿè´£è£…è½½å­—èŠ‚ç åˆ°å…¶å†…éƒ¨ï¼Œè§£é‡Š/ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚æ¯ä¸€æ¡JavaæŒ‡ä»¤ï¼ŒJavaè™šæ‹Ÿæœºè§„èŒƒä¸­éƒ½æœ‰è¯¦ç»†å®šä¹‰ï¼Œå¦‚æ€ä¹ˆå–æ“ä½œæ•°ï¼Œæ€ä¹ˆå¤„ç†æ“ä½œæ•°ï¼Œå¤„ç†ç»“æœæ”¾åœ¨å“ªé‡Œã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ol><li>ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œ</li><li>è‡ªåŠ¨å†…å­˜ç®¡ç†</li><li>è‡ªåŠ¨åƒåœ¾å›æ”¶åŠŸèƒ½</li></ol><h3 id="JVMçš„ä½ç½®">JVMçš„ä½ç½®</h3><p>JVM æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„ï¼Œå®ƒä¸ç¡¬ä»¶æ²¡æœ‰ç›´æ¥çš„äº¤äº’</p><img src="../jvm-sgg1/0013.png" style="zoom:33%;" /><img src="../jvm-sgg1/0014.png" style="zoom:33%;" /><h3 id="JVMçš„æ•´ä½“ç»“æ„">JVMçš„æ•´ä½“ç»“æ„</h3><ol><li>HotSpot VM æ˜¯ç›®å‰å¸‚é¢ä¸Šé«˜æ€§èƒ½è™šæ‹Ÿæœºçš„ä»£è¡¨ä½œä¹‹ä¸€ã€‚</li><li>å®ƒé‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ã€‚</li><li>åœ¨ä»Šå¤©ï¼ŒJava ç¨‹åºçš„è¿è¡Œæ€§èƒ½æ—©å·²è„±èƒæ¢éª¨ï¼Œå·²ç»è¾¾åˆ°äº†å¯ä»¥å’Œ C/C++ ç¨‹åºä¸€è¾ƒé«˜ä¸‹çš„åœ°æ­¥ã€‚</li></ol><img src="../jvm-sgg1/0015.png" style="zoom:50%;" /><h3 id="Javaä»£ç æ‰§è¡Œæµç¨‹">Javaä»£ç æ‰§è¡Œæµç¨‹</h3><p>å‡¡æ˜¯èƒ½ç”Ÿæˆè¢« Java è™šæ‹Ÿæœºæ‰€èƒ½è§£é‡Šã€è¿è¡Œçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé‚£ä¹ˆç†è®ºä¸Šæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±è®¾è®¡ä¸€å¥—è¯­è¨€äº†</p><p><img src="../jvm-sgg1/0016.png" alt=""></p><h3 id="JVMçš„æ¶æ„æ¨¡å‹">JVMçš„æ¶æ„æ¨¡å‹</h3><p>Java ç¼–è¯‘å™¨è¾“å…¥çš„æŒ‡ä»¤æµåŸºæœ¬ä¸Šæ˜¯ä¸€ç§<strong>åŸºäºæ ˆçš„æŒ‡ä»¤é›†æ¶æ„</strong>ï¼Œå¦å¤–ä¸€ç§æŒ‡ä»¤é›†æ¶æ„åˆ™æ˜¯<strong>åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤é›†æ¶æ„</strong>ã€‚å…·ä½“æ¥è¯´ï¼šè¿™ä¸¤ç§æ¶æ„ä¹‹é—´çš„åŒºåˆ«ï¼š</p><h3 id="åŸºäºæ ˆçš„æŒ‡ä»¤é›†æ¶æ„">åŸºäºæ ˆçš„æŒ‡ä»¤é›†æ¶æ„</h3><p>åŸºäºæ ˆå¼æ¶æ„çš„ç‰¹ç‚¹ï¼š</p><ol><li>è®¾è®¡å’Œå®ç°æ›´ç®€å•ï¼Œé€‚ç”¨äºèµ„æºå—é™çš„ç³»ç»Ÿï¼›</li><li>é¿å¼€äº†å¯„å­˜å™¨çš„åˆ†é…éš¾é¢˜ï¼šä½¿ç”¨é›¶åœ°å€æŒ‡ä»¤æ–¹å¼åˆ†é…</li><li>æŒ‡ä»¤æµä¸­çš„æŒ‡ä»¤å¤§éƒ¨åˆ†æ˜¯é›¶åœ°å€æŒ‡ä»¤ï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹ä¾èµ–äºæ“ä½œæ ˆã€‚æŒ‡ä»¤é›†æ›´å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°</li><li>ä¸éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œå¯ç§»æ¤æ€§æ›´å¥½ï¼Œæ›´å¥½å®ç°è·¨å¹³å°</li></ol><h3 id="åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤çº§æ¶æ„">åŸºäºå¯„å­˜å™¨çš„æŒ‡ä»¤çº§æ¶æ„</h3><p>åŸºäºå¯„å­˜å™¨æ¶æ„çš„ç‰¹ç‚¹ï¼š</p><ol><li>å…¸å‹çš„åº”ç”¨æ˜¯x86çš„äºŒè¿›åˆ¶æŒ‡ä»¤é›†ï¼šæ¯”å¦‚ä¼ ç»Ÿçš„ PC ä»¥åŠ Android çš„ Davlik è™šæ‹Ÿæœºã€‚</li><li>æŒ‡ä»¤é›†æ¶æ„åˆ™å®Œå…¨ä¾èµ–ç¡¬ä»¶ï¼Œä¸ç¡¬ä»¶çš„è€¦åˆåº¦é«˜ï¼Œå¯ç§»æ¤æ€§å·®</li><li>æ€§èƒ½ä¼˜ç§€å’Œæ‰§è¡Œæ›´é«˜æ•ˆ</li><li>èŠ±è´¹æ›´å°‘çš„æŒ‡ä»¤å»å®Œæˆä¸€é¡¹æ“ä½œ</li><li>åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒåŸºäºå¯„å­˜å™¨æ¶æ„çš„æŒ‡ä»¤é›†å¾€å¾€éƒ½ä»¥ä¸€åœ°å€æŒ‡ä»¤ã€äºŒåœ°å€æŒ‡ä»¤å’Œä¸‰åœ°å€æŒ‡ä»¤ä¸ºä¸»ï¼Œè€ŒåŸºäºæ ˆå¼æ¶æ„çš„æŒ‡ä»¤é›†å´æ˜¯ä»¥é›¶åœ°å€æŒ‡ä»¤ä¸ºä¸»</li></ol><h3 id="ä¸¤ç§æ¶æ„çš„ä¸¾ä¾‹">ä¸¤ç§æ¶æ„çš„ä¸¾ä¾‹</h3><p>åŒæ ·æ‰§è¡Œ 2+3 è¿™ç§é€»è¾‘æ“ä½œï¼Œå…¶æŒ‡ä»¤åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li><p><strong>åŸºäºæ ˆçš„è®¡ç®—æµç¨‹ï¼ˆä»¥Javaè™šæ‹Ÿæœºä¸ºä¾‹ï¼‰ï¼š</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java">iconst_2 <span class="token comment">//å¸¸é‡2å…¥æ ˆ</span>istore_1iconst_3 <span class="token comment">// å¸¸é‡3å…¥æ ˆ</span>istore_2iload_1iload_2iadd <span class="token comment">//å¸¸é‡2/3å‡ºæ ˆï¼Œæ‰§è¡Œç›¸åŠ </span>istore_0 <span class="token comment">// ç»“æœ5å…¥æ ˆ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>8 ä¸ªæŒ‡ä»¤</p></li><li><p><strong>è€ŒåŸºäºå¯„å­˜å™¨çš„è®¡ç®—æµç¨‹</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java">mov eax<span class="token punctuation">,</span><span class="token number">2</span> <span class="token comment">//å°†eaxå¯„å­˜å™¨çš„å€¼è®¾ä¸º1</span>add eax<span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">//ä½¿eaxå¯„å­˜å™¨çš„å€¼åŠ 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>2 ä¸ªæŒ‡ä»¤</p></li></ul><blockquote><p>å…·ä½“åé¢ä¼šè®²</p></blockquote><h3 id="JVMæ¶æ„æ€»ç»“">JVMæ¶æ„æ€»ç»“</h3><ol><li><p><strong>ç”±äºè·¨å¹³å°æ€§çš„è®¾è®¡ï¼ŒJava çš„æŒ‡ä»¤éƒ½æ˜¯æ ¹æ®æ ˆæ¥è®¾è®¡çš„</strong>ã€‚ä¸åŒå¹³å° CPU æ¶æ„ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½è®¾è®¡ä¸ºåŸºäºå¯„å­˜å™¨çš„ã€‚æ ˆçš„ä¼˜ç‚¹ï¼šè·¨å¹³å°ï¼ŒæŒ‡ä»¤é›†å°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°ï¼Œç¼ºç‚¹æ˜¯æ€§èƒ½æ¯”å¯„å­˜å™¨å·®ä¸€äº›ã€‚</p></li><li><p>æ—¶è‡³ä»Šæ—¥ï¼Œå°½ç®¡åµŒå…¥å¼å¹³å°å·²ç»ä¸æ˜¯ Java ç¨‹åºçš„ä¸»æµè¿è¡Œå¹³å°äº†ï¼ˆå‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯ HotSpot VM çš„å®¿ä¸»ç¯å¢ƒå·²ç»ä¸å±€é™äºåµŒå…¥å¼å¹³å°äº†ï¼‰ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å°†æ¶æ„æ›´æ¢ä¸ºåŸºäºå¯„å­˜å™¨çš„æ¶æ„å‘¢ï¼Ÿ</p></li></ol><ul><li>å› ä¸ºåŸºäºæ ˆçš„æ¶æ„è·¨å¹³å°æ€§å¥½ã€æŒ‡ä»¤é›†å°ï¼Œè™½ç„¶ç›¸å¯¹äºåŸºäºå¯„å­˜å™¨çš„æ¶æ„æ¥è¯´ï¼ŒåŸºäºæ ˆçš„æ¶æ„ç¼–è¯‘å¾—åˆ°çš„æŒ‡ä»¤æ›´å¤šï¼Œæ‰§è¡Œæ€§èƒ½ä¹Ÿä¸å¦‚åŸºäºå¯„å­˜å™¨çš„æ¶æ„å¥½ï¼Œä½†è€ƒè™‘åˆ°å…¶è·¨å¹³å°æ€§ä¸ç§»æ¤æ€§ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€‰ç”¨æ ˆçš„æ¶æ„</li></ul><h3 id="JVMçš„ç”Ÿå‘½å‘¨æœŸ">JVMçš„ç”Ÿå‘½å‘¨æœŸ</h3><h4 id="è™šæ‹Ÿæœºçš„å¯åŠ¨">è™šæ‹Ÿæœºçš„å¯åŠ¨</h4><p>Java è™šæ‹Ÿæœºçš„å¯åŠ¨æ˜¯é€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰åˆ›å»ºä¸€ä¸ªåˆå§‹ç±»ï¼ˆinitial classï¼‰æ¥å®Œæˆçš„ï¼Œè¿™ä¸ªç±»æ˜¯ç”±è™šæ‹Ÿæœºçš„å…·ä½“å®ç°æŒ‡å®šçš„ã€‚</p><h4 id="è™šæ‹Ÿæœºçš„æ‰§è¡Œ">è™šæ‹Ÿæœºçš„æ‰§è¡Œ</h4><ol><li>ä¸€ä¸ªè¿è¡Œä¸­çš„ Java è™šæ‹Ÿæœºæœ‰ç€ä¸€ä¸ªæ¸…æ™°çš„ä»»åŠ¡ï¼šæ‰§è¡ŒJavaç¨‹åº</li><li>ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ä»–æ‰è¿è¡Œï¼Œç¨‹åºç»“æŸæ—¶ä»–å°±åœæ­¢</li><li><strong>æ‰§è¡Œä¸€ä¸ªæ‰€è°“çš„ Java ç¨‹åºçš„æ—¶å€™ï¼ŒçœŸçœŸæ­£æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªå«åš Java æ‹Ÿæœºçš„è¿›ç¨‹</strong></li></ol><h4 id="è™šæ‹Ÿæœºçš„é€€å‡º">è™šæ‹Ÿæœºçš„é€€å‡º</h4><p><strong>æœ‰å¦‚ä¸‹çš„å‡ ç§æƒ…å†µï¼š</strong></p><ol><li><p>ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ</p></li><li><p>ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢</p></li><li><p>ç”±äºæ“ä½œç³»ç»Ÿç”¨ç°é”™è¯¯è€Œå¯¼è‡´ Java è™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢</p></li><li><p>æŸçº¿ç¨‹è°ƒç”¨ Runtime ç±»æˆ– System ç±»çš„ exit() æ–¹æ³•ï¼Œæˆ– Runtime ç±»çš„ halt() æ–¹æ³•ï¼Œå¹¶ä¸” Java å®‰å…¨ç®¡ç†å™¨ä¹Ÿå…è®¸è¿™æ¬¡ exit() æˆ– halt() æ“ä½œã€‚</p></li><li><p>é™¤æ­¤ä¹‹å¤–ï¼ŒJNIï¼ˆJava Native Interfaceï¼‰è§„èŒƒæè¿°äº†ç”¨ JNI Invocation API æ¥åŠ è½½æˆ–å¸è½½  Java è™šæ‹Ÿæœºæ—¶ï¼ŒJava è™šæ‹Ÿæœºçš„é€€å‡ºæƒ…å†µã€‚</p></li></ol><h3 id="JVMå‘å±•å†ç¨‹">JVMå‘å±•å†ç¨‹</h3><h4 id="Sun-Classic-VM">Sun Classic VM</h4><ol><li>æ—©åœ¨ 1996 å¹´ Java1.0 ç‰ˆæœ¬çš„æ—¶å€™ï¼ŒSun å…¬å¸å‘å¸ƒäº†ä¸€æ¬¾åä¸º sun classic VM çš„ Javaè™šæ‹Ÿæœºï¼Œå®ƒåŒæ—¶ä¹Ÿæ˜¯<strong>ä¸–ç•Œä¸Šç¬¬ä¸€æ¬¾å•†ç”¨ Java è™šæ‹Ÿæœº</strong>ï¼ŒJDK1.4 æ—¶å®Œå…¨è¢«æ·˜æ±°ã€‚</li><li>è¿™æ¬¾è™šæ‹Ÿæœºå†…éƒ¨åªæä¾›è§£é‡Šå™¨ï¼Œæ²¡æœ‰å³æ—¶ç¼–è¯‘å™¨ï¼Œå› æ­¤æ•ˆç‡æ¯”è¾ƒä½ã€‚ã€å³æ—¶ç¼–è¯‘å™¨ä¼šæŠŠçƒ­ç‚¹ä»£ç çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ç¼“å­˜èµ·æ¥ï¼Œé‚£ä¹ˆä»¥åä½¿ç”¨çƒ­ç‚¹ä»£ç çš„æ—¶å€™ï¼Œæ•ˆç‡å°±æ¯”è¾ƒé«˜ã€‘</li><li>å¦‚æœä½¿ç”¨ JIT ç¼–è¯‘å™¨ï¼Œå°±éœ€è¦è¿›è¡Œå¤–æŒ‚ã€‚ä½†æ˜¯ä¸€æ—¦ä½¿ç”¨äº† JIT ç¼–è¯‘å™¨ï¼ŒJIT å°±ä¼šæ¥ç®¡è™šæ‹Ÿæœºçš„æ‰§è¡Œç³»ç»Ÿã€‚è§£é‡Šå™¨å°±ä¸å†å·¥ä½œï¼Œè§£é‡Šå™¨å’Œç¼–è¯‘å™¨ä¸èƒ½é…åˆå·¥ä½œã€‚<ul><li>æˆ‘ä»¬å°†å­—èŠ‚ç æŒ‡ä»¤ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ä¹Ÿæ˜¯éœ€è¦èŠ±æ—¶é—´çš„ï¼Œå¦‚æœåªä½¿ç”¨ JITï¼Œå°±éœ€è¦æŠŠæ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤éƒ½ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ï¼Œå°±ä¼šå¯¼è‡´ç¿»è¯‘æ—¶é—´è¿‡é•¿ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç¨‹åºåˆšå¯åŠ¨çš„æ—¶å€™ï¼Œç­‰å¾…æ—¶é—´ä¼šå¾ˆé•¿ã€‚</li><li>è€Œè§£é‡Šå™¨å°±æ˜¯èµ°åˆ°å“ªï¼Œè§£é‡Šåˆ°å“ªã€‚</li></ul></li><li>ç°åœ¨ Hotspot å†…ç½®äº†æ­¤è™šæ‹Ÿæœºã€‚</li></ol><h4 id="Exact-VM">Exact VM</h4><ol><li><p>ä¸ºäº†è§£å†³ä¸Šä¸€ä¸ªè™šæ‹Ÿæœºé—®é¢˜ï¼Œjdk1.2 æ—¶ï¼ŒSun æä¾›äº†æ­¤è™šæ‹Ÿæœºã€‚</p></li><li><p>Exact Memory Managementï¼šå‡†ç¡®å¼å†…å­˜ç®¡ç†</p><ul><li><p>ä¹Ÿå¯ä»¥å«Non-Conservative/Accurate Memory Management</p></li><li><p>è™šæ‹Ÿæœºå¯ä»¥çŸ¥é“å†…å­˜ä¸­æŸä¸ªä½ç½®çš„æ•°æ®å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p></li></ul></li><li><p>å…·å¤‡ç°ä»£é«˜æ€§èƒ½è™šæ‹Ÿæœºçš„ç»´å½¢</p><ul><li><p>çƒ­ç‚¹æ¢æµ‹ï¼ˆå¯»æ‰¾å‡ºçƒ­ç‚¹ä»£ç è¿›è¡Œç¼“å­˜ï¼‰</p></li><li><p>ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨æ··åˆå·¥ä½œæ¨¡å¼</p></li></ul></li><li><p>åªåœ¨ Solaris å¹³å°çŸ­æš‚ä½¿ç”¨ï¼Œå…¶ä»–å¹³å°ä¸Šè¿˜æ˜¯ classic vmï¼Œè‹±é›„æ°”çŸ­ï¼Œç»ˆè¢« Hotspot è™šæ‹Ÿæœºæ›¿æ¢</p></li></ol><h4 id="HotSpot-VMï¼ˆé‡ç‚¹ï¼‰">HotSpot VMï¼ˆé‡ç‚¹ï¼‰</h4><ol><li><p>HotSpot å†å²</p><ul><li><p>æœ€åˆç”±ä¸€å®¶åä¸ºâ€œLongview Technologiesâ€çš„å°å…¬å¸è®¾è®¡</p></li><li><p>1997å¹´ï¼Œæ­¤å…¬å¸è¢« Sun æ”¶è´­ï¼›2009å¹´ï¼ŒSun å…¬å¸è¢«ç”²éª¨æ–‡æ”¶è´­ã€‚</p></li><li><p>JDK1.3æ—¶ï¼ŒHotSpot VM æˆä¸ºé»˜è®¤è™šæ‹Ÿæœº</p></li></ul></li><li><p>ç›®å‰<strong>Hotspotå æœ‰ç»å¯¹çš„å¸‚åœºåœ°ä½ï¼Œç§°éœ¸æ­¦æ—</strong>ã€‚</p><ul><li><p>ä¸ç®¡æ˜¯ç°åœ¨ä»åœ¨å¹¿æ³›ä½¿ç”¨çš„ JDK6ï¼Œè¿˜æ˜¯ä½¿ç”¨æ¯”ä¾‹è¾ƒå¤šçš„ JDK8 ä¸­ï¼Œé»˜è®¤çš„è™šæ‹Ÿæœºéƒ½æ˜¯ HotSpot</p></li><li><p>Sun/oracle JDK å’Œ openJDK çš„é»˜è®¤è™šæ‹Ÿæœº</p></li><li><p>å› æ­¤æœ¬è¯¾ç¨‹ä¸­é»˜è®¤ä»‹ç»çš„è™šæ‹Ÿæœºéƒ½æ˜¯ HotSpotï¼Œç›¸å…³æœºåˆ¶ä¹Ÿä¸»è¦æ˜¯æŒ‡ HotSpot çš„ GC æœºåˆ¶ã€‚ï¼ˆæ¯”å¦‚å…¶ä»–ä¸¤ä¸ªå•†ç”¨è™šæœºéƒ½æ²¡æœ‰æ–¹æ³•åŒºçš„æ¦‚å¿µï¼‰</p></li></ul></li><li><p>ä»æœåŠ¡å™¨ã€æ¡Œé¢åˆ°ç§»åŠ¨ç«¯ã€åµŒå…¥å¼éƒ½æœ‰åº”ç”¨ã€‚</p></li><li><p>åç§°ä¸­çš„ HotSpot æŒ‡çš„å°±æ˜¯å®ƒçš„çƒ­ç‚¹ä»£ç æ¢æµ‹æŠ€æœ¯ã€‚</p><ul><li><p>é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·ç¼–è¯‘ä»·å€¼ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢</p></li><li><p>é€šè¿‡ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨ååŒå·¥ä½œï¼Œåœ¨æœ€ä¼˜åŒ–çš„ç¨‹åºå“åº”æ—¶é—´ä¸æœ€ä½³æ‰§è¡Œæ€§èƒ½ä¸­å–å¾—å¹³è¡¡</p></li></ul></li></ol><h4 id="JRockitï¼ˆå•†ç”¨ä¸‰å¤§è™šæ‹Ÿæœºä¹‹ä¸€ï¼‰">JRockitï¼ˆå•†ç”¨ä¸‰å¤§è™šæ‹Ÿæœºä¹‹ä¸€ï¼‰</h4><ol><li><p>ä¸“æ³¨äºæœåŠ¡å™¨ç«¯åº”ç”¨ï¼šå®ƒå¯ä»¥ä¸å¤ªå…³æ³¨ç¨‹åºå¯åŠ¨é€Ÿåº¦ï¼Œå› æ­¤JRockitå†…éƒ¨ä¸åŒ…å«è§£æå™¨å®ç°ï¼Œå…¨éƒ¨ä»£ç éƒ½é å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åæ‰§è¡Œã€‚</p></li><li><p>å¤§é‡çš„è¡Œä¸šåŸºå‡†æµ‹è¯•æ˜¾ç¤ºï¼ŒJRockit JVM æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ JVMï¼šä½¿ç”¨ JRockit äº§å“ï¼Œå®¢æˆ·å·²ç»ä½“éªŒåˆ°äº†æ˜¾è‘—çš„æ€§èƒ½æé«˜ï¼ˆä¸€äº›è¶…è¿‡äº†70%ï¼‰å’Œç¡¬ä»¶æˆæœ¬çš„å‡å°‘ï¼ˆè¾¾50%ï¼‰ã€‚</p></li><li><p>ä¼˜åŠ¿ï¼šå…¨é¢çš„Javaè¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ</p><ul><li><p>JRockit é¢å‘å»¶è¿Ÿæ•æ„Ÿå‹åº”ç”¨çš„è§£å†³æ–¹æ¡ˆ JRockit Real Time æä¾›ä»¥æ¯«ç§’æˆ–å¾®ç§’çº§çš„ JVM å“åº”æ—¶é—´ï¼Œé€‚åˆè´¢åŠ¡ã€å†›äº‹æŒ‡æŒ¥ã€ç”µä¿¡ç½‘ç»œçš„éœ€è¦</p></li><li><p>Mission Control æœåŠ¡å¥—ä»¶ï¼Œå®ƒæ˜¯ä¸€ç»„ä»¥æä½çš„å¼€é”€æ¥ç›‘æ§ã€ç®¡ç†å’Œåˆ†æç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚</p></li></ul></li><li><p>2008å¹´ï¼ŒJRockit è¢« Oracle æ”¶è´­ã€‚</p></li><li><p>Oracle è¡¨è¾¾äº†æ•´åˆä¸¤å¤§ä¼˜ç§€è™šæ‹Ÿæœºçš„å·¥ä½œï¼Œå¤§è‡´åœ¨ JDK8 ä¸­å®Œæˆã€‚æ•´åˆçš„æ–¹å¼æ˜¯åœ¨ HotSpot çš„åŸºç¡€ä¸Šï¼Œç§»æ¤ JRockit çš„ä¼˜ç§€ç‰¹æ€§ã€‚</p></li><li><p>é«˜æ–¯æ—ï¼šç›®å‰å°±èŒäºè°·æ­Œï¼Œç ”ç©¶äººå·¥æ™ºèƒ½å’Œæ°´ä¸‹æœºå™¨äºº</p></li></ol><h4 id="IBMçš„J9ï¼ˆå•†ç”¨ä¸‰å¤§è™šæ‹Ÿæœºä¹‹ä¸€ï¼‰">IBMçš„J9ï¼ˆå•†ç”¨ä¸‰å¤§è™šæ‹Ÿæœºä¹‹ä¸€ï¼‰</h4><ol><li><p>å…¨ç§°ï¼šIBM Technology for Java Virtual Machineï¼Œç®€ç§° IT4Jï¼Œå†…éƒ¨ä»£å·ï¼šJ9</p></li><li><p>å¸‚åœºå®šä½ä¸ HotSpot æ¥è¿‘ï¼ŒæœåŠ¡å™¨ç«¯ã€æ¡Œé¢åº”ç”¨ã€åµŒå…¥å¼ç­‰å¤šç”¨é€” VM å¹¿æ³›ç”¨äº IBM çš„å„ç§ Java äº§å“ã€‚</p></li><li><p>ç›®å‰ï¼Œæœ‰å½±å“åŠ›çš„ä¸‰å¤§å•†ç”¨è™šæ‹Ÿæœºä¹‹ä¸€ï¼Œä¹Ÿå·ç§°æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ Java è™šæ‹Ÿæœºã€‚</p></li><li><p>2017å¹´å·¦å³ï¼ŒIBM å‘å¸ƒäº†å¼€æº J9VMï¼Œå‘½åä¸º openJ9ï¼Œäº¤ç»™ Eclipse åŸºé‡‘ä¼šç®¡ç†ï¼Œä¹Ÿç§°ä¸º Eclipse OpenJ9</p></li><li><p>OpenJDK -&gt; æ˜¯ JDK å¼€æºäº†ï¼ŒåŒ…æ‹¬äº†è™šæ‹Ÿæœº</p></li></ol><h4 id="KVMå’ŒCDC-CLDC-Hotspot">KVMå’ŒCDC/CLDC Hotspot</h4><ol><li><p>Oracle åœ¨ Java ME äº§å“çº¿ä¸Šçš„ä¸¤æ¬¾è™šæ‹Ÿæœºä¸ºï¼šCDC/CLDC HotSpot Implementation VM</p></li><li><p>KVMï¼ˆKilobyteï¼‰æ˜¯ CLDC-HI æ—©æœŸäº§å“</p></li><li><p>ç›®å‰ç§»åŠ¨é¢†åŸŸåœ°ä½å°´å°¬ï¼Œæ™ºèƒ½æœºè¢« Android å’Œ iOS äºŒåˆ†å¤©ä¸‹ã€‚</p></li><li><p>KVM ç®€å•ã€è½»é‡ã€é«˜åº¦å¯ç§»æ¤ï¼Œé¢å‘æ›´ä½ç«¯çš„è®¾å¤‡ä¸Šè¿˜ç»´æŒè‡ªå·±çš„ä¸€ç‰‡å¸‚åœº</p><ul><li><p>æ™ºèƒ½æ§åˆ¶å™¨ã€ä¼ æ„Ÿå™¨</p></li><li><p>è€äººæ‰‹æœºã€ç»æµæ¬ å‘è¾¾åœ°åŒºçš„åŠŸèƒ½æ‰‹æœº</p></li></ul></li><li><p>æ‰€æœ‰çš„è™šæ‹Ÿæœºçš„åŸåˆ™ï¼šä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œã€‚</p></li></ol><h4 id="Azul-VM">Azul VM</h4><ol><li>å‰é¢ä¸‰å¤§â€œé«˜æ€§èƒ½ Java è™šæ‹Ÿæœºâ€ä½¿ç”¨åœ¨<strong>é€šç”¨ç¡¬ä»¶å¹³å°ä¸Š</strong></li><li>è¿™é‡Œ Azul VW å’Œ BEA Liquid VM æ˜¯ä¸<strong>ç‰¹å®šç¡¬ä»¶å¹³å°ç»‘å®š</strong>ã€è½¯ç¡¬ä»¶é…åˆçš„ä¸“æœ‰è™šæ‹Ÿæœºï¼šé«˜æ€§èƒ½ Java è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºã€‚</li><li>Azul VM æ˜¯ Azul Systems å…¬å¸åœ¨ HotSpot åŸºç¡€ä¸Šè¿›è¡Œå¤§é‡æ”¹è¿›ï¼Œè¿è¡Œäº Azul Systems å…¬å¸çš„ä¸“æœ‰ç¡¬ä»¶ Vega ç³»ç»Ÿä¸Šçš„ Java è™šæ‹Ÿæœºã€‚</li><li>æ¯ä¸ª Azul VM å®ä¾‹éƒ½å¯ä»¥ç®¡ç†è‡³å°‘æ•°åä¸ª CPU å’Œæ•°ç™¾GBå†…å­˜çš„ç¡¬ä»¶èµ„æºï¼Œå¹¶æä¾›åœ¨å·¨å¤§å†…å­˜èŒƒå›´å†…å®ç°å¯æ§çš„GCæ—¶é—´çš„åƒåœ¾æ”¶é›†å™¨ã€ä¸“æœ‰ç¡¬ä»¶ä¼˜åŒ–çš„çº¿ç¨‹è°ƒåº¦ç­‰ä¼˜ç§€ç‰¹æ€§ã€‚</li><li>2010å¹´ï¼ŒAzul Systems å…¬å¸å¼€å§‹ä»ç¡¬ä»¶è½¬å‘è½¯ä»¶ï¼Œå‘å¸ƒäº†è‡ªå·±çš„ Zing JVMï¼Œå¯ä»¥åœ¨é€šç”¨ x86 å¹³å°ä¸Šæä¾›æ¥è¿‘äº Vega ç³»ç»Ÿçš„ç‰¹æ€§ã€‚</li></ol><h4 id="Liquid-VM">Liquid VM</h4><ol><li>é«˜æ€§èƒ½ Java è™šæ‹Ÿæœºä¸­çš„æˆ˜æ–—æœºã€‚</li><li>BEA å…¬å¸å¼€å‘çš„ï¼Œç›´æ¥è¿è¡Œåœ¨è‡ªå®¶ Hypervisor ç³»ç»Ÿä¸Š</li><li>Liquid VM å³æ˜¯ç°åœ¨çš„ JRockit VEï¼ˆVirtual Editionï¼‰ã€‚<strong>Liquid VM ä¸éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œæˆ–è€…è¯´å®ƒè‡ªå·±æœ¬èº«å®ç°äº†ä¸€ä¸ªä¸“ç”¨æ“ä½œç³»ç»Ÿçš„å¿…è¦åŠŸèƒ½ï¼Œå¦‚çº¿ç¨‹è°ƒåº¦ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œæ”¯æŒç­‰</strong>ã€‚</li><li>éšç€ JRockit è™šæ‹Ÿæœºç»ˆæ­¢å¼€å‘ï¼ŒLiquid VM é¡¹ç›®ä¹Ÿåœæ­¢äº†ã€‚</li></ol><h4 id="Apache-Marmony">Apache Marmony</h4><ol><li><p>Apache ä¹Ÿæ›¾ç»æ¨å‡ºè¿‡ä¸ JDK1.5 å’Œ JDK1.6 å…¼å®¹çš„ Java è¿è¡Œå¹³å° Apache Harmonyã€‚</p></li><li><p>å®ƒæ˜¯ IElf å’Œ Intel è”åˆå¼€å‘çš„å¼€æº JVMï¼Œå—åˆ°åŒæ ·å¼€æºçš„ Open JDK çš„å‹åˆ¶ï¼ŒSun åšå†³ä¸è®© Harmony è·å¾— JCP è®¤è¯ï¼Œæœ€ç»ˆäº 2011 å¹´é€€å½¹ï¼ŒIBM è½¬è€Œå‚ä¸ OpenJDK</p></li><li><p>è™½ç„¶ç›®å‰å¹¶æ²¡æœ‰ Apache Harmony è¢«å¤§è§„æ¨¡å•†ç”¨çš„æ¡ˆä¾‹ï¼Œä½†æ˜¯å®ƒçš„ Java ç±»åº“ä»£ç å¸çº³è¿›äº† Android SDKã€‚</p></li></ol><h4 id="Micorsoft-JVM">Micorsoft JVM</h4><ol><li><p>å¾®è½¯ä¸ºäº†åœ¨ IE3 æµè§ˆå™¨ä¸­æ”¯æŒ Java Appletsï¼Œå¼€å‘äº† Microsoft JVMã€‚</p></li><li><p>åªèƒ½åœ¨ Window å¹³å°ä¸‹è¿è¡Œã€‚ä½†ç¡®æ˜¯å½“æ—¶ Windows ä¸‹æ€§èƒ½æœ€å¥½çš„ Java VMã€‚</p></li><li><p>1997å¹´ï¼ŒSun ä»¥ä¾µçŠ¯å•†æ ‡ã€ä¸æ­£å½“ç«äº‰ç½ªåæŒ‡æ§å¾®è½¯æˆåŠŸï¼Œèµ”äº†Sun å¾ˆå¤šé’±ã€‚å¾®è½¯ WindowsXP SP3 ä¸­æŠ¹æ‰äº†å…¶ VMã€‚ç°åœ¨ Windows ä¸Šå®‰è£…çš„ jdk éƒ½æ˜¯ HotSpotã€‚</p></li></ol><h4 id="Taobao-JVM">Taobao JVM</h4><ol><li><p>ç”± AliJVM å›¢é˜Ÿå‘å¸ƒã€‚é˜¿é‡Œï¼Œå›½å†…ä½¿ç”¨ Java æœ€å¼ºå¤§çš„å…¬å¸ï¼Œè¦†ç›–äº‘è®¡ç®—ã€é‡‘èã€ç‰©æµã€ç”µå•†ç­‰ä¼—å¤šé¢†åŸŸï¼Œéœ€è¦è§£å†³é«˜å¹¶å‘ã€é«˜å¯ç”¨ã€åˆ†å¸ƒå¼çš„å¤åˆé—®é¢˜ã€‚æœ‰å¤§é‡çš„å¼€æºäº§å“ã€‚</p></li><li><p><strong>åŸºäº OpenJDK å¼€å‘äº†è‡ªå·±çš„å®šåˆ¶ç‰ˆæœ¬ AlibabaJDK</strong>ï¼Œç®€ç§° AJDKã€‚æ˜¯æ•´ä¸ªé˜¿é‡Œ Java ä½“ç³»çš„åŸºçŸ³ã€‚</p></li><li><p>åŸºäº OpenJDK Hotspot VM å‘å¸ƒçš„å›½å†…ç¬¬ä¸€ä¸ªä¼˜åŒ–ã€æ·±åº¦å®šåˆ¶ä¸”å¼€æºçš„é«˜æ€§èƒ½æœåŠ¡å™¨ç‰ˆ Java è™šæ‹Ÿæœºã€‚</p><ul><li>åˆ›æ–°çš„ GCIHï¼ˆGCinvisible heapï¼‰æŠ€æœ¯å®ç°äº† off-heapï¼Œ<strong>å³å°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„ Java å¯¹è±¡ä» heap ä¸­ç§»åˆ° heap ä¹‹å¤–ï¼Œå¹¶ä¸” GC ä¸èƒ½ç®¡ç† GCIH å†…éƒ¨çš„ Java å¯¹è±¡ï¼Œä»¥æ­¤è¾¾åˆ°é™ä½ GC çš„å›æ”¶é¢‘ç‡å’Œæå‡ GC çš„å›æ”¶æ•ˆç‡çš„ç›®çš„</strong>ã€‚</li><li>GCIH ä¸­çš„<strong>å¯¹è±¡è¿˜èƒ½å¤Ÿåœ¨å¤šä¸ª Java è™šæ‹Ÿæœºè¿›ç¨‹ä¸­å®ç°å…±äº«</strong></li><li>ä½¿ç”¨ crc32 æŒ‡ä»¤å®ç° JVM intrinsic é™ä½ JNI çš„è°ƒç”¨å¼€é”€</li><li>PMU hardware çš„ Java profiling tool å’Œè¯Šæ–­ååŠ©åŠŸèƒ½</li><li>é’ˆå¯¹å¤§æ•°æ®åœºæ™¯çš„ ZenGC</li></ul></li><li><p>taobao vm åº”ç”¨åœ¨é˜¿é‡Œäº§å“ä¸Šæ€§èƒ½é«˜ï¼Œ<strong>ç¡¬ä»¶ä¸¥é‡ä¾èµ– inte1 çš„ cpuï¼ŒæŸå¤±äº†å…¼å®¹æ€§ï¼Œä½†æé«˜äº†æ€§èƒ½</strong></p></li></ol><ul><li>ç›®å‰å·²ç»åœ¨æ·˜å®ã€å¤©çŒ«ä¸Šçº¿ï¼ŒæŠŠ Oracle å®˜æ–¹ JVM ç‰ˆæœ¬å…¨éƒ¨æ›¿æ¢äº†ã€‚</li></ul><h4 id="Dalvik-VM">Dalvik VM</h4><ol><li><p>è°·æ­Œå¼€å‘çš„ï¼Œåº”ç”¨äº Android ç³»ç»Ÿï¼Œå¹¶åœ¨ Android2.2 ä¸­æä¾›äº† JITï¼Œå‘å±•è¿…çŒ›ã€‚</p></li><li><p><strong>Dalvik VM åªèƒ½ç§°ä½œè™šæ‹Ÿæœºï¼Œè€Œä¸èƒ½ç§°ä½œâ€œJavaè™šæ‹Ÿæœºâ€</strong>ï¼Œå®ƒæ²¡æœ‰éµå¾ª Java è™šæ‹Ÿæœºè§„èŒƒ</p></li><li><p>ä¸èƒ½ç›´æ¥æ‰§è¡Œ Java çš„ Class æ–‡ä»¶</p></li><li><p>åŸºäºå¯„å­˜å™¨æ¶æ„ï¼Œä¸æ˜¯ jvm çš„æ ˆæ¶æ„ã€‚</p></li><li><p>æ‰§è¡Œçš„æ˜¯ç¼–è¯‘ä»¥åçš„ dexï¼ˆDalvik Executableï¼‰æ–‡ä»¶ã€‚æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p></li></ol><ul><li>å®ƒæ‰§è¡Œçš„ dexï¼ˆDalvik Executableï¼‰æ–‡ä»¶å¯ä»¥é€šè¿‡ class æ–‡ä»¶è½¬åŒ–è€Œæ¥ï¼Œä½¿ç”¨ Java è¯­æ³•ç¼–å†™åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¤§éƒ¨åˆ†çš„ Java API ç­‰ã€‚</li></ul><ol start="7"><li>Android 5.0 ä½¿ç”¨æ”¯æŒæå‰ç¼–è¯‘ï¼ˆAhead of Time Compilationï¼ŒAoTï¼‰çš„ ART VM æ›¿æ¢ Dalvik VMã€‚</li></ol><h4 id="Graal-VMï¼ˆæœªæ¥è™šæ‹Ÿæœºï¼‰">Graal VMï¼ˆæœªæ¥è™šæ‹Ÿæœºï¼‰</h4><ol><li><p>2018å¹´4æœˆï¼ŒOracle Labs å…¬å¼€äº† GraalvMï¼Œå·ç§° â€œ<strong>Run Programs Faster Anywhere</strong>â€ï¼Œå‹ƒå‹ƒé‡å¿ƒã€‚ä¸1995å¹´javaçš„â€write onceï¼Œrun anywhere&quot;é¥ç›¸å‘¼åº”ã€‚</p></li><li><p>GraalVM åœ¨ HotSpot VM åŸºç¡€ä¸Šå¢å¼ºè€Œæˆçš„**è·¨è¯­è¨€å…¨æ ˆè™šæ‹Ÿæœºï¼Œå¯ä»¥ä½œä¸ºâ€œä»»ä½•è¯­è¨€â€**çš„è¿è¡Œå¹³å°ä½¿ç”¨ã€‚è¯­è¨€åŒ…æ‹¬ï¼šJavaã€Scalaã€Groovyã€Kotlinï¼›Cã€C++ã€Javascriptã€Rubyã€Pythonã€Rç­‰</p></li><li><p>æ”¯æŒä¸åŒè¯­è¨€ä¸­æ··ç”¨å¯¹æ–¹çš„æ¥å£å’Œå¯¹è±¡ï¼Œæ”¯æŒè¿™äº›è¯­è¨€ä½¿ç”¨å·²ç»ç¼–å†™å¥½çš„æœ¬åœ°åº“æ–‡ä»¶</p></li><li><p>å·¥ä½œåŸç†æ˜¯å°†è¿™äº›è¯­è¨€çš„æºä»£ç æˆ–æºä»£ç ç¼–è¯‘åçš„ä¸­é—´æ ¼å¼ï¼Œé€šè¿‡è§£é‡Šå™¨è½¬æ¢ä¸ºèƒ½è¢« Graal VM æ¥å—çš„ä¸­é—´è¡¨ç¤ºã€‚Graal VM æä¾› Truffle å·¥å…·é›†å¿«é€Ÿæ„å»ºé¢å‘ä¸€ç§æ–°è¯­è¨€çš„è§£é‡Šå™¨ã€‚åœ¨è¿è¡Œæ—¶è¿˜èƒ½è¿›è¡Œå³æ—¶ç¼–è¯‘ä¼˜åŒ–ï¼Œè·å¾—æ¯”åŸç”Ÿç¼–è¯‘å™¨æ›´ä¼˜ç§€çš„æ‰§è¡Œæ•ˆç‡ã€‚</p></li><li><p><strong>å¦‚æœè¯´ HotSpot æœ‰ä¸€å¤©çœŸçš„è¢«å–ä»£ï¼ŒGraalvm å¸Œæœ›æœ€å¤§</strong>ã€‚ä½†æ˜¯ Java çš„è½¯ä»¶ç”Ÿæ€æ²¡æœ‰ä¸æ¯«å˜åŒ–ã€‚</p></li></ol><h3 id="æ€»ç»“">æ€»ç»“</h3><p>å…·ä½“JVMçš„å†…å­˜ç»“æ„ï¼Œå…¶å®å–å†³äºå…¶å®ç°ï¼Œä¸åŒå‚å•†çš„ JVMï¼Œæˆ–è€…åŒä¸€å‚å•†å‘å¸ƒçš„ä¸åŒç‰ˆæœ¬ï¼Œéƒ½æœ‰å¯èƒ½å­˜åœ¨ä¸€å®šå·®å¼‚ã€‚ä¸»è¦ä»¥ Oracle HotSpot VM ä¸ºé»˜è®¤è™šæ‹Ÿæœºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-mindmap</title>
      <link href="/2023/12/13/hexo-mindmap/"/>
      <url>/2023/12/13/hexo-mindmap/</url>
      
        <content type="html"><![CDATA[<h2 id="Hexoç»˜åˆ¶æ€ç»´å¯¼å›¾">Hexoç»˜åˆ¶æ€ç»´å¯¼å›¾</h2><p><a href="https://github.com/MaxChang3/hexo-markmap/blob/main/README_HANS.md">hexo-markmap/GitHubé“¾æ¥</a></p><h4 id="æ’ä»¶å®‰è£…">æ’ä»¶å®‰è£…</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-markmap <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼</h4><pre class="line-numbers language-null" data-language="null"><code class="language-null">&#123;% markmap height [depth] %&#125;- markmap  - Demo    - [é“¾æ¥](http:&#x2F;&#x2F;localhost:4000&#x2F;2023&#x2F;12&#x2F;13&#x2F;hexo-mindmap&#x2F;)    - **inline** ~~text~~ *styles*    - multiline      content    - HTML code is quite long          - [æ ‡ç­¾é“¾æ¥](#æ ‡ç­¾é“¾æ¥)- links- **inline** ~~text~~ *styles*- multiline  text- &#96;inline code&#96;&#123;% endmarkmap %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="markmap-container" style="height:height">  <svg data="{&quot;t&quot;:&quot;root&quot;,&quot;d&quot;:0,&quot;v&quot;:&quot;&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[0,1]},&quot;v&quot;:&quot;markmap&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;Demo&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;&lt;a href=\&quot;http://localhost:4000/2023/12/13/hexo-mindmap/\&quot;&gt;é“¾æ¥&lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;&lt;strong&gt;inline&lt;/strong&gt; &lt;del&gt;text&lt;/del&gt; &lt;em&gt;styles&lt;/em&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[4,6]},&quot;v&quot;:&quot;multiline&lt;br&gt;\ncontent&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;HTML code is quite long&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;links&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;&lt;strong&gt;inline&lt;/strong&gt; &lt;del&gt;text&lt;/del&gt; &lt;em&gt;styles&lt;/em&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[9,11]},&quot;v&quot;:&quot;multiline&lt;br&gt;\ntext&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;&lt;code&gt;inline code&lt;/code&gt;&quot;}],&quot;p&quot;:{}}"></svg></div><h6 id="æ ‡ç­¾é“¾æ¥"><strong>æ ‡ç­¾é“¾æ¥</strong></h6><h4 id="ä¼˜åŒ–">ä¼˜åŒ–</h4><p>ç”±äºæ­¤ä¸»é¢˜æ˜¯æ— è¾¹ç•Œçš„, æœ‰æ—¶å€™æƒ³æ»šåŠ¨é¡µé¢, ç»“æœè¿›å…¥è„‘å›¾å°±ä¼šè¿›è¡Œæ”¾å¤§ç¼©å°, å› æ­¤ç»™è„‘å›¾å¢åŠ è¾¹ç•Œ</p><ol><li>å…¨å±€æœç´¢<code>.markmap-container svg</code> ä½ç½®åœ¨ <code>themes/xxx/source/css/dark.css</code></li><li>åœ¨è¯¥æ–‡ä»¶æ·»åŠ å¦‚ä¸‹</li></ol><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.markmap-container svg</span> <span class="token punctuation">&#123;</span>    <span class="token property">border</span><span class="token punctuation">:</span> 1px dotted #1a97a8<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="Hexoå®ç°é“¾æ¥è·³è½¬">Hexoå®ç°é“¾æ¥è·³è½¬</h2><h4 id="å½“å‰æ–‡ç« é”šç‚¹è·³è½¬">å½“å‰æ–‡ç« é”šç‚¹è·³è½¬</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">[è‡ªå®šä¹‰æ–‡æœ¬](#æ ‡ç­¾é“¾æ¥)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="#%E6%A0%87%E7%AD%BE%E9%93%BE%E6%8E%A5">è‡ªå®šä¹‰æ–‡æœ¬</a></p><h4 id="ç«™å†…æ–‡ç« è·³è½¬">ç«™å†…æ–‡ç« è·³è½¬</h4><p><a href="https://hexo.io/zh-cn/docs/tag-plugins#%E5%BC%95%E7%94%A8%E6%96%87%E7%AB%A0">å®˜ç½‘æ–¹å¼</a></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&#123;% post_link filename [title] [escape] %&#125;&#123;% post_link design-pattern-structural2 design-pattern-structural2 %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="ç«™å†…æ–‡ç« æ ‡é¢˜è·³è½¬">ç«™å†…æ–‡ç« æ ‡é¢˜è·³è½¬</h4><pre class="line-numbers language-htnl" data-language="htnl"><code class="language-htnl">&lt;a href&#x3D;&quot;&#123;% post_path filename(ä¸è¦åç¼€) %&#125;#ç« èŠ‚å&quot;&gt;escape&lt;&#x2F;a&gt;&lt;a href&#x3D;&quot;&#123;% post_path jvm-sgg7 %&#125;#1-å¯¹è±¡çš„å®ä¾‹åŒ–&quot;&gt;é“¾æ¥&lt;&#x2F;a&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„</p><p><code>#ç« èŠ‚å</code>å¤„è‹±æ–‡å­—æ¯è¦å…¨å°å†™ï¼Œç©ºæ ¼è¦è½¬æ¢ä¸º<code>-</code></p></blockquote><h6 id="æˆ‘æ˜¯ä¸€ä¸ªæ ‡ç­¾">æˆ‘æ˜¯ä¸€ä¸ªæ ‡ç­¾</h6>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°</title>
      <link href="/2023/12/13/jvm-note/"/>
      <url>/2023/12/13/jvm-note/</url>
      
        <content type="html"><![CDATA[<h2 id="JVM-å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°">JVM-å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°</h2><div class="markmap-container" style="height:height">  <svg data="{&quot;t&quot;:&quot;root&quot;,&quot;d&quot;:0,&quot;v&quot;:&quot;&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;å­—èŠ‚ç æ–‡ä»¶æ˜¯è·¨å¹³å°çš„å—&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[3,4],&quot;f&quot;:true},&quot;v&quot;:&quot;classæ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆ?&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[5,6],&quot;f&quot;:true},&quot;v&quot;:&quot;èƒ½ä»‹ç»ä¸‹ç”Ÿæˆclassæ–‡ä»¶çš„ç¼–è¯‘å™¨å—&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[7,8],&quot;f&quot;:true},&quot;v&quot;:&quot;javacç¼–è¯‘å™¨çš„ç¼–è¯‘æ­¥éª¤&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[9,10],&quot;f&quot;:true},&quot;v&quot;:&quot;ç›®å‰å‰ç«¯ç¼–è¯‘å™¨çš„å±€é™æ€§&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;&lt;a href=\&quot;#å“ªäº›ç±»å‹å¯¹åº”æœ‰Classå¯¹è±¡\&quot;&gt;å“ªäº›ç±»å‹å¯¹åº”æœ‰Classå¯¹è±¡? &lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;å­—èŠ‚ç æŒ‡ä»¤&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[15,16],&quot;f&quot;:true},&quot;v&quot;:&quot;&lt;a href=\&quot;#ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤\&quot;&gt;ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤&lt;/a&gt;&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[16,17],&quot;f&quot;:true},&quot;v&quot;:&quot;&lt;a href=\&quot;\&quot;&gt;ä¸ºä»€ä¹ˆè¦æ‡‚å­—èŠ‚ç æŒ‡ä»¤? &lt;/a&gt;&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;å¦‚ä½•è§£è¯»classæ–‡ä»¶&quot;}],&quot;p&quot;:{}}"></svg></div><h6 id="å“ªäº›ç±»å‹å¯¹åº”æœ‰Classå¯¹è±¡">å“ªäº›ç±»å‹å¯¹åº”æœ‰Classå¯¹è±¡</h6><blockquote><ol><li><p>class:</p><p>å¤–éƒ¨ç±», æˆå‘˜(æˆå‘˜å†…éƒ¨ç±», é™æ€å†…éƒ¨ç±»), å±€éƒ¨å†…éƒ¨ç±», åŒ¿åå†…éƒ¨ç±»</p></li><li><p>interface: æ¥å£</p></li><li><p>[ ] : æ•°ç»„</p></li><li><p>enum: æšä¸¾</p></li><li><p>annotation: æ³¨è§£@interface</p></li><li><p>primitive type: åŸºæœ¬æ•°æ®ç±»å‹</p></li><li><p>void</p></li></ol></blockquote><h6 id="ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤">ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤</h6><blockquote><p>ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤(byte code)</p><p>Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±<strong>ä¸€ä¸ªå­—èŠ‚</strong>é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„<strong>æ“ä½œç </strong>(opcode)<br>ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•°çš„<strong>æ“ä½œæ•°</strong>(operand)æ‰€æ„æˆ.<br>è™šæ‹Ÿæœºä¸­è®¸å¤šæŒ‡ä»¤å¹¶ä¸åŒ…å«æ“ä½œæ•°, åªæœ‰ä¸€ä¸ªæ“ä½œç .</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mail-demo</title>
      <link href="/2023/12/09/mail-demo/"/>
      <url>/2023/12/09/mail-demo/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¾èµ–">ä¾èµ–</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-mail<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">mail</span><span class="token punctuation">:</span>    <span class="token comment">#é…ç½®smtpæœåŠ¡ä¸»æœºåœ°å€</span>    <span class="token comment"># qqé‚®ç®±ä¸ºsmtp.qq.com          ç«¯å£å·465æˆ–587</span>    <span class="token comment"># sina    smtp.sina.cn</span>    <span class="token comment"># aliyun  smtp.aliyun.com</span>    <span class="token comment"># 163     smtp.163.com       ç«¯å£å·465æˆ–994</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> smtp.qq.com    <span class="token comment">#å‘é€è€…é‚®ç®±</span>    <span class="token key atrule">username</span><span class="token punctuation">:</span> xxxxxxxx@qq.com    <span class="token comment">#é…ç½®å¯†ç ,æ³¨æ„ä¸æ˜¯çœŸæ­£çš„å¯†ç ï¼Œè€Œæ˜¯åˆšåˆšç”³è¯·åˆ°çš„æˆæƒç </span>    <span class="token key atrule">password</span><span class="token punctuation">:</span> axloxxxxxxfqbdgc    <span class="token comment">#ç«¯å£å·465æˆ–587</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">587</span>    <span class="token comment">#é»˜è®¤çš„é‚®ä»¶ç¼–ç ä¸ºUTF-8</span>    <span class="token key atrule">default-encoding</span><span class="token punctuation">:</span> UTF<span class="token punctuation">-</span><span class="token number">8</span>    <span class="token comment">#å…¶ä»–å‚æ•°</span>    <span class="token key atrule">properties</span><span class="token punctuation">:</span>      <span class="token key atrule">mail</span><span class="token punctuation">:</span>        <span class="token comment">#é…ç½®SSL åŠ å¯†å·¥å‚</span>        <span class="token key atrule">smtp</span><span class="token punctuation">:</span>          <span class="token key atrule">ssl</span><span class="token punctuation">:</span>            <span class="token comment">#æœ¬åœ°æµ‹è¯•ï¼Œå…ˆæ”¾å¼€ssl</span>            <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>            <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>          <span class="token comment">#å¼€å¯debugæ¨¡å¼ï¼Œè¿™æ ·é‚®ä»¶å‘é€è¿‡ç¨‹çš„æ—¥å¿—ä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿æ’æŸ¥é”™è¯¯</span>        <span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="mailå·¥å…·ç±»">mailå·¥å…·ç±»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileSystemResource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>javamail<span class="token punctuation">.</span></span><span class="token class-name">JavaMailSenderImpl</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>javamail<span class="token punctuation">.</span></span><span class="token class-name">MimeMessageHelper</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>mail<span class="token punctuation">.</span></span><span class="token class-name">MessagingException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span><span class="token comment">/** * é‚®ä»¶ä¸šåŠ¡ç±» * @author qzz */</span><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * æ³¨å…¥é‚®ä»¶å·¥å…·ç±»     */</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">JavaMailSenderImpl</span> javaMailSender<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;spring.mail.username&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sendMailer<span class="token punctuation">;</span>    <span class="token comment">/**     * æ£€æµ‹é‚®ä»¶ä¿¡æ¯ç±»     * @param to æ”¶ä»¶äºº     * @param subject ä¸»é¢˜     * @param text æ–‡æœ¬     */</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkMail</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span><span class="token class-name">String</span> text<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"é‚®ä»¶æ”¶ä¿¡äººä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"é‚®ä»¶ä¸»é¢˜ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"é‚®ä»¶å†…å®¹ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * å‘é€çº¯æ–‡æœ¬é‚®ä»¶     * @param to æ”¶ä»¶äºº     * @param subject ä¸»é¢˜     * @param text æ–‡æœ¬     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendTextMailMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span><span class="token class-name">String</span> text<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//true ä»£è¡¨æ”¯æŒå¤æ‚çš„ç±»å‹</span>            <span class="token class-name">MimeMessageHelper</span> mimeMessageHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeMessageHelper</span><span class="token punctuation">(</span>javaMailSender<span class="token punctuation">.</span><span class="token function">createMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å‘ä¿¡äºº</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span>sendMailer<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶æ”¶ä¿¡äºº  1æˆ–å¤šä¸ª</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶ä¸»é¢˜</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å†…å®¹</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å‘é€æ—¶é—´</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setSentDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å‘é€é‚®ä»¶</span>            javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>mimeMessageHelper<span class="token punctuation">.</span><span class="token function">getMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‘é€é‚®ä»¶æˆåŠŸ: &#123;&#125; -> &#123;&#125;"</span><span class="token punctuation">,</span> sendMailer<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MessagingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"å‘é€é‚®ä»¶å¤±è´¥: &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * å‘é€htmlé‚®ä»¶     * @param to æ”¶ä»¶äºº     * @param subject ä¸»é¢˜     * @param content é‚®ä»¶å†…å®¹     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendHtmlMailMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span><span class="token class-name">String</span> content<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        content<span class="token operator">=</span><span class="token string">"&lt;!DOCTYPE html>\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;html>\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;head>\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;meta charset=\"utf-8\">\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;title>é‚®ä»¶&lt;/title>\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;/head>\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;body>\n"</span> <span class="token operator">+</span>                <span class="token string">"\t&lt;h3>è¿™æ˜¯ä¸€å°HTMLé‚®ä»¶ï¼&lt;/h3>\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;/body>\n"</span> <span class="token operator">+</span>                <span class="token string">"&lt;/html>"</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//true ä»£è¡¨æ”¯æŒå¤æ‚çš„ç±»å‹</span>            <span class="token class-name">MimeMessageHelper</span> mimeMessageHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeMessageHelper</span><span class="token punctuation">(</span>javaMailSender<span class="token punctuation">.</span><span class="token function">createMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å‘ä¿¡äºº</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span>sendMailer<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶æ”¶ä¿¡äºº  1æˆ–å¤šä¸ª</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶ä¸»é¢˜</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å†…å®¹   true ä»£è¡¨æ”¯æŒhtml</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å‘é€æ—¶é—´</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setSentDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å‘é€é‚®ä»¶</span>            javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>mimeMessageHelper<span class="token punctuation">.</span><span class="token function">getMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‘é€é‚®ä»¶æˆåŠŸ: &#123;&#125; -> &#123;&#125;"</span><span class="token punctuation">,</span> sendMailer<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MessagingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"å‘é€é‚®ä»¶å¤±è´¥: &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶     * @param to      é‚®ä»¶æ”¶ä¿¡äºº     * @param subject é‚®ä»¶ä¸»é¢˜     * @param content é‚®ä»¶å†…å®¹     * @param filePath é™„ä»¶è·¯å¾„     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendAttachmentMailMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">to</span><span class="token punctuation">,</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span><span class="token class-name">String</span> content<span class="token punctuation">,</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//true ä»£è¡¨æ”¯æŒå¤æ‚çš„ç±»å‹</span>            <span class="token class-name">MimeMessageHelper</span> mimeMessageHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeMessageHelper</span><span class="token punctuation">(</span>javaMailSender<span class="token punctuation">.</span><span class="token function">createMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å‘ä¿¡äºº</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span>sendMailer<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶æ”¶ä¿¡äºº  1æˆ–å¤šä¸ª</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶ä¸»é¢˜</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å†…å®¹   true ä»£è¡¨æ”¯æŒhtml</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é‚®ä»¶å‘é€æ—¶é—´</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">setSentDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//æ·»åŠ é‚®ä»¶é™„ä»¶</span>            <span class="token class-name">FileSystemResource</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemResource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            mimeMessageHelper<span class="token punctuation">.</span><span class="token function">addAttachment</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å‘é€é‚®ä»¶</span>            javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>mimeMessageHelper<span class="token punctuation">.</span><span class="token function">getMimeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‘é€é‚®ä»¶æˆåŠŸ: &#123;&#125; -> &#123;&#125;"</span><span class="token punctuation">,</span> sendMailer<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MessagingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"å‘é€é‚®ä»¶å¤±è´¥: &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•ç±»">æµ‹è¯•ç±»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Resource</span><span class="token keyword">private</span> <span class="token class-name">MailService</span> mailService<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">void</span> <span class="token function">test08</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    mailService<span class="token punctuation">.</span><span class="token function">sendTextMailMessage</span><span class="token punctuation">(</span><span class="token string">"xxxxx@qq.com"</span><span class="token punctuation">,</span> <span class="token string">"æµ‹è¯•æ ‡é¢˜"</span><span class="token punctuation">,</span> <span class="token string">"ç”¨æ¥æµ‹è¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>service-register</title>
      <link href="/2023/10/26/service-register/"/>
      <url>/2023/10/26/service-register/</url>
      
        <content type="html"><![CDATA[<h1>æœåŠ¡æ³¨å†Œ</h1><h2 id="Linux">Linux</h2><h3 id="æœåŠ¡æ–‡ä»¶è·¯å¾„">æœåŠ¡æ–‡ä»¶è·¯å¾„</h3><ul><li>/lib/systemd/system/</li><li>/usr/lib/systemd/system/</li></ul><p><code>systemctl daemon-reload</code></p><h3 id="Nginxæ¡ˆä¾‹">Nginxæ¡ˆä¾‹</h3><h4 id="é…ç½®æ–‡ä»¶-nginx-service">é…ç½®æ–‡ä»¶ nginx.service</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span><span class="token assign-left variable">Description</span><span class="token operator">=</span>nginx - web server<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target remote-fs.target nss-lookup.target<span class="token punctuation">[</span>Service<span class="token punctuation">]</span><span class="token assign-left variable">Type</span><span class="token operator">=</span>forking<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/usr/local/nginx/logs/nginx.pid<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-t</span> <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> reload<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> stop<span class="token assign-left variable">ExecQuit</span><span class="token operator">=</span>/usr/local/nginx/sbin/nginx <span class="token parameter variable">-s</span> quit<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true<span class="token punctuation">[</span>Install<span class="token punctuation">]</span><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ³¨å†Œè„šæœ¬-å‚è€ƒ">æ³¨å†Œè„šæœ¬(å‚è€ƒ)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment">## -bash: ./initdee.sh: /bin/bash^M: bad interpreter: No such file or directory</span><span class="token comment">## vimæˆ–è€…viçš„å‘½ä»¤æ¨¡å¼ä¸‹, è¾“å…¥å‘½ä»¤ set ff=unix å³å¯è§£å†³æ¢è¡Œé—®é¢˜</span><span class="token builtin class-name">cd</span> /root<span class="token comment"># æ­¤å¤„æ˜¯nginxä½ç½®</span><span class="token assign-left variable">nginxdir</span><span class="token operator">=</span><span class="token string">'/usr/local/nginx'</span><span class="token function">touch</span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'[Unit]'</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'Description=nginx - web server'</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'After=network.target remote-fs.target nss-lookup.target'</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'[Service]'</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'Type=forking'</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">"PIDFile=<span class="token variable">$nginxdir</span>/logs/nginx.pid"</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecStartPre=<span class="token variable">$nginxdir</span>/sbin/nginx -t -c <span class="token variable">$nginxdir</span>/conf/nginx.conf"</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecStart=<span class="token variable">$nginxdir</span>/sbin/nginx -c <span class="token variable">$nginxdir</span>/conf/nginx.conf"</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecReload=<span class="token variable">$nginxdir</span>/sbin/nginx -s reload"</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecStop=<span class="token variable">$nginxdir</span>/sbin/nginx -s stop"</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecQuit=<span class="token variable">$nginxdir</span>/sbin/nginx -s quit"</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'PrivateTmp=true'</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'[Install]'</span> <span class="token operator">>></span> nginx.service<span class="token builtin class-name">echo</span> <span class="token string">'WantedBy=multi-user.target'</span> <span class="token operator">>></span> nginx.service<span class="token function">mv</span> nginx.service /usr/lib/systemd/system<span class="token builtin class-name">unset</span> nginxdirsystemctl daemon-reloadsystemctl <span class="token builtin class-name">enable</span> nginx.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Redisæ¡ˆä¾‹">Redisæ¡ˆä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment">## -bash: ./initdee.sh: /bin/bash^M: bad interpreter: No such file or directory</span><span class="token comment">## vimæˆ–è€…viçš„å‘½ä»¤æ¨¡å¼ä¸‹, è¾“å…¥å‘½ä»¤ set ff=unix å³å¯è§£å†³æ¢è¡Œé—®é¢˜</span><span class="token builtin class-name">cd</span> /usr/local/redis*<span class="token assign-left variable">redisdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span><span class="token function">touch</span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'[Unit]'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'Description=Redis'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'After=syslog.target network.target remote-fs.target nss-lookup.target'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'[Service]'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'Type=forking'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'PIDFile=/var/run/redis_6379.pid'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecStart=<span class="token variable">$redisdir</span>/src/redis-server <span class="token variable">$redisdir</span>/redis.conf"</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecReload=<span class="token variable">$redisdir</span>/src/redis-server -s reload"</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">"ExecStop=<span class="token variable">$redisdir</span>/src/redis-server -s stop"</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'PrivateTmp=true'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'[Install]'</span> <span class="token operator">>></span> redis.service<span class="token builtin class-name">echo</span> <span class="token string">'WantedBy=multi-user.target'</span> <span class="token operator">>></span> redis.service<span class="token function">mv</span> redis.service /usr/lib/systemd/systemsystemctl daemon-reloadsystemctl <span class="token builtin class-name">enable</span> redis.service<span class="token comment">## ä¿®æ”¹redis.conf </span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/daemonize no/daemonize yes/g'</span> redis.conf<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/# supervised auto/supervised auto/g'</span> redis.conf<span class="token builtin class-name">cd</span> ~<span class="token builtin class-name">unset</span> redisdir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Javaé¡¹ç›®æ¡ˆä¾‹-åŠ¨æ€æ³¨å†Œ">Javaé¡¹ç›®æ¡ˆä¾‹(åŠ¨æ€æ³¨å†Œ)</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment">## -bash: ./initdee.sh: /bin/bash^M: bad interpreter: No such file or directory</span><span class="token comment">## vimæˆ–è€…viçš„å‘½ä»¤æ¨¡å¼ä¸‹, è¾“å…¥å‘½ä»¤ set ff=unix å³å¯è§£å†³æ¢è¡Œé—®é¢˜</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Windows">Windows</h2><p>æœ¬æ¡ˆä¾‹é‡‡å–winsw, å¹¶ä¸”é€šè¿‡<code>bat</code>è„šæœ¬è¿›è¡ŒæœåŠ¡çš„ç®¡ç†. ä¹Ÿå¯ä»¥é€šè¿‡æœåŠ¡ç®¡ç†å™¨è¿›è¡Œç®¡ç†</p><h3 id="æ‰€éœ€æ–‡ä»¶">æ‰€éœ€æ–‡ä»¶</h3><ol><li><code>winsw.exe</code> å¯åŠ¨æ–‡ä»¶</li><li><code>winsw.xml</code> é…ç½®æ–‡ä»¶</li></ol><h3 id="java-é¡¹ç›®æ¡ˆä¾‹">java é¡¹ç›®æ¡ˆä¾‹</h3><h4 id="æ³¨å†ŒæœåŠ¡">æ³¨å†ŒæœåŠ¡</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo Sentinel ä¸€é”®å®‰è£…ç¨‹åºecho -----------------------%~d0cd %~dp0echo Sentinelå®‰è£…æœåŠ¡ä¸­winsw installecho Sentinelå®‰è£…å®Œæˆpause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo Sentinel ä¸€é”®å¯åŠ¨ç¨‹åºecho ----------------------- net start Sentinelpause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å…³é—­æœåŠ¡">å…³é—­æœåŠ¡</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo Sentinel ä¸€é”®å…³é—­echo -----------------------:: æ­¤å¤„æ˜¯æœåŠ¡ånet stop Sentinelpause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¸è½½æœåŠ¡">å¸è½½æœåŠ¡</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo saddyfire Sentinel ä¸€é”®å¸è½½ç¨‹åºecho -----------------------%~d0cd %~dp0echo Sentinelå¸è½½æœåŠ¡ä¸­winsw uninstallecho Sentinelå¸è½½å®Œæˆpause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é…ç½®æ–‡ä»¶-xml">é…ç½®æ–‡ä»¶ xml</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- æŒ‡å®šåœ¨Windowsç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„è¯†åˆ«æœåŠ¡çš„IDã€‚åœ¨ç³»ç»Ÿä¸­å®‰è£…çš„æ‰€æœ‰æœåŠ¡ä¸­ï¼Œè¿™å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå®ƒåº”è¯¥å®Œå…¨ç”±å­—æ¯æ•°å­—å­—ç¬¦ç»„æˆ --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>Sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>   <span class="token comment">&lt;!-- æœåŠ¡çš„ç®€çŸ­åç§°ï¼Œå®ƒå¯ä»¥åŒ…å«ç©ºæ ¼å’Œå…¶ä»–å­—ç¬¦ã€‚å°½é‡ç®€çŸ­ï¼Œå°±åƒâ€œidâ€ä¸€æ ·ï¼Œåœ¨ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡åç§°ä¸­ï¼Œä¹Ÿè¦ä¿æŒå”¯ä¸€ --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>Sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- è¯¥æœåŠ¡å¯è¯»æè¿°ã€‚å½“é€‰ä¸­è¯¥æœåŠ¡æ—¶ï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨WindowsæœåŠ¡ç®¡ç†å™¨ä¸­ --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>Sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- ç¯å¢ƒå˜é‡è®¾ç½® --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JAVA_HOME<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%JAVA_HOME%<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token comment">&lt;!-- å¯åŠ¨æ–¹å¼: å¼€æœºè‡ªå¯ --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>startmode</span><span class="token punctuation">></span></span>Automatic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>startmode</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- å¯æ‰§è¡Œæ–‡ä»¶ä¼ é€’çš„å‚æ•° --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arguments</span><span class="token punctuation">></span></span>-Xrs -Xmx256m -jar "%BASE%\sentinel-dashboard-1.8.1.jar"  --server.port=9999<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arguments</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- è¯¥å…ƒç´ æŒ‡å®šè¦å¯åŠ¨çš„å¯æ‰§è¡Œæ–‡ä»¶ --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executable</span><span class="token punctuation">></span></span>java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executable</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- æ—¥å¿—è¾“å‡ºä½ç½® --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logmode</span><span class="token punctuation">></span></span>rotate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logmode</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="nacosæœåŠ¡æ¡ˆä¾‹">nacosæœåŠ¡æ¡ˆä¾‹</h3><h4 id="æœåŠ¡æ³¨å†Œ">æœåŠ¡æ³¨å†Œ</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo nacos ä¸€é”®å®‰è£…ç¨‹åºecho -----------------------%~d0cd %~dp0:: å¤åˆ¶winsw.exeè‡³ \binxcopy &#x2F;Y &#x2F;E &#x2F;i winsw.exe ..\bin\:: å¤åˆ¶winsw.xml é…ç½®æ–‡ä»¶è‡³ \bincopy &#x2F;Y winsw.xml ..\bin\:: è¿›å…¥ \bincd ..\bin\echo saddyfireå®‰è£…æœåŠ¡ä¸­winsw installecho saddyfireå®‰è£…å®Œæˆpause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¯åŠ¨æœåŠ¡-2">å¯åŠ¨æœåŠ¡</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo saddyfire 666 ä¸€é”®å¯åŠ¨ç¨‹åºecho ----------------------- net start Nacospause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å…³é—­æœåŠ¡-2">å…³é—­æœåŠ¡</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo saddyfire 666 ä¸€é”®å…³é—­echo -----------------------:: æ­¤å¤„æ˜¯æœåŠ¡ånet stop Nacospause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¸è½½æœåŠ¡-2">å¸è½½æœåŠ¡</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo offecho -----------------------echo saddyfire 666 ä¸€é”®å¸è½½ç¨‹åºecho -----------------------%~d0cd %~dp0echo Nacoså¸è½½æœåŠ¡ä¸­winsw uninstallecho Nacoså¸è½½å®Œæˆpause<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é…ç½®æ–‡ä»¶-xml-2">é…ç½®æ–‡ä»¶ xml</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æŒ‡å®šåœ¨Windowsç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„è¯†åˆ«æœåŠ¡çš„IDã€‚åœ¨ç³»ç»Ÿä¸­å®‰è£…çš„æ‰€æœ‰æœåŠ¡ä¸­ï¼Œè¿™å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå®ƒåº”è¯¥å®Œå…¨ç”±å­—æ¯æ•°å­—å­—ç¬¦ç»„æˆ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>Nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æœåŠ¡çš„ç®€çŸ­åç§°ï¼Œå®ƒå¯ä»¥åŒ…å«ç©ºæ ¼å’Œå…¶ä»–å­—ç¬¦ã€‚å°½é‡ç®€çŸ­ï¼Œå°±åƒâ€œidâ€ä¸€æ ·ï¼Œåœ¨ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡åç§°ä¸­ï¼Œä¹Ÿè¦ä¿æŒå”¯ä¸€ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>Nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- è¯¥æœåŠ¡å¯è¯»æè¿°ã€‚å½“é€‰ä¸­è¯¥æœåŠ¡æ—¶ï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨WindowsæœåŠ¡ç®¡ç†å™¨ä¸­ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span>æ³¨å†Œä¸­å¿ƒ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- è¯¥å…ƒç´ æŒ‡å®šè¦å¯åŠ¨çš„å¯æ‰§è¡Œæ–‡ä»¶ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executable</span><span class="token punctuation">></span></span>%BASE%\startup.cmd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executable</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ—¥å¿—è¾“å‡ºä½ç½® --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logmode</span><span class="token punctuation">></span></span>rotate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logmode</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="PS-æ™®é€šå‘½ä»¤å¯åŠ¨Nacos">PS: æ™®é€šå‘½ä»¤å¯åŠ¨Nacos</h4><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">@echo off:: æ­¤å¤„ä¸ºnacosä½ç½®start cmd &#x2F;k &quot;cd &#x2F;d D:\develop\nacos-server-1.4.1\nacos\bin\ &amp;&amp; startup.cmd -m standalone&quot;exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DMå¤‡ä»½è¿˜åŸç¬”è®°</title>
      <link href="/2023/10/21/dm-move/"/>
      <url>/2023/10/21/dm-move/</url>
      
        <content type="html"><![CDATA[<h1>DMå¤‡ä»½è¿˜åŸç¬”è®°</h1><h2 id="è¿˜åŸ">è¿˜åŸ</h2><h3 id="å¤‡ä»½æ–‡ä»¶æ‹†åˆ†-Linux">å¤‡ä»½æ–‡ä»¶æ‹†åˆ†(Linux)</h3><p>å½“åº“ä½“ç§¯å¤ªå¤§æ—¶, éœ€è¦å¯¹å¤‡ä»½æ–‡ä»¶è¿›è¡Œæ‹†åˆ†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># -b è¾“å‡ºæ–‡ä»¶å¤§å°</span><span class="token comment"># -d ä½¿ç”¨æ•°å­—å‘½åå°¾ç¼€</span><span class="token comment"># -a å°¾æ¤çš„é•¿åº¦(é»˜è®¤2)</span><span class="token function">split</span> <span class="token parameter variable">-b</span> 1G <span class="token parameter variable">-d</span> DB_DAMENG1_FULL_2023_09_23_01_00_22.bak DB_DAMENG1_FULL_2023_09_23_01_00_22.bak.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆå¹¶å¤‡ä»½æ–‡ä»¶å¹¶è§£å‹-Windows">åˆå¹¶å¤‡ä»½æ–‡ä»¶å¹¶è§£å‹(Windows)</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">d:<span class="token builtin class-name">cd</span> dmcopy /b DB_DAMENG1_FULL_2023_09_23_01_00_22.bak.* DB_DAMENG1_FULL_2023_09_23_01_00_22.bak<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¡¥å……ï¼ˆLinuxç¯å¢ƒä¸‹æ‰“åŒ…åè¿›è¡Œæ‹†åˆ†ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zcvf</span> dmbak.tar.gz DB_DAMENG1_FULL_2023_09_16_01_00_53.bak <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 1G <span class="token parameter variable">-d</span> <span class="token parameter variable">-a</span> <span class="token number">2</span> - dmbak.tar.gz.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="DMå¤‡ä»½è¿˜åŸ">DMå¤‡ä»½è¿˜åŸ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">backup database backupset <span class="token string">'/data/dmbak/BACKUP_FILE_01'</span><span class="token punctuation">;</span>--è¿˜åŸ./dmrman <span class="token assign-left variable">CTLSTMT</span><span class="token operator">=</span><span class="token string">"RESTORE DATABASE '/data/dmdata/DAMENG1/dm.ini' FROM BACKUPSET '/data/dmbak/BACKUP_FILE_01'"</span>--æ¢å¤./dmrman <span class="token assign-left variable">CTLSTMT</span><span class="token operator">=</span><span class="token string">"RECOVER DATABASE '/data/dmdata/DAMENG1/dm.ini' FROM BACKUPSET '/data/dmbak/BACKUP_FILE01'"</span>--æ›´æ–°é­”æœ¯./dmrman <span class="token assign-left variable">CTLSTMT</span><span class="token operator">=</span><span class="token string">"RECOVER DATABASE '/data/dmdata/DAMENG1/dm.ini' UPDATE DB_MAGIC"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤‡ä»½">å¤‡ä»½</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- æ¸…ç†å¤‡ä»½</span>SF_BAKSET_BACKUP_DIR_ADD<span class="token punctuation">(</span><span class="token string">'DISK'</span><span class="token punctuation">,</span><span class="token string">'/data/dmbak'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">CALL</span> SP_DB_BAKSET_REMOVE_BATCH<span class="token punctuation">(</span><span class="token string">'DISK'</span><span class="token punctuation">,</span>SYSDATE<span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="../dm-move/image-20231023105654298.png" alt="å…¨é‡å¤‡ä»½"></p><p><img src="../dm-move/image-20231023105722948.png" alt="å¢é‡å¤‡ä»½"></p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NIO</title>
      <link href="/2023/09/14/nio/"/>
      <url>/2023/09/14/nio/</url>
      
        <content type="html"><![CDATA[<h2 id="ByteBuffer">ByteBuffer</h2><h3 id="ç»“æ„">ç»“æ„</h3><ul><li>capacity å®¹é‡</li><li>position å†™å…¥(è¯»å–)ä½ç½®</li><li>limit å†™å…¥(è¯»å–)é™åˆ¶</li></ul><ol><li>åˆå§‹çŠ¶æ€, å†™æ¨¡å¼(å›¾1-1)</li></ol><p><img src="../Nio/image-20231021144519852.png" alt="å›¾1-1"></p><ol start="2"><li>å†™å…¥æ•°æ®å, positionä¸ºå†™å…¥ä½ç½®, limit=capacity(å›¾1-2)</li></ol><p><img src="../Nio/image-20231021144841728.png" alt="å›¾1-2"></p><ol start="3"><li>flipè½¬æ¢æ¨¡å¼å, postitionåˆ‡æ¢ä¸ºè¯»å–ä½ç½®, limitåˆ‡æ¢ä¸ºè¯»å–é™åˆ¶(å›¾1-3)</li></ol><p><img src="../Nio/image-20231021145049802.png" alt="å›¾1-3"></p><ol start="4"><li>è¯»å–4ä¸ªå­—èŠ‚å(å›¾1-4)</li></ol><p><img src="../Nio/image-20231021145221000.png" alt="å›¾1-4"></p><ol start="5"><li>clearåŠ¨ä½œ, æ¸…é™¤æ•°æ®, é‡ç½®ä¸ºå†™æ¨¡å¼(å›¾1-5)</li></ol><p><img src="../Nio/image-20231021145402124.png" alt="å›¾1-5"></p><ol start="6"><li>compactåŠ¨ä½œ, å°†æœªè¯»å®Œçš„å‘å‰å‹ç¼©, å†é‡ç½®ä¸ºå†™æ¨¡å¼(å›¾1-6)</li></ol><p><img src="../Nio/image-20231021145507817.png" alt="å›¾1-6"></p><h3 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</h3><h4 id="åˆ†é…ç©ºé—´">åˆ†é…ç©ºé—´</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// java.nio.HeapByteBuffer  - Java å †å†…å­˜(è¯»å†™æ•ˆç‡è¾ƒä½,å—åˆ°GCçš„å½±å“)</span><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// java.nio.DirectByteBuffer  - ç›´æ¥å†…å­˜(è¯»å†™æ•ˆç‡é«˜,å°‘ä¸€æ¬¡æ‹·è´, åˆ†é…æ•ˆç‡ä½, ä½¿ç”¨ä¸å½“ä¼šé€ æˆå†…å­˜æ³„æ¼)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="å†™å…¥æ•°æ®">å†™å…¥æ•°æ®</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// channelçš„è¯»å–</span><span class="token keyword">int</span> readBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æˆ–è€…bufferè‡ªå·±çš„æ–¹æ³•</span>buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token number">127</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è¯»å–æ•°æ®">è¯»å–æ•°æ®</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java">buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åˆ‡æ¢è‡³è¯»æ¨¡å¼</span><span class="token keyword">byte</span> b <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æˆ–è€…channelçš„æ–¹æ³•</span><span class="token keyword">int</span> writeByte <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// getæ–¹æ³•ä¼šè®©positionè¯»æŒ‡é’ˆå‘åèµ°</span>buffer<span class="token punctuation">.</span><span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†positioné‡ç½®</span>buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–ç´¢å¼•å†…å®¹, ä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å­—ç¬¦ä¸²è½¬ä¸ºByteBuffer">å­—ç¬¦ä¸²è½¬ä¸ºByteBuffer</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 1. å­—ç¬¦ä¸²è½¬ä¸º ByteBuffer</span><span class="token class-name">ByteBuffer</span> buffer1 <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>buffer1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. Charset (è‡ªåŠ¨åˆ‡æ¢ä¸ºè¯»æ¨¡å¼)</span><span class="token class-name">ByteBuffer</span> buffer2 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"hello\nworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. wrap (è‡ªåŠ¨åˆ‡æ¢ä¸ºè¯»æ¨¡å¼)</span><span class="token class-name">ByteBuffer</span> buffer3 <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 4. è½¬ä¸ºå­—ç¬¦ä¸²</span><span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 5. </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é»åŒ…ã€åˆ†åŒ…demo">é»åŒ…ã€åˆ†åŒ…demo</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestByteBufferExamDee</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ByteBuffer</span> source <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Hello,world\nI'm zhangsan\nHo"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>        source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"w are you?\n"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// åˆ‡æ¢è¯»æ¨¡å¼</span>        source<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éå†buffer</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// æ¥æ”¶è€…çš„é•¿åº¦ = \n çš„ä½ç½® - å½“å‰è¯»æŒ‡é’ˆä½ç½® + 1</span>                <span class="token keyword">int</span> l <span class="token operator">=</span> i <span class="token operator">-</span> source<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤å¤„è¦è®©positionå†æ¥ç€èµ°ä¸€æ­¥, è·³è¿‡\n</span>                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// è¯»å–å®Œé‡æ–°å‹ç¼© buffer(æ­¤å¤„ä¸èƒ½ä½¿ç”¨clear)</span>        source<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç½‘ç»œç¼–ç¨‹">ç½‘ç»œç¼–ç¨‹</h2><h3 id="å¤šè·¯å¤ç”¨">å¤šè·¯å¤ç”¨</h3><p>å•çº¿ç¨‹å¯ä»¥é…åˆ Selector å®Œæˆå¯¹å¤šä¸ª Channel å¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œè¿™ç§°ä¹‹ä¸ºå¤šè·¯å¤ç”¨</p><ul><li>å¤šè·¯å¤ç”¨ä»…é’ˆå¯¹ç½‘ç»œ IOã€æ™®é€šæ–‡ä»¶ IO æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨</li><li>å¦‚æœä¸ç”¨ Selector çš„éé˜»å¡æ¨¡å¼ï¼Œçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšæ— ç”¨åŠŸï¼Œè€Œ Selector èƒ½å¤Ÿä¿è¯<ul><li>æœ‰å¯è¿æ¥äº‹ä»¶æ—¶æ‰å»è¿æ¥</li><li>æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å–</li><li>æœ‰å¯å†™äº‹ä»¶æ‰å»å†™å…¥<ul><li>é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼ŒChannel æœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦ Channel å¯å†™ï¼Œä¼šè§¦å‘ Selector çš„å¯å†™äº‹ä»¶</li></ul></li></ul></li></ul><p><img src="../Nio/image-20231029230052355.png" alt="Selectoræ¨¡å‹"></p><h3 id="å¤„ç†Readäº‹ä»¶demo">å¤„ç†Readäº‹ä»¶demo</h3><ul><li>æœåŠ¡ç«¯</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectableChannel</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span></span><span class="token punctuation">;</span><span class="token comment">/** * @author Dee * @date 2023/10/19 * &lt;p>Description: NIO demo, ä½¿ç”¨Selectorç®¡ç† */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeeServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¼€å¯æœåŠ¡å™¨</span>        <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®ä¸ºéé˜»å¡</span>        ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç»‘å®šç«¯å£</span>        ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºselectç®¡ç†å¤šä¸ªchannel</span>        <span class="token class-name">Selector</span> sel <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ³¨å†Œssc</span>        <span class="token class-name">SelectionKey</span> sscKey <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ³¨å†Œssc, &#123;&#125;"</span><span class="token punctuation">,</span> sscKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å…³æ³¨æ¥æ”¶äº‹ä»¶</span>        sscKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sel<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ— äº‹ä»¶é˜»å¡, æœ‰äº‹ä»¶ç»§ç»­æ‰§è¡Œ</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æœ‰äº‹ä»¶æ¥å…¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// éå†selKeys</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> ite <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>ite<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">SelectionKey</span> sk <span class="token operator">=</span> ite<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è¿­ä»£sk, &#123;&#125;"</span><span class="token punctuation">,</span> sk<span class="token punctuation">)</span><span class="token punctuation">;</span>                ite<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¤„ç†keyçš„æ—¶å€™ä¸€å®šç”¨åˆ é™¤, å¦åˆ™æ¯æ¬¡å¾ªç¯å¤„ç†ç›¸åŒkeyä¼šnpe</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>sk<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¦‚æœæ˜¯è®¿é—®äº‹ä»¶</span>                    <span class="token comment">// è·å–é€šé“</span>                    <span class="token class-name">SelectableChannel</span> channel <span class="token operator">=</span> sk<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å¼ºè½¬ä¸º ssc</span>                    <span class="token class-name">ServerSocketChannel</span> ssch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> channel<span class="token punctuation">;</span>                    <span class="token comment">// å»ºç«‹è¿æ¥</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssch<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®ä¸ºéé˜»å¡</span>                    <span class="token comment">// åˆ†é…ç©ºé—´</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// attachment</span>                    <span class="token comment">// æ³¨å†Œsc, å°†bufferä½œä¸ºé™„ä»¶å…³è”</span>                    <span class="token class-name">SelectionKey</span> scKey <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å…³æ³¨è¯»äº‹ä»¶</span>                    scKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è¿æ¥æˆåŠŸ, &#123;&#125;"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sk<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¦‚æœæ˜¯è¯»å–äº‹ä»¶</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">// è·å–é€šé“å¹¶å¼ºè½¬</span>                        <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> sk<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// è·å–é™„ä»¶(buffer)</span>                        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> sk<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœæ˜¯æ­£å¸¸æ–­å¼€, readæ˜¯-1</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            sk<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                            <span class="token comment">// æˆªå–\n</span>                            <span class="token function">split</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">// å¦‚æœæˆªå–åå‘ç°æŒ‡é’ˆæ²¡å˜, è¯´æ˜æ²¡æ¥åˆ°\n, éœ€è¦æ‰©å®¹</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token comment">// åˆ›å»ºæ–°çš„bfå¹¶æ›¿æ¢attachment</span>                                <span class="token class-name">ByteBuffer</span> newBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                newBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                                sk<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>newBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        sk<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// äº‹ä»¶å–æ¶ˆæ³¨å†Œ, å› ä¸ºå®¢æˆ·ç«¯å·²ç»æ–­å¼€, ä¼šäº§ç”Ÿä¸€ä¸ªè¯»äº‹ä»¶, å› æ­¤ä¸å¤„ç†ä¼šæ­»å¾ªç¯</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     *     * @param source     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        source<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¾ªç¯éå†</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">int</span> l <span class="token operator">=</span> i <span class="token operator">-</span> source<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤å¤„åˆ«å¿˜äº†, è½¬æ¢ä¸ºè¯»æ¨¡å¼</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        source<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®¢æˆ·ç«¯</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">SocketAddress</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SocketAddress</span> address <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">getLocalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"waiting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        sc.write(Charset.defaultCharset().encode("hello\nworld"));</span>        sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"helloworldabcdefghdf\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        sc.close();</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤„ç†Writeäº‹ä»¶demo">å¤„ç†Writeäº‹ä»¶demo</h3><ul><li>æœåŠ¡ç«¯</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span></span><span class="token punctuation">;</span><span class="token comment">/** * @author Dee * @date 2023/10/23 * &lt;p>Description: å¤„ç†writeå†™äº‹ä»¶ */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeeWriteServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">SelectionKey</span> sk <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>sk<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// æ­¤å¤„å› ä¸ºçŸ¥é“ä¸€å®šæ˜¯ sscçš„è¿æ¥, å› æ­¤å°±ä¸å†ä»skä¸­å–é€šé“</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å·²è¿æ¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    sc<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SelectionKey</span> sck <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// æµ‹è¯•å†™ ä¸‰ç™¾ä¸‡ä¸ªé•¿åº¦çš„ å­—ç¬¦ä¸²</span>                    <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token class-name">ByteBuffer</span> bf <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å…ˆå†™ä¸€æ¬¡</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰“å°å†™äº†å¤šå°‘çš„é•¿åº¦</span>                    <span class="token comment">// é˜²æ­¢å†™ä¸å®Œ, å¦‚æœè¿˜æœ‰å‰©ä½™çš„ç»§ç»­å†™</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>bf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">// æœªå†™å®Œçš„ä¼šè§¦å‘æ–°çš„äº‹ä»¶, å› æ­¤éœ€è¦å…³æ³¨å†™äº‹ä»¶, åŒæ—¶ä¹Ÿè¦æ‹¿åˆ°ä¹‹å‰çš„äº‹ä»¶</span>                        sck<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>sck<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                        sk.interestOps(sk.interestOps() + SelectionKey.OP_WRITE); // ä¸¤ç§å†™æ³•</span>                        <span class="token comment">// æŠŠbufferå­˜èµ·æ¥</span>                        sck<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sk<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// æŠŠä¸Šæ¬¡æœªå†™å®Œçš„bufferæ‹¿å‡ºæ¥</span>                    <span class="token class-name">ByteBuffer</span> bf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> sk<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> sk<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bf<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å¦‚æœæ²¡æœ‰æ•°æ®å¯å†™äº†, åˆ™åˆ é™¤é™„ä»¶, å¹¶ä¸”å»é™¤å…³æ³¨çš„è¯»äº‹ä»¶</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        sk<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        sk<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span>sk<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®¢æˆ·ç«¯</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span><span class="token comment">/** * @author Dee * @date 2023/10/24 * &lt;p>Description: */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeeWriteClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰æ€»å…±è¯»å–çš„é•¿åº¦</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            count <span class="token operator">+=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯»å–çš„é•¿åº¦ï¼š"</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="selectorä¸é˜»å¡æƒ…å†µ">selectorä¸é˜»å¡æƒ…å†µ</h3><blockquote><ul><li>äº‹ä»¶å‘ç”Ÿæ—¶<ul><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ accept äº‹ä»¶</li><li>å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ã€å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶</li><li>channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶</li><li>åœ¨ linux ä¸‹ nio bug å‘ç”Ÿæ—¶</li></ul></li><li>è°ƒç”¨ selector.wakeup()</li><li>è°ƒç”¨ selector.close()</li><li>selector æ‰€åœ¨çº¿ç¨‹ interrupt</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> NIO </tag>
            
            <tag> Netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>crontabå®šæ—¶ä»»åŠ¡</title>
      <link href="/2023/09/08/crontab/"/>
      <url>/2023/09/08/crontab/</url>
      
        <content type="html"><![CDATA[<h3 id="å‘½ä»¤">å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">crontab</span> <span class="token parameter variable">-l</span>  <span class="token comment"># æŸ¥çœ‹å®šæ—¶ä»»åŠ¡</span><span class="token function">crontab</span> <span class="token parameter variable">-e</span>  <span class="token comment"># ç¼–è¾‘å®šæ—¶ä»»åŠ¡</span>cronè¡¨è¾¾å¼ + æ‰§è¡Œçš„å‘½ä»¤ <span class="token comment"># å®šæ—¶æ ¼å¼</span><span class="token comment">#### å¸¸ç”¨cronè¡¨è¾¾å¼(ps: linuxæ²¡æœ‰ç§’)</span><span class="token comment"># åˆ† æ—¶ æ—¥ æœˆ æ—¥/å‘¨(æ˜ŸæœŸå¤©ä¸º0)</span><span class="token number">0</span> */1 * * *  <span class="token comment"># æ¯éš”1å°æ—¶æ‰§è¡Œ, ç­‰ä»·äº ==> 0 * * * *</span><span class="token number">0</span> <span class="token number">8</span> * * <span class="token number">1</span>-5  <span class="token comment"># ä»å‘¨ä¸€è‡³å‘¨äº”, æ¯å¤©8:00æ‰§è¡Œ</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">1,15</span> * * <span class="token comment"># æ¯æœˆ1/15å·æ‰§è¡Œ</span>* * * * * <span class="token comment"># æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span><span class="token number">1</span> * * * *  <span class="token comment"># æ¯å°æ—¶ç¬¬ä¸€åˆ†æ‰§è¡Œ</span><span class="token number">30</span> <span class="token number">6</span> */10 * * <span class="token comment"># ä»1æ—¥å¼€å§‹æ¯éš”10å¤©çš„6:30æ‰§è¡Œ</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> * <span class="token comment"># æ¯å¹´æ‰§è¡Œä¸€æ¬¡(å› ä¸ºæœˆ,æ—¥,æ—¶,åˆ†éƒ½å·²æŒ‡å®š,å› æ­¤å¯ä»¥ç¡®å®šæ˜¯æ¯å¹´)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸€äº›æ¸…ç†å‘½ä»¤">ä¸€äº›æ¸…ç†å‘½ä»¤</h3><ul><li>åˆ é™¤ç›®æ ‡æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> /tmp <span class="token parameter variable">-name</span> <span class="token string">"*.jpg"</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-delete</span>  <span class="token comment"># æŸ¥è¯¢/tmpæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰"*.jpg"çš„æ–‡ä»¶å¹¶åˆ é™¤</span><span class="token function">find</span> /logs/ <span class="token parameter variable">-type</span> f <span class="token parameter variable">-mmin</span> +30 <span class="token parameter variable">-name</span> <span class="token string">'*'</span> <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span>  <span class="token comment"># æŸ¥è¯¢/logs/æ–‡ä»¶å¤¹ä¸‹ä¿®æ”¹æ—¶é—´æ˜¯30åˆ†é’Ÿä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶å¹¶åˆ é™¤ </span><span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +<span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token variable">`</span></span> <span class="token operator">>></span> /logs/clear.out <span class="token comment"># è¾“å‡ºå½“å‰æ—¶é—´åˆ°æ¸…ç†æ—¥å¿—ä¸­</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goaccess</title>
      <link href="/2023/09/02/goaccess/"/>
      <url>/2023/09/02/goaccess/</url>
      
        <content type="html"><![CDATA[<h1>Nginxæ—¥å¿—åˆ†æ</h1><h2 id="linux-å·¥å…·">linux å·¥å…·</h2><p>è·å–å‰20çš„ipè®¿é—®æ•°é‡</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å…·ä½“æˆªå–ä½ç½®æ ¹æ®æ—¥å¿—æ ¼å¼</span><span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span> access-<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">"+%Y-%m-%d"</span><span class="token variable">`</span></span>.log <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="goaccessç»Ÿè®¡åˆ†æ">goaccessç»Ÿè®¡åˆ†æ</h2><p>windowå®‰è£…æ•™ç¨‹</p><h3 id="ä¸‹è½½goaccessåŒ…">ä¸‹è½½goaccessåŒ…</h3><p><a href="https://goaccess.io/">https://goaccess.io/</a></p><h3 id="å®‰è£…cygwin">å®‰è£…cygwin</h3><ol><li><p>å®˜ç½‘åœ°å€</p><p><a href="http://www.cygwin.com/">http://www.cygwin.com/</a></p></li><li><p>åœ¨cygwinä¸­éœ€è¦å®‰è£…çš„åŒ…</p><pre class="line-numbers language-none"><code class="language-none">libGeoIP-devel           | GeoIP2 C librarylibncurses-devel         | Terminal display librarylibncursesw10            | Terminal display library (wide-character)gcc-core (C)             | GNU Compiler Collectionmake                     | make utilityautomake                 | GNU Makefilesgettext                  | GNU Gettextautomake wrapper scripts | wrapper scripts for automake and aclocal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="å®‰è£…goaccess">å®‰è£…goaccess</h3><ol><li><p>å°†<code>goaccess-1.7.2.tar.gz</code>æ”¾å…¥<code>cygwin</code>ç›®å½•ä¸‹</p></li><li><p>æ‰“å¼€cygwin</p><pre class="line-numbers language-none"><code class="language-none">tar -xzvf goaccess-1.7.2.tar.gzcd goaccess-1.7.2.&#x2F;configure --enable-utf8 --enable-geoip&#x3D;legacy# å¦‚æœä¸æˆåŠŸåˆ™æ‰§è¡Œ .&#x2F;configure --enable-utf8makemake install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="é…ç½®æ–‡ä»¶æ ¼å¼">é…ç½®æ–‡ä»¶æ ¼å¼</h3><p>nginx.conf</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">log_format</span>  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_iso8601]</span> requesthost:"<span class="token variable">$http_host</span>"; "<span class="token variable">$request</span>" requesttime:"<span class="token variable">$request_time</span>"; '</span><span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> "<span class="token variable">$http_referer</span>" - <span class="token variable">$request_body</span>'</span>                      <span class="token string">'"<span class="token variable">$http_user_agent</span>" "<span class="token variable">$http_x_forwarded_for</span>"'</span></span><span class="token punctuation">;</span><span class="token comment">## æ—¥å¿—è¾“å‡º</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>goaccess.conf</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">time-format %Tdate-format %Y-%m-%dlog-format %h - %^ <span class="token punctuation">[</span>%dT%t+%^<span class="token punctuation">]</span> requesthost:<span class="token string">"%v"</span><span class="token punctuation">;</span> <span class="token string">"%r"</span> requesttime:<span class="token string">"%T"</span><span class="token punctuation">;</span> %s %b <span class="token string">"%R"</span> - %^<span class="token string">"%u"</span><span class="token comment">##########</span><span class="token comment"># å‚æ•°è¯´æ˜</span><span class="token comment">##########</span><span class="token comment"># $remote_addr  >>>  %h</span><span class="token comment"># $remote_user  >>>  %^</span><span class="token comment"># $time_iso8601 >>>  %dT%t+%^</span><span class="token comment"># $http_host    >>>  %v</span><span class="token comment"># $request      >>>  %r</span><span class="token comment"># $request_time >>>  %T</span><span class="token comment"># $status >>>  %s</span><span class="token comment"># $body_bytes_sent >>> %b</span><span class="token comment"># $http_referer >>>  %R</span><span class="token comment"># $request_body >>>  %^</span><span class="token comment"># $http_user_agent >>> %u</span><span class="token comment"># $http_x_forwarded_for >>> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¯åŠ¨å‘½ä»¤">å¯åŠ¨å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ­¤å¤„é‡‡ç”¨åŠ¨æ€æ–‡ä»¶è·¯å¾„, å°†æ—¥å¿—æ–‡ä»¶è¾“å‡ºè‡³cygwinç›®å½•ä¸‹</span><span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span> goaccess /cygdrive/d/nginx-1.20.2/nginx-1.19.5.1/logs/access-<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">"+%Y-%m-%d"</span><span class="token variable">`</span></span>.log <span class="token parameter variable">-p</span> /cygdrive/d/cygwin64/goaccess-1.7.2/config/goaccess.conf <span class="token parameter variable">-o</span> D:/cygwin64/report.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wsl-note</title>
      <link href="/2023/08/22/wsl-note/"/>
      <url>/2023/08/22/wsl-note/</url>
      
        <content type="html"><![CDATA[<h2 id="ç³»ç»Ÿå®‰è£…ä¸å¯åŠ¨">ç³»ç»Ÿå®‰è£…ä¸å¯åŠ¨</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wsl <span class="token parameter variable">--install</span>  <span class="token comment"># å®‰è£…åé‡å¯è®¡ç®—æœº</span>wsl <span class="token parameter variable">-l</span> <span class="token parameter variable">-o</span>  <span class="token comment"># æŸ¥çœ‹å¯ç”¨å‘è¡Œç‰ˆåˆ—è¡¨</span>wsl <span class="token parameter variable">-l</span> <span class="token parameter variable">-v</span><span class="token comment"># æŸ¥çœ‹å½“å‰çš„wslç‰ˆæœ¬ä»¥åŠçŠ¶æ€</span>wsl <span class="token parameter variable">--shutdown</span>  <span class="token comment"># ç«‹å³ç»ˆæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åˆ†å‘å’ŒWSL2è½»å‹å·¥å…·è™šæ‹Ÿæœº</span>wsl <span class="token parameter variable">--terminate</span> <span class="token operator">&lt;</span>Distribution Name<span class="token operator">></span>  <span class="token comment"># å…³é—­æŒ‡å®šå‘è¡Œç‰ˆ</span>wsl <span class="token parameter variable">-d</span> Ubuntu <span class="token comment"># å¯åŠ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¿ç§»ç³»ç»Ÿä½ç½®">è¿ç§»ç³»ç»Ÿä½ç½®</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wsl <span class="token parameter variable">-l</span> <span class="token parameter variable">--all</span> <span class="token parameter variable">-v</span>  <span class="token comment"># æŸ¥çœ‹æ‰€æœ‰åˆ†å‘ç‰ˆæœ¬</span>wsl <span class="token parameter variable">--export</span> Ubuntu D:<span class="token punctuation">\</span>ubuntu.tar<span class="token comment"># å¯¼å‡ºåˆ†å‘ç‰ˆä¸ºtaræ–‡ä»¶åˆ°Dç›˜</span>wsl <span class="token parameter variable">--unregister</span> Ubuntu<span class="token comment"># æ³¨é”€å½“å‰åˆ†å‘ç‰ˆ</span>wsl <span class="token parameter variable">--import</span> Ubuntu D:<span class="token punctuation">\</span>develop<span class="token punctuation">\</span>wsl<span class="token punctuation">\</span>ubuntu D:<span class="token punctuation">\</span>ubuntu.tar <span class="token parameter variable">--version</span> <span class="token number">2</span>  <span class="token comment"># é‡æ–°å¯¼å…¥å¹¶å®‰è£…åˆ†å‘ç‰ˆåœ¨D:\wsl\ubuntu</span>Ubuntu config --default-user <span class="token punctuation">&#123;</span>dee<span class="token punctuation">&#125;</span><span class="token comment"># è®¾ç½®é»˜è®¤ç™»é™†ç”¨æˆ·ä¸ºå®‰è£…æ—¶ç”¨æˆ·å</span>del D:<span class="token punctuation">\</span>ubuntu.tar<span class="token comment"># åˆ é™¤å¯¼å‡ºçš„taræ–‡ä»¶(å¯é€‰)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŸºç¡€é…ç½®">åŸºç¡€é…ç½®</h2><p>è®¾ç½®aptå›½å†…é•œåƒæºå¯ä»¥åŠ é€Ÿä¸‹è½½</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ›¿æ¢å…¨éƒ¨</p><pre class="line-numbers language-null" data-language="null"><code class="language-null"># é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy main restricted universe multiverse# deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy main restricted universe multiversedeb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-updates main restricted universe multiverse# deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-updates main restricted universe multiversedeb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-backports main restricted universe multiverse# deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-backports main restricted universe multiversedeb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-security main restricted universe multiverse# deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-security main restricted universe multiverse# é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨# deb https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-proposed main restricted universe multiverse# deb-src https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu&#x2F; jammy-proposed main restricted universe multiverse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>apt å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token comment"># åˆ—å‡ºæ‰€æœ‰å¯æ›´æ–°çš„è½¯ä»¶æ¸…å•å‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token comment"># å‡çº§è½¯ä»¶åŒ…</span><span class="token function">apt</span> list <span class="token parameter variable">--upgradeable</span> <span class="token comment"># åˆ—å‡ºå¯æ›´æ–°çš„è½¯ä»¶åŒ…åŠç‰ˆæœ¬ä¿¡æ¯</span><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span> <span class="token comment"># ç»„åˆå‘½ä»¤</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package_name<span class="token operator">>=</span><span class="token operator">&lt;</span>version_number<span class="token operator">></span>  <span class="token comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span><span class="token function">sudo</span> <span class="token function">apt</span> remove <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment"># åˆ é™¤è½¯ä»¶åŒ…</span><span class="token function">sudo</span> <span class="token function">apt</span> autoremove <span class="token comment"># æ¸…ç†ä¸å†ä½¿ç”¨çš„ä¾èµ–å’Œåº“æ–‡ä»¶</span><span class="token function">sudo</span> <span class="token function">apt</span> purge <span class="token operator">&lt;</span>package_name<span class="token operator">></span> <span class="token comment"># ç§»é™¤è½¯ä»¶åŒ…åŠé…ç½®æ–‡ä»¶</span><span class="token function">sudo</span> <span class="token function">apt</span> search <span class="token operator">&lt;</span>keyword<span class="token operator">></span> <span class="token comment"># æŸ¥æ‰¾è½¯ä»¶åŒ…</span><span class="token function">apt</span> list <span class="token parameter variable">--installed</span> <span class="token comment"># åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…</span><span class="token function">apt</span> list --all-versions <span class="token comment"># åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€æœºè‡ªå¯</p><ol><li><p><code>win+R</code> è¿è¡Œ <code>shell:startup</code></p></li><li><p>åœ¨ç›®å½•ä¸­åˆ›å»º <code>wsl-startup.vbs</code>æ–‡ä»¶</p><pre class="line-numbers language-visual-basic" data-language="visual-basic"><code class="language-visual-basic"><span class="token keyword">set</span> ws<span class="token operator">=</span>wscript<span class="token punctuation">.</span>CreateObject<span class="token punctuation">(</span><span class="token string">"wscript.shell"</span><span class="token punctuation">)</span>ws<span class="token punctuation">.</span>run <span class="token string">"wsl -d Ubuntu"</span><span class="token punctuation">,</span> vbhide<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>é‡å¯ç”µè„‘</p></li></ol><h2 id="mysqlå®‰è£…">mysqlå®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> search mysql-server <span class="token comment"># æœç´¢ç‰ˆæœ¬</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mysql-server <span class="token parameter variable">-y</span> <span class="token comment"># å®‰è£…</span>systmctl start mysql <span class="token comment"># å¯åŠ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>mysqlç™»å½•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/mysql/debian.cnf <span class="token comment"># æŸ¥çœ‹å¯†ç (æ³¨æ„vimä¸­è¦ ctrl+shift+cæ˜¯å…¨å±€å¤åˆ¶)</span>    user     <span class="token operator">=</span> debian-sys-maint    password <span class="token operator">=</span> vkOJolrKJqv950Hjmysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> <span class="token comment"># ç™»å½•</span>å¤åˆ¶å¯†ç åç™»å½•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´æ”¹å¯†ç </p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> mysql<span class="token punctuation">;</span><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> authentication_string<span class="token operator">=</span><span class="token string">''</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span>  <span class="token comment">--å°†å­—æ®µç½®ä¸ºç©º</span><span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> identified <span class="token keyword">with</span> mysql_native_password <span class="token keyword">by</span> <span class="token string">'root'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ›´æ”¹è®¿é—®æƒé™</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/mysql/mysql.conf.d/mysqld.cnf<span class="token comment"># æ³¨é‡Šä¸‹é¢è¿™æ®µ</span><span class="token comment"># bind-address          = 127.0.0.1</span><span class="token function">sudo</span> systemctl restart mysql <span class="token comment"># é‡å¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>linuxç«¯ç™»å½•mysql</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> host<span class="token punctuation">,</span><span class="token keyword">user</span> <span class="token keyword">from</span> <span class="token keyword">user</span><span class="token punctuation">;</span>  <span class="token comment">-- æŸ¥è¯¢å„ç”¨æˆ·æ”¾å¼€æƒé™</span><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> host <span class="token operator">=</span> <span class="token string">'%'</span> <span class="token keyword">where</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>  <span class="token comment">-- ä¿®æ”¹æˆ%è¡¨ç¤ºï¼Œæ‰€æœ‰ä¸»æœºéƒ½å¯ä»¥é€šè¿‡rootç”¨æˆ·è®¿é—®æ•°æ®åº“</span>flush <span class="token keyword">privileges</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="windowsè®¿é—®wslæ–‡ä»¶">windowsè®¿é—®wslæ–‡ä»¶</h2><p>èµ„æºç®¡ç†å™¨è¾“å…¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">\</span><span class="token punctuation">\</span>wsl$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æš´éœ²ç«¯å£è‡³å±€åŸŸç½‘-ä»¥sshä¸ºä¾‹">æš´éœ²ç«¯å£è‡³å±€åŸŸç½‘(ä»¥sshä¸ºä¾‹)</h2><h3 id="1-wslä¸‹é‡è£…ssh">1. wslä¸‹é‡è£…ssh</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> remove openssh-server<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openssh-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-ç¼–è¾‘sshd-configæ–‡ä»¶">2. ç¼–è¾‘sshd_configæ–‡ä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>Port 22</li><li>PermitRootLogin yes</li><li>PasswordAuthentication yes</li></ul><h3 id="3-ç¼–è¾‘sudo-vim-etc-hosts-allowï¼Œæ·»åŠ ä¸€è¡Œ">3. ç¼–è¾‘sudo vim /etc/hosts.allowï¼Œæ·»åŠ ä¸€è¡Œ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/hosts.allow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ·»åŠ çš„å†…å®¹ä¸º <strong>sshd: ALL</strong></li></ul><h3 id="4-é‡å¯sshæœåŠ¡">4. é‡å¯sshæœåŠ¡</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">ssh</span> --full-restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-æŸ¥çœ‹wsl-IPåœ°å€">5. æŸ¥çœ‹wsl IPåœ°å€</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ifconfig</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="../wsl-note/image-20230822222811064.png" alt=""></p><h3 id="6-windowsç»ˆç«¯ä¸­è½¬å‘WSL2">6. windowsç»ˆç«¯ä¸­è½¬å‘WSL2</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## æ·»åŠ ç«¯å£æ˜ å°„</span>netsh interface portproxy <span class="token function">add</span> v4tov4 <span class="token assign-left variable">listenaddress</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token assign-left variable">listenport</span><span class="token operator">=</span><span class="token number">22</span> <span class="token assign-left variable">connectaddress</span><span class="token operator">=</span><span class="token operator">&lt;</span>xxx.xxx.xxx.xxx<span class="token operator">></span> <span class="token assign-left variable">connectport</span><span class="token operator">=</span><span class="token number">22</span><span class="token comment">## åˆ é™¤ç«¯å£</span>netsh interface portproxy delete v4tov4 <span class="token assign-left variable">listenaddress</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token assign-left variable">listenport</span><span class="token operator">=</span><span class="token number">22</span><span class="token comment">## åŒç†è½¬å‘mysql</span>netsh interface portproxy <span class="token function">add</span> v4tov4 <span class="token assign-left variable">listenaddress</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token assign-left variable">listenport</span><span class="token operator">=</span><span class="token number">13306</span> <span class="token assign-left variable">connectaddress</span><span class="token operator">=</span><span class="token operator">&lt;</span>xxx.xxx.xxx.xxx<span class="token operator">></span> <span class="token assign-left variable">connectport</span><span class="token operator">=</span><span class="token number">3306</span><span class="token comment">## é€šè¿‡ä¸»æœºIP:13306è¿æ¥å³å¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="../wsl-note/image-20230822222946020.png" alt=""></p><h3 id="7-è¿æ¥windowsç«¯å£">7. è¿æ¥windowsç«¯å£</h3><p><img src="../wsl-note/image-20230822223239388.png" alt=""></p><blockquote><p>è½¬è½½è‡³: [å¦‚ä½•ç”¨ç¬”è®°æœ¬sshè¿æ¥å±€åŸŸç½‘å†…å…¶ä»–ç”µè„‘ä¸Šçš„wsl2 ubuntu - çŸ¥ä¹ (<a href="http://zhihu.com">zhihu.com</a>)](<a href="https://zhuanlan.zhihu.com/p/357038111#:~:text=%E5%9C%A8windows%E4%B8%8B%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E6%89%93%E5%BC%80cmd%EF%BC%8C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E5%B0%86%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E5%88%B0WSL2">https://zhuanlan.zhihu.com/p/357038111#:~:text=åœ¨windowsä¸‹ç®¡ç†å‘˜æƒé™æ‰“å¼€cmdï¼Œè¾“å…¥å‘½ä»¤å°†ç«¯å£è½¬å‘åˆ°WSL2</a> netsh interface portproxy add v4tov4,listenaddress%3D0.0.0.0 listenport%3D22 connectaddress%<a href="http://3Dxxx.xxx.xxx.xxx">3Dxxx.xxx.xxx.xxx</a> connectport%3D22 æ­¤å¤„ <a href="http://xxx.xxx.xxx.xxx">xxx.xxx.xxx.xxx</a> æ›¿æ¢æˆwslçš„IPåœ°å€ï¼Œå¦‚172.18.195.3)</p></blockquote><h2 id="å¼€å¯hyper-v">å¼€å¯hyper-v</h2><p>æ§åˆ¶é¢æ¿ - ç¨‹åº - å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½ - Hyper-V</p><p><img src="../wsl-note/image-20230822113615201.png" alt=""></p><p>å¦‚æœæ²¡æœ‰æ‰“å¼€ç»ˆç«¯, è¾“å…¥ <code>systeminfo</code> å‘½ä»¤</p><p>æœ«å°¾Hyper-Vè¦æ±‚, å¦‚æœå¯ä»¥æ”¯æŒ</p><p>æ–°å»ºæ–‡æœ¬, å¤åˆ¶å¦‚ä¸‹ä»£ç </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pushd</span> <span class="token string">"%~dp0"</span><span class="token function">dir</span> /b %SystemRoot%<span class="token punctuation">\</span>servicing<span class="token punctuation">\</span>Packages<span class="token punctuation">\</span>*Hyper-V*.mum <span class="token operator">></span>hyper-v.txt<span class="token keyword">for</span> /f %%i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'findstr /i . hyper-v.txt 2^>nul'</span><span class="token punctuation">)</span> <span class="token keyword">do</span> dism /online /norestart /add-package:<span class="token string">"%SystemRoot%\servicing\Packages\%%i"</span>del hyper-v.txtDism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”¨æ‰¹å¤„ç† <code>.bat</code> ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ, ä»£ç ç»“æŸå<strong>é‡å¯ç”µè„‘</strong>å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> WSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº‘å—Happyæ—¥è®°</title>
      <link href="/2023/08/19/yunnan-diary/"/>
      <url>/2023/08/19/yunnan-diary/</url>
      
        <content type="html"><![CDATA[<h1>äº‘å—Happyæ—¥è®°</h1><h3 id="1ï¸âƒ£å¤§ç†ç¯‡">1ï¸âƒ£å¤§ç†ç¯‡</h3><p>æ­å·âœˆæ˜†æ˜ğŸš†å¤§ç†ğŸš•å¤§ç†å¤é•‡é™„è¿‘ğŸ›–æŠ•å®¿</p><h4 id="ğŸ˜‹è¶…çº§è¶…çº§å¥½åƒçš„æ¸…è’¸è¡—">ğŸ˜‹è¶…çº§è¶…çº§å¥½åƒçš„æ¸…è’¸è¡—</h4><p><img src="../yunnan-diary/872c4f0ff30ce6398ac77bdee5cdde5.jpg" alt="å°å±±ä¸€æ ·çš„æ–°é²œç‰›è‚‰"></p><p><img src="../yunnan-diary/9adb820d9f5b7f6624d696dce833819.jpg" alt="é¸³é¸¯é“œé”…"></p><p>å†¬é˜´é”…å£æ„Ÿä¸å¤ªä¹ æƒ¯, é”…ä¸å°, æ˜¯ç‰›è‚‰å¤ªå¤§ç›˜å•¦</p><p><img src="../yunnan-diary/3a347ae5c334245a44cb5952a75790a.jpg" alt="è¾¹æ¶®ç«é”…è¾¹çƒ§çƒ¤"></p><h4 id="ğŸ›µç¯æ´±æµ·">ğŸ›µç¯æ´±æµ·</h4><p>â—â—â—ä¸€å®šè¦é¡ºæ—¶é’ˆéª‘è¡Œ, é¡ºæ—¶é’ˆæ˜¯é è¿‘æ´±æµ·è¿™è¾¹, å¹¶ä¸”æ´±æµ·åŒ—è¾¹å¾ˆå¤šè·¯æ˜¯æ²¡æœ‰é€†æ—¶é’ˆéª‘è¡Œé“</p><p><img src="../yunnan-diary/fa37a560d60705f11c42e17cee6a3a8.jpg" alt="æ²¿è·¯çš„ç¬¬ä¸€äº®çœ¼"></p><p><img src="../yunnan-diary/6e2c244ea593a7f07fc8c573d5aceb7.jpg" alt="ç»¿æ²¹æ²¹çš„éº¦ç”°"></p><p><img src="../yunnan-diary/1dec4002f8d4c2fd55f0327489bb140.jpg" alt="è‡ªåŠ©æ‰“å¡"></p><p><img src="../yunnan-diary/0c115f238bfbc9e2068bf19a81a51bc.jpg" alt="èŠœæ¹–èµ·é£"></p><h4 id="â›©ï¸å–œæ´²å°é•‡">â›©ï¸å–œæ´²å°é•‡</h4><p><img src="../yunnan-diary/69823da4633e234bd2288752f75be8f.jpg" alt="èƒŒç®©ç­çš„é˜¿å©†"></p><p><img src="../yunnan-diary/92bbc345ceecc3a962dc9782cb28add.jpg" alt="ä¸Šåˆ10ç‚¹çš„å–œæ´²äººè¿˜ä¸å¤šå“¦"></p><p><img src="../yunnan-diary/161d38ff332e961220c6b5b75985aaf.jpg" alt="åŒ…æµ†è±†è…å¥½åƒåˆ°ç ´é˜²"></p><p><img src="../yunnan-diary/500e1ebca2c4456eec7aef85e2a9040.jpg" alt=""></p><p><img src="../yunnan-diary/58c0d620827f2d8b23e1622284c0f20.jpg" alt=""></p><p><img src="../yunnan-diary/92a02fd9237358aa17b09601dde2685.jpg" alt=""></p><p><img src="../yunnan-diary/65356f747dfab60cfee3b1c1679f0f1.jpg" alt=""></p><p><img src="../yunnan-diary/edc7a8f3e7d31f39035dcfb3f5d0afe.jpg" alt=""></p><p><img src="../yunnan-diary/d2b462c80da9d11bda928d9051ae6fe.jpg" alt="æµ·è¾¹çš„é’ç“¦å°é•‡"></p><p><img src="../yunnan-diary/f4cc94dae3405b29982651dae85e4be.jpg" alt="å°æ´²éš”é•‡ç›¸æœ›"></p><p><img src="../yunnan-diary/2cacafb0e863e969771695e601bbd1e.jpg" alt="ç»§ç»­ä¸Šè·¯"></p><p><img src="../yunnan-diary/ccadb48d1d63262fc451e060ba30667.jpg" alt="é£æœ‰ç‚¹å¤§,åœä¸‹ä¼‘æ¯ä¼‘æ¯"></p><p><img src="../yunnan-diary/b32f4f227cfaff31035cd5afd9b0ee4.jpg" alt="ç»§ç»­ä¸Šè·¯"></p><p><img src="../yunnan-diary/2c88a0719ff9feb0b0a5857d4399dd5.jpg" alt="çœŸç¾çœŸç¾, å†æ‹ä¸€å¼ "></p><p><img src="../yunnan-diary/f69adcf78f588171ee5a8ebcb42472b.jpg" alt=""></p><p><img src="../yunnan-diary/588883fbec2b5f0936ef1ce14289f01.jpg" alt="æ˜¥æ°´å…±é•¿å¤©ä¸€è‰²"></p><p><img src="../yunnan-diary/69578a9898a01cf7d758790ef56402b.jpg" alt=""></p><p>å†å›å¤é•‡æ¸…çœŸè¡—, æ¥ä¸€é¡¿æ‰‹æŠ“é¥­</p><p><img src="../yunnan-diary/392506640118608b549d6cc262c5821.jpg" alt=""></p><p><img src="../yunnan-diary/ee21bb81a2d5ebc5fc7c4e12b2dc997.jpg" alt=""></p><h4 id="ğŸµå¤§ç†å¤é•‡çš„å¤œ">ğŸµå¤§ç†å¤é•‡çš„å¤œ</h4><p><img src="../yunnan-diary/1697983433275-180706d28201154c4ad9caa526e97d59.gif" alt="ç«æŠŠè½¬è½¬è½¬"></p><p><img src="../yunnan-diary/619bd5a6812dba0164f2a778ce12cd9.jpg" alt="é…’å§è¡—"></p><p><img src="../yunnan-diary/596a6be3994e03a0aaf1c34a588c265b.gif" alt="æ¨±èŠ±å±‹"></p><h4 id="â›°ï¸è‹å±±">â›°ï¸è‹å±±</h4><p><img src="../yunnan-diary/b1b8c647f09f3be70e6c5fd924aa09a.jpg" alt="æ—©ä¸Šä¸€ç¢—ç‚¸é…±ç±³çº¿, å¤é•‡åŒ—é—¨èœå¸‚è¡—å·¦è¾¹"></p><p>å»è‹å±±çš„é‚£å¤©å¤§é›¨, åŸºæœ¬çœ‹äº†ä¸ªå¯‚å¯ğŸ˜­ğŸ˜­ğŸ˜­</p><p><img src="../yunnan-diary/cc2c683998d8c9159152bacd2183a7c.jpg" alt="ä¸‰ä¹å…­å…­"></p><p><img src="../yunnan-diary/c04a5daf7142a552cf7c3b02e4a8aba.jpg" alt="é›¨è’™è’™çš„æ´—é©¬æ½­"></p><p><img src="../yunnan-diary/51a5c069a9cd47ab1adc16118ae355a.jpg" alt=""></p><img src="../yunnan-diary/bea97d4ecec6d45fc36c8ff3402860a.jpg" style="zoom:33%;" /><h4 id="ğŸï¸å¤©é¾™å…«éƒ¨å½±è§†åŸ">ğŸï¸å¤©é¾™å…«éƒ¨å½±è§†åŸ</h4><p><img src="../yunnan-diary/0d36cbf61e4e1602eeb89d14c8fa3ab.jpg" alt=""></p><p><img src="../yunnan-diary/6f6c13fd405a4ff4efefa6b17e496fd.jpg" alt=""></p><p><img src="../yunnan-diary/36da6ab478011332d9b062fd477176d.jpg" alt=""></p><p><img src="../yunnan-diary/b081f37c78e8e4737aeef6a3a7a85eb.jpg" alt="æ‰‡å­èˆ"></p><img src="../yunnan-diary/7aae249afd8faf74b4852c59dcd738f.jpg" alt="å“¼â—â—" style="zoom:33%;" /><img src="../yunnan-diary/88c3c003353dc8c689c2747789bc276.jpg" alt="å¿…åƒè€å¥¶æ´‹èŠ‹ğŸ‘ğŸ‘ğŸ‘" style="zoom: 38%;" /><h3 id="2ï¸âƒ£é¦™æ ¼é‡Œæ‹‰ç¯‡">2ï¸âƒ£é¦™æ ¼é‡Œæ‹‰ç¯‡</h3><h3 id="3ï¸âƒ£ä¸½æ±Ÿç¯‡">3ï¸âƒ£ä¸½æ±Ÿç¯‡</h3><h3 id="4ï¸âƒ£æ˜†æ˜ç¯‡">4ï¸âƒ£æ˜†æ˜ç¯‡</h3>]]></content>
      
      
      <categories>
          
          <category> life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—…æ¸¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>el-ui-ç§¯ç´¯</title>
      <link href="/2023/08/18/el-ui-advance/"/>
      <url>/2023/08/18/el-ui-advance/</url>
      
        <content type="html"><![CDATA[<h2 id="el-table-columnå‹ç¼©å•è¡Œ">el-table-columnå‹ç¼©å•è¡Œ</h2><p>div</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content(æ›¿æ¢)<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å†…å®¹(æ›¿æ¢)<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123; row &#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tooltip</span> <span class="token attr-name">:content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row.content(æ›¿æ¢)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>oneline<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>&#123;&#123; row.content(æ›¿æ¢) &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tooltip</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>style</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.oneline</span> <span class="token punctuation">&#123;</span>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>  <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>  <span class="token comment">/* å°†å¯¹è±¡ä½œä¸ºå¼¹æ€§ä¼¸ç¼©ç›’å­æ¨¡å‹æ˜¾ç¤º */</span>  <span class="token property">display</span><span class="token punctuation">:</span> -webkit-box<span class="token punctuation">;</span>  <span class="token comment">/* é™åˆ¶åœ¨ä¸€ä¸ªå—å…ƒç´ æ˜¾ç¤ºçš„æ–‡æœ¬çš„è¡Œæ•° */</span>  <span class="token comment">/* -webkit-line-clamp å…¶å®æ˜¯ä¸€ä¸ªä¸è§„èŒƒå±æ€§ï¼Œä½¿ç”¨äº†WebKitçš„CSSæ‰©å±•å±æ€§ï¼Œè¯¥æ–¹æ³•é€‚ç”¨äºWebKitæµè§ˆå™¨åŠç§»åŠ¨ç«¯ï¼›*/</span>  <span class="token property">-webkit-line-clamp</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>  <span class="token comment">/* è®¾ç½®æˆ–æ£€ç´¢ä¼¸ç¼©ç›’å¯¹è±¡çš„å­å…ƒç´ çš„æ’åˆ—æ–¹å¼ */</span>  <span class="token property">-webkit-box-orient</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–‡æœ¬å¤åˆ¶">æ–‡æœ¬å¤åˆ¶</h2><p>div</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- æŒ‰é’®å¤åˆ¶ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>medium<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">plain</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleCopy(respData.pass)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> &#123;&#123; respData.pass &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- è¡¨æ ¼å¤åˆ¶ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>st_loginname<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç™»å½•å<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123; row &#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleCopy(row.st_loginname)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123; row.st_loginname &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>script</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">handleCopy</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'æ— å†…å®¹'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> textarea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span>    textarea<span class="token punctuation">.</span>value <span class="token operator">=</span> text    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span>    textarea<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'copy'</span><span class="token punctuation">)</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'å¤åˆ¶æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºwebsocketå®ç°å®æ—¶æ—¥å¿—è¾“å‡º</title>
      <link href="/2023/08/17/websocket-log/"/>
      <url>/2023/08/17/websocket-log/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç”±äºæœ¬demoæ˜¯åœ¨åŸæœ‰æœåŠ¡è¿›è¡Œæ‹“å±•, ä¸ºå‡å°‘è€¦åˆæ•…æ–°å»ºæ¨¡å—</p></blockquote><h2 id="ä¾èµ–åŠé…ç½®æ–‡ä»¶">ä¾èµ–åŠé…ç½®æ–‡ä»¶</h2><h3 id="pomæ–‡ä»¶">pomæ–‡ä»¶</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>publish-plat-log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">></span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">></span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- springboot websocket --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-websocket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- thymeleafæ¨¡æ¿ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨æ„:</p><p>ç”±äºæ­¤æ¨¡å—æ²¡æœ‰å¯åŠ¨ç±», æ•…æœ¬ä¾èµ–åŠçˆ¶ä¾èµ–ä¸èƒ½ä¸èƒ½æœ‰æ‰“åŒ…æ’ä»¶</p><p>spring-boot-maven-plugin</p></blockquote><h3 id="applicationæ–‡ä»¶">applicationæ–‡ä»¶</h3><p>æ­¤å¤„å–åä¸º<code>application-wslog.yml</code></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">thymeleaf</span><span class="token punctuation">:</span>    <span class="token key atrule">prefix</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/static/view/    <span class="token key atrule">check-template</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">config</span><span class="token punctuation">:</span>    <span class="token key atrule">activate</span><span class="token punctuation">:</span>      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> wslog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸»æ¨¡å—æ·»åŠ é…ç½®å¼•ç”¨æ”¹æ¨¡å—</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev    <span class="token key atrule">include</span><span class="token punctuation">:</span> wslog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="èµ„æºåŒ…">èµ„æºåŒ…</h2><p><code>resources</code> ä¸‹æ–°å»º <code>static</code> åŒ…</p><h3 id="jquery-jså·¥å…·åŒ…">jquery jså·¥å…·åŒ…</h3><p>æ”¾åœ¨<code>static.js</code>, ç”¨äºé¡µé¢å¼•ç”¨</p><h3 id="HTMLé¡µé¢">HTMLé¡µé¢</h3><p><code>static.view</code> ä¸‹æ–°å»º <code>logging.html</code></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!DOCTYPE</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--è§£å†³idea thymeleaf è¡¨è¾¾å¼æ¨¡æ¿æŠ¥çº¢æ³¢æµªçº¿--></span><span class="token comment">&lt;!--suppress ALL --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>å®æ—¶æ—¥å¿—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- jquery --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@&#123;/js/jquery-1.9.1.min.js&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ ‡é¢˜ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>å®æ—¶æ—¥å¿—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ˜¾ç¤ºåŒº --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loggingText<span class="token punctuation">"</span></span> <span class="token attr-name">contenteditable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>     <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> ghostwhite<span class="token punctuation">;</span> <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ“ä½œæ  --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#loggingText'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 35px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>æ¸…å±<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#loggingText'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">scrollTop</span><span class="token operator">:</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#loggingText'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scrollHeight<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span>            <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 35px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>æ»šåŠ¨è‡³åº•éƒ¨    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>loggingAutoBottom<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'å¼€å¯è‡ªåŠ¨æ»šåŠ¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'å…³é—­è‡ªåŠ¨æ»šåŠ¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>window<span class="token punctuation">.</span>loggingAutoBottom <span class="token operator">=</span> <span class="token operator">!</span>window<span class="token punctuation">.</span>loggingAutoBottom</span><span class="token punctuation">"</span></span></span>            <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 35px<span class="token punctuation">;</span> </span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>å¼€å¯è‡ªåŠ¨æ»šåŠ¨    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token comment">//websocketå¯¹è±¡</span>    <span class="token keyword">let</span> websocket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'WebSocket'</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        websocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"ws://localhost:28822/websocket/logging"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ä¸æ”¯æŒWebSocket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•</span>    websocket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å‘ç”Ÿé”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">//è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•</span>    websocket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥æˆåŠŸ"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">//æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span>    websocket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//è¿½åŠ </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//æ—¥å¿—å†…å®¹</span>            <span class="token keyword">let</span> $loggingText <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#loggingText"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            $loggingText<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data <span class="token operator">+</span> <span class="token string">'&lt;br/>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// //æ˜¯å¦å¼€å¯è‡ªåŠ¨åº•éƒ¨</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>loggingAutoBottom<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//æ»šåŠ¨æ¡è‡ªåŠ¨åˆ°æœ€åº•éƒ¨</span>                $loggingText<span class="token punctuation">.</span><span class="token function">scrollTop</span><span class="token punctuation">(</span>$loggingText<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scrollHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•</span>    websocket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å…³é—­"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®ç°ä»£ç ">å®ç°ä»£ç </h2><h3 id="Endpoint">Endpoint</h3><p>WebSocketè·å–å®æ—¶æ—¥å¿—å¹¶è¾“å‡ºåˆ°Webé¡µé¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">ch<span class="token punctuation">.</span>qos<span class="token punctuation">.</span>logback<span class="token punctuation">.</span>classic<span class="token punctuation">.</span></span><span class="token class-name">LoggerContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerEndpoint</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span><span class="token comment">/** * WebSocketè·å–å®æ—¶æ—¥å¿—å¹¶è¾“å‡ºåˆ°Webé¡µé¢ */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ServerEndpoint</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/websocket/logging"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoggingWSServer</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®</span>    <span class="token keyword">private</span> <span class="token class-name">Session</span> session<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> sessionId<span class="token punctuation">;</span>    <span class="token comment">/**     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•     */</span>    <span class="token annotation punctuation">@OnOpen</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token class-name">Session</span> session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> session<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sessionId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LoggerContext</span> lc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoggerContext</span><span class="token punctuation">)</span><span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getILoggerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç¬¬äºŒæ­¥ï¼šè·å–æ—¥å¿—å¯¹è±¡ ï¼ˆæ—¥å¿—æ˜¯æœ‰ç»§æ‰¿å…³ç³»çš„ï¼Œå…³é—­ä¸Šå±‚ï¼Œä¸‹å±‚å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ä¹Ÿä¼šå…³é—­ï¼‰</span>        <span class="token class-name"><span class="token namespace">ch<span class="token punctuation">.</span>qos<span class="token punctuation">.</span>logback<span class="token punctuation">.</span>classic<span class="token punctuation">.</span></span>Logger</span> rootLogger <span class="token operator">=</span> lc<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MyAppender</span> myAppender <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyAppender</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        myAppender<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>lc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è‡ªå®šä¹‰Appenderè®¾ç½®name</span>        myAppender<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"myAppender"</span> <span class="token operator">+</span> sessionId<span class="token punctuation">)</span><span class="token punctuation">;</span>        myAppender<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        rootLogger<span class="token punctuation">.</span><span class="token function">addAppender</span><span class="token punctuation">(</span>myAppender<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====æ³¨å…¥æˆåŠŸ===="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•     */</span>    <span class="token annotation punctuation">@OnClose</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">LoggerContext</span> lc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoggerContext</span><span class="token punctuation">)</span><span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getILoggerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name"><span class="token namespace">ch<span class="token punctuation">.</span>qos<span class="token punctuation">.</span>logback<span class="token punctuation">.</span>classic<span class="token punctuation">.</span></span>Logger</span> rootLogger <span class="token operator">=</span> lc<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€šè¿‡nameç§»é™¤Appender</span>        rootLogger<span class="token punctuation">.</span><span class="token function">detachAppender</span><span class="token punctuation">(</span><span class="token string">"myAppender"</span> <span class="token operator">+</span> sessionId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====ç§»é™¤æˆåŠŸ===="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * æœåŠ¡å™¨ä¸»åŠ¨å‘é€æ¶ˆæ¯     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">getBasicRemote</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendText</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="WebSocketConfig">WebSocketConfig</h3><p>æ­¤å¤„ä¸ºäº†å·æ‡’å°†æµ‹è¯•controllerä¹Ÿæ”¾åœ¨æ­¤å¤„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">ApplicationRunner</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>server<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">ServerEndpointExporter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">UnknownHostException</span></span><span class="token punctuation">;</span><span class="token comment">/** * WebSocketé…ç½® */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSocketConfig</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * ç”¨é€”ï¼šæ‰«æå¹¶æ³¨å†Œæ‰€æœ‰æºå¸¦@ServerEndpointæ³¨è§£çš„å®ä¾‹ã€‚ @ServerEndpoint("/websocket")     * PSï¼šå¦‚æœä½¿ç”¨å¤–éƒ¨å®¹å™¨ åˆ™æ— éœ€æä¾›ServerEndpointExporterã€‚     */</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ServerEndpointExporter</span> <span class="token function">serverEndpointExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServerEndpointExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * ç«¯å£     */</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;server.port&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ApplicationRunner</span> <span class="token function">applicationRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> applicationArguments <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">InetAddress</span> ia <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//è·å–æœ¬æœºå†…ç½‘IP</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¯åŠ¨æˆåŠŸï¼š"</span> <span class="token operator">+</span> <span class="token string">"http://"</span> <span class="token operator">+</span> ia<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownHostException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * è·³è½¬å®æ—¶æ—¥å¿—     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/logging"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">logging</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"logging.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * æµ‹è¯•æ—¥å¿—è¾“å‡º     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testLog"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æµ‹è¯•æ—¥å¿—è¾“å‡º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"å¼‚å¸¸æµ‹è¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token string">"testLog"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ—¥å¿—æ ¼å¼æ‹“å±•">æ—¥å¿—æ ¼å¼æ‹“å±•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">ch<span class="token punctuation">.</span>qos<span class="token punctuation">.</span>logback<span class="token punctuation">.</span>classic<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">ILoggingEvent</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">ch<span class="token punctuation">.</span>qos<span class="token punctuation">.</span>logback<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">AppenderBase</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAppender</span> <span class="token keyword">extends</span> <span class="token class-name">AppenderBase</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ILoggingEvent</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LoggingWSServer</span> webSocketServer<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">MyAppender</span><span class="token punctuation">(</span><span class="token class-name">LoggingWSServer</span> webSocketServer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>webSocketServer <span class="token operator">=</span> webSocketServer<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * æ·»åŠ æ—¥å¿— * @param iLoggingEvent */</span><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">ILoggingEvent</span> iLoggingEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>webSocketServer<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token function">doLayout</span><span class="token punctuation">(</span>iLoggingEvent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * æ ¼å¼åŒ–æ—¥å¿— * @param event */</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doLayout</span><span class="token punctuation">(</span><span class="token class-name">ILoggingEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">StringBuilder</span> sbuf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> event <span class="token operator">&amp;&amp;</span> <span class="token keyword">null</span> <span class="token operator">!=</span> event<span class="token punctuation">.</span><span class="token function">getMDCPropertyMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">SimpleDateFormat</span> simpleDateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss:SSS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>simpleDateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getThreadName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getLoggerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getFormattedMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"\""</span><span class="token punctuation">,</span> <span class="token string">"\\\""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>sbuf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> sbuf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®Œæ•´å±‚çº§ç»“æ„">å®Œæ•´å±‚çº§ç»“æ„</h2><p><img src="../websocket-log/image-20230818095923636.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nutz.daoç¬”è®°æ•´ç†</title>
      <link href="/2023/08/15/nutz/"/>
      <url>/2023/08/15/nutz/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€å°è£…">åŸºç¡€å°è£…</h2><p>å°è£…å•ä¸ªå¯¹è±¡æŸ¥è¯¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 1.è·å–dao</span><span class="token class-name">Dao</span> dao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NutDao</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼ªä»£ç </span><span class="token class-name">Sql</span> sql <span class="token operator">=</span> <span class="token class-name">Sqls</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"select * from tb_user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParam</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"å°æ˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼ªä»£ç </span><span class="token comment">// 2.ä½¿ç”¨nutzè‡ªå¸¦çš„reocrdå¯¹è±¡</span>sql<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token class-name">Sqls</span><span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 3.å®ä½“è®¾ç½®</span>sql<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span>dao<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å¯è‡ªå®šä¹‰å®ä½“</span><span class="token comment">// 4.æ‰§è¡Œsql</span>dao<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 5.æ¥æ”¶å¯¹è±¡</span><span class="token class-name">Record</span> record <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤å¤„æ˜¯æ¥æ”¶å•ä¸ªå¯¹è±¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°è£…ç»“åˆå¯¹è±¡æŸ¥è¯¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">sql<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token class-name">Sqls</span><span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sql<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span>dao<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å¯è‡ªå®šä¹‰å®ä½“</span>dao<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Record</span><span class="token punctuation">></span></span> records <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token class-name">Record</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å°è£…æ•°å­—æŸ¥è¯¢</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">sql<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token class-name">Sqls</span><span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dao<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> count <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å°è£…DDL</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">sql<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token class-name">Sqls</span><span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dao<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> rows <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">getUpdateCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="conditionèŠ±å¼ç”¨æ³•"><code>condition</code>èŠ±å¼ç”¨æ³•</h2><p>é¦–å…ˆåˆ›å»º<code>sql</code>å¯¹è±¡(æ³¨æ„æ­¤å¤„çš„å ä½ç¬¦æ˜¯<code>$</code>)</p><p><code>select * from tb_xxx $condition</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Cnd</span><span class="token punctuation">.</span><span class="token function">exps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å°†ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼å°è£…ä¸ºæ¡ä»¶è¡¨è¾¾å¼ç»„</span><span class="token class-name">Cnd</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å°†ä¸€ä¸ªè¡¨è¾¾å¼å°è£…æˆä¸€ä¸ªCndå®ä¾‹</span><span class="token comment">// é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•ç»„åˆæ­é…å½¢æˆåµŒå¥—, å¦‚:</span><span class="token class-name">Cnd</span> cnd <span class="token operator">=</span> <span class="token class-name">Cnd</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"between"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>                <span class="token class-name">Cnd</span><span class="token punctuation">.</span><span class="token function">NEW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">andIn</span><span class="token punctuation">(</span><span class="token string">"city"</span><span class="token punctuation">,</span> <span class="token string">"ä¸Šæµ·"</span><span class="token punctuation">,</span> <span class="token string">"å¹¿ä¸œ"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">orIn</span><span class="token punctuation">(</span><span class="token string">"hobby"</span><span class="token punctuation">,</span> <span class="token string">"ç¯®çƒ"</span><span class="token punctuation">,</span> <span class="token string">"ç½‘çƒ"</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>                <span class="token class-name">Cnd</span>                        <span class="token comment">// ç”Ÿæˆæ¡ä»¶ç»„(åå¯ç»§ç»­æ‹¼æ¥)</span>                        <span class="token punctuation">.</span><span class="token function">exps</span><span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">"å¥³"</span><span class="token punctuation">)</span>                        <span class="token comment">// åŠ¨æ€æ¡ä»¶</span>                        <span class="token punctuation">.</span><span class="token function">andEX</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token string">"like"</span><span class="token punctuation">,</span> <span class="token string">"180"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">andEX</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        <span class="token comment">// é™æ€æ¡ä»¶,ç›´æ¥æ‹¼å…¥sql,ä¸åšä»»ä½•è½¬ä¹‰</span>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Static</span><span class="token punctuation">(</span><span class="token string">"isnull(is_delete)"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆåçš„<code>sql</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token string">'å¼ ä¸‰'</span> <span class="token operator">AND</span> age <span class="token operator">BETWEEN</span> <span class="token number">19</span> <span class="token operator">AND</span> <span class="token number">29</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>city <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'ä¸Šæµ·'</span><span class="token punctuation">,</span><span class="token string">'å¹¿ä¸œ'</span><span class="token punctuation">)</span> <span class="token operator">OR</span> hobby <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'ç¯®çƒ'</span><span class="token punctuation">,</span><span class="token string">'ç½‘çƒ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">(</span>gender<span class="token operator">=</span><span class="token string">'å¥³'</span> <span class="token operator">AND</span> height <span class="token operator">LIKE</span> <span class="token string">'180'</span><span class="token punctuation">)</span> <span class="token operator">AND</span>  isnull<span class="token punctuation">(</span>is_delete<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="likeå·¦å³æ¨¡ç³Š"><code>like</code>å·¦å³æ¨¡ç³Š</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Cnd.NEW().where().andLike();</span><span class="token class-name">SimpleCriteria</span> cri <span class="token operator">=</span> <span class="token class-name">Cnd</span><span class="token punctuation">.</span><span class="token function">cri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cri<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andLike</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"æå››"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å»ºè®®ä¼ ignoreCase = false, å¦åˆ™ä¼šè¢«æ‹¼æ¥æˆ LOWER(XXX) LIKE LOWER('%XXX%')</span>cri<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andLike</span><span class="token punctuation">(</span><span class="token string">"idcard"</span><span class="token punctuation">,</span> <span class="token string">"330"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å³ä¾§æ¨¡ç³ŠæŸ¥è¯¢</span>cri<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andLike</span><span class="token punctuation">(</span><span class="token string">"hobby"</span><span class="token punctuation">,</span> <span class="token string">"è¿åŠ¨"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"%"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”Ÿæˆåçš„<code>sql</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'%æå››%'</span> <span class="token operator">AND</span> LOWER<span class="token punctuation">(</span>idcard<span class="token punctuation">)</span> <span class="token operator">LIKE</span> LOWER<span class="token punctuation">(</span><span class="token string">'%330%'</span><span class="token punctuation">)</span> <span class="token operator">AND</span> hobby <span class="token operator">LIKE</span> <span class="token string">'è¿åŠ¨%'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å®ä½“åŠ¨æ€æ›´æ–°">å®ä½“åŠ¨æ€æ›´æ–°</h2><p>ç”±äº<code>nutz.dao</code>é»˜è®¤<code>update</code>æ“ä½œæ˜¯å…¨å­—æ®µæ›´æ–°, å¦‚æœåªæ›´æ–°å®ä½“ç±»ä¸ä¸ºç©ºçš„éœ€è¦è®¾ç½®å­—æ®µè¿‡æ»¤å™¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">dao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>    <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIsDel</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token class-name">FieldFilter</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token class-name">Cnd</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">"is_del"</span><span class="token punctuation">,</span><span class="token string">"="</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Database </tag>
            
            <tag> Nutz </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx-locationé…ç½®</title>
      <link href="/2023/08/14/nginx-location/"/>
      <url>/2023/08/14/nginx-location/</url>
      
        <content type="html"><![CDATA[<h3 id="proxy-pass-ç«¯å£åç´§è·Ÿ"><code>proxy_pass</code> ç«¯å£åç´§è·Ÿ <code>/</code></h3><img src="../nginx-location/image-20230814221948781.png" alt="P1" width="70%" /><img src="../nginx-location/image-20230814224425902.png"  alt="P2" width="70%" /><blockquote><p><code>proxy_pass</code>æœ‰<code>/</code> ğŸ‘†ğŸ‘†</p><p><code>location</code> åªå±äºéƒ¨åˆ†åŒ¹é…, ä¸å±äºè¯·æ±‚éƒ¨åˆ†, ä¼šåœ¨è¯·æ±‚è·¯å¾„ä¸­åˆ é™¤</p><ol><li>ä»£ç†è·¯å¾„ =&gt;æ›¿æ¢=&gt; ç›‘å¬è·¯å¾„ : <code>http://localhost:23323//api/server/user</code></li><li>åˆ é™¤locationè·¯å¾„: <code>http://localhost:23323/server/user</code> (P1)  <code>http://localhost:23323//server/user</code>(P2)</li></ol></blockquote><hr><h3 id="proxy-pass-ç«¯å£åä¸è·Ÿ"><code>proxy_pass</code> ç«¯å£åä¸è·Ÿ <code>/</code></h3><img src="../nginx-location/image-20230814224536607.png" width="70%" /><img src="../nginx-location/image-20230814224604020.png" width="70%" /><blockquote><p><code>proxy_pass</code>æ—  <code>/</code> ğŸ‘†ğŸ‘†</p><p><code>location</code> ä¸ç®¡å¸¦ä¸å¸¦ <code>/</code></p><p>éƒ½ä¼šå°† <code>/api</code> éƒ½æ·»åŠ è‡³ <code>proxy_pass</code> è·¯å¾„å, å¹¶ä½œä¸ºçœŸå®è¯·æ±‚è·¯å¾„</p></blockquote><hr><h3 id="proxy-pass-åè¿˜æœ‰è·¯å¾„"><code>proxy_pass</code> åè¿˜æœ‰è·¯å¾„</h3><img src="../nginx-location/image-20230814225040203.png" alt="P3" width="70%" /><img src="../nginx-location/image-20230814225243126.png" alt="P4" width="70%" /><blockquote><p>ä¸ç¬¬ä¸€ç§æƒ…å†µä¸€è‡´ğŸ‘†ğŸ‘†</p><ol><li><p>ä»£ç†è·¯å¾„ æ›¿æ¢ ç›‘å¬è·¯å¾„ : <code>http://localhost:23323/route//api/demo</code></p></li><li><p>åˆ é™¤ locationè·¯å¾„:</p></li></ol><p><code>http://localhost:23323/route/demo</code> (P3)</p><p><code>http://localhost:23323/route//demo</code> (P4)</p></blockquote><img src="../nginx-location/image-20230814225957250.png" alt="P5" width="70%" /><img src="../nginx-location/image-20230814230221058.png" alt="P6" width="70%" /><blockquote><p>ä¸ç¬¬ä¸€ç§æƒ…å†µä¸€è‡´ğŸ‘†ğŸ‘†</p><ol><li><p>ä»£ç†è·¯å¾„ æ›¿æ¢ ç›‘å¬è·¯å¾„: <code>http://localhost:23323/route/api/demo</code></p></li><li><p>åˆ é™¤ locationè·¯å¾„:</p></li></ol><p><code>http://localhost:23323/routedemo</code> (P5)</p><p><code>http://localhost:23323/route/demo</code> (P6)</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªå®šä¹‰çº¿ç¨‹æ± </title>
      <link href="/2023/08/06/diy-thread-pool/"/>
      <url>/2023/08/06/diy-thread-pool/</url>
      
        <content type="html"><![CDATA[<h1>è‡ªå®šä¹‰çº¿ç¨‹æ± demo</h1><h2 id="æµç¨‹å›¾">æµç¨‹å›¾</h2><pre class="mermaid">graph LRsubgraph Thread Pool        t1[t1]        t2[t2]        t3[t3]endsubgraph Blocking Queuetask1(task1)task2(task2)task3(task3)endm[main]m  --put--> task3task3 --> task2task2 --> task1worker[[worker]]task1 --poll--> t1 -.- workertask1 -.poll.-> t2 -.- workertask1 -.poll.-> t3 -.- worker</pre><blockquote><p>è§’è‰²è¯´æ˜:</p><p>Blocking Queue: é˜»å¡é˜Ÿåˆ—, mainçº¿ç¨‹è´Ÿè´£å°†ä»»åŠ¡æäº¤åˆ°é˜»å¡é˜Ÿåˆ—ä¸­, ç”¨äºå­˜å‚¨ä»»åŠ¡</p><p>task: å¾…æ‰§è¡Œä»»åŠ¡</p><p>Thread Pool: çº¿ç¨‹æ± , ç”¨äºå­˜å‚¨çº¿ç¨‹å¯¹è±¡</p><p>t: çº¿ç¨‹å¯¹è±¡, ç”¨æ¥æ‰§è¡Œæ¯ä¸ªä»»åŠ¡</p><p>worker: æ­¤å¤„å°†æ¯ä¸ªçº¿ç¨‹æ¯”ä½œå·¥äºº</p></blockquote><h2 id="ç±»å›¾è¯´æ˜">ç±»å›¾è¯´æ˜</h2><pre class="mermaid">classDiagramclass BlockingQueue~T~ {-Deque~T~ queue // é˜»å¡é˜Ÿåˆ—-ReentrantLock lock // é”-Condition fullWaitCond-Condition emptyWaitCond-int capcity // é˜Ÿåˆ—å¤§å°+poll(long timeout, TimeUnit unit) T+put(T t) void}class ThreadPool {-BlockingQueue~Runnable~ taskQueue // ä»»åŠ¡é˜Ÿåˆ—-HashSet~Worker~ works // çº¿ç¨‹é›†åˆ-int coreSize // æ ¸å¿ƒçº¿ç¨‹æ•°-long timeout // è¶…æ—¶æ—¶é—´-TimeUnit timeUnit // æ—¶é—´å•ä½+execute(Runnable task) void}class Worker{-Runnable task // çº¿ç¨‹ä»»åŠ¡+run() void}Thread <|-- Worker: ç»§æ‰¿ThreadPool *-- BlockingQueue~T~: ç»„åˆThreadPool o-- Worker: èšåˆ</pre><h2 id="ä»£ç éƒ¨åˆ†">ä»£ç éƒ¨åˆ†</h2><h3 id="é˜»å¡é˜Ÿåˆ—">é˜»å¡é˜Ÿåˆ—</h3><p>é˜»å¡é˜Ÿåˆ—æ ¸å¿ƒåŠŸèƒ½æ˜¯é˜»å¡è·å–(çº¿ç¨‹æ± ä½¿ç”¨)å’Œæ¨å…¥å¾…æ‰§è¡Œä»»åŠ¡(mainçº¿ç¨‹ä½¿ç”¨)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayDeque</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Deque</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span><span class="token comment">/** * &lt;p>Description: * é˜»å¡é˜Ÿåˆ—, é‡‡ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 1. ä»»åŠ¡é˜Ÿåˆ—</span>    <span class="token keyword">private</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2. é”</span>    <span class="token keyword">private</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3. ç”Ÿäº§è€…æ¡ä»¶</span>    <span class="token keyword">private</span> <span class="token class-name">Condition</span> fullWaitCond <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 4. æ¶ˆè´¹è€…æ¡ä»¶</span>    <span class="token keyword">private</span> <span class="token class-name">Condition</span> emptyWaitCond <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 5. å®¹é‡</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> capcity<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">BlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capcity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>capcity <span class="token operator">=</span> capcity<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// é˜»å¡è·å–</span>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å°è¯•è·å–é”</span>        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å°†æ—¶é—´è½¬ä¸ºçº³ç§’</span>            <span class="token keyword">long</span> nanos <span class="token operator">=</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º, åˆ™è¿›å¾ªç¯å°è¯•</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// å¦‚æœç­‰å¾…æ—¶é—´ä¸º0, åˆ™è¿”å›ç©º</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>nanos <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token comment">// è¿›å…¥ç©ºé—²ç­‰å¾…, å¦‚æœåœ¨æ­¤æœŸé—´è¢«å”¤é†’, åˆ™é‡ç½®ç­‰å¾…æ—¶é—´(ç”¨äºé˜²æ­¢è™šå‡å”¤é†’)</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    nanos <span class="token operator">=</span> emptyWaitCond<span class="token punctuation">.</span><span class="token function">awaitNanos</span><span class="token punctuation">(</span>nanos<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// æå–é˜Ÿåˆ—é¦–ä¸ªä»»åŠ¡</span>            <span class="token class-name">T</span> t <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å”¤é†’æ¶ˆè´¹è€…æ¶ˆè´¹</span>            fullWaitCond<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> t<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å°è¯•è·å–é”</span>        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> capcity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// å¦‚æœå®¹é‡æ»¡, åˆ™å¾ªç¯ç­‰å¾…</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// è¿›å…¥é¥±å’Œç­‰å¾…</span>                    fullWaitCond<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// æ·»åŠ è‡³é˜Ÿåˆ—</span>            queue<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// åŠ å®Œé˜Ÿåˆ—å, é€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹</span>            emptyWaitCond<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Slf4j</span><span class="token punctuation">(</span>topic <span class="token operator">=</span> <span class="token string">"ThreadPool"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPool</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * ä»»åŠ¡é˜Ÿåˆ—     */</span>    <span class="token keyword">private</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> taskQueue<span class="token punctuation">;</span>    <span class="token comment">// çº¿ç¨‹é›†åˆ: æ­¤å¤„å°†çº¿ç¨‹åšä¸€ä¸ªåŒ…è£…</span>    <span class="token keyword">private</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Worker</span><span class="token punctuation">></span></span> works <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> coreSize<span class="token punctuation">;</span>    <span class="token comment">// è¶…æ—¶æ—¶é—´, ä¸€æ—¦è¶…è¿‡è¶…æ—¶æ—¶é—´, åˆ™å…³é—­çº¿ç¨‹</span>    <span class="token keyword">private</span> <span class="token keyword">long</span> timeout<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">TimeUnit</span> timeUnit<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">ThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> coreSize<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> timeUnit<span class="token punctuation">,</span> <span class="token keyword">int</span> queueCapcity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>coreSize <span class="token operator">=</span> coreSize<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>timeUnit <span class="token operator">=</span> timeUnit<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>taskQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>queueCapcity<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * æ‰§è¡Œ     *     * @param task     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœå½“å‰çº¿ç¨‹ &lt; æ ¸å¿ƒçº¿ç¨‹æ•°æ—¶</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>works<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> coreSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Worker</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"æ–°å¢ worker &#123;&#125; task=&#123;&#125;"</span><span class="token punctuation">,</span> worker<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>                works<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>                worker<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— &#123;&#125;"</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>                taskQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * çº¿ç¨‹å¯¹è±¡     */</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token class-name">Runnable</span> task<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>task <span class="token operator">=</span> task<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// æ‰§è¡Œä»»åŠ¡</span>            <span class="token comment">// 1) å½“æœ‰ä»»åŠ¡æ—¶</span>            <span class="token comment">// 2) å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>task <span class="token operator">=</span> taskQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span> timeUnit<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨æ‰§è¡Œ...&#123;&#125; "</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>                    task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                    task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>works<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"worker è¢«ç§»é™¤ &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                works<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•ç±»">æµ‹è¯•ç±»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">class</span> <span class="token class-name">TestPool</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ThreadPool</span> threadPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”±ä¸»çº¿ç¨‹ç»™çº¿ç¨‹æ± æäº¤ä»»åŠ¡</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>            threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1>çº¿ç¨‹æ± å·¥ä½œæµç¨‹</h1><h2 id="JDKè‡ªå¸¦">JDKè‡ªå¸¦</h2><pre class="mermaid">graph LR;c([æ·»åŠ ä»»åŠ¡])q2(çº¿ç¨‹æ•° < coreSize)q3(é˜»å¡é˜Ÿåˆ—æ˜¯å¦å·²æ»¡)q4(çº¿ç¨‹æ•° < maxSize)a1[æ·»åŠ å·¥ä½œçº¿ç¨‹å¹¶æ‰§è¡Œ]a2[æ·»åŠ è‡³é˜»å¡é˜Ÿåˆ—å¹¶ç­‰å¾…å·¥ä½œçº¿ç¨‹æ¥æå–]a3[æ·»åŠ æ•‘æ€¥çº¿ç¨‹å¹¶æ‰§è¡Œ]r[æ‹’ç»ä»»åŠ¡]q4 --å¦--> rc --> q2 --å¦--> q3 --æ˜¯--> q4q2 --æ˜¯--> a1q3 --å¦--> a2q4 --æ˜¯--> a3</pre><pre class="mermaid">graph LR;c(æ·»åŠ ä»»åŠ¡)q2falseq3q4falsea1[æ·»åŠ å·¥ä½œçº¿ç¨‹å¹¶æ‰§è¡Œ]a2[æ·»åŠ è‡³é˜»å¡é˜Ÿåˆ—å¹¶ç­‰å¾…å·¥ä½œçº¿ç¨‹æ¥æå–]a3[æ·»åŠ æ•‘æ€¥çº¿ç¨‹å¹¶æ‰§è¡Œ]r[æ‹’ç»ä»»åŠ¡]q4 --å¦--> rc --> q2 --å¦--> q3 --æ˜¯--> q4q2 --æ˜¯--> a1q3 --å¦--> a2q4 --æ˜¯--> a3</pre><h2 id="Tomcat-NIO-EndPoint">Tomcat NIO EndPoint</h2><h3 id="å…¨æµç¨‹">å…¨æµç¨‹</h3><pre class="mermaid">graph LR;ll(LimitLatch) --> a(acceptor)sc1(SocketChannel 1)sc2(SocketChannel 2)a --> sc1a --> sc2p(Poller)sc1 --æœ‰è¯»--> psc2 --æœ‰è¯»--> psubgraph Executorw1(worker 1)w2(worker 2)endp --socketProcessor--> w1p --socketProcessor--> w2</pre><ul><li>LimitLatch ç”¨æ¥é™æµ, å¯ä»¥æ§åˆ¶æœ€å¤§è¿æ¥ä¸ªæ•°, ç±»ä¼¼ JUC ä¸­çš„ Semphore</li><li>Acceptoråªè´Ÿè´£[æ¥æ”¶æ–°çš„ socket è¿æ¥]</li><li>Poller åªè´Ÿè´£ç›‘å¬ socket channel æ˜¯å¦æœ‰ [å¯è¯»çš„ I/O äº‹ä»¶]</li><li>ä¸€æ—¦å¯è¯», å°è£…ä¸€ä¸ªä»»åŠ¡å¯¹è±¡(socketProcessor), æäº¤ç»™ Executor çº¿ç¨‹æ± å¤„ç†</li><li>Executor çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æœ€ç»ˆè´Ÿè´£ [å¤„ç†è¯·æ±‚]</li></ul><h3 id="ç½‘ç»œå±‚æµç¨‹">ç½‘ç»œå±‚æµç¨‹</h3><pre class="mermaid">graph LR;c([æ·»åŠ ä»»åŠ¡])q1(ä»»åŠ¡æ•° < coreSize)q2(ä»»åŠ¡æ•° < maxSize)a1[åŠ å…¥é˜Ÿåˆ—]a2[åˆ›å»ºæ•‘æ€¥çº¿ç¨‹]c --> q1 --æ˜¯--> a1q1 --å¦--> q2 --å¦--> a1q2 --æ˜¯--> a2</pre><pre class="mermaid">graph LR;c(æ·»åŠ ä»»åŠ¡)q1falseq2falsea1[åŠ å…¥é˜Ÿåˆ—]a2[åˆ›å»ºæ•‘æ€¥çº¿ç¨‹]c --> q1 --æ˜¯--> a1q1 --å¦--> q2 --å¦--> a1q2 --æ˜¯--> a2</pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Mermaid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lambda</title>
      <link href="/2023/08/05/lambda/"/>
      <url>/2023/08/05/lambda/</url>
      
        <content type="html"><![CDATA[<h1>è‡ªå®šä¹‰lambdaç”¨æ³•</h1><h2 id="åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•</h2><h3 id="supplier">supplier</h3><blockquote><p>æä¾›è€…: æ— ä¸­ç”Ÿæœ‰  ()-&gt;ç»“æœ</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> tSupplier<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">T</span> t <span class="token operator">=</span> tSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å·²è·å–å‚æ•° >>> "</span> <span class="token operator">+</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="function">function</h3><blockquote><p>å‡½æ•°: ä¸€ä¸ªå‚æ•°ä¸€ä¸ªç»“æœ   (å‚æ•°)-&gt;ç»“æœ,  BiFunction (å‚æ•°1,å‚æ•°2)-&gt;ç»“æœ</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token string">"jack"</span><span class="token punctuation">,</span> <span class="token string">"ben"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ String::toUpperCase ä½œä¸º Function ï¼Œå°†åå­—è½¬æ¢ä¸ºå¤§å†™å½¢å¼</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> upperList <span class="token operator">=</span> <span class="token function">demo2</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>upperList<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ String::length ä½œä¸º Function ï¼Œå°†åå­—è½¬æ¢ä¸ºé•¿åº¦</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> lengthList <span class="token operator">=</span> <span class="token function">demo2</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>lengthList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä½¿ç”¨ Function&lt;T, R> ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡ä¼ é€’ä¸åŒçš„ Function å®ç°æ¥å®ç°ä¸åŒçš„è½¬æ¢æ“ä½œã€‚</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">></span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">></span></span> <span class="token function">demo2</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> list<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">></span></span> function<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//  List&lt;R> collect = list.stream().map(function::apply).collect(Collectors.toList());</span>    <span class="token keyword">return</span> list        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>function<span class="token punctuation">)</span> <span class="token comment">// æ–¹æ³•å¼•ç”¨</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * [TOM, JACK, BEN] * [3, 4, 3] */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="consumer">consumer</h3><blockquote><p>æ¶ˆè´¹è€… ä¸€ä¸ªå‚æ•°æ²¡ç»“æœ  (å‚æ•°)-&gt;void,      BiConsumer (å‚æ•°1,å‚æ•°2)-&gt;void</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token string">"jack"</span><span class="token punctuation">,</span> <span class="token string">"ben"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ‰“å°åˆ—è¡¨</span>    <span class="token function">demo3</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è½¬ä¸ºå¤§å†™åæ‰“å°</span>    <span class="token function">demo3</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> item <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">demo3</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> list<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> consumer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>consumer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šçº¿ç¨‹ä¸‹çš„ABAé—®é¢˜ä»¥åŠjucåŒ…çš„ä½¿ç”¨-lambdaè®¾è®¡">å¤šçº¿ç¨‹ä¸‹çš„ABAé—®é¢˜ä»¥åŠjucåŒ…çš„ä½¿ç”¨(lambdaè®¾è®¡)</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">demo</span><span class="token punctuation">(</span>            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token operator">-></span> array<span class="token punctuation">.</span>length<span class="token punctuation">,</span>            <span class="token punctuation">(</span>array<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">-></span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">,</span>            array <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">demo</span><span class="token punctuation">(</span>            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">AtomicIntegerArray</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token operator">-></span> array<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">(</span>array<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">-></span> array<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>            array <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">demo</span><span class="token punctuation">(</span>        <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> arraySupplier<span class="token punctuation">,</span>        <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> lengthFun<span class="token punctuation">,</span>        <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> putConsumer<span class="token punctuation">,</span>        <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> printConsumer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">></span></span> ts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ•°ç»„</span>    <span class="token class-name">T</span> array <span class="token operator">=</span> arraySupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ•°ç»„é•¿åº¦ l</span>    <span class="token keyword">int</span> length <span class="token operator">=</span> lengthFun<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰lä¸ªçº¿ç¨‹</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        ts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token comment">// æ¯ä¸ªçº¿ç¨‹å¯¹æ•°ç»„ä½œ 10000 æ¬¡æ“ä½œ</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">/*                 * [0, 0, 0, 0, 0, ...] å¯¹æ•°ç»„ä¸­æ¯ä¸ªæ•°è¿›è¡Œéå†, å¹¶åªå¯¹å…¶ä¸­ä¸€ä¸ªè¿›è¡Œç´¯åŠ , æ‰§è¡Œ10000æ¬¡                 * è¯´æ˜: åœ¨ç†æƒ³æ¡ä»¶ä¸‹, æ¯ä¸ªçº¿ç¨‹å¯ä»¥ç´¯åŠ é™æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ç´¯åŠ è‡³1000, 10ä¸ªçº¿ç¨‹å¯å°†æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ç´¯åŠ è‡³10000                 *      ä½†æ˜¯æ™®é€šçš„ ++ æ“ä½œéåŸå­æ€§, çº¿ç¨‹ä¸å®‰å…¨, æ— æ³•ç´¯åŠ åˆ°1000                 *      å› æ­¤æ­¤å¤„éœ€è¦ä½¿ç”¨ AtomicIntegerArray åŸå­ç±»                 */</span>                putConsumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> j <span class="token operator">%</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    ts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯åŠ¨æ‰€æœ‰çº¿ç¨‹</span>    ts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>t <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// ç­‰æ‰€æœ‰çº¿ç¨‹ç»“æŸ</span>    printConsumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dm-mysql</title>
      <link href="/2023/07/16/dm-mysql/"/>
      <url>/2023/07/16/dm-mysql/</url>
      
        <content type="html"><![CDATA[<h1>DM - mysql é€šç”¨è¯­æ³•/å¯¹æ¯”</h1><p>ç”±äºè¾¾æ¢¦æ•°æ®åº“è¯­æ³•æ›´åå‘oracle, åŒæ—¶å…¼å®¹éƒ¨åˆ†mysql, å› æ­¤æ•´ç†ä¸€äº›ä¸¤è€…éƒ½é€šç”¨è¯­æ³•. åŒæ—¶å¯¹ä¸é€šç”¨çš„è¯­æ³•åšäº›è®¸å¯¹æ¯”</p><h2 id="å­—ç¬¦-æ•°å­—">å­—ç¬¦/æ•°å­—</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 33 è¡¥åˆ° 8ä½, ç”¨0è¡¥å……</span><span class="token keyword">select</span> LPAD<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">select</span> RPAD<span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">-- instr/locate/position</span><span class="token keyword">select</span> INSTR<span class="token punctuation">(</span><span class="token string">'abcd'</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">)</span> <span class="token comment">-- INSTR(str, substr) è·å–å­ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•</span><span class="token keyword">select</span> LOCATE<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'abcd'</span><span class="token punctuation">)</span> <span class="token comment">-- LOCATE(substr,str) è¿”å›substråœ¨å­—ç¬¦ä¸²str çš„ç¬¬ä¸€ä¸ªå‡ºç°çš„ä½ç½®,æ²¡æœ‰åˆ™è¿”å›0 </span><span class="token keyword">select</span> POSITION<span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">in</span> <span class="token string">'abcd'</span><span class="token punctuation">)</span>  <span class="token comment">-- POSITION(substr in str) è¿”å›substråœ¨å­—ç¬¦ä¸²str çš„ç¬¬ä¸€ä¸ªå‡ºç°çš„ä½ç½®,æ²¡æœ‰åˆ™è¿”å›0</span><span class="token keyword">select</span> ifnull<span class="token punctuation">(</span><span class="token string">'1234'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token comment">-- eExpression1,eExpression2 ä¸ä¸º NULLçš„å€¼, éƒ½ä¸ºNULLåˆ™è¿”å›NULL</span><span class="token keyword">select</span> isnull<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- nullè¿”å›1, ä¸ä¸ºnullè¿”å›0</span><span class="token comment">-- å¤§å°å†™è½¬æ¢</span><span class="token keyword">select</span> upper<span class="token punctuation">(</span><span class="token string">'wangdi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> lower<span class="token punctuation">(</span><span class="token string">'WANGDI'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.4</span><span class="token punctuation">)</span> <span class="token comment">-- ç»å¯¹å€¼</span><span class="token keyword">select</span> CEIL<span class="token punctuation">(</span><span class="token number">1.09</span><span class="token punctuation">)</span> <span class="token comment">-- å‘ä¸Š</span><span class="token keyword">select</span> FLOOR<span class="token punctuation">(</span><span class="token number">1.08</span><span class="token punctuation">)</span>  <span class="token comment">-- å‘ä¸‹</span><span class="token keyword">select</span> <span class="token keyword">truncate</span><span class="token punctuation">(</span><span class="token number">1.23456</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">-- æˆªæ–­</span><span class="token keyword">select</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">-- å–æ¨¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ—¥æœŸæ—¶é—´">æ—¥æœŸæ—¶é—´</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> timestampadd<span class="token punctuation">(</span><span class="token keyword">second</span><span class="token punctuation">,</span> floor<span class="token punctuation">(</span>DBMS_RANDOM<span class="token punctuation">.</span><span class="token keyword">VALUE</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2023-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">-- éšæœºè·å–2023-01-01 00:00:00 ä¹‹ä¸Š45såˆ°120sä¹‹é—´çš„æ—¶é—´</span><span class="token comment">-- ====è·å–å…·ä½“æ—¶é—´</span><span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">DAY</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> curtime<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- é€šç”¨</span><span class="token comment">-- ====æ ¼å¼åŒ–æ—¥æœŸ</span><span class="token keyword">select</span> date_format<span class="token punctuation">(</span><span class="token string">'2022-02-02'</span><span class="token punctuation">,</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date_format<span class="token punctuation">(</span><span class="token string">'2022-02-02'</span><span class="token punctuation">,</span><span class="token string">'%Y"å¹´"%m"æœˆ"%d'</span><span class="token punctuation">)</span>   <span class="token comment">-- 20220202 | 2022å¹´02æœˆ02 (DM)</span><span class="token keyword">SELECT</span> TO_CHAR<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'yyyy"å¹´"MM"æœˆ"dd"æ—¥"'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_CHAR<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span> <span class="token comment">-- 2022å¹´02æœˆ02 | 2022-02-02 (DM)</span><span class="token keyword">select</span> date_format<span class="token punctuation">(</span><span class="token string">'2022-02-02'</span><span class="token punctuation">,</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date_format<span class="token punctuation">(</span><span class="token string">'2022-02-02'</span><span class="token punctuation">,</span><span class="token string">'%Yå¹´%mæœˆ%d %Hå°æ—¶%iåˆ†é’Ÿ%sç§’'</span><span class="token punctuation">)</span>  <span class="token comment">-- 20220202 | 2022å¹´02æœˆ02 (mysql)</span><span class="token comment">-- ====æ—¶é—´å·®</span><span class="token keyword">select</span> datediff<span class="token punctuation">(</span>HH<span class="token punctuation">,</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'2022-02-12'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- param1 => param2 ç»è¿‡çš„æ—¶é—´(DM)</span><span class="token keyword">select</span> datediff<span class="token punctuation">(</span><span class="token string">'2020-06-06'</span><span class="token punctuation">,</span><span class="token string">'2022-06-06'</span><span class="token punctuation">)</span> <span class="token comment">-- param1 => param2 ç»è¿‡çš„å¤©æ•°(mysql)</span><span class="token keyword">select</span> TIMESTAMPDIFF<span class="token punctuation">(</span><span class="token keyword">minute</span><span class="token punctuation">,</span><span class="token string">'2022-02-12 00:00:00'</span><span class="token punctuation">,</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- param1 => param2 ç»è¿‡çš„æ—¶é—´(mysql)</span><span class="token comment">-- ====æ—¶é—´å‡½æ•°</span><span class="token keyword">select</span> date_sub<span class="token punctuation">(</span>curdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">interval</span> <span class="token string">'1'</span> <span class="token keyword">month</span><span class="token punctuation">)</span> <span class="token comment">-- è·ç¦»param1 1ä¸ªæœˆå‰çš„æ—¥æœŸ (DM)</span><span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">interval</span> <span class="token operator">-</span><span class="token number">30</span> <span class="token keyword">minute</span><span class="token punctuation">)</span> <span class="token comment">-- è·ç¦»param1 30åˆ†é’Ÿå‰çš„æ—¶é—´(mysql)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šè¡Œè½¬ä¸ºä¸€åˆ—">å¤šè¡Œè½¬ä¸ºä¸€åˆ—</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- ====DM</span><span class="token keyword">select</span> id<span class="token punctuation">,</span> wmsys<span class="token punctuation">.</span>wm_concat<span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">as</span> name<span class="token punctuation">,</span> wmsys<span class="token punctuation">.</span>wm_concat<span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">as</span> age <span class="token keyword">from</span> test <span class="token keyword">group</span> id<span class="token punctuation">;</span><span class="token comment">-- ====mysql</span><span class="token keyword">SELECT</span> GROUP_CONCAT<span class="token punctuation">(</span>name SEPARATOR <span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">as</span> name <span class="token keyword">from</span> test<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŠ¨æ€æ–°å¢-æ›´æ–°-æ•°æ®">åŠ¨æ€æ–°å¢(æ›´æ–°)æ•°æ®</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- ====DM</span><span class="token keyword">MERGE</span> <span class="token keyword">INTO</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span> T1 <span class="token keyword">USING</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>æŸ¥è¯¢è¯­å¥<span class="token operator">></span><span class="token punctuation">)</span>T2 <span class="token keyword">ON</span> <span class="token punctuation">(</span>T2<span class="token punctuation">.</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token operator">></span> <span class="token operator">=</span> T1<span class="token punctuation">.</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">WHEN</span> <span class="token keyword">MATCHED</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> <span class="token keyword">SET</span> T1<span class="token punctuation">.</span><span class="token operator">&lt;</span>æ›´æ–°å­—æ®µ<span class="token operator">>=</span>T2<span class="token punctuation">.</span><span class="token operator">&lt;</span>æ›´æ–°å­—æ®µ<span class="token operator">></span><span class="token keyword">WHEN</span> <span class="token operator">NOT</span> <span class="token keyword">MATCHED</span> <span class="token keyword">THEN</span> <span class="token keyword">INSERT</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- ====mysql(ON DUPLICATE KEY UPDATE å¿…é¡»è¦æœ‰ä¸»é”®å†²çªæ‰å¯ä»¥è§¦å‘æ›´æ–°)</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token operator">&lt;</span>è¡¨å<span class="token number">1</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token keyword">SELECT</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span><span class="token keyword">FROM</span> <span class="token operator">&lt;</span>è¡¨å<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">ON</span> <span class="token keyword">DUPLICATE</span> <span class="token keyword">KEY</span> <span class="token keyword">UPDATE</span>     <span class="token operator">&lt;</span>æ›´æ–°å­—æ®µ<span class="token number">1</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>æ›´æ–°å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">&lt;</span>æ›´æ–°å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>æ›´æ–°å­—æ®µ<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ é™¤é‡å¤æ•°æ®">åˆ é™¤é‡å¤æ•°æ®</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- æŸ¥è¯¢è¡¨æ•°æ®é‡</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span><span class="token comment">-- æŸ¥è¯¢å»é‡åçš„æ•°æ®é‡</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span><span class="token punctuation">)</span><span class="token comment">-- æŸ¥è¯¢è¦å»é‡çš„æ•°æ®é‡</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span><span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">-- ====DM</span><span class="token keyword">delete</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span> T1<span class="token keyword">where</span> <span class="token punctuation">(</span>T1<span class="token punctuation">.</span>idcard<span class="token punctuation">,</span>T1<span class="token punctuation">.</span>certnum<span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span> <span class="token keyword">group</span> <span class="token keyword">by</span>  <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">and</span> rowid <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>rowid<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span> <span class="token keyword">group</span> <span class="token keyword">by</span>  <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- ====mysql(ç”±äºmyqlæ²¡æœ‰é»˜è®¤rowid, å› æ­¤éœ€è¦æœ‰ä¸»é”®idä½œä¸ºæ§åˆ¶)</span><span class="token keyword">delete</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span> T1<span class="token keyword">where</span> <span class="token punctuation">(</span>T1<span class="token punctuation">.</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span>T1<span class="token punctuation">.</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span> <span class="token keyword">group</span> <span class="token keyword">by</span>  <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">and</span> rowid <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>rowid<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>è¡¨å<span class="token operator">></span> <span class="token keyword">group</span> <span class="token keyword">by</span>  <span class="token operator">&lt;</span>å­—æ®µ<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>å­—æ®µ<span class="token number">2</span><span class="token operator">></span> <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å­˜å‚¨è¿‡ç¨‹-äº‹ä»¶">å­˜å‚¨è¿‡ç¨‹&amp;äº‹ä»¶</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- ====DM(è¾¾æ¢¦å»ºè®®é€šè¿‡DMç®¡ç†å·¥å…·ä»£ç†-è®¡åˆ’ä»»åŠ¡å®ç°)</span><span class="token comment">-- ====mysql</span><span class="token comment">-- â€»â€»â€» å­˜å‚¨è¿‡ç¨‹</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token operator">&lt;</span>pro_å­˜å‚¨åç§°<span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">delimiter</span> $$<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> <span class="token operator">&lt;</span>pro_å­˜å‚¨åç§°<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">BEGIN</span><span class="token comment">-- é€»è¾‘</span><span class="token keyword">END</span> $$<span class="token keyword">delimiter</span> <span class="token punctuation">;</span><span class="token comment">-- æŸ¥çœ‹</span><span class="token keyword">show</span> <span class="token keyword">procedure</span> <span class="token keyword">status</span><span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">procedure</span> <span class="token operator">&lt;</span>pro_å­˜å‚¨åç§°<span class="token operator">></span><span class="token punctuation">;</span><span class="token comment">-- â€»â€»â€» äº‹ä»¶</span><span class="token comment">-- åˆ›å»ºäº‹ä»¶</span><span class="token keyword">drop</span> event <span class="token keyword">if</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>&lt;event_äº‹ä»¶åç§°><span class="token punctuation">`</span></span><span class="token punctuation">;</span><span class="token keyword">create</span> EVENT    <span class="token identifier"><span class="token punctuation">`</span>&lt;event_äº‹ä»¶åç§°><span class="token punctuation">`</span></span>  <span class="token comment">-- åˆ›å»ºä¸€ä¸ªäº‹ä»¶</span>    <span class="token keyword">ON</span> SCHEDULE EVERY        <span class="token number">1</span> <span class="token keyword">DAY</span> <span class="token comment">-- æ¯é—´éš”ä¸€å¤©æ‰§è¡Œä¸€æ¬¡</span>        STARTS            <span class="token string">'2023-04-25 00:00:00'</span> <span class="token comment">-- ä»2023-04-25 00:00:00åå¼€å§‹</span>    <span class="token keyword">ON</span> COMPLETION        PRESERVE <span class="token keyword">ENABLE</span>  <span class="token comment">-- æ‰§è¡Œå®Œæˆä¹‹åä¸åˆ é™¤å®šæ—¶å™¨</span>    <span class="token keyword">DO</span>    <span class="token keyword">call</span> <span class="token operator">&lt;</span>pro_å­˜å‚¨åç§°<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- æ¯æ¬¡è§¦å‘å®šæ—¶å™¨æ—¶æ‰§è¡Œçš„è¯­å¥</span><span class="token comment">-- æŸ¥è¯¢äº‹ä»¶åŠŸèƒ½</span><span class="token keyword">SELECT</span> @<span class="token variable">@event_scheduler</span><span class="token punctuation">;</span><span class="token comment">-- å¼€å¯äº‹ä»¶åŠŸèƒ½</span><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> event_scheduler <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">-- å…³é—­äº‹ä»¶åŠŸèƒ½</span><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> event_scheduler <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">-- å…³é—­äº‹ä»¶</span><span class="token keyword">ALTER</span> EVENT event_sync_cxpt_reg_threetype <span class="token keyword">ON</span> COMPLETION PRESERVE <span class="token keyword">DISABLE</span><span class="token punctuation">;</span><span class="token comment">-- å¼€å¯äº‹ä»¶</span><span class="token keyword">ALTER</span> EVENT event_sync_cxpt_reg_threetype <span class="token keyword">ON</span> COMPLETION PRESERVE <span class="token keyword">ENABLE</span><span class="token punctuation">;</span><span class="token comment">-- æŸ¥çœ‹å½“å‰äº‹ä»¶</span><span class="token keyword">SHOW</span> EVENTS<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§¦å‘å™¨">è§¦å‘å™¨</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- ====DM</span><span class="token comment">-- çŸ¥è¯†ç‚¹: DMæŠ›å¼‚å¸¸å¤„ç†</span><span class="token comment">-- åŠŸèƒ½: ç¡®ä¿è¡¨ä¸­æŸå­—æ®µä¸å¯é‡å¤</span><span class="token keyword">create</span>  <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">trigger</span> <span class="token string">"æ¨¡å¼å"</span><span class="token punctuation">.</span><span class="token string">"è§¦å‘å™¨å"</span>before <span class="token keyword">INSERT</span> <span class="token keyword">on</span> <span class="token string">"æ¨¡å¼å"</span><span class="token punctuation">.</span><span class="token string">"è¡¨å"</span>referencing OLD <span class="token keyword">ROW</span> <span class="token keyword">AS</span> <span class="token string">"OLD"</span> NEW <span class="token keyword">ROW</span> <span class="token keyword">AS</span> <span class="token string">"NEW"</span><span class="token keyword">for each row</span><span class="token keyword">BEGIN</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">FROM</span> è¡¨å <span class="token keyword">WHERE</span> å­—æ®µå <span class="token operator">=</span> :NEW<span class="token punctuation">.</span>å­—æ®µå<span class="token punctuation">)</span><span class="token keyword">THEN</span>  RAISE_APPLICATION_ERROR<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20001</span><span class="token punctuation">,</span> <span class="token string">'å­—æ®µå·²å­˜åœ¨ï¼Œä¸å…è®¸æ’å…¥æ•°æ®'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‡½æ•°">å‡½æ•°</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- ====DM</span><span class="token comment">-- çŸ¥è¯†ç‚¹: å¼‚å¸¸æŠ“å–</span><span class="token comment">/***Manager***/</span><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> <span class="token string">"DMSTAND"</span><span class="token punctuation">.</span><span class="token string">"fun_to_date"</span><span class="token punctuation">(</span><span class="token string">"date_str"</span> <span class="token operator">IN</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token keyword">AS</span><span class="token keyword">BEGIN</span><span class="token comment">/*æ‰§è¡Œä½“*/</span><span class="token keyword">BEGIN</span><span class="token comment">-- å®šä¹‰å¼‚å¸¸å¤„ç†</span>    <span class="token keyword">return</span><span class="token punctuation">(</span>to_date<span class="token punctuation">(</span>date_str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    EXCEPTION    <span class="token keyword">WHEN</span> OTHERS <span class="token keyword">THEN</span>        <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">END</span><span class="token punctuation">;</span><span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>el-ui-primary</title>
      <link href="/2023/06/03/el-ui-primary/"/>
      <url>/2023/06/03/el-ui-primary/</url>
      
        <content type="html"><![CDATA[<h1>element-ui ç¬”è®°</h1><blockquote><p>å¿«é€Ÿæœç´¢:</p><p>é€‰æ‹©æ¡†çš„æ˜ å°„å†™æ³• &gt;&gt;&gt; flag_1</p><p>è¡¨å•é‡ç½® &gt;&gt;&gt; flag_2</p><p>åˆ†é¡µ &gt;&gt;&gt; flag_3</p><p>æ—¶é—´æ¡†çš„è§£è€¦ç»‘å®š &gt;&gt;&gt; flag_4</p><p>å¤šæ ‡ç­¾é¡µçš„åˆ‡æ¢ä¸å¤šæ¥å£è°ƒç”¨ &gt;&gt;&gt; flag_5</p><p>æ›´æ–°è¡¨å• &gt;&gt;&gt; flag_6</p><p>æ–°å¢è¡¨å• &gt;&gt;&gt; flag_7</p></blockquote><h2 id="æ¨¡æ¿">æ¨¡æ¿</h2><h3 id="Form-è¡¨å•">Form è¡¨å•</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- æ¦‚å¿µ  ref ç»‘å®šæ§ä»¶, å¯é€šè¿‡$refç”¨äºé‡ç½®ç­‰æ“ä½œ;   :model è¡¨å•æ•°æ®å¯¹è±¡, é…åˆ el-form-item çš„propä½¿ç”¨(:ruleè¡¨å•éªŒè¯è§„åˆ™, åŒç†)  :inline å¦‚æœä¸è®¾ç½®å°±ä¼šæ¯ä¸€ä¸ªitemä¸ºä¸€è¡Œ--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryDto<span class="token punctuation">"</span></span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryDto<span class="token punctuation">"</span></span> <span class="token attr-name">:inline</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>  <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>80px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- æ¦‚å¿µ    prop ç»‘å®šå­—æ®µå, ä»è€Œå®ç°è¡¨å•æ ¡éªŒ, å³ä¼šéªŒè¯ el-input å…ƒç´ ç»‘å®šçš„ queryDto.field æ˜¯å¦ç¬¦åˆéªŒè¯  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>inputField<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- æ¦‚å¿µ    v-model åŒå‘ç»‘å®š; placeholder å ä½æç¤º--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryDto.inputField<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å­—æ®µ1<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">clearable</span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- é€‰æ‹©æ¡†: flag_1    åŒæ—¶å±•ç¤ºä¸å­—æ®µå¤„äºæ˜ å°„å…³ç³»å†™æ³•  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectField<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryDto.selectField<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å­—æ®µ2<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">clearable</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in queryDic._selectField<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.label<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.value<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- æ—¶é—´æ¡†: flag_4    1. ç»‘å®šæ¨¡å‹ v-model å› ä¸ºç”Ÿæˆçš„æ—¶é—´æ˜¯æ•°ç»„å½¢å¼, ä¸ºä¸dtoè§£è€¦å› æ­¤å¦å¤–å•ç‹¬ä½¿ç”¨å®ä½“ç»‘å®š, å› æ­¤åç»­é‡ç½®è¡¨å•è¦å•ç‹¬é‡ç½®    2. ç²˜è´´å¿«é€Ÿé€‰æ‹©é¡¹ :picker-options æ³¨æ„è¿™æ˜¯æ¨¡å‹data    3. å…¨å±€æœç´¢æŸ¥è¯¢å‰©ä½™è¦é…ç½®çš„éƒ¨åˆ†  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>æ—¶é—´èŒƒå›´æ ·å¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-date-picker</span>      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timeRange.timeField<span class="token punctuation">"</span></span>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>daterange<span class="token punctuation">"</span></span>      <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>      <span class="token attr-name">unlink-panels</span>      <span class="token attr-name">range-separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è‡³<span class="token punctuation">"</span></span>      <span class="token attr-name">start-placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å¼€å§‹æ—¥æœŸ<span class="token punctuation">"</span></span>      <span class="token attr-name">end-placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç»“æŸæ—¥æœŸ<span class="token punctuation">"</span></span>      <span class="token attr-name">:picker-options</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pickerOptions<span class="token punctuation">"</span></span>    <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleQuery()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æŸ¥è¯¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- é‡ç½®: flag_2    1. ç»‘å®šè¡¨å• resetForm('xxx')    2. ç²˜è´´æ–¹æ³• resetForm    3. æ³¨æ„: å¦‚æœæœ‰æ¨¡å‹ä¸åœ¨è¡¨å•å†…éœ€è¦é¢å¤–æ¸…ç©º(å¦‚æœ¬æ¡ˆä¾‹ä¸­çš„timeRange)  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reset<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resetForm('queryDto')<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>é‡ç½®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleInsert()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>æ–°å¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--   åˆ†é¡µ: flag_3  1. ç»‘å®šå½“å‰é¡µ :current-page  2. è®¾ç½®åˆ†é¡µé€‰é¡¹: :page-sizes  3. ç»‘å®šé¡µæ€»æ•°: :total  4. ç²˜è´´æ–¹æ³•:  @size-change, @current-change--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-pagination</span>    <span class="token attr-name">:current-page</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryDto.page<span class="token punctuation">"</span></span>    <span class="token attr-name">:page-sizes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[15, 25, 40, 50]<span class="token punctuation">"</span></span>    <span class="token attr-name">:page-size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span>    <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>total, sizes, prev, pager, next, jumper<span class="token punctuation">"</span></span>    <span class="token attr-name">:total</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>respData.pager.total<span class="token punctuation">"</span></span>    <span class="token attr-name">@size-change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleSizeChange<span class="token punctuation">"</span></span>    <span class="token attr-name">@current-change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleCurrentChange<span class="token punctuation">"</span></span>  <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">queryDto</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">inputField</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      <span class="token comment">// flag_1</span>      <span class="token literal-property property">selectField</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      <span class="token comment">// åç«¯è¯·æ±‚å‚æ•°(å…·ä½“æ ¹æ®æ¥å£æ–‡æ¡£éœ€è¦) flag_4</span>      <span class="token literal-property property">timeFieldStart</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      <span class="token literal-property property">timeFieldEnd</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      <span class="token comment">// flag_3</span>      <span class="token literal-property property">page</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">15</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// é€šè¿‡æ˜ å°„å³å¯å®ç°: ä¸‹æ‹‰æ¡†æ‰€å±•ç¤ºä¸ä¼ ç»™åç«¯çš„å€¼å½¢æˆå¯¹åº”</span>    <span class="token literal-property property">queryDic</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// flag_1</span>      <span class="token literal-property property">_selectField</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'æ˜ å°„1'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'æ˜ å°„2'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'æ˜ å°„3'</span> <span class="token punctuation">&#125;</span>      <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// æ—¶é—´èŒƒå›´å­—æ®µ(ä¸dtoè¿›è¡Œè§£è€¦) flag_4</span>    <span class="token literal-property property">timeRange</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">timeField</span><span class="token operator">:</span> <span class="token string">''</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// æ­¤å¤„ä¸å…³å¿ƒè¿”å›æ•°æ®çš„æ ¼å¼, ä»…ä¸¾ä¾‹è·å–total</span>    <span class="token literal-property property">respData</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment">// flag_3</span>      <span class="token literal-property property">pager</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token number">0</span>  <span class="token comment">// æ³¨æ„æ­¤å¤„ä¸èƒ½ç”¨ ''</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// å¿«é€Ÿé€‰æ‹©æ—¶é—´èŒƒå›´(æ³¨æ„æ­¤å¤„æ˜¯data()å†…ä¸æ˜¯methods) flag_4</span>    <span class="token literal-property property">pickerOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">shortcuts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'æœ€è¿‘ä¸€å‘¨'</span><span class="token punctuation">,</span>        <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token parameter">picker</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">const</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          start<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>start<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span>          picker<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'pick'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">,</span> end<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'æœ€è¿‘ä¸€ä¸ªæœˆ'</span><span class="token punctuation">,</span>        <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token parameter">picker</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">const</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          start<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>start<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span>          picker<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'pick'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">,</span> end<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'æœ€è¿‘ä¸‰ä¸ªæœˆ'</span><span class="token punctuation">,</span>        <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token parameter">picker</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">const</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          start<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>start<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">90</span><span class="token punctuation">)</span>          picker<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'pick'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">,</span> end<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token function">handleQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æŸ¥è¯¢æ–¹æ³•(æ­¤å¤„åç«¯å› ä¸ºå®šä¹‰çš„æ—¶é—´èŒƒå›´æ˜¯startå’Œend, å› æ­¤æŸ¥è¯¢å‰è¦åšå°è£…) flag_4</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeRange<span class="token punctuation">.</span>timeField<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å°è£…æ—¶é—´dto(æ–¹æ³•è§ä¸‹é¢)</span>      <span class="token keyword">const</span> _timeRange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleDateRange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeRange<span class="token punctuation">.</span>timeField<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>queryDto<span class="token punctuation">.</span>timeFieldStart <span class="token operator">=</span> _timeRange<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>queryDto<span class="token punctuation">.</span>timeFieldEnd <span class="token operator">=</span> _timeRange<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token comment">// å¼€å§‹æŸ¥è¯¢</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// å¤„ç†æ—¥æœŸæ ¼å¼(å…·ä½“æ—¥æœŸæ ¼å¼è½¬æ¢è§ é™„:date-format.js) flag_4</span>  <span class="token function">handleDateRange</span><span class="token punctuation">(</span><span class="token parameter">dateRange</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dateRange<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token function">formatDate</span><span class="token punctuation">(</span>dateRange<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">formatDate</span><span class="token punctuation">(</span>dateRange<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// é‡ç½®è¡¨å• flag_2</span>  <span class="token function">resetForm</span><span class="token punctuation">(</span><span class="token parameter">formName</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span>formName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// æ­¤å¤„è¦æŠŠæ—¶é—´èŒƒå›´çš„å­—æ®µå•ç‹¬é‡ç½® flag_4</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>timeRange<span class="token punctuation">.</span>timeField <span class="token operator">=</span> <span class="token string">''</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// åˆ†é¡µsize/pageå˜æ›´ flag_3</span>  <span class="token function">handleSizeChange</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>queryDto<span class="token punctuation">.</span>size <span class="token operator">=</span> val    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// sizeå˜æ›´åé‡æ–°æŸ¥è¯¢</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">handleCurrentChange</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>queryDto<span class="token punctuation">.</span>page <span class="token operator">=</span> val    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// pageå˜æ›´åé‡æ–°æŸ¥è¯¢</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token comment">/* é™„: åˆ†é¡µæ åº•éƒ¨å±…ä¸­æ ·å¼ */</span><span class="token selector">.page</span> <span class="token punctuation">&#123;</span>  <span class="token comment">/*è®¾ç½®ä¸ºFlexboxå®¹å™¨*/</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token comment">/*å‚ç›´å±…ä¸­*/</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token comment">/*æ°´å¹³å±…ä¸­*/</span>  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>  <span class="token property">bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™„: æ—¶é—´æ ¼å¼åŒ–å·¥å…·ç±» <code>date-format.js</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ—¶é—´æ ¼å¼åŒ–å·¥å…·ç±»</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> pattern</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> dt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pattern <span class="token operator">===</span> <span class="token string">'yyyy-M-d'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// yyyy-M-d</span>    <span class="token keyword">const</span> year <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> month <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">const</span> date <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>month<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>date<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pattern <span class="token operator">===</span> <span class="token string">'yyyy-M-d H:m:s'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// yyyy-M-d H:m:s</span>    <span class="token keyword">const</span> year <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> month <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">const</span> date <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> hour <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> minute <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> second <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>month<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>date<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>hour<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>minute<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>second<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pattern <span class="token operator">===</span> <span class="token string">'yyyy-MM-dd'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// yyyy-MM-dd</span>    <span class="token keyword">const</span> year <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> month <span class="token operator">=</span> <span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> date <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>month<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>date<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// yyyy-MM-dd HH:mm:ss</span>    <span class="token keyword">const</span> year <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> month <span class="token operator">=</span> <span class="token punctuation">(</span>dt<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> date <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> hour <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> minute <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> second <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>month<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>date<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>hour<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>minute<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>second<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Table-è¡¨æ ¼-Tag-æ ‡ç­¾">Table è¡¨æ ¼/Tag æ ‡ç­¾</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- æ ‡ç­¾é¡µ(å¯é€‰)   è¯´æ˜: å¤šæ ‡ç­¾å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªæ¥å£å¯¹åº”å¤šä¸ªè¡¨å•çš„æƒ…å†µ, å› æ­¤handleSearch(æŸ¥è¯¢)æ—¶å¯ä»¥æ ¹æ®è¡¨å•åè¿›è¡Œè·¯ç”±æ¥å£ flag_5  handleClick åˆ‡æ¢æ ‡ç­¾æ–¹æ³•  el-tab-pane ä¸­ form1 è¡¨ç¤ºå½“å‰è¡¨å•å”¯ä¸€æ ‡è¯†(é‡è¦)--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tabs</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>activeName<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>border-card<span class="token punctuation">"</span></span> <span class="token attr-name">@tab-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleClick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tab-pane</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¡¨å•ä¸€<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchTable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>å‰ç½®è¯´æ˜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>remind<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>è¯´æ˜æ–‡å­—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-divider</span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cTable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span>          <span class="token attr-name">v-loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading.xxx<span class="token punctuation">"</span></span>          <span class="token attr-name">element-loading-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç©å‘½åŠ è½½ä¸­ğŸ¤£ğŸ¤£ğŸ¤£<span class="token punctuation">"</span></span>          <span class="token attr-name">element-loading-spinner</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-loading<span class="token punctuation">"</span></span>          <span class="token attr-name">element-loading-background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rgba(196, 196, 196, 0.8)<span class="token punctuation">"</span></span>          <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>respData.xxxInfo<span class="token punctuation">"</span></span>          <span class="token attr-name">border</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">"</span></span></span>           <span class="token attr-name">:header-cell-style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123; background: '#f8f8f8', color: '#000' &#125;<span class="token punctuation">"</span></span>        <span class="token punctuation">></span></span>          <span class="token comment">&lt;!-- ç¼–å·å­—æ®µ --></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç¼–å·<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auto<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>          <span class="token comment">&lt;!-- æ™®é€šå­—æ®µ --></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>field1<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å­—æ®µä¸€<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>          <span class="token comment">&lt;!-- æ˜ å°„å­—æ®µ --></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mappingField<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ˜ å°„å­—æ®µ<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.row.mappingField === 1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>ç±»å‹1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.row.mappingField === 2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>ç±»å‹2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.row.mappingField === 3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>ç±»å‹3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>          <span class="token comment">&lt;!-- å³ä¾§ åˆ é™¤/ä¿®æ”¹(è¯¦ç»†è§åŠ¨æ€è¡¨å•) æŒ‰é’® --></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">fixed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>right<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ“ä½œ<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleUpdate(item.row)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä¿®æ”¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleDelete(item.row.id)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>åˆ é™¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tab-pane</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tabs</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">formType</span><span class="token operator">:</span> <span class="token string">'form1'</span> <span class="token comment">// å½“å‰è¡¨å•ç±»å‹ flag_5</span>    <span class="token literal-property property">respData</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">xxxInfo</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token function">handlerSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ ¹æ®å½“å‰æ ‡ç­¾ç±»å‹è°ƒå–ä¸åŒæ¥å£ flag_5</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formType <span class="token operator">===</span> <span class="token string">'form1'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è¿›è¡Œform1çš„æ¥å£è¯·æ±‚</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// åˆ‡æ¢æ ‡ç­¾ flag_5</span>  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">tab<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>formType <span class="token operator">=</span> tab<span class="token punctuation">.</span>name  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// æ‰§è¡Œåˆ é™¤</span>  <span class="token keyword">async</span> <span class="token function">handleDelete</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token string">'æ­¤æ“ä½œå°†åˆ é™¤è¯¥æ•°æ®, æ˜¯å¦ç»§ç»­?'</span><span class="token punctuation">,</span> <span class="token string">'æç¤º'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">confirmButtonText</span><span class="token operator">:</span> <span class="token string">'ç¡®å®š'</span><span class="token punctuation">,</span>        <span class="token literal-property property">cancelButtonText</span><span class="token operator">:</span> <span class="token string">'å–æ¶ˆ'</span><span class="token punctuation">,</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'warning'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">await</span> <span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'åˆ é™¤æˆåŠŸ'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'å·²å–æ¶ˆåˆ é™¤'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// å°è£…å¼¹æ¡†æ–¹æ³•</span>  <span class="token function">alertMsg</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">message</span><span class="token operator">:</span> msg<span class="token punctuation">,</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span>    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token comment">/* é™„: è¡¨æ ¼æ ·å¼ */</span><span class="token selector">.searchTable</span> <span class="token punctuation">&#123;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 90%<span class="token punctuation">;</span>  <span class="token property">margin</span><span class="token punctuation">:</span> 30px auto<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* é™„: è¯´æ˜ç‹‚ */</span><span class="token selector">.remind</span> <span class="token punctuation">&#123;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #d9d9d9<span class="token punctuation">;</span>  <span class="token property">padding</span><span class="token punctuation">:</span> 20px 40px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* é™„: æ­¤å¤„ä¸å‰ç½®è¯´æ˜æ¡†ä¿æŒé—´è· */</span><span class="token selector">.cTable</span> <span class="token punctuation">&#123;</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="el-dialog-å¯¹è¯æ¡†">el-dialog å¯¹è¯æ¡†</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">fixed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>right<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>æ“ä½œ<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token comment">&lt;!-- æ‰“å¼€æ›´æ–°è¡¨å•é¢æ¿ flag_6 --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleUpdate(item.row)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä¿®æ”¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleDelete(item.row.id)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>åˆ é™¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ›´æ–°è¡¨å•: flag_6  :visible.sync ç»‘å®šæ˜¯å¦æ˜¾ç¤ºå¯¹è±¡  :model ç»‘å®šæ›´æ–°dataå¯¹è±¡  confirmUpdate() ç¡®è®¤  label-width è¡¨å•æ ‡ç­¾æ–‡å­—å®½åº¦  label-position è¡¨å•æ§åˆ¶æ–‡å­—ä½ç½®, ä½†è¦å…ˆè®¾ç½®æ–‡å­—å®½åº¦  æ³¨æ„: æ­¤å¤„ el-form-item æ ‡ç­¾ä¸­æ²¡åŠ propå±æ€§, å› ä¸ºä¸éœ€è¦æ ¡éªŒæ“ä½œ, å…·ä½“qi--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25%<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateDialogVisible<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateForm<span class="token punctuation">"</span></span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateForm<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>80px<span class="token punctuation">"</span></span> <span class="token attr-name">label-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateForm.id<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token attr-name">:readonly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> auto</span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> auto</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>confirmUpdate()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç¡®å®š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> auto</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cancelUpdate()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å–æ¶ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ–°å¢è¡¨å•: flag_7  :visible.sync ç»‘å®šæ˜¯å¦æ˜¾ç¤ºå¯¹è±¡  confirmInsert() æ–°å¢  cancelInsert()  å–æ¶ˆæ–¹æ³•--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25%<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertDialogVisible<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertForm<span class="token punctuation">"</span></span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertForm<span class="token punctuation">"</span></span> <span class="token attr-name">label-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>80px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> auto</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>confirmInsert()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç¡®å®š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> auto</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cancelInsert()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å–æ¶ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ›´æ–°ç›¸å…³æ¨¡å‹ flag_6</span>    <span class="token literal-property property">updateDialogVisible</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token literal-property property">updateForm</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// æ›´æ–°å”¯ä¸€é”®: é€šå¸¸æ ¹æ®æ¥å£ä»è¡Œä¸­æ‰€å–</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// æ–°å¢ç›¸å…³æ¨¡å‹ flag_7</span>    <span class="token literal-property property">insertDialogVisible</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token literal-property property">insertForm</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è¡¨å•å†…å®¹</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// æ‰“å¼€æ›´æ–°è¡¨å•é¢æ¿(å›æ˜¾) flag_6</span>  <span class="token function">handleUpdate</span><span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>updateDialogVisible <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token comment">// è§£æ„å¯¹è±¡(æ­¤å¤„æ˜¯å› ä¸ºè¿˜æœ‰åˆ«çš„æ•°æ®å°è£…)</span>    <span class="token keyword">const</span> curUser <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>row <span class="token punctuation">&#125;</span>    curUser<span class="token punctuation">.</span>roles <span class="token operator">=</span> curUser<span class="token punctuation">.</span>roles <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>updateForm <span class="token operator">=</span> curUser  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// å–æ¶ˆæ›´æ–° </span>  <span class="token function">cancelUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>updateDialogVisible <span class="token operator">=</span> <span class="token boolean">false</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>       <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'å·²å–æ¶ˆ'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// ç¡®è®¤æ›´æ–°</span>  <span class="token keyword">async</span> <span class="token function">confirmUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateForm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateForm<span class="token punctuation">.</span>id<span class="token punctuation">)</span>  <span class="token comment">// è°ƒå–æ›´æ–°æ¥å£</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>updateDialogVisible <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token comment">// é¢æ¿å…³é—­</span>    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æŸ¥è¯¢</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span>      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'æ›´æ–°æˆåŠŸ'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// æ‰“å¼€æ–°å¢é¢æ¿ flag_7</span>  <span class="token function">handleInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>insertDialogVisible <span class="token operator">=</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// å–æ¶ˆæ–°å¢</span>  <span class="token function">cancelInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>insertDialogVisible <span class="token operator">=</span> <span class="token boolean">false</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'å·²å–æ¶ˆ'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// ç¡®è®¤æ–°å¢</span>  <span class="token keyword">async</span> <span class="token function">confirmInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>insertForm<span class="token punctuation">)</span> <span class="token comment">// æ–°å¢</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>insertDialogVisible <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// é¢æ¿å…³é—­</span>    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æŸ¥è¯¢</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span>      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'æ–°å¢æˆåŠŸ'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ¨æ€æ¸²æŸ“è¡¨æ ¼-imp">åŠ¨æ€æ¸²æŸ“è¡¨æ ¼(imp)</h3><h4 id="æ€è·¯">æ€è·¯</h4><ol><li>å‰ç½®è¯´æ˜: ç”±äºè¯¥æ¥å£æ˜¯åŠ¨æ€æŸ¥è¯¢æ•°æ®åº“æ¥å£, ä¼šæœ‰sqlæ³¨å…¥ç­‰é£é™©, å› æ­¤ä»…ç”¨äºä¸ªäººè¿ç»´ä½¿ç”¨. åŒæ—¶ä¸ºäº†æ¥å£ä¼ å‚é€šç”¨æ€§, åœ¨sqlä¸­å­˜åœ¨ <code>select 1, fieldxxx from tablexxx</code> , å› æ­¤åœ¨å‰ç«¯æå–å­—æ®µæ—¶, è¦å…ˆå°† <code>1</code> å­—æ®µåˆ å»</li><li>å‰ç«¯è°ƒå–æ¥å£, å…ˆå°† <code>1</code> å­—æ®µåˆ å», è€Œåéå†æ•°æ®, å°è£…å­—æ®µå</li><li>åŠ¨æ€æ¸²æŸ“è‡³ <code>el-table</code> ä¸­</li></ol><h4 id="æŸ¥è¯¢å¹¶å¤„ç†è¡¨å¤´æ–¹æ³•">æŸ¥è¯¢å¹¶å¤„ç†è¡¨å¤´æ–¹æ³•</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// methods</span><span class="token comment">// æ‰§è¡ŒæŸ¥è¯¢ ğŸ‘‡</span><span class="token keyword">async</span> <span class="token function">handLeSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æŸ¥è¯¢ä¹‹å‰è¦æŠŠåŠ¨æ€è¡¨å¤´ç½®ä¸ºç©º</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>tableHead <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// æ ¡éªŒå‚æ•°</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectData<span class="token punctuation">.</span>table <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectData<span class="token punctuation">.</span>field<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'è¯·å…ˆé€‰æ‹©è¡¨åŠå­—æ®µå†è¿›è¡ŒæŸ¥è¯¢'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// æ‰§è¡ŒæŸ¥è¯¢</span>    <span class="token comment">// èµ‹å€¼åˆ°data</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>loading<span class="token punctuation">.</span>select <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// loading</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">handleSelect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectData<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>loading<span class="token punctuation">.</span>select <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// loading</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>respData<span class="token punctuation">.</span>msg <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>exceptionMsg    <span class="token keyword">const</span> list <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data    <span class="token comment">// éå†åˆ é™¤å±æ€§åæ˜¯æ•°å­—çš„</span>    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">delete</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> keyArr <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        keyArr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>tableHead<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">key</span><span class="token operator">:</span> key <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>respData<span class="token punctuation">.</span>selectResult <span class="token operator">=</span> list<span class="token punctuation">&#125;</span><span class="token comment">// data() ğŸ‘‡</span><span class="token comment">// åŠ¨æ€è¡¨å¤´</span><span class="token literal-property property">tableHead</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="templateæ¸²æŸ“">templateæ¸²æŸ“</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchTable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- æ­¤å¤„å› ä¸º  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span>    <span class="token attr-name">v-loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading.select<span class="token punctuation">"</span></span>    <span class="token attr-name">element-loading-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç©å‘½åŠ è½½ä¸­ğŸ¤£ğŸ¤£ğŸ¤£<span class="token punctuation">"</span></span>    <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>respData.selectResult<span class="token punctuation">"</span></span>    <span class="token attr-name">border</span>    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">"</span></span></span>    <span class="token attr-name">max-height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>530px<span class="token punctuation">"</span></span>    <span class="token attr-name">:header-cell-style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123; background: '#f8f8f8', color: '#000' &#125;<span class="token punctuation">"</span></span>  <span class="token punctuation">></span></span>    <span class="token comment">&lt;!--æ¨¡æ¿è¡¨æ ¼--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span>      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in tableHead<span class="token punctuation">"</span></span>      <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.key<span class="token punctuation">"</span></span>      <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.key<span class="token punctuation">"</span></span>      <span class="token attr-name">:property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item.key<span class="token punctuation">"</span></span>      <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>250<span class="token punctuation">"</span></span>    <span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>         <span class="token comment">&lt;!-- tooltipæç¤ºæ ‡ç­¾å¡       æ³¨æ„: tooltipçš„contentéœ€è¦string, å› æ­¤ scope.row[scope.column.property] æ‹¿åˆ°å­—æ®µå€¼ä¹‹åè¦ toString()  --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tooltip</span>           <span class="token attr-name">:content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scope.row[scope.column.property] ? scope.row[scope.column.property].toString() : ''<span class="token punctuation">"</span></span>         <span class="token punctuation">></span></span>           <span class="token comment">&lt;!-- è¡¨æ ¼ä¸€è¡Œæ˜¾ç¤º ğŸ‘‡ copyCellData(å¤åˆ¶è¡¨æ ¼æ–¹æ³•)--></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>oneline<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>             <span class="token comment">&lt;!-- å¤åˆ¶æŒ‰é’® --></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>               <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>               <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-copy-document<span class="token punctuation">"</span></span>               <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>copyCellData(scope.row[scope.column.property])<span class="token punctuation">"</span></span>             <span class="token punctuation">/></span></span>             &#123;&#123; scope.row[scope.column.property] &#125;&#125;           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tooltip</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token comment">// ...methods</span><span class="token function">copyCellData</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'æ— å†…å®¹'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> textarea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span>  textarea<span class="token punctuation">.</span>value <span class="token operator">=</span> text  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span>  textarea<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'copy'</span><span class="token punctuation">)</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'å¤åˆ¶æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">.searchTable</span> <span class="token punctuation">&#123;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 90%<span class="token punctuation">;</span>  <span class="token property">margin</span><span class="token punctuation">:</span> auto auto<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.oneline</span> <span class="token punctuation">&#123;</span>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>  <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>  <span class="token comment">/* å°†å¯¹è±¡ä½œä¸ºå¼¹æ€§ä¼¸ç¼©ç›’å­æ¨¡å‹æ˜¾ç¤º */</span>  <span class="token property">display</span><span class="token punctuation">:</span> -webkit-box<span class="token punctuation">;</span>  <span class="token comment">/* é™åˆ¶åœ¨ä¸€ä¸ªå—å…ƒç´ æ˜¾ç¤ºçš„æ–‡æœ¬çš„è¡Œæ•° */</span>  <span class="token comment">/* -webkit-line-clamp å…¶å®æ˜¯ä¸€ä¸ªä¸è§„èŒƒå±æ€§ï¼Œä½¿ç”¨äº†WebKitçš„CSSæ‰©å±•å±æ€§ï¼Œè¯¥æ–¹æ³•é€‚ç”¨äºWebKitæµè§ˆå™¨åŠç§»åŠ¨ç«¯ï¼›*/</span>  <span class="token property">-webkit-line-clamp</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>  <span class="token comment">/* è®¾ç½®æˆ–æ£€ç´¢ä¼¸ç¼©ç›’å¯¹è±¡çš„å­å…ƒç´ çš„æ’åˆ—æ–¹å¼ */</span>  <span class="token property">-webkit-box-orient</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token comment">/* æ·±åº¦é€‰æ‹©å™¨-æ­¤å¤„æ˜¯ä¸ºäº†è§£å†³el-tableè¡¨å¤´æ— æ³•å¤åˆ¶é—®é¢˜ important */</span><span class="token selector">::v-deep .el-table th.el-table__cell</span> <span class="token punctuation">&#123;</span>  <span class="token property">user-select</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¡¨æ ¼é€‰æ‹©äº‹ä»¶">è¡¨æ ¼é€‰æ‹©äº‹ä»¶</h3><p>åªéœ€è¦åœ¨ <code>el-table</code> ä¸­æ·»åŠ  <code>@selection-change</code>äº‹ä»¶åŠæ–°å¢ä¸€ä¸ªé€‰æ‹©åˆ—å³å¯, ä»£ç å¦‚ä¸‹ğŸ‘‡</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--  1. æ·»åŠ @selection-changeå¹¶ç»‘å®šäº‹ä»¶  2. æ–°å¢åˆ— &lt;el-table-column type="selection" />  3. methodsåŠdata()è§ä¸‹  é™„: åŠ è½½å±æ€§çš„ä½¿ç”¨: æ–°å¢å¦‚ä¸‹å±æ€§å³å¯     v-loading="loading.child"  // ç»‘å®šçš„loadingå­—æ®µ, åŒæ—¶è¦åœ¨è¯·æ±‚æ¥å£å‰æ‰“å¼€, å®Œæˆè¯·æ±‚åå…³é—­    element-loading-text="ç©å‘½åŠ è½½ä¸­ğŸ¤£ğŸ¤£ğŸ¤£"    element-loading-spinner="el-icon-loading"  // å¦‚æœå…¨é¡µé¢åŠ è½½åˆ™åˆ å»æ­¤è¡Œ    element-loading-background="rgba(196, 196, 196, 0.8)"  // å¦‚æœå…¨é¡µé¢åŠ è½½åˆ™åˆ å»æ­¤è¡Œ--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span>  <span class="token attr-name">v-loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading.detail<span class="token punctuation">"</span></span>  <span class="token attr-name">element-loading-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç©å‘½åŠ è½½ä¸­ğŸ¤£ğŸ¤£ğŸ¤£<span class="token punctuation">"</span></span>  <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xxx<span class="token punctuation">"</span></span>  <span class="token attr-name">border</span>  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">"</span></span></span>  <span class="token attr-name">max-height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>530px<span class="token punctuation">"</span></span>  <span class="token attr-name">:header-cell-style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123; background: '#f8f8f8', color: '#000' &#125;<span class="token punctuation">"</span></span>  <span class="token attr-name">@selection-change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleSelectionChange<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selection<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xxx<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>é€»è¾‘åç§°<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token comment">// ...data()</span><span class="token comment">// é€‰æ‹©åˆ—è¡¨</span><span class="token literal-property property">selectedRows</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// ...methods</span><span class="token comment">// è¡¨æ ¼é€‰æ‹©äº‹ä»¶(é…åˆ&lt;el-table-column type="selection" />ä½¿ç”¨)</span><span class="token function">handleSelectionChange</span><span class="token punctuation">(</span><span class="token parameter">selection</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ­¤å¤„ä¼šå°†é€‰ä¸­çš„rowåŠ å…¥è‡³æ•°ç»„</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>selectedRows <span class="token operator">=</span> selection<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç»„ä»¶">ç»„ä»¶</h2><h3 id="çˆ¶å­ç»„ä»¶çš„å¼•ç”¨">çˆ¶å­ç»„ä»¶çš„å¼•ç”¨</h3><ol><li><p>å­ç»„ä»¶å¼•ç”¨çˆ¶ç»„ä»¶å†…å®¹</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Child'</span><span class="token punctuation">,</span>  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¼•ç”¨åå˜é‡åå³å¯é€šè¿‡å˜é‡è°ƒç”¨(å­ç»„ä»¶æ˜¯ä¸å»ºè®®ä¿®æ”¹çˆ¶ç»„ä»¶å±æ€§å†…å®¹)</span>    <span class="token literal-property property">dic</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// å¼•ç”¨æ–¹æ³•åå³å¯è°ƒç”¨è¯¥æ–¹æ³•</span>    <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>çˆ¶ç»„ä»¶å¼•ç”¨å­ç»„ä»¶å†…å®¹</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token comment">// å¯¼å…¥å­ç»„ä»¶</span><span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'./components/Child.vue'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> Child <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token function">invokeChildComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">xxxMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- ç»„ä»¶çš„ä½¿ç”¨: åœ¨éœ€è¦å±•ç¤ºä½ç½®æ”¾ç½®ç»„ä»¶æ ‡ç­¾     ref å®šä¹‰å­ç»„ä»¶å¼•ç”¨å     :dic :query å°†çˆ¶ç»„ä»¶å¯¹è±¡/æ–¹æ³•ä¼ é€’ç»™å­ç»„ä»¶, å­ç»„ä»¶é€šè¿‡è¯¥åå­—è¿›è¡Œå¼•ç”¨  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>User</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span> <span class="token attr-name">:dic</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryDic<span class="token punctuation">"</span></span> <span class="token attr-name">:query</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleQuery<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token comment">&lt;!--  æ ‡ç­¾ä¸­å¼•ç”¨å­ç»„ä»¶å†…å®¹  --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$refs.user.queryTbUserByGuid(row.toRowGuid)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      &#123;&#123; row.toRowGuid &#125;&#125;  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>$refs</code> æ˜¯ Vue.js æä¾›çš„ä¸€ä¸ªç‰¹æ®Šå±æ€§ï¼Œç”¨äºè·å–ç»„ä»¶æˆ–å…ƒç´ çš„å¼•ç”¨ã€‚åœ¨æ¨¡æ¿ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>ref</code> å±æ€§æ¥ä¸ºç»„ä»¶æˆ–å…ƒç´ è®¾ç½®å¼•ç”¨ï¼Œç„¶ååœ¨ç»„ä»¶å®ä¾‹ä¸­ä½¿ç”¨ <code>$refs</code> æ¥è®¿é—®è¿™ä¸ªå¼•ç”¨ã€‚</p></blockquote></li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--  å¡«å†™è´¦å·å¯†ç çš„ä¼ªä»£ç   this.$refs.username.focus() æ˜¯ä¸€ç§æ“ä½œ DOM å…ƒç´ çš„æ–¹å¼ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨ç»„ä»¶å®ä¾‹ä¸­è®¿é—®å…ƒç´ çš„å¼•ç”¨ï¼Œå¹¶è°ƒç”¨å…ƒç´ çš„æ–¹æ³•æˆ–å±æ€§--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loginForm.username<span class="token punctuation">"</span></span> <span class="token attr-name">:placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$t('login.username')<span class="token punctuation">"</span></span> <span class="token attr-name">...çœç•¥</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¦‚æœç”¨æˆ·åå’Œå¯†ç çš„è¾“å…¥æ¡†æ²¡å€¼, åˆ™è‡ªåŠ¨èšç„¦</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>username<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>password <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªå®šä¹‰ç»„ä»¶demo">è‡ªå®šä¹‰ç»„ä»¶demo</h3><p>ä»¥å°è£…Tooltipä¸ºä¾‹</p><ol><li><p>å®šä¹‰Tooltip.vue</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tooltip</span> <span class="token attr-name">:content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">:effect</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>effect<span class="token punctuation">"</span></span> <span class="token attr-name">:placement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placement<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tooltip</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Tooltip'</span><span class="token punctuation">,</span>  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// å°è£…é»˜è®¤å‚æ•°</span>    <span class="token literal-property property">effect</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'dark'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">placement</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'top'</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç»„ä»¶çš„å¼•ç”¨</p></li></ol><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä¼ä¸šç®€ä»‹<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>150<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123; row &#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tooltip</span> <span class="token attr-name">:content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row.content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>oneline<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            &#123;&#123; shortConent(row.content) &#125;&#125;          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tooltip</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">.oneline</span> <span class="token punctuation">&#123;</span>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>  <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>  <span class="token comment">/* å°†å¯¹è±¡ä½œä¸ºå¼¹æ€§ä¼¸ç¼©ç›’å­æ¨¡å‹æ˜¾ç¤º */</span>  <span class="token property">display</span><span class="token punctuation">:</span> -webkit-box<span class="token punctuation">;</span>  <span class="token comment">/* é™åˆ¶åœ¨ä¸€ä¸ªå—å…ƒç´ æ˜¾ç¤ºçš„æ–‡æœ¬çš„è¡Œæ•° */</span>  <span class="token comment">/* -webkit-line-clamp å…¶å®æ˜¯ä¸€ä¸ªä¸è§„èŒƒå±æ€§ï¼Œä½¿ç”¨äº†WebKitçš„CSSæ‰©å±•å±æ€§ï¼Œè¯¥æ–¹æ³•é€‚ç”¨äºWebKitæµè§ˆå™¨åŠç§»åŠ¨ç«¯ï¼›*/</span>  <span class="token property">-webkit-line-clamp</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>  <span class="token comment">/* è®¾ç½®æˆ–æ£€ç´¢ä¼¸ç¼©ç›’å¯¹è±¡çš„å­å…ƒç´ çš„æ’åˆ—æ–¹å¼ */</span>  <span class="token property">-webkit-box-orient</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é“¾æ¥æ ‡ç­¾çš„å®šä¹‰">é“¾æ¥æ ‡ç­¾çš„å®šä¹‰</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>toRowGuid<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>toRowGuid<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>260<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 1. å®šä¹‰template, è§£æ„å½“å‰è¡Œ --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123; row &#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 2. è°ƒç”¨æ–¹æ³• --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$refs.user.queryTbUserByGuid(row.toRowGuid)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            &#123;&#123; row.toRowGuid &#125;&#125;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="watchçš„ä½¿ç”¨">watchçš„ä½¿ç”¨</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">watchField</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç›‘å¬watchFieldå¯¹è±¡, å¦‚æœæ–°å€¼å‘ç”Ÿäº†å˜åŒ–, åˆ™æ‰§è¡Œä¸€ä¸‹é€»è¾‘</span>  <span class="token function-variable function">watchField</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newV<span class="token punctuation">,</span> oldV</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newV <span class="token operator">!==</span> oldV<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// æ‰§è¡Œé€»è¾‘</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…¶ä»–æ¡†æ¶ç§¯ç´¯">å…¶ä»–æ¡†æ¶ç§¯ç´¯</h2><h3 id="CryptoJS-çš„ä½¿ç”¨"><code>CryptoJS</code> çš„ä½¿ç”¨</h3><ol><li><p>å®‰è£…ã€å¼•ç”¨</p><pre class="line-numbers language-none"><code class="language-none">npm install --save crypto-js import CryptoJS from &#39;crypto-js&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// AES ECBåŠ å¯†</span><span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'å¾…åŠ å¯†å†…å®¹'</span><span class="token keyword">const</span> key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span><span class="token keyword">const</span> encrypted <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">ECB</span><span class="token punctuation">,</span>    <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">const</span> encContent <span class="token operator">=</span> encrypted<span class="token punctuation">.</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">)</span><span class="token comment">// AES ECBè§£å¯†</span><span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'å¾…è§£å¯†å†…å®¹'</span><span class="token keyword">const</span> key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span><span class="token keyword">const</span> decrypted <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">ciphertext</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">ECB</span><span class="token punctuation">,</span>        <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">const</span> decContent <span class="token operator">=</span> decrypted<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="xmlæå–">xmlæå–</h3><p><code>npm install xml2js --save</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Parser <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'xml2js'</span><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parser</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">explicitArray</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// å…³é—­åº•éƒ¨æ•°ç»„è§£æ</span><span class="token keyword">const</span> detailXml <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>tableInfo <span class="token comment">// å¾…å¤„ç†çš„xmlå­—ç¬¦ä¸²</span><span class="token comment">// è§£æxmlè‡³å¯¹è±¡</span>parser<span class="token punctuation">.</span><span class="token function">parseString</span><span class="token punctuation">(</span>detailXml<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>tableData <span class="token operator">=</span> result<span class="token punctuation">.</span>EcaTable  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cas</title>
      <link href="/2023/05/20/cas/"/>
      <url>/2023/05/20/cas/</url>
      
        <content type="html"><![CDATA[<h2 id="CASä¹‹AtomicåŒ…">CASä¹‹AtomicåŒ…</h2><h4 id="updateAndGetå®ç°åŸç†demo">updateAndGetå®ç°åŸç†demo</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">updateAndGet</span><span class="token punctuation">(</span><span class="token class-name">AtomicInteger</span> i<span class="token punctuation">,</span> <span class="token class-name">IntUnaryOperator</span> operator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è·å–å½“å‰å€¼</span>        <span class="token keyword">int</span> prev <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¡ç®—å€¼</span>        <span class="token keyword">int</span> next <span class="token operator">=</span> operator<span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¯”è¾ƒå¹¶äº¤æ¢, æˆåŠŸåˆ™è¿”å›, ä¸æˆåŠŸåˆ™è‡ªæ—‹é‡è¯•</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JUC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æœºæ‰«ç ç™»å½•æµç¨‹</title>
      <link href="/2023/04/26/scan-code/"/>
      <url>/2023/04/26/scan-code/</url>
      
        <content type="html"><![CDATA[<h2 id="æµç¨‹å›¾">æµç¨‹å›¾</h2><pre class="mermaid">sequenceDiagramactor c as æ‰‹æœºç«¯participant p as PCç«¯participant s as Serverç«¯p ->> +s: å‘é€ç”ŸæˆäºŒç»´ç è¯·æ±‚    s ->> s: ç”ŸæˆäºŒç»´ç ID    s -->> -p: è¿”å›äºŒç»´ç ID    p ->> p: æ ¹æ®äºŒç»´ç IDç”ŸæˆäºŒç»´ç     loop å®šæ—¶è½®è¯¢    p ->> +s: æŸ¥è¯¢äºŒç»´ç çŠ¶æ€, ç›´åˆ°ç™»å½•æˆåŠŸ    endc ->> +p: æ‰«æäºŒç»´ç p -->> -c: äºŒç»´ç IDc ->> +s: å°†æ‰‹æœºç«¯èº«ä»½ä¿¡æ¯, äºŒç»´ç ä¿¡æ¯å‘é€è‡³Serverç«¯s ->> s: äºŒç»´ç IDå’Œèº«ä»½è¯ä¿¡æ¯ç»‘å®š, å¹¶ç”Ÿæˆä¸´æ—¶tokens -->> -c: è¿”å›ä¸´æ—¶tokenalt å·²æ‰«ç s -->> p: äºŒç»´ç çŠ¶æ€æ”¹ä¸º: å·²æ‰«ç , å¾…ç¡®è®¤endc ->> +s: æºå¸¦ä¸´æ—¶token, ç¡®è®¤ç™»å½•s ->> s: ç”ŸæˆPCç«¯çš„tokenalt å·²ç¡®è®¤ç™»å½•s -->> -p: äºŒç»´ç çŠ¶æ€æ”¹ä¸º: å·²ç™»å½•ends -->> -p: è¿”å›PCç«¯çš„tokenp ->> +s: å‡­å€Ÿtokenè¿›è¡Œè®¿é—®s -->> -p: è¿”å›ä¿¡æ¯</pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> safe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰åç«¯apiäº¤äº’å®‰å…¨</title>
      <link href="/2023/04/16/api-safety/"/>
      <url>/2023/04/16/api-safety/</url>
      
        <content type="html"><![CDATA[<h2 id="demo1">demo1</h2><pre class="mermaid">sequenceDiagramactor c as å®¢æˆ·ç«¯participant f as å‰ç«¯æœåŠ¡å™¨participant b as åç«¯æœåŠ¡å™¨c ->> f: è§¦å‘è¯·æ±‚f ->> +b: å‘é€è¯·æ±‚b ->> b: é€šè¿‡RSAç”Ÿæˆpubkey1å’Œprikey1note right of b: pubkey1, prikey1b -->> -f: å°†pubkey1è¿”å›å‰ç«¯b --> +f: f ->> f: é€šè¿‡RSAç”Ÿæˆpubkey2å’Œprikey2note left of f: pubkey2, prikey2f ->> f: åŠ å¯†: pubkey1(pubkey2) => secret1f ->> -b: ç”¨secret1è¯·æ±‚åç«¯f --> +b: b ->> b: è§£å¯†: prikey1(secret1) => pubkey2b ->> b: åŠ å¯†: pubkey2(AESkey) => secret2b ->> -f: è¿”å›secret2b --> +f: f ->> f: è§£å¯†: prikey2(secret2) => AESkeyf ->> f: åŠ å¯†: AESkey(data) => secretDataf ->> -b: å°†åŠ å¯†æ•°æ®å‘é€ç»™åç«¯</pre><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;div&gt;    &lt;input type&#x3D;&quot;text&quot; v-model&#x3D;&quot;text&quot; &#x2F;&gt;    &lt;button @click&#x3D;&quot;encryptData&quot;&gt;åŠ å¯†&lt;&#x2F;button&gt;    &lt;button @click&#x3D;&quot;decryptData&quot;&gt;è§£å¯†&lt;&#x2F;button&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;import CryptoJS from &#39;crypto-js&#39;export default &#123;  data() &#123;    return &#123;      text: &#39;&#39;,      key: null,      nonce: null,      ciphertext: null,      tag: null    &#125;  &#125;,  methods: &#123;    &#x2F;&#x2F; ä½¿ç”¨AESç®—æ³•åŠ å¯†æ•°æ®    encryptData() &#123;      const key &#x3D; CryptoJS.lib.WordArray.random(16)      const nonce &#x3D; CryptoJS.lib.WordArray.random(12)      const encrypted &#x3D; CryptoJS.AES.encrypt(this.text, key, &#123;        mode: CryptoJS.mode.GCM,        iv: nonce      &#125;)      this.key &#x3D; CryptoJS.enc.Base64.stringify(key)      this.nonce &#x3D; CryptoJS.enc.Base64.stringify(nonce)      this.ciphertext &#x3D; encrypted.ciphertext.toString(CryptoJS.enc.Base64)      this.tag &#x3D; CryptoJS.enc.Base64.stringify(encrypted.finalize())    &#125;,    &#x2F;&#x2F; ä½¿ç”¨AESç®—æ³•è§£å¯†æ•°æ®    decryptData() &#123;      const key &#x3D; CryptoJS.enc.Base64.parse(this.key)      const nonce &#x3D; CryptoJS.enc.Base64.parse(this.nonce)      const ciphertext &#x3D; CryptoJS.enc.Base64.parse(this.ciphertext)      const tag &#x3D; CryptoJS.enc.Base64.parse(this.tag)      const decrypted &#x3D; CryptoJS.AES.decrypt(        &#123; ciphertext &#125;,        key,        &#123;          mode: CryptoJS.mode.GCM,          iv: nonce,          tag: tag        &#125;      )      this.text &#x3D; decrypted.toString(CryptoJS.enc.Utf8)    &#125;  &#125;&#125;&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyPair</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyPairGenerator</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PrivateKey</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PublicKey</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">InvalidCipherTextException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>engines<span class="token punctuation">.</span></span><span class="token class-name">AESEngine</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>modes<span class="token punctuation">.</span></span><span class="token class-name">GCMBlockCipher</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>params<span class="token punctuation">.</span></span><span class="token class-name">AEADParameters</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>params<span class="token punctuation">.</span></span><span class="token class-name">KeyParameter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">PrivateKeyFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">PublicKeyFactory</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EncryptionUtil</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">KEY_SIZE</span> <span class="token operator">=</span> <span class="token number">2048</span><span class="token punctuation">;</span>    <span class="token comment">// ç”ŸæˆRSAå¯†é’¥å¯¹</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">KeyPair</span> <span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">KeyPairGenerator</span> generator <span class="token operator">=</span> <span class="token class-name">KeyPairGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">,</span> <span class="token string">"BC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        generator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token constant">KEY_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> generator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ä½¿ç”¨RSAå…¬é’¥åŠ å¯†AESå¯†é’¥</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">,</span> <span class="token class-name">PublicKey</span> publicKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encryptedKey <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">GCMBlockCipher</span> cipher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GCMBlockCipher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AESEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">KeyParameter</span> keyParameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyParameter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">AEADParameters</span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AEADParameters</span><span class="token punctuation">(</span>keyParameter<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>            encryptedKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>cipher<span class="token punctuation">.</span><span class="token function">getOutputSize</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> len <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">processBytes</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>length<span class="token punctuation">,</span> encryptedKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>encryptedKey<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidCipherTextException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token class-name">PublicKeyFactory</span><span class="token punctuation">.</span><span class="token function">createKey</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>encryptedKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ä½¿ç”¨RSAç§é’¥è§£å¯†AESå¯†é’¥</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encryptedKey<span class="token punctuation">,</span> <span class="token class-name">PrivateKey</span> privateKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decryptedKey <span class="token operator">=</span> <span class="token class-name">PrivateKeyFactory</span><span class="token punctuation">.</span><span class="token function">createKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encryptedKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">GCMBlockCipher</span> cipher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GCMBlockCipher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AESEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">KeyParameter</span> keyParameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyParameter</span><span class="token punctuation">(</span>decryptedKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AEADParameters</span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AEADParameters</span><span class="token punctuation">(</span>keyParameter<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>cipher<span class="token punctuation">.</span><span class="token function">getOutputSize</span><span class="token punctuation">(</span>decryptedKey<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> len <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">processBytes</span><span class="token punctuation">(</span>decryptedKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> decryptedKey<span class="token punctuation">.</span>length<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> key<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ä½¿ç”¨AESç®—æ³•åŠ å¯†æ•°æ®</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptData</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">GCMBlockCipher</span> cipher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GCMBlockCipher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AESEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">KeyParameter</span> keyParameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyParameter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AEADParameters</span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AEADParameters</span><span class="token punctuation">(</span>keyParameter<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>cipher<span class="token punctuation">.</span><span class="token function">getOutputSize</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> len <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">processBytes</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>length<span class="token punctuation">,</span> ciphertext<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ciphertext<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ä½¿ç”¨AESç®—æ³•è§£å¯†æ•°æ®</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptData</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonce<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tag<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">GCMBlockCipher</span> cipher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GCMBlockCipher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AESEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">KeyParameter</span> keyParameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyParameter</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">AEADParameters</span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AEADParameters</span><span class="token punctuation">(</span>keyParameter<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">;</span>        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>cipher<span class="token punctuation">.</span><span class="token function">getOutputSize</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> len <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">processBytes</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ciphertext<span class="token punctuation">.</span>length<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> data<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ç”ŸæˆRSAå¯†é’¥å¯¹</span>        <span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> <span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åŠ å¯†æ•°æ®</span>        <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> key<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encryptedKey <span class="token operator">=</span> <span class="token function">encryptKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nonce<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            nonce<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext <span class="token operator">=</span> <span class="token function">encryptData</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> ciphertext<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">16</span><span class="token punctuation">,</span> tag<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¾“å‡ºåŠ å¯†åçš„æ•°æ®</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Key: "</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Nonce: "</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ciphertext: "</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Tag: "</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è§£å¯†æ•°æ®</span>        key <span class="token operator">=</span> <span class="token function">decryptKey</span><span class="token punctuation">(</span>encryptedKey<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext <span class="token operator">=</span> <span class="token function">decryptData</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> key<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¾“å‡ºï¼šHello World!</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°ä»£ç ä½¿ç”¨äº†CryptoJSåº“å’ŒBouncy Castleåº“å®ç°äº†å‰åç«¯æ•°æ®åŠ å¯†ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå‰ç«¯ä½¿ç”¨AESç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä½¿ç”¨RSAå…¬é’¥åŠ å¯†AESå¯†é’¥ï¼Œå°†åŠ å¯†åçš„å¯†é’¥å’ŒåŠ å¯†åçš„æ•°æ®ä¸€èµ·å‘é€ç»™åç«¯ã€‚åç«¯ä½¿ç”¨RSAç§é’¥è§£å¯†AESå¯†é’¥ï¼Œç„¶åä½¿ç”¨è§£å¯†åçš„å¯†é’¥å¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚åŒæ ·ï¼Œåç«¯ä¹Ÿå¯ä»¥ä½¿ç”¨AESç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä½¿ç”¨RSAå…¬é’¥åŠ å¯†AESå¯†é’¥ï¼Œå°†åŠ å¯†åçš„å¯†é’¥å’ŒåŠ å¯†åçš„æ•°æ®ä¸€èµ·å‘é€ç»™å‰ç«¯ã€‚å‰ç«¯ä½¿ç”¨RSAç§é’¥è§£å¯†AESå¯†é’¥ï¼Œç„¶åä½¿ç”¨è§£å¯†åçš„å¯†é’¥å¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚</p><h2 id="demo2">demo2</h2><pre class="mermaid">sequenceDiagramactor a as ç”¨æˆ·participant f as å‰ç«¯æœåŠ¡å™¨participant b as åç«¯æœåŠ¡å™¨a ->> +f: è§¦å‘æ“ä½œf ->> f: ç”ŸæˆéšæœºAESå¯†é’¥f ->> f: AES(data) => secretDataf ->> f: RSA_priKey(AES) => aesKeyf ->> +b: aesKey + secretDatab ->> b: RSA_pubKey(aesKey) => AESb ->> b: AES(secretData) => datab ->> b: åŒç­‰æ–¹å¼åŠ å¯†b -->> -f: å“åº”æ•°æ®f -->> -a: å“åº”ç»™ç”¨æˆ·</pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> safe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx-ssl</title>
      <link href="/2023/04/15/nginx-ssl/"/>
      <url>/2023/04/15/nginx-ssl/</url>
      
        <content type="html"><![CDATA[<h1>NginxåŠSSLé…ç½®</h1><h2 id="Nginxå®‰è£…">Nginxå®‰è£…</h2><h3 id="ç¼–è¯‘æµç¨‹">ç¼–è¯‘æµç¨‹</h3><ol><li><p>cdåˆ°nginxæºç åŒ…ä¸‹(å¯èƒ½åœ¨æ­¤ä¹‹å‰è¦å…ˆtar -zxvf xxx)</p></li><li><p>ç¼–è¯‘å‰é…ç½®</p><p><code>./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module</code></p></li><li><p>ç¼–è¯‘</p><p><code>make</code></p><p><code>make install</code></p></li></ol><h3 id="ç¼–è¯‘ä¸­ä¼šé‡åˆ°çš„ä¾èµ–ç¼ºå¤±">ç¼–è¯‘ä¸­ä¼šé‡åˆ°çš„ä¾èµ–ç¼ºå¤±</h3><p>gccç¼ºå¤±</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŠ¥é”™æç¤º</span>checking <span class="token keyword">for</span> OS+ Linux <span class="token number">3.10</span>.0-693.el7.x86_64 x86_64checking <span class="token keyword">for</span> C compiler <span class="token punctuation">..</span>. not found./configure: error: C compiler cc is not found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>yum install -y gcc</code></p><p>perlåº“ç¼ºå¤±</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./configure: error: the HTTP rewrite module requires the PCRE library.You can either disable the module by using --without-http_rewrite_moduleoption, or <span class="token function">install</span> the PCRE library into the system, or build the PCRE librarystatically from the <span class="token builtin class-name">source</span> with nginx by using --with-pcre<span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator">></span> option.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>yum install -y pcre pcre-devel</code></p><p>zlibåº“ç¼ºå¤±</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./configure: error: the HTTP <span class="token function">gzip</span> module requires the zlib library.You can either disable the module by using --without-http_gzip_moduleoption, or <span class="token function">install</span> the zlib library into the system, or build the zlib librarystatically from the <span class="token builtin class-name">source</span> with nginx by using --with-zlib<span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator">></span> option.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>yum install -y zlib zlib-devel</code></p><h3 id="å¯åŠ¨Nginx">å¯åŠ¨Nginx</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># cdåˆ°ç¼–è¯‘åçš„ç›®å½•ä¸‹</span>./nginx å¯åŠ¨./nginx <span class="token parameter variable">-s</span> stop å¿«é€Ÿåœæ­¢./nginx <span class="token parameter variable">-s</span> quit ä¼˜é›…å…³é—­ï¼Œåœ¨é€€å‡ºå‰å®Œæˆå·²ç»æ¥å—çš„è¿æ¥è¯·æ±‚./nginx <span class="token parameter variable">-s</span> reload é‡æ–°åŠ è½½é…ç½®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨å†Œè‡³æœåŠ¡">æ³¨å†Œè‡³æœåŠ¡</h3><p>æ–°å»º <code>vi /usr/lib/systemd/system/nginx.service</code> å¹¶æ·»åŠ å¦‚ä¸‹é…ç½®</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties">[Unit]<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">nginx - web server</span><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target remote-fs.target nss-lookup.target</span>[Service]<span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">forking</span><span class="token key attr-name">PIDFile</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/nginx/logs/nginx.pid</span><span class="token key attr-name">ExecStartPre</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><span class="token key attr-name">ExecReload</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/nginx/sbin/nginx -s reload</span><span class="token key attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/nginx/sbin/nginx -s stop</span><span class="token key attr-name">ExecQuit</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/nginx/sbin/nginx -s quit</span><span class="token key attr-name">PrivateTmp</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>[Install]<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœåŠ¡å¯åŠ¨å‘½ä»¤">æœåŠ¡å¯åŠ¨å‘½ä»¤</h3><p>é‡æ–°åŠ è½½æœåŠ¡é…ç½®</p><p><code>systemctl daemon-reload</code></p><p>å¯åŠ¨æœåŠ¡</p><p><code>systemctl start nginx.service</code></p><p>å¼€æœºå¯åŠ¨</p><p><code>systemctl enable nginx.service</code></p><blockquote><p>æ­¤æ—¶å¦‚æœä¾ç„¶æ— æ³•è®¿é—®nginxæ£€æŸ¥é˜²ç«å¢™é…ç½®</p></blockquote><p>ç›¸å…³å‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl stop firewalld.servicesystemctl disable firewalld.service<span class="token comment"># æ”¾è¡Œç«¯å£</span>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp <span class="token parameter variable">--permanent</span><span class="token comment"># é‡å¯é˜²ç«å¢™</span>firewall-cmd <span class="token parameter variable">--reload</span><span class="token comment"># æŒ‡å®šç«¯å£å’Œipè®¿é—®</span>firewall-cmd <span class="token parameter variable">--permanent</span> --add-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">" source address="</span><span class="token number">192.168</span>.123.100<span class="token string">" port protocol="</span>tcp<span class="token string">" port="</span><span class="token number">8080</span><span class="token string">" accept"</span><span class="token comment"># ç§»é™¤è§„åˆ™</span>firewall-cmd <span class="token parameter variable">--permanent</span> --remove-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">" source address="</span><span class="token number">192.168</span>.123.100<span class="token string">" port port="</span><span class="token number">8080</span><span class="token string">" protocol="</span>tcp<span class="token string">" accept"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é…ç½®SSL">é…ç½®SSL</h2><h3 id="SSLè¯ä¹¦ç”³è¯·">SSLè¯ä¹¦ç”³è¯·</h3><p><img src="../nginx-ssl/20230426232049.png" alt=""></p><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹ä¼šåœ¨è§£æä¸­æ·»åŠ ä¸€æ¡TXTè®°å½•, å¦‚æœæ²¡æœ‰åˆ™éœ€æ‰‹åŠ¨æ·»åŠ </p></blockquote><h3 id="æ·»åŠ æœåŠ¡è§£æ">æ·»åŠ æœåŠ¡è§£æ</h3><p><img src="../nginx-ssl/20230426232440.png" alt=""></p><h3 id="è¯ä¹¦ä¸‹è½½">è¯ä¹¦ä¸‹è½½</h3><p>æ ¹æ®æœåŠ¡å™¨ç±»å‹ä¸‹è½½, æ­¤å¤„ä½¿ç”¨Nginx, åå°†å°†å…¬ç§é’¥æ”¾åˆ°nginxçš„confç›®å½•ä¸‹</p><h3 id="Nginxé…ç½®">Nginxé…ç½®</h3><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># HTTPS server</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">server_name</span>  localhost    ssl_certificate      9755530_xxxxxx.com.pem</span><span class="token punctuation">;</span>  <span class="token comment"># é…ç½®å…¬é’¥ å…¬é’¥çš„å¼€å¤´æ˜¯(BEGIN CERTIFICATE)</span>    <span class="token directive"><span class="token keyword">ssl_certificate_key</span>  9755530_xxxxxx.com.key</span><span class="token punctuation">;</span>  <span class="token comment"># é…ç½®ç§é’¥ ç§é’¥çš„å¼€å¤´æ˜¯(BEGIN RSA PRIVATE KEY)</span>    <span class="token directive"><span class="token keyword">ssl_session_cache</span>    shared:SSL:1m</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">5m</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_ciphers</span>  HIGH:!aNULL:!MD5</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>        <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>        <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦å¤–nginxå†æ·»åŠ é‡å®šå‘é…ç½®, æ ¹æ®è‡ªå·±éœ€è¦, å¦‚æœä¸ç”¨æ³›è§£æ, æ·»åŠ wwwå’Œ@ è¿™ä¸€æ­¥å¯ä»¥ä¸è¦</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># ç›‘å¬http</span><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span><span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span><span class="token comment">#åŸŸåã€ä¸»æœºå åŒ¹é…ç«™ç‚¹: å®Œæ•´åŒ¹é…ã€é€šé…ç¬¦åŒ¹é…ã€é€šé…ç¬¦ç»“æŸåŒ¹é…ã€æ­£åˆ™åŒ¹é…</span><span class="token directive"><span class="token keyword">server_name</span>  www.xxxxxx.cn xxxxxx.cn</span><span class="token punctuation">;</span><span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ›´æ–°nginxé…ç½®å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¥å¸¸æŸ¥è¯¢</title>
      <link href="/2023/04/14/daily/"/>
      <url>/2023/04/14/daily/</url>
      
        <content type="html"><![CDATA[<h2 id="Git">Git</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> push <span class="token parameter variable">-u</span> origin dev-dee<span class="token function">git</span> branch <span class="token parameter variable">-D</span> åˆ†æ”¯å  -- å¼ºåˆ¶åˆ é™¤åˆ†æ”¯<span class="token function">git</span> push origin <span class="token parameter variable">-d</span> åˆ†æ”¯å  -- å¼ºåˆ¶åˆ é™¤è¿œç«¯åˆ†æ”¯<span class="token function">git</span> stash list  -- æŸ¥è¯¢æš‚å­˜åŒº<span class="token function">git</span> stash show <span class="token parameter variable">-p</span> ç¼“å­˜id  -- æŸ¥è¯¢å…·ä½“æŸä¸ªstashå˜æ›´å†…å®¹<span class="token function">git</span> stash push <span class="token parameter variable">-m</span> <span class="token string">'xxx'</span>  -- æš‚å­˜å¹¶å–å<span class="token function">git</span> stash drop stash@<span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span>  -- åˆ é™¤æŸä¸€ä¸ªæš‚å­˜<span class="token function">npm</span> i <span class="token parameter variable">-g</span> git-br<span class="token function">git</span> br<span class="token function">git</span> config branch.develop.description åˆ†æ”¯å¤‡æ³¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ é™¤gitä¸­.ideaæ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- <span class="token number">1</span>. ä¿®æ”¹.gitignoreæ–‡ä»¶-- <span class="token number">2</span>. åˆ é™¤æœ¬åœ°ç¼“å­˜åŒº.ideaæ–‡ä»¶<span class="token function">git</span> <span class="token function">rm</span> <span class="token parameter variable">--cached</span> <span class="token parameter variable">-r</span> .idea-- <span class="token number">3</span>. æ¨é€<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'delete .idea'</span><span class="token function">git</span> push origin dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="DM">DM</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- å·²ç»æ‰§è¡Œè¶…è¿‡2sçš„æ´»åŠ¨SQL</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> sess_id<span class="token punctuation">,</span>sql_text<span class="token punctuation">,</span>datediff<span class="token punctuation">(</span>ss<span class="token punctuation">,</span>last_recv_time<span class="token punctuation">,</span>sysdate<span class="token punctuation">)</span> Y_EXETIME<span class="token punctuation">,</span>SF_GET_SESSION_SQL<span class="token punctuation">(</span>SESS_ID<span class="token punctuation">)</span> fullsql<span class="token punctuation">,</span>clnt_ip<span class="token punctuation">,</span>clnt_type<span class="token punctuation">,</span>create_time<span class="token keyword">FROM</span> V$SESSIONS <span class="token keyword">WHERE</span> STATE<span class="token operator">=</span><span class="token string">'ACTIVE'</span><span class="token punctuation">)</span><span class="token keyword">where</span> Y_EXETIME<span class="token operator">>=</span><span class="token number">2</span> <span class="token keyword">order</span> <span class="token keyword">by</span> y_exetime <span class="token keyword">desc</span><span class="token punctuation">)</span><span class="token comment">-- æŸ¥è¯¢å½“å‰å›æ»šå‰©ä½™æ¡æ•°</span><span class="token keyword">select</span> sess_id<span class="token punctuation">,</span>ins_cnt<span class="token operator">+</span>del_cnt<span class="token operator">+</span>upd_cnt<span class="token operator">+</span>upd_ins_cnt<span class="token punctuation">,</span>systimestamp <span class="token keyword">from</span> v$trx <span class="token keyword">where</span> ROLLBACK_FLAG<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">-- æŸ¥è¯¢å…·ä½“æŠ¥é”è¶…æ—¶çš„è¡¨å¯¹åº”çš„ä¼šè¯é”ï¼ŒæŸ¥è¯¢ç¬¬ä¸€åˆ—ç”¨äºæ€æ‰å¯¹åº”SESSION</span><span class="token keyword">select</span> <span class="token string">'sp_close_session('</span><span class="token operator">||</span>sess_id<span class="token operator">||</span><span class="token string">')'</span><span class="token punctuation">,</span><span class="token operator">*</span> <span class="token keyword">from</span> v$sessions <span class="token keyword">where</span> trx_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> trx_id <span class="token keyword">from</span> v$<span class="token keyword">lock</span> a<span class="token punctuation">,</span>SYSOBJECTS b <span class="token keyword">where</span> a<span class="token punctuation">.</span>table_id <span class="token operator">=</span> b<span class="token punctuation">.</span>id <span class="token operator">and</span> b<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'è¡¨å'</span> <span class="token operator">and</span> b<span class="token punctuation">.</span>SUBTYPE$<span class="token operator">=</span><span class="token string">'UTAB'</span> <span class="token operator">and</span> trx_id<span class="token operator">&lt;></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">-- æ€æ­»ä¼šè¯</span>sp_close_session<span class="token punctuation">(</span><span class="token number">140170753999128</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- ç»Ÿè®¡å½“å‰é˜»å¡çš„è¯¦æƒ…</span><span class="token keyword">select</span> clnt_ip<span class="token punctuation">,</span>clnt_type<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> v$sessions <span class="token keyword">where</span> run_status <span class="token operator">=</span> <span class="token string">'idle'</span> <span class="token keyword">group</span> <span class="token keyword">by</span> clnt_ip<span class="token punctuation">,</span> clnt_type <span class="token keyword">order</span> <span class="token keyword">by</span> clnt_ip<span class="token comment">-- ç»Ÿè®¡è¡¨ç©ºé—´å¤§å°</span><span class="token keyword">create</span> <span class="token keyword">table</span> table_count <span class="token punctuation">(</span>owner <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>table_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>used_space_MB <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">declare</span>    <span class="token keyword">begin</span>        <span class="token keyword">for</span> rec <span class="token operator">in</span>        <span class="token punctuation">(</span><span class="token keyword">select</span> owner<span class="token punctuation">,</span> table_name <span class="token keyword">from</span> all_tables <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>            <span class="token keyword">loop</span>            <span class="token keyword">insert</span> <span class="token keyword">into</span> table_count <span class="token keyword">select</span> rec<span class="token punctuation">.</span>owner<span class="token punctuation">,</span> rec<span class="token punctuation">.</span>table_name<span class="token punctuation">,</span>table_used_pages<span class="token punctuation">(</span>rec<span class="token punctuation">.</span>owner<span class="token punctuation">,</span> rec<span class="token punctuation">.</span>table_name<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>page<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>            <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_count <span class="token keyword">order</span> <span class="token keyword">by</span> used_space_mb <span class="token keyword">desc</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¿›ç¨‹ç«¯å£å‘½ä»¤">è¿›ç¨‹ç«¯å£å‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># linux</span><span class="token function">lsof</span> <span class="token parameter variable">-i:80</span>  <span class="token comment"># æ ¹æ®ç«¯å£æŸ¥çœ‹PIDåŠåº”ç”¨å</span><span class="token function">netstat</span> -ntulp<span class="token operator">|</span><span class="token function">grep</span> nginx  <span class="token comment"># æ ¹æ®åº”ç”¨åæŸ¥çœ‹ç«¯å£</span><span class="token function">top</span> <span class="token parameter variable">-Hp</span> pid  <span class="token comment"># æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä¸‹æ‰€æœ‰å­çº¿ç¨‹</span><span class="token comment">#win</span>tasklist <span class="token operator">|</span> findstr xxx  <span class="token comment"># æŸ¥çœ‹è¿›ç¨‹ ps -ef</span>taskkill /T /F /PID <span class="token number">12345</span>  <span class="token comment"># æ€æ­»è¿›ç¨‹ kill -9</span><span class="token function">netstat</span> -ano<span class="token operator">|</span>findstr <span class="token number">80</span>  <span class="token comment"># ç«¯å£æŸ¥çœ‹</span><span class="token comment"># linuxæŸ¥æ‰¾æ–‡ä»¶</span><span class="token function">find</span> / <span class="token parameter variable">-iname</span> *abc*  <span class="token comment"># å…¨å±€æœç´¢</span><span class="token function">find</span> / <span class="token parameter variable">-type</span> d <span class="token parameter variable">-iname</span> *abc* <span class="token comment"># æœç´¢æ–‡ä»¶å¤¹</span><span class="token function">find</span> / <span class="token parameter variable">-size</span> +100M<span class="token function">find</span> / <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-iname</span> abc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…¶ä»–linuxå¸¸ç”¨å‘½ä»¤">å…¶ä»–linuxå¸¸ç”¨å‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">journalctl <span class="token parameter variable">-u</span> <span class="token string">'æœåŠ¡å'</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-n</span> è¡Œæ•°<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> è§£å‹  <span class="token function">gzip</span> extract verbose <span class="token function">file</span><span class="token function">tar</span> <span class="token parameter variable">-zcvf</span> å‹ç¼©  <span class="token function">gzip</span> create <span class="token punctuation">..</span>.yum search <span class="token function">ifconfig</span>yum <span class="token function">install</span> net-toolsyum info net-toolsyum list jdk   æŸ¥çœ‹å®‰è£…è¿‡çš„åŒ…<span class="token function">cp</span> /dev/null nohup.out  <span class="token comment"># ä¸é‡å¯æœåŠ¡æ¸…ç©ºnohupæ–‡ä»¶</span><span class="token function">chmod</span> <span class="token number">766</span> <span class="token operator">&lt;</span>name<span class="token operator">></span> <span class="token comment"># user,group,other r=4,w=2,x=1</span><span class="token function">chown</span> <span class="token operator">&lt;</span>user<span class="token operator">></span>:<span class="token operator">&lt;</span>group<span class="token operator">></span> <span class="token operator">&lt;</span>name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ—¥æœŸ">æ—¥æœŸ</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ ¼å¼åŒ–æ—¥æœŸ</span><span class="token class-name">String</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> now <span class="token operator">=</span> <span class="token class-name">DateFormatUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// lang3åŒ…ä¸‹çš„å·¥å…·ç±»</span><span class="token class-name">String</span> now <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è§£ææ—¥æœŸ</span><span class="token class-name">Date</span> parse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"2023-12-12 12:12:12"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¦å¤„ç†å¼‚å¸¸ Tue Dec 12 12:12:12 CST 2023</span><span class="token class-name">LocalDateTime</span> parse <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"2023-12-12 12:12:12"</span><span class="token punctuation">,</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2023-12-12T12:12:12</span><span class="token comment">// ç›¸äº’è½¬æ¢</span><span class="token comment">// 1.Date => LocalDateTime</span><span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDateTime</span> localDateTime <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocalDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2.LocalDateTime => Date (ä¸å¸¸ç”¨, å› æ­¤å¤šå†™ç‚¹å¤‡æ³¨)</span><span class="token class-name">LocalDateTime</span> localDateTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>localDateTime                      <span class="token comment">// æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´(ç³»ç»Ÿé»˜è®¤æ—¶åŒº)</span>                      <span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      <span class="token comment">// è½¬ä¸ºå³ä½¿æ—¶é—´</span>                      <span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
            <tag> Git </tag>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mermaid-note</title>
      <link href="/2023/04/10/mermaid-note/"/>
      <url>/2023/04/10/mermaid-note/</url>
      
        <content type="html"><![CDATA[<h1>mermaidå…¥é—¨(åŸºäºhexo)</h1><h2 id="ã€‡ã€åŸºäºHexo-materyæ­å»ºmermaidæ’ä»¶">ã€‡ã€åŸºäºHexo-materyæ­å»ºmermaidæ’ä»¶</h2><p>å‚è€ƒmetaryé…ç½®æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none"># å›¾è¡¨ç»˜åˆ¶æ’ä»¶# å»ºè®®æ›´æ¢æ›´æ¢hexo-renderer-markdown-itå¼•æ“ã€‚å‚è€ƒä¸‹é¢é“¾æ¥# https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo-renderer-markdown-it# https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo-renderer-markdown-it&#x2F;wiki&#x2F;Advanced-Configuration# ä½¿ç”¨æ•™ç¨‹ï¼š https:&#x2F;&#x2F;blog.17lai.site&#x2F;posts&#x2F;cf0f47fd&#x2F;#Mermaid# å®‰è£…é…ç½®æ–¹æ³•# npm un hexo-renderer-marked --save# npm i hexo-renderer-markdown-it --save# npm install --save hexo-tag-mermaid# æ³¨æ„ï¼šhexo-renderer-markdown-it æ¯”é»˜è®¤å¼•æ“æ›´å¿«ï¼Œå¯é€‰æ‹©æ’ä»¶è¾ƒå¤šï¼Œè¯·è®¤çœŸçœ‹ä¸Šé¢ä¸¤ä¸ªé“¾æ¥æ•™ç¨‹ã€‚# mermaidè¯­æ³•æ•™ç¨‹ https:&#x2F;&#x2F;mermaid-js.github.io&#x2F;mermaid&#x2F;#&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºä¸»é¢˜ä¸­çš„ä½¿ç”¨æ–¹å¼éœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ  <code>&#123;% mermaid %&#125; &#123;% endmermaid %&#125;</code>, åœ¨ Typora ä¸­ç¼–å†™ä¸èƒ½å³ä½¿æ˜¾ç¤º, å› æ­¤é‡‡ç”¨å…¶ä»–æ–¹å¼å¯¹å…¶è¿›è¡Œä¼˜åŒ–</p><p>å‚è€ƒ <a href="https://cloud.tencent.com/developer/article/1688180">Markdownçš„æ—¶åºå›¾ã€æµç¨‹å›¾ã€å’Œç”˜ç‰¹å›¾+Hexoçš„ç›¸å…³é…ç½®</a> ä»¥åŠ <a href="https://github.com/webappdevelp/hexo-filter-mermaid-diagrams">GitHub - webappdevelp/hexo-filter-mermaid-diagrams</a></p><p><strong>å®‰è£…æ’ä»¶</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> un hexo-renderer-marked <span class="token parameter variable">--save</span><span class="token function">npm</span> i hexo-renderer-markdown-it <span class="token parameter variable">--save</span><span class="token comment"># å®‰è£…æ’ä»¶</span><span class="token function">npm</span> i hexo-tag-mermaid <span class="token parameter variable">--save</span> <span class="token function">npm</span> i hexo-filter-mermaid-diagrams <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é…ç½®æ’ä»¶</strong></p><p>é¦–å…ˆé…ç½® Hexo çš„ <code>_config.yml</code></p><p>éœ€è¦åœ¨é…ç½®æ–‡ä»¶çš„æ–‡æœ«æ·»åŠ </p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># mermaid chart</span><span class="token key atrule">mermaid</span><span class="token punctuation">:</span> <span class="token comment">## mermaid url https://github.com/knsv/mermaid</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token comment"># default true</span>  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"7.1.2"</span>  <span class="token comment"># default v7.1.2</span>  <span class="token key atrule">options</span><span class="token punctuation">:</span>    <span class="token comment"># find more api options from https://github.com/knsv/mermaid/blob/master/src/mermaidAPI.js</span>  <span class="token comment">#startOnload: true  // default true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ¸²æŸ“æ–‡ä»¶</strong></p><p>ç”±äº metary å†…åŒ…å« mermaid é…ç½®æ–‡ä»¶, å› æ­¤æ‰¾åˆ° <code>hexo-theme-matery/layout/layout.ejs</code></p><p>æœç´¢ <code>theme.mermaid.enable</code></p><p>å°†é…ç½®ä»£ç æ›´æ”¹è‡³ Github/hexo-filter-mermaid-diagrams ä¸­é…ç½®</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>mermaid<span class="token punctuation">.</span>enable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://unpkg.com/mermaid@<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>mermaid<span class="token punctuation">.</span>version </span><span class="token delimiter punctuation">%></span></span>/dist/mermaid.min.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>mermaid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        mermaid<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">'forest'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">&#125;</span> </span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é…ç½®æ–‡ä»¶</strong></p><p>æ¿€æ´» mermaid é…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mermaid</span><span class="token punctuation">:</span> <span class="token comment">## mermaid url https://github.com/knsv/mermaid</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># default false</span>  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"latest"</span> <span class="token comment"># default v7.1.2</span>  <span class="token key atrule">options</span><span class="token punctuation">:</span>  <span class="token comment"># find more api options from https://github.com/knsv/mermaid/blob/master/src/mermaidAPI.js</span>    <span class="token comment">#startOnload: true  // default true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸€ã€æµç¨‹å›¾-graph">ä¸€ã€æµç¨‹å›¾(graph)</h2><pre class="mermaid">graph TDA --> BA --> Cstyle B fill:#f9f,stroke:#333,stroke-width:4pxstyle C fill:#ccf,stroke:#f66,stroke-width:2px,stroke-dasharray: 5, 5</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">graph TD    A --&gt; B    A --&gt; C    style B fill:#f9f,stroke:#333,stroke-width:4px %% æ ·å¼    style C fill:#ccf,stroke:#f66,stroke-width:2px,stroke-dasharray: 5, 5 %% æ ·å¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–¹å‘">æ–¹å‘</h3><ul><li>TB/TD - top bottom/down</li><li>BT - bottom/top</li><li>LR - left right</li><li>RL - right left</li></ul><h3 id="èŠ‚ç‚¹">èŠ‚ç‚¹</h3><pre class="mermaid">graph LR;B[ç›´è§’]C(åœ†è§’)D((åœ†å½¢))E>ä¸å¯¹ç§°]F{è±å½¢}G([æ¤­åœ†å½¢])H[(åœ†æŸ±)]I[[åŒæ ]]K[\å¹³è¡Œ1\]L[/å¹³è¡Œ2/]M[\æ¢¯å½¢1/]N[/æ¢¯å½¢2\]B --> C --> D --> EF --> G --> H --> IK --> L --> M --> N</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">graph LR;ç›´è§’[] ---&gt; åœ†è§’(()) ---&gt; åœ†å½¢D(()) ---&gt; ä¸å¯¹ç§°&gt;]è±å½¢&#123;&#125; ---&gt; æ¤­åœ†å½¢([]) ---&gt; åœ†æŸ±[()] ---&gt; åŒæ [[]] ---&gt; å…­è¾¹å½¢&#123;&#123;&#125;&#125;å¹³è¡Œ1[\\] ---&gt; å¹³è¡Œ2[&#x2F;&#x2F;] ---&gt; æ¢¯å½¢1[\&#x2F;] ---&gt; æ¢¯å½¢2[&#x2F;\]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿çº¿">è¿çº¿</h3><ul><li>å®çº¿</li></ul><pre class="mermaid">graph LRA --> B --- C -- æ–‡å­— --- D -- æ–‡å­— --> E</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">%% A(æœ‰ç®­å¤´,æ— æ–‡å­—) -&gt; B(æ— ç®­å¤´ï¼Œæ— æ–‡å­—) -&gt; C(æœ‰ç®­å¤´ï¼Œæ–‡å­—) -&gt; D(æœ‰ç®­å¤´,æ–‡å­—)graph LRA --&gt; B --- C -- æ–‡å­— --- D -- æ–‡å­— --&gt; E<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>è™šçº¿</li></ul><pre class="mermaid">graph LR;A -.-> B -.æ–‡å­—.-> C</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">%% A(æœ‰ç®­å¤´,æ— æ–‡å­—) -&gt; B(æœ‰ç®­å¤´ï¼Œæ— æœ‰æ–‡å­—) graph LRA -.-&gt; B -.æ–‡å­—.-&gt; C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¤§ç®­å¤´</li></ul><pre class="mermaid">graph LRA ==> B == æ–‡å­— ==> C</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">%% A(å¤§ç®­å¤´,æ— æ–‡å­—) -&gt; B(å¤§ç®­å¤´,æœ‰æ–‡å­—)graph LRA &#x3D;&#x3D;&gt; B &#x3D;&#x3D; æ–‡å­— &#x3D;&#x3D;&gt; C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å­å›¾">å­å›¾</h3><pre class="mermaid">graph TB    subgraph one    a1-->a2    end    subgraph two    b1-->b2    end    subgraph three    c1-->c2    end    c1-->a2</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">graph TB    subgraph one    a1--&gt;a2    end    subgraph two    b1--&gt;b2    end    subgraph three    c1--&gt;c2    end    c1--&gt;a2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒã€æ—¶åºå›¾-sequenceDiagram">äºŒã€æ—¶åºå›¾(sequenceDiagram)</h2><h3 id="å‚ä¸è€…-participant">å‚ä¸è€…(participant)</h3><pre class="mermaid">sequenceDiagramdee ->> xian: I'm hungryxian -->> dee: Me too</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramdee -&gt;&gt; xian: I&#39;m hungryxian --&gt;&gt; dee: Me too<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>æ³¨: å¦‚æœå¸Œæœ›è‡ªå®šä¹‰å‚ä¸è€…é¡ºåº, ä½¿ç”¨<code>participant</code>å…³é”®å­—</p></blockquote><pre class="mermaid">sequenceDiagramparticipant xianparticipant deedee ->> xian: I'm hungryxian -->> dee: Me too</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramparticipant xianparticipant deedee -&gt;&gt; xian: I&#39;m hungryxian --&gt;&gt; dee: Me too<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ«å-as">åˆ«å(as)</h3><pre class="mermaid">sequenceDiagramparticipant A as xianparticipant D as deeA ->> D: How are youD -->> A: Fine</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramparticipant A as xianparticipant D as deeA --&gt; D: How are youD --&gt;&gt; A: Fine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¿çº¿-2">è¿çº¿</h3><pre class="mermaid">sequenceDiagramA -> B: æ— ç®­å¤´å®çº¿A --> B: æ— ç®­å¤´è™šçº¿A ->> B: æœ‰ç®­å¤´å®çº¿A -->> B: æœ‰ç®­å¤´è™šçº¿A -X B: æœ‰ç®­å¤´xå®çº¿A --X B: æœ‰ç®­å¤´xè™šçº¿</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramA -&gt; B: æ— ç®­å¤´å®çº¿A --&gt; B: æ— ç®­å¤´è™šçº¿A -&gt;&gt; B: æœ‰ç®­å¤´å®çº¿A --&gt;&gt; B: æœ‰ç®­å¤´è™šçº¿A -X B: æœ‰ç®­å¤´xå®çº¿A --X B: æœ‰ç®­å¤´xè™šçº¿<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ§åˆ¶ç„¦ç‚¹-Â±">æ§åˆ¶ç„¦ç‚¹(Â±)</h3><pre class="mermaid">sequenceDiagramdee ->>+ xian: Let's Fighting!%% +è¡¨ç¤ºæ¿€æ´»è§’è‰²xian -->>- dee: Grate!</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramdee -&gt;&gt;+ xian: Let&#39;s Fighting!%% +è¡¨ç¤ºæ¿€æ´»è§’è‰²xian --&gt;&gt;- dee: Grate!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç„¦ç‚¹åµŒå¥—</strong></p><pre class="mermaid">sequenceDiagramxian ->>+ dee: Let's Shopping!    xian ->>+ dee: Can you hear me?    dee -->>- xian: I can hear you.    dee -->>- xian: But I'm tired.</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramxian -&gt;&gt;+ dee: Let&#39;s Shopping!    xian -&gt;&gt;+ dee: Can you hear me?    dee --&gt;&gt;- xian: I can hear you.    dee --&gt;&gt;- xian: But I&#39;m tired.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤‡æ³¨-Note">å¤‡æ³¨(Note)</h3><p>Note [ right of | left of | over ] [Actor]</p><pre class="mermaid">sequenceDiagramparticipant ANote right of A: I'm note</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramparticipant ANote right of A: I&#39;m note<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>overç”¨æ³•</p><pre class="mermaid">sequenceDiagramparticipant A as deeparticipant B as xianA ->> B: Let 's shoppingNote over B: I don't want toNote over A,B: Just 20 min</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramparticipant A as deeparticipant B as xianA -&gt;&gt; B: Let &#39;s shoppingNote over B: I don&#39;t want toNote over A,B: Just 20 min<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¾ªç¯-loop">å¾ªç¯(loop)</h3><pre class="mermaid">sequenceDiagramxian ->> dee: let's shopping%% loop åloop 20 mindee --> xian: let me see seeenddee -->> xian: ok</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramxian -&gt;&gt; dee: let&#39;s shopping%% loop åloop 20 mindee --&gt; xian: let me see seeenddee --&gt;&gt; xian: ok<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€‰æ‹©">é€‰æ‹©</h3><pre class="mermaid">sequenceDiagramdee ->> xian: What do you want to drinkalt summerxian -->> dee: ice creamelse winterxian -->> dee: teaendopt all the timexian -->> dee: milk tea is okend</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramdee -&gt;&gt; xian: What do you want to drinkalt summerxian --&gt;&gt; dee: ice creamelse winterxian --&gt;&gt; dee: teaendopt all the timexian --&gt;&gt; dee: milk tea is okend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‰²å—">è‰²å—</h3><pre class="mermaid">sequenceDiagramactor a as clientparticipant b as serverrect rgb(213, 235, 225)        a ->> +b: quest        b -->> -a: responseendrect rgb(192, 214, 149)a ->> +b: questb ->> -a: responseend</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">sequenceDiagramactor a as clientparticipant b as serverrect rgb(213, 235, 225)        a -&gt;&gt; +b: quest        b --&gt;&gt; -a: responseendrect rgb(192, 214, 149)a -&gt;&gt; +b: questb -&gt;&gt; -a: responseend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸‰ã€ç±»å›¾-classDiagram">ä¸‰ã€ç±»å›¾(classDiagram)</h2><pre class="mermaid">classDiagramclass Person {+String name // public-int age // private+save() void+eat(food) void+breathe(air) void}class Student~Primary~ {-String studentNo+doHomework(pen) Homework}class Tool {+String function+use() void}class Pen {+use() void}class Air {+String O2}class Eye {+String eyes}class Grade {+Student students}Air <.. Person: ä¾èµ–(ä¸€ä¸ªéœ€è¦å¦ä¸€ä¸ªçš„ååŠ©)Person <|-- Student: ç»§æ‰¿Tool <|.. Pen: å®ç°Pen <.. Student: ä¾èµ–Person *-- Eye: ç»„åˆ(æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³», éƒ¨åˆ†ä¸èƒ½ç¦»å¼€æ•´ä½“å•ç‹¬å­˜åœ¨)Grade o-- Student: èšåˆ(æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³», éƒ¨åˆ†å¯ä»¥ç¦»å¼€æ•´ä½“å•ç‹¬å­˜åœ¨)</pre><pre class="line-numbers language-null" data-language="null"><code class="language-null">classDiagramclass Person &#123;+String name &#x2F;&#x2F; public-int age &#x2F;&#x2F; private+save() void+eat(food) void+breathe(air) void&#125;class Student~Primary~ &#123;-String studentNo+doHomework(pen) Homework&#125;class Tool &#123;+String function+use() void&#125;class Pen &#123;+use() void&#125;class Air &#123;+String O2&#125;class Eye &#123;+String eyes&#125;class Grade &#123;+Student students&#125;Air &lt;.. Person: ä¾èµ–(ä¸€ä¸ªéœ€è¦å¦ä¸€ä¸ªçš„ååŠ©)Person &lt;|-- Student: ç»§æ‰¿Tool &lt;|.. Pen: å®ç°Pen &lt;.. Student: ä¾èµ–Person *-- Eye: ç»„åˆ(æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³», éƒ¨åˆ†ä¸èƒ½ç¦»å¼€æ•´ä½“å•ç‹¬å­˜åœ¨)Grade o-- Student: èšåˆ(æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³», éƒ¨åˆ†å¯ä»¥ç¦»å¼€æ•´ä½“å•ç‹¬å­˜åœ¨)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mermaid </tag>
            
            <tag> Hexo </tag>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>th-login</title>
      <link href="/2023/04/10/th-login/"/>
      <url>/2023/04/10/th-login/</url>
      
        <content type="html"><![CDATA[<h1>ç¬¬ä¸‰æ–¹ç™»å½•:</h1><p><em><code>vue-java</code>å‰åç«¯äº¤äº’æµç¨‹<code>demo</code> (æœ¬ç¯‡ä»¥<code>gitee</code> ä¸ºä¾‹)</em></p><h2 id="æ—¶åºå›¾">æ—¶åºå›¾</h2><pre class="mermaid">sequenceDiagramactor c as å®¢æˆ·ç«¯participant f as å‰ç«¯æœåŠ¡å™¨participant b as åç«¯æœåŠ¡å™¨participant g as giteerect rgb(213, 235, 225)        f ->> +g: æ‰“å¼€æ–°çª—å£, è¯·æ±‚https://gitee.com/oauth/authorize        note over f, g: æºå¸¦client_idä»¥åŠredirect_url (æ­¤å¤„æ˜¯ä¸å®‰å…¨çš„)        g ->> g: æ ¡éªŒclient_id        g ->> -b: é‡å®šå‘è‡³åç«¯æœåŠ¡å™¨        note over g,b: æºå¸¦code (æ­¤å¤„æ˜¯ä¸å®‰å…¨çš„)    end    rect rgb(192, 214, 149)        b ->> +g: è¯·æ±‚https://gitee.com/oauth/token        note over b, g: æºå¸¦grant_type,client_id,client_secret,code,redirect_uri        g -->> -b: è¿”å›access_token    end        rect rgb(240, 194, 162)        b ->> +g: è¯·æ±‚https://gitee.com/api/v5/user        note over b, g: æºå¸¦access_token        g -->> -b: è¿”å›ç”¨æˆ·ä¿¡æ¯    end    rect rgb(235, 238, 232)        b ->> f: ç”Ÿæˆtoken, å¹¶å°†tokenä¿¡æ¯å‘é€ç»™è€çª—å£, ç„¶åå…³é—­æ–°çª—å£        f ->> f: ç›‘å¬åˆ°token        f ->> c: å°†tokenå†™å…¥åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨end</pre><h2 id="gitee">gitee</h2><p><img src="../th-login/20230413000620.png" alt=""></p><h2 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h2><ol><li>å‰ç«¯æ‰“å¼€æ–°çª—å£, å¹¶è¯·æ±‚ <code>gitee</code></li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">giteeHandleClick</span><span class="token punctuation">(</span><span class="token parameter">thirdpart</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> client_id <span class="token operator">=</span> <span class="token string">'client_idxxxxx'</span> <span class="token comment">// giteeid</span>    <span class="token keyword">const</span> redirect_uri <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">'http://uri/tp/gitee_cb'</span><span class="token punctuation">)</span> <span class="token comment">// giteeè·³è½¬åœ°å€</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://gitee.com/oauth/authorize?client_id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>client_id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;redirect_uri=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>redirect_uri<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;response_type=code</span><span class="token template-punctuation string">`</span></span>    window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> thirdpart<span class="token punctuation">,</span> <span class="token number">540</span><span class="token punctuation">,</span> <span class="token number">540</span><span class="token punctuation">)</span> <span class="token comment">// url,ç”¨æˆ·ä¿¡æ¯</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>åç«¯æ¥æ”¶<code>gitee</code> æ‰€ä¼ <code>code</code> -&gt; è·å–<code>access_token</code> -&gt; è·å–ç”¨æˆ·ä¿¡æ¯ -&gt; ç”Ÿæˆç”¨æˆ·<code>token</code> å¹¶è¿”å›ç»™å‰ç«¯</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">gitee</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è·å–è®¿é—®ä»¤ç‰Œ</span>    <span class="token class-name">String</span> accessToken <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è·å–ç”¨æˆ·ä¿¡æ¯</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> body <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Object</span> username <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Object</span> avatar <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"avatar_url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ç”¨æˆ·ä¿¡æ¯å­˜å‚¨æœ¬åœ°, ç”ŸæˆJWTä»¤ç‰Œç»™å‰ç«¯</span>    <span class="token class-name">String</span> token <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">loginFromOAuth</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> avatar<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è®©é¡µé¢å»å‘é€ä¿¡æ¯ç»™å‰ç«¯è°ƒç”¨è€…</span>    <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"&lt;script>\n"</span> <span class="token operator">+</span>                                  <span class="token string">"window.opener.postMessage('%s','%s')\n"</span> <span class="token operator">+</span>                                  <span class="token string">"window.close()\n"</span> <span class="token operator">+</span>                                  <span class="token string">"&lt;/script>"</span><span class="token punctuation">,</span>                                  <span class="token comment">//ç»™è°ƒç”¨è€…å‘é€ä¿¡æ¯,(è¯¦ç»†å†…å®¹,æ¥æº)æŒ‡æ˜æ¶ˆæ¯æ¥æº, å¦åˆ™ä¼šè·¨åŸŸ</span>                                  <span class="token comment">//window.opener.postMessage(message,origin)</span>                                  <span class="token comment">//window.close() å…³é—­å°çª—å£</span>                                  token<span class="token punctuation">,</span>                                  frontendURL<span class="token punctuation">)</span><span class="token punctuation">;</span>    resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span><span class="token class-name">MapBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"grant_type"</span><span class="token punctuation">,</span> <span class="token string">"authorization_code"</span><span class="token punctuation">)</span>                                    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"client_id"</span><span class="token punctuation">,</span> clientId<span class="token punctuation">)</span>                                    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"client_secret"</span><span class="token punctuation">,</span> clientSecret<span class="token punctuation">)</span>                                    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span>                                    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"redirect_uri"</span><span class="token punctuation">,</span> redirectURI<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                                       <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> httpEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> response <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span><span class="token string">"https://gitee.com/oauth/token"</span><span class="token punctuation">,</span> httpEntity<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Map</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> body<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token string">"access_token"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> accessToken<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> response <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token constant">URI</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"https://gitee.com/api/v5/user?access_token="</span> <span class="token operator">+</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Map</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> body<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>å‰ç«¯ç›‘å¬åˆ°tokenä¿¡æ¯, å†™å…¥ç”¨æˆ·Cookie</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">msg</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¯ä»¥å¯¹æ¶ˆæ¯æ¥æºåšåˆ¤æ–­</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>origin<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'8080'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">setToken</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span>    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token comment">// æµè§ˆå™¨è·³è½¬</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue_axios</title>
      <link href="/2023/04/09/vue-axios/"/>
      <url>/2023/04/09/vue-axios/</url>
      
        <content type="html"><![CDATA[<h1>Axiosè¯·æ±‚ç¤ºä¾‹</h1><p>æœ¬ç¯‡åŸºäºvue2, ç®€å•è‡ªå®šä¹‰æ‹¦æˆªå™¨, å¹¶å‘é€postè¯·æ±‚è‡³åç«¯æœåŠ¡å™¨</p><h2 id="1-å®‰è£…">1. å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> axios <span class="token parameter variable">-S</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-æ‹¦æˆªå™¨é…ç½®ç¤ºä¾‹">2. æ‹¦æˆªå™¨é…ç½®ç¤ºä¾‹</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token comment">// åˆ›å»ºaxios</span><span class="token keyword">const</span> _axios <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">"http://localhost:23323"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>_axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>    <span class="token parameter">config</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è®¾ç½®tokenè¯·æ±‚å¤´</span>        config<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'222.333.zzZ'</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> config    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>_axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>    <span class="token parameter">rep</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 2xxèŒƒå›´èµ°è¿™é‡Œ</span>        <span class="token keyword">return</span> rep    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// è¶…å‡º2xxèµ°è¿™é‡Œ, ç¤ºä¾‹åˆ—ä¸¾</span>        <span class="token keyword">let</span> status <span class="token operator">=</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'è¯·æ±‚å‚æ•°é”™è¯¯'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'èµ„æºä¸å­˜åœ¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">405</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'è¯·æ±‚æ–¹å¼é”™è¯¯'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> _axios<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-axiosä½¿ç”¨-POSTç¤ºä¾‹">3. axiosä½¿ç”¨(POSTç¤ºä¾‹)</h2><h3 id="3-1-URLæ‹¼æ¥å‚æ•°">3.1 URLæ‹¼æ¥å‚æ•°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">sendPostWithUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ­¤å¤„æ³¨æ„,éœ€è¦è¿›è¡Œç¼–ç </span>  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">'dee+'</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span>  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uri?name=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;age=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>age<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Request URL</strong>: <a href="http://ip">http://ip</a>:port/uri?name=dee%2B&amp;age=18 (ä¼šè‡ªåŠ¨è¿›è¡Œunicodeç¼–ç )</p><p><strong>Response Headers</strong>: ä¸­æ—  <code>Content-Type</code></p><h3 id="3-2-å°†å‚æ•°å¯¹è±¡æ”¾å…¥config">3.2 å°†å‚æ•°å¯¹è±¡æ”¾å…¥config</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">sendPostWithConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> _axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uri</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'dee+'</span><span class="token punctuation">,</span>      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Request URL</strong>: <a href="http://ip">http://ip</a>:port/uri?name=dee%2B&amp;age=20 (ä¼šè‡ªåŠ¨è¿›è¡Œunicodeç¼–ç )</p><p><strong>Response Headers :</strong></p><p><strong>Content-Type</strong>: application/x-www-form-urlencoded</p><h3 id="3-3-å…ˆurlencodeç¼–ç -å†é€šè¿‡dataå‚æ•°å‘é€è¯·æ±‚">3.3 å…ˆurlencodeç¼–ç , å†é€šè¿‡dataå‚æ•°å‘é€è¯·æ±‚</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">sendPostWithUrlEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  stu<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'dee+'</span><span class="token punctuation">)</span>  stu<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> _axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uri</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> stu<span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Request URL</strong>: <a href="http://ip">http://ip</a>:port/uri</p><p><strong>Response Headers :</strong></p><p><strong>Content-Type</strong>: application/x-www-form-urlencoded;charset=UTF-8</p><h3 id="3-4-form-dataæ ¼å¼è¯·æ±‚">3.4 form-dataæ ¼å¼è¯·æ±‚</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">sendPostWithFormdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  stu<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">'dee+'</span><span class="token punctuation">)</span>  stu<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> _axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uri</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> stu<span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Request URL</code>: <a href="http://ip">http://ip</a>:port/uri</p><p><strong>Response Headers :</strong></p><p><strong>Content-Type</strong>: multipart/form-data; boundary=----WebKitFormBoundaryvOzpiDlfBzqdp23l</p><h3 id="3-5-jsonæ ¼å¼è¯·æ±‚">3.5 jsonæ ¼å¼è¯·æ±‚</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">sendWithJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> stu <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'dee+'</span><span class="token punctuation">,</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/uri</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> stu<span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Request URL</strong>: <a href="http://ip">http://ip</a>:port/uri</p><p><strong>Response Headers :</strong></p><p><strong>Content-Type</strong>: application/json</p>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Start</title>
      <link href="/2023/04/08/hexo-start/"/>
      <url>/2023/04/08/hexo-start/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼€å§‹">å¼€å§‹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> hexo-cli  <span class="token comment"># å®‰è£…hexo</span>hexo init myBlog  <span class="token comment"># åˆå§‹åŒ–æœåŠ¡ å¦‚æœæŠ¥é”™åœ¨ éšç§å’Œå®‰å…¨->å¼€å‘è€…é€‰é¡¹->Powershellæ‰“å¼€ç­–ç•¥</span><span class="token comment"># è¿›å…¥æœåŠ¡æ–‡ä»¶å¤¹</span>hexo s  <span class="token comment"># å¯åŠ¨é¢„è§ˆæœåŠ¡(hexo server)</span>hexo n <span class="token punctuation">[</span>layout<span class="token punctuation">]</span> <span class="token operator">&lt;</span>title<span class="token operator">></span>  <span class="token comment"># layout(å¸ƒå±€) title(æ ‡é¢˜)</span>hexo g  <span class="token comment"># ç”Ÿæˆç½‘é¡µ(hexo generate)</span>hexo server <span class="token parameter variable">-p</span> <span class="token number">5000</span>  <span class="token comment"># æŒ‡å®šç«¯å£</span>hexo new page <span class="token string">"pagename"</span>  <span class="token comment"># æ–°å»ºæ–‡ä»¶å¤¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é…ç½®">é…ç½®</h2><h3 id="ä¸»é¢˜ä¸‹è½½">ä¸»é¢˜ä¸‹è½½</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/blinkfox/hexo-theme-matery.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¸»é…ç½®æ–‡ä»¶">ä¸»é…ç½®æ–‡ä»¶</h3><p><code>_config.yml</code></p><ul><li><p>ä¸»é¢˜ä¿®æ”¹</p></li><li><p><code>url</code> ä¿®æ”¹( å¦‚ï¼š<a href="http://xxx.github.io">http://xxx.github.io</a>)</p></li><li><p><code>per_page</code> ä¿®æ”¹ä¸º6çš„å€æ•°</p></li><li><p><code>language</code> è®¾ç½®ä¸­æ–‡</p></li></ul><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">theme</span><span class="token punctuation">:</span> hexo<span class="token punctuation">-</span>theme<span class="token punctuation">-</span>matery<span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.com<span class="token key atrule">index_generator</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">''</span>  <span class="token key atrule">per_page</span><span class="token punctuation">:</span> <span class="token number">12</span>  <span class="token key atrule">order_by</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>date<span class="token key atrule">language</span><span class="token punctuation">:</span> zh<span class="token punctuation">-</span>CN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é«˜äº®ä»£ç ">é«˜äº®ä»£ç </h3><p>æ ¹ç›®å½•<code>_config.yml</code></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">syntax_highlighter</span><span class="token punctuation">:</span> prismjs  <span class="token comment"># hexo7.0ä¹‹åé…ç½®è°ƒæ•´</span><span class="token key atrule">highlight</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">auto_detect</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">tab_replace</span><span class="token punctuation">:</span> <span class="token string">''</span>  <span class="token key atrule">wrap</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">hljs</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">prismjs</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">preprocess</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">tab_replace</span><span class="token punctuation">:</span> <span class="token string">''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç æ ·å¼ä¸‹è½½<a href="https://prismjs.com/download.html">prismjsä¸‹è½½é¡µé¢</a></p><p>ç„¶åå°†cssæ–‡ä»¶å–åä¸º<code>prism.min.css</code>, æ›¿æ¢<code>themes/hexo-theme-matery/source/libs/prism/prism.min.css</code> æ–‡ä»¶</p><p><code>ä»£ç è¯­è¨€</code> æ ‡ç­¾éšè—, åœ¨<code>prism.min.css</code>æ–‡ä»¶æ–°å¢é…ç½®</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/*éšè—ä»£ç è¯­è¨€*/</span><span class="token selector">.code_lang</span> <span class="token punctuation">&#123;</span>    <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¯¼èˆªæ æ–‡ä»¶å¤¹é…ç½®">å¯¼èˆªæ æ–‡ä»¶å¤¹é…ç½®</h3><h4 id="æ–°å»º-categories-é¡µ">æ–°å»º categories é¡µ</h4><p><code>categories</code>é¡µæ˜¯ç”¨æ¥å±•ç¤ºæ‰€æœ‰åˆ†ç±»çš„é¡µé¢, æ–°å»ºå‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"categories"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¼–è¾‘é¡µé¢æ–‡ä»¶<code>/source/categories/index.md</code></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> categories<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"categories"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"categories"</span></span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ–°å»ºæ ‡ç­¾-tags-é¡µ">æ–°å»ºæ ‡ç­¾ tags é¡µ</h4><p><code>tags</code> é¡µæ˜¯ç”¨æ¥å±•ç¤ºæ‰€æœ‰æ ‡ç­¾çš„é¡µé¢, æ–°å»ºå‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"tags"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¼–è¾‘é¡µé¢æ–‡ä»¶ <code>/source/tags/index.md</code></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> tags<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 18:23:38</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"tags"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"tags"</span></span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ–°å»ºå…³äºæˆ‘-about-é¡µ">æ–°å»ºå…³äºæˆ‘ about é¡µ</h4><p><code>about</code> é¡µæ˜¯ç”¨æ¥å±•ç¤º<strong>å…³äºæˆ‘å’Œæˆ‘çš„åšå®¢</strong>ä¿¡æ¯çš„é¡µé¢</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"about"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¼–è¾‘é¡µé¢æ–‡ä»¶ <code>/source/about/index.md</code></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> about<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"about"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"about"</span></span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ–°å»º-404-é¡µ">æ–°å»º 404 é¡µ</h4><p>æ–°å»ºå‘½ä»¤</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token number">404</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¼–è¾‘é¡µé¢æ–‡ä»¶ <code>/source/404/index.md</code></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token number">404</span><span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"404"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"404"</span><span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Oopsï½ï¼Œæˆ‘å´©æºƒäº†ï¼æ‰¾ä¸åˆ°ä½ æƒ³è¦çš„é¡µé¢ :("</span></span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœç´¢">æœç´¢</h3><p>å®‰è£…æ’ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-generator-search <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶æ–°å¢é…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">search</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> search.xml  <span class="token key atrule">field</span><span class="token punctuation">:</span> post<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ä¸­æ–‡é“¾æ¥è½¬æ‹¼éŸ³-å»ºè®®å®‰è£…">ä¸­æ–‡é“¾æ¥è½¬æ‹¼éŸ³(å»ºè®®å®‰è£…)</h3><p>å¦‚æœæ–‡ç« åç§°æ˜¯ä¸­æ–‡çš„ï¼Œé‚£ä¹ˆ Hexo é»˜è®¤ç”Ÿæˆçš„æ°¸ä¹…é“¾æ¥ä¹Ÿä¼šæœ‰ä¸­æ–‡ï¼Œè¿™æ ·ä¸åˆ©äº <code>SEO</code>ï¼Œä¸” <code>gitment</code> è¯„è®ºå¯¹ä¸­æ–‡é“¾æ¥ä¹Ÿä¸æ”¯æŒã€‚æˆ‘ä»¬å¯ä»¥ç”¨ <a href="https://github.com/viko16/hexo-permalink-pinyin">hexo-permalink-pinyin</a> Hexo æ’ä»¶ä½¿åœ¨ç”Ÿæˆæ–‡ç« æ—¶ç”Ÿæˆä¸­æ–‡æ‹¼éŸ³çš„æ°¸ä¹…é“¾æ¥ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i hexo-permalink-pinyin <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶æ–°å¢é…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">permalink_pinyin</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">separator</span><span class="token punctuation">:</span> <span class="token string">'-'</span> <span class="token comment"># default: '-'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>æ³¨</strong>ï¼šé™¤äº†æ­¤æ’ä»¶å¤–ï¼Œ<a href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink</a> æ’ä»¶ä¹Ÿå¯ä»¥ç”Ÿæˆéä¸­æ–‡çš„é“¾æ¥ã€‚</p></blockquote><h3 id="æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶ï¼ˆå»ºè®®å®‰è£…ï¼‰">æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶ï¼ˆå»ºè®®å®‰è£…ï¼‰</h3><p>å¦‚æœæƒ³è¦åœ¨æ–‡ç« ä¸­æ˜¾ç¤ºæ–‡ç« å­—æ•°ã€é˜…è¯»æ—¶é•¿ä¿¡æ¯ï¼Œå¯ä»¥å®‰è£… <a href="https://github.com/willin/hexo-wordcount">hexo-wordcount</a>æ’ä»¶ã€‚</p><p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">--save</span> hexo-wordcount<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶ååªéœ€åœ¨æœ¬ä¸»é¢˜ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œå°†å„ä¸ªæ–‡ç« å­—æ•°ç›¸å…³çš„é…ç½®æ¿€æ´»å³å¯ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">postInfo</span><span class="token punctuation">:</span>  <span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">update</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">wordCount</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># è®¾ç½®æ–‡ç« å­—æ•°ç»Ÿè®¡ä¸º true.</span>  <span class="token key atrule">totalCount</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># è®¾ç½®ç«™ç‚¹æ–‡ç« æ€»å­—æ•°ç»Ÿè®¡ä¸º true.</span>  <span class="token key atrule">min2read</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># é˜…è¯»æ—¶é•¿.</span>  <span class="token key atrule">readCount</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># é˜…è¯»æ¬¡æ•°.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¿®æ”¹é¡µè„š">ä¿®æ”¹é¡µè„š</h3><p>é¡µè„šä¿¡æ¯å¯èƒ½éœ€è¦åšå®šåˆ¶åŒ–ä¿®æ”¹ï¼Œè€Œä¸”å®ƒä¸ä¾¿äºåšæˆé…ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä½ è‡ªå·±å»å†ä¿®æ”¹å’ŒåŠ å·¥ã€‚ä¿®æ”¹çš„åœ°æ–¹åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/layout/_partial/footer.ejs</code> æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬ç«™ç‚¹ã€ä½¿ç”¨çš„ä¸»é¢˜ã€è®¿é—®é‡ç­‰ã€‚</p><h3 id="æ·»åŠ ä¸­æ–‡ç¹ç®€è½¬æ¢">æ·»åŠ ä¸­æ–‡ç¹ç®€è½¬æ¢</h3><p>åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œå¼€å¯ translate ä¸º enableã€‚</p><blockquote><p>å¼€å¯ä¸­æ–‡ç¹ç®€è½¬æ¢å¦‚ä¸‹ä¿®æ”¹ã€‚é»˜è®¤ä¸å¼€å¯ã€‚ å®ä¾‹æ¼”ç¤ºï¼š <a href="https://blog.17lai.site/">ç¹ç®€è½¬æ¢</a> åº•ä¸‹ footer æ </p></blockquote><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">translate</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ä¿®æ”¹ç¤¾äº¤é“¾æ¥">ä¿®æ”¹ç¤¾äº¤é“¾æ¥</h3><p>åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æ”¯æŒ <code>QQ</code>ã€<code>GitHub</code> å’Œé‚®ç®±ç­‰çš„é…ç½®ï¼Œä½ å¯ä»¥åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/layout/_partial/social-link.ejs</code> æ–‡ä»¶ä¸­ï¼Œæ–°å¢ã€ä¿®æ”¹ä½ éœ€è¦çš„ç¤¾äº¤é“¾æ¥åœ°å€ï¼Œå¢åŠ é“¾æ¥å¯å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>socialLink<span class="token punctuation">.</span>github<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </span><span class="token delimiter punctuation">%></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>socialLink<span class="token punctuation">.</span>github </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tooltipped<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">data-tooltip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è®¿é—®æˆ‘çš„GitHub<span class="token punctuation">"</span></span> <span class="token attr-name">data-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span> <span class="token attr-name">data-delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fab fa-github<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">&#125;</span> </span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ï¼Œç¤¾äº¤å›¾æ ‡ï¼ˆå¦‚ï¼š<code>fa-github</code>ï¼‰ä½ å¯ä»¥åœ¨ <a href="https://fontawesome.com/icons">Font Awesome</a> ä¸­æœç´¢æ‰¾åˆ°ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨ç¤¾äº¤å›¾æ ‡çš„æ ‡è¯†ï¼Œä¾›ä½ å‚è€ƒï¼š</p><ul><li>Facebook: <code>fab fa-facebook</code></li><li>Twitter: <code>fab fa-twitter</code></li><li>Google-plus: <code>fab fa-google-plus</code></li><li>Linkedin: <code>fab fa-linkedin</code></li><li>Tumblr: <code>fab fa-tumblr</code></li><li>Medium: <code>fab fa-medium</code></li><li>Slack: <code>fab fa-slack</code></li><li>Sina Weibo: <code>fab fa-weibo</code></li><li>Wechat: <code>fab fa-weixin</code></li><li>QQ: <code>fab fa-qq</code></li><li>Zhihu: <code>fab fa-zhihu</code></li></ul><h3 id="æœ¬åœ°å›¾ç‰‡é“¾æ¥é…ç½®">æœ¬åœ°å›¾ç‰‡é“¾æ¥é…ç½®</h3><p>æ­¤å¤„ä»¥<code>Typora</code>æ­é…ä½¿ç”¨</p><p><code>Typora</code>å›¾åƒè®¾ç½®</p><p><img src="../hexo-start/image-20230817224426509.png" alt=""></p><p><code>hexo</code>æ’ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npm i hexo<span class="token operator">-</span>renderer<span class="token operator">-</span>marked<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>_config</code>æ·»åŠ é…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">marked</span><span class="token punctuation">:</span>  <span class="token key atrule">prependRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">postAsset</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ–‡ç« æ ‡ç­¾æ·»åŠ , ä½¿ç”¨Typoraå¼•ç”¨æ–¹å¼</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">typora-root-url: &#123;&#123; title &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="éƒ¨ç½²">éƒ¨ç½²</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo d  <span class="token comment"># ä¸€é”®éƒ¨ç½²(hexo deploy)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>éƒ¨ç½²å‰, <code>_config.yml</code>é…ç½®å‚æ•°</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> git  <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/xxx/xxx.git  <span class="token comment"># githubä»“åº“å‘å¸ƒåœ°å€</span>  <span class="token key atrule">branch</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages  <span class="token comment"># å‘å¸ƒåˆ†æ”¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="GitHub-Pages">GitHub Pages</h3><ol><li><p>å…³è”ä»“åº“ä¸æºç </p></li><li><p>å°†<code>publish/</code> åŠ å…¥<code>.ignore</code></p></li><li><p><code>node --version</code> æŸ¥çœ‹nodeç‰ˆæœ¬</p></li><li><p>åˆ›å»ºæ–‡ä»¶ <code>.github/workflows/pages.yml</code></p></li><li><p>GitHub - Pagesè®¾ç½®</p><p><img src="../hexo-start/image-20230411230502386.png" alt=""></p></li></ol><h3 id="Vercel-åŠ é€Ÿ">Vercel åŠ é€Ÿ</h3><ol><li><p>ç»‘å®šGitHubé¡¹ç›®</p></li><li><p>Domainè®¾ç½®</p><p><img src="../hexo-start/image-20230411231718823.png" alt=""></p></li><li><p>é˜¿é‡Œäº‘æ·»åŠ åŸŸåè§£æ</p><p><img src="../hexo-start/image-20230411232320594.png" alt=""></p></li></ol><p>å‚è€ƒè‡ª:</p><blockquote><p><a href="https://blog.17lai.site/posts/5311b619/#vercel-%E9%83%A8%E7%BD%B2">åŸºäºHexoçš„materyä¸»é¢˜æ­å»ºåšå®¢å¢å¼ºéƒ¨ç½²ç¯‡4 | å¤œæ³•ä¹‹ä¹¦ (17lai.site)</a></p></blockquote><h3 id="å›¾åºŠè®¾ç½®">å›¾åºŠè®¾ç½®</h3><p><strong>ä¸ƒç‰›äº‘+é˜¿é‡Œäº‘+Typora</strong></p><ol><li><p>ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ - æ–°å»ºç©ºé—´ - åŸŸåé…ç½®</p><p><img src="../hexo-start/image-20230411233037391.png" alt=""></p></li><li><p>é˜¿é‡Œäº‘æ·»åŠ åŸŸåè§£æ<br><img src="../hexo-start/image-20230411233857926.png" alt=""></p></li><li><p>picgoçš„ä¸‹è½½ä¸é…ç½®</p><p><a href="https://picgo.github.io/PicGo-Doc/zh/">PicGo ä¸‹è½½é“¾æ¥</a></p><p><img src="../hexo-start/image-20230411234958488.png" alt=""></p><p><a href="https://developer.qiniu.com/kodo/1671/region-endpoint-fq">å­˜å‚¨åŒºåŸŸ_æ–‡æ¡£åœ°å€</a></p><p><img src="../hexo-start/image-20230412001114983.png" alt=""></p></li><li><p>Typoraå›¾ç‰‡è®¾ç½®</p><p><img src="../hexo-start/1220230412005659.png" alt=""></p><p>æ­¤æ—¶ç‚¹å‡»éªŒè¯å›¾ç‰‡ä¸Šä¼ é€‰é¡¹æµ‹è¯•æ˜¯å¦å¯ä»¥é…ç½®æˆåŠŸ. ä½†æ˜¯ç”±äºé»˜è®¤æƒ…å†µä¸‹PicGoä¼šå°†å›¾ç‰‡éƒ½æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹, å› æ­¤éœ€è¦å®‰è£…å‰ç¼€æ’ä»¶</p><p>åœ¨æ’ä»¶è®¾ç½®ä¸­æœç´¢<code>super-prefix</code> ä¸‹è½½æ’ä»¶</p><p><img src="../hexo-start/1220230412005940.png" alt=""></p><p>é…ç½®æ’ä»¶åé‡å¯, å†æ¬¡æµ‹è¯•ä¸Šä¼ ç›®å½•</p><p><img src="../hexo-start/20230412011022.png" alt=""></p></li></ol><h3 id="å›¾åºŠSSLé…ç½®">å›¾åºŠSSLé…ç½®</h3><p>ç”±äºç½‘ç«™æ˜¯httpsæœåŠ¡, å›¾åºŠçš„é“¾æ¥æ˜¯http, å› æ­¤é¡µé¢éƒ¨ç½²åè¯·æ±‚å›¾ç‰‡urlä¼šå°†httpå‡çº§ä¸ºhttpsè€Œå¯¼è‡´å›¾ç‰‡æ— æ³•åŠ è½½, å› æ­¤è¦åœ¨ä¸ƒç‰›äº‘é…ç½®SSLè¯ä¹¦</p><ol><li><p>é˜¿é‡Œäº‘è¯ä¹¦ç”³è¯·</p><img src="../hexo-start/20230412233520.png" /></li><li><p>æ·»åŠ åŸŸåè§£æ, ä¸‹è½½è¯ä¹¦</p><p><img src="../hexo-start/20230412233728.png" alt=""></p></li><li><p>ä¸ƒç‰›äº‘ä¸Šä¼ è¯ä¹¦(SSLè¯ä¹¦ - ä¸Šä¼ è‡ªæœ‰è¯ä¹¦), éƒ¨ç½²è¯ä¹¦</p><p><img src="../hexo-start/20230412234416.png" alt=""></p></li></ol><h2 id="è‡ªå®šä¹‰ä¸»é¢˜">è‡ªå®šä¹‰ä¸»é¢˜</h2><blockquote><p>æœ¬ç« èŠ‚å‡æ¬è¿è‡ªå…¶ä»–æ–‡ç« ã€åšå®¢å¹¶åŠ ä»¥æ•´åˆæˆè‡ªå·±æ ·å¼, åœ¨æ­¤ä»…ä½œä¸ºå‚è€ƒ</p></blockquote><h3 id="ä¿®æ”¹å¯¼èˆªæ é¢œè‰²ã€è’™ç‰ˆç­‰">ä¿®æ”¹å¯¼èˆªæ é¢œè‰²ã€è’™ç‰ˆç­‰</h3><p>æ–‡ä»¶<code>themes/hexo-theme-matery/source/css/matery.css</code></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/*å¯¼èˆªæ , åº•éƒ¨æ é¢œè‰²*/</span><span class="token selector">.bg-color</span> <span class="token punctuation">&#123;</span>    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #2b2d30 0%<span class="token punctuation">,</span> #2b2d30 100%<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.text-color</span> <span class="token punctuation">&#123;</span>    <span class="token property">color</span><span class="token punctuation">:</span> #2b2d30 <span class="token important">!important</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*åº•éƒ¨è¿›åº¦æ¡*/</span><span class="token selector">.progress-bar</span> <span class="token punctuation">&#123;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>    <span class="token property">z-index</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #bf4a30 0%<span class="token punctuation">,</span> #9d3a0f 100%<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">opacity</span><span class="token punctuation">:</span> 0.8<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*è’™ç‰ˆç‰¹æ•ˆ(å¯æ³¨é‡Šå…³é—­)*/</span><span class="token selector">.bg-cover:after</span> <span class="token punctuation">&#123;</span>    <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> rainbow 60s infinite<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> rainbow 60s infinite<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.bg-cover:before,.bg-cover:after</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* æ»šåŠ¨æ¡ */</span><span class="token selector">::-webkit-scrollbar-thumb</span> <span class="token punctuation">&#123;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> #FF2A68<span class="token punctuation">;</span>    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>45deg<span class="token punctuation">,</span><span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>.4<span class="token punctuation">)</span> 25%<span class="token punctuation">,</span>transparent 25%<span class="token punctuation">,</span>transparent 50%<span class="token punctuation">,</span><span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>.4<span class="token punctuation">)</span> 50%<span class="token punctuation">,</span><span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>.4<span class="token punctuation">)</span> 75%<span class="token punctuation">,</span>transparent 75%<span class="token punctuation">,</span>transparent<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 3em<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">::-webkit-scrollbar-track</span> <span class="token punctuation">&#123;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> #ffcacaff<span class="token punctuation">;</span>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 3em<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">::-webkit-scrollbar</span> <span class="token punctuation">&#123;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ”¹å®Œå¯¼èˆªæ åç»§ç»­æ›´æ”¹å…¶ä»–ç»„ä»¶ç»¿è‰²</p><p>å…¨å±€æ›¿æ¢ <code>#429b83</code> ä¸º <code>#cc1212</code></p><p>æµ…ç»¿ <code>#4cbf30</code> ä¸º <code>#2b2d30</code></p><p>æ·±ç»¿ <code>#0f9d58</code> ä¸º <code>#2b2d30</code></p><p>å‚è€ƒè‡ª:</p><blockquote><p><a href="https://blog.csdn.net/cungudafa/article/details/106278206">hexoï¼ˆmateryï¼‰èƒŒæ™¯ã€æ»šåŠ¨æ¡ä¼˜åŒ–+å¢åŠ ç‚¹å‡»è·³è¯„è®º_é¦–é¡µ+è‰²_cungudafaçš„åšå®¢</a></p><p><a href="https://www.cnblogs.com/chendeqiang/p/12861726.html">hexo-materyä¸»é¢˜æ”¹é€ ç¬”è®° - å¤šå¼—æœ—å¼ºå“¥</a></p></blockquote><h3 id="å‰¯æ ‡é¢˜å¼•ç”¨ä¸€è¨€åŠæ‰“å­—æœºæ ·å¼">å‰¯æ ‡é¢˜å¼•ç”¨ä¸€è¨€åŠæ‰“å­—æœºæ ·å¼</h3><p>å…¨å±€æœç´¢<code>span id=&quot;subtitle&quot;</code> å¯å®šä½åˆ°æ‰“å­—æœºä»£ç  <code>themes/hexo-theme-matery/layout/_partial/bg-cover-content.ejs</code></p><p>æ–°å¢é€»è¾‘å¦‚ä¸‹:</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token comment">&lt;!-- ä¸€è¨€ --></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>hitokoto<span class="token punctuation">.</span>enable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hitokoto<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- æ‰“å­—æœº --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/typed.js@2.0.11<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/bluebird@3/js/browser/bluebird.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/whatwg-fetch@2.0.3/fetch.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">var</span> hitokotoContent <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">function</span> <span class="token function">typed</span><span class="token punctuation">(</span><span class="token parameter">hitokotoContent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> typed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Typed</span><span class="token punctuation">(</span><span class="token string">"#hitokoto"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">strings</span><span class="token operator">:</span> <span class="token punctuation">[</span>                hitokotoContent            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token literal-property property">startDelay</span><span class="token operator">:</span> <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>hitokoto<span class="token punctuation">.</span>startDelay </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">,</span>            <span class="token literal-property property">typeSpeed</span><span class="token operator">:</span> <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>hitokoto<span class="token punctuation">.</span>typeSpeed </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">,</span>            <span class="token literal-property property">loop</span><span class="token operator">:</span> <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>hitokoto<span class="token punctuation">.</span>loop </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">,</span>            <span class="token literal-property property">backSpeed</span><span class="token operator">:</span> <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>hitokoto<span class="token punctuation">.</span>backSpeed </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">,</span>            <span class="token literal-property property">showCursor</span><span class="token operator">:</span> <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>hitokoto<span class="token punctuation">.</span>showCursor </span><span class="token delimiter punctuation">%></span></span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">hitokoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        hitokotoContent <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://v1.hitokoto.cn'</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>                <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div>ã€</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>data<span class="token punctuation">.</span>hitokoto<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ã€&lt;div/></span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>                <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div style="text-align: right; font-size: smaller"> â€”â€”ã€Œ</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>data<span class="token punctuation">.</span>from<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ã€&lt;/div></span><span class="token template-punctuation string">`</span></span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">await</span> <span class="token function">typed</span><span class="token punctuation">(</span>hitokotoContent<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token function">hitokoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> </span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸»é¢˜é…ç½®<code>themes/hexo-theme-matery/_config.yml</code> æ·»åŠ æ‰“å­—æœºé…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># ä¸€è¨€</span><span class="token key atrule">hitokoto</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">loop</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># æ˜¯å¦å¾ªç¯</span>  <span class="token key atrule">showCursor</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># æ˜¯å¦æ˜¾ç¤ºå…‰æ ‡</span>  <span class="token key atrule">startDelay</span><span class="token punctuation">:</span> <span class="token number">300</span> <span class="token comment"># å¼€å§‹å»¶è¿Ÿ</span>  <span class="token key atrule">typeSpeed</span><span class="token punctuation">:</span> <span class="token number">130</span> <span class="token comment"># æ‰“å­—é€Ÿåº¦</span>  <span class="token key atrule">backSpeed</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment"># åˆ é™¤é€Ÿåº¦</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¬è¿è‡ª:</p><blockquote><p><a href="https://dreamruins.gitee.io/tutorials/443376935.html#vcomments">Materyä¸»é¢˜è‡ªå®šä¹‰(äº”)ä¸ºä¸€è¨€å’Œæ–‡ç« æ ‡é¢˜æ·»åŠ æ‰“å­—æœºæ•ˆæœ</a></p></blockquote><p>2023-10-21 æ›´æ–°: è§£å†³ <code>cdn.jsdelivr.net</code> æ— æ³•è®¿é—®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸€ã€ å°† cdn.jsdelivr.net ==æ›¿æ¢ä¸º==> fastly.jsdelivr.net</span><span class="token comment"># äºŒã€ æœ¬åœ°æ›¿ä»£</span><span class="token comment"># 1. åˆ†åˆ«ä¸‹è½½ä»¥ä¸‹ä¸‰ä¸ªå·¥å…·åŒ…</span><span class="token comment"># https://github.com/mattboldt/typed.js/releases</span><span class="token comment"># https://github.com/petkaantonov/bluebird/releases</span><span class="token comment"># https://github.com/github/fetch/releases</span><span class="token comment"># 2. å‹ç¼©</span><span class="token function">npm</span> i uglify-js <span class="token parameter variable">-g</span> <span class="token comment"># å®‰è£…å‹ç¼©åŒ…</span>uglifyjs fetch.js <span class="token parameter variable">-o</span> fetch.min.js <span class="token parameter variable">-c</span> <span class="token comment"># å‹ç¼©</span><span class="token comment"># 3. å°†æ–‡ä»¶æ”¾ç½® ä¸»é¢˜æ–‡ä»¶å¤¹/source/js æ–‡ä»¶å¤¹</span><span class="token comment"># 4. æ›´æ”¹scriptè„šæœ¬è·¯å¾„</span><span class="token operator">&lt;</span>script <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">"/js/typed.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span>/script<span class="token operator">></span><span class="token operator">&lt;</span>script <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">"/js/bluebird.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span>/script<span class="token operator">></span><span class="token operator">&lt;</span>script <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">"/js/fetch.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span>/script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è‡ªåŠ¨åˆ‡æ¢é»‘å¤œæ¨¡å¼">è‡ªåŠ¨åˆ‡æ¢é»‘å¤œæ¨¡å¼</h3><p>å¦‚æœç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»åˆ‡æ¢åˆ™ä¸å†è¿›è¡Œè‡ªåŠ¨åˆ‡æ¢</p><p>åˆ‡æ¢æŒ‰é’®æ·»åŠ é€»è¾‘: <code>themes/hexo-theme-matery/layout/_widget/day-night.ejs</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">switchNightMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div class="Cuteen_DarkSky">&lt;div class="Cuteen_DarkPlanet">&lt;/div>&lt;/div>'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¦‚æœç”¨æˆ·ç‚¹å‡»åˆ‡æ¢åˆ™è¿›è¡Œæ ‡è®°</span>        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'manualDark'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token comment">//æ·»åŠ ä¸€è¡Œ</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">'DarkMode'</span><span class="token punctuation">)</span>            <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'DarkMode'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'isDark'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#sum-moon-icon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">"fa-sun"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'fa-moon'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'DarkMode'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'isDark'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#sum-moon-icon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">"fa-sun"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'fa-moon'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.Cuteen_DarkSky'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fadeOut</span><span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2e3</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ <code>themes/hexo-theme-matery/layout/layout.ejs</code> ä»£ç <code>&lt;%- partial('_widget/day-night') %&gt;</code> ä¸‹é¢(å¯é€‰)æ·»åŠ </p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token comment">//è‡ªåŠ¨åˆ‡æ¢å¤œé—´æ¨¡å¼</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'manualDark'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// å½“å‰ä¸»é¢˜æ˜¯å¦ä¸ºå¤œé—´æ¨¡å¼</span>        <span class="token keyword">let</span> isDark <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"isDark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å½“å‰æ—¶é—´æ˜¯å¦ä¸ºå¤œé—´</span>        <span class="token keyword">let</span> isNight <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">20</span> <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span>        <span class="token comment">// å¤œé—´ä½†ä¸æ˜¯å¤œé—´æ¨¡å¼</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isNight <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDark<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'DarkMode'</span><span class="token punctuation">)</span>            localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'isDark'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#sum-moon-icon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">"fa-sun"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'fa-moon'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// ä¸æ˜¯å¤œé—´ä½†æ˜¯å¤œé—´æ¨¡å¼</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isNight <span class="token operator">&amp;&amp;</span> isDark<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'DarkMode'</span><span class="token punctuation">)</span>            localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'isDark'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#sum-moon-icon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">"fa-sun"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'fa-moon'</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‚è€ƒè‡ª:</p><blockquote><p><a href="https://dreamruins.gitee.io/tutorials/1121281946">Materyä¸»é¢˜è‡ªå®šä¹‰(ä¸€)é»‘å¤œæ¨¡å¼</a></p></blockquote><h3 id="é¡µé¢åŠ è½½åŠ¨ç”»">é¡µé¢åŠ è½½åŠ¨ç”»</h3><ol><li><p>ç»“æ„ä»£ç </p><p>æ–°å»º<code>themes/hexo-theme-matery/layout/_widget/loading.ejs</code>æ–‡ä»¶</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>preloader<span class="token punctuation">.</span>enable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </span><span class="token delimiter punctuation">%></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading-left-bg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading-right-bg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spinner-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configure-border-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configure-core<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configure-border-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>configure-core<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading-word<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ç©å‘½åŠ è½½ä¸­ğŸ¤£ğŸ¤£ğŸ¤£<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- é¡µé¢åŠ è½½åŠ¨ç”» --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">        <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'auto'</span><span class="token punctuation">;</span>            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'loading-box'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"loaded"</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">&#125;</span> </span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ ·å¼ä»£ç </p><p>æ–°å»º<code>themes/hexo-theme-matery/source/css/loading.css</code> æ–‡ä»¶</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">#loading-box .loading-left-bg,#loading-box .loading-right-bg</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>    <span class="token property">z-index</span><span class="token punctuation">:</span> 1000<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> #37474f<span class="token punctuation">;</span>    <span class="token property">transition</span><span class="token punctuation">:</span> all 0.5s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#loading-box .loading-right-bg</span> <span class="token punctuation">&#123;</span>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#loading-box>.spinner-box</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>    <span class="token property">z-index</span><span class="token punctuation">:</span> 1001<span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#loading-box .spinner-box .configure-border-1</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 115px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 115px<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> #ffab91<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> configure-clockwise 3s ease-in-out 0s infinite alternate<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#loading-box .spinner-box .configure-border-2</span> <span class="token punctuation">&#123;</span>    <span class="token property">left</span><span class="token punctuation">:</span> -115px<span class="token punctuation">;</span>    <span class="token property">padding</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 115px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 115px<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>63<span class="token punctuation">,</span> 249<span class="token punctuation">,</span> 220<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> configure-xclockwise 3s ease-in-out 0s infinite alternate<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#loading-box .spinner-box .loading-word</span> <span class="token punctuation">&#123;</span>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>    <span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>    <span class="token property">font-size</span><span class="token punctuation">:</span> 0.8rem<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#loading-box .spinner-box .configure-core</span> <span class="token punctuation">&#123;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>    <span class="token property">background-color</span><span class="token punctuation">:</span> #37474f<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">div.loaded div.loading-left-bg</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-100%<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">div.loaded div.loading-right-bg</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>100%<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">div.loaded div.spinner-box</span> <span class="token punctuation">&#123;</span>    <span class="token property">display</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> configure-clockwise</span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">25%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>90deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>180deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">75%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>270deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> configure-xclockwise</span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">25%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-135deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">75%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-225deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-315deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°†åŠ è½½åŠ¨ç”»æ·»åŠ è‡³é¡µé¢</p><p>æ‰¾åˆ° <code>themes&gt;hexo-theme-matery&gt;layout&gt;_partial&gt;head.ejs</code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸“é—¨ç”¨æ¥å¼•å…¥æ ·å¼æ–‡ä»¶å’Œé…ç½®ç½‘é¡µä¿¡æ¯</p><p>åœ¨ <code>&lt;head&gt;</code> æ ‡ç­¾ä¸­å¼•å…¥ <strong>loading.css</strong> æ–‡ä»¶</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%-</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>jsDelivr<span class="token punctuation">.</span>url </span><span class="token delimiter punctuation">%></span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%-</span><span class="token language-javascript"> <span class="token function">url_for</span><span class="token punctuation">(</span><span class="token string">'/css/loading.css'</span><span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼•å…¥æ ·å¼æ–‡ä»¶åï¼Œå¼•å…¥ç»“æ„æ–‡ä»¶ <strong>loading.ejs</strong>ï¼Œæ’å…¥åœ¨<code>themes&gt;hexo-theme-matery&gt;layout&gt;layout.ejs</code> <code>&lt;body&gt;</code> æ ‡ç­¾ä¸‹ç¬¬ä¸€è¡Œå°±è¡Œäº†</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%-</span><span class="token language-javascript"> <span class="token function">partial</span><span class="token punctuation">(</span><span class="token string">'_widget/loading'</span><span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä¸»é¢˜é…ç½®ä¸­<code>_config.yml</code> æ·»åŠ é…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># æ˜¯å¦å¼€å¯é¡µé¢åŠ è½½åŠ¨ç”»</span><span class="token key atrule">preloader</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><p>æ¬è¿è‡ª:</p><blockquote><p><a href="https://dreamruins.gitee.io/tutorials/1793947201.html">Materyä¸»é¢˜è‡ªå®šä¹‰(å…­)é¡µé¢åŠ è½½åŠ¨ç”»)</a></p></blockquote><h2 id="æ–‡ç« -Front-matter-ä»‹ç»">æ–‡ç«  Front-matter ä»‹ç»</h2><h3 id="Front-matter-é€‰é¡¹è¯¦è§£">Front-matter é€‰é¡¹è¯¦è§£</h3><p><code>Front-matter</code> é€‰é¡¹ä¸­çš„æ‰€æœ‰å†…å®¹å‡ä¸º<strong>éå¿…å¡«</strong>çš„ã€‚ä½†æˆ‘ä»ç„¶å»ºè®®è‡³å°‘å¡«å†™ <code>title</code> å’Œ <code>date</code> çš„å€¼ã€‚</p><table><thead><tr><th>é…ç½®é€‰é¡¹</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>title</td><td><code>Markdown</code> çš„æ–‡ä»¶æ ‡é¢˜</td><td>æ–‡ç« æ ‡é¢˜ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹</td></tr><tr><td>date</td><td>æ–‡ä»¶åˆ›å»ºæ—¶çš„æ—¥æœŸæ—¶é—´</td><td>å‘å¸ƒæ—¶é—´ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹ï¼Œä¸”æœ€å¥½ä¿è¯å…¨å±€å”¯ä¸€</td></tr><tr><td>author</td><td>æ ¹ <code>_config.yml</code> ä¸­çš„ <code>author</code></td><td>æ–‡ç« ä½œè€…</td></tr><tr><td>img</td><td><code>featureImages</code> ä¸­çš„æŸä¸ªå€¼</td><td>æ–‡ç« ç‰¹å¾å›¾ï¼Œæ¨èä½¿ç”¨å›¾åºŠ(è…¾è®¯äº‘ã€ä¸ƒç‰›äº‘ã€åˆæ‹äº‘ç­‰)æ¥åšå›¾ç‰‡çš„è·¯å¾„.å¦‚: <code>http://xxx.com/xxx.jpg</code></td></tr><tr><td>top</td><td><code>true</code></td><td>æ¨èæ–‡ç« ï¼ˆæ–‡ç« æ˜¯å¦ç½®é¡¶ï¼‰ï¼Œå¦‚æœ <code>top</code> å€¼ä¸º <code>true</code>ï¼Œåˆ™ä¼šä½œä¸ºé¦–é¡µæ¨èæ–‡ç« </td></tr><tr><td>hide</td><td><code>false</code></td><td>éšè—æ–‡ç« ï¼Œå¦‚æœ<code>hide</code>å€¼ä¸º<code>true</code>ï¼Œåˆ™æ–‡ç« ä¸ä¼šåœ¨é¦–é¡µæ˜¾ç¤º</td></tr><tr><td>cover</td><td><code>false</code></td><td><code>v1.0.2</code>ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« æ˜¯å¦éœ€è¦åŠ å…¥åˆ°é¦–é¡µè½®æ’­å°é¢ä¸­</td></tr><tr><td>coverImg</td><td>æ— </td><td><code>v1.0.2</code>ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« åœ¨é¦–é¡µè½®æ’­å°é¢éœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ–‡ç« çš„ç‰¹è‰²å›¾ç‰‡</td></tr><tr><td>password</td><td>æ— </td><td>æ–‡ç« é˜…è¯»å¯†ç ï¼Œå¦‚æœè¦å¯¹æ–‡ç« è®¾ç½®é˜…è¯»éªŒè¯å¯†ç çš„è¯ï¼Œå°±å¯ä»¥è®¾ç½® <code>password</code> çš„å€¼ï¼Œè¯¥å€¼å¿…é¡»æ˜¯ç”¨ <code>SHA256</code> åŠ å¯†åçš„å¯†ç ï¼Œé˜²æ­¢è¢«ä»–äººè¯†ç ´ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ <code>config.yml</code> ä¸­æ¿€æ´»äº† <code>verifyPassword</code> é€‰é¡¹</td></tr><tr><td>toc</td><td><code>true</code></td><td>æ˜¯å¦å¼€å¯ TOCï¼Œå¯ä»¥é’ˆå¯¹æŸç¯‡æ–‡ç« å•ç‹¬å…³é—­ TOC çš„åŠŸèƒ½ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ <code>config.yml</code> ä¸­æ¿€æ´»äº† <code>toc</code> é€‰é¡¹</td></tr><tr><td>mathjax</td><td><code>false</code></td><td>æ˜¯å¦å¼€å¯æ•°å­¦å…¬å¼æ”¯æŒ ï¼Œæœ¬æ–‡ç« æ˜¯å¦å¼€å¯ <code>mathjax</code>ï¼Œä¸”éœ€è¦åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ä¹Ÿéœ€è¦å¼€å¯æ‰è¡Œ</td></tr><tr><td>summary</td><td>æ— </td><td>æ–‡ç« æ‘˜è¦ï¼Œè‡ªå®šä¹‰çš„æ–‡ç« æ‘˜è¦å†…å®¹ï¼Œå¦‚æœè¿™ä¸ªå±æ€§æœ‰å€¼ï¼Œæ–‡ç« å¡ç‰‡æ‘˜è¦å°±æ˜¾ç¤ºè¿™æ®µæ–‡å­—ï¼Œå¦åˆ™ç¨‹åºä¼šè‡ªåŠ¨æˆªå–æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºæ‘˜è¦</td></tr><tr><td>categories</td><td>æ— </td><td>æ–‡ç« åˆ†ç±»ï¼Œæœ¬ä¸»é¢˜çš„åˆ†ç±»è¡¨ç¤ºå®è§‚ä¸Šå¤§çš„åˆ†ç±»ï¼Œåªå»ºè®®ä¸€ç¯‡æ–‡ç« ä¸€ä¸ªåˆ†ç±»</td></tr><tr><td>tags</td><td>æ— </td><td>æ–‡ç« æ ‡ç­¾ï¼Œä¸€ç¯‡æ–‡ç« å¯ä»¥å¤šä¸ªæ ‡ç­¾</td></tr><tr><td>keywords</td><td>æ–‡ç« æ ‡é¢˜</td><td>æ–‡ç« å…³é”®å­—ï¼ŒSEO æ—¶éœ€è¦</td></tr><tr><td>reprintPolicy</td><td>cc_by</td><td>æ–‡ç« è½¬è½½è§„åˆ™ï¼Œ å¯ä»¥æ˜¯ cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint æˆ– pay ä¸­çš„ä¸€ä¸ª</td></tr></tbody></table><blockquote><p><strong>æ³¨æ„</strong>:</p><ol><li>å¦‚æœ <code>img</code> å±æ€§ä¸å¡«å†™çš„è¯ï¼Œæ–‡ç« ç‰¹è‰²å›¾ä¼šæ ¹æ®æ–‡ç« æ ‡é¢˜çš„ <code>hashcode</code> çš„å€¼å–ä½™ï¼Œç„¶åé€‰å–ä¸»é¢˜ä¸­å¯¹åº”çš„ç‰¹è‰²å›¾ç‰‡ï¼Œä»è€Œè¾¾åˆ°è®©æ‰€æœ‰æ–‡ç« çš„ç‰¹è‰²å›¾<strong>å„æœ‰ç‰¹è‰²</strong>ã€‚</li><li><code>date</code> çš„å€¼å°½é‡ä¿è¯æ¯ç¯‡æ–‡ç« æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºæœ¬ä¸»é¢˜ä¸­ <code>Gitalk</code> å’Œ <code>Gitment</code> è¯†åˆ« <code>id</code> æ˜¯é€šè¿‡ <code>date</code> çš„å€¼æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†çš„ã€‚</li><li>å¦‚æœè¦å¯¹æ–‡ç« è®¾ç½®é˜…è¯»éªŒè¯å¯†ç çš„åŠŸèƒ½ï¼Œä¸ä»…è¦åœ¨ Front-matter ä¸­è®¾ç½®é‡‡ç”¨äº† SHA256 åŠ å¯†çš„ password çš„å€¼ï¼Œè¿˜éœ€è¦åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> ä¸­æ¿€æ´»äº†é…ç½®ã€‚æœ‰äº›åœ¨çº¿çš„ SHA256 åŠ å¯†çš„åœ°å€ï¼Œå¯ä¾›ä½ ä½¿ç”¨ï¼š<a href="http://tool.oschina.net/encrypt?type=2">å¼€æºä¸­å›½åœ¨çº¿å·¥å…·</a>ã€<a href="http://encode.chahuo.com/">chahuo</a>ã€<a href="http://tool.chinaz.com/tools/hash.aspx">ç«™é•¿å·¥å…·</a>ã€‚</li><li>æ‚¨å¯ä»¥åœ¨æ–‡ç« mdæ–‡ä»¶çš„ front-matter ä¸­æŒ‡å®š reprintPolicy æ¥ç»™å•ä¸ªæ–‡ç« é…ç½®è½¬è½½è§„åˆ™</li></ol></blockquote><p>ä»¥ä¸‹ä¸ºæ–‡ç« çš„ <code>Front-matter</code> ç¤ºä¾‹ã€‚</p><h3 id="æœ€ç®€ç¤ºä¾‹">æœ€ç®€ç¤ºä¾‹</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> typora<span class="token punctuation">-</span>vue<span class="token punctuation">-</span>themeä¸»é¢˜ä»‹ç»<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-07 09:25:00</span></span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æœ€å…¨ç¤ºä¾‹">æœ€å…¨ç¤ºä¾‹</h3><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml"><span class="token key atrule">title</span><span class="token punctuation">:</span> typora<span class="token punctuation">-</span>vue<span class="token punctuation">-</span>themeä¸»é¢˜ä»‹ç»<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-07 09:25:00</span><span class="token key atrule">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Typora<span class="token punctuation">,</span> Markdown<span class="token punctuation">]</span><span class="token key atrule">categories</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>program<span class="token punctuation">]</span><span class="token key atrule">author</span><span class="token punctuation">:</span> author<span class="token key atrule">img</span><span class="token punctuation">:</span> /source/images/xxx.jpg<span class="token key atrule">cover</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">coverImg</span><span class="token punctuation">:</span> /images/1.jpg<span class="token key atrule">password</span><span class="token punctuation">:</span> 61503690505f84b144e6ac89124540a3eb8d22e77db76500984cfc50a1d8776e<span class="token key atrule">reprintPolicy</span><span class="token punctuation">:</span> cc_by_nc<span class="token key atrule">hide</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">top</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">toc</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">mathjax</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">summary</span><span class="token punctuation">:</span> è¿™æ˜¯ä½ è‡ªå®šä¹‰çš„æ–‡ç« æ‘˜è¦å†…å®¹ï¼Œå¦‚æœè¿™ä¸ªå±æ€§æœ‰å€¼ï¼Œæ–‡ç« å¡ç‰‡æ‘˜è¦å°±æ˜¾ç¤ºè¿™æ®µæ–‡å­—ï¼Œå¦åˆ™ç¨‹åºä¼šè‡ªåŠ¨æˆªå–æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºæ‘˜è¦<span class="token comment"># å›¾ç‰‡æ ¼å¼ä¸typoraä¸€è‡´</span><span class="token key atrule">typora-root-url</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> title <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
